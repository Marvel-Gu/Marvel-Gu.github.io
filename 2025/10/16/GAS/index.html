<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Github Action 自托管服务器踩坑记录 | Levitate Gu</title><meta name="author" content="levitategu"><meta name="copyright" content="levitategu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Github Action 自托管服务器踩坑记录 我们的一个项目中使用 Github Action 来进行 CI&#x2F;CD, 我们的痛点在于 Github Action 提供的缓存存储限制在10G, 而我们某个 job 的缓存比较大, 大约是 3.6G, 再加上别的缓存, 导致存储空间不够, 最终导致CI运行失败. 所以我们希望构建自托管服务器来解决这个问题. 其实一开始考虑的是能不能升级配置, 但是">
<meta property="og:type" content="article">
<meta property="og:title" content="Github Action 自托管服务器踩坑记录">
<meta property="og:url" content="https://www.levitategu.cn/2025/10/16/GAS/index.html">
<meta property="og:site_name" content="Levitate Gu">
<meta property="og:description" content="Github Action 自托管服务器踩坑记录 我们的一个项目中使用 Github Action 来进行 CI&#x2F;CD, 我们的痛点在于 Github Action 提供的缓存存储限制在10G, 而我们某个 job 的缓存比较大, 大约是 3.6G, 再加上别的缓存, 导致存储空间不够, 最终导致CI运行失败. 所以我们希望构建自托管服务器来解决这个问题. 其实一开始考虑的是能不能升级配置, 但是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pb01.s3.bitiful.net/31.webp">
<meta property="article:published_time" content="2025-10-16T02:12:20.000Z">
<meta property="article:modified_time" content="2025-10-19T12:48:38.289Z">
<meta property="article:author" content="levitategu">
<meta property="article:tag" content="CI">
<meta property="article:tag" content="Github Action">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pb01.s3.bitiful.net/31.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.levitategu.cn/2025/10/16/GAS/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-295586852-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-295586852-1');
</script><link rel="stylesheet" href="font-family:var(--global-font), Consolas_1, -apple-system, 'Quicksand', 'Nimbus Roman No9 L', 'PingFang SC', 'Hiragino Sans GB', 'Noto Serif SC', 'Microsoft Yahei', 'WenQuanYi Micro Hei', 'ST Heiti', sans-serif;" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Github Action 自托管服务器踩坑记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-19 20:48:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liebiao"></use></svg><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> 听</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangji">                   </use></svg><span> 记录</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyanban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanban"></use></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-lianjie"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyu"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyu"></use></svg><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pb01.s3.bitiful.net/31.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="Levitate Gu"><span class="site-name">Levitate Gu</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye"></use></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-biaoqian"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-biaoqian"></use></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-fenlei"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei"></use></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liebiao"></use></svg><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> 听</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangji">                   </use></svg><span> 记录</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyanban"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyanban"></use></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw icon-lianjie"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie"></use></svg><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyu"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyu"></use></svg><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Github Action 自托管服务器踩坑记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-16T02:12:20.000Z" title="发表于 2025-10-16 10:12:20">2025-10-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-19T12:48:38.289Z" title="更新于 2025-10-19 20:48:38">2025-10-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/sde/">sde</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Github Action 自托管服务器踩坑记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Github-Action-自托管服务器踩坑记录">Github Action 自托管服务器踩坑记录</h2>
<p>我们的一个项目中使用 <code>Github Action</code> 来进行 <code>CI/CD</code>, 我们的痛点在于 <code>Github Action</code> 提供的缓存存储限制在10G, 而我们某个 job 的缓存比较大, 大约是 3.6G, 再加上别的缓存, 导致存储空间不够, 最终导致CI运行失败. 所以我们希望构建自托管服务器来解决这个问题. 其实一开始考虑的是能不能升级配置, 但是没找到能升级缓存存储大小的办法.</p>
<p>问题如图:<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/370.webp" alt="avatar"><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/371.webp" alt="avatar"></p>
<h3 id="配置过程">配置过程</h3>
<ol>
<li>使用 <code>Terraform</code> 配一台服务器, 使用的是阿里云, 具体配置如下, 可以参考</li>
</ol>
<p><strong><a target="_blank" rel="noopener" href="http://main.tf">main.tf</a></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">locals &#123;</span><br><span class="line">  vpc_id      = alicloud_vpc.vpc.id</span><br><span class="line">  vswitch_ids = [for vswitch in alicloud_vswitch.vswitch : vswitch.id]</span><br><span class="line">  image_id    = data.alicloud_images.images.images.0.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ VPC 内网 ------------------------</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_vpc&quot; &quot;vpc&quot; &#123;</span><br><span class="line">  vpc_name    = var.name</span><br><span class="line">  cidr_block  = var.vpc_cidr</span><br><span class="line">  enable_ipv6 = true // 开启 IPV6</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_vswitch&quot; &quot;vswitch&quot; &#123;</span><br><span class="line">  count        = length(var.zones)</span><br><span class="line">  vswitch_name = &quot;vswitch-$&#123;count.index&#125;&quot;</span><br><span class="line">  cidr_block   = var.vswitch_cidrs[count.index]</span><br><span class="line">  vpc_id       = local.vpc_id</span><br><span class="line">  zone_id      = var.zones[count.index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ 安全组 -------------------------</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_security_group&quot; &quot;sg&quot; &#123;</span><br><span class="line">  security_group_name = var.name</span><br><span class="line">  description         = &quot;Security group for ECS&quot;</span><br><span class="line">  vpc_id              = local.vpc_id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_security_group_rule&quot; &quot;allow_ssh&quot; &#123;</span><br><span class="line">  type              = &quot;ingress&quot;</span><br><span class="line">  ip_protocol       = &quot;tcp&quot;</span><br><span class="line">  port_range        = &quot;22/22&quot;</span><br><span class="line">  security_group_id = alicloud_security_group.sg.id</span><br><span class="line">  cidr_ip           = &quot;0.0.0.0/0&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ 服务器镜像 --------------------</span><br><span class="line"></span><br><span class="line">data &quot;alicloud_images&quot; &quot;images&quot; &#123;</span><br><span class="line">  owners     = &quot;system&quot;</span><br><span class="line">  os_type    = &quot;linux&quot;</span><br><span class="line">  name_regex = &quot;^ubuntu_22+_[0-9]+_x64*&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ------------------------ Runner 服务器 ----------------</span><br><span class="line"></span><br><span class="line"># 创建弹性 IP</span><br><span class="line">resource &quot;alicloud_eip&quot; &quot;eip&quot; &#123;</span><br><span class="line">  bandwidth            = &quot;20&quot;</span><br><span class="line">  internet_charge_type = &quot;PayByBandwidth&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 创建 SSH 密钥对</span><br><span class="line">resource &quot;alicloud_ecs_key_pair&quot; &quot;key_pair&quot; &#123;</span><br><span class="line">  key_name_prefix = var.name</span><br><span class="line">  public_key      = var.public_key_pair</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 创建 ECS 实例</span><br><span class="line">resource &quot;alicloud_instance&quot; &quot;runner&quot; &#123;</span><br><span class="line">  instance_name        = var.name</span><br><span class="line">  host_name            = &quot;&quot;     # 删了, 需要自己填</span><br><span class="line">  image_id             = var.runner_image != &quot;&quot; ? var.runner_image : local.image_id</span><br><span class="line">  instance_type        = var.runner_instance_type</span><br><span class="line">  spot_strategy        = &quot;SpotAsPriceGo&quot;</span><br><span class="line">  security_groups      = [alicloud_security_group.sg.id]</span><br><span class="line">  key_name             = alicloud_ecs_key_pair.key_pair.key_pair_name</span><br><span class="line">  vswitch_id           = local.vswitch_ids[0]</span><br><span class="line">  system_disk_category = &quot;cloud_essd&quot;</span><br><span class="line">  system_disk_size     = 200</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 为 ECS 实例绑定公网 IP</span><br><span class="line">resource &quot;alicloud_eip_association&quot; &quot;runner_eip&quot; &#123;</span><br><span class="line">  allocation_id = alicloud_eip.eip.id</span><br><span class="line">  instance_id   = alicloud_instance.runner.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><a target="_blank" rel="noopener" href="http://provider.tf">provider.tf</a></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_providers &#123;</span><br><span class="line">    alicloud = &#123;</span><br><span class="line">      source  = &quot;aliyun/alicloud&quot;</span><br><span class="line">      version = &quot;1.258.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">provider &quot;alicloud&quot; &#123;</span><br><span class="line">  region = var.region</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://variables.tf">variables.tf</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;name&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;名称&quot;</span><br><span class="line">  default     = &quot;swan-lake-runner&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;region&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;地域&quot;</span><br><span class="line">  default     = &quot;cn-hongkong&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vpc_cidr&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;VPC 网段&quot;</span><br><span class="line">  default     = &quot;192.168.0.0/16&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vswitch_cidrs&quot; &#123;</span><br><span class="line">  type        = list(string)</span><br><span class="line">  description = &quot;子网网段&quot;</span><br><span class="line">  default     = [&quot;192.168.0.0/20&quot;, &quot;192.168.16.0/20&quot;, &quot;192.168.32.0/20&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;zones&quot; &#123;</span><br><span class="line">  type        = list(string)</span><br><span class="line">  description = &quot;可用区&quot;</span><br><span class="line">  default     = [&quot;cn-hongkong-b&quot;, &quot;cn-hongkong-c&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;public_key_pair&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;服务器公钥&quot;</span><br><span class="line">  default     = &quot;&quot;   # 需要自己填</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;runner_image&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;runner 服务器对应的镜像&quot;</span><br><span class="line">  default     = &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;runner_instance_type&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;runner 服务器的实例规格&quot;</span><br><span class="line">  default     = &quot;ecs.u1-c1m2.2xlarge&quot; # 默认 8 核 16 G</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>按照脚本配置服务器</li>
</ol>
<p><code>github</code> 上选好服务器信息就会有脚本, 服务器上新建一个用户 <code>levit</code> (<code>config.sh</code>不能再<code>sudo</code>权限下运行), 照着配置即可</p>
<p>如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Download</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a folder</span></span><br><span class="line">$ <span class="built_in">mkdir</span> actions-runner &amp;&amp; <span class="built_in">cd</span> actions-runner<span class="comment"># Download the latest runner package</span></span><br><span class="line">$ curl -o actions-runner-linux-x64-2.328.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.328.0/actions-runner-linux-x64-2.328.0.tar.gz</span><br><span class="line">Copied!</span><br><span class="line"><span class="comment"># Optional: Validate the hash</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;01066fad3a2893e63e6ca880ae3a1fad5bf9329d60e77ee15f2b97c148c3cd4e  actions-runner-linux-x64-2.328.0.tar.gz&quot;</span> | shasum -a 256 -c<span class="comment"># Extract the installer</span></span><br><span class="line">$ tar xzf ./actions-runner-linux-x64-2.328.0.tar.gz</span><br><span class="line">Configure</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the runner and start the configuration experience</span></span><br><span class="line">$ ./config.sh --url &#123;项目地址&#125; --token &#123;token, 一小时过期&#125;<span class="comment"># Last step, run it!</span></span><br><span class="line">$ ./run.sh</span><br><span class="line"></span><br><span class="line">Using your self-hosted runner</span><br><span class="line"><span class="comment"># Use this YAML in your workflow file for each job</span></span><br><span class="line">runs-on: self-hosted</span><br></pre></td></tr></table></figure>
<p>接下来我们要将其注册为服务, 使用<code>svc.sh</code>这个脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/levit/actions-runner</span><br><span class="line">sudo ./svc.sh install levit</span><br><span class="line">sudo ./svc.sh start</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>测试运行</li>
</ol>
<p>直接用原先的配置文件, 只是将服务器配置改了</p>
<ul>
<li>出现问题, 没有<code>docker</code>, 原因是我们的CI拉了一个 <code>postgresql</code> 的镜像, 这里就体现出自托管的第一个问题, <strong>不能无缝迁移</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/372.webp" alt="avatar"></p>
<ul>
<li>于是先安装Docker, 安装完之后, 还是失败:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-  Stop containers</span><br><span class="line"></span><br><span class="line">Value cannot be null. (Parameter &#x27;network&#x27;)</span><br><span class="line"></span><br><span class="line">- Initialize containers</span><br><span class="line"></span><br><span class="line">Exit code 1 returned from process: file name &#x27;/usr/bin/docker&#x27;, arguments &#x27;version --format &#x27;&#123;&#123;.Server.APIVersion&#125;&#125;&#x27;&#x27;. </span><br></pre></td></tr></table></figure>
<p>其实有点奇怪, 我已经将用户放到了Docker组里, 但没关系, 我直接修改 <code>docker.sock</code> 权限, 将其设置为所有用户都可读可写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br><span class="line">@reboot <span class="built_in">chmod</span> 666 /var/run/docker.sock</span><br></pre></td></tr></table></figure>
<ul>
<li>接着运行, 没有权限错误了, 但还是报错:</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/373.webp" alt="avatar"></p>
<p>需要为某个job配置cargo环境, 这里也体现出了<strong>不能无缝迁移</strong>的问题:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Rust</span> <span class="string">toolchain</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">dtolnay/rust-toolchain@stable</span></span><br></pre></td></tr></table></figure>
<ul>
<li>接着继续rerun, 还是报错:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">error: linking with cc failed: exit status: 1</span><br><span class="line"></span><br><span class="line">  |</span><br><span class="line">  = note:  &quot;cc&quot; &quot;-m64&quot; &quot;/tmp/rustcJw9CYQ/symbols.o&quot; &quot;&lt;17 object files omitted&gt;&quot; &quot;-Wl,--as-needed&quot; &quot;-Wl,-Bstatic&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/&#123;libjsonschema-290691234c978af9,libbytecount-2256add9d3494a3e,libuuid_simd-bb3f0d49847d5f65,liboutref-c83ec375ecf62c12,libvsimd-5cbd82f94125c6a6,libfancy_regex-d11fb54c91ac00d7,libbit_set-0ee784b9472a9e26,libbit_vec-45738dfdd44d120a,libemail_address-6f5ee3998a9edbf7,libfraction-a1a8f9b7d5c27b05,liblazy_static-0aeb88bcc2e3d662,libnum_cmp-c8fad974b14e04e1,libreferencing-c9c6db8602fb3ed6,libfluent_uri-e970ea4acfa64631,libborrow_or_share-a5a2f252111b68c2&#125;.rlib&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/&#123;libtest-*,libgetopts-*,libunicode_width-*,librustc_std_workspace_std-*&#125;.rlib&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/&#123;libblake3-7dd5ff8fef01e5db,libconstant_time_eq-4fa9b96eb7cef840,libarrayref-83025b7747475057,libopendal-5fb99e01659bf0da,libquick_xml-2a726846ed0b77c8,libreqsign-02438016364b1fd4,libhex-fbbed2810870e39e,libhome-b9d87c5140a51805,libsha2-a6835826c9bc8fce,libsha1-8f2e0fe7b8043ddd,libcpufeatures-69aa18d40df9d02d,libhmac-b419e6aa0f87987b,libreqwest-8dd681c75f772da9,libhyper_rustls-2ac018dc46dd3942,libwebpki_roots-e984893442cdc9cb,libtokio_rustls-8fd037e35f978f21,librustls-9de24b5a794bb3e6,libwebpki-471800d671557465,libring-2bccc933dbdc7831,libuntrusted-50ea818375ed8b6b,librustls_pki_types-63588602b5356c3c,libzeroize-84b9e390cb3b2ce7,libserde_urlencoded-8fb4b2858d139ab2,libtower_http-ba8c76ed943aff1f,libiri_string-be77eb48b0dd18d7,libtower-03506a7144375102,libtower_layer-58bbf4e5492fefb4,libhyper_util-c8f54a2132bc4c90,libipnet-856ee1c52243b1ef,libhyper-ec2ba3f3ffc392b6,libwant-ccae98356ec19395,libtry_lock-9ed3f89773057675,libatomic_waker-93d4097655d001c5,libhttp_body_util-b841ad22673700f3,liburl-ffd43874b94bc1b1,libidna-16a375d8ec8b433b,libutf8_iter-d47e0c5887c2fee5,libidna_adapter-0bdb7cf28e38733d,libicu_properties-dcf335287fb53c38,libicu_properties_data-ef8f86fdfbcc0e0e,libicu_normalizer-50ee150a59eead80,libicu_normalizer_data-39e9a9fa20f7672d,libicu_collections-20fc61c1dfeefcd0,libpotential_utf-47ef1a08876992b2,libicu_provider-aed8a73499001d21,libicu_locale_core-49e8c067c2d83c01,libtinystr-2cf2777381234737,liblitemap-bc100b32c3f97fac,libwriteable-a52f6d98e9661a1a,libzerovec-597d45153ac865a7,libzerotrie-218f59a7cfea8e78,libyoke-fcff048bcc363888,libstable_deref_trait-017ced0fa0571f24,libzerofrom-ac19be1ca0dfc650,libform_urlencoded-bd0d0fbbafd906ce,libsync_wrapper-55a890af0295b61d,libuuid-0b66264e995123c1,libmd5-6eccc4d1e631f5a6,libdigest-10395b78375d1f22,libsubtle-23bbe7a6e0b68b65,libconst_oid-370fbf126c15b32d,libblock_buffer-e56da7547172d3f4,libcrypto_common-e0e228f8488d58de,libgeneric_array-7e23144c5c814a34,libtypenum-152f75a5de6f7595,libhttp_body-053cb9e3f8ed3998,libbackon-233256edcef81425,libduckdb-95603ea9f150e109,libcast-23c2d92181e4be65,librust_decimal-3a376e9eda03cbc8,libarrayvec-8dd224ed0246c278,libfallible_streaming_iterator-9cdaf58f18b7d270,libfallible_iterator-17e4eb4eb537d2df,libstrum-f004b271180ce62e,libarrow-e26ae7adc15735eb,libarrow_row-760ac79c4d87d72a,libarrow_string-aaecd9e5edee204c,libregex-f77a3b2038129dbb,libregex_automata-8c19a88e8ad2ac66,libaho_corasick-0ed81590f2ae18b2,libregex_syntax-6318a9bbcc70ced8,libarrow_cast-e0ce1c0c5a5d9dc0,libatoi-667e8fb5c0f7cc28,libbase64-5aabd82bcf109ae7,libcomfy_table-69681f41ade57e39,libunicode_width-535dbec589893981,libstrum-8b8379ce8ef4445c,liblexical_core-1264b85422e3b2f0,liblexical_write_float-3ee841bd625feb66,liblexical_write_integer-468ac8f136f41133,liblexical_parse_float-9af0b2e51353789e,liblexical_parse_integer-689c92091f66a68f,liblexical_util-3dc2d2ef1665e293,libarrow_arith-0a30238d3f424d4d,libarrow_ord-31adcb1135aea171,libarrow_select-0b5465830701d4f2,libarrow_array-b499d37295fbb251,libahash-91420521ef482c9a,libarrow_data-c7f07ee3675e2ee1,libarrow_schema-0f5c678e7d8ab040,libarrow_buffer-4d94fdf5a9c84fd8,libhalf-2cec35d15a3ba3a6,libnum-e31c77d560b6ed7e,libnum_iter-3bf292bd3a0b1ea4,libnum_rational-2f326e8f05386278,libnum_complex-3893fceabc412a37,libnum_bigint-7bfd5f2b4b0eae53,libnum_integer-2bc708a80e89d54d,liblibduckdb_sys-d2f9a4a2654aa606,libcrossbeam_channel-4a74ef3461b2451a,libcrossbeam_utils-b7dcd0e43924ba99,libdotenvy-fa31cbed99044194,libnanoid-369636c001a90ae4,librand-f7b13ee099f478c1,librand_chacha-ee16fdd86986addd,libppv_lite86-40603323d9bc0c77,libzerocopy-03d72ed3ef7ec978,librand_core-3f4bc136a9f8484b,libgetrandom-2244fa2595ff2ae5,libmockall-57000000ec03b54a,libpredicates_tree-fe4e274869d64127,libtermtree-b2cbb17b0c17fe59,libpredicates-5ffee91d19bdc757,libanstyle-65570d73b831b970,libpredicates_core-cdd3de0a0cc9c035,libfragile-6960d9b3dde335f1,libdowncast-ce412692fd2fad81,libdiesel-2e77d666e64ef451,libbyteorder-488d2f8c43033f2b,libr2d2-7047a2af7716e7e4,libscheduled_thread_pool-b7560a0f27b10c8b,libdowncast_rs-d956fda7291209d2,libpq_sys-613af9466fab2839,libchrono-2851518c3a894a06,libiana_time_zone-bed1638e18244077,libnum_traits-1b559d869beb4a95,libanyhow-b3ab1b3ee9153273,libconfig-b3f3a9edc1412b20,libpathdiff-2077368ba25a7e35,libjson5-bb97d519c5a16250,libpest-b5e01d7e0f8b9acc,libucd_trie-f7c5d35f723550c4,libserde_untagged-4a6c6bcb80d21995,liberased_serde-addc3b85e7772f16,libtypeid-159a1644fa1de970,libron-eda3421753d935b1,libbase64-0aaa390cbd040b05,libtoml-11d123cbace28d1f,libtoml_parser-84870e95f74b4dab,libserde_spanned-aa5879e78c196976,libtoml_datetime-70432bb51aa8c02f,libini-41fe15a0b123963d,libordered_multimap-d7df216402c6ef24,libhashbrown-636f0ae3866e6f51,libdlv_list-ab975e9b23150c72,libyaml_rust2-35f01721fb7d1a41,libarraydeque-9874e418356542b1,libhashlink-34f8ccc830689adc,libhashbrown-7cc99169ca7078db,libfoldhash-113770b6792d23fa,libconvert_case-98659eae1c820f18,libunicode_segmentation-b4ff539827683099,librocket-1e5fd66656b5db40,libnum_cpus-6387fee21d1a0ad8,libtempfile-8074f510846ee675,libgetrandom-2ce7e6772d0c2425,libfastrand-63c674c69accf2ad,librustix-c9b2c583ad8755a3,libbitflags-afc9ce5c1d0c623b,liblinux_raw_sys-9a541f4ad566f31f,libserde_json-3d64847e6513f4f1,libryu-21bbdb07b7fa6bff,librocket_http-8a3a24add199c040,libcookie-6f1bfbfc26c971ee,libstable_pattern-bece7a67d83edd81,libref_cast-91d5091170254cf5,libpercent_encoding-ad967e46737740dd,libhyper-bc3ee1bb594b9cef,libsocket2-7ef03947986246ee,libh2-5244c0590e467da7,libtower_service-68697946deac773c,libtracing-d1be752364854f9a,libtracing_core-0a0894d85926a626,libonce_cell-918b1d32890f5f9e,libhttp_body-fecb75fabf17fd50,libhttpdate-9c38e1c21d90a8e0,libhttp-255fd2d49b9c9b98,libmulter-dc063061b16b8c25,libmime-3c061a1728c96449,libtokio_util-e05c9aed2d20433d,libhttparse-f765f69e51c8e6db,libspin-5ee876b9442aaf34,libencoding_rs-524161b9015a3f42,libhttp-904eaef600962caf,libfnv-4bf9ac57e0281eeb,libeither-89c65796d86a9c5f,libtokio_stream-8da1b17b994df557,libatomic-66cbc3942dd4d353,libstate-4f6b7fdcfbc81fcb,libparking_lot-dac38b95d2132e90,libparking_lot_core-cdb53501ce5dd3d3,libcfg_if-60f5305215eca12c,libsmallvec-d53022e7c549079b,liblock_api-56202e6727c2ce82,libscopeguard-eba723b2b8e43bcd,libubyte-8238217ac05a6acf,liblog-aad30686f737d430,libtime-cb5617d4825c11e4,libitoa-40fdb2a09307e577,libtime_core-be06e82fde38b763,libnum_conv-a1775535d8d4be76,libderanged-7bd7c8530ef0dc97,libpowerfmt-89450eb64bb1f678,libfigment-7d55d05e23e020cd,libtoml-9ce9d12b8941fe4b,libtoml_edit-8361924b848be875,libserde_spanned-3ab11f909bb27821,libindexmap-f412c1254fe67957,libequivalent-efa3f710fdf26075,libhashbrown-6a661c2b0deea163,libwinnow-5a7f45c1a3478eaf,libtoml_write-82dc00e761d89a9f,libtoml_datetime-fd870c4ed5df893a,libuncased-6be05f8539468c86,libpear-6a8df34eb094490e,libinlinable_string-56d105fc07a37f0d,libserde-fff0f7d1cc17c00b,libserde_core-41a3274965227519,libtokio-6d23371785a8c671,libsignal_hook_registry-19c82e32b9ed1172,libsocket2-f423ee368e086efe,libbytes-b337d0e4a1d885b9,libmio-ca722db78bb7e719,libfutures-59583a8e3cbe66be,libfutures_executor-0cad4b417028c71c,libfutures_util-5e047ee12fcb02b3,libmemchr-ccc31091145e243c,libfutures_io-4d3aa44137d734c5,libslab-95d912b52b35c49c,libfutures_channel-33102af0aaf9dea2,libfutures_sink-7c593bcd15c8e07a,libfutures_task-abd7a6a3eeb97385,libpin_utils-a287e5d51f28dc7e,libasync_stream-0fbb92eebe43219d,libpin_project_lite-c14b565038496e22,libfutures_core-a0306a7584cf855d,libyansi-584d76a9158e288b,libis_terminal-7542f11ce0673d82,liblibc-575f2dcbb5441d05&#125;.rlib&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/&#123;libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*&#125;.rlib&quot; &quot;-Wl,-Bdynamic&quot; &quot;-lstdc++&quot; &quot;-lpq&quot; &quot;-lgcc_s&quot; &quot;-lutil&quot; &quot;-lrt&quot; &quot;-lpthread&quot; &quot;-lm&quot; &quot;-ldl&quot; &quot;-lc&quot; &quot;-L&quot; &quot;/tmp/rustcJw9CYQ/raw-dylibs&quot; &quot;-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld&quot; &quot;-fuse-ld=lld&quot; &quot;-Wl,--eh-frame-hdr&quot; &quot;-Wl,-z,noexecstack&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/blake3-c020cd84003e629c/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/blake3-c020cd84003e629c/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/libduckdb-sys-b01f71e00958eae1/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/ring-3e41e38a32e34795/out&quot; &quot;-L&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-o&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/swan_lake-ed37ca88dbfde654&quot; &quot;-Wl,--gc-sections&quot; &quot;-pie&quot; &quot;-Wl,-z,relro,-z,now&quot; &quot;-nodefaultlibs&quot;</span><br><span class="line">  = note: some arguments are omitted. use `--verbose` to show all linker arguments</span><br><span class="line">  = note: rust-lld: error: unable to find library -lpq</span><br><span class="line">          collect2: error: ld returned 1 exit status</span><br><span class="line">          </span><br></pre></td></tr></table></figure>
<p>需要安装一个 <code>libpq-dev</code> 库:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y libpq-dev</span><br></pre></td></tr></table></figure>
<p>现在终于可以运行成功了!🥰</p>
<h3 id="总结">总结</h3>
<p>缓存还是上传的github云端, 还是受到容量限制, 并没有解决我们的痛点, 下次行动前应该多调研一下😇</p>
<p><strong>存在问题</strong>:</p>
<ol>
<li>
<p>环境不一定<strong>匹配</strong>, 不一定能够<strong>无缝迁移</strong>, 需要自己进行一些额外配置</p>
</li>
<li>
<p>缓存不能存在<strong>本地</strong>, 需要上传云端(这里就很难受, 还是受到10G容量的限制, 并且上传受到带宽限制, 十分耗时)</p>
</li>
</ol>
<p><strong>自托管服务器适合的场景</strong>:</p>
<ol>
<li>
<p>项目体量大, 每天在CI上的耗时很长, 需要自托管服务器来<strong>降本</strong>. 因为Github提供的<strong>免费运行时</strong>是2000分钟(个人免费用户), 超过之后按量计费, 价格还是比较高的.</p>
</li>
<li>
<p>项目对于性能或者网络等配置有<strong>特定要求</strong></p>
</li>
</ol>
<p>所以说对于个人开发者和小项目基本没必要上自托管服务器, 直接用Github提供的就行了, 省时省力.</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Github Action 自托管服务器踩坑记录</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.levitategu.cn/2025/10/16/GAS/">https://www.levitategu.cn/2025/10/16/GAS/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>levitategu</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2025-10-16</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-10-19</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CI/">CI</a><a class="post-meta__tags" href="/tags/Github-Action/">Github Action</a></div><div class="post_share"><div class="social-share" data-image="https://pb01.s3.bitiful.net/31.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2025/10/12/terrafrom-txy/" title="Terraform初体验:配置腾讯云CVM"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/386.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Terraform初体验:配置腾讯云CVM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2025/08/13/CI_Makefile/" title="CI配置时使用Makefile有哪些好处?"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bitiful.net/pb01/375.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-13</div><div class="title">CI配置时使用Makefile有哪些好处?</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">levitategu</div><div class="author-info__description">不惑于物，不役于流</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">45</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Marvel-Gu"><i class="icon-github"></i><span>🛴前往小家...</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Marvel-Gu" target="_blank" title="Github"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github"></use></svg></a><a class="social-icon faa-parent animated-hover" href="mailto:levitategu@gmail.com" target="_blank" title="Email"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangsufeng_youxiang"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:25px;width:20px;fill:currentColor;position:relative;top:2px" aria-hidden="true"><use xlink:href="#icon-gonggao"></use></svg></a><span>公告栏</span></div><div class="announcement_content"><center><b>--- 主线路 ---<br><a href="https://www.levitategu.cn" title="此线路部署于阿里云" class="anno_content"><font color="#5ea6e5">www.levitategu.cn</font></a><br>--- 备用线路 ---<br><a target="_blank" rel="noopener" href="https://levitategu.cn" title="此线路部署于Vercel" class="anno_content"><font color="#5ea6e5">levitategu.cn</font></a><br>🍧🍧🍧🍧🍧🍧</b></center></div><div id="welcome-info"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Github-Action-%E8%87%AA%E6%89%98%E7%AE%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95"><span class="toc-text">Github Action 自托管服务器踩坑记录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B"><span class="toc-text">配置过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By levitategu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="/img/ICP.png">Butterfly</a></div><div class="framework-info"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">苏ICP备2023035675号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function getGiscusTheme (theme) {
  return theme === 'dark' ? 'dark' : 'light'
}

function loadGiscus () {
  const config = Object.assign({
    src: 'https://giscus.app/client.js',
    'data-repo': 'Marvel-Gu/Marvel-Gu.github.io',
    'data-repo-id': 'R_kgDOKX62Gg',
    'data-category-id': 'Announcements',
    'data-mapping': 'pathname',
    'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
    'data-reactions-enabled': '1',
    crossorigin: 'anonymous',
    async: true
  },null)

  let ele = document.createElement('script')
  for (let key in config) {
    ele.setAttribute(key, config[key])
  }
  document.getElementById('giscus-wrap').insertAdjacentElement('afterbegin',ele)
}

function changeGiscusTheme (theme) {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame')
    if (!iframe) return
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app')
  }

  sendMessage({
    setConfig: {
      theme: getGiscusTheme(theme)
    }
  });
}

btf.addModeChange('giscus', changeGiscusTheme)

if ('Giscus' === 'Giscus' || !false) {
  if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
  else loadGiscus()
} else {
  function loadOtherComment () {
    loadGiscus()
  }
}</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script async src="//at.alicdn.com/t/c/font_4273027_707z3cmeova.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="50" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></html>