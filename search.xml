<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Github Action è‡ªæ‰˜ç®¡æœåŠ¡å™¨è¸©å‘è®°å½•</title>
      <link href="/2025/10/16/GAS/"/>
      <url>/2025/10/16/GAS/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Github-Action-è‡ªæ‰˜ç®¡æœåŠ¡å™¨è¸©å‘è®°å½•">Github Action è‡ªæ‰˜ç®¡æœåŠ¡å™¨è¸©å‘è®°å½•</h2><p>æˆ‘ä»¬çš„ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ <code>Github Action</code> æ¥è¿›è¡Œ <code>CI/CD</code>, æˆ‘ä»¬çš„ç—›ç‚¹åœ¨äº <code>Github Action</code> æä¾›çš„ç¼“å­˜å­˜å‚¨é™åˆ¶åœ¨10G, è€Œæˆ‘ä»¬æŸä¸ª job çš„ç¼“å­˜æ¯”è¾ƒå¤§, å¤§çº¦æ˜¯ 3.6G, å†åŠ ä¸Šåˆ«çš„ç¼“å­˜, å¯¼è‡´å­˜å‚¨ç©ºé—´ä¸å¤Ÿ, æœ€ç»ˆå¯¼è‡´CIè¿è¡Œå¤±è´¥. æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›æ„å»ºè‡ªæ‰˜ç®¡æœåŠ¡å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜. å…¶å®ä¸€å¼€å§‹è€ƒè™‘çš„æ˜¯èƒ½ä¸èƒ½å‡çº§é…ç½®, ä½†æ˜¯æ²¡æ‰¾åˆ°èƒ½å‡çº§ç¼“å­˜å­˜å‚¨å¤§å°çš„åŠæ³•.</p><p>é—®é¢˜å¦‚å›¾:<br><img src="https://s3.bitiful.net/pb01/370.webp" alt="avatar"><br><img src="https://s3.bitiful.net/pb01/371.webp" alt="avatar"></p><h3 id="é…ç½®è¿‡ç¨‹">é…ç½®è¿‡ç¨‹</h3><ol><li>ä½¿ç”¨ <code>Terraform</code> é…ä¸€å°æœåŠ¡å™¨, ä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘, å…·ä½“é…ç½®å¦‚ä¸‹, å¯ä»¥å‚è€ƒ</li></ol><p><strong><a href="http://main.tf">main.tf</a></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">locals &#123;</span><br><span class="line">  vpc_id      = alicloud_vpc.vpc.id</span><br><span class="line">  vswitch_ids = [for vswitch in alicloud_vswitch.vswitch : vswitch.id]</span><br><span class="line">  image_id    = data.alicloud_images.images.images.0.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ VPC å†…ç½‘ ------------------------</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_vpc&quot; &quot;vpc&quot; &#123;</span><br><span class="line">  vpc_name    = var.name</span><br><span class="line">  cidr_block  = var.vpc_cidr</span><br><span class="line">  enable_ipv6 = true // å¼€å¯ IPV6</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_vswitch&quot; &quot;vswitch&quot; &#123;</span><br><span class="line">  count        = length(var.zones)</span><br><span class="line">  vswitch_name = &quot;vswitch-$&#123;count.index&#125;&quot;</span><br><span class="line">  cidr_block   = var.vswitch_cidrs[count.index]</span><br><span class="line">  vpc_id       = local.vpc_id</span><br><span class="line">  zone_id      = var.zones[count.index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ å®‰å…¨ç»„ -------------------------</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_security_group&quot; &quot;sg&quot; &#123;</span><br><span class="line">  security_group_name = var.name</span><br><span class="line">  description         = &quot;Security group for ECS&quot;</span><br><span class="line">  vpc_id              = local.vpc_id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;alicloud_security_group_rule&quot; &quot;allow_ssh&quot; &#123;</span><br><span class="line">  type              = &quot;ingress&quot;</span><br><span class="line">  ip_protocol       = &quot;tcp&quot;</span><br><span class="line">  port_range        = &quot;22/22&quot;</span><br><span class="line">  security_group_id = alicloud_security_group.sg.id</span><br><span class="line">  cidr_ip           = &quot;0.0.0.0/0&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------ æœåŠ¡å™¨é•œåƒ --------------------</span><br><span class="line"></span><br><span class="line">data &quot;alicloud_images&quot; &quot;images&quot; &#123;</span><br><span class="line">  owners     = &quot;system&quot;</span><br><span class="line">  os_type    = &quot;linux&quot;</span><br><span class="line">  name_regex = &quot;^ubuntu_22+_[0-9]+_x64*&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ------------------------ Runner æœåŠ¡å™¨ ----------------</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå¼¹æ€§ IP</span><br><span class="line">resource &quot;alicloud_eip&quot; &quot;eip&quot; &#123;</span><br><span class="line">  bandwidth            = &quot;20&quot;</span><br><span class="line">  internet_charge_type = &quot;PayByBandwidth&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»º SSH å¯†é’¥å¯¹</span><br><span class="line">resource &quot;alicloud_ecs_key_pair&quot; &quot;key_pair&quot; &#123;</span><br><span class="line">  key_name_prefix = var.name</span><br><span class="line">  public_key      = var.public_key_pair</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># åˆ›å»º ECS å®ä¾‹</span><br><span class="line">resource &quot;alicloud_instance&quot; &quot;runner&quot; &#123;</span><br><span class="line">  instance_name        = var.name</span><br><span class="line">  host_name            = &quot;&quot;     # åˆ äº†, éœ€è¦è‡ªå·±å¡«</span><br><span class="line">  image_id             = var.runner_image != &quot;&quot; ? var.runner_image : local.image_id</span><br><span class="line">  instance_type        = var.runner_instance_type</span><br><span class="line">  spot_strategy        = &quot;SpotAsPriceGo&quot;</span><br><span class="line">  security_groups      = [alicloud_security_group.sg.id]</span><br><span class="line">  key_name             = alicloud_ecs_key_pair.key_pair.key_pair_name</span><br><span class="line">  vswitch_id           = local.vswitch_ids[0]</span><br><span class="line">  system_disk_category = &quot;cloud_essd&quot;</span><br><span class="line">  system_disk_size     = 200</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ä¸º ECS å®ä¾‹ç»‘å®šå…¬ç½‘ IP</span><br><span class="line">resource &quot;alicloud_eip_association&quot; &quot;runner_eip&quot; &#123;</span><br><span class="line">  allocation_id = alicloud_eip.eip.id</span><br><span class="line">  instance_id   = alicloud_instance.runner.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><a href="http://provider.tf">provider.tf</a></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_providers &#123;</span><br><span class="line">    alicloud = &#123;</span><br><span class="line">      source  = &quot;aliyun/alicloud&quot;</span><br><span class="line">      version = &quot;1.258.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">provider &quot;alicloud&quot; &#123;</span><br><span class="line">  region = var.region</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://variables.tf">variables.tf</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;name&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;åç§°&quot;</span><br><span class="line">  default     = &quot;swan-lake-runner&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;region&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;åœ°åŸŸ&quot;</span><br><span class="line">  default     = &quot;cn-hongkong&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vpc_cidr&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;VPC ç½‘æ®µ&quot;</span><br><span class="line">  default     = &quot;192.168.0.0/16&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;vswitch_cidrs&quot; &#123;</span><br><span class="line">  type        = list(string)</span><br><span class="line">  description = &quot;å­ç½‘ç½‘æ®µ&quot;</span><br><span class="line">  default     = [&quot;192.168.0.0/20&quot;, &quot;192.168.16.0/20&quot;, &quot;192.168.32.0/20&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;zones&quot; &#123;</span><br><span class="line">  type        = list(string)</span><br><span class="line">  description = &quot;å¯ç”¨åŒº&quot;</span><br><span class="line">  default     = [&quot;cn-hongkong-b&quot;, &quot;cn-hongkong-c&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;public_key_pair&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;æœåŠ¡å™¨å…¬é’¥&quot;</span><br><span class="line">  default     = &quot;&quot;   # éœ€è¦è‡ªå·±å¡«</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;runner_image&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;runner æœåŠ¡å™¨å¯¹åº”çš„é•œåƒ&quot;</span><br><span class="line">  default     = &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;runner_instance_type&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;runner æœåŠ¡å™¨çš„å®ä¾‹è§„æ ¼&quot;</span><br><span class="line">  default     = &quot;ecs.u1-c1m2.2xlarge&quot; # é»˜è®¤ 8 æ ¸ 16 G</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æŒ‰ç…§è„šæœ¬é…ç½®æœåŠ¡å™¨</li></ol><p><code>github</code> ä¸Šé€‰å¥½æœåŠ¡å™¨ä¿¡æ¯å°±ä¼šæœ‰è„šæœ¬, æœåŠ¡å™¨ä¸Šæ–°å»ºä¸€ä¸ªç”¨æˆ· <code>levit</code> (<code>config.sh</code>ä¸èƒ½å†<code>sudo</code>æƒé™ä¸‹è¿è¡Œ), ç…§ç€é…ç½®å³å¯</p><p>å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Download</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a folder</span></span><br><span class="line">$ <span class="built_in">mkdir</span> actions-runner &amp;&amp; <span class="built_in">cd</span> actions-runner<span class="comment"># Download the latest runner package</span></span><br><span class="line">$ curl -o actions-runner-linux-x64-2.328.0.tar.gz -L https://github.com/actions/runner/releases/download/v2.328.0/actions-runner-linux-x64-2.328.0.tar.gz</span><br><span class="line">Copied!</span><br><span class="line"><span class="comment"># Optional: Validate the hash</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;01066fad3a2893e63e6ca880ae3a1fad5bf9329d60e77ee15f2b97c148c3cd4e  actions-runner-linux-x64-2.328.0.tar.gz&quot;</span> | shasum -a 256 -c<span class="comment"># Extract the installer</span></span><br><span class="line">$ tar xzf ./actions-runner-linux-x64-2.328.0.tar.gz</span><br><span class="line">Configure</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the runner and start the configuration experience</span></span><br><span class="line">$ ./config.sh --url &#123;é¡¹ç›®åœ°å€&#125; --token &#123;token, ä¸€å°æ—¶è¿‡æœŸ&#125;<span class="comment"># Last step, run it!</span></span><br><span class="line">$ ./run.sh</span><br><span class="line"></span><br><span class="line">Using your self-hosted runner</span><br><span class="line"><span class="comment"># Use this YAML in your workflow file for each job</span></span><br><span class="line">runs-on: self-hosted</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å°†å…¶æ³¨å†Œä¸ºæœåŠ¡, ä½¿ç”¨<code>svc.sh</code>è¿™ä¸ªè„šæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/levit/actions-runner</span><br><span class="line">sudo ./svc.sh install levit</span><br><span class="line">sudo ./svc.sh start</span><br></pre></td></tr></table></figure><ol start="3"><li>æµ‹è¯•è¿è¡Œ</li></ol><p>ç›´æ¥ç”¨åŸå…ˆçš„é…ç½®æ–‡ä»¶, åªæ˜¯å°†æœåŠ¡å™¨é…ç½®æ”¹äº†</p><ul><li>å‡ºç°é—®é¢˜, æ²¡æœ‰<code>docker</code>, åŸå› æ˜¯æˆ‘ä»¬çš„CIæ‹‰äº†ä¸€ä¸ª <code>postgresql</code> çš„é•œåƒ, è¿™é‡Œå°±ä½“ç°å‡ºè‡ªæ‰˜ç®¡çš„ç¬¬ä¸€ä¸ªé—®é¢˜, <strong>ä¸èƒ½æ— ç¼è¿ç§»</strong></li></ul><p><img src="https://s3.bitiful.net/pb01/372.webp" alt="avatar"></p><ul><li>äºæ˜¯å…ˆå®‰è£…Docker, å®‰è£…å®Œä¹‹å, è¿˜æ˜¯å¤±è´¥:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-  Stop containers</span><br><span class="line"></span><br><span class="line">Value cannot be null. (Parameter &#x27;network&#x27;)</span><br><span class="line"></span><br><span class="line">- Initialize containers</span><br><span class="line"></span><br><span class="line">Exit code 1 returned from process: file name &#x27;/usr/bin/docker&#x27;, arguments &#x27;version --format &#x27;&#123;&#123;.Server.APIVersion&#125;&#125;&#x27;&#x27;. </span><br></pre></td></tr></table></figure><p>å…¶å®æœ‰ç‚¹å¥‡æ€ª, æˆ‘å·²ç»å°†ç”¨æˆ·æ”¾åˆ°äº†Dockerç»„é‡Œ, ä½†æ²¡å…³ç³», æˆ‘ç›´æ¥ä¿®æ”¹ <code>docker.sock</code> æƒé™, å°†å…¶è®¾ç½®ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»å¯å†™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br><span class="line">@reboot <span class="built_in">chmod</span> 666 /var/run/docker.sock</span><br></pre></td></tr></table></figure><ul><li>æ¥ç€è¿è¡Œ, æ²¡æœ‰æƒé™é”™è¯¯äº†, ä½†è¿˜æ˜¯æŠ¥é”™:</li></ul><p><img src="https://s3.bitiful.net/pb01/373.webp" alt="avatar"></p><p>éœ€è¦ä¸ºæŸä¸ªjobé…ç½®cargoç¯å¢ƒ, è¿™é‡Œä¹Ÿä½“ç°å‡ºäº†<strong>ä¸èƒ½æ— ç¼è¿ç§»</strong>çš„é—®é¢˜:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Rust</span> <span class="string">toolchain</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">dtolnay/rust-toolchain@stable</span></span><br></pre></td></tr></table></figure><ul><li>æ¥ç€ç»§ç»­rerun, è¿˜æ˜¯æŠ¥é”™:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">error: linking with cc failed: exit status: 1</span><br><span class="line"></span><br><span class="line">  |</span><br><span class="line">  = note:  &quot;cc&quot; &quot;-m64&quot; &quot;/tmp/rustcJw9CYQ/symbols.o&quot; &quot;&lt;17 object files omitted&gt;&quot; &quot;-Wl,--as-needed&quot; &quot;-Wl,-Bstatic&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/&#123;libjsonschema-290691234c978af9,libbytecount-2256add9d3494a3e,libuuid_simd-bb3f0d49847d5f65,liboutref-c83ec375ecf62c12,libvsimd-5cbd82f94125c6a6,libfancy_regex-d11fb54c91ac00d7,libbit_set-0ee784b9472a9e26,libbit_vec-45738dfdd44d120a,libemail_address-6f5ee3998a9edbf7,libfraction-a1a8f9b7d5c27b05,liblazy_static-0aeb88bcc2e3d662,libnum_cmp-c8fad974b14e04e1,libreferencing-c9c6db8602fb3ed6,libfluent_uri-e970ea4acfa64631,libborrow_or_share-a5a2f252111b68c2&#125;.rlib&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/&#123;libtest-*,libgetopts-*,libunicode_width-*,librustc_std_workspace_std-*&#125;.rlib&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/&#123;libblake3-7dd5ff8fef01e5db,libconstant_time_eq-4fa9b96eb7cef840,libarrayref-83025b7747475057,libopendal-5fb99e01659bf0da,libquick_xml-2a726846ed0b77c8,libreqsign-02438016364b1fd4,libhex-fbbed2810870e39e,libhome-b9d87c5140a51805,libsha2-a6835826c9bc8fce,libsha1-8f2e0fe7b8043ddd,libcpufeatures-69aa18d40df9d02d,libhmac-b419e6aa0f87987b,libreqwest-8dd681c75f772da9,libhyper_rustls-2ac018dc46dd3942,libwebpki_roots-e984893442cdc9cb,libtokio_rustls-8fd037e35f978f21,librustls-9de24b5a794bb3e6,libwebpki-471800d671557465,libring-2bccc933dbdc7831,libuntrusted-50ea818375ed8b6b,librustls_pki_types-63588602b5356c3c,libzeroize-84b9e390cb3b2ce7,libserde_urlencoded-8fb4b2858d139ab2,libtower_http-ba8c76ed943aff1f,libiri_string-be77eb48b0dd18d7,libtower-03506a7144375102,libtower_layer-58bbf4e5492fefb4,libhyper_util-c8f54a2132bc4c90,libipnet-856ee1c52243b1ef,libhyper-ec2ba3f3ffc392b6,libwant-ccae98356ec19395,libtry_lock-9ed3f89773057675,libatomic_waker-93d4097655d001c5,libhttp_body_util-b841ad22673700f3,liburl-ffd43874b94bc1b1,libidna-16a375d8ec8b433b,libutf8_iter-d47e0c5887c2fee5,libidna_adapter-0bdb7cf28e38733d,libicu_properties-dcf335287fb53c38,libicu_properties_data-ef8f86fdfbcc0e0e,libicu_normalizer-50ee150a59eead80,libicu_normalizer_data-39e9a9fa20f7672d,libicu_collections-20fc61c1dfeefcd0,libpotential_utf-47ef1a08876992b2,libicu_provider-aed8a73499001d21,libicu_locale_core-49e8c067c2d83c01,libtinystr-2cf2777381234737,liblitemap-bc100b32c3f97fac,libwriteable-a52f6d98e9661a1a,libzerovec-597d45153ac865a7,libzerotrie-218f59a7cfea8e78,libyoke-fcff048bcc363888,libstable_deref_trait-017ced0fa0571f24,libzerofrom-ac19be1ca0dfc650,libform_urlencoded-bd0d0fbbafd906ce,libsync_wrapper-55a890af0295b61d,libuuid-0b66264e995123c1,libmd5-6eccc4d1e631f5a6,libdigest-10395b78375d1f22,libsubtle-23bbe7a6e0b68b65,libconst_oid-370fbf126c15b32d,libblock_buffer-e56da7547172d3f4,libcrypto_common-e0e228f8488d58de,libgeneric_array-7e23144c5c814a34,libtypenum-152f75a5de6f7595,libhttp_body-053cb9e3f8ed3998,libbackon-233256edcef81425,libduckdb-95603ea9f150e109,libcast-23c2d92181e4be65,librust_decimal-3a376e9eda03cbc8,libarrayvec-8dd224ed0246c278,libfallible_streaming_iterator-9cdaf58f18b7d270,libfallible_iterator-17e4eb4eb537d2df,libstrum-f004b271180ce62e,libarrow-e26ae7adc15735eb,libarrow_row-760ac79c4d87d72a,libarrow_string-aaecd9e5edee204c,libregex-f77a3b2038129dbb,libregex_automata-8c19a88e8ad2ac66,libaho_corasick-0ed81590f2ae18b2,libregex_syntax-6318a9bbcc70ced8,libarrow_cast-e0ce1c0c5a5d9dc0,libatoi-667e8fb5c0f7cc28,libbase64-5aabd82bcf109ae7,libcomfy_table-69681f41ade57e39,libunicode_width-535dbec589893981,libstrum-8b8379ce8ef4445c,liblexical_core-1264b85422e3b2f0,liblexical_write_float-3ee841bd625feb66,liblexical_write_integer-468ac8f136f41133,liblexical_parse_float-9af0b2e51353789e,liblexical_parse_integer-689c92091f66a68f,liblexical_util-3dc2d2ef1665e293,libarrow_arith-0a30238d3f424d4d,libarrow_ord-31adcb1135aea171,libarrow_select-0b5465830701d4f2,libarrow_array-b499d37295fbb251,libahash-91420521ef482c9a,libarrow_data-c7f07ee3675e2ee1,libarrow_schema-0f5c678e7d8ab040,libarrow_buffer-4d94fdf5a9c84fd8,libhalf-2cec35d15a3ba3a6,libnum-e31c77d560b6ed7e,libnum_iter-3bf292bd3a0b1ea4,libnum_rational-2f326e8f05386278,libnum_complex-3893fceabc412a37,libnum_bigint-7bfd5f2b4b0eae53,libnum_integer-2bc708a80e89d54d,liblibduckdb_sys-d2f9a4a2654aa606,libcrossbeam_channel-4a74ef3461b2451a,libcrossbeam_utils-b7dcd0e43924ba99,libdotenvy-fa31cbed99044194,libnanoid-369636c001a90ae4,librand-f7b13ee099f478c1,librand_chacha-ee16fdd86986addd,libppv_lite86-40603323d9bc0c77,libzerocopy-03d72ed3ef7ec978,librand_core-3f4bc136a9f8484b,libgetrandom-2244fa2595ff2ae5,libmockall-57000000ec03b54a,libpredicates_tree-fe4e274869d64127,libtermtree-b2cbb17b0c17fe59,libpredicates-5ffee91d19bdc757,libanstyle-65570d73b831b970,libpredicates_core-cdd3de0a0cc9c035,libfragile-6960d9b3dde335f1,libdowncast-ce412692fd2fad81,libdiesel-2e77d666e64ef451,libbyteorder-488d2f8c43033f2b,libr2d2-7047a2af7716e7e4,libscheduled_thread_pool-b7560a0f27b10c8b,libdowncast_rs-d956fda7291209d2,libpq_sys-613af9466fab2839,libchrono-2851518c3a894a06,libiana_time_zone-bed1638e18244077,libnum_traits-1b559d869beb4a95,libanyhow-b3ab1b3ee9153273,libconfig-b3f3a9edc1412b20,libpathdiff-2077368ba25a7e35,libjson5-bb97d519c5a16250,libpest-b5e01d7e0f8b9acc,libucd_trie-f7c5d35f723550c4,libserde_untagged-4a6c6bcb80d21995,liberased_serde-addc3b85e7772f16,libtypeid-159a1644fa1de970,libron-eda3421753d935b1,libbase64-0aaa390cbd040b05,libtoml-11d123cbace28d1f,libtoml_parser-84870e95f74b4dab,libserde_spanned-aa5879e78c196976,libtoml_datetime-70432bb51aa8c02f,libini-41fe15a0b123963d,libordered_multimap-d7df216402c6ef24,libhashbrown-636f0ae3866e6f51,libdlv_list-ab975e9b23150c72,libyaml_rust2-35f01721fb7d1a41,libarraydeque-9874e418356542b1,libhashlink-34f8ccc830689adc,libhashbrown-7cc99169ca7078db,libfoldhash-113770b6792d23fa,libconvert_case-98659eae1c820f18,libunicode_segmentation-b4ff539827683099,librocket-1e5fd66656b5db40,libnum_cpus-6387fee21d1a0ad8,libtempfile-8074f510846ee675,libgetrandom-2ce7e6772d0c2425,libfastrand-63c674c69accf2ad,librustix-c9b2c583ad8755a3,libbitflags-afc9ce5c1d0c623b,liblinux_raw_sys-9a541f4ad566f31f,libserde_json-3d64847e6513f4f1,libryu-21bbdb07b7fa6bff,librocket_http-8a3a24add199c040,libcookie-6f1bfbfc26c971ee,libstable_pattern-bece7a67d83edd81,libref_cast-91d5091170254cf5,libpercent_encoding-ad967e46737740dd,libhyper-bc3ee1bb594b9cef,libsocket2-7ef03947986246ee,libh2-5244c0590e467da7,libtower_service-68697946deac773c,libtracing-d1be752364854f9a,libtracing_core-0a0894d85926a626,libonce_cell-918b1d32890f5f9e,libhttp_body-fecb75fabf17fd50,libhttpdate-9c38e1c21d90a8e0,libhttp-255fd2d49b9c9b98,libmulter-dc063061b16b8c25,libmime-3c061a1728c96449,libtokio_util-e05c9aed2d20433d,libhttparse-f765f69e51c8e6db,libspin-5ee876b9442aaf34,libencoding_rs-524161b9015a3f42,libhttp-904eaef600962caf,libfnv-4bf9ac57e0281eeb,libeither-89c65796d86a9c5f,libtokio_stream-8da1b17b994df557,libatomic-66cbc3942dd4d353,libstate-4f6b7fdcfbc81fcb,libparking_lot-dac38b95d2132e90,libparking_lot_core-cdb53501ce5dd3d3,libcfg_if-60f5305215eca12c,libsmallvec-d53022e7c549079b,liblock_api-56202e6727c2ce82,libscopeguard-eba723b2b8e43bcd,libubyte-8238217ac05a6acf,liblog-aad30686f737d430,libtime-cb5617d4825c11e4,libitoa-40fdb2a09307e577,libtime_core-be06e82fde38b763,libnum_conv-a1775535d8d4be76,libderanged-7bd7c8530ef0dc97,libpowerfmt-89450eb64bb1f678,libfigment-7d55d05e23e020cd,libtoml-9ce9d12b8941fe4b,libtoml_edit-8361924b848be875,libserde_spanned-3ab11f909bb27821,libindexmap-f412c1254fe67957,libequivalent-efa3f710fdf26075,libhashbrown-6a661c2b0deea163,libwinnow-5a7f45c1a3478eaf,libtoml_write-82dc00e761d89a9f,libtoml_datetime-fd870c4ed5df893a,libuncased-6be05f8539468c86,libpear-6a8df34eb094490e,libinlinable_string-56d105fc07a37f0d,libserde-fff0f7d1cc17c00b,libserde_core-41a3274965227519,libtokio-6d23371785a8c671,libsignal_hook_registry-19c82e32b9ed1172,libsocket2-f423ee368e086efe,libbytes-b337d0e4a1d885b9,libmio-ca722db78bb7e719,libfutures-59583a8e3cbe66be,libfutures_executor-0cad4b417028c71c,libfutures_util-5e047ee12fcb02b3,libmemchr-ccc31091145e243c,libfutures_io-4d3aa44137d734c5,libslab-95d912b52b35c49c,libfutures_channel-33102af0aaf9dea2,libfutures_sink-7c593bcd15c8e07a,libfutures_task-abd7a6a3eeb97385,libpin_utils-a287e5d51f28dc7e,libasync_stream-0fbb92eebe43219d,libpin_project_lite-c14b565038496e22,libfutures_core-a0306a7584cf855d,libyansi-584d76a9158e288b,libis_terminal-7542f11ce0673d82,liblibc-575f2dcbb5441d05&#125;.rlib&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib/&#123;libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*&#125;.rlib&quot; &quot;-Wl,-Bdynamic&quot; &quot;-lstdc++&quot; &quot;-lpq&quot; &quot;-lgcc_s&quot; &quot;-lutil&quot; &quot;-lrt&quot; &quot;-lpthread&quot; &quot;-lm&quot; &quot;-ldl&quot; &quot;-lc&quot; &quot;-L&quot; &quot;/tmp/rustcJw9CYQ/raw-dylibs&quot; &quot;-B&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/bin/gcc-ld&quot; &quot;-fuse-ld=lld&quot; &quot;-Wl,--eh-frame-hdr&quot; &quot;-Wl,-z,noexecstack&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/blake3-c020cd84003e629c/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/blake3-c020cd84003e629c/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/libduckdb-sys-b01f71e00958eae1/out&quot; &quot;-L&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/build/ring-3e41e38a32e34795/out&quot; &quot;-L&quot; &quot;&lt;sysroot&gt;/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;-o&quot; &quot;/home/levit/actions-runner/_work/swan-lake/swan-lake/target/debug/deps/swan_lake-ed37ca88dbfde654&quot; &quot;-Wl,--gc-sections&quot; &quot;-pie&quot; &quot;-Wl,-z,relro,-z,now&quot; &quot;-nodefaultlibs&quot;</span><br><span class="line">  = note: some arguments are omitted. use `--verbose` to show all linker arguments</span><br><span class="line">  = note: rust-lld: error: unable to find library -lpq</span><br><span class="line">          collect2: error: ld returned 1 exit status</span><br><span class="line">          </span><br></pre></td></tr></table></figure><p>éœ€è¦å®‰è£…ä¸€ä¸ª <code>libpq-dev</code> åº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y libpq-dev</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç»ˆäºå¯ä»¥è¿è¡ŒæˆåŠŸäº†!ğŸ¥°</p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ç¼“å­˜è¿˜æ˜¯ä¸Šä¼ çš„githubäº‘ç«¯, è¿˜æ˜¯å—åˆ°å®¹é‡é™åˆ¶, å¹¶æ²¡æœ‰è§£å†³æˆ‘ä»¬çš„ç—›ç‚¹, ä¸‹æ¬¡è¡ŒåŠ¨å‰åº”è¯¥å¤šè°ƒç ”ä¸€ä¸‹ğŸ˜‡</p><p><strong>å­˜åœ¨é—®é¢˜</strong>:</p><ol><li><p>ç¯å¢ƒä¸ä¸€å®š<strong>åŒ¹é…</strong>, ä¸ä¸€å®šèƒ½å¤Ÿ<strong>æ— ç¼è¿ç§»</strong>, éœ€è¦è‡ªå·±è¿›è¡Œä¸€äº›é¢å¤–é…ç½®</p></li><li><p>ç¼“å­˜ä¸èƒ½å­˜åœ¨<strong>æœ¬åœ°</strong>, éœ€è¦ä¸Šä¼ äº‘ç«¯(è¿™é‡Œå°±å¾ˆéš¾å—, è¿˜æ˜¯å—åˆ°10Gå®¹é‡çš„é™åˆ¶, å¹¶ä¸”ä¸Šä¼ å—åˆ°å¸¦å®½é™åˆ¶, ååˆ†è€—æ—¶)</p></li></ol><p><strong>è‡ªæ‰˜ç®¡æœåŠ¡å™¨é€‚åˆçš„åœºæ™¯</strong>:</p><ol><li><p>é¡¹ç›®ä½“é‡å¤§, æ¯å¤©åœ¨CIä¸Šçš„è€—æ—¶å¾ˆé•¿, éœ€è¦è‡ªæ‰˜ç®¡æœåŠ¡å™¨æ¥<strong>é™æœ¬</strong>. å› ä¸ºGithubæä¾›çš„<strong>å…è´¹è¿è¡Œæ—¶</strong>æ˜¯2000åˆ†é’Ÿ(ä¸ªäººå…è´¹ç”¨æˆ·), è¶…è¿‡ä¹‹åæŒ‰é‡è®¡è´¹, ä»·æ ¼è¿˜æ˜¯æ¯”è¾ƒé«˜çš„.</p></li><li><p>é¡¹ç›®å¯¹äºæ€§èƒ½æˆ–è€…ç½‘ç»œç­‰é…ç½®æœ‰<strong>ç‰¹å®šè¦æ±‚</strong></p></li></ol><p>æ‰€ä»¥è¯´å¯¹äºä¸ªäººå¼€å‘è€…å’Œå°é¡¹ç›®åŸºæœ¬æ²¡å¿…è¦ä¸Šè‡ªæ‰˜ç®¡æœåŠ¡å™¨, ç›´æ¥ç”¨Githubæä¾›çš„å°±è¡Œäº†, çœæ—¶çœåŠ›.</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI </tag>
            
            <tag> Github Action </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Terraformåˆä½“éªŒ:é…ç½®è…¾è®¯äº‘CVM</title>
      <link href="/2025/10/12/terrafrom-txy/"/>
      <url>/2025/10/12/terrafrom-txy/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Terraformåˆä½“éªŒ-é…ç½®è…¾è®¯äº‘CVM">Terraformåˆä½“éªŒ:é…ç½®è…¾è®¯äº‘CVM</h2><p>é¦–å…ˆæ˜ç¡®ç›®æ ‡ï¼šå­¦ä¹ Terrafom, å¹¶åœ¨è…¾è®¯äº‘ä¸ŠæˆåŠŸé…ç½®ä¸€å°CVM</p><h3 id="å®‰è£…Terraform">å®‰è£…Terraform</h3><p>ç›´æ¥å»<a href="https://developer.hashicorp.com/terraform/install">å®˜ç½‘Installé¡µé¢</a>æŒ‰ç…§æŒ‡ç¤ºå®‰è£…å³å¯</p><p>çœ‹çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">terraform  -version</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘çš„è¾“å‡º</span></span><br><span class="line">Terraform v1.13.3</span><br><span class="line">on windows_amd64</span><br></pre></td></tr></table></figure><h3 id="è·å–å‡­è¯">è·å–å‡­è¯</h3><p>å‰å¾€ <a href="https://console.cloud.tencent.com/cam/capi">äº‘ API å¯†é’¥é¡µé¢</a> ç”³è¯·å®‰å…¨å‡­è¯ SecretId å’Œ SecretKeyã€‚</p><ol><li>ç™»å½• è®¿é—®ç®¡ç†æ§åˆ¶å°ï¼Œåœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œé€‰æ‹©è®¿é—®å¯†é’¥ &gt; API å¯†é’¥ç®¡ç†ã€‚</li><li>åœ¨ API å¯†é’¥ç®¡ç†é¡µé¢ï¼Œå•å‡»æ–°å»ºå¯†é’¥ï¼Œå³å¯ä»¥åˆ›å»ºä¸€å¯¹ SecretId/SecretKeyã€‚</li></ol><p>å¯ä»¥æ–°å»ºä¸€ä¸ªå­ç”¨æˆ·ç„¶åå†æ¥åˆ›å»ºAPIå¯†é’¥</p><p>ä½¿ç”¨æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§, ä¸€ç§æ˜¯é™æ€å‡­è¯é‰´æƒ, ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­å†™å…¥, å¦ä¸€ç§æ˜¯ç¯å¢ƒå˜é‡é‰´æƒ, é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡æ¥è·å–, ä¸ºäº†æ¼”ç¤º, æˆ‘é€‰æ‹©é™æ€å‡­è¯é‰´æƒ</p><h3 id="é…ç½®Terraform">é…ç½®Terraform</h3><p>åŸºæœ¬ä½¿ç”¨æ–‡æ¡£å¯ä»¥å‚è€ƒ<a href="https://developer.hashicorp.com/terraform/language">å®˜æ–¹æ–‡æ¡£</a></p><p>è™½ç„¶è¯´æ‰€æœ‰é…ç½®éƒ½æ˜¯å¯ä»¥å†™åœ¨ä¸€ä¸ªmain.tfæ–‡ä»¶ä¸­, ä½†æ˜¯è¿™ä¸ç¬¦åˆ<strong>æœ€ä½³å®è·µ</strong>, ä¸ºäº†æ–¹ä¾¿ç®¡ç†, å®˜æ–¹å»ºè®®ä½¿ç”¨å¤šä¸ªæ–‡ä»¶æ¥ç®¡ç†é…ç½®, æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•æ¥ç®¡ç†æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶</p><p>å®˜æ–¹æ–‡æ¡£ä¸­å»ºè®®çš„æ–‡ä»¶å‘½åç»“æ„å¦‚ä¸‹:</p><ol><li><p><a href="http://backend.tf">backend.tf</a>: å®šä¹‰ Terraform å­˜å‚¨å…¶çŠ¶æ€æ•°æ®æ–‡ä»¶çš„ä½ç½®, å¦‚æœä¸é…ç½®, é»˜è®¤æ˜¯æœ¬åœ°å­˜å‚¨</p></li><li><p><a href="http://main.tf">main.tf</a>: åŒ…å«æ‰€æœ‰èµ„æºå’Œæ•°æ®æºå—, è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸»è¦é…ç½®çš„éƒ¨åˆ†</p></li><li><p><a href="http://outputs.tf">outputs.tf</a>: åŒ…å«æŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„æ‰€æœ‰è¾“å‡ºå—, å…¶å®å°±æ˜¯èµ„æºé…ç½®å¥½åå¯ä»¥å°†ä¸€äº›é‡è¦ä¿¡æ¯è¾“å‡ºåˆ°è¿™é‡Œ, æ–¹ä¾¿åç»­æŸ¥çœ‹</p></li><li><p><a href="http://providers.tf">providers.tf</a>: æ‰€æœ‰ provider å—å’Œé…ç½®, è¿™ä¸ªä¸€èˆ¬å°±æ˜¯å„ä¸ªæä¾›å•†çš„é…ç½®, æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå°±æ˜¯è…¾è®¯äº‘çš„é…ç½®</p></li><li><p><a href="http://terraform.tf">terraform.tf</a>: åŒ…å«ä¸€ä¸ªå®šä¹‰ required_version å’Œ required_providers å•ä¸ª terraform å—,</p></li><li><p><a href="http://variables.tf">variables.tf</a>: åŒ…å«æŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„æ‰€æœ‰å˜é‡å—, é…ç½®ä¸€äº›å‚æ•°, ä¸ç›´æ¥å†™åœ¨main.tfä¸­, è€Œæ˜¯é€šè¿‡å˜é‡æ¥é…ç½®</p></li><li><p><a href="http://locals.tf">locals.tf</a>: åŒ…å«æœ¬åœ°å€¼, å…¶å®é€šä¿—æ¥è¯´å°±æ˜¯åˆ«å, å¯ä»¥å°†ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ç®€åŒ–ä¸ºä¸€ä¸ªåˆ«å, ç„¶åç›´æ¥ä½¿ç”¨åˆ«åå³å¯</p></li><li><p><a href="http://override.tf">override.tf</a>: åŒ…å«é…ç½®çš„è¦†ç›–å®šä¹‰, ä½ å¯ä»¥ä¸ç”¨ä¿®æ”¹åŸæ–‡ä»¶, è€Œæ˜¯ç”¨è¿™ä¸ªæ–‡ä»¶æ¥è¦†ç›–åŸæ–‡ä»¶ä¸­çš„é…ç½®</p></li></ol><p>å¦‚æœé…ç½®ååˆ†å¤æ‚, è¿˜å¯ä»¥è¿›ä¸€æ­¥æ‹†åˆ†, æ·»åŠ æ¯”å¦‚è¯´: <a href="http://network.tf">network.tf</a>, <a href="http://storage.tf">storage.tf</a>, compute.tfç­‰æ¥ä½¿å¾—é…ç½®æ›´åŠ æ¸…æ™°</p><h4 id="å…·ä½“é…ç½®">å…·ä½“é…ç½®</h4><p>å¯ä»¥å‚è€ƒTerraformä¸Šè…¾è®¯äº‘çš„<a href="https://registry.terraform.io/providers/tencentcloudstack/tencentcloud/latest/docs">æ–‡æ¡£</a></p><ol><li>å…ˆé…ç½®<strong><a href="http://provider.tf">provider.tf</a></strong>æ–‡ä»¶</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;tencentcloud&quot; &#123;</span><br><span class="line">  region = &quot;ap-guangzhou&quot;    # åŒºåŸŸ, å¯ä»¥è‡ªå·±é…</span><br><span class="line">  secret_id = &quot;&quot;</span><br><span class="line">  secret_key = &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç„¶åæ˜¯<strong><a href="http://terraform.tf">terraform.tf</a></strong>æ–‡ä»¶, æŒ‡å®šproviderç›¸å…³ä¿¡æ¯</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">terraform &#123;</span><br><span class="line">  required_providers &#123;</span><br><span class="line">    tencentcloud = &#123;</span><br><span class="line">      source = &quot;tencentcloudstack/tencentcloud&quot;</span><br><span class="line">      # é€šè¿‡versionæŒ‡å®šç‰ˆæœ¬, è¿™é‡Œæˆ‘ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬</span><br><span class="line">      version = &quot;1.82.29&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong><a href="http://main.tf">main.tf</a></strong></li></ol><p>ä¸‹é¢è¿™ä¸ªæ˜¯å®˜æ–¹æ–‡æ¡£ä¸­åˆ›å»ºæ™®é€šæŒ‰å°æ—¶ä»˜è´¹äº‘æœåŠ¡å™¨å®ä¾‹çš„é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;availability_zone&quot; &#123;</span><br><span class="line">  default = &quot;ap-guangzhou-4&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;tencentcloud_images&quot; &quot;images&quot; &#123;</span><br><span class="line">  image_type       = [&quot;PUBLIC_IMAGE&quot;]</span><br><span class="line">  image_name_regex = &quot;OpenCloudOS Server&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;tencentcloud_instance_types&quot; &quot;types&quot; &#123;</span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;instance-family&quot;</span><br><span class="line">    values = [&quot;S1&quot;, &quot;S2&quot;, &quot;S3&quot;, &quot;S4&quot;, &quot;S5&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cpu_core_count   = 2</span><br><span class="line">  exclude_sold_out = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// create vpc</span><br><span class="line">resource &quot;tencentcloud_vpc&quot; &quot;vpc&quot; &#123;</span><br><span class="line">  cidr_block = &quot;10.0.0.0/16&quot;</span><br><span class="line">  name       = &quot;vpc&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// create subnet</span><br><span class="line">resource &quot;tencentcloud_subnet&quot; &quot;subnet&quot; &#123;</span><br><span class="line">  vpc_id            = tencentcloud_vpc.vpc.id</span><br><span class="line">  availability_zone = var.availability_zone</span><br><span class="line">  name              = &quot;subnet&quot;</span><br><span class="line">  cidr_block        = &quot;10.0.1.0/24&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// create CVM instance</span><br><span class="line">resource &quot;tencentcloud_instance&quot; &quot;example&quot; &#123;</span><br><span class="line">  instance_name     = &quot;tf-example&quot;</span><br><span class="line">  availability_zone = var.availability_zone</span><br><span class="line">  image_id          = data.tencentcloud_images.images.images.0.image_id</span><br><span class="line">  instance_type     = data.tencentcloud_instance_types.types.instance_types.0.instance_type</span><br><span class="line">  system_disk_type  = &quot;CLOUD_PREMIUM&quot;</span><br><span class="line">  system_disk_size  = 50</span><br><span class="line">  hostname          = &quot;user&quot;</span><br><span class="line">  project_id        = 0</span><br><span class="line">  vpc_id            = tencentcloud_vpc.vpc.id</span><br><span class="line">  subnet_id         = tencentcloud_subnet.subnet.id</span><br><span class="line"></span><br><span class="line">  data_disks &#123;</span><br><span class="line">    data_disk_type = &quot;CLOUD_PREMIUM&quot;</span><br><span class="line">    data_disk_size = 50</span><br><span class="line">    encrypt        = false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  tags = &#123;</span><br><span class="line">    tagKey = &quot;tagValue&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªé…ç½®æ ¹æ®<strong>æœ€ä½³å®è·µ</strong>æ¥è¿›è¡Œä¿®æ”¹, ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">data &quot;tencentcloud_images&quot; &quot;ubuntu_image&quot; &#123;</span><br><span class="line">  image_type     = [&quot;PUBLIC_IMAGE&quot;]</span><br><span class="line">  image_name_regex = &quot;Ubuntu Server 22.04&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;tencentcloud_instance_types&quot; &quot;instance_type_s5&quot; &#123;</span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;instance-family&quot;</span><br><span class="line">    values = [&quot;S5&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">  cpu_core_count   = var.instance_cpu_cores   # å¼•ç”¨å˜é‡</span><br><span class="line">  memory_size      = var.instance_memory_size # å¼•ç”¨å˜é‡</span><br><span class="line">  exclude_sold_out = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- ç½‘ç»œèµ„æº ---</span><br><span class="line">resource &quot;tencentcloud_vpc&quot; &quot;vpc&quot; &#123;</span><br><span class="line">  name       = &quot;$&#123;local.project_prefix&#125;-vpc&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  cidr_block = &quot;10.0.0.0/16&quot;</span><br><span class="line">  tags       = local.common_tags           # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_subnet&quot; &quot;subnet&quot; &#123;</span><br><span class="line">  vpc_id            = tencentcloud_vpc.vpc.id</span><br><span class="line">  name              = &quot;$&#123;local.project_prefix&#125;-subnet&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  cidr_block        = &quot;10.0.1.0/24&quot;</span><br><span class="line">  availability_zone = var.availability_zone</span><br><span class="line">  tags              = local.common_tags               # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- å®‰å…¨ç»„èµ„æº</span><br><span class="line">resource &quot;tencentcloud_security_group&quot; &quot;base&quot; &#123;</span><br><span class="line">  name        = &quot;$&#123;local.project_prefix&#125;-sg&quot; # Using local for consistency</span><br><span class="line">  description = &quot;Primary Security Group for VM&quot;</span><br><span class="line">  tags        = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_security_group&quot; &quot;relative&quot; &#123;</span><br><span class="line">  name        = &quot;$&#123;local.project_prefix&#125;-sg-relative&quot; # Using local for consistency</span><br><span class="line">  description = &quot;Used for attach security policy&quot;</span><br><span class="line">  tags        = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_address_template&quot; &quot;foo&quot; &#123;</span><br><span class="line">  name      = &quot;$&#123;local.project_prefix&#125;-address-template&quot; # Using local for consistency</span><br><span class="line">  addresses = [&quot;10.0.0.1&quot;, &quot;10.0.1.0/24&quot;, &quot;10.0.0.1-10.0.0.100&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_address_template_group&quot; &quot;foo&quot; &#123;</span><br><span class="line">  name         = &quot;$&#123;local.project_prefix&#125;-address-template-group&quot; # Using local for consistency</span><br><span class="line">  template_ids = [tencentcloud_address_template.foo.id]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_security_group_rule_set&quot; &quot;base_rules&quot; &#123;</span><br><span class="line">  security_group_id = tencentcloud_security_group.base.id</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.0.0/22&quot;</span><br><span class="line">    protocol    = &quot;TCP&quot;</span><br><span class="line">    port        = &quot;80-90&quot;</span><br><span class="line">    description = &quot;A:Allow Ips and 80-90&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.2.1&quot;</span><br><span class="line">    protocol    = &quot;UDP&quot;</span><br><span class="line">    port        = &quot;8080&quot;</span><br><span class="line">    description = &quot;B:Allow UDP 8080&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.2.1&quot;</span><br><span class="line">    protocol    = &quot;UDP&quot;</span><br><span class="line">    port        = &quot;8080&quot;</span><br><span class="line">    description = &quot;C:Allow UDP 8080&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;172.18.1.2&quot;</span><br><span class="line">    protocol    = &quot;ALL&quot;</span><br><span class="line">    port        = &quot;ALL&quot;</span><br><span class="line">    description = &quot;D:Allow ALL&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action             = &quot;DROP&quot;</span><br><span class="line">    protocol           = &quot;TCP&quot;</span><br><span class="line">    port               = &quot;80&quot;</span><br><span class="line">    source_security_id = tencentcloud_security_group.relative.id</span><br><span class="line">    description        = &quot;E:Block relative&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action      = &quot;DROP&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.0.0/16&quot;</span><br><span class="line">    protocol    = &quot;ICMP&quot;</span><br><span class="line">    description = &quot;A:Block ping3&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action              = &quot;DROP&quot;</span><br><span class="line">    address_template_id = tencentcloud_address_template.foo.id</span><br><span class="line">    description         = &quot;B:Allow template&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action                 = &quot;DROP&quot;</span><br><span class="line">    address_template_group = tencentcloud_address_template_group.foo.id</span><br><span class="line">    description            = &quot;C:DROP template group&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- CVM å®ä¾‹èµ„æº ---</span><br><span class="line">resource &quot;tencentcloud_instance&quot; &quot;my-vm&quot; &#123;</span><br><span class="line">  instance_name      = &quot;$&#123;local.project_prefix&#125;-vm&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  availability_zone  = var.availability_zone</span><br><span class="line">  image_id           = data.tencentcloud_images.ubuntu_image.images.0.image_id</span><br><span class="line">  instance_type      = data.tencentcloud_instance_types.instance_type_s5.instance_types.0.instance_type</span><br><span class="line">  system_disk_type   = &quot;CLOUD_PREMIUM&quot;</span><br><span class="line">  system_disk_size   = 50</span><br><span class="line">  </span><br><span class="line">  password           = var.instance_password # å¼•ç”¨å˜é‡</span><br><span class="line">  allocate_public_ip = true</span><br><span class="line">  orderly_security_groups = [tencentcloud_security_group.base.id]</span><br><span class="line"></span><br><span class="line">  vpc_id               = tencentcloud_vpc.vpc.id</span><br><span class="line">  subnet_id            = tencentcloud_subnet.subnet.id</span><br><span class="line">  instance_charge_type = &quot;POSTPAID_BY_HOUR&quot;</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li><strong><a href="http://variables.tf">variables.tf</a></strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;availability_zone&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;åˆ›å»ºèµ„æºçš„ç›®æ ‡å¯ç”¨åŒº&quot;</span><br><span class="line">  default     = &quot;ap-guangzhou-4&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_password&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;è®¾ç½®äº‘æœåŠ¡å™¨çš„ç™»å½•å¯†ç &quot;</span><br><span class="line">  sensitive   = true # Terraform åœ¨è¾“å‡º plan æˆ– apply ç»“æœæ—¶ä¼šéšè—å…·ä½“çš„å€¼</span><br><span class="line">  default     = &quot;TencentCloud123!&quot; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_cpu_cores&quot; &#123;</span><br><span class="line">  type        = number</span><br><span class="line">  description = &quot;æœåŠ¡å™¨çš„ CPU æ ¸å¿ƒæ•°&quot;</span><br><span class="line">  default     = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;instance_memory_size&quot; &#123;</span><br><span class="line">  type        = number</span><br><span class="line">  description = &quot;æœåŠ¡å™¨çš„å†…å­˜å¤§å° (GB)&quot;</span><br><span class="line">  default     = 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong><a href="http://outputs.tf">outputs.tf</a></strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">output &quot;instance_public_ip&quot; &#123;</span><br><span class="line">  description = &quot;äº‘æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€&quot;</span><br><span class="line">  value       = tencentcloud_instance.my-vm.public_ip</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;vpc_id&quot; &#123;</span><br><span class="line">  description = &quot;åˆ›å»ºçš„ VPC çš„ ID&quot;</span><br><span class="line">  value       = tencentcloud_vpc.vpc.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &quot;security_group_id&quot; &#123;</span><br><span class="line">  description = &quot;ä¸ºæœåŠ¡å™¨åˆ›å»ºçš„å®‰å…¨ç»„ ID&quot;</span><br><span class="line">  value       = tencentcloud_security_group.base.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li><strong><a href="http://locals.tf">locals.tf</a></strong></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">locals &#123;</span><br><span class="line">  # ç»Ÿä¸€çš„èµ„æºåå‰ç¼€ï¼Œæ–¹ä¾¿è¯†åˆ«å’Œç®¡ç†</span><br><span class="line">  project_prefix = &quot;tf-txy-demo&quot;</span><br><span class="line"></span><br><span class="line">  # ç»Ÿä¸€çš„æ ‡ç­¾ï¼Œä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰æ”¯æŒæ ‡ç­¾çš„èµ„æºä¸Š</span><br><span class="line">  common_tags = &#123;</span><br><span class="line">    Owner     = &quot;Levitate Gu&quot;</span><br><span class="line">    CreatedBy = &quot;Terraform&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º">åˆ›å»º</h3><ol><li>åˆå§‹åŒ– Terraform</li></ol><p>åœ¨é…ç½®æ–‡ä»¶çš„ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ– Terraform:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">terraform init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸º:</span></span><br><span class="line">Initializing the backend...</span><br><span class="line">Initializing provider plugins...</span><br><span class="line">- Finding tencentcloudstack/tencentcloud versions matching <span class="string">&quot;1.82.29&quot;</span>...</span><br><span class="line">- Installing tencentcloudstack/tencentcloud v1.82.29...</span><br><span class="line">- Installed tencentcloudstack/tencentcloud v1.82.29 (signed by a HashiCorp partner, key ID 84F69E1C1BECF459)</span><br><span class="line">Partner and community providers are signed by their developers.</span><br><span class="line">If you<span class="string">&#x27;d like to know more about provider signing, you can read about it here:</span></span><br><span class="line"><span class="string">https://developer.hashicorp.com/terraform/cli/plugins/signing</span></span><br><span class="line"><span class="string">Terraform has created a lock file .terraform.lock.hcl to record the provider</span></span><br><span class="line"><span class="string">selections it made above. Include this file in your version control repository</span></span><br><span class="line"><span class="string">so that Terraform can guarantee to make the same selections by default when</span></span><br><span class="line"><span class="string">you run &quot;terraform init&quot; in the future.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Terraform has been successfully initialized!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see</span></span><br><span class="line"><span class="string">any changes that are required for your infrastructure. All Terraform commands</span></span><br><span class="line"><span class="string">should now work.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If you ever set or change modules or backend configuration for Terraform,</span></span><br><span class="line"><span class="string">rerun this command to reinitialize your working directory. If you forget, other</span></span><br><span class="line"><span class="string">commands will detect it and remind you to do so if necessary.</span></span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line">terraform plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºä¸º:</span></span><br><span class="line">data.tencentcloud_images.ubuntu_image: Reading...</span><br><span class="line">data.tencentcloud_instance_types.instance_type_s5: Reading...</span><br><span class="line">data.tencentcloud_images.ubuntu_image: Read complete after 1s [<span class="built_in">id</span>=2198502367]</span><br><span class="line">data.tencentcloud_instance_types.instance_type_s5: Read complete after 1s [<span class="built_in">id</span>=3046689892]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the</span><br><span class="line">following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_address_template.foo will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_address_template&quot;</span> <span class="string">&quot;foo&quot;</span> &#123;</span><br><span class="line">      + addresses = [</span><br><span class="line">          + <span class="string">&quot;10.0.0.1&quot;</span>,</span><br><span class="line">          + <span class="string">&quot;10.0.0.1-10.0.0.100&quot;</span>,</span><br><span class="line">          + <span class="string">&quot;10.0.1.0/24&quot;</span>,</span><br><span class="line">        ]</span><br><span class="line">      + <span class="built_in">id</span>        = (known after apply)</span><br><span class="line">      + name      = <span class="string">&quot;tf-txy-demo-address-template&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_address_template_group.foo will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_address_template_group&quot;</span> <span class="string">&quot;foo&quot;</span> &#123;</span><br><span class="line">      + <span class="built_in">id</span>           = (known after apply)</span><br><span class="line">      + name         = <span class="string">&quot;tf-txy-demo-address-template-group&quot;</span></span><br><span class="line">      + template_ids = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_instance.my-vm will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span> &#123;</span><br><span class="line">      + allocate_public_ip                      = <span class="literal">true</span></span><br><span class="line">      + anti_ddos_package_id                    = (known after apply)</span><br><span class="line">      + availability_zone                       = <span class="string">&quot;ap-guangzhou-4&quot;</span></span><br><span class="line">      + cam_role_name                           = (known after apply)</span><br><span class="line">      + cdh_host_id                             = (known after apply)</span><br><span class="line">      + cdh_instance_type                       = (known after apply)</span><br><span class="line">      + cpu                                     = (known after apply)</span><br><span class="line">      + create_time                             = (known after apply)</span><br><span class="line">      + disable_api_termination                 = (known after apply)</span><br><span class="line">      + disable_automation_service              = <span class="literal">false</span></span><br><span class="line">      + disable_monitor_service                 = <span class="literal">false</span></span><br><span class="line">      + disable_security_service                = <span class="literal">false</span></span><br><span class="line">      + expired_time                            = (known after apply)</span><br><span class="line">      + force_delete                            = <span class="literal">false</span></span><br><span class="line">      + hostname                                = (known after apply)</span><br><span class="line">      + hpc_cluster_id                          = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                                      = (known after apply)</span><br><span class="line">      + image_id                                = <span class="string">&quot;img-487zeit5&quot;</span></span><br><span class="line">      + instance_charge_type                    = <span class="string">&quot;POSTPAID_BY_HOUR&quot;</span></span><br><span class="line">      + instance_charge_type_prepaid_renew_flag = (known after apply)</span><br><span class="line">      + instance_name                           = <span class="string">&quot;tf-txy-demo-vm&quot;</span></span><br><span class="line">      + instance_status                         = (known after apply)</span><br><span class="line">      + instance_type                           = <span class="string">&quot;S5.MEDIUM2&quot;</span></span><br><span class="line">      + internet_charge_type                    = (known after apply)</span><br><span class="line">      + internet_max_bandwidth_out              = (known after apply)</span><br><span class="line">      + ipv4_address_type                       = (known after apply)</span><br><span class="line">      + ipv6_address_count                      = (known after apply)</span><br><span class="line">      + ipv6_address_type                       = (known after apply)</span><br><span class="line">      + ipv6_addresses                          = (known after apply)</span><br><span class="line">      + keep_image_login                        = (known after apply)</span><br><span class="line">      + key_ids                                 = (known after apply)</span><br><span class="line">      + key_name                                = (known after apply)</span><br><span class="line">      + memory                                  = (known after apply)</span><br><span class="line">      + orderly_security_groups                 = (known after apply)</span><br><span class="line">      + os_name                                 = (known after apply)</span><br><span class="line">      + password                                = (sensitive value)</span><br><span class="line">      + placement_group_id                      = (known after apply)</span><br><span class="line">      + private_ip                              = (known after apply)</span><br><span class="line">      + project_id                              = (known after apply)</span><br><span class="line">      + public_ip                               = (known after apply)</span><br><span class="line">      + public_ipv6_addresses                   = (known after apply)</span><br><span class="line">      + running_flag                            = (known after apply)</span><br><span class="line">      + security_groups                         = (known after apply)</span><br><span class="line">      + subnet_id                               = (known after apply)</span><br><span class="line">      + system_disk_id                          = (known after apply)</span><br><span class="line">      + system_disk_name                        = (known after apply)</span><br><span class="line">      + system_disk_size                        = 50</span><br><span class="line">      + system_disk_type                        = <span class="string">&quot;CLOUD_PREMIUM&quot;</span></span><br><span class="line">      + tags                                    = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + user_data                               = (known after apply)</span><br><span class="line">      + user_data_raw                           = (known after apply)</span><br><span class="line">      + user_data_replace_on_change             = <span class="literal">false</span></span><br><span class="line">      + uuid                                    = (known after apply)</span><br><span class="line">      + vpc_id                                  = (known after apply)</span><br><span class="line"></span><br><span class="line">      + data_disks (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group.base will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group&quot;</span> <span class="string">&quot;base&quot;</span> &#123;</span><br><span class="line">      + description = <span class="string">&quot;Primary Security Group for VM&quot;</span></span><br><span class="line">      + <span class="built_in">id</span>          = (known after apply)</span><br><span class="line">      + name        = <span class="string">&quot;tf-txy-demo-sg&quot;</span></span><br><span class="line">      + project_id  = (known after apply)</span><br><span class="line">      + tags        = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group.relative will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group&quot;</span> <span class="string">&quot;relative&quot;</span> &#123;</span><br><span class="line">      + description = <span class="string">&quot;Used for attach security policy&quot;</span></span><br><span class="line">      + <span class="built_in">id</span>          = (known after apply)</span><br><span class="line">      + name        = <span class="string">&quot;tf-txy-demo-sg-relative&quot;</span></span><br><span class="line">      + project_id  = (known after apply)</span><br><span class="line">      + tags        = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group_rule_set.base_rules will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group_rule_set&quot;</span> <span class="string">&quot;base_rules&quot;</span> &#123;</span><br><span class="line">      + <span class="built_in">id</span>                = (known after apply)</span><br><span class="line">      + security_group_id = (known after apply)</span><br><span class="line">      + version           = (known after apply)</span><br><span class="line"></span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.0.0/16&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;A:Block ping3&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = (known after apply)</span><br><span class="line">          + protocol     = <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action              = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + address_template_id = (known after apply)</span><br><span class="line">          + description         = <span class="string">&quot;B:Allow template&quot;</span></span><br><span class="line">          + policy_index        = (known after apply)</span><br><span class="line">          + port                = (known after apply)</span><br><span class="line">          + protocol            = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action                 = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + address_template_group = (known after apply)</span><br><span class="line">          + description            = <span class="string">&quot;C:DROP template group&quot;</span></span><br><span class="line">          + policy_index           = (known after apply)</span><br><span class="line">          + port                   = (known after apply)</span><br><span class="line">          + protocol               = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.0.0/22&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;A:Allow Ips and 80-90&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;80-90&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.2.1&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;B:Allow UDP 8080&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;8080&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;UDP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.2.1&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;C:Allow UDP 8080&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;8080&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;UDP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;172.18.1.2&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;D:Allow ALL&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;ALL&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;ALL&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action             = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + description        = <span class="string">&quot;E:Block relative&quot;</span></span><br><span class="line">          + policy_index       = (known after apply)</span><br><span class="line">          + port               = <span class="string">&quot;80&quot;</span></span><br><span class="line">          + protocol           = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">          + source_security_id = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_subnet.subnet will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_subnet&quot;</span> <span class="string">&quot;subnet&quot;</span> &#123;</span><br><span class="line">      + availability_zone  = <span class="string">&quot;ap-guangzhou-4&quot;</span></span><br><span class="line">      + available_ip_count = (known after apply)</span><br><span class="line">      + cidr_block         = <span class="string">&quot;10.0.1.0/24&quot;</span></span><br><span class="line">      + create_time        = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                 = (known after apply)</span><br><span class="line">      + is_default         = (known after apply)</span><br><span class="line">      + is_multicast       = <span class="literal">true</span></span><br><span class="line">      + name               = <span class="string">&quot;tf-txy-demo-subnet&quot;</span></span><br><span class="line">      + route_table_id     = (known after apply)</span><br><span class="line">      + tags               = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + vpc_id             = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_vpc.vpc will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_vpc&quot;</span> <span class="string">&quot;vpc&quot;</span> &#123;</span><br><span class="line">      + assistant_cidrs        = (known after apply)</span><br><span class="line">      + cidr_block             = <span class="string">&quot;10.0.0.0/16&quot;</span></span><br><span class="line">      + create_time            = (known after apply)</span><br><span class="line">      + default_route_table_id = (known after apply)</span><br><span class="line">      + dns_servers            = (known after apply)</span><br><span class="line">      + docker_assistant_cidrs = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                     = (known after apply)</span><br><span class="line">      + is_default             = (known after apply)</span><br><span class="line">      + is_multicast           = <span class="literal">true</span></span><br><span class="line">      + name                   = <span class="string">&quot;tf-txy-demo-vpc&quot;</span></span><br><span class="line">      + tags                   = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 8 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">Changes to Outputs:</span><br><span class="line">  + instance_public_ip = (known after apply)</span><br><span class="line">  + security_group_id  = (known after apply)</span><br><span class="line">  + vpc_id             = (known after apply)</span><br><span class="line"></span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"></span><br><span class="line">Note: You didn<span class="string">&#x27;t use the -out option to save this plan, so Terraform can&#x27;</span>t guarantee to take exactly these actions <span class="keyword">if</span></span><br><span class="line">you run <span class="string">&quot;terraform apply&quot;</span> now.</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºèµ„æº</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p><strong>é‡åˆ°é—®é¢˜äº†</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•·</span><br><span class="line">â”‚ Error: [TencentCloudSDKError] Code=InvalidZone.MismatchRegion, Message=The specified zone ID `ap-guangzhou-4` does not match the region `ap-guangzhou`, RequestId=2a9433d0-a4c4-45cb-ac5a-161108dba7e6</span><br><span class="line">â”‚</span><br><span class="line">â”‚   with tencentcloud_instance.my-vm,</span><br><span class="line">â”‚   on main.tf line 121, <span class="keyword">in</span> resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span>:</span><br><span class="line">â”‚  121: resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span> &#123;</span><br><span class="line">â”‚</span><br><span class="line">â•µ</span><br></pre></td></tr></table></figure><p>å¾ˆè¯¡å¼‚ï¼Œæˆ‘æŒ‡å®šçš„zoneæ˜¯ap-guangzhou-4ï¼Œä½†æ˜¯æŠ¥é”™è¯´regionå’Œzoneä¸åŒ¹é…ï¼Œæˆ‘æ˜æ˜æŒ‡å®šäº†regionæ˜¯ap-guangzhouå•Šï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ æˆ‘å»è…¾è®¯äº‘çœ‹äº†çœ‹, åº”è¯¥æ˜¯æŒ‡å®šçš„zoneæ²¡æœ‰æˆ‘è¦çš„é…ç½®, æˆ‘ä»¬å°†zoneæ”¹ä¸ºap-guangzhou-6ï¼Œé…ç½®æ”¹ä¸º2c4gå†å°è¯•ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">terraform init</span><br><span class="line">terraform plan</span><br><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p><strong>å†æ¬¡é‡åˆ°é—®é¢˜äº†</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â•·</span><br><span class="line">â”‚ Error: [TencentCloudSDKError] Code=InvalidParameterCombination, Message=The combination of parameters between .InternetAccessible.PublicIpAssigned and InternetMaxBandwidthOut is incorrect, RequestId=878c5e48-57db-4991-849f-3fe2a5be502d</span><br><span class="line">â”‚</span><br><span class="line">â”‚   with tencentcloud_instance.my-vm,</span><br><span class="line">â”‚   on main.tf line 121, <span class="keyword">in</span> resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span>:</span><br><span class="line">â”‚  121: resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span> &#123;</span><br><span class="line">â”‚</span><br><span class="line">â•µ</span><br></pre></td></tr></table></figure><p>å°é—®é¢˜, æ²¡æœ‰é…ç½®å¸¦å®½, é…ä¸ª3M, å†è¯•ä¸€æ¬¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">terraform init</span><br><span class="line">terraform plan</span><br><span class="line">terraform apply</span><br></pre></td></tr></table></figure><p>ç»ˆäºæˆåŠŸäº†, å¦‚å›¾:</p><p><img src="https://s3.bitiful.net/pb01/296.webp" alt="avatar"></p><p>çœ‹çœ‹è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">data.tencentcloud_images.ubuntu_image: Reading...</span><br><span class="line">data.tencentcloud_instance_types.instance_type_s5: Reading...</span><br><span class="line">data.tencentcloud_images.ubuntu_image: Read complete after 1s [<span class="built_in">id</span>=2198502367]</span><br><span class="line">data.tencentcloud_instance_types.instance_type_s5: Read complete after 1s [<span class="built_in">id</span>=3086429807]</span><br><span class="line"></span><br><span class="line">Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the</span><br><span class="line">following symbols:</span><br><span class="line">  + create</span><br><span class="line"></span><br><span class="line">Terraform will perform the following actions:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_address_template.foo will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_address_template&quot;</span> <span class="string">&quot;foo&quot;</span> &#123;</span><br><span class="line">      + addresses = [</span><br><span class="line">          + <span class="string">&quot;10.0.0.1&quot;</span>,</span><br><span class="line">          + <span class="string">&quot;10.0.0.1-10.0.0.100&quot;</span>,</span><br><span class="line">          + <span class="string">&quot;10.0.1.0/24&quot;</span>,</span><br><span class="line">        ]</span><br><span class="line">      + <span class="built_in">id</span>        = (known after apply)</span><br><span class="line">      + name      = <span class="string">&quot;tf-txy-demo-address-template&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_address_template_group.foo will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_address_template_group&quot;</span> <span class="string">&quot;foo&quot;</span> &#123;</span><br><span class="line">      + <span class="built_in">id</span>           = (known after apply)</span><br><span class="line">      + name         = <span class="string">&quot;tf-txy-demo-address-template-group&quot;</span></span><br><span class="line">      + template_ids = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_instance.my-vm will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_instance&quot;</span> <span class="string">&quot;my-vm&quot;</span> &#123;</span><br><span class="line">      + allocate_public_ip                      = <span class="literal">true</span></span><br><span class="line">      + anti_ddos_package_id                    = (known after apply)</span><br><span class="line">      + availability_zone                       = <span class="string">&quot;ap-guangzhou-6&quot;</span></span><br><span class="line">      + cam_role_name                           = (known after apply)</span><br><span class="line">      + cdh_host_id                             = (known after apply)</span><br><span class="line">      + cdh_instance_type                       = (known after apply)</span><br><span class="line">      + cpu                                     = (known after apply)</span><br><span class="line">      + create_time                             = (known after apply)</span><br><span class="line">      + disable_api_termination                 = (known after apply)</span><br><span class="line">      + disable_automation_service              = <span class="literal">false</span></span><br><span class="line">      + disable_monitor_service                 = <span class="literal">false</span></span><br><span class="line">      + disable_security_service                = <span class="literal">false</span></span><br><span class="line">      + expired_time                            = (known after apply)</span><br><span class="line">      + force_delete                            = <span class="literal">false</span></span><br><span class="line">      + hostname                                = (known after apply)</span><br><span class="line">      + hpc_cluster_id                          = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                                      = (known after apply)</span><br><span class="line">      + image_id                                = <span class="string">&quot;img-487zeit5&quot;</span></span><br><span class="line">      + instance_charge_type                    = <span class="string">&quot;POSTPAID_BY_HOUR&quot;</span></span><br><span class="line">      + instance_charge_type_prepaid_renew_flag = (known after apply)</span><br><span class="line">      + instance_name                           = <span class="string">&quot;tf-txy-demo-vm&quot;</span></span><br><span class="line">      + instance_status                         = (known after apply)</span><br><span class="line">      + instance_type                           = <span class="string">&quot;S5.MEDIUM4&quot;</span></span><br><span class="line">      + internet_charge_type                    = (known after apply)</span><br><span class="line">      + internet_max_bandwidth_out              = 3</span><br><span class="line">      + ipv4_address_type                       = (known after apply)</span><br><span class="line">      + ipv6_address_count                      = (known after apply)</span><br><span class="line">      + ipv6_address_type                       = (known after apply)</span><br><span class="line">      + ipv6_addresses                          = (known after apply)</span><br><span class="line">      + keep_image_login                        = (known after apply)</span><br><span class="line">      + key_ids                                 = (known after apply)</span><br><span class="line">      + key_name                                = (known after apply)</span><br><span class="line">      + memory                                  = (known after apply)</span><br><span class="line">      + orderly_security_groups                 = (known after apply)</span><br><span class="line">      + os_name                                 = (known after apply)</span><br><span class="line">      + password                                = (sensitive value)</span><br><span class="line">      + placement_group_id                      = (known after apply)</span><br><span class="line">      + private_ip                              = (known after apply)</span><br><span class="line">      + project_id                              = (known after apply)</span><br><span class="line">      + public_ip                               = (known after apply)</span><br><span class="line">      + public_ipv6_addresses                   = (known after apply)</span><br><span class="line">      + running_flag                            = (known after apply)</span><br><span class="line">      + security_groups                         = (known after apply)</span><br><span class="line">      + subnet_id                               = (known after apply)</span><br><span class="line">      + system_disk_id                          = (known after apply)</span><br><span class="line">      + system_disk_name                        = (known after apply)</span><br><span class="line">      + system_disk_size                        = 50</span><br><span class="line">      + system_disk_type                        = <span class="string">&quot;CLOUD_PREMIUM&quot;</span></span><br><span class="line">      + tags                                    = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + user_data                               = (known after apply)</span><br><span class="line">      + user_data_raw                           = (known after apply)</span><br><span class="line">      + user_data_replace_on_change             = <span class="literal">false</span></span><br><span class="line">      + uuid                                    = (known after apply)</span><br><span class="line">      + vpc_id                                  = (known after apply)</span><br><span class="line"></span><br><span class="line">      + data_disks (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group.base will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group&quot;</span> <span class="string">&quot;base&quot;</span> &#123;</span><br><span class="line">      + description = <span class="string">&quot;Primary Security Group for VM&quot;</span></span><br><span class="line">      + <span class="built_in">id</span>          = (known after apply)</span><br><span class="line">      + name        = <span class="string">&quot;tf-txy-demo-sg&quot;</span></span><br><span class="line">      + project_id  = (known after apply)</span><br><span class="line">      + tags        = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group.relative will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group&quot;</span> <span class="string">&quot;relative&quot;</span> &#123;</span><br><span class="line">      + description = <span class="string">&quot;Used for attach security policy&quot;</span></span><br><span class="line">      + <span class="built_in">id</span>          = (known after apply)</span><br><span class="line">      + name        = <span class="string">&quot;tf-txy-demo-sg-relative&quot;</span></span><br><span class="line">      + project_id  = (known after apply)</span><br><span class="line">      + tags        = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_security_group_rule_set.base_rules will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_security_group_rule_set&quot;</span> <span class="string">&quot;base_rules&quot;</span> &#123;</span><br><span class="line">      + <span class="built_in">id</span>                = (known after apply)</span><br><span class="line">      + security_group_id = (known after apply)</span><br><span class="line">      + version           = (known after apply)</span><br><span class="line"></span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.0.0/16&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;A:Block ping3&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = (known after apply)</span><br><span class="line">          + protocol     = <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action              = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + address_template_id = (known after apply)</span><br><span class="line">          + description         = <span class="string">&quot;B:Allow template&quot;</span></span><br><span class="line">          + policy_index        = (known after apply)</span><br><span class="line">          + port                = (known after apply)</span><br><span class="line">          + protocol            = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line">      + egress &#123;</span><br><span class="line">          + action                 = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + address_template_group = (known after apply)</span><br><span class="line">          + description            = <span class="string">&quot;C:DROP template group&quot;</span></span><br><span class="line">          + policy_index           = (known after apply)</span><br><span class="line">          + port                   = (known after apply)</span><br><span class="line">          + protocol               = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.0.0/22&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;A:Allow Ips and 80-90&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;80-90&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.2.1&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;B:Allow UDP 8080&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;8080&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;UDP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;10.0.2.1&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;C:Allow UDP 8080&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;8080&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;UDP&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action       = <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">          + cidr_block   = <span class="string">&quot;172.18.1.2&quot;</span></span><br><span class="line">          + description  = <span class="string">&quot;D:Allow ALL&quot;</span></span><br><span class="line">          + policy_index = (known after apply)</span><br><span class="line">          + port         = <span class="string">&quot;ALL&quot;</span></span><br><span class="line">          + protocol     = <span class="string">&quot;ALL&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + ingress &#123;</span><br><span class="line">          + action             = <span class="string">&quot;DROP&quot;</span></span><br><span class="line">          + description        = <span class="string">&quot;E:Block relative&quot;</span></span><br><span class="line">          + policy_index       = (known after apply)</span><br><span class="line">          + port               = <span class="string">&quot;80&quot;</span></span><br><span class="line">          + protocol           = <span class="string">&quot;TCP&quot;</span></span><br><span class="line">          + source_security_id = (known after apply)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_subnet.subnet will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_subnet&quot;</span> <span class="string">&quot;subnet&quot;</span> &#123;</span><br><span class="line">      + availability_zone  = <span class="string">&quot;ap-guangzhou-6&quot;</span></span><br><span class="line">      + available_ip_count = (known after apply)</span><br><span class="line">      + cidr_block         = <span class="string">&quot;10.0.1.0/24&quot;</span></span><br><span class="line">      + create_time        = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                 = (known after apply)</span><br><span class="line">      + is_default         = (known after apply)</span><br><span class="line">      + is_multicast       = <span class="literal">true</span></span><br><span class="line">      + name               = <span class="string">&quot;tf-txy-demo-subnet&quot;</span></span><br><span class="line">      + route_table_id     = (known after apply)</span><br><span class="line">      + tags               = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      + vpc_id             = (known after apply)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># tencentcloud_vpc.vpc will be created</span></span><br><span class="line">  + resource <span class="string">&quot;tencentcloud_vpc&quot;</span> <span class="string">&quot;vpc&quot;</span> &#123;</span><br><span class="line">      + assistant_cidrs        = (known after apply)</span><br><span class="line">      + cidr_block             = <span class="string">&quot;10.0.0.0/16&quot;</span></span><br><span class="line">      + create_time            = (known after apply)</span><br><span class="line">      + default_route_table_id = (known after apply)</span><br><span class="line">      + dns_servers            = (known after apply)</span><br><span class="line">      + docker_assistant_cidrs = (known after apply)</span><br><span class="line">      + <span class="built_in">id</span>                     = (known after apply)</span><br><span class="line">      + is_default             = (known after apply)</span><br><span class="line">      + is_multicast           = <span class="literal">true</span></span><br><span class="line">      + name                   = <span class="string">&quot;tf-txy-demo-vpc&quot;</span></span><br><span class="line">      + tags                   = &#123;</span><br><span class="line">          + <span class="string">&quot;CreatedBy&quot;</span> = <span class="string">&quot;Terraform&quot;</span></span><br><span class="line">          + <span class="string">&quot;Owner&quot;</span>     = <span class="string">&quot;Levitate Gu&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Plan: 8 to add, 0 to change, 0 to destroy.</span><br><span class="line"></span><br><span class="line">Changes to Outputs:</span><br><span class="line">  + instance_public_ip = (known after apply)</span><br><span class="line">  + security_group_id  = (known after apply)</span><br><span class="line">  + vpc_id             = (known after apply)</span><br><span class="line"></span><br><span class="line">Do you want to perform these actions?</span><br><span class="line">  Terraform will perform the actions described above.</span><br><span class="line">  Only <span class="string">&#x27;yes&#x27;</span> will be accepted to approve.</span><br><span class="line"></span><br><span class="line">  Enter a value: <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">tencentcloud_address_template.foo: Creating...</span><br><span class="line">tencentcloud_security_group.base: Creating...</span><br><span class="line">tencentcloud_security_group.relative: Creating...</span><br><span class="line">tencentcloud_vpc.vpc: Creating...</span><br><span class="line">tencentcloud_address_template.foo: Creation complete after 1s [<span class="built_in">id</span>=ipm-6p8sfzfi]</span><br><span class="line">tencentcloud_address_template_group.foo: Creating...</span><br><span class="line">tencentcloud_security_group.relative: Creation complete after 1s [<span class="built_in">id</span>=sg-e1teftjb]</span><br><span class="line">tencentcloud_security_group.base: Creation complete after 2s [<span class="built_in">id</span>=sg-ndwv7fgr]</span><br><span class="line">tencentcloud_address_template_group.foo: Creation complete after 1s [<span class="built_in">id</span>=ipmg-qcb8g30y]</span><br><span class="line">tencentcloud_security_group_rule_set.base_rules: Creating...</span><br><span class="line">tencentcloud_security_group_rule_set.base_rules: Creation complete after 1s [<span class="built_in">id</span>=sg-ndwv7fgr]</span><br><span class="line">tencentcloud_vpc.vpc: Creation complete after 6s [<span class="built_in">id</span>=vpc-5gizonzh]</span><br><span class="line">tencentcloud_subnet.subnet: Creating...</span><br><span class="line">tencentcloud_subnet.subnet: Creation complete after 2s [<span class="built_in">id</span>=subnet-ccj458ri]</span><br><span class="line">tencentcloud_instance.my-vm: Creating...</span><br><span class="line">tencentcloud_instance.my-vm: Still creating... [00m10s elapsed]</span><br><span class="line">tencentcloud_instance.my-vm: Still creating... [00m20s elapsed]</span><br><span class="line">tencentcloud_instance.my-vm: Still creating... [00m30s elapsed]</span><br><span class="line">tencentcloud_instance.my-vm: Creation complete after 36s [<span class="built_in">id</span>=ins-acqkdsjw]</span><br><span class="line"></span><br><span class="line">Apply complete! Resources: 8 added, 0 changed, 0 destroyed.</span><br><span class="line"></span><br><span class="line">Outputs:</span><br><span class="line"></span><br><span class="line">instance_public_ip = <span class="string">&quot;119.29.93.145&quot;</span></span><br><span class="line">security_group_id = <span class="string">&quot;sg-ndwv7fgr&quot;</span></span><br><span class="line">vpc_id = <span class="string">&quot;vpc-5gizonzh&quot;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„main.tfæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">data &quot;tencentcloud_images&quot; &quot;ubuntu_image&quot; &#123;</span><br><span class="line">  image_type     = [&quot;PUBLIC_IMAGE&quot;]</span><br><span class="line">  image_name_regex = &quot;Ubuntu Server 22.04&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;tencentcloud_instance_types&quot; &quot;instance_type_s5&quot; &#123;</span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;instance-family&quot;</span><br><span class="line">    values = [&quot;S5&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">  cpu_core_count   = var.instance_cpu_cores   # å¼•ç”¨å˜é‡</span><br><span class="line">  memory_size      = var.instance_memory_size # å¼•ç”¨å˜é‡</span><br><span class="line">  exclude_sold_out = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- ç½‘ç»œèµ„æº ---</span><br><span class="line">resource &quot;tencentcloud_vpc&quot; &quot;vpc&quot; &#123;</span><br><span class="line">  name       = &quot;$&#123;local.project_prefix&#125;-vpc&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  cidr_block = &quot;10.0.0.0/16&quot;</span><br><span class="line">  tags       = local.common_tags           # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_subnet&quot; &quot;subnet&quot; &#123;</span><br><span class="line">  vpc_id            = tencentcloud_vpc.vpc.id</span><br><span class="line">  name              = &quot;$&#123;local.project_prefix&#125;-subnet&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  cidr_block        = &quot;10.0.1.0/24&quot;</span><br><span class="line">  availability_zone = var.availability_zone</span><br><span class="line">  tags              = local.common_tags               # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- å®‰å…¨ç»„èµ„æº</span><br><span class="line">resource &quot;tencentcloud_security_group&quot; &quot;base&quot; &#123;</span><br><span class="line">  name        = &quot;$&#123;local.project_prefix&#125;-sg&quot; # Using local for consistency</span><br><span class="line">  description = &quot;Primary Security Group for VM&quot;</span><br><span class="line">  tags        = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_security_group&quot; &quot;relative&quot; &#123;</span><br><span class="line">  name        = &quot;$&#123;local.project_prefix&#125;-sg-relative&quot; # Using local for consistency</span><br><span class="line">  description = &quot;Used for attach security policy&quot;</span><br><span class="line">  tags        = local.common_tags</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_address_template&quot; &quot;foo&quot; &#123;</span><br><span class="line">  name      = &quot;$&#123;local.project_prefix&#125;-address-template&quot; # Using local for consistency</span><br><span class="line">  addresses = [&quot;10.0.0.1&quot;, &quot;10.0.1.0/24&quot;, &quot;10.0.0.1-10.0.0.100&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_address_template_group&quot; &quot;foo&quot; &#123;</span><br><span class="line">  name         = &quot;$&#123;local.project_prefix&#125;-address-template-group&quot; # Using local for consistency</span><br><span class="line">  template_ids = [tencentcloud_address_template.foo.id]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;tencentcloud_security_group_rule_set&quot; &quot;base_rules&quot; &#123;</span><br><span class="line">  security_group_id = tencentcloud_security_group.base.id</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.0.0/22&quot;</span><br><span class="line">    protocol    = &quot;TCP&quot;</span><br><span class="line">    port        = &quot;80-90&quot;</span><br><span class="line">    description = &quot;A:Allow Ips and 80-90&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.2.1&quot;</span><br><span class="line">    protocol    = &quot;UDP&quot;</span><br><span class="line">    port        = &quot;8080&quot;</span><br><span class="line">    description = &quot;B:Allow UDP 8080&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.2.1&quot;</span><br><span class="line">    protocol    = &quot;UDP&quot;</span><br><span class="line">    port        = &quot;8080&quot;</span><br><span class="line">    description = &quot;C:Allow UDP 8080&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action      = &quot;ACCEPT&quot;</span><br><span class="line">    cidr_block  = &quot;172.18.1.2&quot;</span><br><span class="line">    protocol    = &quot;ALL&quot;</span><br><span class="line">    port        = &quot;ALL&quot;</span><br><span class="line">    description = &quot;D:Allow ALL&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    action             = &quot;DROP&quot;</span><br><span class="line">    protocol           = &quot;TCP&quot;</span><br><span class="line">    port               = &quot;80&quot;</span><br><span class="line">    source_security_id = tencentcloud_security_group.relative.id</span><br><span class="line">    description        = &quot;E:Block relative&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action      = &quot;DROP&quot;</span><br><span class="line">    cidr_block  = &quot;10.0.0.0/16&quot;</span><br><span class="line">    protocol    = &quot;ICMP&quot;</span><br><span class="line">    description = &quot;A:Block ping3&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action              = &quot;DROP&quot;</span><br><span class="line">    address_template_id = tencentcloud_address_template.foo.id</span><br><span class="line">    description         = &quot;B:Allow template&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    action                 = &quot;DROP&quot;</span><br><span class="line">    address_template_group = tencentcloud_address_template_group.foo.id</span><br><span class="line">    description            = &quot;C:DROP template group&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- CVM å®ä¾‹èµ„æº ---</span><br><span class="line">resource &quot;tencentcloud_instance&quot; &quot;my-vm&quot; &#123;</span><br><span class="line">  instance_name      = &quot;$&#123;local.project_prefix&#125;-vm&quot; # ä½¿ç”¨ local å˜é‡</span><br><span class="line">  availability_zone  = var.availability_zone</span><br><span class="line">  image_id           = data.tencentcloud_images.ubuntu_image.images.0.image_id</span><br><span class="line">  instance_type      = data.tencentcloud_instance_types.instance_type_s5.instance_types.0.instance_type</span><br><span class="line">  system_disk_type   = &quot;CLOUD_PREMIUM&quot;</span><br><span class="line">  system_disk_size   = 50</span><br><span class="line">  </span><br><span class="line">  password           = var.instance_password # å¼•ç”¨å˜é‡</span><br><span class="line">  allocate_public_ip = true</span><br><span class="line">  internet_max_bandwidth_out = 3    # å¸¦å®½å¤§å°</span><br><span class="line">  orderly_security_groups = [tencentcloud_security_group.base.id]</span><br><span class="line"></span><br><span class="line">  vpc_id               = tencentcloud_vpc.vpc.id</span><br><span class="line">  subnet_id            = tencentcloud_subnet.subnet.id</span><br><span class="line">  instance_charge_type = &quot;POSTPAID_BY_HOUR&quot;</span><br><span class="line"></span><br><span class="line">  tags = local.common_tags # ä½¿ç”¨ local å˜é‡</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>é”€æ¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terraform destroy</span><br></pre></td></tr></table></figure><p>æœ€åèŠ±è´¹0å…ƒğŸ¥°</p><p><img src="https://s3.bitiful.net/pb01/297.webp" alt="avatar"></p><p>æ€»ç»“ä¸€ä¸‹, å…¶å®é…ç½®è¿™ä¸ªæœ€é‡è¦çš„æ˜¯æƒ³æ¸…æ¥šä½ éœ€è¦ä»€ä¹ˆé…ç½®, ç„¶åå»å®˜ç½‘æ‰¾åˆ°å¯¹åº”é…ç½®çš„æ–‡æ¡£, å†æ ¹æ®å…·ä½“éœ€æ±‚å»ä¿®æ”¹å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Terraform </tag>
            
            <tag> IaC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025ä¹åæœˆç”Ÿæ´»è®°å½•</title>
      <link href="/2025/10/04/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/10/04/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="570d0b05a943a5411b58f9949f86ddccafb00ca43be2bf7cbceeca269c83595b">f33a6d5ec2003e353696027d8241bf513ca6f8cde9767d20028f3d9c2c0b7b5206646e5401a9f0abe3506ca31da6f942e4594c7544209382d91eb06eb4db8979240e72a0214c1d2b2b9b69c1729b8b68eebb36c4aa66c0f403fc702361aadde4cfccdaa8505dc94ee47827af1fd31d2a8cef6749b3c3b6edad385b807bf8c9aec310bc5133a24c1d77bf616762f45b15d01ce941ef5c43218b6c6ebff95828f272f386038ce9d368113c835c4a8a49c54626a4bad7634ce7f3ee1c431e226750b898a2931bba07bc7b1f22d6b1fbed38c8551384d3534ceac1fbd0439aac4ebdd55e20d48d65e1db151a33ca7b4aa078cd783bf413318bf725847849adacfa4f36e11a4cc58e1f0fa61a70401624202c04570e7df65449ec8a58a6795ae19041a1be068ca08551801791ee3d14439855e641a2ea96fce7a5d5eab6957094360150d5648cd2b2b11cdc39b5c4896fcb78ac38e7f07548857a957bcb55d1439fd89af930252fd9af38d02d559174fbb9709fe917af662af95b6bef749d8eb563b287f0cddd41a4f3421a23cc2e0302edc4d7b9aec6630eec78117152d1f2e7cfa1db9aefca14044becb4c9d8094f7fca0ca091b9d9031957091f2577c32023fbf59d4cb53d9d90ff7c07990d622d1d0ada28cc4c8002b352a5df2b9c80f55d74fb6c04d070e259b38e973855ebe20a3d12a72a05df8577d59bbe3addfebd95e1297e20824cb064e340434eb835790b7196fb01430885688f6e6567bd4211f4597b4b35f097a0fb6a658b839d109128e14b7ce54d85576b0330793c9135939c1fc4539da8cb4d917bcd60d8a4829cb5dfdad1a636ee843ba86e04c28509c7e19c251b6eef733b141be4944fabb84336729a2a4437666a2be9cda1c4683faeadb03cd8405809d7d1f88f054013385c68e11e05f798b3656272669c795ff2554111225d4b63f8607c839769651f37b6a6700c2e356e99c57e2efddddc2dbd1b6ba6862292e7ee261e6ba62fdac9f042499c93726cf6a6c8d5de92ccb0d53a90972cf04fcb0237cf423f99c9cfc7b91f8843552370c49aa6ce217805f3314bf9bc2a90b6151d52e179119ea0e3fa20febb78faa1433a90782379923b3ad431e732311990cce94007b837097316ca250be28ef0f96a43c169ad754b2da8edfbf181822807449460f9275af1c6e2eea3e83d1410046bcbd5a4c88fc399f2c91cbc3fa6f68580c39393474469e22398dabbb1d5d5472faff95e8ae5ecb942f99679fbad11ddfe22c8c7665b3f7545b65c42df175daa0dfd020b4ab58e33e6de15a36f90b356e17dadf2111458bc7cbdf37cb0a3ad57b6cb606845306fa631a86da5bf354134287c8bfeae67b57104eebc37deffd8ef651872703169f451bba2cc512aca7de19ef8c46dd19db5f1f45446f409e0975cd8e4dba6d1dc5a152b5f2551cfae82f5d50281dde2253ff35b391d9216ed2b72ca468faa12873bf3beb3ef0bbe65347dc2a645fa623ad5824def3a022ecc9748a807d12cb18982f454360d0daa1deeddc770dc335d372fa8cb5e59a487773402223ced238bb1d8a20cdd6d6c81a75d1cac2d2330560973251f3fa6cd25fa2d0a73a2324323b9331298dd34b453be5c8425f3ce879d8629aaf2024a67bef110b9e9d167183a748d300f0da2f4f0c01962ac586deea4c340f03273827ab377e805ccc87889b6d13fdb4c9e539ea57af01ec17ee8961385aee12b628117fe374e7d1c9be7c442d23f8818605b7a3090e0a9dbe8685f5ad7557de8dda3d4aafc92d349fd6b9687da84fce242cf5f0a3b2af044d518c5be2aa525a10d4cbb50a350cd69d842c0938835871cbcf849212f0df0acb4444a7e4f1c212f2d05280b2975831044ccfc66d05984fbc1519987df1c7d474d1764789fbbc89b8bf3e9afa3ab8922d8507648d6ead562a1d9f5c26f24318250f12fdbcef11a7b7098899e8e59e588f1236e8a1798603090d3a1229b5d0b83910e216a60279cb7ff529b0f2eefc987ff60d0f10032c6cc26e97e1ec8ddf1bee9c94d35224dc5814aeb05bdcd667c7c51a630efcfd0f0ddeec0a73ce4c68c19a56474c126a2689ecf63110c5047c74e1168d0861922722d00778c0bdcd1d88d3f7cb2a5d62ebffb41d6789a52f11aeb964c875b107457aa33df05382e698a4648ebcd67f12b32dc7f30a578ae2641b43d73ac556d4adeb4d35f5b3dae2066ff0127188e8d892a75cc9269f20139d4e1d0af57b9e85d000cef1734ab9a49785287f1000ff0f2b73ca912210d7a4b74d1978fc21dbf5835d3ff88a7de9a81e9dca7bcf789310fdc0d4fb8a7c9495430fdaa634438a92dd1549ab6c7d51ee9b0ffeb4e5e5505f5891848077bb9a1a43aa4e41366c8ab568751105783c95e0d533a0fabef0ad0dcb2ce1df3c4abcbf53738077b66c407941e98dcd4c832dc47984f86111b331ac45f61c195ae5c9737e70da7d08f6d9927c414327568404bc65b7ead3226f13209e7452ff9f6e4ce01544a4353521846be26f68538f0e296241184eb712ed0179603bf5abb1435516e32dc7b45a83f47a01ec474fc6fa73d44c57f4eabf900066bf87e3a98713bd3928332db85db7d98478d5184b444422bcbc9580f7a134520ca4fc2da7be02f55c185012a07dbc6a76262b47eba8707bbef0ae76f1a7c6f2a7619b50ced7a6e6359ef7da8e3b1724305f7915f7f4f4ac44138016812953170a04403dec53d3a20c6f34111072bfe29a67b2bed46e4062ef097faf2095aca20c1c8e7ab445f9716f89bdc62811978ce8a9845ef6abfc305370bae96684e0b5ab7bf9ef952aa3cc33ecd8c090ff397e59fde40814389c5fc1af20327ca7924769e2afe1d3eddf6b34a695404af1b91aad82742f7e0c6e05dbf47adc19c7840bd78cb6309adf083642b0f9b82f581e9240d0c6b6e508150535be7f58e8d0833e40fa8e83ac7250cc0c5ea577ae4cb65b7e7ea8c2588c41842871c1c37176057cc8082a464b2a4d8570c2daae1aefd2884aa8e54d3f4465c68cafd473d6f2702017dfa47efe36dfab337defff29b0e9b86af2964917ddbc07dcddd8b468c6e9b1bb81bdd05e62948e6dabaf7ba7779bf07440c0a11eec0abe7517f42279a84e5f73b39119c278b56adbbd42fa4f1b563409782e89b9db27129a752ddf8e24b688ebfa802a3677242e91eaf50847464427a497ee123d4da2a86db02c94958832908d8800b18e031414ee30c9b42f018598c4bc65b57db0bc018d97602033206fad27ead247da382693207bcdc985b15f7fb4b8fa4a271799f48064a858e104e26b4dbc11535d669e22178c643e9f615291b7907a1c2569b9b68da2909101ed0b9bf326bc5ff0eca4a6fdae14c7fa51e43347dd44d6c496d6b68d59af4260b39b79457462d1610807c23d9ccdfe655be8e01e631192dbcb6324ca3bb210140d12ef8fb1e3524c4ddab42a98e2cd739c070197fd993c5ce7650b425081102dee40ba0bf98d3f984750d7a1db3e4a2f416de98f37316206056738631e20342c6d20a6b4cff932482f73b3ec3c20f8975c69658726e1194cfff8167fd1e0c25039ee32ae94e3f0beaac32621beff9ad4986fa2f436914da6384fe769b6f879368d044593e1e4c2818bca0f8965f39cd3ddd86d1c9aa2963670807bb5cfbb7ffe659ebd14ed1910d8b4a51527f6cb62c75bff803b6ed9421ad651faa2ed5e2d82c16b9725fadfe1e47b1e9699c53d96cba230c4f96037913f3e03c4dca818ebde4c002af41a542120577c735ccb7572b4a11bd68736f08d49f507c61187f898ad9789b80d3a9e16234d807721cf9458d2b109a08b9a3b2b54eeaafc844c25f8dc22471c94ca2ef1567bba61d84e0b8678561cce698fc129279bb8348335d52ee68db2fc8b5df76c334cf50ccc2ef85ba90d8f15a425896eed8608ed7ccc92c1cf163a3630c2814698e4c0cf7c139cc082e59b458a25806fa8b8ac1911ef0d2a51623b35e79f41fdbc567c769b3ef66ab9b969176d3ee3931eeb24eb24d2b8b55e9addd12c569f9b836d2b1a6726c6cadc59099bfd0dba4f2ee1eaa8cd7346f1b1cfba3322b80a8e51fd0fba67b245b99289086efad0858d2e72bdde380ecac5b674e825395e3207b79abfc336137f150b565f5a09b8cd82440923aa9979bc872223cd9ebf5550ddf958a15e7302802272fd804e8bf7d8029df59a6c18d9d624a0419bb22cabf11821d2764043b84e2bed590a3802af67d2b2469a5e17a9bcf94ab9f0409f6b0195387d3f5bfea86ebceba64dbc188242d90e014acffac24f751f7aac1ca4d9b42dcfa4a8c70c00dc825af0c0a868ef55e11546e98fd83cfa53bb959065f308c8630728bf061dba61bd79ed89d1139b9e8a81e79cdcba04a5bf3a52afb1880603250cbd15bb82b8a51f8b9dbe87b85f4808d8a29e107152d502d5ba8b4d0d8784bfc3f3c60bfa5c5c515d84454fbf74cf362bae587b9a27293546aef8048627bdc1eb88eafff70505b8eaefba774c37c2e8aecb41f986de4831efde6d76109cd6d7336ee18b07d839c20d6f0ad16e735f4bf0b55b0636cab54546a2764ba9f33c13752a4b6f1a75b70f065aa629a9a4b4e2aac53e235d747c1eb5d86512c2eddb2da9c97542b1d7ab08c00fd712f55fca99319028c6b4d387f962b4c8f10d7ac6cbde206c477d415f2355fcbb2fbc2ef1a13c92663093c6c173203a8339b26163c5dc126774839fbfda3ddb764c640fd3d3b2eaba82db074349c4ff6cfa37507bb9efe8cc7003bc4f84c7e93beb5dda002b0df99061b35b4194690669addc5d66a4e052fdaefe53096511f8623839476fe1df3967d70bf54de79b56572c1b57a2fa8bac5c0ce247e69b7d66b0a89eb11efe355ee893a4722b2f349e590f26bd08dd06f1cac36109a7c80ca65043f189515c2db5a948709ddd9f319853cf71ae61b3efcd1c80d7da541d2dc6b2ac3fd1ae10fabe7db17b586285119a2cb3b18811a0454e62ca4afdf834c7b2fa6c1320052801b01a71dcfaaf139413d17b0bf07939d03915f6958ddf245cad6b4a1847d0f67e068b94caf4b30dbfefbc4bca6efc941aa053002a258f59d0196e02b11e1521dc3f04ded36d1d6e2eeeeedd494fdfdaf6cf3d6270481d35f7cff0254267c4808f5f4d775e58a4567d54e1bd1e2c8f4096b4e4f0506710855858764fbdc1d6fc3085625695d1d50ff384b63a5fc0eeff690fe7d37beab49cdf75450d568345f7b8f9d18d095ae0f0577883417f06226abdedeedd7c202c5239323aeb6b7d42af09bc460e63d8e408524160fdfd0187fc399aa416b6ce30f0ead83165d2e796e1075f90e776c737531596c58216664f882f8f4785fbd60254a8fb14174a45cac84065025411db6a76ae2cea9cd0379ca2db74b023fa9b5c8fe3db69f11d8f95105e2815c6a4c</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-shrink">      <input class="hbe hbe-input-field hbe-input-field-shrink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-shrink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-shrink">åŠ å¯†æ–‡ç« , å¯†ç æ˜¯åšä¸»åå­—é¦–å­—æ¯+ç”Ÿæ—¥(3ä½å°å†™å­—æ¯+8ä½æ•°å­—)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RobustMQåˆä½“éªŒ</title>
      <link href="/2025/09/24/RobustMQ/"/>
      <url>/2025/09/24/RobustMQ/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="RobustMQåˆä½“éªŒ">RobustMQåˆä½“éªŒ</h2><p>ä¸€å¼€å§‹ç–¯ç‹‚è¸©å‘, ä¸€å¤§åŸå› æ˜¯æœåŠ¡å™¨æ˜¯centos 7.9ç‰ˆæœ¬çš„, æœ‰ç‚¹å¤ªæ—§äº†, åæ¥æ”¹ç”¨ubuntu 24.04å°±å¾ˆä¸æ»‘, å»ºè®®æ—©æ—¥æ”¾å¼ƒè€å¤è‘£doge</p><p>è¿›å…¥<a href="https://github.com/robustmq/robustmq/releases">RobustMQ v0.2.0-RELEASE</a>ä¸‹è½½åˆé€‚çš„ç‰ˆæœ¬, æˆ‘çš„æœåŠ¡å™¨æ˜¯x86_64æ¶æ„çš„, æ‰€ä»¥ä¸‹è½½Linux AMD64 (robustmq-v0.2.0-RELEASE-linux-amd64.tar.gz)è¿™ä¸ªç‰ˆæœ¬, ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š</p><h3 id="å®‰è£…ä»¥åŠåŸºæœ¬åŠŸèƒ½">å®‰è£…ä»¥åŠåŸºæœ¬åŠŸèƒ½</h3><ol><li>è§£å‹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf robustmq-v0.2.0-RELEASE-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> robustmq-v0.2.0-RELEASE--linux-amd64</span><br></pre></td></tr></table></figure><ol start="2"><li>quick start</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/robust-server start</span><br></pre></td></tr></table></figure><ol start="3"><li>æ˜¯å¦å¯åŠ¨æˆåŠŸ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">./bin/robust-server status</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚ä¸‹</span></span><br><span class="line">   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— Q â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â”‚</span><br><span class="line">    â”‚    â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•   â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•   â”‚</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â”‚    ğŸ¦€ Next-Generation Cloud-Native Message Queue                            â”‚</span><br><span class="line">    â”‚    âš¡ Built with Rust â€¢ AI-Native â€¢ Multi-Protocol                          â”‚</span><br><span class="line">    â”‚    ğŸš€ Microsecond Latency â€¢ Zero GC â€¢ Serverless Ready                      â”‚</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</span><br><span class="line">    ()ğŸš€ Checking RobustMQ status...</span><br><span class="line">âœ… RobustMQ Status: Online</span><br><span class="line">ğŸ“‹ Version: &lt;!doctype html&gt;&lt;html&gt;&lt;<span class="built_in">head</span>&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;icon&quot;</span> href=<span class="string">&quot;/favicon.png&quot;</span>&gt;&lt;title&gt;RobustMQ Admin&lt;/title&gt;&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;&lt;meta name=<span class="string">&quot;theme-color&quot;</span> content=<span class="string">&quot;#fff&quot;</span>&gt;&lt;meta name=<span class="string">&quot;title&quot;</span> content=<span class="string">&quot;RobustMQ Admin&quot;</span>&gt;&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;RobustMQ Admin&quot;</span>&gt;&lt;script defer src=<span class="string">&quot;/static/js/lib-axios.76b6753e.js&quot;</span>&gt;&lt;/script&gt;&lt;script defer src=<span class="string">&quot;/static/js/lib-react.f575643e.js&quot;</span>&gt;&lt;/script&gt;&lt;script defer src=<span class="string">&quot;/static/js/860.b2877b0c.js&quot;</span>&gt;&lt;/script&gt;&lt;script defer src=<span class="string">&quot;/static/js/index.3c84183d.js&quot;</span>&gt;&lt;/script&gt;&lt;<span class="built_in">link</span> href=<span class="string">&quot;/static/css/index.af1f9b70.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;preconnect&quot;</span> href=<span class="string">&quot;https://fonts.googleapis.com&quot;</span>&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;preconnect&quot;</span> href=<span class="string">&quot;https://fonts.gstatic.com&quot;</span> crossOriginIsolated&gt;&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;family=Manrope:wght@200..800&amp;display=swap&quot;</span>&gt;&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;window.__APP_CONFIG__ = &#123;<span class="string">&quot;ports&quot;</span>:&#123;<span class="string">&quot;dev&quot;</span>:3000,<span class="string">&quot;preview&quot;</span>:3000,<span class="string">&quot;build&quot;</span>:3000&#125;,<span class="string">&quot;app&quot;</span>:&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;RobustMQ Admin&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;RobustMQ Admin&quot;</span>,<span class="string">&quot;themeColor&quot;</span>:<span class="string">&quot;#fff&quot;</span>&#125;,<span class="string">&quot;dev&quot;</span>:&#123;<span class="string">&quot;host&quot;</span>:<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;open&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;hot&quot;</span>:<span class="literal">true</span>&#125;,<span class="string">&quot;api&quot;</span>:&#123;<span class="string">&quot;baseUrl&quot;</span>:null,<span class="string">&quot;grpcUrl&quot;</span>:null,<span class="string">&quot;placementGrpcUrl&quot;</span>:null&#125;,<span class="string">&quot;defaults&quot;</span>:&#123;<span class="string">&quot;ports&quot;</span>:&#123;<span class="string">&quot;dev&quot;</span>:3000,<span class="string">&quot;preview&quot;</span>:3000,<span class="string">&quot;build&quot;</span>:3000&#125;,<span class="string">&quot;app&quot;</span>:&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;RobustMQ Admin&quot;</span>,<span class="string">&quot;description&quot;</span>:<span class="string">&quot;RobustMQ Admin&quot;</span>,<span class="string">&quot;themeColor&quot;</span>:<span class="string">&quot;#fff&quot;</span>&#125;,<span class="string">&quot;dev&quot;</span>:&#123;<span class="string">&quot;host&quot;</span>:<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;open&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;hot&quot;</span>:<span class="literal">true</span>&#125;,<span class="string">&quot;api&quot;</span>:&#123;<span class="string">&quot;baseUrl&quot;</span>:null,<span class="string">&quot;grpcUrl&quot;</span>:null,<span class="string">&quot;placementGrpcUrl&quot;</span>:null&#125;&#125;&#125;;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;div <span class="built_in">id</span>=<span class="string">&quot;root&quot;</span>&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">ğŸŒ Server: 127.0.0.1:8080</span><br></pre></td></tr></table></figure><ol start="4"><li>æŸ¥çœ‹é…ç½®</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">./bin/robust-ctl cluster config get</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚ä¸‹</span></span><br><span class="line">  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— Q â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•šâ•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â”‚</span><br><span class="line">    â”‚    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â”‚</span><br><span class="line">    â”‚    â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•   â•šâ•â•â•â•  â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•   â”‚</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â”‚    ğŸ¦€ Next-Generation Cloud-Native Message Queue                            â”‚</span><br><span class="line">    â”‚    âš¡ Built with Rust â€¢ AI-Native â€¢ Multi-Protocol                          â”‚</span><br><span class="line">    â”‚    ğŸš€ Microsecond Latency â€¢ Zero GC â€¢ Serverless Ready                      â”‚</span><br><span class="line">    â”‚                                                                             â”‚</span><br><span class="line">    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</span><br><span class="line">    ()&#123;</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span>: <span class="string">&quot;robust_mq_cluster_default&quot;</span>,</span><br><span class="line">  <span class="string">&quot;broker_id&quot;</span>: 1,</span><br><span class="line">  <span class="string">&quot;roles&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;meta&quot;</span>,</span><br><span class="line">    <span class="string">&quot;broker&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;grpc_port&quot;</span>: 1228,</span><br><span class="line">  <span class="string">&quot;meta_addrs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;1&quot;</span>: <span class="string">&quot;127.0.0.1:1228&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;prometheus&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: 9090</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;log&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;log_config&quot;</span>: <span class="string">&quot;./config/broker-tracing.toml&quot;</span>,</span><br><span class="line">    <span class="string">&quot;log_path&quot;</span>: <span class="string">&quot;./logs&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;runtime&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;runtime_worker_threads&quot;</span>: 64,</span><br><span class="line">    <span class="string">&quot;tls_cert&quot;</span>: <span class="string">&quot;./config/certs/cert.pem&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tls_key&quot;</span>: <span class="string">&quot;./config/certs/key.pem&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;network&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;accept_thread_num&quot;</span>: 8,</span><br><span class="line">    <span class="string">&quot;handler_thread_num&quot;</span>: 32,</span><br><span class="line">    <span class="string">&quot;response_thread_num&quot;</span>: 8,</span><br><span class="line">    <span class="string">&quot;queue_size&quot;</span>: 1000,</span><br><span class="line">    <span class="string">&quot;lock_max_try_mut_times&quot;</span>: 30,</span><br><span class="line">    <span class="string">&quot;lock_try_mut_sleep_time_ms&quot;</span>: 50</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;p_prof&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;port&quot;</span>: 6060,</span><br><span class="line">    <span class="string">&quot;frequency&quot;</span>: 100</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;meta_runtime&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;heartbeat_timeout_ms&quot;</span>: 30000,</span><br><span class="line">    <span class="string">&quot;heartbeat_check_time_ms&quot;</span>: 1000</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;rocksdb&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;data_path&quot;</span>: <span class="string">&quot;./data&quot;</span>,</span><br><span class="line">    <span class="string">&quot;max_open_files&quot;</span>: 10000</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;journal_server&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;tcp_port&quot;</span>: 1778</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;journal_runtime&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable_auto_create_shard&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;shard_replica_num&quot;</span>: 2,</span><br><span class="line">    <span class="string">&quot;max_segment_size&quot;</span>: 1073741824</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;journal_storage&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;data_path&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;./data/journal/&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;rocksdb_max_open_files&quot;</span>: 10000</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_server&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;tcp_port&quot;</span>: 1883,</span><br><span class="line">    <span class="string">&quot;tls_port&quot;</span>: 1884,</span><br><span class="line">    <span class="string">&quot;websocket_port&quot;</span>: 8083,</span><br><span class="line">    <span class="string">&quot;websockets_port&quot;</span>: 8084,</span><br><span class="line">    <span class="string">&quot;quic_port&quot;</span>: 9083</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_keep_alive&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;default_time&quot;</span>: 180,</span><br><span class="line">    <span class="string">&quot;max_time&quot;</span>: 3600,</span><br><span class="line">    <span class="string">&quot;default_timeout&quot;</span>: 2</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_auth_storage&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;storage_type&quot;</span>: <span class="string">&quot;placement&quot;</span>,</span><br><span class="line">    <span class="string">&quot;journal_addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mysql_addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;postgres_addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;redis_addr&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_auth_config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;auth_type&quot;</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">    <span class="string">&quot;authn_config&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;jwt_config&quot;</span>: null,</span><br><span class="line">      <span class="string">&quot;password_config&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;credential_type&quot;</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">        <span class="string">&quot;algorithm&quot;</span>: <span class="string">&quot;plain&quot;</span>,</span><br><span class="line">        <span class="string">&quot;salt_position&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;salt_rounds&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;mac_fun&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;iterations&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;dk_length&quot;</span>: null</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;http_config&quot;</span>: null</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;authz_config&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_message_storage&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;storage_type&quot;</span>: <span class="string">&quot;memory&quot;</span>,</span><br><span class="line">    <span class="string">&quot;journal_addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mysql_addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rocksdb_data_path&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rocksdb_max_open_files&quot;</span>: null</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_runtime&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;default_user&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;default_password&quot;</span>: <span class="string">&quot;robustmq&quot;</span>,</span><br><span class="line">    <span class="string">&quot;max_connection_num&quot;</span>: 1000000</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_offline_message&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;expire_ms&quot;</span>: 0,</span><br><span class="line">    <span class="string">&quot;max_messages_num&quot;</span>: 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_slow_subscribe_config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;record_time&quot;</span>: 1000,</span><br><span class="line">    <span class="string">&quot;delay_type&quot;</span>: <span class="string">&quot;Whole&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_flapping_detect&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;window_time&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;max_client_connections&quot;</span>: 15,</span><br><span class="line">    <span class="string">&quot;ban_time&quot;</span>: 5</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_protocol_config&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max_session_expiry_interval&quot;</span>: 1800,</span><br><span class="line">    <span class="string">&quot;default_session_expiry_interval&quot;</span>: 30,</span><br><span class="line">    <span class="string">&quot;topic_alias_max&quot;</span>: 65535,</span><br><span class="line">    <span class="string">&quot;max_qos&quot;</span>: 2,</span><br><span class="line">    <span class="string">&quot;max_packet_size&quot;</span>: 10485760,</span><br><span class="line">    <span class="string">&quot;receive_max&quot;</span>: 65535,</span><br><span class="line">    <span class="string">&quot;max_message_expiry_interval&quot;</span>: 3600,</span><br><span class="line">    <span class="string">&quot;client_pkid_persistent&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_security&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;is_self_protection_status&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;secret_free_login&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_schema&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;strategy&quot;</span>: <span class="string">&quot;ALL&quot;</span>,</span><br><span class="line">    <span class="string">&quot;failed_operation&quot;</span>: <span class="string">&quot;Discard&quot;</span>,</span><br><span class="line">    <span class="string">&quot;echo_log&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;log_level&quot;</span>: <span class="string">&quot;info&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mqtt_system_monitor&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;os_cpu_high_watermark&quot;</span>: 70.0,</span><br><span class="line">    <span class="string">&quot;os_memory_high_watermark&quot;</span>: 80.0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="5"><li>åŸºæœ¬åŠŸèƒ½æµ‹è¯•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install mqttx client (if not already installed)</span></span><br><span class="line">npm install -g mqttx-cli</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œå‘ç‰ˆçš„é¡µé¢æ˜¯æ²¡æœ‰å†™æ˜è¦ç”¨æˆ·åå’Œå¯†ç çš„, æœ‰ç‚¹å°å‘ğŸ˜ƒ</span></span><br><span class="line"><span class="comment"># Publish message</span></span><br><span class="line">mqttx pub -h 127.0.0.1 -p 1883 -u admin -P robustmq -t <span class="string">&quot;test/topic&quot;</span> -m <span class="string">&quot;Hello RobustMQ!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Subscribe to messages</span></span><br><span class="line">mqttx sub -h 127.0.0.1 -p 1883 -u admin -P robustmq -t <span class="string">&quot;test/topic&quot;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸ, ç»“æœå¦‚å›¾:<br><img src="https://s3.bitiful.net/pb01/200.png" alt="avatar"><br><img src="https://s3.bitiful.net/pb01/201.png" alt="avatar"></p><ol start="6"><li>æŸ¥çœ‹å‰ç«¯<br>æˆ‘ä»¬åº”è¯¥æ˜¯æœ‰distç›®å½•çš„, æœ‰çš„è¯å°±æœ‰Web UI, ç„¶åå¼€æ”¾8080ç«¯å£, è®¿é—®å³å¯, å¦‚å›¾:<br><img src="https://s3.bitiful.net/pb01/203.png" alt="avatar"></li></ol><h3 id="ç®€å•æµ‹è¯•">ç®€å•æµ‹è¯•</h3><p>è¿™é‡Œæ˜¯è¦å¤–éƒ¨å®‰è£…mqttx cliæµ‹çš„, ä¹‹å‰çš„æ˜¯åœ¨æœåŠ¡å™¨ä¸Šçš„åŸºæœ¬åŠŸèƒ½æµ‹è¯•</p><ol><li>æµ‹è¯•å‘å¸ƒ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mqttx bench pub -h æœåŠ¡å™¨ip -p 1883 -u admin -P robustmq -c 1000 -im 1000 -t <span class="string">&quot;test/baseline&quot;</span> -S 128B -q 0 -v</span><br></pre></td></tr></table></figure><p>æˆ‘çš„æœåŠ¡å™¨æ˜¯4C4G3Mçš„é…ç½®, æœ€å¤§è¿æ¥æ•°945, è¿™é‡Œåº”è¯¥æ˜¯è¢«æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ä½äº†è¿æ¥æ•°, æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ä¸€ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-20-16-ubuntu:~$ <span class="built_in">ulimit</span> -n</span><br><span class="line">1024</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹è¿æ¥ç¬¦çš„é™åˆ¶, è®¾ä¸ºæ— é™å¤§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹:</span></span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br></pre></td></tr></table></figure><p>å…³é—­è¿æ¥åé‡æ–°è¿æ¥, å†æ¬¡æŸ¥è¯¢:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-20-16-ubuntu:~$ <span class="built_in">ulimit</span> -n</span><br><span class="line">65535</span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•, è¿™æ—¶1000ä¸ªè¿æ¥å°±èƒ½éšä¾¿è¾¾åˆ°äº†, æˆ‘ä»¬ç»§ç»­åŠ ç æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mqttx bench pub -h æœåŠ¡å™¨ip -p 1883 -u admin -P robustmq -c 100000 -im 1000 -t <span class="string">&quot;test/baseline&quot;</span> -S 128B -q 0 -v</span><br></pre></td></tr></table></figure><p>å³°å€¼è¿æ¥æ•°ä¸º12903, æ­¤æ—¶å†…å­˜åˆ©ç”¨ç‡çº¦ä¸º77%, cpuåˆ©ç”¨ç‡çº¦ä¸º8%, ä½†å¾ˆè¯¡å¼‚çš„æ˜¯ä¸€æ®µæ—¶é—´åcpuåˆ©ç”¨ç‡è¾¾åˆ°äº†99%, æ­¤æ—¶å¤§é‡è¿æ¥ä¸­æ–­æ­£åœ¨å‘ç”Ÿé‡è¿, æœåŠ¡å™¨å‡ºç°ECONNRESET éŒ¯èª¤, æ— æ³•ç»§ç»­è¿›è¡Œæµ‹è¯•, æˆ‘çš„æ¨æµ‹å¯èƒ½æ˜¯å¿ƒè·³é£æš´å¯¼è‡´çš„, åç»­æœ‰ç©ºäº†å†æµ‹ä¸€ä¸‹<br><img src="https://s3.bitiful.net/pb01/204.png" alt="avatar"></p><ol start="2"><li>æµ‹è¯•æ¥æ”¶<br>mqttx bench sub -h 1.12.255.192 -p 1883 -u admin -P robustmq -c 10 -t â€œtest/baselineâ€ -q 0</li></ol><p>2200-2600/sçš„æ¥æ”¶é€Ÿåº¦, å¯ä»¥ç®—å‡ºè¿™ä¸ªæ¥æ”¶é€Ÿåº¦å’Œæˆ‘çš„3Mbpsçš„å¸¦å®½æ˜¯ååˆ†å»åˆçš„, å¸¦å®½å°±æ˜¯ç“¶é¢ˆ</p><h3 id="è¸©å‘è¿‡ç¨‹-å¯ä¸çœ‹">è¸©å‘è¿‡ç¨‹(å¯ä¸çœ‹)</h3><p>ä¸€å¼€å§‹æŒ‰ç…§å®˜ç½‘çš„<a href="https://robustmq.com/QuickGuide/Experience-MQTT.html">Experience-MQTT</a>çš„æµç¨‹æ¥, æœåŠ¡å™¨ç‰ˆæœ¬æ˜¯CentOS 7.9</p><h4 id="å°è¯•å¿«é€Ÿå¯åŠ¨">å°è¯•å¿«é€Ÿå¯åŠ¨</h4><p><strong>ä¸‹è½½å¹¶è§£å‹äºŒè¿›åˆ¶åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Download the latest version binary package (using v1.0.0 as an example)</span></span><br><span class="line">wget https://github.com/robustmq/robustmq/releases/download/v0.1.33/robustmq-v0.1.33-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract the binary package</span></span><br><span class="line">tar -xzf robustmq-v0.1.33-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enter the extracted directory</span></span><br><span class="line"><span class="built_in">cd</span> robustmq-v0.1.33-linux-amd64</span><br></pre></td></tr></table></figure><p><strong>å¯åŠ¨</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start Broker (using default configuration)</span></span><br><span class="line">./bin/broker-server start</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰è¿™ä¸ªç›®å½•, æ£€æŸ¥å‘ç°æ”¹åäº†, æ”¹æˆäº†robust-server, ç„¶åæ¥ç€å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/robust-server start</span><br></pre></td></tr></table></figure><p>å‘ç°è¿˜æ˜¯ä¸è¡Œ, ç»“æœæ˜¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Config: /root/robustmq-v0.1.33-linux-amd64/bin/../config/server.toml</span><br><span class="line">Starting RobustMQ broker server...</span><br><span class="line">âŒ WARN: broker started failure. please check detail <span class="keyword">in</span> /root/robustmq-v0.1.33-linux-amd64/logs/robustmq.log</span><br></pre></td></tr></table></figure><p>è¿›å»æŸ¥çœ‹æ—¥å¿—å†…å®¹, å‘ç°ç¼ºäº†ä¸€äº›åŒ…:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libm.so.6: version `GLIBC_2.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.20&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.8&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.9&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.26&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.30&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.21&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.11&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.22&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.30&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.18&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.28&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.25&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.32&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.33&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.34&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libm.so.6: version `GLIBC_2.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.20&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.8&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.9&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.26&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.30&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.21&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `CXXABI_1.3.11&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libstdc++.so.6: version `GLIBCXX_3.4.22&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.30&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.18&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.28&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.25&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.32&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.33&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.29&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line">/root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server: /lib64/libc.so.6: version `GLIBC_2.34&#x27; not found (required by /root/robustmq-v0.1.33-linux-amd64/bin/../libs/broker-server)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯CentOS 7.9è¿™ä¸ªç‰ˆæœ¬æœ‰ç‚¹ä½äº†, äºæ˜¯å†³å®šè‡ªå·±ç¼–è¯‘</p><h4 id="å°è¯•è‡ªå·±ç¼–è¯‘é¡¹ç›®">å°è¯•è‡ªå·±ç¼–è¯‘é¡¹ç›®</h4><p>é¦–å…ˆå®‰è£…rustç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 https://sh.rustup.rs -sSf | sh</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ¢æˆé˜¿é‡Œäº‘çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://mirrors.aliyun.com/repo/rust/rustup-init.sh | sh</span><br></pre></td></tr></table></figure><p>å¦‚æœé¡µé¢å‡ºç°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rust is installed now. Great!</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå·²ç»å®‰è£…æˆåŠŸ</p><p>éªŒè¯å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.cargo/env</span><br><span class="line">rustc --version</span><br><span class="line">cargo --version</span><br></pre></td></tr></table></figure><p>cloneé¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/robustmq/robustmq.git</span><br></pre></td></tr></table></figure><p>æ„å»ºå¹¶è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run --package cmd --bin broker-server</span><br></pre></td></tr></table></figure><p>æŠ¥é”™, ç¼ºå°‘ libclang è¿™ä¸ªåº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">error: failed to run custom build <span class="built_in">command</span> <span class="keyword">for</span> `zstd-sys v2.0.15+zstd.1.5.7`</span><br><span class="line"></span><br><span class="line">Caused by:</span><br><span class="line">  process didn<span class="string">&#x27;t exit successfully: `/root/rbmq/robustmq/target/debug/build/zstd-sys-fa921af4aeab9891/build-script-build` (exit status: 101)</span></span><br><span class="line"><span class="string">  --- stdout</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=ZSTD_SYS_USE_PKG_CONFIG</span></span><br><span class="line"><span class="string">  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span></span><br><span class="line"><span class="string">  OPT_LEVEL = Some(0)</span></span><br><span class="line"><span class="string">  TARGET = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  HOST = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  CC_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  CC_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_CC</span></span><br><span class="line"><span class="string">  HOST_CC = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC</span></span><br><span class="line"><span class="string">  CC = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span></span><br><span class="line"><span class="string">  RUSTC_WRAPPER = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span></span><br><span class="line"><span class="string">  CRATE_CC_NO_DEFAULTS = None</span></span><br><span class="line"><span class="string">  DEBUG = Some(true)</span></span><br><span class="line"><span class="string">  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS</span></span><br><span class="line"><span class="string">  CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_CFLAGS</span></span><br><span class="line"><span class="string">  HOST_CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  CARGO_ENCODED_RUSTFLAGS = Some()</span></span><br><span class="line"><span class="string">  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span></span><br><span class="line"><span class="string">  CRATE_CC_NO_DEFAULTS = None</span></span><br><span class="line"><span class="string">  TARGET = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span></span><br><span class="line"><span class="string">  HOST = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS</span></span><br><span class="line"><span class="string">  CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_CFLAGS</span></span><br><span class="line"><span class="string">  HOST_CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span></span><br><span class="line"><span class="string">  CRATE_CC_NO_DEFAULTS = None</span></span><br><span class="line"><span class="string">  TARGET = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span></span><br><span class="line"><span class="string">  HOST = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS</span></span><br><span class="line"><span class="string">  CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_CFLAGS</span></span><br><span class="line"><span class="string">  HOST_CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span></span><br><span class="line"><span class="string">  CRATE_CC_NO_DEFAULTS = None</span></span><br><span class="line"><span class="string">  TARGET = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span></span><br><span class="line"><span class="string">  HOST = Some(x86_64-unknown-linux-gnu)</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS</span></span><br><span class="line"><span class="string">  CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_CFLAGS</span></span><br><span class="line"><span class="string">  HOST_CFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  CFLAGS_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  exit status: 0</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=AR_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  AR_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=AR_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  AR_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_AR</span></span><br><span class="line"><span class="string">  HOST_AR = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=AR</span></span><br><span class="line"><span class="string">  AR = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=ARFLAGS</span></span><br><span class="line"><span class="string">  ARFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=HOST_ARFLAGS</span></span><br><span class="line"><span class="string">  HOST_ARFLAGS = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=ARFLAGS_x86_64_unknown_linux_gnu</span></span><br><span class="line"><span class="string">  ARFLAGS_x86_64_unknown_linux_gnu = None</span></span><br><span class="line"><span class="string">  cargo:rerun-if-env-changed=ARFLAGS_x86_64-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  ARFLAGS_x86_64-unknown-linux-gnu = None</span></span><br><span class="line"><span class="string">  cargo:rustc-link-lib=static=zstd</span></span><br><span class="line"><span class="string">  cargo:rustc-link-search=native=/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out</span></span><br><span class="line"><span class="string">  cargo:root=/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out</span></span><br><span class="line"><span class="string">  cargo:include=/root/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/zstd-sys-2.0.15+zstd.1.5.7/zstd/lib</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  --- stderr</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  thread &#x27;</span>main<span class="string">&#x27; panicked at /root/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/bindgen-0.71.1/lib.rs:604:27:</span></span><br><span class="line"><span class="string">  Unable to find libclang: &quot;couldn&#x27;</span>t find any valid shared libraries matching: [<span class="string">&#x27;libclang.so&#x27;</span>, <span class="string">&#x27;libclang-*.so&#x27;</span>, <span class="string">&#x27;libclang.so.*&#x27;</span>, <span class="string">&#x27;libclang-*.so.*&#x27;</span>], <span class="built_in">set</span> the `LIBCLANG_PATH` environment variable to a path <span class="built_in">where</span> one of these files can be found (invalid: [])<span class="string">&quot;</span></span><br><span class="line"><span class="string">  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span></span><br><span class="line"><span class="string">warning: build failed, waiting for other jobs to finish...</span></span><br></pre></td></tr></table></figure><p>å®‰è£… Clang å’Œå®ƒçš„å¼€å‘åº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install clang-devel</span><br></pre></td></tr></table></figure><p>ä¾æ—§æŠ¥é”™, ç‰ˆæœ¬å¤ªæ—§äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error: failed to run custom build <span class="built_in">command</span> <span class="keyword">for</span> `zstd-sys v2.0.15+zstd.1.5.7`</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡†å¤‡å‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install centos-release-scl</span><br><span class="line">sudo yum install llvm-toolset-14</span><br></pre></td></tr></table></figure><p>å†æ¬¡é‡åˆ°æŠ¥é”™, æ— æ³•è¿æ¥åˆ°å®˜æ–¹ä»“åº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Repository base is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository updates is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository extras is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository centosplus is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">Could not retrieve mirrorlist http://mirrorlist.centos.org?<span class="built_in">arch</span>=x86_64&amp;release=7&amp;repo=sclo-rh error was</span><br><span class="line">14: curl<span class="comment">#6 - &quot;Could not resolve host: mirrorlist.centos.org; Name or service not known&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> One of the configured repositories failed (Unknown),</span><br><span class="line"> and yum doesn<span class="string">&#x27;t have enough cached data to continue. At this point the only</span></span><br><span class="line"><span class="string"> safe thing yum can do is fail. There are a few ways to work &quot;fix&quot; this:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     1. Contact the upstream for the repository and get them to fix the problem.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     2. Reconfigure the baseurl/etc. for the repository, to point to a working</span></span><br><span class="line"><span class="string">        upstream. This is most often useful if you are using a newer</span></span><br><span class="line"><span class="string">        distribution release than is supported by the repository (and the</span></span><br><span class="line"><span class="string">        packages for the previous distribution release still work).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     3. Run the command with the repository temporarily disabled</span></span><br><span class="line"><span class="string">            yum --disablerepo=&lt;repoid&gt; ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     4. Disable the repository permanently, so yum won&#x27;</span>t use it by default. Yum</span><br><span class="line">        will <span class="keyword">then</span> just ignore the repository <span class="keyword">until</span> you permanently <span class="built_in">enable</span> it</span><br><span class="line">        again or use --enablerepo <span class="keyword">for</span> temporary usage:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --<span class="built_in">disable</span> &lt;repoid&gt;</span><br><span class="line">        or</span><br><span class="line">            subscription-manager repos --<span class="built_in">disable</span>=&lt;repoid&gt;</span><br><span class="line"></span><br><span class="line">     5. Configure the failing repository to be skipped, <span class="keyword">if</span> it is unavailable.</span><br><span class="line">        Note that yum will try to contact the repo. when it runs most commands,</span><br><span class="line">        so will have to try and fail each time (and thus. yum will be be much</span><br><span class="line">        slower). If it is a very temporary problem though, this is often a <span class="built_in">nice</span></span><br><span class="line">        compromise:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --save --<span class="built_in">setopt</span>=&lt;repoid&gt;.skip_if_unavailable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Cannot find a valid baseurl <span class="keyword">for</span> repo: centos-sclo-rh/x86_64</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="å¼€å§‹è¯¢é—®AI">å¼€å§‹è¯¢é—®AI</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å‘å°å­˜æœåŠ¡å™¨</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s/mirrorlist/#mirrorlist/g&#x27;</span> /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line">sudo sed -i <span class="string">&#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27;</span> /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é™¤ç¼“å­˜, é‡æ–°ç”Ÿæˆç¼“å­˜</span></span><br><span class="line">sudo yum clean all</span><br><span class="line">sudo yum makecache</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŠ¥é”™:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo yum makecache</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Repository base is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository updates is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository extras is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository centosplus is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> One of the configured repositories failed (Unknown),</span><br><span class="line"> and yum doesn<span class="string">&#x27;t have enough cached data to continue. At this point the only</span></span><br><span class="line"><span class="string"> safe thing yum can do is fail. There are a few ways to work &quot;fix&quot; this:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     1. Contact the upstream for the repository and get them to fix the problem.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     2. Reconfigure the baseurl/etc. for the repository, to point to a working</span></span><br><span class="line"><span class="string">        upstream. This is most often useful if you are using a newer</span></span><br><span class="line"><span class="string">        distribution release than is supported by the repository (and the</span></span><br><span class="line"><span class="string">        packages for the previous distribution release still work).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     3. Run the command with the repository temporarily disabled</span></span><br><span class="line"><span class="string">            yum --disablerepo=&lt;repoid&gt; ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     4. Disable the repository permanently, so yum won&#x27;</span>t use it by default. Yum</span><br><span class="line">        will <span class="keyword">then</span> just ignore the repository <span class="keyword">until</span> you permanently <span class="built_in">enable</span> it</span><br><span class="line">        again or use --enablerepo <span class="keyword">for</span> temporary usage:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --<span class="built_in">disable</span> &lt;repoid&gt;</span><br><span class="line">        or</span><br><span class="line">            subscription-manager repos --<span class="built_in">disable</span>=&lt;repoid&gt;</span><br><span class="line"></span><br><span class="line">     5. Configure the failing repository to be skipped, <span class="keyword">if</span> it is unavailable.</span><br><span class="line">        Note that yum will try to contact the repo. when it runs most commands,</span><br><span class="line">        so will have to try and fail each time (and thus. yum will be be much</span><br><span class="line">        slower). If it is a very temporary problem though, this is often a <span class="built_in">nice</span></span><br><span class="line">        compromise:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --save --<span class="built_in">setopt</span>=&lt;repoid&gt;.skip_if_unavailable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Cannot find a valid baseurl <span class="keyword">for</span> repo: centos-sclo-sclo</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾å‘ç°<code>[centos-sclo-sclo]</code>çš„baseurl å’Œ mirrorlistéƒ½è¢«æ³¨é‡Šæ‰äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo sed -i &#x27;s/mirrorlist/#mirrorlist/g&#x27; /etc/yum.repos.d/CentOS-SCLo-sclo.repo</span></span><br><span class="line">sed: can<span class="string">&#x27;t read /etc/yum.repos.d/CentOS-SCLo-sclo.repo: No such file or directory</span></span><br><span class="line"><span class="string">[root@lavm-jatbzcwqtu robustmq]# grep -l &#x27;</span>centos-sclo-sclo<span class="string">&#x27; /etc/yum.repos.d/*.repo</span></span><br><span class="line"><span class="string">/etc/yum.repos.d/CentOS-SCLo-scl.repo</span></span><br><span class="line"><span class="string">[root@lavm-jatbzcwqtu robustmq]# sudo sed -i &#x27;</span>s/mirrorlist/<span class="comment">#mirrorlist/g&#x27; /etc/yum.repos.d/CentOS-SCLo-scl.repo</span></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo sed -i &#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27; /etc/yum.repos.d/CentOS-SCLo-scl.repo</span></span><br><span class="line"></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo yum clean all</span></span><br><span class="line"></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo yum makecache</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Repository base is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository updates is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository extras is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository centosplus is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> One of the configured repositories failed (Unknown),</span><br><span class="line"> and yum doesn<span class="string">&#x27;t have enough cached data to continue. At this point the only</span></span><br><span class="line"><span class="string"> safe thing yum can do is fail. There are a few ways to work &quot;fix&quot; this:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     1. Contact the upstream for the repository and get them to fix the problem.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     2. Reconfigure the baseurl/etc. for the repository, to point to a working</span></span><br><span class="line"><span class="string">        upstream. This is most often useful if you are using a newer</span></span><br><span class="line"><span class="string">        distribution release than is supported by the repository (and the</span></span><br><span class="line"><span class="string">        packages for the previous distribution release still work).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     3. Run the command with the repository temporarily disabled</span></span><br><span class="line"><span class="string">            yum --disablerepo=&lt;repoid&gt; ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     4. Disable the repository permanently, so yum won&#x27;</span>t use it by default. Yum</span><br><span class="line">        will <span class="keyword">then</span> just ignore the repository <span class="keyword">until</span> you permanently <span class="built_in">enable</span> it</span><br><span class="line">        again or use --enablerepo <span class="keyword">for</span> temporary usage:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --<span class="built_in">disable</span> &lt;repoid&gt;</span><br><span class="line">        or</span><br><span class="line">            subscription-manager repos --<span class="built_in">disable</span>=&lt;repoid&gt;</span><br><span class="line"></span><br><span class="line">     5. Configure the failing repository to be skipped, <span class="keyword">if</span> it is unavailable.</span><br><span class="line">        Note that yum will try to contact the repo. when it runs most commands,</span><br><span class="line">        so will have to try and fail each time (and thus. yum will be be much</span><br><span class="line">        slower). If it is a very temporary problem though, this is often a <span class="built_in">nice</span></span><br><span class="line">        compromise:</span><br><span class="line"></span><br><span class="line">            yum-config-manager --save --<span class="built_in">setopt</span>=&lt;repoid&gt;.skip_if_unavailable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Cannot find a valid baseurl <span class="keyword">for</span> repo: centos-sclo-sclo</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># grep -i &#x27;centos-sclo-sclo&#x27; /etc/yum.repos.d/*.repo</span></span><br><span class="line">/etc/yum.repos.d/CentOS-SCLo-scl.repo:<span class="comment"># CentOS-SCLo-sclo.repo</span></span><br><span class="line">/etc/yum.repos.d/CentOS-SCLo-scl.repo:[centos-sclo-sclo]</span><br><span class="line">/etc/yum.repos.d/CentOS-SCLo-scl.repo:[centos-sclo-sclo-testing]</span><br><span class="line">/etc/yum.repos.d/CentOS-SCLo-scl.repo:[centos-sclo-sclo-source]</span><br><span class="line">/etc/yum.repos.d/CentOS-SCLo-scl.repo:[centos-sclo-sclo-debuginfo]</span><br><span class="line"></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># cat /etc/yum.repos.d/CentOS-SCLo-scl.repo</span></span><br><span class="line"><span class="comment"># CentOS-SCLo-sclo.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please see http://wiki.centos.org/SpecialInterestGroup/SCLo for more</span></span><br><span class="line"><span class="comment"># information</span></span><br><span class="line"></span><br><span class="line">[centos-sclo-sclo]</span><br><span class="line">name=CentOS-7 - SCLo sclo</span><br><span class="line"><span class="comment"># baseurl=http://mirror.centos.org/centos/7/sclo/$basearch/sclo/</span></span><br><span class="line"><span class="comment">##mirrorlist=http://##mirrorlist.centos.org?arch=$basearch&amp;release=7&amp;repo=sclo-sclo</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line">[centos-sclo-sclo-testing]</span><br><span class="line">name=CentOS-7 - SCLo sclo Testing</span><br><span class="line">baseurl=http://buildlogs.centos.org/centos/7/sclo/<span class="variable">$basearch</span>/sclo/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line">[centos-sclo-sclo-source]</span><br><span class="line">name=CentOS-7 - SCLo sclo Sources</span><br><span class="line">baseurl=http://vault.centos.org/centos/7/sclo/Source/sclo/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line">[centos-sclo-sclo-debuginfo]</span><br><span class="line">name=CentOS-7 - SCLo sclo Debuginfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/centos/7/sclo/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-SCLo</span><br><span class="line"></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo sed -i -e &quot;s|^# baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|&quot; /etc/yum.repos.d/CentOS-SCLo-scl.repo</span></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo yum clean all</span></span><br><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># sudo yum makecache</span></span><br></pre></td></tr></table></figure><p>è§£å†³ä¹‹åç»§ç»­<code>cargo run --package cmd --bin broker-server</code>, åˆåˆåˆæŠ¥é”™äº†, è¿˜æ˜¯é‚£ä¸ªé—®é¢˜:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">[root@lavm-jatbzcwqtu robustmq]<span class="comment"># cargo run --package cmd --bin broker-server</span></span><br><span class="line">Â  Â Compiling zstd-sys v2.0.15+zstd.1.5.7</span><br><span class="line">Â  Â Compiling prost-validate-types v0.2.7</span><br><span class="line">error: failed to run custom build <span class="built_in">command</span> <span class="keyword">for</span> `prost-validate-types v0.2.7`</span><br><span class="line"></span><br><span class="line">Caused by:</span><br><span class="line">Â  process didn<span class="string">&#x27;t exit successfully: `/root/rbmq/robustmq/target/debug/build/prost-validate-types-c09b5767bec0495d/build-script-build` (exit status: 1)</span></span><br><span class="line"><span class="string">Â  --- stdout</span></span><br><span class="line"><span class="string">Â  cargo:rerun-if-changed=proto/validate/validate.proto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Â  --- stderr</span></span><br><span class="line"><span class="string">Â  Error: Custom &#123; kind: NotFound, error: &quot;Could not find `protoc`. If `protoc` is installed, try setting the `PROTOC` environment variable to the path of the `protoc` binary. To install it on Debian, run `apt-get install protobuf-compiler`. It is also available at https://github.com/protocolbuffers/protobuf/releasesÂ  For more information: https://docs.rs/prost-build/#sourcing-protoc&quot; &#125;</span></span><br><span class="line"><span class="string">warning: build failed, waiting for other jobs to finish...</span></span><br><span class="line"><span class="string">error: failed to run custom build command for `zstd-sys v2.0.15+zstd.1.5.7`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Caused by:</span></span><br><span class="line"><span class="string">Â  process didn&#x27;</span>t <span class="built_in">exit</span> successfully: `/root/rbmq/robustmq/target/debug/build/zstd-sys-fa921af4aeab9891/build-script-build` (<span class="built_in">exit</span> status: 101)</span><br><span class="line">Â  --- stdout</span><br><span class="line">Â  cargo:rerun-if-env-changed=ZSTD_SYS_USE_PKG_CONFIG</span><br><span class="line">Â  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span><br><span class="line">Â  OPT_LEVEL = Some(0)</span><br><span class="line">Â  TARGET = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  HOST = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_x86_64-unknown-linux-gnu</span><br><span class="line">Â  CC_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_x86_64_unknown_linux_gnu</span><br><span class="line">Â  CC_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_CC</span><br><span class="line">Â  HOST_CC = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC</span><br><span class="line">Â  CC = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span><br><span class="line">Â  RUSTC_WRAPPER = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span><br><span class="line">Â  CRATE_CC_NO_DEFAULTS = None</span><br><span class="line">Â  DEBUG = Some(<span class="literal">true</span>)</span><br><span class="line">Â  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS</span><br><span class="line">Â  CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_CFLAGS</span><br><span class="line">Â  HOST_CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span><br><span class="line">Â  CFLAGS_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span><br><span class="line">Â  CFLAGS_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  CARGO_ENCODED_RUSTFLAGS = Some()</span><br><span class="line">Â  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span><br><span class="line">Â  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span><br><span class="line">Â  CRATE_CC_NO_DEFAULTS = None</span><br><span class="line">Â  TARGET = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span><br><span class="line">Â  HOST = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS</span><br><span class="line">Â  CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_CFLAGS</span><br><span class="line">Â  HOST_CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span><br><span class="line">Â  CFLAGS_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span><br><span class="line">Â  CFLAGS_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span><br><span class="line">Â  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span><br><span class="line">Â  CRATE_CC_NO_DEFAULTS = None</span><br><span class="line">Â  TARGET = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span><br><span class="line">Â  HOST = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS</span><br><span class="line">Â  CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_CFLAGS</span><br><span class="line">Â  HOST_CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span><br><span class="line">Â  CFLAGS_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span><br><span class="line">Â  CFLAGS_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  OUT_DIR = Some(/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CC_ENABLE_DEBUG_OUTPUT</span><br><span class="line">Â  cargo:rerun-if-env-changed=CRATE_CC_NO_DEFAULTS</span><br><span class="line">Â  CRATE_CC_NO_DEFAULTS = None</span><br><span class="line">Â  TARGET = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  CARGO_CFG_TARGET_FEATURE = Some(fxsr,sse,sse2)</span><br><span class="line">Â  HOST = Some(x86_64-unknown-linux-gnu)</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS</span><br><span class="line">Â  CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_CFLAGS</span><br><span class="line">Â  HOST_CFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64_unknown_linux_gnu</span><br><span class="line">Â  CFLAGS_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=CFLAGS_x86_64-unknown-linux-gnu</span><br><span class="line">Â  CFLAGS_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  <span class="built_in">exit</span> status: 0</span><br><span class="line">Â  cargo:rerun-if-env-changed=AR_x86_64-unknown-linux-gnu</span><br><span class="line">Â  AR_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=AR_x86_64_unknown_linux_gnu</span><br><span class="line">Â  AR_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_AR</span><br><span class="line">Â  HOST_AR = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=AR</span><br><span class="line">Â  AR = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=ARFLAGS</span><br><span class="line">Â  ARFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=HOST_ARFLAGS</span><br><span class="line">Â  HOST_ARFLAGS = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=ARFLAGS_x86_64_unknown_linux_gnu</span><br><span class="line">Â  ARFLAGS_x86_64_unknown_linux_gnu = None</span><br><span class="line">Â  cargo:rerun-if-env-changed=ARFLAGS_x86_64-unknown-linux-gnu</span><br><span class="line">Â  ARFLAGS_x86_64-unknown-linux-gnu = None</span><br><span class="line">Â  cargo:rustc-link-lib=static=zstd</span><br><span class="line">Â  cargo:rustc-link-search=native=/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out</span><br><span class="line">Â  cargo:root=/root/rbmq/robustmq/target/debug/build/zstd-sys-ee0b72447b2c3d2e/out</span><br><span class="line">Â  cargo:include=/root/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/zstd-sys-2.0.15+zstd.1.5.7/zstd/lib</span><br><span class="line"></span><br><span class="line">Â  --- stderr</span><br><span class="line"></span><br><span class="line">Â  thread <span class="string">&#x27;main&#x27;</span> panicked at /root/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clang-sys-1.8.1/src/lib.rs:1859:1:</span><br><span class="line"></span><br><span class="line">Â  A `libclang` <span class="keyword">function</span> was called that is not supported by the loaded `libclang` instance.</span><br><span class="line"></span><br><span class="line">Â  Â  Â  called <span class="keyword">function</span> = `clang_getTranslationUnitTargetInfo`</span><br><span class="line">Â  Â  Â  loaded `libclang` instance = unsupported version</span><br><span class="line"></span><br><span class="line">Â  The minimum `libclang` requirement <span class="keyword">for</span> this particular <span class="keyword">function</span> can be found here:</span><br><span class="line">Â  https://docs.rs/clang-sys/latest/clang_sys/clang_getTranslationUnitTargetInfo/index.html</span><br><span class="line"></span><br><span class="line">Â  Instructions <span class="keyword">for</span> installing `libclang` can be found here:</span><br><span class="line">Â  https://rust-lang.github.io/rust-bindgen/requirements.html</span><br><span class="line"></span><br><span class="line">Â  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br></pre></td></tr></table></figure><p>å®‰è£… protocå’Œllvm-toolset-7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install protobuf-compiler</span><br><span class="line">sudo yum install llvm-toolset-7-clang llvm-toolset-7-clang-devel</span><br></pre></td></tr></table></figure><p>scl enable llvm-toolset-7 'cargo run --package cmd --bin broker-serverâ€™ä¹‹åæŠ¥é”™:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">error: failed to run custom build <span class="built_in">command</span> <span class="keyword">for</span> `prost-validate-types v0.2.7`</span><br><span class="line"></span><br><span class="line">Caused by:</span><br><span class="line">Â  process didn<span class="string">&#x27;t exit successfully: `/root/rbmq/robustmq/target/debug/build/prost-validate-types-c09b5767bec0495d/build-script-build` (exit status: 1)</span></span><br><span class="line"><span class="string">Â  --- stdout</span></span><br><span class="line"><span class="string">Â  cargo:rerun-if-changed=proto/validate/validate.proto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Â  --- stderr</span></span><br><span class="line"><span class="string">Â  Error: Custom &#123; kind: Other, error: &quot;protoc failed: validate.proto: No such file or directory\n&quot; &#125;</span></span><br><span class="line"><span class="string">warning: build failed, waiting for other jobs to finish...</span></span><br></pre></td></tr></table></figure><p>åé¢å†³å®šç›´æ¥æ¢ä¸ªæœåŠ¡å™¨, ä¸æŠ˜è…¾äº†ğŸ˜‹</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> RobustMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025ä¸ƒå…«æœˆç”Ÿæ´»è®°å½•</title>
      <link href="/2025/08/23/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/08/23/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="99698fb62a99fb793a3ebd641f1c13a1d98b20ed5beaae6edbe380008f82bafe">f33a6d5ec2003e353696027d8241bf513ca6f8cde9767d20028f3d9c2c0b7b5206646e5401a9f0abe3506ca31da6f942e4594c7544209382d91eb06eb4db8979240e72a0214c1d2b2b9b69c1729b8b68eebb36c4aa66c0f403fc702361aadde4cfccdaa8505dc94ee47827af1fd31d2a8cef6749b3c3b6edad385b807bf8c9aec310bc5133a24c1d77bf616762f45b15d01ce941ef5c43218b6c6ebff95828f272f386038ce9d368113c835c4a8a49c54626a4bad7634ce7f3ee1c431e226750b898a2931bba07bc7b1f22d6b1fbed38c8551384d3534ceac1fbd0439aac4ebdd55e20d48d65e1db151a33ca7b4aa078cd783bf413318bf725847849adacfa4f36e11a4cc58e1f0fa61a70401624202c04570e7df65449ec8a58a6795ae19041a1be068ca08551801791ee3d14439855e56c9dc4e5dc0505febf5d4587edfcad70c654c83c85cdc55fe12052d6b98001d8f2a890f3707cdace6285a634aaa092eab2259b708e3a4fb2b2a001aac5ef882050132ca1ff93f9ff286b99c3a4fdcb6e3b86e23ffdb57e000ef09f48698484b4c0c8c95f4b055ff54ea1b20d43c616b873fa7cc9247bc8c179dd5bb3f904c2a964521947f06b3f2843720c99be7e28ed1229cc2e858e617b82ef3520b66f10d1f03ae8dc6a056079ed482829e36e0edfcbcb9bbac6579addcd9773b15ee2870cc45ab7ce7926e3f07c23ec9e387732280372a0fa0538c2390ed99645385802a0a4cf750002658f161b53b3d77d07fd7aa8a0d51610eb6d00d4c3de2f9d8920ea7f7c916c65ad93a58d18ee0738a6b464469fbde7a7f84f22bbf395623bba61b247882c98f79fc56d4e6ed6c2590ee6afdfafea5cff3feeb8e9aab9118ffe4a696367b0c309935290c9b53ad06622ae26491e0b068650b82c33379dc021b63c4a2bd53c472b46b6d8bcca12dd64bbef7ca7fa02d29c47601f51f0004cb8dd1547832720bb7fe2508de82538b61ae8c7173e11153768b1b66d4641d7f6780b4b5a458436e5c143af9767f2470490adc3e9856eaaf40c9e2fc8f50bcc0e3015934c319dc12af62f4861174abbb1656add417b31fb422b9edb7a9a01690e329708d2724df4be3974d0819adc41d7128632b6de23b93bbe37f2b8da1a5a174e10eb4fcca0f8c392948a9081ab6b2918501450fcb0bdd06396bc5a629d1c903ecfcabd76086be415a9887ec620ee246d84077a21d98d377193d3d7a600bf3d97889790bf71d8273a6e3c1722aafa0648eef35ea7c453c98b16ac2ade2348609e08dc6fc10bda011bd6900f6d8799544c845378ec432524108bbfb45a9fa729194e720bff613134b397d359bcd7868507163378f109d8e9b100727cb854a149223c632f25af6502d23d3d607ef5616b1522ac3e878f9b958fd746821744d5bf9a38e2f0cd500b4d9edc0f8c9f5b5df25bb6ac1905dacef457f36c1553465be6a965000074e9a3424fc27c4aa3ce4275dbcb9cb81e9d6b8ae5330adbd6be8ab8cb55b9b2b0bf7b0fc121b0ee5667936897634880e15393adabca2165af52b7cc8745bf1ab93569fc07589c661c39eb59eee2e37e59a34bc896e21b950618d2b852dfeda7a4bf7df094e650da50b0f8274065dfc3a8e00288d40efdf1c6de395b0e57f9fc61ce8a4ed4e1a29f776aea670721608c5a9505bdadd52615cde1e4faa12931c2f75123cae5db31d0685dbed88266a2560b05390c09bfefca23fdc0fdac6f7655522c27b811d796506b6d63a59026c44e9cecf4c13d797a011fe5a63210b59bac677c517680460c49fd096f9ee6d67afdf054cbf0b570a5bb3d3fd79faa36075fbf4642598647f0a57478863e5dd5cfcf40c3d4876ddfb0971fde556ea5ac13bbb7782e35426a47b7f821e8ab9f97cdccf3810fd1a9f4c02bd9ef81f64f66dbc6566a8d63d5d9fb4785b3c0c3b9f58414c0026ede909e9dab02a9f99f2a43e6d14b8b615a1275da2de5d50d9ac5d7668b1c0da0acbb7c718d6e0b5c5de31d7730da4a4124aee2b93ffb70dddd9149aafedb27fa9ab6fef26c610e14c33567ce5e4a313fa5901a8819acb516ef0fb0806e43f0e79a467557221bcf53123e2a42ba3989e47e1dd1889fc4420179a42f06415644445a3097eb53e16ad55ffc5bca8a5fc8cf147a4e57f66968fe6f4c6bc7f676759e449784c0307a49c32cd8347cab7c6b8f9fa3ce291eefa039aad734e56370d16982f1f508aa34718c8b9380e686e714534945409e0d74fed1f477e9d1c34191f20c7d183fbbe8a39624e31c9642535f40b6f70a7097d1d1a2c194ac59690d61b350ca34a22c494b1f2698e16a8b8e8a3a8a40abbd06861b381f6598325af3a37665926c91e35cc55b185d502dbc43965689596d32b11832952e47f54c7c0d21b5dd0295a4498f672ae18f681142a6eadbed191defd9588ca76af00c24d6c14b64d5e8f825a18fb592f31feb1266c7ef6b3aebc42699d9e6c8cd4f2967acae82ab27ef49e6cd98e443219d19f16a719a7a7ea9b0932a4a364377a701e083d584ccd78d9c58eda09c3fd7f54c0f6194c488e28560ade8f873ea49aee3963fe2ed18eb4dc7c18a322177ad925516d4b6a497552b6e2ac4750291a08fe6c1df359dd9624fb9b3835d048fc15347a7e0b0b1a8408ca7cfd69ff70e18be067d7b0c96b1228f97125a65c3be6287f9954ee1662d0055206900c20ce97e8cb5b2b20922436fa5fd650da76a9d2b64716e629f225ba75bc1c7d2c8244a38cc8d986be8183b3cac67967b9f020c6bde03261c99db7d871546348ff870956321df4e0a1df6fc0f4a0796fe8ca48a4a6a529a7378d531ddfa77867eed06a9e248924dc9154be01cbcc8ff4e54fa437bf5b43538e73b99d4c85de66e1acbe150e81a79e75de2807bfacf719b79b5ec686e3f280a9e016e8849df881b7a850f5d4c178216580a5adb522711116297cc5198fb75121ac82338bdcf782c582553bc6914eb4789e330edc2be023dce2070a69cbd66b3ed5f01b503872aeef153a10ff3b160dc047150c904ae89588d985ce590e37fa1ffa986d8caa538859f045c0879953bf406c2f3e0e24da5bd423ba9ae5ea583051a7fb8371869893c3b63c4287a97043434e794c23441f415305483c70f3679dc47562fd0e4ba02877c91321560b482c86ff73fa3964fd8784db37309ad34bf4c4b22dcb909cc88e7815295f85aa040df9519470143ad5805bbf539fe821fcb66205538ae33cee74bcd8d8c30f0c900a1b7d5ed8f1702526df35ce868739ce4580a3f84156794877928f86ab909e61e3206a566dbbe67f741b023e3b1cd912431da1749cf21adf65d8830ffbdb70135f695e0d9360ddaf996df3ba3c716dbd297e7ed64b588edb18fa6ee5a2ec2a46bd13a8b36efca48fd6d9e68f9d9ce7ff84f73c0bba313e2d264c3a6fd3e1c1943c70c3cebc84c0020e16cc98f5ce9a60dff2d3d9d189509ce11e553df8ca91df03d53c64ff23b55313b14325219b210e4277a2bee4894f17eaf0d40add9de0b33ad1100f5f584c866a5477b4fed7266e1f4d268721e0825b5ece9d90fa2a294c86afefc95d35ae2a252f3e5cce85eb0ce8f682da0c29fc5cc9df35a9f00ff5c7d3b5c722b9bd3b55544c9c19263da2747c9469a9c95fbc5fd56b7f11aa64ac62c9194f9a9bd2df9d83a47ba3685822676dd104325526e1f29d00745acd6b4cecc63834711461d922d7b4146b1606b56fadda064bf931de897a6f092c3740a6eee0571c6c59dedc8eed83e570d2e6658496023b09b8062a64e62fd505507f985386e678e1e83dd0b784a74ca9d8facc5db9a14735755b8d0b1f79d27165f2aa8b68d4fc38c2a9e14d02ed3ac4eca7a4a03dac63912ef5b3cbc9f18c1699f5880a3806a84d7cfaf5a7b365b72dfeca5d2b8c55cab34da0b79fd490ca4f93c2f4128e1366257fd8d838d2e0486a749c7f8f1abe608864d93a68273858630ecc58b717e1215468d00186c7ad013bcf455d8a83341f35e0e9fb18ff241d23cd1102d26d14a83320a5d34e1d15af7bacefd2ec5cb7da18957bca0d2178854ef7a76a2e7c151ef282c1712d012a52787db0da878483f2c640b2c84676ebc3ef432632d6db722b19f42611713466416aae4ee1e2526f8536e547d27fb6c0ad7b947a494cc43f0619f15558225978c21370e134839519c9be9a1beb74238b95d6ce59fd65115259271bad713cbe2374ca47ada322eb1633e01bce31fa94de5d90f5a381c4b1f86139bfcf773e1b458ba7d57526aefbbc88d6e678716528c89c6e2216c5e2aee7c347f1f512758e310f2cfa25d68fdf67c502ca41921d911b087c4658fc1dcf3d09d3ec86951194a2bfe689b4b6e53df78660252ba14d408ded101e77f3da2c183537f7efdd3de9b0e6e4c338c116751de8a7e6081b01c0f53271bb7a8be72821c3b53bce6e65ca87b0463b2ad555f15ae32f0aa0902bd90c14ae5449857b2eb7dfc8c72948453a3eb34c19ecb5532c92ad8f136a71b8d8e56af72e05c5505b2ceb2b629dbb0c2f7c7695d5a58d66f917a6b4077cc25ee6cd406e9d80899c183cb9c95e48e5cc0f6e076be31c6b03667c53b19c08e1ba6c551308f7c0420d67b118bf2a7b79aefca9e802c5b48953acc64c7a8f67701fcf7e1c4ea04ff55c8937778812b9c70fa6b12060f1fd32f91e519f4d584525e6e89b62714664b612490f1489232bb2f09d7d373e9ad112cd051ffd9afc3cc60b7ce4fccb8e8af7ac4a4372801bef07caab0684e0aeca3831aed8a126b94d453d6851039581a8b95a24763578ed7c5ed463d12f46f53c3a5e7700f1155cffd42527c5eecc64e7d04269c8457e2553dbf228334b4540bb99349091611da4f1ef3c84747cb2e04b193d8d00e32e21ad3fcc6423fedb9f94fd64227b6243495cd78a7c2a2c59b996cdde9cd288b1a0ec3a80839876a59a8cbc3e9eb5bb1e6e1ad2fb6890ea7a16c342be03c51fd25543892c32511ac2b0855394bd3ef836276df460baa2ecd7611d754b32ef2bcfe6b69ac994c8605d931cc5859af82030668677fd6ed146ab375d5dc8ed1b851d9aa605d7e328e23d9a6229c1e0eab26297b18d18f8477000d7a715944afe16f7962237ca3b0051d8e80065f6dd7e784ce95e44cea00bb7f9fe27d4110c7af8a56de6638d6b6032b3364f93ad6119f07578392a528a9bf0d78672433ef120a7d38a4ff43173405a1df15ce7c6d35c24ab14a945154a8ba114d161042115dd0300ea75ab1443a7279ff561380a4e8423506a7c9f90a0955ee217829871f6eaf5dc73e77fa1d7c771c1e38563ee7c4307f405b00368503dac1455af5adcfa0edc8ff7c277efeaee7f83a97556a4d5478db6c86c4c0220cc077a7cce43106dba3a93156cd8f179a5852f327ddefef00d6341ed6fa703df08a8ab1ca5e1ca970112c6902dfade9aa1320fbeace1a77eaab535d9a3212a00178438ea8f479a76bd8fd0ff593a7e4ff1dd3dd09683d8cef5346ca80146dc17da2d2657ee29e3821802b3630dba4931d095fb8789b3d1151c7a8b95c304919cbbbba2595e97996055f095825038b4a636f760bbd14b559846e70d5158ca0357419bffd7e78ce578821781be2976f75c5a75006ba17676d45831c035cd3b13ec480abe3fcd171fb7ce2684b6a3faff08ca9ddeddafdb36ff702aa286b6fe1fec370d31d2244ecc6446760a256f3c60c705e695a3998420350c6657d66d9f07528ff02ec033c3ea309cb56d9eb7b2d9989a59bc45a8a44ad4f5a5759d45ca41cb49ab49c958b3e56ed0c38e5fb941dbeecd0ea17c3480adc6e74b56874380fd2a0a64d9bb6ad60c31f9bc007d8cfcd7fe36c92e68875270072ad82175ea1bc09be312d6b9f92c00508f9ddbf8600bc02511319a1f6235a9f0e4fe8bcb8cc9108b18f4058621a5c40ee6285631fb35c599aaf2cde7ce7dbddb5860f4a281ddb70fae84edb175b3c72d3e2d4593397abefcac8a3e52b7642d3b613c60b5cf8fc59f0180fa478fab547935db13fae34d804045ee18bc363cc02763a43492a24b46843b930ecf0ee1dccecb3c3eadaf2a65bfdff7912043c8a2da845f55296bf65643128137c3294bd8f931bd7412f4ece3fcdce1d932b59a4fc0d6d445d4d591b099403f6b9c866dd35c92ec99b6e3e69a4db81b761205866fb5d6ec5169db85e52f27c0ec7f017ce0d3c6ccb587e01cfc9110caa5165df442c8e8ce34d2e610e3f0d8e7bd21146904ad94923686cde5312990e52439439b39c1cc97e0dc2c93049195a485a3aacc990533ed07c6ea3a35b636060a7056dea20fe3f9e7d4bb95a906bfba2d20aa3e5bb40aa8fd4babfe81fec1168e9004e3eaa4ef125f0dcc6e28bd1b777a87b64ac99b543c6b635449d6c8f4acff9dae87fde29409dd109943bf242502d01e6e3210061db6095f9be4a40c1b641345ff4630e81b775124b42353dc4387c1a8bacb50fa4f1291ed7ab900a1c08c4215b1556dd35007045c17c19015604ece72aa18c59352e18f3df60d492c852c939393c0afebc12308c18afc84a492105a4c84e7881bdcd20673c5299db42a4403a76bd6a9f65f04d2f49dea142925963162e0520942a9dfdaea4dc416cac67c22a0a97a602bcf3762121cece1846b9d5b1aa708dc2cc882a361728da4835667fb560069a58dcc49682c08a4219637533f69eefe4076a57b76f0d0b6aa46fcfccbfa1966440f87f4ffaff354c6c7e1d6cd8cda39c7652895fbd23c19dc253cf04528f5258aaa162b9865041c5626a51dd69a87ea0506a5e07360fa7abd7af3bf998d4c6cd8983501627b8e017a9c0dcbeff9cef28f0a19299a712339fe28ae8ed51613e7980c3067746ffaacb627926d171bfd3b82687c99389dc1f995a9bc091b856ae3b60d8a649fe9390c390afe46e19b1c90bff8a11e6aa323c9ddf2acefec437389be49657860a1facc9931120c2621414a740639224c250f774bd57a7354c483944ce4eb26818ab40aa7d79241797e5cd71742eda86fe2e36889e047473572c3c54c5934fca166706336a95b48b48a5d790d9cc4a6b612fa177b2a043790d20390d69c67dd7ef7a2c70c18ee54c3eed2412be6c0b87505338f5e287ef59ce257358b6a49ddba509dcb396501124455de95733256fd26f54af994d869d8c5ba980c7de1281552bdb35e3779cef571c6a171030004e2798cbd68b92144147380fbe2253afdc309342bdf9a13292f1c34ee8b7a0fbaec5995a7464e829b33892cbfae7530eb264d4ac47d29b13e5ef8eb057a708bca0737f7e45de4d8c52b3f8339786e0043dd9d37dfb4bd306f3b220d2cb4b8dab38c01e90b8f1b8a0e0df92efd63a5dfca9cd1a95127e149183f491f364a6b24bcf61cd0b5c417495a29357ee9f856d07987a414cb44e9120dd6cccea54136fdd1ee0a55f928829cf2fc47085c099bc2279b9d2396e26d84c3d1b8a1891c6a852cb4080e5de1a437c1f50f4e3c83cd1f825c5827e72307d0e1c0bf9ea55aead0fb48a9480d56be3e9f4c525d420fb570f10e251bfdf770b1a882ebbd542a94f89b931ffc9cb24ad5833fc43552a168e91347d396de7eafc74067b2b1adc383208e8dba278054b75d5937b2a0f57b8c17d0fc8da27a9bab2a8963dff31c83ea8b7b0bb37f48994dd281046dbce8a0060210066d6fec679e4242934dd64a9c43f863c9aae3200fd57ad56f71819cf377ed4f2e48467c0c2ab805111b556278aac803f9c609398ddba6f73ce3776f4396f169461e8d93f5e3d65026b167626b37ac83d106430314371d32abafd74c858adc39ebf154d3d2025daa4296e878f910ea0af18d23f224602e374d539bd7e50c0937d9984ccd11ef7bc3b8120012617a1461f5e534b877a99cf3fcdbd874886b1fcc77b9c85af1bbb127a416200bed93fed35d03c4b0d729871e850826dc998c077f97602a7956d749bb58b41c4a616b17b1fd11a7ec79231c4bb0dbb28f511adc62c8800c8a96422c281369c5f96af1bb0f5c3860129307a97b9b85fd7232408dd956439ddb3f8e037c0249f23e63d4d895c22f8ff9a83189a7b03279e30c4c6d1ccbdd84202618e870400d3a3c9c475ee91f75b048fe2c7fff0010a06eba2e325c25db8caf4a2a685f6fd82f88a69281f08099ab2d2ee010ab07dd3836863fd18836f73e6fa196a132eb2e7629c54ad35eefc7ec1a0e7c8c95ff7c5ecd67fb754ab815f015ae14e7341f024b9e3d3b6698ac23bf6c70a9295af5f1945a512aa05cd2970cc899b74ce6896ba617b72091e5ac0ba278fc418220ddd059f679dc625fc314e60abb55ead0c56d14d5dea60438f5408ecec057d2cd297a37a3aa297706eb36f71598f55ff5513471ee94eb76431195a2922cd85c8ac06f0f0bae785a96fc8fc1a76abfd7d9fddf4303f6321ab36a0d71d794099741d6a6a10506258928fb60978ea849b0f8f76c79e6864d7b90e5ac0cd49b4b619b4d2ce223bcd819c58bc60f253aa2954392af88589887749b8006910d25861c98f58e02d831cdf5ee81dcd722f6aae4da46851022a6711017d32dbf5ad617435a6e10b33d3a896ef682f2d4049e56d78de7c37d1c664019357d75a134b987b110fa6202e25e0f30fbe44d2390bb803dd22324d662573df6e8c12707211ca14c28581dae9b1d5c5c4d4451c9c2ad8b4088de12a9240505c15bbe4db26e9b96910bdfb9dc9af39e5dd033ea7461b45fbb3ccb3f1c95c9b67fa33d8389e9ac11262c4716493af16d6b73a4f562e3fb47fce2f75e25f31b451b9f690856dc2e31fa8eff215a45086da8d9e9b8e820c879ad25fa5e3eb9e3a8a0e8eafd77e8096f2d34017f9bda6898e20ac0647b4e81fc7a6488f99884e62ceaa99eb63fa6ef5921d238ab249f16d4d9678f5913cdc937aedff4b14d5f55e4d260fea77e613765e5416cbbef76e9dadb0e4752c3e9d4c930e9ba3b8d2c99be75adad80380609921b2d7a44cca8cd58dbe2eefa23cd5dc690e2ffcf23b13a83e6bf0282742412184a89e66cf54d0387fae4ea611059554a43ac080ebd4d23fe31ba7fcaa75f3dd6658e9425b6a243ee850d5d63196ccaee01dd67cac9abad4716713ad9734690d0bcefadaee0a0d21a0b763e612afd0b4b273036c9d18029072ff4a3536663e2f15e52fe551be2758a6a367bccbcf9b404e35288c1582eba37c20df3328d34ec1d5a8764bf103c9ef92b157888df08d89e90559419fdab2a4d1cb360c8077acc40fd7d754eb34b60f9c3fbfca5f743a4c59e435d4c3b95a6a40fbc25ebd21fc10940daaade9a4229c572147b999ae91d5e908933cd84b8c7c71b7fcdca7ecb39ca14889e4f592c0c9ed8762d749724ba092f4c94aa9df43923b2a497bf2eeb05c4f1eca9e17557e35220f73f7063e342d9119ab144d3df0af88575b6da636aaaa6d6e6718627e34f30bcbee8936d5833d30aea62a0e55a291447b299c15e5485e5b6609ed57e65b0fa8faa8785d7dbded05e7367f23c0f6ec0af380241933b0f574066cdd7acabd0fa83ced03b9d5bf55a3e6c9804fd8ef2a57b31cf3b6514c22e664036dab13684c4780934b477fa564a156e41319d606ff2bbf1236bf289007a665fd6c8c2e24008aa7ba1aa4e1064bd77dd456a7912070cc36b78c961cb3ce7b56f0757c8cd9c46d7951761c5baeea5eded577bc721f2bc1204c4645ea4d320de92d712fe2ad6dd6d9f5aee1ef34e5d6306b4e17da095694664b21cb699b33d97e9f528ef08ca12c4d888d5b0df7fcd54d614575264eec4ca93434f82d3858caf9d2d040a1707614cf6d836759210f7845f137183c55bf0020d77b7ea48dd59bf00f9da52a32e67f54296cf2749780b5e56e34d6949e2b92da3257b8cdd097ac58213dd1a792bc8fbdbe0a6e0f03a9adc9c8adac14ad6ebd64d7aeea1240febe105c4c91a9e46cd7a0382478a80d8f557b68ce6bcfd10d852b1adcfc1eaf0981d8ba1f6242024ce944134d7ba5fc9fd0826900c2cc652c5c9d78a1c0db8f860380bd8c85693e326b791d6917f95e058031a1a81a7b1c79f4c3c577e069fe57965053db0f0aead3d7eda7818c29b7b7070f0f975d7b6946117be24e44692fa1d3db336650ac9fab6ec04f899f63c4f2e6a4f3503d2896e74cc5dac510c298fb2611b0b4a0eab768bf3eac495fa76323d76e7be2ea60ecccfa74e82a07bc8e6c4ba6dfa40a3905b495a47a792e99b339d74e703519ca732e4d61a75090f71fd7a694ee1fd8d024f2b965b466b0ec2b3c2b672ba10112833bf619e74b13c829e25a15178b17a1b4d2b8cec1dcffe74536f4b712bd5297dad4b6a5e524d3e1769079f69a5bcbe6047dbb99075528a97280aef90c95bcd3a09f25873afe85e0c558289059334b1b8c0ae0385b9626ebfd9af6d1ea734328a01897f601af2fa846aa2804f7527de460b8ad215b7c044dbd795266986b48ec536519f02633ce034b16afc251072c0567954e12a79f5be0ac8cfc5e00d7dc822676b47678ac876a8348a9d6b1384c34e80d4496120939a8c2973a4c2d52be0f2857a9b9048deaeed8a0c265a1665aa450ae227453cf0c283f2d1733403f2723111867c5424aeb6eb0204fe1ed8ca3d1d353da939d8a5550a299fbc1aeadccabb9f965</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-shrink">      <input class="hbe hbe-input-field hbe-input-field-shrink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-shrink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-shrink">åŠ å¯†æ–‡ç« , å¯†ç æ˜¯åšä¸»åå­—é¦–å­—æ¯+ç”Ÿæ—¥(3ä½å°å†™å­—æ¯+8ä½æ•°å­—)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CIé…ç½®æ—¶ä½¿ç”¨Makefileæœ‰å“ªäº›å¥½å¤„?</title>
      <link href="/2025/08/13/CI_Makefile/"/>
      <url>/2025/08/13/CI_Makefile/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="CIé…ç½®æ—¶ä½¿ç”¨Makefileæœ‰å“ªäº›å¥½å¤„">CIé…ç½®æ—¶ä½¿ç”¨Makefileæœ‰å“ªäº›å¥½å¤„?</h1><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-Makefileï¼Ÿ">ä¸€ã€ä»€ä¹ˆæ˜¯ Makefileï¼Ÿ</h2><p><code>Makefile</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ…å«äº†<strong>ä¸€ç³»åˆ—è§„åˆ™</strong>çš„æ–‡ä»¶ã€‚è¿™äº›è§„åˆ™å®šä¹‰äº†å¦‚ä½•ç¼–è¯‘å’Œé“¾æ¥ç¨‹åºï¼Œæ¯ä¸€ä¸ªè§„åˆ™éƒ½ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>ç›®æ ‡ï¼ˆTargetï¼‰</strong>: æƒ³è¦ç”Ÿæˆçš„æ–‡ä»¶æˆ–æƒ³è¦æ‰§è¡Œçš„æ“ä½œçš„åç§°ï¼Œæ¯”å¦‚ <code>install</code>ã€<code>test</code>ã€<code>clean</code> ç­‰ã€‚</li><li><strong>ä¾èµ–ï¼ˆPrerequisitesï¼‰</strong>: ä¸ºäº†ç”Ÿæˆç›®æ ‡ï¼Œæ‰€éœ€è¦ä¾èµ–çš„æ–‡ä»¶æˆ–å…¶ä»–ç›®æ ‡ã€‚</li><li><strong>å‘½ä»¤ï¼ˆCommandsï¼‰</strong>: ä¸ºäº†é€šè¿‡ä¾èµ–æ¥ç”Ÿæˆç›®æ ‡æ‰€éœ€è¦æ‰§è¡Œçš„ shell å‘½ä»¤ã€‚</li></ul><p>ä¸€ä¸ª <code>Makefile</code> çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">target: prerequisite1 prerequisite2</span></span><br><span class="line">     command1</span><br><span class="line">     command2</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹æ€§ï¼š</strong></p><ol><li><strong>è‡ªåŠ¨åŒ–</strong>: <code>make</code> å·¥å…·ä¼šè‡ªåŠ¨è¯»å– <code>Makefile</code> å¹¶æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œä»è€Œè‡ªåŠ¨åŒ–ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ä¸€ç³»åˆ—ä»»åŠ¡ã€‚</li><li><strong>æŠ½è±¡åŒ–</strong>: å¯ä»¥å°†å¤æ‚çš„ã€å¤šæ­¥éª¤çš„ shell å‘½ä»¤å°è£…åœ¨ä¸€ä¸ªç®€å•çš„ <code>make</code> å‘½ä»¤èƒŒåã€‚ä¾‹å¦‚ï¼Œ<code>make test</code> å¯èƒ½åŒ…å«äº†å®‰è£…ä¾èµ–ã€å¯åŠ¨æ•°æ®åº“ã€è¿è¡Œæµ‹è¯•å¥—ä»¶ã€ç”ŸæˆæŠ¥å‘Šç­‰å¤šä¸ªæ­¥éª¤ã€‚</li></ol><h2 id="äºŒã€ä¸ºä»€ä¹ˆåœ¨-CI-é…ç½®ä¸­ä½¿ç”¨-Makefileï¼Ÿ">äºŒã€ä¸ºä»€ä¹ˆåœ¨ CI é…ç½®ä¸­ä½¿ç”¨ Makefileï¼Ÿ</h2><p>å°† <code>Makefile</code> å¼•å…¥ CI é…ç½®æ–‡ä»¶å¯ä»¥å¸¦æ¥ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š</p><h4 id="1-æœ¬åœ°ä¸äº‘ç«¯ç¯å¢ƒç»Ÿä¸€-Dry-run-Locally">1. <strong>æœ¬åœ°ä¸äº‘ç«¯ç¯å¢ƒç»Ÿä¸€ (Dry-run Locally)</strong></h4><p>è¿™æ˜¯ä½¿ç”¨ <code>Makefile</code> æœ€æ˜¾è‘—çš„å¥½å¤„ä¹‹ä¸€ã€‚å¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„å¼€å‘æœºä¸Šæ‰§è¡Œ <code>make test</code> æˆ– <code>make build</code>ï¼Œå¹¶æœŸæœ›å¾—åˆ°ä¸ CIæœåŠ¡å™¨ä¸Šå®Œå…¨ä¸€è‡´çš„æ‰§è¡Œç»“æœã€‚è¿™ä½¿å¾—å¼€å‘è€…åœ¨æäº¤ä»£ç å‰å°±èƒ½å¿«é€Ÿåœ°å¯¹ CI æµç¨‹è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ï¼Œè€Œæ— éœ€ç­‰å¾…æ¼«é•¿çš„ CI pipeline è¿è¡Œï¼Œä»è€Œæå¤§åœ°ç¼©çŸ­äº†åé¦ˆå‘¨æœŸã€‚</p><ul><li><p><strong>æ²¡æœ‰ <code>Makefile</code> çš„æƒ…å†µ</strong>: å¼€å‘è€…éœ€è¦é˜…è¯»å†—é•¿çš„ <code>.gitlab-ci.yml</code> æˆ–å…¶ä»– CI é…ç½®æ–‡ä»¶ï¼Œå¹¶æ‰‹åŠ¨åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œå…¶ä¸­å¤æ‚çš„ <code>script</code> ç‰‡æ®µã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä»…ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>Makefile</code> çš„æƒ…å†µ</strong>: CI é…ç½®æ–‡ä»¶å˜å¾—å¼‚å¸¸ç®€æ´ã€‚</p><ul><li><strong>.github-ci.yml ç¤ºä¾‹:</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build:</span></span><br><span class="line">   <span class="attr">runs-on:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">   <span class="attr">strategy:</span></span><br><span class="line">     <span class="attr">matrix:</span></span><br><span class="line">       <span class="attr">os:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">ubuntu-latest</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">macos-latest</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">windows-latest</span></span><br><span class="line">   <span class="attr">steps:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">            </span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Rust</span> <span class="string">toolchain</span></span><br><span class="line">       <span class="attr">uses:</span> <span class="string">./.github/actions/setup-builder</span></span><br><span class="line">            </span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">Rust</span> <span class="string">artifacts</span></span><br><span class="line">       <span class="attr">uses:</span> <span class="string">Swatinem/rust-cache@v2</span></span><br><span class="line">            </span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">       <span class="attr">run:</span> <span class="string">make</span> <span class="string">build</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>Makefileä¸­çš„build:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">cargo build --all-targets --all-features --workspace</span><br></pre></td></tr></table></figure><p>å¼€å‘è€…åœ¨æœ¬åœ°å’Œ CI æœåŠ¡å™¨ä¸Šéƒ½åªéœ€è¦æ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼š<code>make build</code>ã€‚</p><h4 id="2-ç®€åŒ–ä¸æŠ½è±¡åŒ–-CI-é…ç½®">2. <strong>ç®€åŒ–ä¸æŠ½è±¡åŒ– CI é…ç½®</strong></h4><p>ç°ä»£ CI/CD æµç¨‹å¯èƒ½éå¸¸å¤æ‚ï¼ŒåŒ…å«ä»£ç æ£€æŸ¥ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ„å»º Docker é•œåƒã€æ¨é€åˆ°åˆ¶å“åº“ã€éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒç­‰ä¼—å¤šæ­¥éª¤ã€‚å¦‚æœå°†æ‰€æœ‰è¿™äº›é€»è¾‘éƒ½ç›´æ¥å†™åœ¨ CI å¹³å°çš„ YAML é…ç½®æ–‡ä»¶ä¸­ï¼Œä¼šå¯¼è‡´æ–‡ä»¶å˜å¾—å¼‚å¸¸å†—é•¿ã€éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚</p><p><code>Makefile</code> é€šè¿‡å°†è¿™äº›å¤æ‚çš„è„šæœ¬é€»è¾‘å°è£…åœ¨ç®€å•çš„ç›®æ ‡ï¼ˆtargetï¼‰ä¸­ï¼Œæå¤§åœ°ç®€åŒ–äº† CI é…ç½®æ–‡ä»¶ã€‚CI çš„é…ç½®æ–‡ä»¶åªè´Ÿè´£<strong>è°ƒç”¨</strong>ä»»åŠ¡ï¼Œè€Œ <code>Makefile</code> è´Ÿè´£<strong>å®šä¹‰</strong>ä»»åŠ¡çš„å…·ä½“æ‰§è¡Œæ–¹å¼ã€‚</p><h4 id="3-æé«˜å¯é‡ç”¨æ€§å’Œå¯ç§»æ¤æ€§">3. <strong>æé«˜å¯é‡ç”¨æ€§å’Œå¯ç§»æ¤æ€§</strong></h4><p><code>Makefile</code> æ˜¯ä¸€ä¸ªä¸å…·ä½“ CI/CD å¹³å°æ— å…³çš„é€šç”¨å·¥å…·ã€‚</p><ul><li><strong>è·¨å¹³å°é‡ç”¨</strong>: å¦‚æœå›¢é˜Ÿå†³å®šä» Jenkins è¿ç§»åˆ° GitLab CIï¼Œæˆ–è€…éœ€è¦åŒæ—¶æ”¯æŒå¤šä¸ª CI å¹³å°ï¼Œæ— éœ€é‡å†™æ‰€æœ‰çš„æ„å»ºå’Œæµ‹è¯•è„šæœ¬ã€‚åªéœ€è¦åœ¨æ–°çš„ CI å¹³å°çš„é…ç½®æ–‡ä»¶ä¸­è°ƒç”¨ç›¸åŒçš„ <code>make</code> å‘½ä»¤å³å¯ã€‚æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘ï¼ˆ<code>Makefile</code> ä¸­çš„å†…å®¹ï¼‰å¯ä»¥è¢«æ— ç¼è¿ç§»å’Œé‡ç”¨ã€‚</li><li><strong>é¡¹ç›®é—´é‡ç”¨</strong>: å¯¹äºéµå¾ªç›¸ä¼¼æ„å»ºæµç¨‹çš„å¤šä¸ªé¡¹ç›®ï¼Œå®ƒä»¬å¯ä»¥å…±äº«æˆ–å¤ç”¨ <code>Makefile</code> çš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œåªéœ€é’ˆå¯¹ç‰¹å®šé¡¹ç›®è¿›è¡Œå¾®è°ƒã€‚</li></ul><h4 id="4-åˆ©ç”¨-make-çš„å¢é‡æ„å»ºèƒ½åŠ›">4. <strong>åˆ©ç”¨ <code>make</code> çš„å¢é‡æ„å»ºèƒ½åŠ›</strong></h4><p><code>make</code> çš„è®¾è®¡åˆè¡·å°±æ˜¯ä¸ºäº†å¤„ç†ä¾èµ–å…³ç³»å’Œå¢é‡æ„å»ºã€‚è™½ç„¶åœ¨æ— çŠ¶æ€çš„ CI ç¯å¢ƒä¸­ï¼ˆæ¯æ¬¡éƒ½ä»é›¶å¼€å§‹ï¼‰ï¼Œè¿™ä¸ªä¼˜åŠ¿å¯èƒ½ä¸é‚£ä¹ˆæ˜æ˜¾ã€‚ä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚é…ç½®äº†ç¼“å­˜ï¼ˆcachingï¼‰çš„ CI pipelineï¼Œ<code>make</code> å¯ä»¥æ™ºèƒ½åœ°åˆ¤æ–­å“ªäº›éƒ¨åˆ†æ— éœ€é‡æ–°æ„å»ºï¼Œä»è€Œæ˜¾è‘—åŠ å¿« CI çš„è¿è¡Œé€Ÿåº¦ã€‚è¿™ä¸ªå¯¹äºRusté¡¹ç›®æ²¡ä»€ä¹ˆä¼˜åŠ¿ğŸ˜„ï¼Œcargoæœ¬èº«è‡ªå¸¦äº†å¢é‡æ„å»ºçš„èƒ½åŠ›ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI </tag>
            
            <tag> Makefile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windowsé€šè¿‡Rustä½¿ç”¨DuckDBç¢°åˆ°çš„é—®é¢˜</title>
      <link href="/2025/08/01/win_rust_duckdb/"/>
      <url>/2025/08/01/win_rust_duckdb/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Windowsé€šè¿‡Rustä½¿ç”¨DuckDBç¢°åˆ°çš„é—®é¢˜">Windowsé€šè¿‡Rustä½¿ç”¨DuckDBç¢°åˆ°çš„é—®é¢˜</h2><p>DuckDBçš„ä¸€äº›é—®é¢˜åªåœ¨windowsä¸Šæœ‰, macOSå’ŒLinuxä¸Šæ²¡æœ‰, æ‰€ä»¥è®°å½•ä¸€ä¸‹</p><h3 id="æŠ¥é”™-error-linking-with-link-exe-failed-exit-code-1120">æŠ¥é”™: error: linking with <code>link.exe</code> failed: exit code: 1120</h3><p>å…·ä½“æŠ¥é”™å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">error: linking with `link.exe` failed: exit code: 1120</span><br><span class="line">  |</span><br><span class="line">  = note: &quot;D:\\cpptools\\VC\\Tools\\MSVC\\14.44.35207\\bin\\HostX64\\x64\\link.exe&quot; &quot;/NOLOGO&quot; &quot;C:\\Users\\levit\\AppData\\Local\\Temp\\rustcjagjai\\symbols.o&quot; &quot;&lt;72 object files omitted&gt;&quot; &quot;D:\\RustProject\\swan-lake\\Playground\\duckdb-eval\\target\\debug\\deps/&#123;libduckdb-25263ba118ed6ba4.rlib,libsmallvec-c183f9d47da38243.rlib,libcast-49db356ef74b85f3.rlib,librust_decimal-3a5b9cbf4877a907.rlib,libserde-22d9db03cb63b99f.rlib,libarrayvec-d50e6e157ab9318a.rlib,libfallible_streaming_iterator-04f60b605fc0f73f.rlib,libfallible_iterator-68563fc10ffcf3b8.rlib,libstrum-b79e927e16832d4d.rlib,libhashlink-3ba134715094e3cb.rlib,libarrow-5ac1a72fe2a27e5d.rlib,libarrow_row-e8aed7be06733ce6.rlib,libarrow_string-7973c0bda726cc56.rlib,libregex-710eef4d38ee3fd6.rlib,libregex_automata-db83f4512e1b5c7d.rlib,libaho_corasick-24adfb8458d9ade7.rlib,libregex_syntax-b6714b60b7bc7e4a.rlib,libmemchr-da6ba839bbe8ebcc.rlib,libarrow_cast-1a27c9e1a3dc2694.rlib,libatoi-e6ebe25009fa1943.rlib,libryu-37203d2c467f8da8.rlib,libbase64-0b360acb9dc29ba9.rlib,libcomfy_table-251418f61f10dac3.rlib,libunicode_segmentation-0b8b78906ba6799f.rlib,libunicode_width-5ad620de9423ed41.rlib,liblexical_core-a899d107d4a1caf3.rlib,liblexical_write_float-41eba6196db745d8.rlib,liblexical_write_integer-75f049f9e63a6664.rlib,liblexical_parse_float-43b8fed49b79bfbd.rlib,liblexical_parse_integer-8bdd1cf08a8114d2.rlib,liblexical_util-baf5b3dfc43aa25a.rlib,libstatic_assertions-da84d677a2cbb685.rlib,libarrow_arith-79812951151e328c.rlib,libarrow_ord-4db3a0b5e663b54b.rlib,libarrow_select-55fc1a24d0d3ef75.rlib,libarrow_array-01ea262a82a871bf.rlib,libahash-94b54058c337bbde.rlib,libgetrandom-2a89a66638c7e38e.rlib,libonce_cell-84b94b97ea24f67b.rlib,libzerocopy-e1dffdfb07107702.rlib,libhashbrown-5a1847c4e38fdd05.rlib,libfoldhash-c7e1bc489b06a6d3.rlib,libchrono-d9f9b240257d9e4e.rlib,libwindows_link-71c4caf817584dd3.rlib,libarrow_data-a31197f5464dcbdc.rlib,libarrow_schema-f4ee27f94a7e2fd1.rlib,libbitflags-05ed3484cc55db94.rlib,libarrow_buffer-a0c15988dc061bdc.rlib,libbytes-441da4d76b13cbcb.rlib,libhalf-747f7d890291de0f.rlib,libcfg_if-3d39ba26ec35ebac.rlib,libnum-f0aa498cc9e9b9e3.rlib,libnum_iter-b389ef6f565c05d2.rlib,libnum_rational-1b7cd3981135e2f8.rlib,libnum_complex-2537c84c16f51dd3.rlib,libnum_bigint-737a93fc7600053a.rlib,libnum_integer-e7cba3faece1f759.rlib,libnum_traits-1701bc9abe802865.rlib,liblibduckdb_sys-26b80393c1b83bef.rlib&#125;.rlib&quot; &quot;&lt;sysroot&gt;\\lib\\rustlib\\x86_64-pc-windows-msvc\\lib/&#123;libstd-*,libpanic_unwind-*,libwindows_targets-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libunwind-*,libcfg_if-*,liballoc-*,librustc_std_workspace_core-*,libcore-*,libcompiler_builtins-*&#125;.rlib&quot; &quot;kernel32.lib&quot; &quot;kernel32.lib&quot; &quot;ntdll.lib&quot; &quot;userenv.lib&quot; &quot;ws2_32.lib&quot; &quot;dbghelp.lib&quot; &quot;/defaultlib:msvcrt&quot; &quot;/NXCOMPAT&quot; &quot;/LIBPATH:D:\\RustProject\\swan-lake\\Playground\\duckdb-eval\\target\\debug\\build\\libduckdb-sys-504c6af2e068003e\\out&quot; &quot;/OUT:D:\\RustProject\\swan-lake\\Playground\\duckdb-eval\\target\\debug\\deps\\duckdb_eval.exe&quot; &quot;/OPT:REF,NOICF&quot; &quot;/DEBUG&quot; &quot;/PDBALTPATH:%_PDB%&quot; &quot;/NATVIS:&lt;sysroot&gt;\\lib\\rustlib\\etc\\intrinsic.natvis&quot; &quot;/NATVIS:&lt;sysroot&gt;\\lib\\rustlib\\etc\\liballoc.natvis&quot; &quot;/NATVIS:&lt;sysroot&gt;\\lib\\rustlib\\etc\\libcore.natvis&quot; &quot;/NATVIS:&lt;sysroot&gt;\\lib\\rustlib\\etc\\libstd.natvis&quot;</span><br><span class="line">  = note: some arguments are omitted. use `--verbose` to show all linker arguments</span><br><span class="line">  = note:   æ­£åœ¨åˆ›å»ºåº“ D:\RustProject\swan-lake\Playground\duckdb-eval\target\debug\deps\duckdb_eval.lib å’Œå¯¹è±¡ D:\RustProject\swan-lake\Playground\duckdb-eval\target\debug\deps\duckdb_eval.expâ</span><br><span class="line">          liblibduckdb_sys-26b80393c1b83bef.rlib(0645e750c9ff977b-ub_src_common.o) : error LNK2019: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· RmStartSessionï¼Œå‡½æ•° &quot;class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; __cdecl duckdb::AdditionalLockInfo(class std::basic_string&lt;wchar_t,struct std::char_traits&lt;wchar_t&gt;,class std::allocator&lt;wchar_t&gt; &gt;)&quot; (?AdditionalLockInfo@duckdb@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$basic_string@_WU?$char_traits@_W@std@@V?$allocator@_W@2@@3@@Z) ä¸­å¼•ç”¨äº†è¯¥ç¬¦å·â</span><br><span class="line">          liblibduckdb_sys-26b80393c1b83bef.rlib(0645e750c9ff977b-ub_src_common.o) : error LNK2019: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· RmEndSessionï¼Œå‡½æ•° &quot;class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; __cdecl duckdb::AdditionalLockInfo(class std::basic_string&lt;wchar_t,struct std::char_traits&lt;wchar_t&gt;,class std::allocator&lt;wchar_t&gt; &gt;)&quot; (?AdditionalLockInfo@duckdb@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$basic_string@_WU?$char_traits@_W@std@@V?$allocator@_W@2@@3@@Z) ä¸­å¼•ç”¨äº†è¯¥ç¬¦å·â</span><br><span class="line">          liblibduckdb_sys-26b80393c1b83bef.rlib(0645e750c9ff977b-ub_src_common.o) : error LNK2019: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· RmRegisterResourcesï¼Œå‡½æ•° &quot;class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; __cdecl duckdb::AdditionalLockInfo(class std::basic_string&lt;wchar_t,struct std::char_traits&lt;wchar_t&gt;,class std::allocator&lt;wchar_t&gt; &gt;)&quot; (?AdditionalLockInfo@duckdb@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$basic_string@_WU?$char_traits@_W@std@@V?$allocator@_W@2@@3@@Z) ä¸­å¼•ç”¨äº†è¯¥ç¬¦å·â</span><br><span class="line">          liblibduckdb_sys-26b80393c1b83bef.rlib(0645e750c9ff977b-ub_src_common.o) : error LNK2019: æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· RmGetListï¼Œå‡½æ•° &quot;class std::basic_string&lt;char,struct std::char_traits&lt;char&gt;,class std::allocator&lt;char&gt; &gt; __cdecl duckdb::AdditionalLockInfo(class std::basic_string&lt;wchar_t,struct std::char_traits&lt;wchar_t&gt;,class std::allocator&lt;wchar_t&gt; &gt;)&quot; (?AdditionalLockInfo@duckdb@@YA?AV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@std@@V?$basic_string@_WU?$char_traits@_W@std@@V?$allocator@_W@2@@3@@Z) ä¸­å¼•ç”¨äº†è¯¥ç¬¦å·â</span><br><span class="line">          D:\RustProject\swan-lake\Playground\duckdb-eval\target\debug\deps\duckdb_eval.exe : fatal error LNK1120: 4 ä¸ªæ— æ³•è§£æçš„å¤–éƒ¨å‘½ä»¤â</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>:<br>DuckDB çš„ AdditionalLockInfoè°ƒç”¨äº†Windows Restart Manager API å‡½æ•°ï¼š<br>RmStartSession - å¯åŠ¨èµ„æºç®¡ç†å™¨ä¼šè¯<br>RmEndSession - ç»“æŸèµ„æºç®¡ç†å™¨ä¼šè¯<br>RmRegisterResources - æ³¨å†Œèµ„æº<br>RmGetList - è·å–èµ„æºåˆ—è¡¨<br>è¿™äº›å‡½æ•°å±äº Windows çš„ rstrtmgr.dllï¼Œéœ€è¦é“¾æ¥ rstrtmgr.lib åº“ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>, æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <a href="http://build.rs">build.rs</a> æ–‡ä»¶ï¼Œå†™å…¥å†…å®¹å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="meta">#[cfg(target_os = <span class="string">&quot;windows&quot;</span>)]</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;cargo:rustc-link-lib=rstrtmgr&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒä¸€è¿›ç¨‹ä¸æ”¯æŒä¸€ä¸ªçº¿ç¨‹çš„åŒæ—¶æ˜¯å†™å…¥å¤šä¸ªçº¿ç¨‹è¯»å–">åŒä¸€è¿›ç¨‹ä¸æ”¯æŒä¸€ä¸ªçº¿ç¨‹çš„åŒæ—¶æ˜¯å†™å…¥å¤šä¸ªçº¿ç¨‹è¯»å–</h3><p>Windowsä¸­ä»¥å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½ä»¥è¯»å–æ¨¡å¼æ‰“å¼€è¯¥æ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰“å¼€æ–‡ä»¶è¿›è¡Œå†™å…¥æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹å°†æ— æ³•åŒæ—¶ä»¥è¯»å–æ¨¡å¼æ‰“å¼€è¯¥æ–‡ä»¶ã€‚è¿™å¯èƒ½å¯¼è‡´å¹¶å‘è®¿é—®å†²çªå’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>ä¸»è¦æµ‹è¯•äº†å¦‚ä¸‹çš„ä¸¤ä¸ªåœºæ™¯:</p><p><strong>åœºæ™¯ä¸€</strong>ï¼šå¤šæ•°æ®åº“å¹¶å‘å†™å…¥æµ‹è¯•<br>çº¿ç¨‹1 â†’ database_a.duckdb (products è¡¨)<br>çº¿ç¨‹2 â†’ database_b.duckdb (orders è¡¨)<br>çº¿ç¨‹3 â†’ database_c.duckdb (users è¡¨)<br>ç›®çš„: éªŒè¯ä¸åŒæ•°æ®åº“æ–‡ä»¶é—´çš„å†™å…¥æ“ä½œæ˜¯å¦äº’ç›¸å½±å“<br>æ•°æ®é‡: æ¯ä¸ªçº¿ç¨‹å†™å…¥5æ¡è®°å½•<br>å†™å…¥é—´éš”: æ¯æ¡è®°å½•é—´éš”100ms</p><p><strong>åœºæ™¯äºŒ</strong>ï¼šå¹¶å‘è¯»å†™æ··åˆæµ‹è¯•<br>è¯»å–ä»»åŠ¡1: æŒç»­è¯»å– database_a.duckdb (æ¯300msä¸€æ¬¡ï¼Œå…±10æ¬¡)<br>è¯»å–ä»»åŠ¡2: æŒç»­è¯»å– database_b.duckdb (æ¯400msä¸€æ¬¡ï¼Œå…±8æ¬¡)<br>å†™å…¥ä»»åŠ¡4: å»¶è¿Ÿ800msåå‘ database_a.duckdb å†™å…¥æ•°æ®<br>ç›®çš„: æµ‹è¯•åŒä¸€æ•°æ®åº“æ–‡ä»¶çš„è¯»å†™å¹¶å‘æ€§èƒ½<br>è¯»å–é¢‘ç‡: ä¸åŒä»»åŠ¡ä½¿ç”¨ä¸åŒçš„è¯»å–é—´éš”ï¼Œæ¨¡æ‹ŸçœŸå®åœºæ™¯<br>å†™å…¥å†²çª: ç‰¹æ„åœ¨è¯»å–è¿›è¡Œä¸­å¯åŠ¨é¢å¤–å†™å…¥ï¼Œæµ‹è¯•é”ç«äº‰</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> duckdb::&#123;Connection, <span class="type">Result</span>&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"><span class="keyword">use</span> tokio::time::sleep;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main()]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;æµ‹è¯•å¤šä¸ª DuckDB å®ä¾‹å¹¶å‘æ“ä½œ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»åŠ¡1: å†™å…¥çº¿ç¨‹ - æ•°æ®åº“A</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle1</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;çº¿ç¨‹1: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_a.duckdb&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">write_to_database</span>(<span class="string">&quot;database_a.duckdb&quot;</span>, <span class="string">&quot;products&quot;</span>, <span class="number">1</span>).<span class="keyword">await</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»åŠ¡2: å†™å…¥çº¿ç¨‹ - æ•°æ®åº“B</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle2</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;çº¿ç¨‹2: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_b.duckdb&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">write_to_database</span>(<span class="string">&quot;database_b.duckdb&quot;</span>, <span class="string">&quot;orders&quot;</span>, <span class="number">2</span>).<span class="keyword">await</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»»åŠ¡3: å†™å…¥çº¿ç¨‹ - æ•°æ®åº“C</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle3</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;çº¿ç¨‹3: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_c.duckdb&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">write_to_database</span>(<span class="string">&quot;database_c.duckdb&quot;</span>, <span class="string">&quot;users&quot;</span>, <span class="number">3</span>).<span class="keyword">await</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(handle1);</span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(handle2);</span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(handle3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ å¹¶å‘è¯»å–ä»»åŠ¡ï¼ˆä¸å†™å…¥åŒæ—¶è¿›è¡Œï¼‰</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\nå¼€å§‹å¹¶å‘è¯»å†™æ“ä½œ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ä»»åŠ¡1: æŒç»­è¯»å–æ•°æ®åº“A (ä¸å†™å…¥åŒæ—¶è¿›è¡Œ)</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">read_handle1</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">10</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">300</span>)).<span class="keyword">await</span>;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬&#123;&#125;æ¬¡å°è¯•:&quot;</span>, i);</span><br><span class="line">            <span class="keyword">match</span> <span class="title function_ invoke__">read_from_database</span>(<span class="string">&quot;database_a.duckdb&quot;</span>, <span class="string">&quot;products&quot;</span>).<span class="keyword">await</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ&quot;</span>),</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡1: è¯»å–å¤±è´¥ - &#123;&#125;&quot;</span>, e),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Ok::&lt;(), duckdb::Error&gt;(())</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ä»»åŠ¡2: æŒç»­è¯»å–æ•°æ®åº“B</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">read_handle2</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">8</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">400</span>)).<span class="keyword">await</span>;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬&#123;&#125;æ¬¡å°è¯•:&quot;</span>, i);</span><br><span class="line">            <span class="keyword">match</span> <span class="title function_ invoke__">read_from_database</span>(<span class="string">&quot;database_b.duckdb&quot;</span>, <span class="string">&quot;orders&quot;</span>).<span class="keyword">await</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ&quot;</span>),</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;è¯»å–ä»»åŠ¡2: è¯»å–å¤±è´¥ - &#123;&#125;&quot;</span>, e),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Ok::&lt;(), duckdb::Error&gt;(())</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¢å¤–çš„å†™å…¥ä»»åŠ¡ï¼ˆåœ¨è¯»å–è¿›è¡Œæ—¶ç»§ç»­å†™å…¥ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">write_handle4</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">800</span>)).<span class="keyword">await</span>; <span class="comment">// ç¨å¾®å»¶è¿Ÿå¯åŠ¨</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;çº¿ç¨‹4: å¼€å§‹ç¬¬äºŒè½®å†™å…¥æ•°æ®åˆ° database_a.duckdb&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">write_to_database</span>(<span class="string">&quot;database_a.duckdb&quot;</span>, <span class="string">&quot;products&quot;</span>, <span class="number">4</span>).<span class="keyword">await</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(read_handle1);</span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(read_handle2);</span><br><span class="line">    handles.<span class="title function_ invoke__">push</span>(write_handle4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>()?;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\næµ‹è¯•ç»“æŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">write_to_database</span>(db_path: &amp;<span class="type">str</span>, table_name: &amp;<span class="type">str</span>, thread_id: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">db_path</span> = db_path.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">table_name</span> = table_name.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>=tokio::task::<span class="title function_ invoke__">spawn_blocking</span>(<span class="keyword">move</span> || <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">conn</span>=Connection::<span class="title function_ invoke__">open</span>(&amp;db_path)?;</span><br><span class="line">        conn.<span class="title function_ invoke__">execute</span>(</span><br><span class="line">            &amp;<span class="built_in">format!</span>(<span class="string">&quot;CREATE TABLE IF NOT EXISTS &#123;&#125; (id INTEGER, name TEXT, thread_id INTEGER, timestamp TEXT)&quot;</span>, table_name),</span><br><span class="line">            [],</span><br><span class="line">        )?;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">5</span> &#123;</span><br><span class="line">            conn.<span class="title function_ invoke__">execute</span>(</span><br><span class="line">                &amp;<span class="built_in">format!</span>(<span class="string">&quot;INSERT INTO &#123;&#125; VALUES (?, ?, ?, now())&quot;</span>, table_name),</span><br><span class="line">                [&amp;i.<span class="title function_ invoke__">to_string</span>(), &amp;<span class="built_in">format!</span>(<span class="string">&quot;Item_&#123;&#125;_from_thread_&#123;&#125;&quot;</span>, i, thread_id), &amp;thread_id.<span class="title function_ invoke__">to_string</span>()],</span><br><span class="line">            )?;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿä¸€äº›å¤„ç†æ—¶é—´</span></span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">100</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;çº¿ç¨‹&#123;&#125;: æˆåŠŸå†™å…¥5æ¡è®°å½•åˆ° &#123;&#125; è¡¨ (&#123;&#125;)&quot;</span>, thread_id, table_name, db_path);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line"></span><br><span class="line">    &#125;).<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">read_from_database</span>(db_path: &amp;<span class="type">str</span>, table_name: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">db_path</span> = db_path.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">table_name</span> = table_name.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = tokio::task::<span class="title function_ invoke__">spawn_blocking</span>(<span class="keyword">move</span> || <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">conn</span> = Connection::<span class="title function_ invoke__">open</span>(&amp;db_path)?;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stmt</span> = conn.<span class="title function_ invoke__">prepare</span>(&amp;<span class="built_in">format!</span>(</span><br><span class="line">            <span class="string">&quot;SELECT id, name, thread_id, timestamp FROM &#123;&#125;&quot;</span>,</span><br><span class="line">            table_name</span><br><span class="line">        ))?;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">rows</span> = stmt.<span class="title function_ invoke__">query_map</span>([], |row| &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>((</span><br><span class="line">                row.get::&lt;_, <span class="type">i32</span>&gt;(<span class="number">0</span>)?,</span><br><span class="line">                row.get::&lt;_, <span class="type">String</span>&gt;(<span class="number">1</span>)?,</span><br><span class="line">                row.get::&lt;_, <span class="type">i32</span>&gt;(<span class="number">2</span>)?,</span><br><span class="line">                row.get::&lt;_, <span class="type">String</span>&gt;(<span class="number">3</span>)?,</span><br><span class="line">            ))</span><br><span class="line">        &#125;)?;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;è¯»å– &#123;&#125; (&#123;&#125;):&quot;</span>, table_name, db_path);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> rows &#123;</span><br><span class="line">            <span class="keyword">let</span> (id, name, thread_id, timestamp) = row?;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">&quot;ID: &#123;&#125;, Name: &#123;&#125;, Thread: &#123;&#125;, Time: &#123;&#125;&quot;</span>,</span><br><span class="line">                id, name, thread_id, timestamp</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">await</span></span><br><span class="line">    .<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">    result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cargo.toml:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[package]</span><br><span class="line">name = &quot;multi-duckdb-write&quot;</span><br><span class="line">version = &quot;0.1.0&quot;</span><br><span class="line">edition = &quot;2024&quot;</span><br><span class="line"></span><br><span class="line">[dependencies]</span><br><span class="line">duckdb = &#123; version = &quot;1.3.2&quot;, features = [&quot;bundled&quot;] &#125;</span><br><span class="line">tokio = &#123; version = &quot;1.0&quot;, features = [&quot;full&quot;] &#125;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">æµ‹è¯•å¤šä¸ª DuckDB å®ä¾‹å¹¶å‘æ“ä½œ...</span><br><span class="line"></span><br><span class="line">å¼€å§‹å¹¶å‘è¯»å†™æ“ä½œ...</span><br><span class="line">çº¿ç¨‹1: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_a.duckdb</span><br><span class="line">çº¿ç¨‹2: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_b.duckdb</span><br><span class="line">çº¿ç¨‹3: å¼€å§‹å†™å…¥æ•°æ®åˆ° database_c.duckdb</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬1æ¬¡å°è¯•:</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬1æ¬¡å°è¯•:</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–å¤±è´¥ - IO Error: Cannot open file &quot;database_a.duckdb&quot;: ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½Ã´ï¿½ï¿½Ä¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ş·ï¿½ï¿½ï¿½ï¿½Ê¡ï¿½</span><br><span class="line"></span><br><span class="line">File is already open in</span><br><span class="line">D:\RustProject\swan-lake\Playground\parallel-duckdb-write\target\debug\parallel-duckdb-write.exe (PID 22848)</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–å¤±è´¥ - IO Error: Cannot open file &quot;database_b.duckdb&quot;: ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½Ã´ï¿½ï¿½Ä¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ş·ï¿½ï¿½ï¿½ï¿½Ê¡ï¿½</span><br><span class="line"></span><br><span class="line">File is already open in</span><br><span class="line">D:\RustProject\swan-lake\Playground\parallel-duckdb-write\target\debug\parallel-duckdb-write.exe (PID 22848)</span><br><span class="line">çº¿ç¨‹2: æˆåŠŸå†™å…¥5æ¡è®°å½•åˆ° orders è¡¨ (database_b.duckdb)</span><br><span class="line">çº¿ç¨‹1: æˆåŠŸå†™å…¥5æ¡è®°å½•åˆ° products è¡¨ (database_a.duckdb)</span><br><span class="line">çº¿ç¨‹3: æˆåŠŸå†™å…¥5æ¡è®°å½•åˆ° users è¡¨ (database_c.duckdb)</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬2æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">çº¿ç¨‹4: å¼€å§‹ç¬¬äºŒè½®å†™å…¥æ•°æ®åˆ° database_a.duckdb</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬2æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬3æ¬¡å°è¯•:</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–å¤±è´¥ - IO Error: Cannot open file &quot;database_a.duckdb&quot;: ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½Ã´ï¿½ï¿½Ä¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ş·ï¿½ï¿½ï¿½ï¿½Ê¡ï¿½</span><br><span class="line"></span><br><span class="line">File is already open in</span><br><span class="line">D:\RustProject\swan-lake\Playground\parallel-duckdb-write\target\debug\parallel-duckdb-write.exe (PID 22848)</span><br><span class="line">çº¿ç¨‹4: æˆåŠŸå†™å…¥5æ¡è®°å½•åˆ° products è¡¨ (database_a.duckdb)</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬3æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬4æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬4æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬5æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬6æ¬¡å°è¯•:</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬5æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬7æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬6æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬8æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬7æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬9æ¬¡å°è¯•:</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æ•°æ®åº“A- ç¬¬10æ¬¡å°è¯•:</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æ•°æ®åº“B - ç¬¬8æ¬¡å°è¯•:</span><br><span class="line">è¯»å– orders (database_b.duckdb):</span><br><span class="line">è¯»å– products (database_a.duckdb):</span><br><span class="line">ID: 1, Name: Item_1_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.249+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.357+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.241+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.354+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.464+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.572+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_2, Thread: 2, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_1, Thread: 1, Time: 2025-07-30 15:49:27.681+00</span><br><span class="line">ID: 1, Name: Item_1_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.02+00</span><br><span class="line">ID: 2, Name: Item_2_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.135+00</span><br><span class="line">ID: 3, Name: Item_3_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.249+00</span><br><span class="line">ID: 4, Name: Item_4_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.357+00</span><br><span class="line">ID: 5, Name: Item_5_from_thread_4, Thread: 4, Time: 2025-07-30 15:49:28.465+00</span><br><span class="line">è¯»å–ä»»åŠ¡2: è¯»å–æˆåŠŸ</span><br><span class="line">è¯»å–ä»»åŠ¡1: è¯»å–æˆåŠŸ</span><br><span class="line"></span><br><span class="line">æµ‹è¯•ç»“æŸ</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> DuckDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Icebergå¿«é€Ÿå…¥é—¨</title>
      <link href="/2025/07/27/Iceberg/"/>
      <url>/2025/07/27/Iceberg/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Iceberg">Iceberg</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦Iceberg-ä¸ºä»€ä¹ˆéœ€è¦Lakehouse">ä¸ºä»€ä¹ˆéœ€è¦Iceberg/ä¸ºä»€ä¹ˆéœ€è¦Lakehouse</h3><p>æ•°æ®æ¹–çš„æœ€ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³Hiveé€Ÿåº¦æ…¢çš„é—®é¢˜, åˆ©ç”¨è¡¨æ ¼å¼å’Œç´¢å¼•å®ç°ç»†ç²’åº¦çš„æ•°æ®è¿‡æ»¤. æ•°æ®æ¹–å¯ä»¥å°†æ•´ä¸ªé“¾è·¯å˜ä¸ºåˆ†é’Ÿçº§, ä»ç¦»çº¿é“¾è·¯è½¬åŒ–ä¸ºè¿‘å®æ—¶é“¾è·¯å¹¶ä¸”æå‡æŸ¥è¯¢é€Ÿåº¦. å½“ç„¶, æ•°æ®æ¹–è¿˜è§£å†³äº†ä¸€äº›å…¶ä»–é—®é¢˜, å¦‚ACID, Schema Evolution, Partition Evolution, Time Travelç­‰.</p><h3 id="æ–‡ä»¶å¸ƒå±€"><strong>æ–‡ä»¶å¸ƒå±€</strong></h3><p>å…·ä½“æŸ¥è¯¢æµç¨‹å°±æ˜¯ä»Catalog -&gt; Table Metadata File -&gt; Snapshot -&gt; Manifest List -&gt; Manifest File -&gt; Data File. å¦‚å›¾æ‰€ç¤º</p><p><img src="https://s3.bitiful.net/pb01/Iceberg-metadata.png" alt="image.png"></p><h4 id="Catalog">Catalog</h4><p>Catalog æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç»´æŠ¤è¡¨å…ƒæ•°æ®æ–‡ä»¶çš„ç›®å½•(ä¸ªäººç†è§£), æœ‰å¤šç§å®ç°æ–¹å¼:</p><table><thead><tr><th>HiveCatalog</th><th>Hive Metastore</th><th>è¡¨å±æ€§ä¸­keyå€¼ä¸ºmetadata_locationçš„é”®å€¼å¯¹</th></tr></thead><tbody><tr><td>HadoopCatalog</td><td>æ–‡ä»¶ç³»ç»Ÿ</td><td>version-hint.text</td></tr><tr><td>JDBC Catalog</td><td>å…³ç³»å‹æ•°æ®åº“</td><td>ä¸“é—¨çš„è¡¨: ä¾‹å¦‚jdbc_catalog</td></tr><tr><td>REST Catalog</td><td>ç‹¬ç«‹çš„ Web æœåŠ¡</td><td>APIç«¯ç‚¹è¿”å›çš„json</td></tr></tbody></table><h4 id="Table-Metadata-File-vN-metadata-json">Table Metadata File (vN.metadata.json)</h4><p><strong>è¡¨çš„å…ƒæ•°æ®æ–‡ä»¶</strong>ï¼Œè®°å½•äº†è¡¨çš„å®Œæ•´å®šä¹‰å’Œå†å²å¿«ç…§ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;format-version&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;table-uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;f7m1a7b4-c111-407a-a6e1-433a233a1e12&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://my-bucket/warehouse/db/events&quot;</span><span class="punctuation">,</span>  <span class="comment">//æ ¹è·¯å¾„</span></span><br><span class="line">  <span class="attr">&quot;last-updated-ms&quot;</span><span class="punctuation">:</span> <span class="number">1672531200000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;last-column-id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;schemas&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;struct&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;schema-id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;event_ts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timestamptz&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Event timestamp with timezone&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;level&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;extra_info&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;map&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;key-id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;value-id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;value-required&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;current-schema-id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;partition-specs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;spec-id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;day&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;transform&quot;</span><span class="punctuation">:</span> <span class="string">&quot;day&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source-id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;field-id&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;default-spec-id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;write.format.default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;parquet&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;commit.retry.num-retries&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;current-snapshot-id&quot;</span><span class="punctuation">:</span> <span class="number">3051729675574597004</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;snapshots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;snapshot-id&quot;</span><span class="punctuation">:</span> <span class="number">3051729675574597004</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;parent-snapshot-id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp-ms&quot;</span><span class="punctuation">:</span> <span class="number">1672531200000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;operation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;append&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spark.app.id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;local-1599119293123&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;added-data-files&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;added-records&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10550&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;added-files-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;34201&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;changed-partition-count&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-records&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10550&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-files-size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;34201&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-data-files&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-delete-files&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-position-deletes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total-equality-deletes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;manifest-list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://my-bucket/warehouse/db/events/metadata/snap-3051729675574597004-1-2945e143-5152-4091-8869-711e86098059.avro&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;schema-id&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;snapshot-log&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;timestamp-ms&quot;</span><span class="punctuation">:</span> <span class="number">1672531200000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;snapshot-id&quot;</span><span class="punctuation">:</span> <span class="number">3051729675574597004</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Manifest-List-snap-snapshot-id-attempt-id-uuid-avro">Manifest List (snap-<snapshot-id>-<attempt-id>-<uuid>.avro)</h4><p>åˆ—å‡ºäº†æ‰€æœ‰çš„Manifest FileåŠç›¸å…³ä¿¡æ¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;manifest_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://warehouse/db/table/metadata/e852441a-5c3c-42a2-b2d9-e31a19a9d701-m0.avro&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;manifest_length&quot;</span><span class="punctuation">:</span> <span class="number">6224</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partition_spec_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;min_sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_snapshot_id&quot;</span><span class="punctuation">:</span> <span class="number">874657636349826781</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_files_count&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;existing_files_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deleted_files_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">4000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;existing_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deleted_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partitions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;contains_null&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;contains_nan&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lower_bound&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T10:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;upper_bound&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T12:00:00.000Z&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;key_metadata&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;manifest_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://warehouse/db/table/metadata/f334a123-cee3-4733-ac49-bd24a5a176d1-m1.avro&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;manifest_length&quot;</span><span class="punctuation">:</span> <span class="number">1056</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partition_spec_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;min_sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_snapshot_id&quot;</span><span class="punctuation">:</span> <span class="number">874657636349826781</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_files_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;existing_files_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deleted_files_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;added_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;existing_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;deleted_rows_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partitions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;contains_null&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;contains_nan&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lower_bound&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T11:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;upper_bound&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T11:00:00.000Z&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;key_metadata&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h3 id="Manifest-File-uuid-avro">Manifest File (<uuid>.avro)</h3><p>åŒ…å«Data FileåŠç›¸å…³ä¿¡æ¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshot_id&quot;</span><span class="punctuation">:</span> <span class="number">4876662349891823142</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://my-bucket/db/logs/data/event_date=2025-07-30/00000-1-....parquet&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PARQUET&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;event_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30&quot;</span> </span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;record_count&quot;</span><span class="punctuation">:</span> <span class="number">4800</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_size_in_bytes&quot;</span><span class="punctuation">:</span> <span class="number">5242880</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;column_sizes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">76800</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">24000</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">4234880</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">4800</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">4800</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">4800</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;null_value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nan_value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lower_bounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;upper_bounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30T11:59:59.999Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WARN&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshot_id&quot;</span><span class="punctuation">:</span> <span class="number">4876662349891823142</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sequence_number&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3://my-bucket/db/logs/data/event_date=2025-07-30/00001-2-....parquet&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PARQUET&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;partition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;event_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;record_count&quot;</span><span class="punctuation">:</span> <span class="number">5200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file_size_in_bytes&quot;</span><span class="punctuation">:</span> <span class="number">5872025</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;column_sizes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">83200</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">26000</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">4962825</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">5200</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">5200</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">5200</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;null_value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nan_value_counts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lower_bounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30T12:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;upper_bounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-30T23:59:59.999Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h4 id="ä¸€ä¸ªä¾‹å­">ä¸€ä¸ªä¾‹å­</h4><ol><li>å»ºè¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ice_spark.hdfs.t_user1 (</span><br><span class="line">  id <span class="type">int</span>,</span><br><span class="line">  name string,</span><br><span class="line">  ts string</span><br><span class="line">) <span class="keyword">USING</span> iceberg;</span><br><span class="line"></span><br><span class="line">t_user1<span class="operator">/</span></span><br><span class="line">â”œâ”€â”€ metadata</span><br><span class="line">â”‚   â””â”€â”€ v1.metadata.json</span><br><span class="line">â””â”€â”€ version<span class="operator">-</span>hint.text</span><br></pre></td></tr></table></figure><p>version-hint.textå­˜çš„å°±æ˜¯å½“å‰matadata fileçš„ç‰ˆæœ¬ä¿¡æ¯, è®©ç³»ç»ŸçŸ¥é“æ˜¯vN.metadata.json</p><ol start="2"><li>æ’å…¥ä¸€æ¡æ•°æ®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ice_spark.hdfs.ns.t_user1 <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;hlink&#x27;</span>, <span class="number">20250709</span>);</span><br><span class="line"></span><br><span class="line">t_user1<span class="operator">/</span></span><br><span class="line">â”œâ”€â”€ data</span><br><span class="line">â”‚   â””â”€â”€ <span class="number">00000</span><span class="number">-5</span><span class="operator">-</span>ba90a31f<span class="operator">-</span>d65c<span class="number">-4e40</span><span class="number">-9321</span><span class="number">-3</span>faa8c184547<span class="number">-0</span><span class="number">-00001.</span>parquet</span><br><span class="line">â”œâ”€â”€ metadata</span><br><span class="line">â”‚   â”œâ”€â”€ <span class="number">44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14<span class="operator">-</span>m0.avro</span><br><span class="line">â”‚   â”œâ”€â”€ snap<span class="number">-8289612053519823397</span><span class="number">-1</span><span class="number">-44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14.avro</span><br><span class="line">â”‚   â”œâ”€â”€ v1.metadata.json</span><br><span class="line">â”‚   â””â”€â”€ v2.metadata.json</span><br><span class="line">â””â”€â”€ version<span class="operator">-</span>hint.text</span><br></pre></td></tr></table></figure><p>å¤šäº†æ•°æ®æ–‡ä»¶00000-5-ba90a31f-d65c-4e40-9321-3faa8c184547-0-00001.parquet, version-hint.textæ›´æ–°åˆ°ç‰ˆæœ¬2, æ–°å¢v2.metadata.json, æ–°å¢manifest listæ–‡ä»¶snap-8289612053519823397-1-44a2bbda-e252-4d77-b958-b3cf35708b14.avro, æ–°å¢äº†manifeat fileæ–‡ä»¶44a2bbda-e252-4d77-b958-b3cf35708b14-m0.avro.</p><ol start="3"><li>å†æ’å…¥ä¸€æ¡æ•°æ®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ice_spark.hdfs.ns.t_user1 <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="string">&#x27;iceberg&#x27;</span>, <span class="number">20250709</span>);</span><br><span class="line"></span><br><span class="line">t_user1<span class="operator">/</span></span><br><span class="line">â”œâ”€â”€ data</span><br><span class="line">â”‚   â”œâ”€â”€ <span class="number">00000</span><span class="number">-5</span><span class="operator">-</span>ba90a31f<span class="operator">-</span>d65c<span class="number">-4e40</span><span class="number">-9321</span><span class="number">-3</span>faa8c184547<span class="number">-0</span><span class="number">-00001.</span>parquet</span><br><span class="line">â”‚   â””â”€â”€ <span class="number">00000</span><span class="number">-7</span><span class="number">-906189</span>d5<span class="number">-3</span>aba<span class="number">-4</span>a96<span class="number">-9</span>f8b<span class="number">-008</span>d5af2f94d<span class="number">-0</span><span class="number">-00001.</span>parquet</span><br><span class="line">â”œâ”€â”€ metadata</span><br><span class="line">â”‚   â”œâ”€â”€ <span class="number">28173</span>fec<span class="number">-5</span>f71<span class="number">-444</span>c<span class="number">-9</span>abd<span class="number">-543468e78636</span><span class="operator">-</span>m0.avro</span><br><span class="line">â”‚   â”œâ”€â”€ <span class="number">44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14<span class="operator">-</span>m0.avro</span><br><span class="line">â”‚   â”œâ”€â”€ snap<span class="number">-4152532609887149918</span><span class="number">-1</span><span class="number">-28173</span>fec<span class="number">-5</span>f71<span class="number">-444</span>c<span class="number">-9</span>abd<span class="number">-543468e78636</span>.avro</span><br><span class="line">â”‚   â”œâ”€â”€ snap<span class="number">-8289612053519823397</span><span class="number">-1</span><span class="number">-44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14.avro</span><br><span class="line">â”‚   â”œâ”€â”€ v1.metadata.json</span><br><span class="line">â”‚   â”œâ”€â”€ v2.metadata.json</span><br><span class="line">â”‚   â””â”€â”€ v3.metadata.json</span><br><span class="line">â””â”€â”€ version<span class="operator">-</span>hint.text</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸ä¹‹å‰çš„æ’å…¥æ“ä½œæ˜¯åŒæ ·çš„é“ç†</p><h3 id="Schema-Evolution"><strong>Schema Evolution</strong></h3><p><strong>Schema Evolutionç®€å•æ¥è¯´å°±æ˜¯å¯¹è¡¨æ ¼å¼çš„å˜æ›´, Schema Evolutionåªæ”¹å˜å…ƒæ•°æ®, ä¸æ”¹å˜åº•å±‚çš„æ•°æ®æ–‡ä»¶, æ”¯æŒçš„å˜æ›´æœ‰:</strong></p><ol><li><strong>æ·»åŠ å­—æ®µ (Add)</strong>ï¼šå¯ä»¥å‘ schema ä¸­å¢åŠ æ–°çš„å­—æ®µã€‚æ–°å¢çš„å­—æ®µä¼šè¢«åˆ†é…ä¸€ä¸ªæ–°çš„ã€å”¯ä¸€çš„å­—æ®µIDã€‚</li><li><strong>åˆ é™¤å­—æ®µ (Delete)</strong>ï¼šå¯ä»¥ä»å½“å‰ schema ä¸­ç§»é™¤ä¸€ä¸ªå­—æ®µã€‚</li><li><strong>é‡å‘½åå­—æ®µ (Rename)</strong>ï¼šå¯ä»¥æ›´æ”¹ä¸€ä¸ªå·²å­˜åœ¨å­—æ®µçš„åç§°ï¼Œä½†å…¶å­—æ®µIDä¸ä¼šæ”¹å˜ã€‚</li><li><strong>é‡æ’å­—æ®µé¡ºåº (Reorder)</strong>ï¼šå¯ä»¥è°ƒæ•´å·²å­˜åœ¨å­—æ®µåœ¨ schema ä¸­çš„é¡ºåºã€‚</li><li><strong>ç±»å‹æå‡ (Type Promotion)</strong>ï¼šå¯ä»¥å°†åŸç”Ÿç±»å‹ï¼ˆprimitive typeï¼‰æå‡ä¸ºå¦ä¸€ä¸ªå…¼å®¹çš„ç±»å‹ã€‚</li></ol><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ·»åŠ column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user   <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> age <span class="type">int</span>;</span><br><span class="line"><span class="comment">--æŒ‡å®šåˆ—åé¢æ›´åŠ column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> sex <span class="type">int</span> AFTER id;</span><br><span class="line"><span class="comment">--ä¿®æ”¹åˆ—å</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user RENAME <span class="keyword">COLUMN</span> sex <span class="keyword">TO</span> sex1;</span><br><span class="line"><span class="comment">--ä¿®æ”¹åˆ—ç±»å‹</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> sex1 TYPE <span class="type">bigint</span>;</span><br><span class="line"><span class="comment">--æ·»åŠ æ³¨é‡Š</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user <span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> sex1 COMMENT <span class="string">&#x27;table sex&#x27;</span>;</span><br><span class="line"><span class="comment">--åˆ é™¤åˆ—</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> sex1;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ–°å¢ä¸€ä¸ªåˆ—, é‚£åŸæ¥çš„æ•°æ®æ²¡æœ‰è¿™ä¸ªåˆ—, æŸ¥è¯¢æ€ä¹ˆåŠ? é¦–å…ˆIcebergä¼šæ„è¯†åˆ°åŸæ¥çš„Schemaæ²¡æœ‰è¿™ä¸ªå­—æ®µ, å¯¹äºè¿™ä¸ªæ²¡æœ‰çš„å­—æ®µæŸ¥è¯¢æ˜¯ä¸ä¼šè½å®çš„. è¿™é‡Œå°±è¦æåˆ°**â€œColumn Projectionâ€ (åˆ—æŠ•å½±)è¿™ä¸ªæœºåˆ¶.** å½“æŸ¥è¯¢æ•°æ®æ—¶, Iceberg ä½¿ç”¨çš„æ˜¯è¡¨çš„**å½“å‰ schema(<strong>åŒ…å«äº†æ–°å¢å­—æ®µ), ä½†æ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ç”¨</strong>æ—§çš„ schema(**ä¸åŒ…å«æ–°å¢å­—æ®µ)å†™å…¥çš„. å½“ Iceberg åœ¨è¯»å–æ—§æ•°æ®æ–‡ä»¶å‰, åœ¨æŸ¥è¯¢schemaæ—¶å‘ç°æŸ¥è¯¢éœ€è¦çš„ä¸€ä¸ª <code>field-id</code> åœ¨æ–‡ä»¶ä¸­å¹¶ä¸å­˜åœ¨, å®ƒä¼šéµå¾ªä¸€å¥—æ˜ç¡®çš„è§„åˆ™æ¥è§£æè¿™ä¸ªå€¼:</p><ol><li><strong>ä»åˆ†åŒºæ•°æ®ä¸­è·å–</strong>ï¼šå¦‚æœè¯¥å­—æ®µå­˜åœ¨ä¸€ä¸ª <code>identity</code>ï¼ˆæ’ç­‰ï¼‰åˆ†åŒºè½¬æ¢ï¼Œå¹¶ä¸”åˆ†åŒºå€¼å­˜åœ¨äºæ¸…å•æ–‡ä»¶ï¼ˆmanifestï¼‰çš„ <code>data_file</code> å¯¹è±¡çš„ <code>partition</code> ç»“æ„ä¸­ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨è¿™ä¸ªåˆ†åŒºå€¼ã€‚è¿™ä¸»è¦ç”¨äºä» Hive è¡¨è¿ç§»ç­‰åœºæ™¯ã€‚</li><li><strong>ä½¿ç”¨åç§°æ˜ å°„ (Name Mapping)</strong>ï¼šå¦‚æœè¡¨é…ç½®äº† <code>schema.name-mapping.default</code> å±æ€§ï¼ŒIceberg ä¼šå°è¯•ä½¿ç”¨è¿™ä¸ªæ˜ å°„ä»æ²¡æœ‰ <code>field-id</code> çš„æ—§æ–‡ä»¶ä¸­æŒ‰åç§°æ‰¾åˆ°å¯¹åº”çš„åˆ—ã€‚</li><li><strong>ä½¿ç”¨ <code>initial-default</code> (åˆå§‹é»˜è®¤å€¼)</strong>ï¼šå¦‚æœè¯¥å­—æ®µçš„ schema å®šä¹‰ä¸­åŒ…å«ä¸€ä¸ª <code>initial-default</code> å€¼ï¼Œé‚£ä¹ˆ Iceberg å°±ä¼šè¿”å›è¿™ä¸ªé¢„è®¾çš„é»˜è®¤å€¼ã€‚</li><li><strong>è¿”å› <code>null</code></strong>ï¼šå¦‚æœä»¥ä¸Šæ‰€æœ‰è§„åˆ™éƒ½ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆ Iceberg å°†ä¸ºè¿™ä¸ªå­—æ®µè¿”å› <code>null</code></li></ol><h3 id="Partitioning-åˆ†åŒº"><strong>Partitioning(åˆ†åŒº)</strong></h3><p>æ ¸å¿ƒæ˜¯å°†æ•°æ®æŒ‰ç…§ç‰¹å®šè§„åˆ™ï¼ˆå¦‚ç›¸åŒæ—¥æœŸã€ç±»åˆ«çš„è®°å½•ï¼‰<strong>ç‰©ç†å­˜å‚¨åœ¨ä¸€èµ·</strong>ï¼ˆæ–‡ä»¶å¤¹ dt=20250213ï¼‰ï¼Œå‡å°‘æŸ¥è¯¢æ—¶æ‰«æçš„æ•°æ®é‡ï¼Œæå‡æ€§èƒ½ã€‚æ˜¯é€šè¿‡æ•°æ®å­˜å‚¨ä¼˜åŒ–æ¥æå‡æŸ¥è¯¢æ€§èƒ½çš„ä¸€ç§æŠ€æœ¯.</p><p>ä¸€ä¸ªä¾‹å­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ice_spark.hdfs.ns.t_user1 (</span><br><span class="line">  id <span class="type">INT</span>,</span><br><span class="line">  name STRING,</span><br><span class="line">  dt <span class="type">DATE</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">USING</span> iceberg</span><br><span class="line">PARTITIONED <span class="keyword">BY</span> (days(dt)); <span class="comment">-- æŒ‰å¤©å¯¹ dt åˆ—è¿›è¡Œåˆ†åŒº</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ice_spark.hdfs.ns.t_user1 <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;hlink&#x27;</span>, <span class="number">20250709</span>);</span><br><span class="line"></span><br><span class="line">t_user1<span class="operator">/</span></span><br><span class="line">â”œâ”€â”€ data</span><br><span class="line">    â””â”€â”€ dt<span class="operator">=</span><span class="number">20250709</span></span><br><span class="line">â”‚      â””â”€â”€ <span class="number">00000</span><span class="number">-5</span><span class="operator">-</span>ba90a31f<span class="operator">-</span>d65c<span class="number">-4e40</span><span class="number">-9321</span><span class="number">-3</span>faa8c184547<span class="number">-0</span><span class="number">-00001.</span>parquet</span><br><span class="line">â”œâ”€â”€ metadata</span><br><span class="line">â”‚   â”œâ”€â”€ <span class="number">44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14<span class="operator">-</span>m0.avro</span><br><span class="line">â”‚   â”œâ”€â”€ snap<span class="number">-8289612053519823397</span><span class="number">-1</span><span class="number">-44</span>a2bbda<span class="operator">-</span>e252<span class="number">-4</span>d77<span class="operator">-</span>b958<span class="operator">-</span>b3cf35708b14.avro</span><br><span class="line">â”‚   â”œâ”€â”€ v1.metadata.json</span><br><span class="line">â”‚   â””â”€â”€ v2.metadata.json</span><br><span class="line">â””â”€â”€ version<span class="operator">-</span>hint.text</span><br></pre></td></tr></table></figure><p>ä½†ä¸ä¸€å®šæ˜¯è¿™ç§å¸ƒå±€, è¿™ç§çš„ç±»ä¼¼, å› ä¸ºIcebergçš„åˆ†åŒºä¸ä¸€å®šè¦æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„ç›®å½•ä¸‹, Icebergæœ‰<strong>éšè—åˆ†åŒºè®¾è®¡,</strong> é€šè¿‡ <strong>é€»è¾‘ä¸ç‰©ç†åˆ†ç¦»</strong> è§£å†³äº†ä¼ ç»Ÿåˆ†åŒºï¼ˆå¦‚ Hive åˆ†åŒºï¼‰çš„ç—›ç‚¹ï¼Œåˆ†åŒºåˆ—ç»´æŠ¤æˆæœ¬é«˜ã€åˆ†åŒºç­–ç•¥æ— æ³•çµæ´»å˜æ›´ç­‰é—®é¢˜ã€‚å‡ ä¸ªå¥½å¤„:</p><ol><li><strong>åˆ†åŒºè½¬æ¢å‡½æ•°å¸®åŠ©è‡ªåŠ¨è¿›è¡Œåˆ†åŒº</strong></li><li><strong>æŸ¥è¯¢æ—¶ä¸éœ€æŒ‡æ˜åˆ†åŒº</strong></li><li><strong>åˆ†åŒºç­–ç•¥åŠ¨æ€æ¼”åŒ–</strong></li></ol><h4 id="Partition-Evolution">Partition Evolution</h4><p>ä¿®æ”¹åˆ†åŒº, å’Œ<strong>Schema Evolutionç±»ä¼¼,</strong> åªæ”¹å˜å…ƒæ•°æ®**, ä¸æ”¹å˜åº•å±‚çš„æ•°æ®æ–‡ä»¶,** ä¸ä¼šä¿®æ”¹æ—§çš„åˆ†åŒºè§„èŒƒï¼Œè€Œæ˜¯ä¼šåˆ›å»ºä¸€ä¸ª<strong>å…¨æ–°çš„åˆ†åŒºè§„èŒƒ (Partition Spec)</strong></p><p>æ–°å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªåˆ†åŒºçš„è¡¨:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user_part_hidden (</span><br><span class="line">     id <span class="type">bigint</span>,</span><br><span class="line">     name String,</span><br><span class="line">     ts <span class="type">timestamp</span>,</span><br><span class="line">    dt string</span><br><span class="line">) <span class="keyword">USING</span> iceberg</span><br><span class="line">PARTITIONED <span class="keyword">BY</span> (days(ts), bucket(<span class="number">3</span>, id)); </span><br></pre></td></tr></table></figure><p>åˆ é™¤ä¸€ä¸ªåˆ†åŒº, ä¿®æ”¹ä¸€ä¸ªåˆ†åŒº:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user_part_hidden <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> FIELD bucket(<span class="number">3</span>, id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ice_spark_hdfs.t_user_part_hidden </span><br><span class="line">REPLACE <span class="keyword">PARTITION</span> FIELD days(ts) <span class="keyword">WITH</span> months(ts) <span class="keyword">AS</span> <span class="keyword">month</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ—¶æ—§æ•°æ®æŒ‰æ—§åˆ†åŒºæŸ¥, æ–°æ•°æ®æŒ‰æ–°åˆ†åŒºæŸ¥:</p><ol><li>éå†å½“å‰å¿«ç…§ä¸­çš„æ¯ä¸€ä¸ªæ¸…å•æ–‡ä»¶(æŸ¥Manifest List)</li><li>å¯¹äºæ¯ä¸€ä¸ªæ¸…å•æ–‡ä»¶ï¼Œå®ƒä¼šè¯»å–è¯¥æ–‡ä»¶å…ƒæ•°æ®ä¸­è®°å½•çš„ <code>partition-spec-id</code></li><li>ä»è¡¨å…ƒæ•°æ®çš„ <code>partition-specs</code> åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸è¯¥ ID å¯¹åº”çš„<strong>é‚£ä¸ªå†å²ç‰ˆæœ¬</strong>çš„åˆ†åŒºè§„èŒƒ</li><li>ä½¿ç”¨è¿™ä¸ª<strong>ä¸æ•°æ®åŒ¹é…çš„å†å²åˆ†åŒºè§„èŒƒ</strong>ï¼Œæ¥è½¬æ¢ç”¨æˆ·æŸ¥è¯¢ä¸­çš„è¿‡æ»¤æ¡ä»¶ï¼Œä»è€Œå¯¹è¯¥æ¸…å•æ–‡ä»¶ä¸‹çš„æ•°æ®æ–‡ä»¶è¿›è¡Œæœ‰æ•ˆçš„åˆ†åŒºè£å‰ª</li></ol><h3 id="Time-Travel">Time Travel</h3><p>Iceberg çš„ <strong>æ—¶é—´æ—…è¡Œ</strong> åŠŸèƒ½å…è®¸ç”¨æˆ·æŸ¥è¯¢è¡¨åœ¨ <strong>ç‰¹å®šæ—¶é—´ç‚¹</strong> æˆ– <strong>ç‰¹å®šç‰ˆæœ¬</strong> çš„å†å²æ•°æ®å¿«ç…§ï¼Œæ— éœ€æ‰‹åŠ¨å¤‡ä»½æˆ–è¿ç§»æ•°æ®ã€‚</p><p><strong>æ—¶é—´æ—…è¡Œçš„æ ¸å¿ƒèƒ½åŠ›:</strong></p><ul><li><strong>æŒ‰æ—¶é—´æˆ³æŸ¥è¯¢</strong>ï¼šæŒ‡å®šå…·ä½“æ—¶é—´ï¼ˆå¦‚ <code>'2023-10-01 10:00:00'</code>ï¼‰ï¼ŒæŸ¥è¯¢è¯¥æ—¶åˆ»çš„æ•°æ®çŠ¶æ€</li><li><strong>æŒ‰å¿«ç…§IDæŸ¥è¯¢</strong>ï¼šé€šè¿‡å”¯ä¸€å¿«ç…§ IDï¼ˆå¦‚ <code>10963874102873</code>ï¼‰å®šä½æ•°æ®ç‰ˆæœ¬ã€‚</li></ul><p>ä½¿ç”¨ç¤ºä¾‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ice_spark_hdfs.t_user_part_hidden VERSION <span class="keyword">AS</span> <span class="keyword">OF</span> <span class="number">807038129550906544</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span>  ice_spark_hdfs.t_user_part_hidden <span class="type">TIMESTAMP</span> <span class="keyword">AS</span> <span class="keyword">OF</span> <span class="string">&#x27;2025-02-15 00:39:01.33&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•å®ç°:</p><p>éå†snapshot-log, æŸ¥è¯¢åœ¨æ—¶é—´æˆ³æ­£å¥½åœ¨æŒ‡å®šçš„æ—¶é—´ç‚¹ä¹‹å‰æˆ–ä¹‹æ—¶çš„æœ€åä¸€ä¸ªå¿«ç…§IDæˆ–è€…æŒ‡å®šçš„å¿«ç…§ID, ç„¶åå°±æ˜¯æ­£å¸¸çš„æŸ¥è¯¢æµç¨‹</p><p>å…·ä½“å‚æ•°çš„è®¾è®¡å¯ä»¥çœ‹ä¸‹é¢çš„æ–‡æ¡£:</p><p><a href="https://github.com/apache/iceberg/blob/main/format/spec.md">spec</a></p><p><strong>å£°æ˜</strong>: æœ¬æ–‡ç»™å‡ºçš„ä¾‹å­ä¸å…¨æ˜¯çœŸå®æ•°æ®, åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ğŸ¥°</p>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Iceberg </tag>
            
            <tag> Lakehouse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025äº”å…­æœˆç”Ÿæ´»è®°å½•</title>
      <link href="/2025/06/08/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/06/08/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="bebe575760cb898893c8cc5a421f5584cd6a57a85829aa842fcdf3bd62772569">f33a6d5ec2003e353696027d8241bf513ca6f8cde9767d20028f3d9c2c0b7b5206646e5401a9f0abe3506ca31da6f942e4594c7544209382d91eb06eb4db8979240e72a0214c1d2b2b9b69c1729b8b68eebb36c4aa66c0f403fc702361aadde4cfccdaa8505dc94ee47827af1fd31d2a8cef6749b3c3b6edad385b807bf8c9aec310bc5133a24c1d77bf616762f45b15d01ce941ef5c43218b6c6ebff95828f272f386038ce9d368113c835c4a8a49c54626a4bad7634ce7f3ee1c431e226750b898a2931bba07bc7b1f22d6b1fbed38c8551384d3534ceac1fbd0439aac4ebdd55e20d48d65e1db151a33ca7b4aa078cd783bf413318bf725847849adacfa4f36e11a4cc58e1f0fa61a70401624202c04570e7df65449ec8a58a6795ae19041a1be068ca08551801791ee3d14439855bea0a2584b4f56db82fb5f9520163d5e6887936161f916db1a4a6914a968af851cc1d6bb2ebb3909ccb44aec9ca876bf761e9727c6d783f3b586a59909eb6e83450da7f1b1f14650664dbb039cd2b0bd77b834f0339bb041856266cf9e2dbda9e6b75b863c0f1651df47505e837772b69d07d28fd82183b6f56959acc2f06b257db5534459c66a9a2a4efeeac2a73f60c4784def5a5ea29656b6fd04ac3d0a0be0767a5a9cb2b0885fb3fb77243f85c52f9eaf7db11ae6de1ccb7a4027cbcce16371460548ace504799898581f4bcecf0b3ea900acfcd4413f14362e301a806649ac3c0bef6bd4b125ffb43d9c91780c28bd2056f8d98fbb4d7ae034a68a12b142d33298660190965540b58253940a33db55f929a886b8878ed1b07b8db9cf3384a633f6b7a2a2ce075f0d56222ae5bb9a4bfba80b21262dea36bc6582e6138388a035102b37bcfd17af66cce53f24b8cee4362a634574b5962f1c1681318af512b423b71b2674351963a30efaa58594c74d660d6578448ee06fa4238be85d941eb9f20f40ecfa6eed7f5072d3a8372c404f8b9d8f542de1b19dbf93df0d57b26adc6eccc49377f7a9c376871be44d6c8b994cad8f08db83ea9697384096c839e23ce50abe3ce468f183997d95a68277ed56b1ea4ab0a098003ef63027d7816eedb60b9b1e20b8d94fa2aa816bc3c5455850e93b580aead1d391a2071c7f4a920dc472006e4d79a96c456b72103d342c024d02eb9aea8d5923a731663afb70bf9be47231da6207adac3206fff91053a55cb5390bbd4e5f4bc9649a8627396d14575aa60cca053def021dc30c069fbfe3baee33b81144135ea93e710fa2f887fbc6e55e5565594cd9678a7a2b991fcdfed128429f5e9f7689e982a7fddb4b652939c1476affc02c71bdc8df8481e65922ff9f1811adc9c6d39fdb7733e497540f8bcec2e3b98d42caf261881a72999a17d4f642e1bebd9c6e994b05b19c70230931007c497ba475466074c6a15d9423b657e4984326a7e6c7669db44c69ac0f3c3c447077ed7b18ddd25235e46bfa6fdd5ba7a42df5a144b323478322010e5d0b8dc7d1a6099a2d1afe416f99a06411bece12692becfd9b100102e73cca73b885f3c9d7824671f01a311bc3ea28835950890b9a7e808bc70ebcc39d857862008ef55be34fa4266686b49943d3fdbf183d147999e24c323f83bd001bfff96fd898e0a780c17c43273283d5b631d0f5440879fe03d4443c58f6d6642d91f4b98beb139eb2d5a93422cd7cf04a286670039b6f4b0d08d301f90b82818524d0beb275abf8f09860421ee263cf8c7a6b8a5a00e012f9c260116f065d8995133029261c5ab386609d9f91d75cc4764d5a5df6b67bdd3cd8d567a7e8228544bd04c396ae19388ec3d310567cdb312f87ae34d8852b5ea85225a57057dbc313231d149468ea30cc8c26cae8d003fc667392fea72ec1ac72b5c497122cfc93ce0dfc767ed59433e942a1817ff627df90e022fefa67f0b3faceeb631a03b12b4d38ab90273a82299bce34014470455523df13255da8bc8ba86b098d11d04ebaea814c142efd0d406756a88bb9e15c322aca647c42294c7fe3fe50fe5965e3eeb6b2138a8cf431ab20453d7bc8d0f2f36ca41f1041c2af5aa0380acd0bd14961a55aad267bf2f14e6051375fdf3d5789b7929bfe53520376c7f1b640bbcedbe0fb3b2f9351b41aefcdbba808d44874765ba90f424fe15ae1d24813b78baea27b792d1d12630c65edcc5df91eb6f8b296005dd0830ee843a4775cc25aa6152dea05520ace5754481879dd2a4106f063039e9ba88db1b837b61e2f9c1f6b52091982fe649165c35a1794882740d344961d210135f0392c34e48f31df56c52a30ee8e3c4cc2e3e37c2f4a18378fec1f1ba83e7b7a1d30e4fd3956d7a606f5d58b4513d2bd1f9bdb4326fdd313b5b4fff57ff1113bd447685c0c252716ab8f3c3a7740558578c4653c28368ca17558861ca48a1138d5270209b40ee298ecbd877249c97665844cc971c400356c2d5574edb3fcf8c1ba67ddd7d6983bde5f75b9c8c7def54f19eecbab7e5032065f642b5045bf7e205ab4b04ef5eff0716942f7a1c815a6a3b45d407724c27238b302965c6a02eb648a3a80b797e505f3e078b61c5c26ab448bb827d5e7e43897ffca20a9b88e40e6d3a6c81cfe708480aef82a9829bdf679edd4535f98fa173ccc36bd48555b30daaa2913350fa338a20312919f3919a82462122d63febf2406033a52d877fa544d78f4ce2e6b9cc6373677855b50815492296290c5d0ab37386e0059897d83d6b2b0c0a7a839853068a49c0b8348f68a21150575b76dd5a86bed10d2ee825ed386cb5a34d1b3ef913b5e31cb97aeb4c0549025a1cdceadc98b2b512dfe11fab29971d3fca36d542634efa741a5ab687693780a1f05c0119c14fe4146ee31e7eacc9b584c3fddee811e7d3493531bea44caaffdfb41c21c5f88c1ed28b8dec58e595488cd13a93a8e8a093b447eaa227fc0c30b1b4fc2bb40d0a363e214b5090a2650b22f472091920765860a71ba57f945afbad010e5df96b991f4eecbc8523db7765e2367ec7e2c2ae8cf2c6556edad580290886f308096cb58aeebe4bd5149f331ea6b83c4d63ece17e58838a121a59add6d43eacc91afedc0fff9b0c8ca1db035e52edccd534f880b2ae7afc286736c0acb30b342a68ac27253b4eb0aad21a480fe03a0d38d447d2e8ee607013a6c7f4244e50c57e594baf59519ff60602611de7600b986794e417d2e316b72f09753da2252b7432e34fb73c1fd658412219d8cbc1c81a3768d43577dc0ff6c16d88a06aeb535d1a0d5e246b0c9f98b020e71c0351bd0b8f552c45d5729b824054156ebf1096eb7b858ecde5d78cae035e20bb42af76ed5de85b822d5c1b9da4a9792ceb8f8668813989a513028f0fc05f9412847e1d7fd6055938e8bf02cd08817469daef0a269baa63a82caefecbd73b307aec2db1441e53af27bbdbaad4f82f0b5d2782ae102bb8cfbbc6f2f7c7bc208ba9a4a358f7cf497a238baabff23f5756b4060103d3d64cacf60ebfbbd090a77d4a9aac49590bac131fe6c57c1913707dfefcc0535a3b9f52237bf1e1483bde5f1071814f9b96c7e80b2471f8e6303ed3810a9840bb115a781ac29a94824efb563672c9913aa659461b3f6d22015d19f6ff601cc5779f24041c78098f082ae3b946e785640d21711989104dd7091b739f26df7d8d9fd33d0b11de34dbca18f392db8a744bc273a3f58f5aee84cec33aa3d8b3633bd7b6c9a6c458ee2f0d0949d622887eafe00b91b52b802ebb9c4f1d24050fa2c19e6a84baea76ea3fdaa496584c751a70d7239eeaac4e111dd4524276b86ba3baddfb8f933bc1b1e894e7dac871df1ae164e0b4b5e36f99d85c64f728dce6ed467b132d4b11dd05329cfecb90bd47ffa485585047b9a0f3f052f53392b124179cc10744c46e8befd4d8ac8d956f6a4c1de05bfff1653527b372504be69ec91d547a4a7ab6168d9a1e49d86835d877c59d544d42e30230f19d41552a08ec51749182a579ed2f443e8322498cd948960fb8a2f24e6e3b5f1f065208491df992520739e8ff157a66c6f5dedf96018a89dc1e28c1ea6c0c61bdd7f8579d216f79794e370c37d7a872c771ac15c95a47d4e2612b9f4c3e35d184903121619a49d09279be267375690d354c44d2ff6a330dbf6372ce4e1e130705a079f778d46155f048eb65d4820e63a4573bae2ebe701b17866e50ae49c25d9afe946ceae942fd8cfffd0e0e5b33a649394d68b1b33a1045bfcf14fab627d1fc426e7cbd24d35d3dd9e156adfe3c3d952ed1944e2eb0a022046f1aa82446764e459b8116e38623384905e48647f4a0ff8383e444df78f22e2108d156ec32bc9894df8cd0dff27fbe5d1e56023c3a8dd8ed515f0659f983379e9beb99807de2591118df6534c3706dc4ccbe88e19079cbff32f7fe2de8cfd244381214faa85b9fb4fb242a31648d658a8d4fa03ed989935713f95f843a508330cc21d426f30f635500ac4997ec8ef4cfd46005ff99b3c1274f0b02059a3b46d99440039e5e371bb8c764e0673840f2ff28649a6dc96f28512ba65dc4654aac26c6877d1d6d13bef9f928893810359b6f2e63a9f258c1a69a2a993a33850517b6a059853f31356e4c5b8fc830d955fee5b814d5af396c4a9d0427eec892f5c70149a3251b0de37e4fad82a2a3a434cf46c19ff3d5fab236b32d32996c545f92345081763a142541f864d48af67f182555a72587545681e6ddbddfb49e6a95edad6055b0af41e771c4f8bf3e27b594af79e0a3dc3df1738a38d989231f9c200ed13c0b0727471932d7bd1e8634ab315759f1b466b0dd5be43b722a249e92cce856f619101b4b48b8db53bb53e1d895f16134eac36b3a3197ddd37c3629cc6ba1b0460e8efe91b920b75604b337f4b62222d28d6867cb142b5323b58d14aab14ab1adc5b88e8593c0a3e146d570d68460e990c54e775f75e3831d9a7b1be56cdd5714a4b0b7db661e9542d261a76235cdc3a9d2ce59f73f568806f981cc1d860735f0a1a9968c9dda6769312ee44bac859557650d7fb89f5704ee43023ca8bebfc0e7316e8ad1dcaa34bd84e86da75d403b17189839b910a24b3254b1203ac9e7dc4de4f4bf023ea79ff34bb67eaff1b887cea437d14c7f10e9995ed05ce71508f5df4ab3132b202cbbbaf454e8a47fb236dfadacf4d551c464b2edeae998e4d0dff7e9fb9514a99a777c8a4312c2ef89f92f72b122bdc8d0affc457450a2f13de76c9cf4b2ebed1e2b0cf740ebdaabc08c72d9fb72fbc14548fdfe258a0abe26965e262d4dfdf3a68016418dba0d3816c4c439d34c91d060edd689454a9d773a91aaaf27c5c2e2a92dc5e53e4e11052a6e8e9d18a5f680a883f257d47440623e712b9231e335c6f2f829cfc18b6267f337d0582e1db104e39f8375f4cba2de570f31af0bf164c952a3e161f18ce5bc0f998c4935249e9ccea64814a69d905126cbe1abea619607035b8f02b8307ae85e0490d8a5cf4cb32a76101728a832f7a20c7657e9693b3cf90c54274b36450dccfe6b953f795fb5948d53c7322b28a091ead3d14702248df2919ba01dda8c409c140dbdef197b7e2acfd1e57af30e79fc0d3010981fafbadb7720673065f14f4ac7f83f16b05fdc63393d56192c492c2713dd8f18214ae6cf0d3a76ecd7320f00f72e74dcd82e57ab8664e0adcfaa9b74d993ad7a71d38a065169d2c47b0d0497ab6edfe85b2488440bf2fce806e2d39c11058741a85aaa106f1b14f542266339016126f45e6f1ad0259abb08447840272b4a78a2bf13b9aba7d32b85c09e96138b7fb82db5942ac16a4e0eb943e0fa5a497818970f87215e52ee7d1dd3a233f9fc1c4c6bbb3c9c79f99f40a267121d9f9d58148bbe35c63072e7fce2cabe70c90bef8f3c5a7b041d25a06ef9dd3b63e2fca38fae19a7b3ed7ed7518a7d5cca0b4691b0e52b453b29f8bb5357d64745ecc96d679765b6b8dda568cf1b33a375547d7e0e0df63e501778e4ba47a6609bec79d330639eae26d8e4094e4cddf801371bac39f00f75d01dedd969fd32f1d6fe6477293b2a22c3277c018b904ee83cfaeb8139fbf3618b5bdbfdcec8dd8a9c43bdc1326f988a7eb4d54a865f8b0552aeaba94d83bf01f065da942db0cc7ab86f31733a3b0cfd2be0463d20533f264e0cfe810a7788c0a4c2433aafe0a0c76edea338c88c7f22dfbf4e149e573db5ae8351e5c2da35dd0189b7ff10ef1372668ccd794b484cee81b2efc1eac2b0f1d99c6af1584e00f8f7fcf46dbc5e710ab4d3143068784a7bb766b54c19078da79c3389d2cc74d5b98bbc118771a5d6bd80454e77795aef184f116dc456dd5146b6af9afe54e63dd3afebeb3a0dbfc15ef93c77b75311f9b55cd2224d58c34b020fe67ac139cb6cc764974c4b48f0074b65bff9b7cce6a61eae75837503a7c57e0da046cc6c4fb6130179d553d63c0556d3edfeda54b236bf541d16b492582e6c2e7eca3a275362abfd4e2fce0a52f84b2fbd55792da7c6b88ece2146d0f6b01a4284fa35b463d87fe5ad4381ffbcea4898ea5c35b1ca30599c426c46502e291f0503c0c1febaec70ebe04f08b97aea0b0118880510d948589a8ac41601edfeb22009c63ea1d4d6c3fcc03cb4186b279fe5dc15f4f37c894023d2154c8e1d1f15690e653fd6aee8119b1c9adb44718072af913727aa8c54f00a4db6d4d387ba12d9f1e80b57236785b5b96ccfc441da5d595122c8905b523c5ad9efaca97c1b5589c24b55cab7084617ce0049c4a2d5baad35da436e2e5afaa2c86180d33817e9caf9d21f2803cb226aa666a0f89550f4b6c0f5d506e90a803b06755e4fb0a7453645e8dd125941bcea256e69af7b97f624dfb13484f2135cd034854e7c3a1bb14d9ec7147bf0da7b8907b6e520cd2e9452ec6e85ade473580720402370484a13224c19c92868c23243e6ee7db97a9c3ff051d65e9d5daa3fff41fd6a1f608d5b7f8251ba75a2bbd5eb76b36cfd59a661cfe9a9662d606aaea3b55ec6682323253e3637988f8c98a74327697f0ae07c108e549967b84be19c60436f79f1eb723cefbffa880b7799c001f9d84a96d672e2dae02dc77c1adf52c44fd263b9022a01507532efa53cc6f5ba61ae20c8dfb46bbc15483e7b44b579cc80117ca826d4d515611ead246cce0936a52c10c4585abbf59eca3cae3a232d2c1aefe76bec90ec607f9f9702f51bdca9451739273d6d25689e15724dd07f5ae785ef8593fc9c6960349f61fb0ba23709fd97e5548742b49614cf75c309e3aa98837436f372a94cdfea8c68a9fcd94a4962778f5af87c861de0c06136f8000e9bb84481d7fe273ba33640784ab46dd19ece9ddabc475146cb71bd888da16c1e6739491a69eea9b28831b5dea5367aab289a26b401d928de5c01e0342622f55b84a640e7d50a36d650fdaf63235fc6a7ac754c6f2d20bbccd4749f2d3bf8cc161f446a0f8912769f82c6513b2c44c2b594c3b174e157a4a1bc4c142b5718f456b1bd270a19b7c6a626a10e4d64afa47b886a0664988c24476e1b08ff43b2010bff6fe9a54b1ca659b7f273bcd13eedf366b2e396ab55e1bafb86129bede3e1b35323de8dc75ca4521eda32acd8bd25e73f5484697baf370ddf9f4c85b8ea006d0bacd2299b93bc714c83f926d6ec4fc8d48fa980aeae6e9c22509df59300a18c11ba8157775ddafaaab7426b2dbc42089e636f0d35dc59fcba7780ebadfa74733c8ae31a12449b05ff61b7e5538b4209792c11a40489ff98f5e3f52e6f27a21aec04119f401d3a0cd2c5ea17861cbacb56863fcc1176fee90c65320d8e7e3cce8ead6571876a309448d3bacfc0776f7c944b2030db626ce76d23513203384c686708060cacc8f54152528980bf53fa7014fffcb40f2dcb18587d0ce09d535f16329c35284b15dbf8ff36a8b20e9fc0051730e42d3abecb4ad9c157666fbcc8072f8e6c57aa5f8d610771bce6001dd1b46870999e254dee9baf407bee942868235c818fe7dc74385681ba7875369d5344201b7d512c74d4b0b5ac7f231d29e67755775022971daf4b873eff73cd66890db1d6e6ed30ec315bd9dfae5c6d360536fab75be8a5f8cde74b4de356f52f0f8b27f17206d02587532738fe1b5965062b61c8730e0f26a2e42d92ff74e2d7a50d4e1dcdf3809dd8f2e0aaa6b41dbf1b97ec9b808d6cba99bae81eedd0720e94ae0d4b0acdba337bcc6eb9983f9fcf0d1ad53585db244ef2b5467fd1736aaf381347ed1966c81545563050249510dc3c0a48ae54102d7cbf2f6425f9ef5ca768a17251fa18ec94b7fafaf5bbb5e7e016ce171c8937e0c3b8c587f17df1137b4d906b71f2a2cd07f0363211c8d069cec2061659a1d1067750746d538ca67e479410721342966645420a2039dfdcdbeaf2f34a6adc223a8f0532ffd8e82ddb45e5f1ab9c4081fa62622c60e3cb9148a3edaefc1d92fb0b0d027b9538d2e105ce38b935f6b2a876f4a87d05afb0992c8b062887bbd4b5fc63fe7e5227139818979e27b4db664995c55d715225730f9747fd84f336471acca272c35fea8dd328748f007a9da641410923c948b6fbff504c55f73a9d1934831f8dc89ab9a549b22ca5ca48fb03de99f7ba2da60d709ee03beff2878a7eaee9785f7436a9724bc3fd3ff71bd7166a75b3ab965360942b23bdbf5d05f7e1536b6898db7d2d9263c8e9112b7848f1c6a80f3cccb4061d55a2ea75370f883cdd90a03567ae07103b0f7added1e09c20bcc87854d7bf07559181d630d00570e176ce87b274cde863a0094467b22a677ffa8ba026e2c5b5b9c0fad975c4b9286dac82e5d77494e9901453f76d9d3b2387a33af80979e432e682c94f0c505f284329cdad88753ac266a4783f00ef9c46883040edb6b8bb8ea954f209246120f1df1722f38f2cc52554a95d1b5a98da1bf76cd8d54115ab82f22debe766a8ee26a12030dfaa6232ca979b071691bda1aa53cd00007b62e93485ae76bce545133d6ee454eea8c8c943a78be64824738e45417e9339784c1688fe64fd93f08fe6cf8c5c73d419bfc1df22a3ea2c43835701aa020c8ac5b668b400aa33d23530bf5b9486d69db96b5d9488dd750b86fb7314c2303e7a1b9a739dc35dc60310f7bd48accb874abdc3cd7f777ba6dbd0e7de3b7a49ba049c24a521ff05bd7926fd392affb91700902b8f4def19a35945a6fc6f1305689e8e2841b00cd33e19218e9645074efdc9b3089d38d872810d589a9f40b34168d4c3b026ae78095929bfd06b832b97852b9e5409006ce9673ecf637d7379f8940eba7114a57272117061041f67e92687696dae33898890a60df600daba3b45bace4b468330b598cb8adafa25956b51f66cdc806e4e433ee39b0aa9c6020e79d2b9e6a877632fd1af95627c6b190447c10dabd411da3bd107bbbbd4761b9970c864943778ee699abb47c5eeadd1a89e0f26c9c8f43e2fb0955d38c7293d7451857b0d9d2ec33d7ca4098c5ee0e98ec2ece5e9e48f881c840ee6c4cc11b2f29c46724c59cb90e9b0c6121115010c75bf551f2ba08d94078779c8fd54b4d8ad3c9fa972b0701a951c37b84414f9d4378d76f52795cfdadd20c235b49c3ae1be27ba5542387da7e0a26ce2403b0323630adac38d216d6a4fc394f598a4d411b284e46a23c0bb2a284f34a853edb4c570b2feb54bd561c90e2060f0ede23e4e0b35847c8853b5932cedb8c1c58e000a1da1a2add5264584a2d0163856d0bcae6fd7ff9c238bfe18f79aa9e872995696640838b0a7a95f0489ec4ba39d1e38765967a0eb2279a5366449d012cebd3ba37596d9bf24319a2ce7ef17bff280b406cdc501a87f8d329b42553993aeac74b44f1fa3a09c143f1a5dfc980ac9185be8f1671a2cb826a9d0f7b52bd15cb5609ba4092999edf18c6129447d6a12c8b3bd34bc6cb294ee6ec2957e090b462c8b669c9c00aa2576b647fc8bda3cfc1dfdeba33ad45dce41894519ae95e4d55a4ee68dfbbe5fe41a0d26b16d92740e12b183b391da2e0f4c0d3a69a61b181e75d7d638afb076ecd2417e2a8696da4028b5a44aa47eaef34b9ec14291f148b39427bbda8cfc5737a0b38a8a971dd739da5816fe9542567edfa9ffd38ad0e1a465a94c175630a540117ba175519cd35d752625942c867fc79b3121857d35bac9b43d764cf37654d7f535a91f250ec146571620e3c8a54208f6f8e9fe354098ee3569244eeda1efa27a6b8537411e1f93afb7709c763388ad233e7e6b097b733881cb437a7a6f84d688301641b1f07237ed16838606e1f05e1510cd5b852cb84108f5ebdbdb5069db4e9c7098dde767f9e021a0ad1ae76b3c4695060105c535229d2f4b1b32e3fcc1571d824c59e38ddc654ef2b1050e4d53c5d89631ab262dbd0626da4d2b0f1cfc9aa794d7fc04a1dddcb72db076645104fd38e64604a60528deb8efc8888b9be13d4bc1b4e751ae804497894062e17d491f0bda4100bfc5ebae87e0dc3fe1ff55d2b671848522e4dd98a9e524cd5ae2c07ee82ef67c5d1aa867b7879818c41a7d9f45e6bf98412ebefdfc1934e729695591c570338ede99f8997534f3a7290a8e2a2fda00ce0c065b3c4f0c4a4bb9f0e7307c8d2aef629afdeb3b3a87f022e9839e8db25b95362a7d8f81219c19d609d3e7052c3db04d4dbc71ba76e14e11d7f1a278b10f7bc4126650d035fe24eabb5fc23527cf5969fd0a2f74fd394a37e4f9ee70db64fceceb39165c13112d16a4d2474c2d74a8fa79efc1272861569b10d792749c5cfe1f3c0e3df9fa493d046440ee695c8d8d5f3032e9611a2b573d8284f5354916a84d4dc2cca6260ef88df24a2d195974e45edae56e976516fbe21ae9613f27e28fd29d1d88af99851ccf309c98df374cbdef0c6ccc803f0b916dca1d10ae80e1d21b641e16df99e78ee908216172c27024cc54f0994eadbaddf3097c9d7a8728cc10389153b433c4ff4110c01ea093e0b069ee865bb449af57144363718d73af64d427177ba25b54ab66cf604ce03005a05692336c7271e15bc94104426ada626d01ccea2aa14c86a6fd889678013cd3984becb0b4edf8278758f6d6f9c3c66cc31b01183933407d0ba3d4bccca41b211be4070a0f34147a3b885161bb58e5064c748870101064cf4e728a81fe4aa041e9f8133ac50ae9d1871ee5764d2139fb67de9b2698459cfeb5f3fd1c5a3d7ec9158b7180c053a2859ca630fae88473eb10f6e41675ee13ac9e430e71a501a38d3d550fa1b0c41dc32336431eeb580840183753096498d907b470829fabbbf43e47202ab0d4859ae781d924f243ca1000d9cadb0baacfd1b37b7eaeefda5769a833d79e12cee1ea45cca95ba40ce32c356ed0f7792fff761b24e64f4f5311772246ddefbf3a68f38f12fc2e0adf3a0d39e75f6a253aadac0f658006704c72079957b2bfa65b7df84c8824453a235a66a6874b927222ce65fd4d2cce09f8e218dee8b023944a8bcae896a142b54b9a74f21bfdf7a79fd8a041a0a10790ead7bbba5a50db693a2e6581ebdfda9cb2a05fba4266f0c949a20bc57f0acb692c8b840e2bc6d0e1b37fccecb78c58b61f790b1f166c8c708c65372283aa9e698b122e97cca94b35fecb8b64d102400f0d3eced74823b4aa520eb46579e4fae5fbb9ef2d57a2fdf7f55b69e4d6e27db1a061500c6d4b03f08a4f3330bbf645466da0aad66f6b4f3b1a5bbee959a4de46a4f259412e005d3d50eee3ae32232ca41c2bdc4ee9ee8861f783ceb5ae35f8cd5825e81322ccc69d97af5ba10bb37b1816b2efe80341ad01b38676a8cbf31103c121d78fbd9b0de6c16fec9bb4fea6809456f0e8fb6e22152fd7a6332d34ffdc7b2da4000a916b7e555d9a69dcd38af6ffea279db8ff9e753c37a9891333a0530de22e9d9d18443a1c5eb811467e7e9bfb54ea949a91c6b3175fb1bf80bb00f1bf9e6c1b217b209da3fcabfe9cf372c1c24f5e59046f029f805a027063ef1d517d4bd693d7cfd3f7cb02fb17898d384a40505434692e68ae50f41e68fc81252c64379976ef72f8a35d7c62a9198f8e8b199aeb38ed4267ab19ed5b6efa10014ba2631f580d36976ca644373054318341b3f83c</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-shrink">      <input class="hbe hbe-input-field hbe-input-field-shrink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-shrink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-shrink">åŠ å¯†æ–‡ç« , å¯†ç æ˜¯åšä¸»åå­—é¦–å­—æ¯+ç”Ÿæ—¥(3ä½å°å†™å­—æ¯+8ä½æ•°å­—)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025ä¸‰å››æœˆç”Ÿæ´»è®°å½•</title>
      <link href="/2025/04/05/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/04/05/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="35d72c4c359392c8dcd60d541a912a452196f307d300874bd433b10e146f7135">f33a6d5ec2003e353696027d8241bf513ca6f8cde9767d20028f3d9c2c0b7b5206646e5401a9f0abe3506ca31da6f942e4594c7544209382d91eb06eb4db8979240e72a0214c1d2b2b9b69c1729b8b68eebb36c4aa66c0f403fc702361aadde4cfccdaa8505dc94ee47827af1fd31d2a8cef6749b3c3b6edad385b807bf8c9aec310bc5133a24c1d77bf616762f45b15d01ce941ef5c43218b6c6ebff95828f272f386038ce9d368113c835c4a8a49c54626a4bad7634ce7f3ee1c431e226750b898a2931bba07bc7b1f22d6b1fbed38c8551384d3534ceac1fbd0439aac4ebdd55e20d48d65e1db151a33ca7b4aa078cd783bf413318bf725847849adacfa4f36e11a4cc58e1f0fa61a70401624202c04570e7df65449ec8a58a6795ae19041a1be068ca08551801791ee3d14439855baa2f2153444dcb2c7ac9f8c2881aa278fd4e3e8582ffd4bc7855212d222da84c303f0941f57f26ef9698ef9a64a0359452b8604b213bb12a3699b5bd9c290c5c178fc64a8e0690746cbd559e44811c99eab5ec0d341a0db040e7ee350d1eabd84eb732be89a67df763ac6a511b99c18afa228623edc7af00702f046552020c3c89f4d28e95f237cfae61824d8bf08767ae285221d48c8213768d0ad70172e8dfd9d12e6896aa493d869c33c156b8ec4ed5f25cff0b07af7bd3d0cc48d576ad4cb98023ce390fbfe2a7ba330455ce92add53921ed32da1beb5232c9819f9d4da7dd693db0fed59e9f24195999dfb3828cb531975d444273b8e13cc16e9a2b2db0084fb29344bb2871097b4d9f6768ab10e0e81ccecee3eadc4ca3e57330fc9860e38a2255d6f3eb83cb088664a8fc2041959c240b73a70f80e4691d28311b68dc6098bbb94ddd7a674b407761e7441faab4e9f9ff8d00675fd90b6b36a45fa1674248e16bdb98d9ae1ae7df9378752592537f6a34d7b2b6e24f57eace1f093d9266032d1803fa9e315dcbc11a87140ec37a69c4e937118cacfc5a305934198cc78dcdaa37c179c9bbe87318595f83ef5a6f52f87da53b909d1266a89af80db99d8d863d4fdcf9f9c332f47062c9724bf8c854c74799488e96aa65f9c69b0aabbe8610e8081fb89fd490850e44021a95f2833e025fc923bc7caf64c0b92ac1d7aced7270a6badd1cd9db8463ee6d2587a04ba64ee8c0da32cded2bf09398c7d92041a89185a49b2700c032fdf6ed600191ef16e04f88d45add885f8a723dcb048f724c6037c3baceaa499b98453e695a74d2370a964887830a2efc5087131ed36c0c6d13a8eebf7d01a3301175a6d0b6a82f6fe4b471ee6c1bfad166e2a0c9b2d71bf5227e2390ebc941884596d95452761730ef2ebf18172aa9d93bd79be931181baf37543295b64c240fe701111e85d7aa1748b01d26862fd67243d7633704fc684c7d8a5f9170c85501c9db373847d0961c5d4b302bb8f0f3207af554876008bdb2faba9cef1b63114ad3a0ad32ea34694dd332786c67863037411dedbf18010f27e7cdc338d9f52862b049d419c4fdc1682f6fcd7ec186376f28fcc8920c7553f0ca1252fefa8c2caa490cb098409f63a1693c743c97a793bcf11ddc49a91539622941d1b87a993e218dad3dc8ad40603e2766b57bf6c06ac768f6c40a72448d049dc5c6e4fc770bda9fb3d28f5e8c001a39631255955e5c0acb1487a886ee29f126ca554fa2d722449e0a49fcd86ca52418691d66189b5980fe490bfc6b97a4abd17733910c50de6454e930e738981308e816d6f5b296e8ede06f1fb3ccf5295f1eeb2d402993080444103a169af3643d52ce8ca14b746099446c34c8826850de2dddad52c5222af036e89d38c1a107666322f3393764b610f1beca0c1e9fec9dff1d3dadb51bb03849b1289cd5810dbe98bff3dda2a3cc5c1faab216151f2b1a50b48c4c7f12f06e424056e6531426bcdb26d18506405ff8c51341adf7542f8a4d16abef3b3d353eaf22ec7fcd38ac13ff2e40819fc9dd1fecebcf7e02327fb79658e2b3c252e1c6779357685b13eb0320449fc2a9177009e25cb94a7609bee90130b2e8683b613b229b432d5b4a8201bd750bffbf50d6ca3379b31b414c95b6b20dd5ff143a435191415752e804694aba6cc6b70f69df913b4fbe127f3bff370a927a5c9b9e7e0af51f38ada440f13a9487f2d21b31338d145632d26f4afe218a7e6620bd369739af1402f76751a5dd702dea342d217ce0ea31618adf971579345bdb057dea59b48fc0305137b2fe5494250807c071895bfb6803a031ced72fff68e40dadd9892bbeef43569b083f59ecddfd2b9e066d2625179c720ac847ac85c6e96ea1264a308e92d3cbbb829986cb4ad2b082f94c59dc4a515ff5e4cc2c33ffb8d7a42af85b0b1e4dd6d08938ea24b5f933ef463532d7330c5d0d92353f6f84e59fe5cb713e104784599874fa6a19fe3ea0cece081a28156e4ad6b4ec11e381eb7402c1bf769f28c0b9f2afc532295c146da78e4885ad5a00e374e12b0a18bdeabd2be0c02088dd895947cfa08d7212d437c00c1a3f801ac2fe456b2941504cf4e6551191559b4e543dd3fb3704f97e2c64560fccddbd80b737edb3c99bec5c2d9819cf8830b2aebb8d941a2fb0e6c8976caecc14c78bcc0a37925be8240ece8d72bfa4dc3382e239c0e093b4709f33b4f508860800ca954bdeeecf87cd92378771139f3db97d69e41d07c28eabf654b21627f02def80161920a63885677b242315eda79c5d5eb4fc3dd9722912d8270546eb6f15014f7e80b563f5f679c8a9a6872eb6ccf0b8d1e811d05082d036b80ab23c6cec5bc6b72459ad878eb92325562ad7d5660afce9e82c7b1c0fa7f021e0c6605b97e972930e850e8b7a68c727f678cde8821220ef946d24b3ae63c7b020c9bc41f54e21501d91a13cd48fe9d343798539a152c11b05ef029d061a9711b386867f99bd011bebac0f38c0a4c7d5e1a312cd7ce1dfb90717e8f73d07996528c9ff34eb215c187827806f0845b03218707a6eb3c6ec22590431815b68b3f43aca21995384bcc6257fc9045e9f98c3e87405669bb7ef97b4372ed32e3f4ceb309485cdfb01b71d358926405be1c28ccf13bdba43472512fe8271a45cdb04458446c2f3ae601fd5a5176a91acaf9588d6e94f33e26f02b40fff6c4c955e10c74a47e31dd4379deba23d72d21cbe6b20fa068a21c49368362195df9689207cf8d45ead874ce26ee371e68be9337803adbbe062451798d446610638aafcd901fd55c32e70acdb7eddc289c0c0247ef7bbe88838d9f807e7dc813ef48374d660beddb82181ae024fa3bc3aefaeac54fa567746c197b74d6a93194b3bcd1daa0ff4d3f67018e9f720efc82127118dd116397714cf0d724b13711e3278d49a9b09661e0e25153fe86667b88d89b86c69e22df38d83aed48fe4867a0dafd2eb979e73d3f67f1971c54b11e02d6cf15f37e64a1ade631dd91887c40ac230310e77cc005c7518da3593cfc089d97433531e33d6c440b1cdc4c2c46f23568496a5486f80503a99318a4a1d6ae6285d9e00c0350a05edb668ca625f4980959e3cc60f4ea027d8a2d8d7725f0244b834b3fc51cfde506e562aafc24bd1a2e0be5b1539a197dae16208307bb388563790e6616da5b5a7efd5358de66828d0eb0aa2776d05d6ddd62f4957df1e8ebb67e7ef44567862a67159c7af5dba9550742e4616422d81ec8832517f507438edbdb9f0a57cd6236b85031924da160ec4383d35f7b107590ccc491b8752b7c7cc93f706bd3d1162705411676a057ef0a5668127447e29a0d95e64e838e2028ef103b68f45f821bee6a916cce4cf3667e98349362e05ff04c6c3b2b21b5fda822ea10e77583a20e55ce4aa8ddaecc9e7192fcb43062da5d831381d58b35a1d451acb70d5087a8156b7c276160cec3f5e4fd2649b3752c174e7f821397a3287f909ca5ff1fda520db3e555e8598f1367d799ef916092914793a8094e67ced3cd636621b098c14d17c9bd08ef9839bb87af6c49f27128b9637709c8162303b4aa7f85435af02489ccf28e3e51e2c909e00508ef12ed76044b9ed8a87331046c459852124f0cfffd286dd061209933e178b7cd63a2e2b2cc88bcd34e35378a29fa5874dc3903100314c85c017d421e5c1842d51bc56dcd340da68dcf06ddf0564104c640bc954bc19cdbabd2a0dabd8a700936031062c38503416e4224059663196352834735fb61e3434321fcffbf4c439224ac9b23802871ad2822a032929bba34a9d804b643594902a1f99fde190b7f094120d3db7d99c9cfd06e4a0e450d1dd72a1a175fae2718b08717968efb0650c0f7ac60826804fcaa0fe6a28dbd797d44d269b0758593e8943f1129de67cba41fc2affcaaa5108487979fe475a88b8a5d81e727be066c8fe517a0de07f10ac294b5a9890d45b8382eeea7e3aa2f5085aed6e1cd77d878e5465fcd8bfead4712590482f5e46aaefe5635a3a4bc5b8fe7b90b8c2bbd5571d77fa6c0249099bb32b2afcc4301663b955a9695d8e20a3effd64f99e114ea843b21b7c2d2a6950a4c93344e533ad8ef5705e515ec0358d2e00f8e921f137c03d88bbf64713c00a42483bdda38e52e91b67da847f99108341ebc3f6d889f577f83fabf97fe1486e5297e65587127afc0607e5442b323fbc12529b6dbde9db4f562b03136903f70d23a90ea604c07e108ddb54406fe5923ab2e70fc120e1de8ba17a4fbf323fe0ebc784dc4e8ed11c597d9c01d36f1181d36f4bf6d2c302cdad81ad9a18021e7e9ae3e7aa08c50ed80610db0aafa1c20dba29fa19615bc05558f9058b2e2fc6a9bb15a0adba5a9204bceb5a13b25160cd09419d46d35877abd1769d5ad3666be7bff0942aa5e181da9c6a9b05200ffa985166ae42b8eeb66d81ab0eb9a12a8b2b565a88c0c619ff3dedf934778a755c81b5acfe778c6d624159cf119a0ae704d2684b182a030ea1e8ded7e132f90786ac41a44b0a09fa6aa1955065aa16c1260be8438c87e8cc41f66ca01bb817935e6301365ab3611c8751bb7b0ba67448dfae23bfbb859d93048067fe2f6b114d4f463307351e1b7ed2bcd7386557483c1a1b506444f7e058ea690974d97f413ac8df0cda03cfde61a0719cf56e65399a71ae60a0b6ebf556caac74fa8719e75b464454a2cf8be8dd0441cfa76fc988174ca115a2ca094e6f56c196db94387adbbc85d5237b0eacf34f81ad9b163c0101720ceaf421f810a94a34892470200e334ed4192e8ca78dd10886e0d8a8094fd08330b954d2d0ed33f7fae40701ae443d1de56d47002de54cd1d4619e9c93786f6c8a9a3fd7e7e942df23136bced6bcc8a59675fa98cc407d3dd9b54af088844ed029501011ea262c7d2d7dc05d1827209f2ccc935475d4432f3c1b2fd4db7d5c13cefaf0c17867e92dfcd750fc8e022187cddd1d1b6328a6d78964cffb89f0d547957b07c56eb94535072296a72ee7ce472ffcd23ba98c56632baeee921926bda19aa1ca8f42179339463d7bac8a25c0340bda8f30ad99e0648e9994c7e8d528ed7e09c4ea6ff9fec1188527f7f97b44182fff727c9529aac395c6ce224317bf5e1ca97ed8cd69af8481db8a36f558073dff62efa35e6a65ad5b3dd243d0aa9c04e298b7d162284926dcc242dfed6e3f47e1f8ffbd022099cf3d7a37633820e9522894968aa125a85ccd4ad7ca11d496567bfdf240f003488d53b77129a1dabdfde46dbdd818a7b5c80fcbeea3c54461e0e9114ed79463431c376f8f1365375125bb06d35b0bb4aeb0dba82c0ed2270f48400f93140a19166a7537df482cb17d5729c7c4b8bf23d0ef51c47f08d8807ab3badada3a5f96704c7b2d37460512e2051166a14646864d817055f985084fc5ea13f03ea094d34e808dd5a824bb872ea9c106476abdc50a31287c5ff1ca7a3c242cccbb2fa404ab5a3ca4e562a16e48ca2cf30be5503d36a19fb914564f053729c11acbe642a53ec552164ddcbb096f37f15967c5eaf8f78fcd2b06c46bb45466ec7bbfe82dbd7332a1aa24612756363afa34ed5a107103eb077b47dfb7d1fb5ece2a88e7c750fb2e472bb6e4a5074b4c7da4200492ceb57529f21b9003829790cd1047655dd2be32c9ce0d7965f43d50c8f55b20f6cea557c8afdf373aa095d103fb2d9e9a3a187f3d23d7b2f76d217e17e5370013ec45c4c2ac01a52e7acdfbbf5da2bd9eba1edef98bfc48bebdc95c031b49f2a461a4b7ac4639d738384948bdfcd176b9ab8b334117e6f03bc3d8f3dedfca0d255466fb1992e035e2a8fe51cc06253ba8a64ec72640067ed821c111b2c43794e85ee595da499172d776b79259d90595971b674e015950dab571ef3698781c96ebccf88844d2372dabec6e0097d1eefc4af544a5e16aea3a6af546944bd8116517d9853f17c36b00e317f31e6a5e46b43e32e669122aa4a736e000651b6c6d34bd992cb4c5ff1c06cb8902d937caebf60f3a099369f20c7a64d6b1674c7c88ffc58752c12a9022ea5a5567a36546179e598d81aeadb75c82a7c8d23ead77b51e15c49306842cb484a7f6668b1332de041ce99e76a3d57b877b8e20df642538dde2b2d3da8384e2d48f7668a7069aa9dc8412bce54465cdee639fd90d9ceafe7ef9882fa708848bce55934665e4ecdf69c1e9ddb22bc2e1910dda3fb65cf95f3329bce1f45a4cd4e2d829ba160765627b5a85bcf5f18f7478fda4c7c1cb4dee99dcdc72c0d2466cf4f391bca56467867890e26579db92a1a640eb43f2eff03204f2de26cdc6bc933fd64bd9f90c50e44098897aa56675bae7e5e9529317b2abbc51a231e07c648ee83b4585ef7f0f48f3365523ff9e17e4bab77209b41ae5b9faf1d0b5cf6b25ee81438b35fb271a664ef1e941ea2e4e814fff82da20a5b4c5da34fd0e126ef67d0be6b56e310e395176cf2e32813e98ed7e2267532537a1297ae1c55de916c8b58ca6b6f23af4b34d60596c3b2ee2a1a6daf182d611ea991f38dfbbd09ce40bf91d5ed723e6ec7ecf215ff4f649ce9626f2920b868ae6da6d1914ad086b535a3ada79f4d4aa5dbed242c76177ff8c713120e4386439a22de0b0dc14813a5f7b16191bfea11956e9a7a5be71bf4fb21ef4fd68114cb7348dba7cb93bf26f06acb4d64629782e60b415d576f267c131b27d095d7108772aac0db50d78a6665f81717644be14ae45adcb7e2063eab8a14c2bd8bcdee85c98b1ae183305b5bb8bec1bed0e04bb55fc9c0731c034c4f6e15e4e340f63663cead3249d64c7768a181e3a0996384dd6743f164147baf184074a2fa426a60bf44037592d3d7ee510d4b677a4509e4f58dc9745b42d68bfbafd636c3aae72f8ac3a4527b369c64eb58d371fa459ce6861acb9432776c20207d0e96115ea2a74b286c31249416363d0f8d4d969f21f2482f633aa5f7214978a8e68df0860614296e8037dd3b23a45d0221670db1673c2ef8b7a820963f4cf0a01b0b3ec850d0705b0d592bebccb162ee4eb924ad40d38824cee9595effcb9c2d415b0084e68800a39342f98d2da00b6889564722027d5b448efb07457ac0f6261f02b278be798872e3d5daa3e0a4c2c4cf5aeec6ae0bfa3179e69a52a5e0e6daefa9acd40566a8baec35e6b05ada4138c1db9bc6cd1d397ebebd65400d7d5f6221ed08a94ad49527bcd1e2d050c84fc332601f49b1c0f2b83ddf33723502291d73ea7ecd531a09385832cab4e132a893b9fc59909d95b1ba18e0d8731d5ea65cf0cbb400165c23bc5b166e6e6701c5770caeabbd8161c387ef3a5416dc59a2987cce5e73a33d22cb325f5224dcb21fc3c4bc0dfdebed84e935276e4b462bbd996a82bcef4faa05669601464ebe5dba9d43054ded297625e740a06f1e6d5127d2bebbbe371a8aa4afdfc3bcf5d5e02dc53207d9c45087aa498c510287fa9b5c40ca26309776fadbc288f65db8889e9027dc5dd7b4d024c0f13c8918cec8817fd3f5dd55641bc275836106acd7140874597a8e2dfe7cb2a9adf9c87981db3d21abfaaef6c8af8e76470a4c1d75446d1ef0c211a3dc7432da2051a58da922d0982e891fa746f7939a976544591b0d46f9fd67c3d6b9124073b77bf07281072868a62e07f5df1807a452ca932fd751bde89288852556317ecb92b9c1bfaed18dd2da55754f9acc24c6caa43aca2b95a7fb244ef98543b9d6e7443953e069dc3f6d335d819bcab389aa7843071ccb266aa60bcbf4facb8767d5badf7445ee54a7ed7d6c6188b847a2482de9b95c34038fd5ef87f8f7000680b257f42f47a7cdc3687344d94cac0c19d440b3cbf1cf7d347dc45806eae86e231e7187959935cedda65fbb303b6ecb73ba7cb5ee501689452a5353566823c5f6f862a20e824265205e9fcb45d56d91d7fd7f910b35ab24a2e42dd4b2a8da5f55fe48c9c06a992d38e2b23d4c896c190cb3388c96fc5d300a646a4729c78465515030449f6ec8e784b226494b45ae6bd413214e8b1b021d59b03b7d17cc0fe92331fe809ee044074f1194b98147ec97c7df386396c09166b8471042e439fed79fd0139ed35abf14eb046a50f2faeda0df605b9b167ade2e642f3b5031b39c22fc1d8c83e6421bedb1e2a113a5319831a1e145181b8662d3af909edd87dfd30d5471807e614394858bd0f03b0bcbcd9f7e2aaec82bbd095cb1a9a3f7c7df48b00ba4cd4017bd83ca764bc123fef7ba4efc5261ea8cdf931c6a270bad6e20d61bb4ebbd5bfff8cf593ad0d32b1795fab594407cb4164350737377b6919cc05627d8f8e8f47fdf626c22c838101eabe58b7d1898d0958bf30eba431414b3803fd9cdc087f3d15883c9d8b99852f60789ec7d8519a46fba916ae4ab557bed59665857e67ef730f307a42e819533f450b8342a1dcf443b59d28f44500bd1ca6580fac99020d66ebc750b97ce1d9673027b5956888033b9a2d83312611f476774ccfe2de93f65c8fdcb9c1f41ddc2083aa93580997af4d4e1084424db86e3350f17d0f233af5b695a47a8f9cf641b031a5e7f9be7bd7afcb687e39e8df0878959d3c73e7915361e1b82fe9b89566c3cd3a99b05fea3ffee3fde6bc43db14c6732ef97c518dbbc3e6592867fc84a1368d5c330349392259b178c3389573334dcdf6aef8e6be0c58cb4fa63ec46d5f85c44aaecb1c46ece35f208972391a72ec0e0a63a21ceff4a62b48a36d93ffcee9af6c8de8949f3faab64ea1dabdbfa533e9142293b37f11f89a6723d9ea96cd061ce1d69eb8da6224d59a5d54bb552f8e628d733f594c2ca25b3e08dd6e800153440c39b99e6b0ad9e3d53a45e37234aa4f14abde6e1ee1cf11406a03c14ff302ba0c17fda264e8630837b8bb1d244eac3a05750dd335ab1a3a425dd3e8cbf674b1a3e8ef72131973bac4c0c87c78cdb00ae14b402a335268336b7a16693769ea2f2ac48cca1360df13cfa6da44772d8c3fa28947b528dc977a19c13d1923b69fe52170c8d68aa25c5ce6403473c6f6f91cfe2b643d362734de05a56a0a88cde4824891a7850ff1044b2d4ea7e54d9dfd30764795099f0aaf04e0cb1ad6385404158719b435d19965c1ab9bc1c8b0e8e3a49db22b9cee6341301de90998616bf67121ba262300d0d9dfb71b70895db3681442589b399b1fa0e436a1cec672ade7ca8e99547dc8f7e3c700769545eaf0d8644138e2ccd8f44238396dbde5ce1b7bdf9ac7ffd07e8b9c4f7519d00db87e9840a521ea7022b973220beb698a9cbf74536863d408e543bc264a4f57d60d2d6469acaed02304fbd997e15f5a38c2e1c331f40db2c355aa6d757c33ea1b127cab660390cf01181f6ee2b9a9799efbb12e1b3344aea4daf8425e463730f7d386c15eabe40052bd09b90bcf1d877e74e467b2cbb5238c24e5c6c72d4de9e8bb5148e6b3c4f128c1ddef9e849d7d2495b6f93874c1edfa7752980dbed1c3558e60adf4f605ba3c887f710d39580080c53b0166d0b49a48bd41182be48be4d4b8edfd137a5a3c1ca115b7027ab2545aec9a732a1ca23791b3fd49fea10a97e23582bc0b2b94c36ec59e3d9608ab7264e6897fa3e98e90e6955201385e37f8061f7a17b60ab8004c05a864615ae66376699fdf30ddacba2571522749b6d1f2fd8755e752c743f9b97592d679ac4c5d152c35b5515e55ec85378395fc16ee2791a2314a28e9573288ca66ed83e267c532d5d401ec45e969a0c1020909e36d9a51e8945657e8aa17eba7324413ab65929e56041644d3544581a184088aa0d3d1f86f86a6104d7f4b98d26838accf7da04c8a499f73df9b6c32d7eb1e8b3e29b2c974668bc119f026364cc9b407b1311b9eca905efc7d882760b2aca4f2db947a4efedcce96406db4d736480ccc2086193e86864eaf493445e266cd2ddc6448e435d32e9d79f49bee27763b5ee7d0a2c3245bca2e8b9b531e371095309d971b60e6478e1993e7b8d9a6a28d4bbe3e790719526a64877120d84c3acd108fd0e99d3a15fe428690c4eef6ede95dc38652dbf27f66f45f259a4a5077093c1eba89526f27c0130e56fab7b560f1ee572c37b0db9c81b0efb231088d32d30870cef7bdebe877541b4b3c6f79849499a39604c40f37bafd9e6d65800675372a8d1fa2456898ae43fcf88afb54d80d7ba576238f355be00f7193157d72f51665a3d4616ee3fb9a6221add1f7c9695618e1af97f866b455dd3fed24ec7cd936020b957f275483b81b5809ee38fc49f18d01a43dee3591ce54b75b9ebf3befbadb9ef3dfbaa3398f681b85fa6323a5b4edafcf0867d2d22d682bf4af8e841293f77479b5cd85b360d96073e0a81e75c706e0b01bec57f160a5208854b58c54317463d1e6d3812ac13f672361072feab74852de99bce92a1efc6e8f938e849657ea8e1e4901b88294d7bdeeb0e3a14a454f27ffd750fb238319efb9b34bc4da8563fbf606417bc610c9ec8ca28e52ed144254af5c365822444b367c4d35b34d7e9ab45934b91d5081969d91005f84acaf2ef9eaf6de5bdba967855b3fb86ffea472d14fe9295245d5eda92ae5d932a69ed9c70d29ec8463a62fd9c49689f90bcbf3dc4d17d6636c8941491167bef6ece723bcfef5fac0555de011fd7312641e2bc65d24c61124b550b410599fc8c8c8ab0b6a8679156c22be12085059e5c783176849284be51babab283f6f25876f78d9f00a07d03881abac2ab2721980def067832342985fc67c1ce7af0dd5ba98ede8b324c258d0021cfe0e761392308cafd70f42d078d406a2ff533c5e6ed0b516b4b0004c85920ed9e9b64217004cd232c281ddb01a8408b0711d332bbcd93f21fb12b8035896df4e77fef57e46f6e1eea5690450a55e9ec9ca6b11214727b205f90e78711e648cc9564dc5135228160634eea1dc868b61b3d17383af5f2d6e6aa40b0c4ad4929ad3a9890cdf0edd22d12b84224a16dfe38d30c5ed327347e59bda8c635aa8743613c88964300ff26532db02f64f4d95cb74520a74dfc7fd46e4252537c071f5ec12be74f3f66e2db871a18d008f074f45f98eeb4972d7832c00dd80bfafc555ff4f5e18db5cd3d510fb430b9142d56cdbedef11daa4fde3aa755de97f440255337194f443fc2c1c405a3fbbf9ad57fa54e387ec5a98376052912993e32f61b673ed52431681d0c1cff657ee01b49377489e619229dad84aca5d4a6364e014614c3b4302166fbe025bf15a5a341dc68adf9e1fa077e5df255fc26a8f08beebf5f3d030647e9d3f5b2838ccb874f85163dbccb46cbf152625f22c23297caaa81d520dda068d8982de16e8ba970f337243b3ab9501b0e799a1b328898ecbd4c624478a3d1b0549445222b67483024df8ba0b8ca3ee4ba15a4fc08ef2da9289f2cc60f1594354458c89190258c1f8ac8a99608bf3117a3a2219abb17612d574ddef9149a300e90b87dacf707bdae2fe0a821620edc351faaf3851ba94260bbf9e5d031b8c9f86a228bf0c2d0ce223ad686c3f8524e122231ab0b3530f341b1a149846d3a6d55493ac4d5cf78ef5f321e0666b92d4f9d90b4e28b91506c3490fbad00993f37e635eaa6034bda111d11975cf855d866e057205e0341c8f7a28721a07610d19689a5a52b42ab33bfeebb97b8c1dff985b1320305abb3b20ccb7dafe02210a05df0a32c71f33e1e3ce295b3e2936a7967356eec218f26f406dabb438d622d50038b55f6f456fc4df168c43a48296b38e32bd927c58f020de8661095cb6f25de0dd2710bd0123edbf7305444bfb28e2ee47247bcdc728c5d58d7c89e3656e67b1614382f5a330beee48a39e2604bc5c96a5a523295645c7ceaed4ed1453af05caa8ca301d771988819c75f2cde4101cef3ab119a51fa0fd5d84ebe03e8680cadde02f9f9efbdde68ea52dc29f9cc7137de8d1a3fff95e67de06f419600baacb94c0ae2d5fe00db376d9074be33f2cacc04633d831cb62c83f3fb5786f525eebd0b587ec6fb6ec20773d17534406f126361e733e3b0294054e8cf60e20c859574d30c7f4ebf620842bf3b75783c0844ccc92f24d388331ed429566bbe2fb3e0ac955230023c99d9a24642198879a286ab7c29b8e6f1e61bceeb43b3a88fd732ea01021e201dff885c53cfdef3bfe2e5b40c2dbd3a479158e3dd427f3ce58600a88d49042d0cef2dd1d10d3e6eb4af3c9b0934c2642049653f3aa56a0abbc8b1a3dc0b6a66288df85af412920a945a983e17ffb83258839e72401ceec32f1a8e567171d1d784cc9030c42a632d69e6ab1b6e11b4d415b54f65f2d83fee3b204b6e6a7fbb55502be405655571fb121f16481ee314e3e615d36b458799fb7c2305d35a7f84f86fa56ff6ae82b4abbe325dbd3ac636565d4b81025bfb5ef66e782bcf4bf0168da77fec21824730e24744f23584a1ad64065a4029645f43410726613da4aadf488aa1a5ac2dfd6f4a4f5e5fa368872b1e26994df05787f90988f47b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-shrink">      <input class="hbe hbe-input-field hbe-input-field-shrink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-shrink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-shrink">åŠ å¯†æ–‡ç« , å¯†ç æ˜¯åšä¸»åå­—é¦–å­—æ¯+ç”Ÿæ—¥(3ä½å°å†™å­—æ¯+8ä½æ•°å­—)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DolphinScheduleré…ç½®SeatunnelåŒæ­¥ä»»åŠ¡å‡ºé”™(ä»MySQLåŒæ­¥æ•°æ®åˆ°Doris)</title>
      <link href="/2025/02/16/Dolphinscheduler%E9%85%8D%E7%BD%AEseatunnel%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%87%BA%E9%94%99/"/>
      <url>/2025/02/16/Dolphinscheduler%E9%85%8D%E7%BD%AEseatunnel%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%87%BA%E9%94%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="DolphinScheduleré…ç½®SeatunnelåŒæ­¥ä»»åŠ¡å‡ºé”™-ä»MySQLåŒæ­¥æ•°æ®åˆ°Doris">DolphinScheduleré…ç½®SeatunnelåŒæ­¥ä»»åŠ¡å‡ºé”™(ä»MySQLåŒæ­¥æ•°æ®åˆ°Doris)</h2><p>DolphinSSchedulerç‰ˆæœ¬3.2.0, Seatunnelç‰ˆæœ¬2.3.4</p><h4 id="é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—</h4><p>å®šä¹‰å¥½å·¥ä½œæµå, ä¸Šçº¿è¿è¡ŒæŠ¥é”™, å…³é”®æ—¥å¿—å…¥ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[INFO] 2025-02-16 13:02:00.427 -0800 - tenantCode :root, task dir:/tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3</span><br><span class="line">[INFO] 2025-02-16 13:02:00.429 -0800 - generate script file:/tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3/seatunnel_2_3.conf</span><br><span class="line">[INFO] 2025-02-16 13:02:00.433 -0800 - SeaTunnel task command: $&#123;SEATUNNEL_HOME&#125;/bin/seatunnel.sh --config /tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3/seatunnel_2_3.conf --deploy-mode local</span><br><span class="line">[INFO] 2025-02-16 13:02:00.436 -0800 - Final Shell file is : </span><br><span class="line">#!/bin/bash</span><br><span class="line">BASEDIR=$(cd `dirname $0`; pwd)</span><br><span class="line">cd $BASEDIR</span><br><span class="line">$&#123;SEATUNNEL_HOME&#125;/bin/seatunnel.sh --config /tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3/seatunnel_2_3.conf --deploy-mode local</span><br><span class="line">[INFO] 2025-02-16 13:02:00.439 -0800 - Executing shell command : sudo -u root -i /tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3/2_3.sh</span><br><span class="line">[INFO] 2025-02-16 13:02:00.483 -0800 - process start, process id is: 37662</span><br><span class="line">[INFO] 2025-02-16 13:02:02.484 -0800 -  -&gt; </span><br><span class="line">/tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3/2_3.sh: line 4: /bin/seatunnel.sh: No such file or directory</span><br><span class="line">[INFO] 2025-02-16 13:02:02.491 -0800 - process has exited. execute path:/tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3, processId:37662 ,exitStatusCode:127 ,processWaitForStatus:true ,processExitValue:127</span><br><span class="line">[INFO] 2025-02-16 13:02:02.493 -0800 - ***********************************************************************************************</span><br><span class="line">[INFO] 2025-02-16 13:02:02.505 -0800 - *********************************  Finalize task instance  ************************************</span><br><span class="line">[INFO] 2025-02-16 13:02:02.506 -0800 - ***********************************************************************************************</span><br><span class="line">[INFO] 2025-02-16 13:02:02.509 -0800 - Upload output files: [] successfully</span><br><span class="line">[INFO] 2025-02-16 13:02:02.512 -0800 - Send task execute status: FAILURE to master : 192.168.10.132:1234</span><br><span class="line">[INFO] 2025-02-16 13:02:02.514 -0800 - Remove the current task execute context from worker cache</span><br><span class="line">[INFO] 2025-02-16 13:02:02.515 -0800 - The current execute mode isn&#x27;t develop mode, will clear the task execute file: /tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3</span><br><span class="line">[INFO] 2025-02-16 13:02:02.519 -0800 - Success clear the task execute file: /tmp/dolphinscheduler/exec/process/root/16670700117984/16677825236448_2/2/3</span><br><span class="line">[INFO] 2025-02-16 13:02:02.520 -0800 - FINALIZE_SESSION</span><br></pre></td></tr></table></figure><h4 id="è§£å†³å°è¯•">è§£å†³å°è¯•</h4><p>å…ˆæ£€æŸ¥DolphinSchedulerçš„Seatunnelç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $SEATUNNEL_HOME</span><br></pre></td></tr></table></figure><p>å‘ç°è¾“å‡ºä¸ºç©º, ä½†æˆ‘å·²ç»åœ¨dolphinscheduler_env.shé…ç½®äº†export SEATUNNEL_HOME=${SEATUNNEL_HOME:-/opt/software/seatunnel-2.3.4}, äºæ˜¯å†³å®šé‡å¯DolphinScheduler, é‡å¯åå†æ¬¡å°è¯•, ç¯å¢ƒä¾æ—§æœªç”Ÿæ•ˆ, è¿›å…¥dolphinscheduler_env.shæ‰€åœ¨ç›®å½•, æ‰‹åŠ¨åŠ è½½æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source dolphinscheduler_env.sh</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨åŠ è½½åè¿è¡Œ<code>echo $SEATUNNEL_HOME</code>, æˆåŠŸæ˜¾ç¤º/opt/software/seatunnel-2.3.4, å†æ¬¡é‡å¯DolphinScheduler, è¿è¡Œä¾æ—§æŠ¥é”™</p><p>æ„è¯†åˆ°åº”è¯¥æ˜¯æˆ‘ä¿®æ”¹è¿‡çš„dolphinscheduler_env.shæ–‡ä»¶æ²¡æœ‰ç”Ÿæ•ˆ, åº”è¯¥é‡æ–°æ‰§è¡Œinstall.shè„šæœ¬, é‡æ–°å®‰è£…DolphinScheduler, ç”±äº3.2.0æ˜¯æ–°çš„ç¬¬ä¸€ä¸ªå¤§ç‰ˆæœ¬, äºæ˜¯å†³å®šå›é€€åˆ°3.1.9</p><h4 id="é‡è£…Dolphinscheduler">é‡è£…Dolphinscheduler</h4><p>åœæ­¢dsæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./stop-all.sh</span><br></pre></td></tr></table></figure><p>åˆ é™¤dolphinschedulerç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /opt/software/dolphinscheduler-3.2.0</span><br></pre></td></tr></table></figure><p>åˆ é™¤dså…ƒæ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE dolphinscheduler;</span><br></pre></td></tr></table></figure><p>é…ç½®dolphinscheduler_env.sh, æ ¹æ®è‡ªå·±çš„å®‰è£…ç›®å½•å’ŒæœåŠ¡å™¨ipå’Œè´¦æˆ·å¯†ç é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/dolphinscheduler-3.1.9/bin/env</span><br><span class="line">vim dolphinscheduler_env.sh</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=$&#123;JAVA_HOME:-/opt/software/openjdk8&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Database related configuration, <span class="built_in">set</span> database <span class="built_in">type</span>, username and password</span></span><br><span class="line">export DATABASE=$&#123;DATABASE:-mysql&#125;</span><br><span class="line">export SPRING_PROFILES_ACTIVE=$&#123;DATABASE&#125;</span><br><span class="line">export SPRING_DATASOURCE_URL=jdbc:mysql://ip:3306/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span><br><span class="line">export SPRING_DATASOURCE_USERNAME=root</span><br><span class="line">export SPRING_DATASOURCE_PASSWORD=</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DolphinScheduler server related configuration</span></span><br><span class="line">export SPRING_CACHE_TYPE=$&#123;SPRING_CACHE_TYPE:-none&#125;</span><br><span class="line">export SPRING_JACKSON_TIME_ZONE=$&#123;SPRING_JACKSON_TIME_ZONE:-UTC&#125;</span><br><span class="line">export MASTER_FETCH_COMMAND_NUM=$&#123;MASTER_FETCH_COMMAND_NUM:-10&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Registry center configuration, determines the <span class="built_in">type</span> and <span class="built_in">link</span> of the registry center</span></span><br><span class="line">export REGISTRY_TYPE=$&#123;REGISTRY_TYPE:-zookeeper&#125;</span><br><span class="line">export REGISTRY_ZOOKEEPER_CONNECT_STRING=$&#123;REGISTRY_ZOOKEEPER_CONNECT_STRING:-ip:2181&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Tasks related configurations, need to change the configuration <span class="keyword">if</span> you use the related tasks.</span></span><br><span class="line">export SEATUNNEL_HOME=$&#123;SEATUNNEL_HOME:-/opt/software/seatunnel-2.3.4&#125;</span><br><span class="line"></span><br><span class="line">export PATH=$JAVA_HOME/bin:$SEATUNNEL_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><p>é…ç½®install_env.sh, æ ¹æ®è‡ªå·±é›†ç¾¤èµ„æºé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/dolphinscheduler-3.1.9/bin/env</span><br><span class="line">vim install_env.sh</span><br><span class="line"></span><br><span class="line">ips=$&#123;ips:-&quot;&quot;&#125; </span><br><span class="line">sshPort=$&#123;sshPort:-&quot;22&quot;&#125; </span><br><span class="line">masters=$&#123;masters:-&quot;&quot;&#125; </span><br><span class="line">workers=$&#123;workers:-&quot;&quot;&#125; </span><br><span class="line">alertServer=$&#123;alertServer:-&quot;&quot;&#125; </span><br><span class="line">apiServers=$&#123;apiServers:-&quot;&quot;&#125; </span><br><span class="line">installPath=$&#123;installPath:-&quot;/opt/software/dolphinscheduler-3.1.9/ds&quot;&#125; </span><br><span class="line">deployUser=$&#123;deployUser:-&quot;root&quot;&#125; </span><br><span class="line">zkRoot=$&#123;zkRoot:-&quot;/dolphinscheduler&quot;&#125;</span><br></pre></td></tr></table></figure><p>è¿æ¥mysql, åˆ›å»ºå…ƒæ•°æ®åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE dolphinscheduler <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> </span><br><span class="line">utf8_general_ci; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> dolphinscheduler.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>; </span><br><span class="line"> </span><br><span class="line">FLUSH PRIVILEGES; </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <a href="http://upgrade-schema.sh">upgrade-schema.sh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/dolphinscheduler-3.1.9 </span><br><span class="line"> </span><br><span class="line">chmod 777 tools/bin/upgrade-schema.sh </span><br><span class="line"> </span><br><span class="line">bash tools/bin/upgrade-schema.sh</span><br></pre></td></tr></table></figure><p>åˆ›å»ºdolphinscheduler å®‰è£…ç›®å½•, è¿™æ˜¯ç”±äºæˆ‘åœ¨install_env.shä¸­çš„é…ç½®, è¦æ ¹æ®è‡ªå·±çš„æƒ…å†µæ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/dolphinscheduler-3.1.9/</span><br><span class="line">mkdir ds</span><br></pre></td></tr></table></figure><p><a href="http://xn--install-yx7nn24y.sh">æ‰§è¡Œinstall.sh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/software/dolphinscheduler-3.1.9/bin/</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é»˜è®¤è´¦å¯†admin/dolphinscheduler123ç™»é™†<br><img src="https://s3.bitiful.net/pb01/295.webp" alt="avatar"></p><p>æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $SEATUNNEL_HOME</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿›è¡ŒåŒæ­¥ä»»åŠ¡, æˆåŠŸ.</p>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DolphinScheduler </tag>
            
            <tag> Seatunnel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…SuperstæŠ¥é”™ Failed building wheel for python-geohash&amp;Command errored out with exit status 1</title>
      <link href="/2025/02/13/superset%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%99/"/>
      <url>/2025/02/13/superset%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="å®‰è£…SuperstæŠ¥é”™-Failed-building-wheel-for-python-geohash-Command-errored-out-with-exit-status-1">å®‰è£…SuperstæŠ¥é”™ Failed building wheel for python-geohash&amp;Command errored out with exit status 1</h3><p>å…·ä½“æŠ¥é”™å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://s3.bitiful.net/pb01/293.webp" alt="avatar"><br><img src="https://s3.bitiful.net/pb01/294.webp" alt="avatar"></p><h4 id="å‰ç½®æ“ä½œ">å‰ç½®æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">conda --version</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">conda 23.5.2</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">conda create -n superset python=3.6</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¿€æ´»</span></span><br><span class="line">conda activate superset</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®‰è£…ä¾èµ–</span></span><br><span class="line">pip install sqlalchemy==1.3.24 </span><br><span class="line">pip install dataclasses==0.8 </span><br><span class="line">pip install --upgrade cryptography==3.2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®‰è£…Superset</span></span><br><span class="line">pip install apache-superset</span><br></pre></td></tr></table></figure><h4 id="åˆ†æä¸è§£å†³åŠæ³•">åˆ†æä¸è§£å†³åŠæ³•</h4><p>çœ‹åˆ°æŠ¥é”™åˆ¤æ–­å‡ºç¼–è¯‘ç¯å¢ƒå‡ºäº†é—®é¢˜, ç„¶åæƒ³åˆ°ä½¿ç”¨anacondaä½œä¸ºç¯å¢ƒå®‰è£…åº”è¯¥ä¸ä¼šå‡ºç°é”™è¯¯æ‰å¯¹, å‡ºäºè°¨æ…å…ˆæ£€æŸ¥gcc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -q gcc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gcc-8.5.0-3.el8.x86_64</span></span><br></pre></td></tr></table></figure><p>gccå­˜åœ¨, åº”è¯¥ä¸æ˜¯å®ƒçš„é—®é¢˜, ç»è¿‡æœç´¢å‘ç°å¯èƒ½æ˜¯ç¼ºå°‘æŸäº›å¼€å‘å·¥å…·, äºæ˜¯ç›´æ¥é€‰æ‹©å®‰è£…å…¨éƒ¨å¼€å‘å·¥å…·(ä¸å‡†å¤‡ä¸€ä¸ªä¸ªæ‰¾äº†, ç£ç›˜ç©ºé—´å……è£•ğŸ˜¸)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall -y &quot;Development Tools&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ‰§è¡Œ<code>pip install apache-superset</code>, æˆåŠŸ.</p>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Superset </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bigtable Paper Reading</title>
      <link href="/2024/10/31/Bigtable/"/>
      <url>/2024/10/31/Bigtable/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Bigtable-Paper-Reading">Bigtable Paper Reading</h2><p><strong>èµ„æ–™æ¨è</strong>: <a href="https://www.youtube.com/watch?v=r1bh90_8dsg" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">æ·±å…¥æµ…å‡ºBigTable</a>, Bç«™ä¼¼ä¹ä¹Ÿæœ‰æ¬è¿, çœ‹ä¸äº†YouTubeçš„å°ä¼™ä¼´å¯ä»¥æœä¸€ä¸‹.</p><p>Bigtableçš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è¾¾åˆ°å¹¿æ³›çš„åº”ç”¨æ€§, å¯æ‰©å±•, é«˜æ€§èƒ½å’Œé«˜å¯ç”¨, æˆ‘å°†ä»è¿™å‡ ä¸ªç›®æ ‡æ¥è°ˆè°ˆæˆ‘å¯¹è¿™ç¯‡è®ºæ–‡çš„ç†è§£.</p><h3 id="å¯æ‰©å±•">å¯æ‰©å±•</h3><p>Bigtableæ˜¯ä¸€ä¸ªç¨€ç–çš„ã€åˆ†å¸ƒå¼çš„ã€æŒä¹…çš„å¤šç»´æœ‰åºmapï¼Œè¯¥mapæ˜¯åŸºäºè¡Œé”®(row key), åˆ—é”®(column key), æ—¶é—´æˆ³(timestamp)ä¸‰è€…å»ºç«‹ç´¢å¼•çš„, mapä¸­çš„æ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªæœªè§£é‡Šçš„å­—èŠ‚æ•°ç»„. æ¯ä¸€æ¡æ•°æ®æœ‰ä¸€ä¸ªè¡Œé”®, é€šè¿‡è¡Œé”®å¯ä»¥åŸå­æ€§åœ°è¯»å†™ä¸€æ¡æ•°æ®. ä¸€æ¡æ•°æ®åŒ…å«äº†å¤šä¸ªåˆ—æ—(column family), ä¸åŒè¡Œæ•°æ®çš„åŒä¸€åˆ—æ—å†…, å¯ä»¥å®šä¹‰ä¸åŒçš„åˆ—. æ¯ä¸€ä¸ªåˆ—ä¸ä»…å¯ä»¥ä¿å­˜å€¼ï¼Œè€Œä¸”å¯ä»¥ä¿å­˜å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬åŒ…å«äº†ä¸€ä¸ªæ—¶é—´æˆ³ã€‚</p><p>åˆ—é”®è¢«ç»„ç»‡æˆä¸€ä¸ªå«åˆ—æ—çš„é›†åˆ, ä½œä¸ºè®¿é—®æ§åˆ¶çš„åŸºæœ¬å•ä½. å­˜å‚¨åœ¨åŒä¸€åˆ—æ—å†…çš„æ•°æ®é€šå¸¸å…·æœ‰ç›¸åŒçš„ç±»å‹, åœ¨å­˜å‚¨ä»»ä½•åˆ—é”®çš„æ•°æ®ä¹‹å‰å¿…é¡»å…ˆåˆ›å»ºåˆ—æ—. åˆ›å»ºåˆ—æ—å®Œæˆå, åˆ—æ—ä¸­çš„ä»»æ„åˆ—é”®éƒ½å¯ä»¥ä½¿ç”¨.</p><p><img src="https://pb01.s3.bitiful.net/224.webp" alt="avatar"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºbigtableçš„è¡¨è®¾è®¡æ˜¯ä¸€å¼ çµæ´»çš„,&quot;ç¨€ç–&quot;è¡¨, è¿™å¯¹äºæ—©æœŸäº’è”ç½‘é«˜é€Ÿå¢é•¿çš„ä¸šåŠ¡æ¥è¯´æ˜¯ååˆ†å‹å¥½çš„. å¦‚æœé‡‡ç”¨MySQLé›†ç¾¤å­˜å‚¨æ•°æ®, ä¸€å¼€å§‹è®¾è®¡çš„æ–¹æ¡ˆä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„å‘Šè¯‰å¢é•¿, å°±ä¼šé¢ä¸´æ•°æ®å€¾æ–œ, éƒ¨åˆ†æœåŠ¡å™¨è´Ÿè½½è¿‡é«˜ç­‰é—®é¢˜.</p><p>ä¸¾ä¸ªè®ºæ–‡ä¸­çš„ä¾‹å­:</p><p><img src="https://pb01.s3.bitiful.net/225.webp" alt="avatar"></p><p>è¡Œé”®æ˜¯URL, åˆ—é”®æ˜¯ç½‘é¡µçš„ä¸åŒéƒ¨åˆ†, å¦‚â€œcontentsâ€, æ—¶é—´æˆ³æ˜¯é¡µé¢æŠ“å–æ—¶é—´, æ ¹æ®è¿™ä¸‰è€…å°±å¯ä»¥å®šä½åˆ°ç‰¹å®šçš„å€¼.</p><h4 id="åŠ¨æ€åˆ†åŒº">åŠ¨æ€åˆ†åŒº</h4><p>Bigtableé€šè¿‡å°†è¡Œé”®åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„åŒºåŸŸ(Tablet)æ¥åˆ†åŒº, æ¯ä¸ªTabletåŒ…å«ä¸€å®šèŒƒå›´å†…çš„è¡Œé”®. å½“ä¸€ä¸ªTabletå˜å¾—è¿‡å¤§æ—¶, å®ƒä¼šè¢«åˆ†å‰²æˆä¸¤ä¸ªåŒºåŸŸ, å½“ä¸€ä¸ªTabletå˜å¾—è¿‡å°æ—¶, å®ƒä¼šä¸åˆ«çš„Tabletåˆå¹¶. è¿™ç§åŠ¨æ€åˆ†åŒºæœºåˆ¶ä½¿å¾—Bigtableå¯ä»¥æ°´å¹³æ‰©å±•, ä»¥é€‚åº”ä¸æ–­å¢é•¿çš„æ•°æ®é‡. Chubby, Materå’ŒTablet Serverå…±åŒåˆä½œå®Œæˆæ•°æ®çš„åŠ¨æ€åˆ†åŒºä»»åŠ¡.</p><p>Tablet Serverä¼šç”±Masteråˆ†é…å¤šä¸ªTablet(Masterå¯ä»¥æ ¹æ®æ¯ä¸ª Tablet Server çš„è´Ÿè½½è¿›è¡ŒåŠ¨æ€çš„è°ƒåº¦, èµ·åˆ°è´Ÿè½½å‡è¡¡çš„ä½œç”¨), å…¶æä¾›è¿™äº›Tabletsçš„è¯»å†™æœåŠ¡, å¹¶è´Ÿè´£è¿™äº›Tabletsçš„åˆ†è£‚å’Œåˆå¹¶. åˆ†è£‚æ“ä½œç”±Tablet Serverå‘èµ·, è€Œåˆå¹¶æ“ä½œé€šå¸¸ç”±Masterå‘èµ·, å› ä¸ºå¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªTablet Server. Masterä¼šå‘¨æœŸæ€§åœ°å‘Tablet Serverå‘é€å¿ƒè·³ä¿¡æ¯, ä»¥ç¡®ä¿Tablet Serveræ­£å¸¸è¿è¡Œ. å½“Tablet Serverå®•æœºæ—¶, Masterä¼šå°†å…¶è´Ÿè´£çš„Tabletsåˆ†é…ç»™å…¶ä»–Tablet Server.</p><p>Chubbyçš„ä½œç”¨æ˜¯: ä¿è¯ä»»ä½•æ—¶é—´åªæœ‰ä¸€ä¸ªMasterã€å­˜å‚¨Bigtableæ•°æ®çš„bootstrap locationã€tabletæœåŠ¡å™¨çš„å‘ç°å’ŒæœåŠ¡å™¨ç»ˆæ­¢åçš„æ¸…ç†å·¥ä½œã€å­˜å‚¨Bigtableæ¨¡å¼ä¿¡æ¯(æ¯ä¸ªtableçš„åˆ—æ—ä¿¡æ¯)ã€å­˜å‚¨è®¿é—®æ§åˆ¶åˆ—è¡¨. å¦‚æœæˆ‘ä»¬åªé‡‡ç”¨ä¸€å°å¤–éƒ¨æœåŠ¡å™¨æ¥ç›‘æ§Masterçš„å­˜æ´», è¯¯åˆ¤çš„æ¦‚ç‡ä¼šå¾ˆå¤§, ä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´. è€Œä¸€ä¸ªChubbyæœåŠ¡ç”±5ä¸ªactive replicasç»„æˆ, é€šè¿‡Paxosè¿™æ ·çš„å…±è¯†ç®—æ³•æ¥ç¡®ä¿ä¸ä¼šå‡ºç°è¯¯åˆ¤.</p><p>Masterçš„ä½œç”¨æ˜¯: åˆ†é… Tabletsç»™Tablet Serverã€æ£€æµ‹Tablet Serverçš„æ–°å¢å’Œè¿‡æœŸã€å¹³è¡¡ Tablet Server çš„è´Ÿè½½ã€å¯¹äº GFS ä¸Šçš„æ•°æ®è¿›è¡Œåƒåœ¾å›æ”¶ã€ç®¡ç†è¡¨å’Œåˆ—æ—çš„ Schema å˜æ›´, æ¯”å¦‚è¡¨å’Œåˆ—æ—çš„åˆ›å»ºä¸åˆ é™¤.</p><h3 id="é«˜æ€§èƒ½">é«˜æ€§èƒ½</h3><h4 id="é«˜æ€§èƒ½çš„å†™å…¥">é«˜æ€§èƒ½çš„å†™å…¥</h4><p>é¦–å…ˆæ˜¯å°†éšæœºå†™å…¥è½¬åŒ–ä¸ºé¡ºåºå†™å…¥, è¿½åŠ æ•°æ®æœ¬èº«å°±æ˜¯é¡ºåºå†™å…¥, ä¿®æ”¹æ•°æ®å°±æ˜¯å†™å…¥æ–°çš„æ•°æ®æ¥è¦†ç›–æ—§çš„æ•°æ®, åˆ é™¤æ•°æ®å°±æ˜¯å†™å…¥ä¸€ä¸ªæ—§æ•°æ®çš„å¢“ç¢‘æ ‡è®°. ç„¶åæ˜¯ä¸ä¼šç›´æ¥å°†æ•°æ®å†™å…¥ç£ç›˜, å…ˆä¼šåœ¨GFSä¸­å†™å…¥æ—¥å¿—, å®Œæˆåå†™å…¥å†…å­˜ä¸­çš„å†…å­˜è¡¨(MemTable). å½“å†…å­˜è¡¨çš„å¤§å°è¾¾åˆ°é˜ˆå€¼æ—¶,å†…å­˜è¡¨è¢«å†»ç»“, ä¸€ä¸ªæ–°çš„å†…å­˜è¡¨è¢«åˆ›å»º, ç„¶åè¢«å†»ç»“çš„å†…å­˜è¡¨ä¼šè½¬åŒ–ä¸ºä¸€ä¸ªSSTableå¹¶å†™å…¥åˆ°GFSä¸­, è¿™ä¸ªè¿‡ç¨‹æ˜¯minor compaction. minor compactionæœ‰ä¸¤ä¸ªç›®æ ‡ï¼šå®ƒç¼©å°äº† tablet æœåŠ¡å™¨çš„å†…å­˜ä½¿ç”¨é‡ï¼Œå¹¶ä¸”å¦‚æœæ­¤æœåŠ¡å™¨æ­»æœºï¼Œå®ƒå‡å°‘äº†åœ¨æ¢å¤æœŸé—´å¿…é¡»ä»æäº¤æ—¥å¿—ä¸­è¯»å–çš„æ•°æ®é‡ã€‚åœ¨å‹ç¼©å‘ç”Ÿæ—¶ï¼Œä¼ å…¥çš„è¯»å†™æ“ä½œå¯ä»¥ç»§ç»­ã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§», SStableä¼šè¶Šæ¥è¶Šå¤š, Bigtableé€šè¿‡åœ¨åå°å®šæœŸæ‰§è¡Œåˆå¹¶å‹ç¼©(merging compaction)æ¥é™åˆ¶æ­¤ç±»æ–‡ä»¶çš„æ•°é‡ã€‚åˆå¹¶å‹ç¼©ä¼šè¯»å–ä¸€äº› SSTable å’Œ memtable çš„å†…å®¹ï¼Œå¹¶å†™å‡ºæ–°çš„ SSTableã€‚å‹ç¼©å®Œæˆåï¼Œå¯ä»¥ç«‹å³ä¸¢å¼ƒè¾“å…¥çš„ SSTable å’Œ memtableã€‚</p><p>å°†æ‰€æœ‰SSTableé‡å†™ä¸ºä¸€ä¸ªSSTableçš„åˆå¹¶å‹ç¼©ç§°ä¸ºä¸»è¦å‹ç¼©(major compaction). éä¸»è¦å‹ç¼©ç”Ÿæˆçš„ SSTable å¯ä»¥åŒ…å«ç‰¹æ®Šçš„åˆ é™¤æ¡ç›®(ç”¨äºæ ‡è®°å…¶ä¸­å·²ç»è¢«åˆ é™¤çš„æ•°æ®), ä½†å®é™…ä¸Šè¿™äº›æ•°æ®è¿˜æ²¡æœ‰è¢«çœŸæ­£åˆ é™¤. è€Œmajor compactionäº§ç”Ÿçš„SSTableä¸ä¼šåŒ…å«è¿™äº›åˆ é™¤ä¿¡æ¯æˆ–è€…å·²åˆ é™¤çš„æ•°æ®. Bigtableä¼šå®šæœŸåœ°éå†æ‰€æœ‰tablets, æ‰§è¡Œmajor compactionæ“ä½œ. è¿™ä½¿å¾—Bigtableå¯ä»¥åŠæ—¶å›æ”¶å·²åˆ é™¤çš„æ•°æ®å ç”¨çš„èµ„æº.</p><h4 id="é«˜æ€§èƒ½çš„è¯»å–">é«˜æ€§èƒ½çš„è¯»å–</h4><ol><li>å®¢æˆ·ç«¯å¯ä»¥å°†å¤šä¸ªåˆ—æ—ç»„åˆæˆä¸€ä¸ªä½ç½®ç»„(locality group). æ¯ä¸ªtabletä¸­çš„æ¯ä¸ªä½ç½®ç»„éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„SSTable. å°†é€šå¸¸ä¸ä¸€èµ·è®¿é—®çš„åˆ—æ—éš”ç¦»åˆ°å•ç‹¬çš„ä½ç½®ç»„ä¸­å¯ä»¥æé«˜è¯»å–æ•ˆç‡.</li><li>å°†SSTableçš„ç´¢å¼•åŠ è½½åˆ°å†…å­˜ä¸­, è¿™æ ·å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ•°æ®æ‰€åœ¨çš„SSTable.</li><li>å®¢æˆ·ç«¯å¯ä»¥æ§åˆ¶æ˜¯å¦å‹ç¼©æŸä¸ªä½ç½®ç»„çš„ SSTable, è™½ç„¶æˆ‘ä»¬é€šè¿‡å•ç‹¬å‹ç¼©æ¯ä¸ªå—ä¼šæŸå¤±ä¸€äº›ç©ºé—´, ä½†å¯ä»¥æ— éœ€è§£å‹æ•´ä¸ªæ–‡ä»¶å³å¯è¯»å– SSTable çš„ä¸€å°éƒ¨åˆ†.</li><li>æŠŠæ¯ä¸ª SSTable çš„å¸ƒéš†è¿‡æ»¤å™¨ç›´æ¥ç¼“å­˜åœ¨ Tablet Server, å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥è¿‡æ»¤æ‰ç»å¤§éƒ¨åˆ†ä¸å­˜åœ¨çš„æ•°æ®, ä»è€Œå‡å°‘ç£ç›˜IO.</li><li>Tablet Serverçš„ä¸¤çº§ç¼“å­˜. æ˜¯ä¸€ç§é«˜çº§ç¼“å­˜ï¼ŒScan Cacheç”¨äºç¼“å­˜ SSTable æ¥å£è¿”å›åˆ° tablet æœåŠ¡å™¨ä»£ç çš„é”®å€¼å¯¹ã€‚Block Cacheæ˜¯ä¸€ç§ä½çº§ç¼“å­˜ï¼Œç”¨äºç¼“å­˜ä» GFS è¯»å–çš„ SSTables å—ã€‚</li></ol><h3 id="é«˜å¯ç”¨">é«˜å¯ç”¨</h3><p><img src="https://pb01.s3.bitiful.net/226.webp" alt="avatar"></p><p>Bigtableé€šè¿‡è®¾è®¡å°†Masteræ’é™¤åœ¨äº†æ•´ä¸ªæ•°æ®è¯»å†™çš„è¿‡ç¨‹ä¸­, å°†æŸ¥è¯¢Tabletså°½å¯èƒ½åœ°è¢«åˆ†æ‘Šåˆ°äº†Bigtableçš„æ•´ä¸ªé›†ç¾¤, ä»è€Œä¿è¯äº†é«˜å¯ç”¨æ€§.</p><p>BigtableæŠŠåˆ†åŒºå’ŒTabletsçš„åˆ†é…ä¿¡æ¯å­˜åœ¨Bigtableé›†ç¾¤é‡Œçš„<code>METADATA</code>è¡¨. Bigtable åœ¨ Chubby é‡Œçš„ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶é‡Œï¼Œå­˜æ”¾äº†ä¸€ä¸ªå«åš<code>Root Tablet</code>çš„åˆ†åŒºæ‰€åœ¨çš„ä½ç½®ã€‚è¿™ä¸ª<code>Root Tablet</code>çš„åˆ†åŒºï¼Œæ˜¯<code>METADATA</code>è¡¨çš„ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œè¿™ä¸ªåˆ†åŒºæ°¸è¿œä¸ä¼šåˆ†è£‚(ä¿è¯å­˜å‚¨tabletçš„ä½ç½®ä¿¡æ¯çš„ç»“æ„ä¸è¶…è¿‡ä¸‰å±‚)ã€‚å®ƒé‡Œé¢å­˜çš„æ˜¯<code>METADATA</code>é‡Œå…¶ä»–Tabletsæ‰€åœ¨çš„ä½ç½®ã€‚è€Œ<code>METADATA</code>å‰©ä¸‹çš„è¿™äº›Tabletsï¼Œæ¯ä¸€ä¸ªTabletä¸­ï¼Œéƒ½å­˜æ”¾ç€<code>User Tablets</code>çš„ä½ç½®ã€‚</p><p><strong>æŸ¥è¯¢è¿‡ç¨‹</strong>:</p><ol><li>å®¢æˆ·ç«¯é¦–å…ˆè®¿é—®Chubbyï¼Œè·å–<code>Root Tablet</code>çš„ä½ç½®ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨Root Tabletçš„ä½ç½®ä¿¡æ¯ï¼ŒæŸ¥è¯¢å‡ºå…·ä½“<code>METADATA Tablet</code>çš„ä½ç½®ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨<code>METADATA Tablet</code>çš„ä½ç½®ä¿¡æ¯ï¼ŒæŸ¥è¯¢å‡º<code>User Tablets</code>çš„ä½ç½®ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨<code>User Tablets</code>çš„ä½ç½®ä¿¡æ¯ï¼ŒæŸ¥è¯¢å‡ºå…·ä½“çš„æ•°æ®ã€‚</li></ol><p>METADATA tableçš„æ¯è¡Œæ•°æ®åœ¨å†…å­˜ä¸­å¤§çº¦å  1KBã€‚å¦‚æœå°† METADATA tablet é™åˆ¶åœ¨ 128MB ï¼Œè¿™ç§ä¸‰å±‚ç»“æ„å°±å¯ä»¥å­˜å‚¨é«˜è¾¾ 2^34ä¸ªtabletså’Œ2^61 bytes</p><p>é€šè¿‡ä¸Šé¢çš„è®¾è®¡, Bigtableè¾¾åˆ°äº†å¯æ‰©å±•, é«˜æ€§èƒ½å’Œé«˜å¯ç”¨, æ­£å¦‚å®ƒçš„åå­—ä¸€æ ·, è¿™æ˜¯ä¸€å¼ &quot;å¤§&quot;è¡¨, æ‰€ä»¥å®ƒå¿…ç„¶æ‹¥æœ‰å¹¿æ³›çš„åº”ç”¨æ€§.</p>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> paper reading </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€è¿‘çš„æ€è€ƒä¸é€‰æ‹©</title>
      <link href="/2024/08/26/2024-8-26-%E6%80%9D%E8%80%83%E4%B8%8E%E9%80%89%E6%8B%A9/"/>
      <url>/2024/08/26/2024-8-26-%E6%80%9D%E8%80%83%E4%B8%8E%E9%80%89%E6%8B%A9/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="bf3b0ca9b90a4dd75cb2325861c96503a4e3b3522a710176ce986cd973b43d10">f2790461a6fef943f99cab532869b218e3000867bd8e8137929da48f3539d4d8e72295a9f67dae9ee33e85f20355b1f2a378b1d40268979fbd96653355cefc3c184fc287aebd453b0a0d82642f0ed3934128302e8b0bcd8a8df1fef857611afa71388a071b7b2369e4792bf7954b630185cce0784c3e7c86532de1aa4cf18bbb51ed69c4387c2467fe098c3a525d863a97aae9e74db468c8bb36a060f45df650d66d8fca0634e98f54771150ec5db320539d661d7e3f0b7fd32ad1bec1c7577c56572df5980c69cc5204b7c68e8823c50da6d480125f111a4682b7e6d02999b6adcfe97983811121b52c62f124d86db82b3d7038f598522a692d5f60512bf49e827c6227ca15eed6ce5b7a970015625a8a0ca456413f1fc718aa75b12721d9d41284537e4980c15eccccdfa4ff47fb585053ac23b3c964dcdcdb171628316c560a0c8af51ec7c294283e64c728b6c976b3150efd697ae188ff5dc02b6910e0144b877e9de7822d830b0e0ecfb515b38f21ef1874157b98319bc6a0386c4b0decde7abd5c7130b2bc8b2d4372a153e1c83efce5c5f0ad55ab858f3d44a5e27546b831894dfd25c8ce1815040f1fcbfa5b851ce98d4208c678e6e1a050ef06626725aad2db252563e5d4b5f324abb131ba10324c1de8b80f5e0b5885e544c25e9c079cf3975b4d258b536f3c754c0028424b6bb9cb74385c3d5ad19b92d0cc6efffd7901e160b38a6decf7f2e5c6edde2e396ce7a2d3247d2a7566c084f27a892cc682e936bc8b46a9e3fb195cda32e7fe7c6c30a658d107cb228b07bd8ff4637da5cb3b3c83fa8db3711df3ff3a8349b9df84297e81769c4dbe0898e6b45c96c4d339c1e546ad547b0f9cee90e74140f4176a5d9e5d08f26ef5f330e3c911c068ebb6f1d6923a3bf65b9b3471460be82b607d730626b04557ec12d9f2571cab08e47e27d0f2d47efcf1a18b1aebdef907b244c3849927bb55a8c9c7055bc208347ce346773e50a1d014e6fe03e690a667e97b21af19f604412adde772d2e3fd8937516c4dc9415e7273d14b5205548dcf625f0285b55fab536c20222572bfbfc2795dd7f3aadd9b95bfcf261b54ba09cc85f64974d938be5f6a19a6cfe4f528005fc0f1bb5bd38e4a98afc54cbfa464a9cd4180e73aa222ab7889944cdaecac3e2efe3509b025a3e50385178b638dc8ea1f243a251fcea90ee1beb08c6226b3890991ec6753f4dca6f05c4faf8af237180f0c2aeac88126ad4ad269ac408a53e46e197bc6e2eb36bb1ca99047d62aad791ba9a07db70f4ed6caad6a0e8ecacb15a96bb4b25eb0de3fa9604b9e458470bcaa79edc9a6292646dda778c8b7dc64b90e1c5b73bf5e23c92194d518aa23e2625ce93b5a152b940c315ec1b6b5ca6a30d94641c8c094a2d73b056cd6f0b00607569cec8ea983a947d266239ea6d696dcd6247231989c05790b1e91cf7a0a2670c0693307aeeb53ae1d3fb7144aaca082f303937ca42ba0224b90bb9aa67edf340fd84b8d3e600a668cc30d89f4870c3f38e037ebfb941aea58a9a774e2c95de0731cd977f946a25c6222926e05f72b0529ca7292b3203439a6f890f6b333d1c6a3e32e47c36130f9cf4f8a507e16afef839c1fbe379622b5e3ae58edc98f7a0235114da00f47ae6dccc354a32f42c689b12c3c2ba205a6fe6d026aa1da29cbf83800b20e2597dd990cd0dc34295f2a896a08f72bdc41873900c2386b6bb6361836ca8e2575d6fa68b476001fab03d31121190600a32151e49dafca0e0c986c6128f801067bf909eb4438cca63d88c08419eae0099eda5d4bb32a29a1a2a6f56244897ff5be253f829f6058205dd9439e4d6303a9aabdb1183acdadb7f48bc74d266651d7ec1286ba42b03d71b99e6f984f00501a5fe32effb091f8d9aaf58c3c7d61452a7c59895a39a8cabd705173e05f84beb8113587eab2ce1e2bfe5ae2e64f861920f13f516be0bd62f4d301cd502e4d42e399299947cc1dca12b1417b41e903e596fa707169cbacfdfc56d698347a01f778e26106e9ec1c60f26b935cd2ae5482a7cebe3dd530e21f3365be390aff7f8591c3abf0762d492acc67f02d0f85ce8b2ab99b5eee6309006e61822705c8db24d20494fa599071a5a184194b2d01178549fd4b9c4955ba275aa8d42208621ee14f5f6b70e6a45414503f96b4f5686f7a43b7e6a410ae0d2fed0119efd5a4a922aa394dee000d96dda9d92263264d3919f49ca6332bd43ca0203845e43f591c6db34b06d13c46ecb039602ca849558b7bfee0cda56f0b749f1edf1226d49ee238c98d113d35a68472dcb8bea38031a5fde7a1e8c5392104bbf773c70e55a893f2caade7b652b9b3ab5c0d7dcd73150b1d26c3eab13401ed09f25bb6e1d306310d359d4df6a8c59e3cc52ae97681dfe162eeea654e1a0b3111ca4609dff9ec513f308989e2a6600a1a094b713971b1b249a381c8f23d2c5cd9dcf0afba08d7995b8e76470b01dcc11be65a1f1dd4ee312b1abe9b668aa9ebe6609b0187a0a71eab8903adff8a1d27826f6345ee8f4050bb44296907872c3e605a6a47e799cfe8c9907f93266b750e7cb089fbafd642a93b5b6d9920b8119dfecae0e994b6cf454c317b2dc3bcdcc55301c63d79846c069c4e9355a632e6d1e9900c8fe7eb658886c71914ffb45b1505a1a5050758d15643db57305ac19283557056dea24a7c9374042aa629a4e7383fa862a79c46af0d2a24662d029393122e96d40ebe8733738b70fe2368a7665254d38bd3259507fc6fd3114c5f5df1280078626d1313a0874dad1194a624fc5e73846d5557c8a46c130f90501196c4eb88e3a180a97bdc0434ecc55557b5f6b95d216c9cf6d84280ff18b31d5176eac908ebbc01c2b73b4e837e5924c446d8284af96108caad7b18a5785207096d5fa15464999f73cdde7f50e0e4e0a5c9809fd9f33d77c5e5bbbe7605f2890a6ad7efa2ada9fedccfec707955ac7b69849472db839431f748682d58da0ada566ab64cee4614bcbd213ea864364009c4d14fe52ad7b5a9a5e9dc3abc8833a248d8d696aed8f652b338750e9f93214534b288628d3a9b2f79d09bf9dee12410d4ed74ec650ae25540399dd204f082362f74e115366593773f10df18486d988b542c39830342842b4bb75048b8ac5273374b53342b150863f96308da0d56e28b81559e079dd47460e4d0f0d6199d3eda22bc10cf05d0278fceec47ff2b441506c043075e1aba8d6b04bda5beef29f56e2ff3361b864b2f198b732c9b49e0027cb53df4b36a205f4e3e188fc3dc6bc2d573645cd408c4a28045e479d386786302e6faedf2b9425cd4f25f5171ede6f09533bbc389f059dbc9dcaf941b01c778aa2ad8988654e6067b06a77689504ce35ad52a6bb44f90d4d12fef4fb6b50d2f5e4d23c3117a15c7a8b763f4cf94d0bd0f625c8885aa30a6ca660b797f1ad929793c1b40464cec7fe4598775a1c97176d58832d9c83c96ef32c5d236c78dee9e600f40cc8bd7acfd6e9ddd424faa31266618efc9e5d48edc84cc2b1b56ef5b04244efdb4b00a8e435a9687690f13670b9446cd4aea29d6835bf03b1f39f8c4830f49e8c0fc9f19a1dc93f09e543de3bf091a19ddd3e87938b3a484bd204f309d4d20314802ff079ccab6686be2dad834fd1219b1e0e5c82ff335736caf448583f02fabaed8bc81be76782119426302943dbf893fbcec5e2373fc3c356cd2ee0f3a46be590043722541aa16220aa07d943757eeeee95ca639db3a7de57814cb32b121f87e2fd7627c2ab6e08ab11adf01e7e4e37d42f9f357095921d34c719e0c5648aa7574c58351bb0e2caf5a9971d8ded845ed96c849971fe9cb75a3ecd08a595a53402f159b582d7de8bae83375e1e60725dfa05d80c85c2aebc25d11e5211af1d3e1714ac1f465c4f29ba071f68a9261cad11921361fb3a14fd9164eb47bc260a288deaae1d72c3b578e185ef109b31edaac47065323ba693144472f2d9d01f4389beedb10738d30dba73f6caf10f1d75648b145ce47888c326554a16890f497b490b1550fdeb7d154bb0b622ed2eb45966131da1066a04c35ab3e49eda07be389ba8021b3f8449898a5dc6b64a7aeb732d28bc6669b48afd07ff66a54ba774e529f43f70604580e7c88bfd7464f247d3a3c8e65f1e8a232595384e4fa8a6926d26aff40755b847436c940a885279981f2578ca20d867b283558541c41ce24fa7f77907afa7312a3ebccb0fd7a8c4641d76acda932ae6c3376ad97b7e3ab8d3da0447997b6871df39808f7724317f2951ae65f6476f3670cae1bf5aae4f423f033fa959fb52f585695a6cc680304beb07ef2da37285eca050d72bf3c675a472a12e05bba1860ce8bc74b0e82069eea446eb88c7fef79d36509991c0eeb1ee2ce99800b0dd9ec03e0989c972b68447738c3df945e664939872ccdcccd9216ee3b664f3df4d8a7d6cdf725305ad758cc89d004b80394cdf210c8f3bf3751bd6502bc6a2a62e4b6e8b9b84dbd8b3e3c4b744d78bb616b499ae4f2ca6a641228557cca2b1649bbf4f10e22ad2690b6e75f35ce7a74df43023c1886addb521bc7dc7271caaeb93977a9fe830752de0cd75911c5041f313b854c9fec443ff376037ca25490e4f9d9345ac233ed9e7b925545fecf9f272bf4a38bd20a243eb6f38506663c8522af9dfe649bd54de42bc1c1dfd81946594121e38dcf8c7dcb5b1edbfad3bc6257830898937cd6c23b9b9471ea0d363fa26a974befef98376fcf886f62a5b937c6804a73b47521f35a83bce0930f52d7863169e4313821dd563e9e2bde1a5e8110282bfbe049007bea27691eea9ec0e6791ebcf81323c1061eac84c93f6b3e94931a736b03ca978e834b4f7c416cf975ebfde4159ab806b41cc22abcf139278fe4169e31412cb82c4d2cfbdcd8b2e7f1b2ee2cb2ee114c494becf8d9e5de6afff3eaf6249427bbe3532915a743d089139d83599107f817122bc7a7644a78632afa1f59626a5b4e94c7995c84044de7197feefad986bfee42462433364223c4fb0a1db445295dfc3cf7828dcca519ec7cef649aca19e629a08f8f76ee3db492a7ef1947f5dee75e37da5716f95e26f61097f6fcfa1620514dbad1858a7183c1a21fee3ff0016aa5130bba93308e6a72c72bba86b2be0f3e38c31611387779fbddd4f72fee994c36d5f33e4d7e3bd3cb4295a22436931f43fc5dd3f969e591b28328b401b37a8b4f042332f9fd8a06be1f5819b22385486ea94482c64329262f8ddf8764d768c05ebf44922d7bbed564ad58f541f35ea18d5bbf5186633bc2fbb004f4c8cc491a339a3e0c2f56252b3d39507c96958bf32d717eee17dc70e2b0b3c4c438c65d0bb4ce0cb6a269ba24334a33ea54865ec628ea31dfc4e1bda1910ad695b2adbce67a2af74fab99bed515c12d23493f8187f2063379b43852a752d384521b97db2f787e6320806559beb9c84395a2056a76e4637303282cdd0df48693f8ba3314b7efce38e12557576155575115221851b1a4b934bf44882ef526aa9e1e07bd79f5c201ac29598d5f9e1f6018cd0051b68f7a1457e6691670ed374dee7c6f5092ab03b5355cc334afcbcf1ff932a8a5961860744bb143907b99931dcb61ea067297ec083a4c20336c4058a6b4635d888a04575fb275e7b5405e2d80a0f88cdc36edb629b48e059654ad783e72ea714afbdd0e972dbea0bbce8afdff47d3ead6ce34caa6d238015a89171c3b049caf65b1e09dd85a5665af254fe66821c5fb5dcdfcec1aa90339efea31713031c500f76629f730345dc30a397c0d6c7b7c1421aaf6c82a867c42b3358ac0bb1fbd4839a048796428cf6ba876323b9022ffba4d3251d4fc7ffe893fd02a05991265654ec2c1425f0712a719bf3dd95929422ab7b2fbd6673420cc9b0fb5ab9260dd51c48115b79befb868cdecaaa56ac84c94ebf8c6c73b8c64dd12356db49c7e8b26ec32de56d0f62681e8393726c9fdeacf36b9dabbfda075f285e04a07035763e3c2de14d59f977915db93afd78f1ed274670c2eadf2af18b64c0f5d671d693836ff94c57f3652c81b26869fc60605a4ccdb57f060e5d1236ba02a15e8e029aae4ac2a829392fe7b5746224a9ad97686789ef7277adffb6597305fe8e8d53067e2150d520a28067534704ab4bcf9d2eca2eb5b62f1234395a9a490bd5b8c8c72b6dd31ada8dc5ff666dbccd61735ce2e0a08a00fb8fece47835a0c4d206c9b84bedd8350b50b274a8ad3c27dbee0fc61d92501adcee6ba4adf1d752905e35d2abff6f58876dd7c0e3c70633ea48935e0fa5a850a5d23228549882959bef710199f7e683b5e76bf016d1d9d2fa500c918b0f47826ecfe628263a011ca5d59d62a3b9d09affbb284535efb75076a63f44702cc818841e7b995bd573a9b0c7c116b3c5c758f3605571e284e329b83cad56a305c2291509eac2c3d35da89caae26deb1235b38dcc4977d1a525e288cc23b3af4b4e8f51fbc25d789b8d17315fe35d4b367355476bab27b4605513c4e0b45f946d258c1fb45336a4506c25ba3c8181933482544cfbb2b7601497ed8a86d292ba6194f087396070e83f92b12e7dd6c9da9534934e44823627d3b761ef6cc57268491b69909b74a45a1c33b9074931b0ad32f01dd9b8356ffc68ddf3d54055c0452cecf5fffd0c019c03a1500343eb0d2d33fa2c88ea7faf8ed4b07806002c58138212a35886fcf52ed9df96ce974ffe1bec92e9b4d2ff6bbf9c02efc57a28d7525fdc3b3dea770f5a12a6d28e2ada9a222635801a0f2bb6773b107136cd22ae9984f362358cfd7559724d424ff51334f912f552624e00ce610eced16ee1a0a199f0a68f8cda1db47d3fb66fcd0891f1d72c8bf3a4021a957bed445de51e55ea3f0e727751bae4a3c6e83f1dd71a500f350b42c0c65bcda877d4eb1fe013dc8064a9cecbc70604652fffda80534b443436e0e54c750ce15471c3e80df21cf2b5f691ec536668fa635750fe5c5c9a6fd25b9d97226a2b1310d7d52357f297ef50d8866947ee655a3823e35e511db335664030ece76fee0d7a93e446aa3168ced2ec1a230be19f3feb1accd09f5c099aa51a4844d690d02f11355fbfd9ac0daa187f4927da2ef0a49f827e8ec17f20d8781ec9b9a3a8cf3fcafe4c8cd9caa3b0f709e103eccf84e842b3a44b0dd7d10a4c49a8b3f2022019deef1aed4e6bdb90137ce5f065b56b9c5d6fb2d6b6c33d7efd2546bf83f1fd96d3bd5607cb78c21ea7f54686f11a428d1afebc5253e54013fca4c221bed898276f983022396efeb985b5c6e42f09f82aa126f81424374f21534d4a11ba5fa72f0150bf02193235863789bd12b2d0f193e1a95b48133910fb91f3a34dc872fe9c6fac161db4b631d2e49649505b4dcbfd9ff5246908d7f00897a2937f3fdb9a9c29c43ddc0a9289370bf7df57e48b11aff59dd39db0ac7c5e1cfd01043a1499444c583c20927079d79b4ec084ed870101ab11a96a6b63758b76935434b603349a9373a636850a864b13b192cbe05e477dd34356703a1ca64c2e3046e457e7d4924363abcf7f82451be18ef237e96ec9d9bd683b69834bfb4e9650ba30e2f661b581d675ae7a34324cf913ce8f4b04d767b708fe9f1242bc0be07611fe2b9363afb68d2fd3a734a59b028e896e0f58f9fe0c67b5e755094cd57b20cf612f6aa852b75ceee1de0a114369940126a374d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-shrink">      <input class="hbe hbe-input-field hbe-input-field-shrink" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-shrink" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-shrink">2025/04/19è½¬ä¸ºåŠ å¯†æ–‡ç« , è¯·ä½¿ç”¨å¯†ç è®¿é—®</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> memo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDFS Paper Reading</title>
      <link href="/2024/08/07/2024-8-7-HDFS/"/>
      <url>/2024/08/07/2024-8-7-HDFS/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="HDFS-Paper-Reading">HDFS Paper Reading</h2><p>æˆ‘è®¤ä¸ºHDFSæ˜¯ä¸€ä¸ªæ›´åŠ é€šç”¨çš„å¼€æºçš„GFS, å…¶æ¶æ„å’Œè®¾è®¡æ€è·¯ä¸GFSéå¸¸ç›¸ä¼¼, ä½†æ˜¯HDFSåœ¨å®ç°ä¸Šæ›´åŠ ç®€å•, æ›´åŠ é€šç”¨, æ‰€ä»¥æˆ‘ä¼šå…³æ³¨å¸¸è§çš„é—®é¢˜å’Œæ˜¾è‘—ä¸åŒçš„åœ°æ–¹.</p><h3 id="HDFSå†™æµç¨‹">HDFSå†™æµç¨‹</h3><ol><li>å®¢æˆ·ç«¯å‘é€å†™è¯·æ±‚, é€šè¿‡RPCä¸NameNodeå»ºç«‹é€šä¿¡, NameNodeæ£€æŸ¥è¯¥ç”¨æˆ·æ˜¯å¦æœ‰å†™æƒé™, ä»¥åŠå†™å…¥çš„æ–‡ä»¶æ˜¯å¦åœ¨HDFSå¯¹åº”çš„ç›®å½•ä¸‹é‡å, å¦‚æœè¿™ä¸¤è€…æœ‰ä»»æ„ä¸€ä¸ªä¸æ»¡è¶³, åˆ™ç›´æ¥æŠ¥é”™, å¦‚æœä¸¤è€…éƒ½æ»¡è¶³, åˆ™æˆäºˆå®¢æˆ·ç«¯ä¸€ä¸ªå†™å…¥ç§Ÿçº¦(lease)</li><li>Clientæ ¹æ®æ–‡ä»¶çš„å¤§å°è¿›è¡Œåˆ‡åˆ†, é»˜è®¤128Mä¸€å—, åˆ‡åˆ†å®Œæˆä¹‹åç»™NameNodeå‘é€è¯·æ±‚ç¬¬ä¸€ä¸ªblockå—å†™å…¥åˆ°å“ªäº›æœåŠ¡å™¨ä¸Š</li><li>NameNodeæ”¶åˆ°è¯·æ±‚ä¹‹å, æ ¹æ®ç½‘ç»œæ‹“æ‰‘å’Œæœºæ¶æ„ŸçŸ¥ä»¥åŠå‰¯æœ¬æœºåˆ¶è¿›è¡Œæ–‡ä»¶åˆ†é…, è¿”å›å¯ç”¨çš„DataNodeçš„åœ°å€</li><li>å®¢æˆ·ç«¯æ”¶åˆ°åœ°å€ä¹‹åä¸æœåŠ¡å™¨åœ°å€åˆ—è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œé€šä¿¡, å»ºç«‹pipeline, Client-&gt;DN0-&gt;DN1-&gt;DN2</li><li>Clientå‘DN0ä»¥packet(64kb)å½¢å¼ä¼ è¾“æ•°æ®, ç„¶åæ²¿ç€pipelineä¼ è¾“, ackå“åº”ä¼šæ²¿ç€pipelineé€†åºè¿”å›, ç›´åˆ°DN2æ”¶åˆ°æ•°æ®, DN2å‘DN1å‘é€ack, DN1å‘DN0å‘é€ack, DN0å‘Clientå‘é€ack</li><li>å½“Clientæ”¶åˆ°DN0çš„ackä¹‹å, æ„å‘³ç€å¯¹åº”çš„packetä¼ è¾“å®Œæˆ, æ•´ä¸ªblockä¼ è¾“å®Œæˆå, Clientå†æ¬¡è¯·æ±‚NameNodeä¸Šä¼ ç¬¬äºŒä¸ªblock</li></ol><p>ä»å†™æµç¨‹ä¸­æˆ‘ä»¬ä¾¿èƒ½çœ‹å‡ºä¸€äº›HDFSä¸GFSçš„ç›¸åŒä¹‹å¤„, ä¹Ÿæœ‰ä¸€äº›ä¸åŒä¹‹å¤„</p><h4 id="GFSå’ŒHDFSä¸­çš„ç§Ÿçº¦-lease-æœºåˆ¶æ˜¯ç›¸åŒçš„å—">GFSå’ŒHDFSä¸­çš„ç§Ÿçº¦(lease)æœºåˆ¶æ˜¯ç›¸åŒçš„å—?</h4><p>ä¸ç›¸åŒ. GFSä½¿ç”¨ç§Ÿçº¦æœºåˆ¶æ¥ç¡®ä¿å¯¹æ•°æ®å—çš„å†™å…¥æ“ä½œæ˜¯æœ‰åºçš„, å®ƒä¼šæŒ‡å®šä¸€ä¸ªå‰¯æœ¬ä½œä¸ºä¸»å‰¯æœ¬, ä¸»å‰¯æœ¬è´Ÿè´£ä¸ºæ‰€æœ‰å¯¹è¯¥æ•°æ®å—çš„å†™æ“ä½œåˆ†é…ä¸€ä¸ªå…¨å±€çš„åºåˆ—å·ï¼Œæ¥ä¿è¯å†™å…¥çš„é¡ºåºæ€§; è€ŒHDFSä¸­çš„ç§Ÿçº¦æœºåˆ¶åˆ™ç”¨äºç¡®ä¿å•ä¸ªå®¢æˆ·ç«¯å¯¹æ–‡ä»¶çš„å†™å…¥æ“ä½œçš„ç‹¬å æ€§. å½“ä¸€ä¸ªå®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶, å®ƒä¼šè·å¾—ä¸€ä¸ªç§Ÿçº¦. è¿™ä¸ªç§Ÿçº¦ç¡®ä¿åœ¨ç§Ÿçº¦æœ‰æ•ˆæœŸå†…, æ²¡æœ‰å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶.</p><h4 id="GFSå’ŒHDFSä¸­çš„pipelineä¼ è¾“æœºåˆ¶æ˜¯ç›¸åŒçš„å—">GFSå’ŒHDFSä¸­çš„pipelineä¼ è¾“æœºåˆ¶æ˜¯ç›¸åŒçš„å—?</h4><p>å‡ ä¹ç›¸åŒ, åªä¸è¿‡GFSä¸­å­˜åœ¨ä¸»æ¬¡å‰¯æœ¬çš„æ¦‚å¿µ, Clientä¼ è¾“(å†™å…¥)çš„ç¬¬ä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸»å‰¯æœ¬, è€ŒHDFSä¸­å‰¯æœ¬ä¹‹é—´æ˜¯å¹³ç­‰çš„, æ‰€ä»¥Clientä¼šå°†æ•°æ®ç¬¬ä¸€ä¸ªä¼ ç»™ç¦»å®ƒæœ€è¿‘çš„NameNode.</p><h3 id="HDFSå’ŒGFSçš„ä¸€è‡´æ€§">HDFSå’ŒGFSçš„ä¸€è‡´æ€§</h3><p>HDFSçš„ä¸€è‡´æ€§æ¯”GFSå¼ºä¸€äº›, HDFSåœ¨æ–‡ä»¶å®Œæˆå†™å…¥åæ˜¯ä¸å¯å˜çš„(æ›´å‡†ç¡®åœ°è¯´, HDFSçš„æ–‡ä»¶åœ¨å…³é—­ä¹‹åä¸èƒ½è¢«è¦†ç›–æˆ–åœ¨ä»»æ„ä½ç½®ä¿®æ”¹), è€ŒGFSåœ¨æ–‡ä»¶å®Œæˆå†™å…¥åæ˜¯å¯ä»¥ä¿®æ”¹çš„. æœ‰äººä¼šé—®HDFSä¸æ˜¯æ”¯æŒæ–‡ä»¶è¿½åŠ å—? æ€ä¹ˆæ˜¯ä¸å¯å˜å‘¢? å’ŒGFSçš„è®°å½•è¿½åŠ æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢? ä¸»è¦çš„åŒºåˆ«æ˜¯GFSä¸­çš„è®°å½•è¿½åŠ æ˜¯ä¸ºäº†å¹¶å‘å†™å…¥è€Œè®¾è®¡çš„, å®ƒåªèƒ½ä¿è¯<code>è‡³å°‘ä¸€æ¬¡</code>çš„ä¸€è‡´æ€§, å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ˜¯æœ‰å¯èƒ½ä¸ç›¸åŒçš„(è¿™ç§ä¸ä¸€è‡´æ˜¯<strong>æš‚æ—¶çš„</strong>, æœ€ç»ˆä¼šé€šè¿‡å†…éƒ¨æœºåˆ¶è¾¾æˆä¸€è‡´); HDFSä¸æ”¯æŒå¯¹åŒä¸€æ–‡ä»¶çš„å¹¶å‘å†™å…¥, å®ƒçš„æ–‡ä»¶è¿½åŠ æ˜¯é¡ºåºå†™å…¥, èƒ½å¤Ÿåšåˆ°<code>æ°å¥½ä¸€æ¬¡</code>, æ¯ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®æ˜¯ç›¸åŒçš„, æ‰€ä»¥HDFSçš„ä¸€è‡´æ€§æ›´å¥½.</p><h3 id="å¯ç”¨æ€§">å¯ç”¨æ€§</h3><p>HDFSè®ºæ–‡ä¸­æåˆ°äº†CheckpointNodeå’ŒBackupNode. CheckpointNode(ä¹Ÿç§°ä¸ºSecondary NameNode, ä¸­æ–‡çš„èµ„æ–™ä¸­ä¸»è¦æçš„æ˜¯è¿™ä¸ª)çš„ä¸»è¦ä½œç”¨æ˜¯CheckpointNodeä¼šå®šæœŸä»NameNodeæ¥æ”¶ç¼–è¾‘æ—¥å¿—(EditLog)å’Œæ–‡ä»¶ç³»ç»Ÿé•œåƒ(FSImage), ç„¶ååˆå¹¶å®ƒä»¬, ç”Ÿæˆä¸€ä¸ªæ–°çš„FSImage, å¹¶å°†è¿™ä¸ªæ–°çš„FSImageå‘é€å›NameNode. è¿™ä¸ªè¿‡ç¨‹æœ‰åŠ©äºå‡å°‘EditLogçš„å¤§å°, é˜²æ­¢å…¶æ— é™å¢é•¿, ä»è€Œé¿å…NameNodeåœ¨å¯åŠ¨æˆ–æ¢å¤æ—¶éœ€è¦å¤„ç†å·¨å¤§çš„EditLog, æé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ¢å¤é€Ÿåº¦. BackupNodeå¯ä»¥ä½œä¸ºNameNodeçš„çƒ­å¤‡ä»½, å­˜å‚¨NameNodeçš„å…ƒæ•°æ®çš„å‰¯æœ¬, ä»¥ä¾¿åœ¨NameNodeæ•…éšœæ—¶å¿«é€Ÿæ¢å¤.</p><p>ä½†è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯Hadoopæ—©æœŸçš„åšæ³•, åœ¨Hadoop 2.xç‰ˆæœ¬ä¸­, NameNodeå¼•å…¥äº†é«˜å¯ç”¨(HA)ç‰¹æ€§, é€šè¿‡é…ç½®Active NameNodeå’ŒStandby NameNode, å¯ä»¥å®ç°NameNodeçš„è‡ªåŠ¨æ•…éšœè½¬ç§», Standby NameNodeå®æ—¶åŒæ­¥Active NameNodeçš„çŠ¶æ€, ç¡®ä¿åœ¨Active NameNodeæ•…éšœæ—¶èƒ½å¤Ÿè¿…é€Ÿåˆ‡æ¢, ä¿è¯æœåŠ¡çš„è¿ç»­æ€§, æé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå¯é æ€§. åœ¨Hadoop 3.xç‰ˆæœ¬ä¸­, NameNodeå¼•å…¥äº†è”é‚¦(Federation)ç‰¹æ€§, å¯ä»¥å°†å¤šä¸ªNameNodeç»„æˆä¸€ä¸ªé›†ç¾¤, æ¯ä¸ªNameNodeç®¡ç†ä¸€éƒ¨åˆ†å‘½åç©ºé—´, è¿™æ ·è§£å†³äº†NameNodeå†…å­˜ç“¶é¢ˆé—®é¢˜,  æé«˜äº†ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œæ€§èƒ½.</p><p>ä¸‹é¢è¿™æ˜¯ä¸€å¼ Hadoop 2.xç‰ˆæœ¬ä¸­çš„é«˜å¯ç”¨æ¶æ„å›¾, 3.xç‰ˆæœ¬åªæ¯”å®ƒå¤šå¢åŠ äº†ä¸€äº›NameNodeçš„é…ç½®</p><p><img src="https://pb01.s3.bitiful.net/223.webp" alt="avatar"></p><p>ç›‘æ§NameNodeçŠ¶æ€é‡‡ç”¨zookeeper, ä¸¤ä¸ªNameNodeèŠ‚ç‚¹çš„çŠ¶æ€å­˜æ”¾åœ¨zookeeperä¸­, å¦å¤–ä¸¤ä¸ªNameNodeèŠ‚ç‚¹åˆ†åˆ«æœ‰ä¸€ä¸ªè¿›ç¨‹ç›‘æ§ç¨‹åº, å®æ–½è¯»å–zookeeperä¸­æœ‰NameNodeçš„çŠ¶æ€, æ¥åˆ¤æ–­å½“å‰çš„NameNodeæ˜¯ä¸æ˜¯å·²ç»æŒ‚äº†. å¦‚æœStandbyçš„NameNodeèŠ‚ç‚¹çš„ZKFCå‘ç°ä¸»èŠ‚ç‚¹å·²ç»æŒ‚æ‰, é‚£ä¹ˆå°±ä¼šå¼ºåˆ¶ç»™åŸæœ¬çš„Active NameNodeèŠ‚ç‚¹å‘é€å¼ºåˆ¶å…³é—­è¯·æ±‚, ä¹‹åå°†å¤‡ç”¨çš„NameNodeè®¾ç½®ä¸ºActive.</p><p>å…ƒæ•°æ®ä¿¡æ¯åŒæ­¥åœ¨ HA æ–¹æ¡ˆä¸­é‡‡ç”¨çš„æ˜¯å…±äº«å­˜å‚¨, æ¯æ¬¡å†™æ–‡ä»¶æ—¶, éœ€è¦å°†æ—¥å¿—åŒæ­¥å†™å…¥å…±äº«å­˜å‚¨, è¿™ä¸ªæ­¥éª¤æˆåŠŸæ‰èƒ½è®¤å®šå†™æ–‡ä»¶æˆåŠŸ. ç„¶åå¤‡ä»½èŠ‚ç‚¹å®šæœŸä»å…±äº«å­˜å‚¨åŒæ­¥æ—¥å¿—, ä»¥ä¾¿è¿›è¡Œä¸»å¤‡åˆ‡æ¢. å…±äº«å­˜å‚¨é‡‡ç”¨çš„æ˜¯åŸºäºQJM(Quorum Journal Manager)çš„æ–¹æ¡ˆ, QJMå…±äº«å­˜å‚¨çš„åŸºæœ¬æ€æƒ³æ¥è‡ªäºPaxosç®—æ³•, é‡‡ç”¨å¤šä¸ªç§°ä¸ºJournalNodeçš„èŠ‚ç‚¹ç»„æˆçš„JournalNodeé›†ç¾¤æ¥å­˜å‚¨EditLog. æ¯ä¸ªJournalNodeä¿å­˜åŒæ ·çš„EditLogå‰¯æœ¬. æ¯æ¬¡NameNodeå†™EditLogçš„æ—¶å€™, é™¤äº†å‘æœ¬åœ°ç£ç›˜å†™å…¥EditLogä¹‹å¤–, ä¹Ÿä¼šå¹¶è¡Œåœ°å‘JournalNodeé›†ç¾¤ä¹‹ä¸­çš„æ¯ä¸€ä¸ªJournalNodeå‘é€å†™è¯·æ±‚, åªè¦å¤§å¤šæ•°çš„JournalNodeèŠ‚ç‚¹è¿”å›æˆåŠŸå°±è®¤ä¸ºå‘JournalNodeé›†ç¾¤å†™å…¥EditLogæˆåŠŸ. å¦‚æœæœ‰2N+1å°JournalNodeï¼Œé‚£ä¹ˆæ ¹æ®å¤§å¤šæ•°çš„åŸåˆ™, æœ€å¤šå¯ä»¥å®¹å¿æœ‰Nå°JournalNodeèŠ‚ç‚¹æŒ‚æ‰.</p><h3 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h3><h4 id="HDFSè¯»æµç¨‹">HDFSè¯»æµç¨‹</h4><ol><li>Clientå‘NameNodeå‘é€è¯»è¯·æ±‚</li><li>NameNodeæ”¶åˆ°è¯·æ±‚ä¹‹åä¼šæ£€æŸ¥ç”¨æˆ·æƒé™ä»¥åŠæ˜¯å¦æœ‰è¿™ä¸ªæ–‡ä»¶, å¦‚æœéƒ½ç¬¦åˆ, åˆ™ä¼šè§†æƒ…å†µè¿”å›éƒ¨åˆ†æˆ–å…¨éƒ¨çš„blockåˆ—è¡¨, å¯¹äºæ¯ä¸ªblock, NameNodeéƒ½ä¼šè¿”å›å«æœ‰è¯¥blockå‰¯æœ¬çš„DataNodeåœ°å€; è¿™äº›è¿”å›çš„DataNodeåœ°å€, ä¼šæŒ‰ç…§é›†ç¾¤æ‹“æ‰‘ç»“æ„å¾—å‡ºDataNodeä¸å®¢æˆ·ç«¯çš„è·ç¦», ç„¶åè¿›è¡Œæ’åº(è§„åˆ™: ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­è·ç¦»Clientè¿‘çš„æ’é å‰; å¿ƒè·³æœºåˆ¶ä¸­è¶…æ—¶æ±‡æŠ¥çš„DataNodeçŠ¶æ€ä¸ºSTALE, è¿™æ ·çš„æ’é å)</li><li>Clienté€‰å–æ’åºé å‰çš„DataNodeæ¥è¯»å–blockï¼Œå¦‚æœå®¢æˆ·ç«¯æœ¬èº«å°±æ˜¯DataNode,é‚£ä¹ˆå°†ä»æœ¬åœ°ç›´æ¥è·å–æ•°æ®(çŸ­è·¯è¯»å–ç‰¹æ€§)</li><li>å½“è¯»å®Œåˆ—è¡¨çš„blockå, è‹¥æ–‡ä»¶è¯»å–è¿˜æ²¡æœ‰ç»“æŸ, å®¢æˆ·ç«¯ä¼šç»§ç»­å‘NameNodeè·å–ä¸‹ä¸€æ‰¹çš„blockåˆ—è¡¨</li><li>è¯»å–å®Œä¸€ä¸ªblockéƒ½ä¼šè¿›è¡ŒchecksuméªŒè¯, å¦‚æœè¯»å–DataNodeæ—¶å‡ºç°é”™è¯¯, å®¢æˆ·ç«¯ä¼šé€šçŸ¥NameNode, ç„¶åå†ä»ä¸‹ä¸€ä¸ªæ‹¥æœ‰è¯¥blockå‰¯æœ¬çš„DataNodeç»§ç»­è¯»</li><li>æœ€ç»ˆè¯»å–æ¥æ‰€æœ‰çš„blockä¼šåˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„æœ€ç»ˆæ–‡ä»¶</li></ol><h4 id="NameNodeåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåšå“ªäº›æ“ä½œ">NameNodeåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåšå“ªäº›æ“ä½œ?</h4><p><strong>é¦–æ¬¡å¯åŠ¨NameNode</strong>:</p><ol><li>æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ, ç”Ÿæˆfsimageé•œåƒæ–‡ä»¶</li><li>å¯åŠ¨NameNode:</li></ol><ul><li>è¯»å–fsimageæ–‡ä»¶, å°†æ–‡ä»¶å†…å®¹åŠ è½½è¿›å†…å­˜</li><li>ç­‰å¾…DataNadeæ³¨å†Œä¸å‘é€block report</li></ul><ol start="3"><li>å¯åŠ¨DataNode:</li></ol><ul><li>å‘NameNodeæ³¨å†Œ</li><li>å‘é€block report</li><li>æ£€æŸ¥fsimageä¸­è®°å½•çš„å—çš„æ•°é‡å’Œblock reportä¸­çš„å—çš„æ€»æ•°æ˜¯å¦ç›¸åŒ</li></ul><ol start="4"><li>å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ“ä½œ(åˆ›å»ºç›®å½•/ä¸Šä¼ æ–‡ä»¶/åˆ é™¤æ–‡ä»¶ç­‰):</li></ol><ul><li>æ­¤æ—¶å†…å­˜ä¸­å·²ç»æœ‰æ–‡ä»¶ç³»ç»Ÿæ”¹å˜çš„ä¿¡æ¯, ä½†æ˜¯ç£ç›˜ä¸­æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿæ”¹å˜çš„ä¿¡æ¯, æ­¤æ—¶ä¼šå°†è¿™äº›æ”¹å˜ä¿¡æ¯å†™å…¥editsæ–‡ä»¶ä¸­, editsæ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®æ”¹å˜çš„ä¿¡æ¯</li></ul><p><strong>éé¦–æ¬¡å¯åŠ¨NameNode</strong>:</p><ol><li>è¯»å–fsimageå’Œeditsæ–‡ä»¶</li><li>å°†fsimageå’Œeditsæ–‡ä»¶åˆå¹¶æˆæ–°çš„fsimageæ–‡ä»¶</li><li>åˆ›å»ºæ–°çš„editsæ–‡ä»¶, å†…å®¹å¼€å§‹ä¸ºç©º</li><li>å¯åŠ¨DataNode</li></ol><h4 id="Secondary-NameNode-CheckpointNode-çš„å·¥ä½œæœºåˆ¶æ˜¯æ€æ ·çš„">Secondary NameNode(CheckpointNode)çš„å·¥ä½œæœºåˆ¶æ˜¯æ€æ ·çš„?</h4><ol><li>Secondary NameNodeè¯¢é—®NameNodeæ˜¯å¦éœ€è¦checkpoint</li><li>Secondary NameNodeè¯·æ±‚æ‰§è¡Œcheckpoint</li><li>NameNodeæ»šåŠ¨æ­£åœ¨å†™çš„editsæ—¥å¿—(å†™åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶)</li><li>å°†æ»šåŠ¨å‰çš„ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶æ‹·è´åˆ°Secondary NameNode</li><li>Secondary NameNodeåŠ è½½ç¼–è¾‘æ—¥å¿—å’Œé•œåƒæ–‡ä»¶åˆ°å†…å­˜, å¹¶åˆå¹¶</li><li>ç”Ÿæˆæ–°çš„é•œåƒæ–‡ä»¶fsimage.chkpoint</li><li>æ‹·è´fsimage.chkpointåˆ°NameNode</li><li>NameNodeå°†fsimage.chkpointé‡æ–°å‘½åæˆfsimage</li></ol><h4 id="åœ¨NameNode-HAä¸­ï¼Œä¼šå‡ºç°è„‘è£‚é—®é¢˜å—ï¼Ÿæ€ä¹ˆè§£å†³">åœ¨NameNode HAä¸­ï¼Œä¼šå‡ºç°è„‘è£‚é—®é¢˜å—ï¼Ÿæ€ä¹ˆè§£å†³?</h4><p>æœ‰å¯èƒ½ä¼šå‡ºç°è„‘è£‚, ä½†æ¦‚ç‡æ¯”è¾ƒå°. å‡è®¾NameNode1å½“å‰ActiveçŠ¶æ€, NameNode2å½“å‰ä¸ºStandbyçŠ¶æ€. å¦‚æœæŸä¸€æ—¶åˆ»NameNode1å¯¹åº”çš„ZKFailoverControllerè¿›ç¨‹å‘ç”Ÿäº†&quot;å‡æ­»&quot;ç°è±¡, é‚£ä¹ˆ ZookeeperæœåŠ¡ç«¯ä¼šè®¤ä¸ºNameNode1æŒ‚æ‰äº†, æ ¹æ®å‰é¢çš„ä¸»å¤‡åˆ‡æ¢é€»è¾‘, NameNode2ä¼šæ›¿ä»£NameNode1è¿›å…¥Active çŠ¶æ€. ä½†æ˜¯æ­¤æ—¶NameNode1å¯èƒ½ä»ç„¶å¤„äºActiveçŠ¶æ€æ­£å¸¸è¿è¡Œ, è¿™æ ·NameNode1å’ŒNameNode2éƒ½å¤„äºActiveçŠ¶æ€, éƒ½å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡, å³å‘ç”Ÿäº†è„‘è£‚.</p><p>ä¼šé‡‡ç”¨éš”ç¦»çš„è§£å†³æ–¹æ¡ˆ, å³æŠŠæ—§çš„ Active NameNode éš”ç¦»èµ·æ¥, ä½¿å®ƒä¸èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡:</p><ol><li>é¦–å…ˆå°è¯•è°ƒç”¨è¿™ä¸ªæ—§Active NameNodeçš„ HAServiceProtocol RPC æ¥å£çš„<code>transitionToStandby</code>æ–¹æ³•, çœ‹èƒ½ä¸èƒ½æŠŠå®ƒè½¬æ¢ä¸ºStandbyçŠ¶æ€</li><li>å¦‚æœ transitionToStandby æ–¹æ³•è°ƒç”¨å¤±è´¥, é‚£ä¹ˆå°±æ‰§è¡Œ Hadoop é…ç½®æ–‡ä»¶ä¹‹ä¸­é¢„å®šä¹‰çš„éš”ç¦»æªæ–½, Hadoop ç›®å‰ä¸»è¦æä¾›ä¸¤ç§éš”ç¦»æªæ–½ï¼Œé€šå¸¸ä¼šé€‰æ‹© <code>sshfence</code>:</li></ol><ul><li>sshfence: é€šè¿‡ SSH ç™»å½•åˆ°ç›®æ ‡æœºå™¨ä¸Š, æ‰§è¡Œå‘½ä»¤ fuser å°†å¯¹åº”çš„è¿›ç¨‹æ€æ­»</li><li>shellfence: æ‰§è¡Œä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„ shell è„šæœ¬æ¥å°†å¯¹åº”çš„è¿›ç¨‹éš”ç¦»</li></ul>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> paper reading </tag>
            
            <tag> HDFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GFS Paper Reading</title>
      <link href="/2024/08/01/2024-8-1-GFS/"/>
      <url>/2024/08/01/2024-8-1-GFS/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="GFS-Paper-Reading">GFS Paper Reading</h2><h3 id="æ¶æ„-Architecture">æ¶æ„(Architecture)</h3><p><img src="https://pb01.s3.bitiful.net/220.webp" alt="avatar"></p><p>GFSé‡‡ç”¨å•Masteræ¶æ„, ç”±masterå’Œchunkserverè¿™ä¸¤ç±»æœåŠ¡å™¨ç»„æˆ, masteræ˜¯ä¸»æ§èŠ‚ç‚¹, è€Œchunkserveræ˜¯å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹, å…¶å®å°±æ˜¯LinuxæœåŠ¡å™¨. GFSä½¿ç”¨Linuxä¸Šçš„æ–‡ä»¶ä½œä¸ºåŸºç¡€å­˜å‚¨å±‚, é€šè¿‡<strong>å‘½åç©ºé—´+æ–‡ä»¶å</strong>æ¥å®šä¹‰ä¸€ä¸ªæ–‡ä»¶. æ–‡ä»¶æŒ‰æ¯64Måˆ’åˆ†ä¸ºä¸€ä¸ªchunk, æ¯ä¸ªchunkéƒ½è‡ªå·±çš„å”¯ä¸€æ ‡è¯†(chunk handle). ä¸ºäº†ç¡®ä¿æ•°æ®ä¸ä¼šå› ä¸ºæŸä¸€ä¸ªchunkserveråäº†å°±ä¸¢å¤±äº†ï¼Œæ¯ä¸ªchunkéƒ½ä¼šæœ‰ä¸‰ä»½å‰¯æœ¬(replica). å…¶ä¸­ä¸€ä»½æ˜¯ä¸»å‰¯æœ¬(primary), ä¸¤ä»½æ˜¯æ¬¡å‰¯æœ¬(secondary), å½“ä¸‰ä»½å‰¯æœ¬å‡ºç°ä¸ä¸€è‡´çš„æ—¶å€™, å°±ä»¥ä¸»å‰¯æœ¬ä¸ºå‡†. æœ‰äº†ä¸‰ä¸ªå‰¯æœ¬ï¼Œä¸ä»…å¯ä»¥é˜²æ­¢å› ä¸ºå„ç§åŸå› ä¸¢æ•°æ®, è¿˜å¯ä»¥åœ¨æœ‰å¾ˆå¤šå¹¶å‘è¯»å–çš„æ—¶å€™, åˆ†æ‘Šç³»ç»Ÿè¯»å–çš„å‹åŠ›</p><p>Masterä¼šå­˜æ”¾ä¸‰ç§å…ƒæ•°æ®: æ–‡ä»¶å’Œchunkçš„å‘½åç©ºé—´ä¿¡æ¯, æ–‡ä»¶åå’Œchunk handleçš„æ˜ å°„å…³ç³»(æ–‡ä»¶è¢«æ‹†åˆ†æˆäº†å“ªå‡ ä¸ªchunk), chunk handleå’Œchunkserverçš„æ˜ å°„å…³ç³»(chunkè¢«å­˜å‚¨åœ¨å“ªä¸ªchunkserverä¸­).</p><p>å®¢æˆ·ç«¯æƒ³è¦è¯»å–GFSä¸­çš„æ–‡ä»¶çš„æ­¥éª¤:</p><ol><li>å®¢æˆ·ç«¯å…ˆå»é—® masterï¼Œæˆ‘ä»¬æƒ³è¦è¯»å–çš„æ•°æ®åœ¨å“ªé‡Œã€‚è¿™é‡Œï¼Œå®¢æˆ·ç«¯ä¼šå‘å‡ºä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶åï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯chunk index, å› ä¸ºå®¢æˆ·ç«¯çŸ¥é“è‡ªå·±æ‰€è¦è¯»å–çš„æ•°æ®çš„åç§»é‡(offset)å’Œé•¿åº¦, å®ƒå¯ä»¥ç®—å‡ºéœ€è¦çš„æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å“ªå‡ ä¸ªchunk</li><li>master æ‹¿åˆ°äº†è¿™ä¸ªè¯·æ±‚ä¹‹åï¼Œå°±ä¼šæŠŠè¿™äº›chunkçš„chunk handleå’Œå¯¹åº”çš„æ‰€æœ‰å‰¯æœ¬æ‰€åœ¨çš„ä½ç½®ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯å‘é€chunk handleå’Œbyte rangeå‘å¯¹åº”çš„chunkserver(é€šå¸¸æ˜¯ç¦»å¾—æœ€è¿‘çš„chunkserver)è¯·æ±‚è¯»å–æ•°æ®</li><li>chunkserverè¯»å–æ•°æ®å¹¶è¿”å›ç»™å®¢æˆ·ç«¯</li></ol><p>çœ‹å®Œä¸Šé¢ä½ å¯èƒ½ä¼šè§‰å¾—GFSçš„è®¾è®¡ååˆ†ç®€å•, ç¡®å®å¦‚æ­¤, é‚£ä¹ˆä»£ä»·æ˜¯ä»€ä¹ˆå‘¢? ä»£ä»·å°±æ˜¯masterçš„å‹åŠ›ä¼šå¾ˆå¤§, masteréœ€è¦æ‰¿å—æ•°ç™¾å°å®¢æˆ·ç«¯çš„å¹¶å‘è®¿é—®, äºæ˜¯Googleå†³å®šå°†masterä¸­çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­, ä»¥æé«˜æ€§èƒ½. masterä¸­å­˜å‚¨çš„ä¿¡æ¯æ˜¯éæŒä¹…åŒ–çš„, å®ƒä¼šé€šè¿‡å‘¨æœŸçš„å¿ƒè·³æ£€æµ‹ä¿è¯å­˜å‚¨çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯.</p><h3 id="å¯ç”¨æ€§ä¿éšœ-Availability-assurance">å¯ç”¨æ€§ä¿éšœ(Availability assurance)</h3><p>masterèŠ‚ç‚¹å¦‚æœæŒ‚æ‰äº†æ€ä¹ˆåŠå‘¢? é¦–å…ˆè®¾è®¡äº†å¯æ¢å¤æœºåˆ¶, GFSåœ¨æ—¥å¿—å¢é•¿è¶…è¿‡ä¸€å®šçš„å¤§å°çš„æ—¶å€™ä¼šå¯¹å¯¹å½“å‰çŠ¶æ€è®¾ç½®ä¸€ä¸ªcheckpoint, ç„¶åä¼šæŠŠæ—¥å¿—å’Œcheckpointå­˜å‚¨åœ¨ç£ç›˜ä¸Š, å½“masteræŒ‚æ‰ä¹‹å, å¯ä»¥ä»checkpointå’Œæ—¥å¿—ä¸­æ¢å¤çŠ¶æ€, checkpointçš„ç›®çš„ç¼©çŸ­æ¢å¤çš„æ—¶é—´, å›åˆ°ä¸€ä¸ªè¾ƒæ–°çš„çŠ¶æ€å†æ ¹æ®æ“ä½œæ—¥å¿—æ¢å¤æ¯”ä»å¤´æ ¹æ®æ—¥å¿—æ¢å¤è¦å¿«å¾—å¤š.</p><p>é‚£å¦‚æœç¡¬ä»¶å‡ºé—®é¢˜, masteræ— æ³•æ¢å¤æ€ä¹ˆåŠå‘¢? GFSä¸ºmasterå‡†å¤‡äº†å‡ ä¸ªå¤‡èƒ, å³backup master, master çš„æ‰€æœ‰ä¿®æ”¹, éƒ½éœ€è¦åŒæ ·å†™åˆ°backup masterä¸Š. åªæœ‰å½“æ•°æ®åœ¨ masterä¸Šæ“ä½œæˆåŠŸ, å¯¹åº”çš„æ“ä½œè®°å½•æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Š, å¹¶ä¸”backup Masterçš„æ•°æ®ä¹Ÿå†™å…¥æˆåŠŸ, å¹¶æŠŠæ“ä½œè®°å½•æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Š, æ•´ä¸ªæ“ä½œæ‰ä¼šè¢«è§†ä¸ºæ“ä½œæˆåŠŸ, è¿™å°±æ˜¯åŒæ­¥å¤åˆ¶. å¦‚æœè¦åˆ‡æ¢master, ä¸ºäº†å®ç°æ— æ„Ÿçš„åˆ‡æ¢, GFSé€šè¿‡ä¸€ä¸ªè§„èŒƒåç§°(Canonical Name)æ¥æŒ‡å®šmasterï¼Œè€Œä¸æ˜¯é€šè¿‡IPåœ°å€æˆ–è€…Macåœ°å€. è¿™æ ·, åªéœ€è¦ä¿®æ”¹DNSçš„åˆ«å, å°±èƒ½è¾¾åˆ°ç›®çš„.</p><p>åœ¨æ¢å¤masterçš„ç­‰å¾…æ—¶é—´å†…, å°±ä¸èƒ½æä¾›ä»»ä½•æœåŠ¡äº†å—? å¯¹äºå†™å…¥æœåŠ¡, ç¡®å®å¦‚æ­¤, ä½†å¯¹äºè¯»å–æœåŠ¡, GFSæä¾›äº†åªè¯»çš„shadow master(å¼‚æ­¥å¤åˆ¶). shadow masterä¸­çš„æ•°æ®ä¸ä¸€å®šå’Œmasterä»¥åŠbackup masterå®Œå…¨ä¸€è‡´, å› ä¸ºæ•°æ®åœ¨masterå’Œbackup masterä¸Šå†™å…¥å®Œæˆå°±ç®—çœŸæ­£æˆåŠŸäº†, shadow masterçš„æ•°æ®å¯èƒ½è¿˜æ²¡æœ‰æ›´æ–°, ä½†å®ƒä¼šå°½é‡ä¸masterä¿æŒä¸€è‡´. æƒ³è¦è¯»åˆ°æœ‰é—®é¢˜çš„æ•°æ®çš„æ¦‚ç‡æ˜¯ä¸å¤§çš„, éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶: 1. masteræŒ‚äº† 2. masterçš„æ—¥å¿—è¿˜æ²¡æœ‰åŒæ­¥åˆ°backup master 3. è¦è¯»çš„æ•°æ®æ°å¥½æ˜¯è¿˜æ²¡æœ‰æ›´æ–°çš„é‚£éƒ¨åˆ†</p><h3 id="äº¤äº’">äº¤äº’</h3><p>ç”±äºmasterçš„æ€§èƒ½ç“¶é¢ˆ, æˆ‘ä»¬éœ€è¦å°½é‡å‡å°‘å…¶ä»–èŠ‚ç‚¹(client,chunkserver)å’Œmasterä¹‹é—´çš„äº¤äº’, äºæ˜¯è®¾è®¡äº†ç§Ÿçº¦å’Œæ•°æ®æµä¸æ§åˆ¶æµåˆ†ç¦». ç§Ÿçº¦æ˜¯masterå¯¹primary replica(ä¸»å‰¯æœ¬)å¯¹å˜æ›´é¡ºåºçš„æˆæƒ, å› ä¸ºæˆ‘ä»¬éœ€è¦å†™å…¥ä¸‰ä»½. ä¸€ä¸ªå†™å…¥æµç¨‹å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/221.webp" alt="avatar"></p><p>å…·ä½“æµç¨‹å¦‚ä¸‹:</p><ol><li>å®¢æˆ·ç«¯ä¼šè¯·æ±‚masterå“ªä¸€ä¸ªchunkserveræŒæœ‰å½“å‰çš„ç§Ÿçº¦, ä»¥åŠå…¶ä»–çš„å‰¯æœ¬ä½ç½®. å¦‚æœæ²¡æœ‰å‰¯æœ¬æŒæœ‰ç§Ÿçº¦, masterä¼šé€‰ä¸€ä¸ªå‰¯æœ¬æˆæƒç§Ÿçº¦ç»™å®ƒ. å®¢æˆ·ç«¯åœ¨è¯¢é—®masteræ•°æ®åº”è¯¥å†™åˆ°å“ªé‡Œ</li><li>masterä¼šè¿”å›ç»™å®¢æˆ·ç«¯æ‰€æœ‰ä¸»å‰¯æœ¬å’Œæ¬¡å‰¯æœ¬çš„ç›¸å…³ä¿¡æ¯</li><li>å®¢æˆ·ç«¯ä¼šæŠŠè¦å†™çš„æ•°æ®å‘ç»™æ‰€æœ‰çš„å‰¯æœ¬. ä¸è¿‡æ­¤æ—¶, chunkserveræ‹¿åˆ°å‘è¿‡æ¥çš„æ•°æ®åè¿˜ä¸ä¼šçœŸçš„å†™ä¸‹æ¥, åªä¼šæŠŠæ•°æ®æ”¾åœ¨ä¸€ä¸ªLRU(Least Recently Used)çš„ç¼“å†²åŒºé‡Œ</li><li>ä¸€æ—¦å‰¯æœ¬ç¡®è®¤æ”¶åˆ°äº†æ•°æ®, å®¢æˆ·ç«¯ä¼šå‘ä¸€ä¸ªå†™è¯·æ±‚ç»™ä¸»å‰¯æœ¬. è¯¥è¯·æ±‚æ ‡è¯†äº†ä¹‹å‰æ¨é€ç»™æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®. ç„¶åä¸»å‰¯æœ¬ä¼šåˆ†é…ä¸€ä¸ªè¿ç»­çš„åºåˆ—å·ç»™æ‰€æœ‰å®ƒæ¥å—åˆ°çš„å˜æ›´(å¯èƒ½æ¥è‡ªäºå¤šä¸ªclient). ç„¶åä¸»å‰¯æœ¬ä¼šå°†æŒ‰ç…§å‰é¢çš„åºåˆ—å·å°†å˜æ›´åº”ç”¨åˆ°æœ¬åœ°çš„å‰¯æœ¬ä¸Š</li><li>ä¸»å‰¯æœ¬ä¼šæŠŠå¯¹åº”çš„å†™è¯·æ±‚è½¬å‘ç»™æ‰€æœ‰çš„æ¬¡å‰¯æœ¬, æ‰€æœ‰æ¬¡å‰¯æœ¬ä¼šå’Œä¸»å‰¯æœ¬ä»¥åŒæ ·çš„æ•°æ®å†™å…¥é¡ºåº, æŠŠæ•°æ®å†™å…¥åˆ°ç¡¬ç›˜ä¸Š</li><li>ç­‰å…¶ä»–å‰¯æœ¬éƒ½å†™å…¥å®Œæˆäº†, ä¼šè¿”å›ç»™ä¸»å‰¯æœ¬æ“ä½œå®Œæˆ</li><li>ä¸»å‰¯æœ¬ä¼šå“åº”ç»™å®¢æˆ·ç«¯. ä»»ä½•å‰¯æœ¬ç¢°åˆ°çš„é”™è¯¯ä¿¡æ¯éƒ½ä¼šè¿”å›ç»™client. å‡ºç°é”™è¯¯æ—¶, å†™æ“ä½œå¯èƒ½å·²ç»åœ¨ä¸»å‰¯æœ¬ä»¥åŠéƒ¨åˆ†å‰¯æœ¬ä¸Šæ‰§è¡ŒæˆåŠŸäº†(å¦‚æœæ˜¯ä¸»å‰¯æœ¬å¤±è´¥äº†ï¼Œå°±ä¸ä¼šæœ‰å˜æ›´çš„åºåˆ—å·åˆ†é…ç»™å…¶ä»–çš„å‰¯æœ¬ä¹Ÿå°±æ˜¯ä¸ä¼šæœ‰åé¢çš„æ“ä½œäº†). å¦‚æœé‡åˆ°é”™è¯¯, é‚£ä¹ˆå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„, ä¿®æ”¹çš„regionè®¤ä¸ºæ˜¯å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€. æˆ‘ä»¬å®¢æˆ·ç«¯çš„ä»£ç ä»£ç ä¼šé€šè¿‡é‡è¯•è¿™äº›å˜æ›´æ¥å¤„ç†è¿™æ ·çš„é”™è¯¯. å®ƒä¼šå…ˆåœ¨3-7æ­¥éª¤è¿›è¡Œä¸€äº›å°è¯•åå†ä»å¤´é‡è¯•å†™æ“ä½œ.</li></ol><p>æ§åˆ¶æµå’Œæ•°æ®æµçš„åˆ†ç¦»ä½¿å¾—å®é™…çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹å’Œæä¾›å†™å…¥æŒ‡ä»¤çš„åŠ¨ä½œæ˜¯å®Œå…¨åˆ†ç¦»çš„. å®¢æˆ·ç«¯ä¼šå°†æ•°æ®æ¨é€åˆ°æœ€è¿‘çš„chunkserver, ç„¶åè¿™ä¸ªchunkserverå†æ¨é€åˆ°æœ€è¿‘çš„å¦ä¸€ä¸ªchunkserver, ä¾æ¬¡ç±»æ¨, å®ç°é“¾å¼çš„æ•°æ®æ¨é€, ä¸é‡‡ç”¨å®¢æˆ·ç«¯æ¨é€ç»™å…¨éƒ¨chunkserverçš„åšæ³•å……åˆ†åˆ©ç”¨äº†æ¯å°æœºå™¨çš„å¸¦å®½, å¹¶ä¸”æœ‰æ•ˆé™ä½äº†å»¶è¿Ÿ</p><p>GFSè¿˜ä¸ºæ–‡ä»¶å¤åˆ¶è®¾è®¡äº†ä¸€ä¸ªSnapshotæŒ‡ä»¤, è¿™ä¸ªæŒ‡ä»¤ä¼šé€šè¿‡æ§åˆ¶æµ, ä¸‹è¾¾åˆ°ä¸»å‰¯æœ¬æœåŠ¡å™¨, ä¸»å‰¯æœ¬æœåŠ¡å™¨å†æŠŠè¿™ä¸ªæŒ‡ä»¤ä¸‹è¾¾åˆ°æ¬¡å‰¯æœ¬æœåŠ¡å™¨, å„ä¸ªchunkserverä¼šå°†æœ¬åœ°çš„å¯¹åº”çš„chunkå¤åˆ¶ä¸€ä»½, ä¸éœ€è¦ä¼ è¾“æ•°æ®. å¦‚æœæ²¡æœ‰è¿™ä¸ªæŒ‡ä»¤, å®¢æˆ·ç«¯éœ€è¦å°†æ–‡ä»¶ä»chunkserverè¯»å–å›æ¥, å†å†™å…¥åˆ°chunkserverä¸­å», è¿™æå¤§åœ°èŠ‚çœäº†æ—¶é—´å’Œç½‘ç»œèµ„æº.</p><h3 id="ä¸€è‡´æ€§-Consistency">ä¸€è‡´æ€§(Consistency)</h3><p>æ–‡ä»¶çš„namespaceçš„å˜æ›´æ˜¯åŸå­æ€§çš„. ä»–ä»¬åªè¢«masterå¤„ç†: å‘½åç©ºé—´é”ä¿è¯äº†åŸå­æ€§å’Œå‡†ç¡®æ€§; masterçš„æ“ä½œæ—¥å¿—å®šä¹‰äº†å…¨å±€å…¨éƒ¨æ“ä½œçš„é¡ºåº.</p><p><img src="https://pb01.s3.bitiful.net/222.webp" alt="avatar"></p><ul><li>å¦‚æœæ•°æ®å†™å…¥å¤±è´¥, GFSé‡Œçš„æ•°æ®å°±æ˜¯ä¸ä¸€è‡´çš„.</li><li>å¦‚æœå®¢æˆ·ç«¯çš„æ•°æ®å†™å…¥æ˜¯é¡ºåºçš„, å¹¶ä¸”å†™å…¥æˆåŠŸäº†, é‚£ä¹ˆæ–‡ä»¶é‡Œé¢çš„å†…å®¹å°±æ˜¯ç¡®å®šçš„(Defined, å³å®¢æˆ·ç«¯å†™å…¥GFSçš„æ•°æ®èƒ½å¤Ÿå®Œæ•´çš„è¢«è¯»å–).</li><li>å¦‚æœç”±å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘å†™å…¥æ•°æ®ï¼Œå³ä½¿å†™å…¥æˆåŠŸäº†, GFS é‡Œçš„æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¿›å…¥ä¸€ä¸ªä¸€è‡´(æ— è®ºä»å“ªä¸ªå‰¯æœ¬è¯»çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„)ä½†æ˜¯éç¡®å®šçš„çŠ¶æ€.</li></ul><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ç¬¬ä¸‰ç§æƒ…å†µå‘¢? ä¸»è¦åŸå› æœ‰ä¸¤ç‚¹: ä¸€æ˜¯æ•°æ®å†™å…¥çš„é¡ºåºæ˜¯ç”±ä¸»å‰¯æœ¬æ¥ç®¡ç†çš„, å¹¶ä¸éœ€è¦é€šè¿‡master; äºŒæ˜¯æ•°æ®çš„å†™å…¥å¾€å¾€è¦è·¨è¶Šå¤šä¸ªchunk. æ¯”å¦‚è¯´é’ˆå¯¹ç›¸åŒçš„æ•°æ®å†™, å…ˆå‰çš„å˜æ›´ä¼šè¢«æ–°çš„å˜æ›´æ‰€è¦†ç›–, è¿™æ ·ä¼šå¯¼è‡´è¯»å–åˆ°ä¸¤æ¬¡å˜æ›´ç»„åˆåçš„ç»“æœ. æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°½é‡é¿å…éšæœºçš„æ•°æ®å†™å…¥, å¯ä»¥ä»å®¢æˆ·ç«¯å…¥æ‰‹æ¥ä¿è¯å†™å…¥çš„é¡ºåºæ€§.</p><p>å¦‚æœè¯´è®©å®¢æˆ·ç«¯ä¿è¯å†™å…¥çš„é¡ºåºæ€§, é‚£GFSæ”¯æŒå¹¶å‘è¯»å†™ä¸å°±æ˜¯ä¸€ä¸ªç¬‘è¯å—? è¿™æ˜¯æ˜¯å› ä¸ºéšæœºå†™å…¥å¹¶ä¸æ˜¯GFSè®¾è®¡çš„ä¸»è¦çš„æ•°æ®å†™å…¥æ¨¡å¼, GFSè®¾è®¡äº†è®°å½•è¿½åŠ (Record Appends), è¿™æ˜¯ GFS å¸Œæœ›æˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ•°æ®å†™å…¥çš„æ–¹å¼, ç”±è¦†ç›–å†™æ”¹ä¸ºäº†è¿½åŠ å†™, ç‰ºç‰²ä¸€éƒ¨åˆ†å­˜å‚¨ç©ºé—´æ¥ä¿è¯ä¸€è‡´æ€§.</p><p>è®°å½•è¿½åŠ é¦–å…ˆä¼šæ£€æŸ¥å½“å‰çš„chunkæ˜¯ä¸æ˜¯å¯ä»¥å†™å¾—ä¸‹ç°åœ¨è¦è¿½åŠ çš„è®°å½•. å¦‚æœå½“å‰chunkå·²ç»å†™ä¸ä¸‹äº†, é‚£ä¹ˆå®ƒå…ˆä¼šæŠŠå½“å‰chunkå¡«æ»¡ç©ºæ•°æ®å, ä¸»å‰¯æœ¬ä¼šå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œè®©å®ƒå»ä¸‹ä¸€ä¸ªchunkç»§ç»­è¿½åŠ . è¿½åŠ çš„è®°å½•å¤§å°éœ€è¦æ§åˆ¶åœ¨trunkæœ€å¤§å€¼çš„å››åˆ†ä¹‹ä¸€ä»¥å†…ï¼Œä»¥ä¿è¯æœ€åæƒ…å†µä¸‹çš„ç¢ç‰‡åœ¨ä¸€ä¸ªå¯ä»¥è¢«æ¥å—çš„ç­‰çº§, å³æœ€åä¸€ä¸ªchunkä¼šç•™å‡ºæœ€å¤šå››åˆ†ä¹‹ä¸€çš„ç©ºé—´æ¥ä¸ºäº†ä¹‹åçš„è®°å½•è¿½åŠ , å››åˆ†ä¹‹ä¸€æ˜¯åœ¨é«˜æ•ˆçš„è¿½åŠ å’Œç©ºé—´æµªè´¹ç›´é—´çš„æƒè¡¡.</p><p>å¦‚æœåœ¨ä¸»å‰¯æœ¬ä¸Šå†™å…¥æˆåŠŸäº†, ä½†æ˜¯åœ¨æ¬¡å‰¯æœ¬ä¸Šå†™å…¥å¤±è´¥äº†æ€ä¹ˆåŠå‘¢? è¿™æ ·ä¸æ˜¯è¿˜ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå—? åœ¨å‰é¢æˆ‘ä»¬æåˆ°å‡ºç°è¿™ç§ä¼šè®©å®¢æˆ·ç«¯é‡è¯•, å³ä½¿åœ¨æœ‰äº›å‰¯æœ¬ä¸ŠåŒæ ·çš„å†…å®¹å†™å…¥äº†å¤šæ¬¡, ä½†æˆ‘ä»¬ä¿è¯äº†æ•°æ®è‡³å°‘è¢«å†™å…¥äº†ä¸€æ¬¡, æ‰€ä»¥æ•°æ®ä¸ä¼šä¸¢å¤±. å¯¹äºGoogleçš„ä½¿ç”¨åœºæ™¯æ¥è¯´, åŒæ ·çš„ç½‘é¡µè¢«å­˜å‚¨äº†ä¸¤æ¬¡å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜, å¯ä»¥åœ¨æ’åºåè¿›è¡Œå»é‡<br>. è¿™ä¸ªè‡³å°‘ä¸€æ¬¡çš„æœºåˆ¶è™½ç„¶ç‰ºç‰²äº†ä¸€å®šçš„<strong>å¯ç”¨æ€§</strong>, ä½†ä¿è¯äº†<strong>é«˜å¹¶å‘å’Œé«˜æ€§èƒ½</strong></p>]]></content>
      
      
      <categories>
          
          <category> big data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> paper reading </tag>
            
            <tag> GFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åº”ç”¨å¯†ç å­¦ä¸ç½‘ç»œå®‰å…¨å®éªŒé€šå…³æŒ‡å—</title>
      <link href="/2024/06/26/2024-6-26-%E5%BA%94%E7%94%A8%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
      <url>/2024/06/26/2024-6-26-%E5%BA%94%E7%94%A8%E5%AF%86%E7%A0%81%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åº”ç”¨å¯†ç å­¦ä¸ç½‘ç»œå®‰å…¨å®éªŒé€šå…³æŒ‡å—">åº”ç”¨å¯†ç å­¦ä¸ç½‘ç»œå®‰å…¨å®éªŒé€šå…³æŒ‡å—</h2><p>è¿™æ˜¯è®¡ç§‘ç½‘ç»œæ–¹å‘åº”ç”¨å¯†ç å­¦ä¸ç½‘ç»œå®‰å…¨çš„éšè¯¾å®éªŒ, å è¯¾ç¨‹åˆ†æ•°çš„20%. ç¬¬ä¸€æ¬¡ä¸»è¦æ˜¯ä»‹ç»å†…å®¹, ä¸¤å‘¨åçš„ç¬¬äºŒæ¬¡å®éªŒä¸»è¦æ˜¯éªŒæ”¶, å®éªŒå†…å®¹è‡ªå·±çº¿ä¸‹å®Œæˆå³å¯.</p><p>å®éªŒå†…å®¹å¦‚ä¸‹:</p><ol><li>å¯†ç å­¦åŠåº”ç”¨ï¼šç†Ÿæ‚‰äº‘å®‰å…¨å®éªŒå¹³å°åŠç¯å¢ƒï¼Œå®Œæˆï¼š<br>å®éªŒ1ï¼ˆå¤å…¸å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ ä¸€Caesarå¯†ç ï¼Œ<br>å®éªŒ1ï¼ˆå¤å…¸å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ äºŒå•è¡¨ç½®æ¢å¯†ç ï¼Œ<br>å®éªŒ1ï¼ˆå¤å…¸å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ ä¸‰ä»¿å°„å¯†ç </li><li>å¯†ç å­¦åŠåº”ç”¨ï¼š<br>å®éªŒ2ï¼ˆå¯¹ç§°å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ ä¸€DESï¼Œ<br>å®éªŒ2ï¼ˆå¯¹ç§°å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ äºŒAES</li><li>å¯†ç å­¦åŠåº”ç”¨ï¼š<br>å®éªŒ3ï¼ˆéå¯¹ç§°å¯†ç ç®—æ³•ï¼‰â€•â€•&gt;ç»ƒä¹ ä¸€RSAï¼Œ<br>å®éªŒ4ï¼ˆ Hashç®—æ³•ï¼‰   â€•â€•&gt;ç»ƒä¹ ä¸€MD5</li><li>å¯†ç å­¦åŠåº”ç”¨ï¼š<br>å®éªŒ5ï¼ˆå¯†ç åº”ç”¨ï¼‰â€•â€•&gt;ç»ƒä¹ ä¸€æ–‡ä»¶å®‰å…¨ä¼ è¾“</li></ol><p>è¿™ä¸ªå®éªŒçš„ç›®çš„æ˜¯ä¸ºäº†è€ƒå¯Ÿå¯¹äºå„ä¸ªåŠ å¯†ç®—æ³•çš„æµç¨‹çš„ç†è§£å’ŒæŒæ¡, å¹¶ä¸æ˜¯è¦è®©ä½ çœŸçš„æ‰‹æ“è¿™äº›ç®—æ³•(å½“ç„¶èƒ½æ‰‹æ“ä¹Ÿæ˜¯ä¸€ç§èƒ½åŠ›). æœ€åéªŒæ”¶åªè¦å°†ç»“æœå±•ç¤ºå‡ºæ¥å¹¶ä¸”èƒ½è§£é‡Šæ¸…æ¥š(éœ€è¦å®Œæ•´è®²è¿°ç®—æ³•æµç¨‹, ä¸»è¦éªŒæ”¶DES, AES, RSA, MD5, ä»¥åŠæ–‡ä»¶å®‰å…¨ä¼ è¾“)</p><h3 id="DES">DES</h3><p>DES ç®—æ³•æ˜¯åœ¨ Feistel network çš„åŸºç¡€ä¸Šæ‰§è¡Œçš„.ä»¥ä¸‹æ˜¯ DES ç®—æ³•çš„æµç¨‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/211.webp" alt="avatar"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°DESç®—æ³•å¯ä»¥åˆ†ä¸ºå·¦å³ä¸¤ä¸ªéƒ¨åˆ†, å·¦åŠéƒ¨åˆ†ä¸ºè¿­ä»£åŠ å¯†, å³åŠéƒ¨åˆ†ä¸ºå­å¯†é’¥ç”Ÿæˆ.</p><p><strong>å­å¯†é’¥ç”Ÿæˆ</strong></p><p>æˆ‘ä»¬è¦ä»åˆå§‹çš„64ä½çš„ç§˜é’¥ä¸­ç”Ÿæˆ16ä¸ª48ä½çš„å­å¯†é’¥(Sub-key), å¤§è‡´æ­¥éª¤å¦‚ä¸‹:</p><ol><li>åˆå§‹ç§˜é’¥ç»è¿‡PC-1ç½®æ¢, å¾—åˆ°56ä½çš„åˆå§‹ç§˜é’¥, å‰©ä½™çš„8ä½åšæ ¡éªŒä½</li><li>å°†56ä½çš„åˆå§‹ç§˜é’¥åˆ†æˆå·¦å³ä¸¤éƒ¨åˆ†, åˆ†åˆ«è®°ä¸ºC<sub>i</sub>, D<sub>i</sub></li><li>å°†å·¦å³ä¸¤éƒ¨åˆ†åˆ†åˆ«å¾ªç¯å·¦ç§»1~2ä½, å³å¯å¾—åˆ°C<sub>i+1</sub>, D<sub>i+1</sub>, å½“i=1,2,9,16æ—¶å·¦ç§»1ä½ï¼Œå…¶å®ƒå·¦ç§»2ä½ã€‚</li><li>å°†C<sub>i+1</sub>, D<sub>i+1</sub>åˆ†åˆ«ç»è¿‡PC-2ç½®æ¢, åˆå¹¶åˆ°ä¸€èµ·å°±å¾—åˆ°äº†48ä½çš„å­å¯†é’¥</li><li>å¦‚æ­¤æ€»å…±è¿›è¡Œ16è½®, å°±å¾—åˆ°äº†16ä¸ª48ä½çš„å­å¯†é’¥</li></ol><p><strong>è¿­ä»£åŠ å¯†</strong></p><p>è¿­ä»£åŠ å¯†éƒ¨åˆ†, ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤:</p><ol><li>åˆå§‹æ˜æ–‡ç»è¿‡IPç½®æ¢, å°†å…¶åˆ†ä¸ºå·¦å³ä¸¤åŠéƒ¨åˆ†åˆ†åˆ«ä¸ºLå’ŒR</li><li>æ¯ä¸€è½®è¿­ä»£ï¼Œéƒ½æ˜¯æ¥æ”¶ä¸€ç»„ L, Rï¼Œè¿”å› Lâ€™, Râ€™ ï¼Œä½œä¸ºä¸‹ä¸€è½®è¿­ä»£çš„ L, R . è¿­ä»£è¿‡ç¨‹å¦‚ä¸‹ï¼šå…¶ä¸­Få‡½æ•°ï¼ˆç§°ä¸ºè½®å‡½æ•°ï¼‰æ˜¯æ•´ä¸ªç®—æ³•çš„æ ¸å¿ƒï¼ŒåŠŸèƒ½æ˜¯ï¼šä»¥ä¸€ä¸ªå­å¯†é’¥ï¼ŒåŠ å¯† 32-bit çš„ä¿¡æ¯ã€‚<br><img src="https://pb01.s3.bitiful.net/212.webp" alt="avatar"></li><li>åˆ©ç”¨ä¹‹å‰å¾—åˆ°çš„ 16 ä¸ªå­å¯†é’¥ï¼Œæ‰§è¡Œæ­¥éª¤ 2 ä¸€å…± 16 æ¬¡</li><li>å°†æœ€ç»ˆçš„ R ä¸ L æ‹¼æ¥ï¼Œå†åšä¸€æ¬¡FPç½®æ¢(IPç½®æ¢çš„é€†å˜æ¢)ï¼Œå³å¾—åˆ°å¯†æ–‡</li></ol><p><strong>è½®å‡½æ•°</strong></p><ol><li>å¯¹32ä½çš„è¾“å…¥è¿›è¡ŒEæ‰©å±•, å˜ä¸ºä¸º48ä½çš„æ‰©å±•è¾“å‡º</li><li>æ‰©å±•è¾“å‡ºä¸å­å¯†é’¥è¿›è¡Œå¼‚æˆ–è¿ç®—</li><li>æ‰©å±•è¾“å‡ºç»è¿‡Sç›’ç½®æ¢, å¾—åˆ°32ä½çš„è¾“å‡º</li><li>Pç½®æ¢, å¾—åˆ°28ä½çš„è¾“å‡º</li></ol><h3 id="AES">AES</h3><p>AESç®—æ³•çš„æµç¨‹å›¾:<br><img src="https://pb01.s3.bitiful.net/213.webp" alt="avatar"></p><p>æ¯ä¸€è½®è¿­ä»£éƒ½æ˜¯å­—èŠ‚æ›¿æ¢, è¡Œç§»ä½, åˆ—æ··æ·†, è½®ç§˜é’¥åŠ è¿™å››ä¸ªæ­¥éª¤. ä»¥128ä½ç§˜é’¥ä¸ºä¾‹, N=10, éœ€è¦N+1(11)ä¸ªè½®ç§˜é’¥, ä¸­é—´å¾ªç¯è¿­ä»£N-1(9)è½®, ä¹Ÿå¯ä»¥è¯´è¿­ä»£Nè½®, æœ€åä¸€è½®ä¸è¿›è¡Œåˆ—æ··æ·†</p><p>å…³äºå­—èŠ‚æ›¿æ¢, è¡Œç§»ä½, åˆ—æ··æ·†çš„å…·ä½“ç»†èŠ‚å¯ä»¥å»çœ‹PPT, åœ¨éªŒæ”¶æ—¶ä¸è¦æ±‚èƒ½è¯¦ç»†è¯´å‡ºæ¥.</p><p><strong>ç§˜é’¥æ‰©å±•</strong></p><p>AESåŠ å¯†å¯ä»¥é‡‡ç”¨ä¸åŒé•¿åº¦çš„ç§˜é’¥, ä¸€èˆ¬ä¸º128ä½, 192ä½, 256ä½, åˆ†åˆ«å¯¹åº”10è½®, 12è½®, 14è½®. ç§˜é’¥æ‰©å±•çš„æ­¥éª¤å¦‚ä¸‹(ä»¥128ä½ç§˜é’¥ä¸ºä¾‹):</p><ol><li>æ‰©å±•å¯†é’¥çš„å‰å››ä¸ªå­—ç›´æ¥ç”±è¾“å…¥å¯†é’¥ä¸­å¤åˆ¶ï¼Œå³w[0]~w[3], w[i]çš„å€¼ç­‰äºw[i-1]å¼‚æˆ–w[i-4] (i&gt;=4,iä¸æ˜¯4çš„å€æ•°)</li><li>å¯¹äºä¸‹æ ‡ä¸º4çš„å€æ•°çš„å¯†é’¥å­—ï¼Œå…¶äº§ç”Ÿæ–¹æ³•æ›´ä¸ºå¤æ‚ï¼Œè¡¨ç¤ºä¸ºå‡½æ•°g(w[i-1]). åŒ…æ‹¬çš„è¿ç®—æ­¥éª¤æœ‰ï¼šå­—å¾ªç¯(RotWord)ï¼šä½¿ä¸€ä¸ªå­—ä¸­çš„4ä¸ªå­—èŠ‚å¾ªç¯å·¦ç§»ä¸€ä¸ªå­—èŠ‚; å­—èŠ‚ä»£æ¢(SubWord)ï¼šåˆ©ç”¨Sç›’å¯¹è¾“å…¥å­—ä¸­çš„æ¯ä¸ªå­—èŠ‚è¿›è¡Œä»£æ›¿; å­—å¾ªç¯ä¸å­—èŠ‚ä»£æ¢çš„ç»“æœå†ä¸è½®å¸¸é‡Rcon[j]ç›¸å¼‚æˆ–</li><li>w[i]çš„å€¼ç­‰äºw[i-4]å¼‚æˆ–g(w[i-1]) (i&gt;=4, iæ˜¯4çš„å€æ•°)</li></ol><p>ç¤ºæ„å›¾:<br><img src="https://pb01.s3.bitiful.net/214.webp" alt="avatar"></p><h3 id="MD5">MD5</h3><p>MD5æ˜¯ä¸€ä¸ªåŸºäºå“ˆå¸Œå‡½æ•°çš„åŠ å¯†ç®—æ³•, å…¶è¾“å…¥ä¸ºä»»æ„é•¿åº¦çš„äºŒè¿›åˆ¶æ•°æ®, è¾“å‡ºä¸º128ä½çš„äºŒè¿›åˆ¶æ•°æ®.<br>å…¶æµç¨‹å¦‚ä¸‹:</p><ol><li>å¯¹è¾“å…¥æ˜æ–‡è¿›è¡Œå¡«å……, ä½¿å…¶èƒ½è¢«512æ•´é™¤(åé¢æ¯ä¸€è½®çš„è¾“å…¥éƒ½æ˜¯512ä½),å¡«å……çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹: é¦–å…ˆå°†æ•°æ®é•¿åº¦è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶å½¢å¼ï¼Œå¹¶é™„åŠ åˆ°æ•°æ®çš„æœ«å°¾; åœ¨æ•°æ®æœ«å°¾æ·»åŠ ä¸€ä¸ªâ€™1â€™æ¯”ç‰¹ï¼Œç„¶åå¡«å……0ç›´åˆ°æ•°æ®é•¿åº¦æ»¡è¶³å¯¹512å–æ¨¡çš„ç»“æœä¸º448(å³æ•°æ®é•¿åº¦æ¨¡512ç­‰äº448); å°†æ•°æ®é•¿åº¦ï¼ˆ64ä½ï¼‰é™„åŠ åˆ°å¡«å……åçš„æ•°æ®æœ«å°¾ï¼Œä»¥äºŒè¿›åˆ¶è¡¨ç¤º</li><li>å°†512ä½çš„æ˜æ–‡åˆ†ç»„åˆ’åˆ†ä¸º16ä¸ªå­æ˜æ–‡åˆ†ç»„ï¼Œæ¯ä¸ªå­æ˜æ–‡åˆ†ç»„ä¸º32ä½</li><li>åˆå§‹åŒ–4ä¸ª32ä½çš„é“¾æ¥å˜é‡ï¼Œè®°ä¸ºAã€Bã€Cã€D, åˆå§‹æ˜¯å›ºå®šå€¼</li><li>å¯¹æ¯ä¸ªå­æ˜æ–‡åˆ†ç»„å’Œå››ä¸ªé“¾æ¥å˜é‡(a,b,c,d, å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿ç®—çš„è¯, å°±æ˜¯ABCDçš„å€¼)éƒ½è¿›è¡ŒFF,GG,HH,IIå››è½®è¿ç®—(å…±64æ¬¡è¿ç®—)</li><li>å°†è¿ç®—ä¹‹åçš„é“¾æ¥å˜é‡a,b,c,dä¸åˆå§‹é“¾æ¥å˜é‡A,B,C,Dè¿›è¡Œæ±‚å’Œè¿ç®—å¾—åˆ°æ–°çš„é“¾æ¥å˜é‡</li><li>æ–°çš„é“¾æ¥å˜é‡ä½œä¸ºä¸‹ä¸€ä¸ªæ˜æ–‡åˆ†ç»„çš„è¾“å…¥é‡å¤è¿›è¡Œä»¥ä¸Šæ“ä½œ</li><li>æœ€åï¼Œ4ä¸ªé“¾æ¥å˜é‡é‡Œé¢çš„æ•°æ®å°±æ˜¯MD5æ‘˜è¦</li></ol><p>RSAæ¯”è¾ƒç®€å•æˆ‘å°±ä¸å†™äº†</p><h3 id="æ–‡ä»¶å®‰å…¨ä¼ è¾“">æ–‡ä»¶å®‰å…¨ä¼ è¾“</h3><p>è¦è®¾è®¡ä¸€å¥—Aå’ŒBä¹‹é—´å¯ä»¥å®‰å…¨é€šä¿¡çš„æ–¹æ¡ˆ, ä¸éœ€è¦è€ƒè™‘ä¼ è¾“éƒ¨åˆ†, å› ä¸ºè¿™æ˜¯åŸºäºå‰é¢çš„ä»£ç çš„, é›†æˆèµ·æ¥æ¯”è¾ƒéº»çƒ¦. éªŒæ”¶æ—¶è®²è§£æµç¨‹å’Œå±•ç¤ºç»“æœå³å¯, ä¸éœ€è¦ç°åœºè¿è¡Œ</p><p>æ–¹æ¡ˆè®¾è®¡:</p><p><img src="https://pb01.s3.bitiful.net/215.webp" alt="avatar"></p><p><strong>å‚æ•°é€‰å–</strong></p><p>RSA Aï¼šé€‰æ‹© p=61ï¼Œq=53ï¼Œe=17 å¾—åˆ°å…¬é’¥ï¼ˆeï¼Œnï¼‰=ï¼ˆ17ï¼Œ3233ï¼‰ ç§é’¥ï¼ˆdï¼Œ<br>nï¼‰=ï¼ˆ2573ï¼Œ3233ï¼‰<br>RSA B:é€‰æ‹© p=47ï¼Œq=59ï¼Œe=63 å¾—åˆ°å…¬é’¥ï¼ˆeï¼Œnï¼‰=ï¼ˆ63ï¼Œ2773ï¼‰ ç§é’¥ï¼ˆdï¼Œ<br>nï¼‰=ï¼ˆ847ï¼Œ2773ï¼‰<br>æ˜æ–‡: levit<br>AES ç§˜é’¥: 12345678KJNMLSDG</p><p><strong>åŠ å¯†è¿‡ç¨‹(A)</strong>:<br>AES å¯†æ–‡: 640246746 37579803911 321220508 1223758774 116<br>ç”¨ B çš„å…¬é’¥å¯¹ AES ç§˜é’¥è¿›è¡Œ RSA åŠ å¯† RSA_AES_miyao : Û¯ Í¿ Ê­ Ø† Ä³ Î² Õ³ à¨ Ñ½<br>à¥¥ Â¤ àª à¦‰ à¥© àª·<br>å¯¹æ˜æ–‡è®¡ç®— MD5 æ‘˜è¦,MD5_miwen: ea152a3ff6469c391ee8c79a01191d80<br>A çš„ç§é’¥å¯¹ MD5_miwen åŠ å¯†, RSA_MD5_miwen: àª àª àª Û° Ï‡ Ï‡ à°¸ Øµ<br>à°¸ à¨˜ Å Û° à¨˜ Ò± Å à¨˜ àª à¨ à¨˜ ÆŸ Ò± à¨ à¦·<br>æœ€åæŠŠåŠ å¯†ç”Ÿæˆçš„æ–‡ä»¶ AES_miwen.txtã€RSA_AES_miyao.txtã€<br>RSA_MD5_miwen.txt æ‰“åŒ…å‘ç»™ç»ˆç«¯ B</p><p><strong>è§£å¯†è¿‡ç¨‹(B)</strong>:<br>ç»ˆç«¯ B çš„ç§é’¥å¯¹ RSA_AES_miyao.txt è¿›è¡Œ RSA è§£å¯†, å¾—åˆ°:AES_Key<br>å¯¹ AES_miwen è§£å¯†ï¼Œå¾—åˆ°æ˜æ–‡ AES_mingwen.txt<br>ç”¨ MD5 ç®—æ³•å¯¹æ‰€å¾—æ˜æ–‡ AES_mingwen.txt è¿›è¡ŒåŠ å¯†ç”Ÿæˆè§£å¯†åçš„æ˜æ–‡æ‘˜è¦ã€‚å¾—<br>åˆ°ï¼š AES_mingwen_MD5.txt<br>RSA ç®—æ³•ç”¨ç»ˆç«¯ A çš„å…¬é’¥å¯¹ RSA_MD5_miwen.txt è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°:<br>RSA_MD5_mingwen.txt<br>æ¯”è¾ƒ RSA_MD5_mingwen.txt å’Œ AES_mingwen_MD5.txt æœ‰ä»€ä¹ˆä¸åŒ</p><p>åŠ å¯†ç»“æœä¸ç¼–ç æœ‰å…³, åŒæ ·å‚æ•°ä¹Ÿå¯èƒ½æ˜¾ç¤ºä¸ä¸€æ ·çš„ç»“æœ</p><p>ç»“æœå±•ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/216.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/217.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/218.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/219.webp" alt="avatar"></p><p>ä»£ç å’Œå®éªŒæŠ¥å‘Šå¼€æºåœ¨äº†æˆ‘çš„<a href="https://github.com/Marvel-Gu/XDU_CS_Applied_cryptography.git" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">github</a>ä¸Š, å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©çš„è¯, æ¬¢è¿starå’ŒfollowğŸ˜˜</p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆå­¦è€…çœ¼ä¸­çš„Goè¯­è¨€</title>
      <link href="/2024/05/27/2024-5-27-GO%E5%85%A5%E9%97%A8/"/>
      <url>/2024/05/27/2024-5-27-GO%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="åˆå­¦è€…çœ¼ä¸­çš„Goè¯­è¨€">åˆå­¦è€…çœ¼ä¸­çš„Goè¯­è¨€</h3><p>æœ€è¿‘èŠ±äº†ä¸€äº›æ—¶é—´è¿‡äº†ä¸€é<a href="https://go-zh.org/doc/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Goç¼–ç¨‹è¯­è¨€</a>ä¸­çš„<a href="https://tour.go-zh.org/welcome/1" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Goè¯­è¨€ä¹‹æ—…</a>, ä¹Ÿç®—æ˜¯å…¥é—¨äº†, ä¸‹é¢è°ˆè°ˆæˆ‘è®¤çŸ¥çš„Goè¯­è¨€</p><h4 id="ç±»å‹">ç±»å‹</h4><p>ä¸åƒç»å¤§æ•°è¯­è¨€,ç±»å‹å®šä¹‰åœ¨äº†å˜é‡åä¹‹å‰,Goä¸­<code>ç±»å‹åœ¨å˜é‡åä¹‹å</code>,å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="type">int</span>, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;  </span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç­‰æ•ˆäº</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹ä¹Ÿåœ¨åšå®¢<a href="https://blog.go-zh.org/gos-declaration-syntax" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Goâ€™s Declaration Syntax</a>ä¸­ç»™å‡ºäº†ç†ç”±, ä½†å¯èƒ½æ˜¯ç”±äºæƒ¯æ€§, æˆ‘ä»ç„¶ä¸æ˜¯å¾ˆå–œæ¬¢è¿™ç§è®¾è®¡ğŸ¤¥</p><p>å…³äº<code>å˜é‡åˆå§‹åŒ–</code>:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i, j <span class="type">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line"><span class="comment">//ç­‰æ•ˆäº</span></span><br><span class="line"><span class="keyword">var</span> i, j = <span class="number">1</span>, <span class="number">2</span></span><br></pre></td></tr></table></figure><p>å¹¸äºå˜é‡åˆå§‹åŒ–æ—¶ç±»å‹å£°æ˜å¯ä»¥å¿½ç•¥, ä¸ç„¶çœŸçš„çœ‹ä¸Šå»å¾ˆæ€ª, å¿½ç•¥åä¸€çœ‹, è¿™ä¸æ˜¯JavaScriptå—ğŸ¥°</p><h4 id="Goæ²¡æœ‰while">Goæ²¡æœ‰while</h4><p>ç»å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯æœ‰whileå¾ªç¯çš„, è™½ç„¶whileå¾ªç¯çš„æœ¬è´¨è¿˜æ˜¯forå¾ªç¯, Goè¯´: <code>foræ˜¯Goä¸­çš„while</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;</span><br><span class="line">sum += sum</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="defer">defer</h4><p>defer è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­æ²¡è§è¿‡è¿™ä¸ªç‰¹æ€§, ä½†åœ¨Goä¸­, å®ƒè¢«å¹¿æ³›ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºç»“æœ</span></span><br><span class="line">hello</span><br><span class="line">world</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…ä½¿ç”¨ä¸Šæ¥è¯´, è¿™æœ‰ç‚¹åƒJavaå’ŒPythonä¸­çš„<code>finally</code>, ä½†ä¸åŒçš„æ˜¯, <code>finally</code>æ˜¯å¼‚å¸¸å¤„ç†çš„ä¸€éƒ¨åˆ†, é æ§åˆ¶æµæœºåˆ¶å®ç°, è€Œ<code>defer</code>æ˜¯é€šè¿‡æ ˆæœºåˆ¶å®ç°çš„ã€‚æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚ å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„è°ƒç”¨ä¼šæŒ‰ç…§åè¿›å…ˆå‡ºçš„é¡ºåºè°ƒç”¨ã€‚</p><h4 id="åˆ‡ç‰‡">åˆ‡ç‰‡</h4><p>è¯´åˆ°åˆ‡ç‰‡å…¶å®å¾ˆå®¹æ˜“è®©äººæƒ³åˆ°Python, å®ƒå’ŒGoä¸­çš„åˆ‡ç‰‡æœ‰ä»€ä¹ˆä¸åŒç‚¹å‘¢?</p><ol><li><p><strong>é€šç”¨æ€§</strong>: Pythonä¸­çš„åˆ‡ç‰‡æ“ä½œéå¸¸é€šç”¨ï¼Œå¯ä»¥å¯¹åˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²ç­‰è¿›è¡Œåˆ‡ç‰‡ã€‚Goä¸­çš„åˆ‡ç‰‡æ˜¯ä¸€ç§å…·ä½“çš„æ•°æ®ç»“æ„ï¼Œåªèƒ½ç”¨äºåˆ‡ç‰‡ç±»å‹ã€‚</p></li><li><p><strong>è¯­æ³•</strong>: ä¸¤è€…è¯­æ³•ç›¸ä¼¼, éƒ½å¯ä»¥å†™åš[a,b,c], ä½†Pythonä¸­a,b,cçš„å–å€¼å¯ä»¥æ˜¯è´Ÿå€¼, è€ŒGoä¸­ä¸å¯ä»¥, å¹¶ä¸”cè¿™ä¸ªä½ç½®åœ¨ä¸¤ç§è¯­è¨€ä¸­çš„å«ä¹‰ä¹Ÿä¸ç›¸åŒ, Pythonä¸­çš„cè¡¨ç¤ºæ­¥é•¿, è€ŒGoä¸­çš„cè¡¨ç¤ºåˆ‡ç‰‡çš„å®¹é‡ã€‚</p></li><li><p><strong>è¿”å›å€¼</strong>: Pythonåˆ‡ç‰‡æ“ä½œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¸åŸå¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯åˆ†ç¦»çš„ã€‚è€ŒGoä¸­çš„åˆ‡ç‰‡æ“ä½œè¿”å›çš„æ˜¯åŸåˆ‡ç‰‡çš„ä¸€ä¸ªè§†å›¾ï¼Œå…±äº«ç›¸åŒçš„åº•å±‚æ•°ç»„ã€‚</p></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0</span></span><br><span class="line">s = s[:<span class="number">0</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰©å±•å…¶é•¿åº¦</span></span><br><span class="line">s = s[:<span class="number">4</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// èˆå¼ƒå‰ä¸¤ä¸ªå€¼</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d cap=%d %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="built_in">len</span>=<span class="number">6</span> <span class="built_in">cap</span>=<span class="number">6</span> [<span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">7</span> <span class="number">11</span> <span class="number">13</span>]</span><br><span class="line"><span class="built_in">len</span>=<span class="number">0</span> <span class="built_in">cap</span>=<span class="number">6</span> []</span><br><span class="line"><span class="built_in">len</span>=<span class="number">4</span> <span class="built_in">cap</span>=<span class="number">6</span> [<span class="number">2</span> <span class="number">3</span> <span class="number">5</span> <span class="number">7</span>]</span><br><span class="line"><span class="built_in">len</span>=<span class="number">2</span> <span class="built_in">cap</span>=<span class="number">4</span> [<span class="number">5</span> <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åœ¨ç©ºåˆ‡ç‰‡ä¸Šè¿½åŠ </span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">0</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªåˆ‡ç‰‡ä¼šæŒ‰éœ€å¢é•¿</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªå…ƒç´ </span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d cap=%d %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="built_in">len</span>=<span class="number">0</span> <span class="built_in">cap</span>=<span class="number">0</span> []</span><br><span class="line"><span class="built_in">len</span>=<span class="number">1</span> <span class="built_in">cap</span>=<span class="number">1</span> [<span class="number">0</span>]</span><br><span class="line"><span class="built_in">len</span>=<span class="number">2</span> <span class="built_in">cap</span>=<span class="number">2</span> [<span class="number">0</span> <span class="number">1</span>]</span><br><span class="line"><span class="built_in">len</span>=<span class="number">5</span> <span class="built_in">cap</span>=<span class="number">6</span> [<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¹‹é—´çš„å…³ç³»æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>åˆ‡ç‰‡çš„é•¿åº¦ï¼ˆ<code>len</code>ï¼‰æ€»æ˜¯å°äºæˆ–ç­‰äºå…¶å®¹é‡ï¼ˆ<code>cap</code>ï¼‰ã€‚</li><li>å½“åˆ‡ç‰‡è¢«åˆ›å»ºæ—¶ï¼Œé•¿åº¦å’Œå®¹é‡é€šå¸¸æ˜¯ç›¸ç­‰çš„ï¼Œä½†å¦‚æœä»ä¸€ä¸ªè¾ƒå¤§çš„æ•°ç»„æˆ–åˆ‡ç‰‡åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡æ—¶ï¼Œæ–°åˆ‡ç‰‡çš„å®¹é‡å¯èƒ½ä¼šå¤§äºå…¶é•¿åº¦ã€‚</li><li>å½“ä½¿ç”¨å†…å»ºå‡½æ•°<code>append</code>å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœè¿½åŠ çš„å…ƒç´ è¶…å‡ºäº†å½“å‰é•¿åº¦ä½†æœªè¶…å‡ºå®¹é‡ï¼Œåˆ‡ç‰‡çš„é•¿åº¦ä¼šå¢åŠ ï¼Œè€Œå®¹é‡ä¿æŒä¸å˜ã€‚</li><li>å¦‚æœ<code>append</code>å¯¼è‡´åˆ‡ç‰‡é•¿åº¦è¶…è¿‡å®¹é‡ï¼ŒGoè¿è¡Œæ—¶ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„åº•å±‚æ•°ç»„ï¼Œå¹¶å°†ç°æœ‰çš„å…ƒç´ å’Œæ–°å…ƒç´ å¤åˆ¶åˆ°è¿™ä¸ªæ–°æ•°ç»„ä¸­ã€‚è¿™æ—¶ï¼Œåˆ‡ç‰‡çš„å®¹é‡ä¼šå˜ä¸ºæ–°çš„é•¿åº¦å€¼ï¼Œå› ä¸ºæ–°æ•°ç»„çš„å¤§å°è‡³å°‘æ˜¯æ–°é•¿åº¦çš„ä¸¤å€ï¼ˆå…·ä½“å¢é•¿ç­–ç•¥å¯èƒ½æ›´å¤æ‚ï¼Œä½†è‡³å°‘æ˜¯è¿™ä¸ªä¿è¯ï¼‰ã€‚</li><li>åˆ‡ç‰‡å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡ï¼ˆreslicingï¼‰æ¥å‡å°‘é•¿åº¦ï¼Œä½†è¿™æ ·åšä¸ä¼šæ”¹å˜å…¶å®¹é‡ã€‚é‡æ–°åˆ‡ç‰‡çš„è¯­æ³•æ˜¯<code>slice[low:high]</code>ï¼Œå…¶ä¸­<code>low</code>æ˜¯åˆ‡ç‰‡çš„èµ·å§‹ç´¢å¼•ï¼Œ<code>high</code>æ˜¯ç»“æŸç´¢å¼•ï¼ˆä¸åŒ…æ‹¬ï¼‰ã€‚å¦‚æœçœç•¥<code>low</code>ï¼Œåˆ™é»˜è®¤ä»åˆ‡ç‰‡çš„å¼€å§‹ï¼›å¦‚æœçœç•¥<code>high</code>ï¼Œåˆ™é»˜è®¤åˆ°åˆ‡ç‰‡çš„æœ«å°¾ã€‚</li></ol><h4 id="å¹¶å‘ç¼–ç¨‹">å¹¶å‘ç¼–ç¨‹</h4><p>Goçš„å¹¶å‘æœºåˆ¶ä¸ªäººè®¤ä¸ºæ¯”Javaè¦æ›´å®¹æ˜“ä¸Šæ‰‹, åç¨‹å’Œä¿¡é“çš„è®¾è®¡åŠ ä¸Š<code>go</code>å…³é”®å­—å¯åŠ¨, ä½¿å¾—å¹¶å‘å˜å¾—æ›´åŠ ç®€å•</p><p>è°ˆè°ˆGoå’ŒJavaçš„åŒºåˆ«:</p><ol><li><p><strong>å¹¶å‘æ¨¡å‹çš„æœ¬è´¨</strong>: Javaæ˜¯åŸºäºçº¿ç¨‹çš„å¹¶å‘æ¨¡å‹ï¼Œå…¶ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ“ä½œç³»ç»Ÿçš„è½»é‡çº§è¿›ç¨‹ã€‚Goè¯­è¨€é‡‡ç”¨äº†åŸºäºåç¨‹(goroutine)çš„å¹¶å‘æ¨¡å‹ã€‚Goroutinesæ˜¯è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†ï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿã€‚</p></li><li><p><strong>å†…å­˜æ¨¡å‹å’ŒåŒæ­¥</strong>: Javaæœ‰ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒæ¶µç›–äº†å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§ã€‚Javaæä¾›äº†å¤šç§åŒæ­¥æœºåˆ¶ï¼Œå¦‚synchronizedå…³é”®å­—ã€Lockæ¥å£å’Œvolatileå…³é”®å­—ï¼Œä»¥ç¡®ä¿å¹¶å‘å®‰å…¨ã€‚Goä¹Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒé€šè¿‡goroutineså’Œchannelsæ¥ä¿è¯æ•°æ®çš„åŒæ­¥ã€‚Goé¼“åŠ±ä½¿ç”¨channelsè¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„é”æœºåˆ¶ã€‚è¿™æœ‰åŠ©äºå‡å°‘ç«äº‰æ¡ä»¶å’Œæ­»é”çš„é—®é¢˜ã€‚</p></li><li><p><strong>è¿è¡Œæ—¶ç®¡ç†</strong>: Javaçš„å¹¶å‘ç®¡ç†ä¸»è¦ç”±JVMè´Ÿè´£ã€‚Goçš„å¹¶å‘ç®¡ç†ç”±Goè¿è¡Œæ—¶è´Ÿè´£ã€‚</p></li><li><p><strong>æ€§èƒ½å’Œå¯æ‰©å±•æ€§</strong>: Javaçº¿ç¨‹çš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ç›¸å¯¹è¾ƒé«˜ã€‚å› æ­¤ï¼ŒJavaç¨‹åºåœ¨åˆ›å»ºå¤§é‡çº¿ç¨‹æ—¶å¯èƒ½ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ã€‚goroutinesçš„åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€éå¸¸ä½ï¼Œè¿™ä½¿å¾—Goç¨‹åºèƒ½å¤Ÿè½»æ¾åˆ›å»ºæ•°ä»¥ä¸‡è®¡çš„goroutinesã€‚Goçš„è¿è¡Œæ—¶èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°åœ¨å¤šä¸ªOSçº¿ç¨‹ä¸Šè°ƒåº¦è¿™äº›goroutinesã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¾èµ›ç»éªŒåˆ†äº«</title>
      <link href="/2024/05/13/2024-5-13-%E7%BE%8E%E8%B5%9B/"/>
      <url>/2024/05/13/2024-5-13-%E7%BE%8E%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="ç¾èµ›ç»éªŒåˆ†äº«">ç¾èµ›ç»éªŒåˆ†äº«</h3><p>å‰ä¸€æ®µæ—¶é—´ç¾èµ›å‡ºæˆç»©äº†, ä¾¥å¹¸å¾—äº†ä¸ªM, è™½ç„¶ä¸æ˜¯ä»€ä¹ˆå¤§å¥–, ä½†ä¹Ÿæœ‰ä¸€äº›æµ…è–„çš„ç»éªŒå¯ä»¥åˆ†äº«(ä¸»å»ºæ¨¡å’Œç”»å›¾)</p><p><img src="https://pb01.s3.bitiful.net/207.webp" alt="avatar"></p><h4 id="ç»„é˜Ÿ">ç»„é˜Ÿ</h4><p>å…¶å®ç»„é˜Ÿæ˜¯å†³å®šä½ æ•°æ¨¡æˆç»©çš„<strong>æœ€é‡è¦</strong>çš„ä¸€æ­¥,å’Œè®¤çœŸè´Ÿè´£çš„é˜Ÿå‹ç»„é˜Ÿä¼šè®©ä½ çš„æˆåŠŸå‡ ç‡ä¸Šå‡ä¸€å¤§æˆª. é¦–å…ˆæˆ‘æ¨èæ‰¾ä¸€ä¸ªé è°±çš„ç†Ÿäºº, å†è®©ä»–æ‰¾ä¸€ä¸ª.è¿™æ ·å°±æ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼, æˆ–è€…æ‰¾ä¸¤ä¸ªç†Ÿäººä¹Ÿè¡Œ, ä¸å¤ªæ¨èå»å„ç§å¢™ä¸Šæ‰¾äºº,ä¸€èˆ¬æ‰¾åˆ°çš„éƒ½ä¸å¤ªé è°±. ç»„å®Œé˜Ÿä¹‹å, åœ¨æ¯”èµ›å¼€å§‹å‰, æˆ‘ä»¬å­¦æ ¡ä¸€èˆ¬ä¼šæœ‰è®­ç»ƒ(å…¶å®å°±æ˜¯åšå¾€å¹´é¢˜), åœ¨è¿™ä¸ªæ—¶å€™ä½ åº”è¯¥èƒ½å¤§è‡´åˆ¤æ–­é˜Ÿå‹é ä¸é è°±äº†, å¦‚æœä»–å¤©å¤©æœ‰äº‹ä¸å‚åŠ æ¨¡æ‹Ÿè®­ç»ƒæˆ–è€…è¯´ä¸ç§¯æä¸å¹²æ´», å»ºè®®å’Œå¦ä¸€ä¸ªé˜Ÿå‹å•†é‡æŠŠä»–è¸¢å‡ºå», æˆ–è€…è¯´ä½ è§‰å¾—å¦å¤–ä¸¤ä¸ªé˜Ÿå‹éƒ½ä¸é è°±, é‚£å°±é€€å‡ºé‡æ–°å¯»æ‰¾é˜Ÿä¼. ç†Ÿäººç»„é˜Ÿçš„ä¸€å¤§åŠ£åŠ¿å°±æ˜¯æƒ³è¸¢äººå¾ˆéš¾, æˆ‘å›½æ˜¯ä¸ªäººæƒ…ç¤¾ä¼š(bushi), æ‰€ä»¥ä¸€å¼€å§‹å°±è¦è®¤çœŸæ€è€ƒ.</p><h4 id="å‡†å¤‡">å‡†å¤‡</h4><p>é¦–å…ˆè¦ç¡®å®šå¥½1~2ä¸ªä¸»æ”»çš„é¢˜å‹,ç„¶åé˜Ÿå†…ä¸‰ä¸ªäººçš„åˆ†å·¥è¦æ˜ç¡®, ç‰¹åˆ«æ˜¯å¯¹äºä½å¹´çº§ç¬¬ä¸€æ¬¡å‚èµ›çš„é€‰æ‰‹, åˆ†å·¥ä¸æ˜ç¡®çš„è¯å­¦å®Œå¾ˆéš¾.</p><p>ä»<strong>å»ºæ¨¡</strong>çš„è§’åº¦æ¥è¯´,æå‡æœ€å¿«çš„å°±æ˜¯çœ‹ä¼˜ç§€è®ºæ–‡,O/Fçš„éƒ½å¯ä»¥çœ‹çœ‹,æå–åº”å¯¹æŸä¸€ç±»é—®é¢˜é€šç”¨çš„è§£å†³æ–¹æ¡ˆå’Œä»–ä»¬è®ºæ–‡ä¸­çš„é—ªå…‰ç‚¹.ç§¯ç´¯åˆ°è‡ªå·±çš„ç¬”è®°ä¸Š, æ¯”èµ›æ—¶å¯ä»¥å¿«é€Ÿé€‰å–ä¸€äº›è§£å†³æ–¹æ¡ˆ. è¿˜æœ‰å°±æ˜¯è‡ªå»ºæ¨¡å‹æˆ–è€…ç»“åˆåŸºç¡€æ¨¡å‹çš„æ—¶å€™, è¦è€ƒè™‘åˆ°å¯å®ç°æ€§, å¦‚æœä½ çš„æ¨¡å‹æ— æ³•å®ç°, æˆ–è€…å®ç°èµ·æ¥å¤ªå¤æ‚, é‚£å°±å¦¥åä¸€äº›ä¸œè¥¿(ç®€åŒ–æ¨¡å‹/æ•°æ®), æœ‰ç»“æœæ€»æ¯”æ²¡æœ‰ç»“æœå¼º.</p><p>ä»<strong>ç”»å›¾</strong>çš„è§’åº¦ä¸Šæ¥è¯´, æœ€é‡è¦çš„å°±æ˜¯å¤åˆ»åˆ«äººè®ºæ–‡ä¸­çš„å›¾, ç§¯ç´¯å¥½å¸¸ç”¨å›¾åƒ(åƒour work, å¸¸ç”¨ç®—æ³•çš„åŸç†å›¾, å¯¹æ¯”å›¾ç­‰)çš„å‡ ç§æ¨¡ç‰ˆä¾›æ¯”èµ›çš„æ—¶å€™ä½¿ç”¨, å¸¸ç”¨å›¾ç°ç”»æ˜¯ä¸å¤ªç»æµçš„ä¸€ç§åšæ³•,å³ä½¿æ˜¯ä»ç°æœ‰çš„å›¾è°ƒæ•´å¾€å¾€ä¹Ÿéœ€è¦å¾ˆä¹…. è¿˜å¯ä»¥å»æ–‡çŒ®ä¸­æ‰¾å›¾å¤åˆ», å¾ˆå¤šç§‘ç ”è®ºæ–‡ä¸­çš„å›¾çœ‹ä¸Šå»çœŸçš„å¾ˆé«˜çº§, ä¹Ÿè®¸è¡¨è¾¾çš„å«ä¹‰å·®ä¸å¤š, ä½†æ¼‚äº®çš„æ’å›¾ç»å¯¹æ˜¯ä¸€å¤§åŠ åˆ†é¡¹.</p><p>ä»<strong>ç¼–ç¨‹</strong>çš„è§’åº¦æ¥è¯´, è¦å¤ç°ä¼˜ç§€è®ºæ–‡ä¸­çš„ç®—æ³•(è™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯è°ƒåŒ…ä¾ ), å¸¸ç”¨ç®—æ³•è¦æœ‰ä¸€å¥—èƒ½è·‘çš„, å¦‚æœè¦ç”¨åœ¨ä¸Šé¢ä¿®æ”¹å³å¯, è¿™æ ·ä¼šå¿«å¾ˆå¤š. é‡åˆ°é—®é¢˜å¯ä»¥å»é—®é—®GPT-4, ä»£ç çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¹Ÿå¯ä»¥è®©å®ƒå†™, ç®€å•çš„pythonä»£ç è¿˜æ˜¯å¯ä»¥å†™å‡ºæ¥çš„.</p><p>ä»<strong>è®ºæ–‡</strong>çš„è§’åº¦æ¥è¯´, Latexå­¦ä¼šåŸºæœ¬ä½¿ç”¨å°±è¡Œ. æœ‰äº†å¤§è¯­è¨€æ¨¡å‹ä¹‹å, ç¿»è¯‘çš„å·¥ä½œä¹Ÿè½»æ¾äº†å¾ˆå¤š, å…¶å®ä¸‰ä¸ªäººä¸€èµ·å¹²ä¼šå¾ˆå¿«, è®ºæ–‡æ‰‹åœ¨æœ€åè¦å¯¹äºæ’ç‰ˆè¿›è¡Œè°ƒæ•´.</p><h4 id="å…¶ä»–Tips">å…¶ä»–Tips</h4><ol><li><p>è¦æ³¨é‡<code>ç»†èŠ‚</code>çš„å¤„ç†, æŸä¸€éƒ¨åˆ†æœ‰äº®ç‚¹å¾€å¾€ä¼šè®©è®ºæ–‡çš„è¯„ä»·ä¸Šä¸€ä¸ªæ¡£æ¬¡</p></li><li><p>è¦<code>å……åˆ†åˆ©ç”¨æ¯ä¸ªäººçš„æ—¶é—´</code>, å°½é‡ä¸è¦è®©é˜Ÿä¼ä¸­çš„äººæ— äº‹å¯åš, æ‰‹é‡Œçš„äº‹æƒ…åšå®Œäº†å°±è¦ä¸»åŠ¨å»æ‰¿æ‹…åˆ«çš„èŒè´£.</p></li><li><p>è¦æ‡‚å¾—<code>å¿«é€Ÿè¯•é”™</code>, å¦‚æœæŸä¸ªç®—æ³•è·‘ä¸å‡ºæ¥, ç«‹é©¬æ¢å¦ä¸€ä¸ªå»å°è¯•. å¦‚æœç»“æœä¸ç†æƒ³, å…ˆè€ƒè™‘å‚æ•°æ˜¯å¦å¯ä»¥ä¼˜åŒ–, å¦‚æœä¸è¡Œ, è€ƒè™‘æ¢ä¸€ä¸ªç®—æ³•, ä¸è¦æ­»ç£•ä¸€ä¸ªç®—æ³•, ä½ å³ä½¿æ…¢æ…¢å»è°ƒå‚ä¼˜åŒ–, å¾€å¾€ä¸å¦‚æ¢ä¸€ä¸ªç®—æ³•å¸¦æ¥çš„æå‡æ›´åŠ æ˜æ˜¾, æ‰¾ä¸€ä¸ªæ•ˆæœæœ€å¥½çš„ç®—æ³•å†è¿›è¡Œä¼˜åŒ–.</p></li><li><p>è¦é€‚å½“çš„å»<code>ç¾åŒ–</code>è‡ªå·±çš„ç»“æœ(ä¸æ˜¯é€ å‡ä¿®æ”¹æ•°æ®å“¦ğŸ˜‡), æ¯”å¦‚è¯´å¦‚æœæœ€åçš„ç»“æœå¯¹äºå…¨æ•°æ®é›†æ¥è¯´æ•ˆæœä¸æ˜¯ç‰¹åˆ«å¥½, é‚£å¯ä»¥æŒ‘éƒ¨åˆ†æ•ˆæœå¥½çš„æ•°æ®é›†æ¥éªŒè¯(è¿™ä¹Ÿè¦çœ‹ä»»åŠ¡,ä¸èƒ½æ— è„‘ç”¨), é‚£è¿™æ ·å°±å¯ä»¥è¯´æ¨¡å‹ç‰¹åˆ«é€‚ç”¨äºæŸæŸåœºæ™¯, åé¢çš„ç¼ºç‚¹æˆ–è€…æ¨¡å‹æ”¹è¿›ä¹Ÿæœ‰ä¸œè¥¿å¯å†™</p></li><li><p><code>æ‘˜è¦</code>æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€, å®ƒå†³å®šä½ æ˜¯å¦å¯ä»¥é€šè¿‡ç¬¬ä¸€è½®çš„ç­›é€‰, é€šä¸è¿‡çš„è¯å°±æ˜¯S, æ²¡å¾—å•†é‡. åœ¨æ‘˜è¦ä¸­è¦é‡åŒ–è‡ªå·±çš„ç»“æœ, ä¸è¦åªç”¨ä¸»è§‚çš„æè¿°, è¿™ä¼šè®©äººæ€€ç–‘çœŸå®æ€§</p></li><li><p>å¦‚æœè®ºæ–‡æ²¡æœ‰ä»€ä¹ˆçªå‡ºçš„åˆ›æ–°ç‚¹, <code>æé«˜å·¥ä½œé‡</code>ä¹Ÿæ˜¯ä¸€ç§é€‰æ‹©, æ¯”å¦‚è¯´åŠ å…¥å¤šç§æ¨¡å‹çš„å¯¹æ¯”, æ‰©å……æ•°æ®é›†ç­‰.</p></li></ol><h4 id="è®ºæ–‡">è®ºæ–‡</h4><p>ä¸ºäº†ä¿æŠ¤éšç§,æŠŠé˜Ÿå·åˆ äº†ğŸ¥°. PDFç»è¿‡å‹ç¼©, å›¾ç‰‡ä¸æ˜¯å¾ˆæ¸…æ™°, åŸä»¶çœ‹ä¸Šå»æ˜¯æ¸…æ™°çš„</p><div class="row">    <embed src="/MCM_compressed.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MCM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®éšç§ä¿æŠ¤</title>
      <link href="/2024/05/07/2024-5-7-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%813/"/>
      <url>/2024/05/07/2024-5-7-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%813/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="æ•°æ®å®‰å…¨æ£€ç´¢">æ•°æ®å®‰å…¨æ£€ç´¢</h3><p>å¤§æ•°æ®å®‰å…¨ä¸éšç§è¿™é—¨è¯¾çš„lab4,è¦æ±‚å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/208.webp" alt="avatar"></p><p>å®ç°:<br>â€¢ å¯¹åŸå§‹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†å, è®¡ç®—å¹³å‡å¹´é¾„<br>â€¢ è°ƒç”¨äº†mondrianåº“æ¥å®ç°kåŒ¿åï¼Œå¹¶è®¡ç®—äº†kåŒ¿ååçš„å¹³å‡å¹´é¾„<br>â€¢ é€šè¿‡æ·»åŠ æ‹‰æ™®æ‹‰æ–¯å™ªå£°æ¥å®ç°å·®åˆ†éšç§å‘å¸ƒ<br>â€¢ éšæœºåˆ é™¤ä¸€æ¡æ•°æ®åå†æ¬¡è®¡ç®—å¹³å‡å¹´é¾„è¿›è¡Œå¯¹æ¯”</p><h3 id="ç»“æœ">ç»“æœ</h3><p><img src="https://pb01.s3.bitiful.net/209.webp" alt="avatar"></p><h3 id="ä»£ç ">ä»£ç </h3><p>ç»“æ„:<br><img src="https://pb01.s3.bitiful.net/210.webp" alt="avatar"></p><h4 id="main-py"><a href="http://main.py">main.py</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secure.lab3 <span class="keyword">import</span> utils</span><br><span class="line"></span><br><span class="line">sys.path.append(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> preprocess, txt_Reader</span><br><span class="line"><span class="keyword">from</span> library.mondrian <span class="keyword">import</span> *</span><br><span class="line">filename = <span class="string">&quot;adult.data.txt&quot;</span></span><br><span class="line">title_column = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;workclass&#x27;</span>, <span class="string">&#x27;fnlwgt&#x27;</span>, <span class="string">&#x27;education&#x27;</span>, <span class="string">&#x27;education-num&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;marital-status&#x27;</span>, <span class="string">&#x27;occupation&#x27;</span>, <span class="string">&#x27;relationship&#x27;</span>, <span class="string">&#x27;race&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;capital-gain&#x27;</span>, <span class="string">&#x27;capital-loss&#x27;</span>, <span class="string">&#x27;hours-per-week&#x27;</span>, <span class="string">&#x27;native-country&#x27;</span>, <span class="string">&#x27;class&#x27;</span>]</span><br><span class="line">QI_list = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;race&#x27;</span>]</span><br><span class="line">data = txt_Reader(filename).read_txt(<span class="string">&#x27;./Adult Data Set/&#x27;</span>, title_column)</span><br><span class="line">data.sort_values(by=<span class="string">&#x27;age&#x27;</span>, ascending=<span class="literal">True</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">rawlen = <span class="built_in">len</span>(data)</span><br><span class="line">preprocess(data)  <span class="comment"># åˆ é™¤éæ³•æ•°æ®</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŸæœ‰æ•°æ®æœ‰&#123;&#125;è¡Œ; æ¸…æ´—åçš„æ•°æ®æœ‰&#123;&#125;è¡Œ&quot;</span>.<span class="built_in">format</span>(rawlen, <span class="built_in">len</span>(data)))</span><br><span class="line">raw_data_list = utils.df2list(data)  <span class="comment"># è½¬æ¢ä¸ºåˆ—è¡¨</span></span><br><span class="line">pre_ages = [<span class="built_in">int</span>(item[<span class="number">0</span>]) <span class="keyword">for</span> item <span class="keyword">in</span> raw_data_list]</span><br><span class="line"></span><br><span class="line">avg_pre_ages = (<span class="built_in">sum</span>(pre_ages) / <span class="built_in">len</span>(raw_data_list))  <span class="comment"># æ±‚åŸæ•°æ®å¹³å‡å¹´é¾„</span></span><br><span class="line">k = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;éœ€è¦åŒ¿ååŒ–çš„kä¸º&quot;</span>))</span><br><span class="line"></span><br><span class="line">DATA, order = utils.read_data()</span><br><span class="line">res, b = mondrian(DATA, k, <span class="literal">False</span>)  <span class="comment"># k-åŒ¿å</span></span><br><span class="line">res = utils.covert_to_raw(res, order)</span><br><span class="line">post_ages = [item[<span class="number">0</span>] <span class="keyword">for</span> item <span class="keyword">in</span> res]</span><br><span class="line">avg_post_ages = utils.cal_post_ages(post_ages)</span><br><span class="line">utils.write_result(res, k)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŸæ•°æ®çš„å¹³å‡å¹´é¾„ä¸º: %f&quot;</span> %avg_pre_ages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%d-åŒ¿ååçš„å¹³å‡å¹´é¾„ä¸º:&quot;</span>%k, avg_post_ages)</span><br><span class="line"></span><br><span class="line">dp_ages = utils.diff_privacy_add_laplace_noise(pre_ages, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">avg_dp_ages = utils.avg_ages(dp_ages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å·®åˆ†éšç§åçš„å¹³å‡å¹´é¾„ä¸º: %f&quot;</span> %avg_dp_ages)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•åœ¨åˆ é™¤æŸæ¡æ•°æ®åï¼ŒkåŒ¿åå‘å¸ƒçš„å¹³å‡å¹´é¾„ã€çœŸå®å‘å¸ƒå¹³å‡å¹´é¾„ã€å·®åˆ†éšç§å¹³å‡å¹´é¾„å¯¹ç”¨æˆ·éšç§ä¿¡æ¯(å¹´é¾„) æ³„éœ²çš„å¯èƒ½æ€§</span></span><br><span class="line"></span><br><span class="line">idx = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(pre_ages))</span><br><span class="line">co_pre_ages = copy.deepcopy(pre_ages)</span><br><span class="line">co_post_ages = copy.deepcopy(post_ages)</span><br><span class="line">co_dp_ages = copy.deepcopy(dp_ages)</span><br><span class="line"></span><br><span class="line">co_pre_ages.pop(idx)</span><br><span class="line">co_post_ages.pop(idx)</span><br><span class="line">co_dp_ages = utils.diff_privacy_add_laplace_noise(co_pre_ages, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=====================================================================================&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;éšæœºåˆ é™¤çš„æ•°æ®ä¸º&quot;</span>, pre_ages[idx])</span><br><span class="line">avg_pre = utils.avg_ages(co_pre_ages)</span><br><span class="line">avg_post = utils.cal_post_ages(co_post_ages)</span><br><span class="line">avg_dp = utils.avg_ages(co_dp_ages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¹³å‡å¹´é¾„åˆ†åˆ«ä¸ºåŸæ•°æ®&#123;&#125;ã€k-åŒ¿ååæ•°æ®&#123;&#125;ã€å·®åˆ†éšç§åæ•°æ®&#123;&#125;&quot;</span>.<span class="built_in">format</span>(avg_pre, avg_post, avg_dp))</span><br><span class="line"></span><br><span class="line">val_pre = avg_pre_ages * (<span class="built_in">len</span>(co_pre_ages) + <span class="number">1</span>) - avg_pre * <span class="built_in">len</span>(co_pre_ages)</span><br><span class="line">val_post = avg_post_ages * (<span class="built_in">len</span>(co_post_ages) + <span class="number">1</span>) - avg_post * <span class="built_in">len</span>(co_post_ages)</span><br><span class="line">val_dp = avg_dp_ages * (<span class="built_in">len</span>(co_dp_ages) + <span class="number">1</span>) - avg_dp * <span class="built_in">len</span>(co_dp_ages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;éšæœºåˆ é™¤çš„ç”¨æˆ·å¹´é¾„æ•°æ®åˆ†åˆ«ä¸º:åŸæ•°æ®æ¨æ–­å¹´é¾„&#123;&#125;ã€k-åŒ¿ååæ•°æ®æ¨æ–­å¹´é¾„&#123;&#125;ã€å·®åˆ†éšç§åæ•°æ®æ¨æ–­å¹´é¾„&#123;&#125;&quot;</span>.<span class="built_in">format</span>(val_pre, val_post, val_dp))</span><br></pre></td></tr></table></figure><h3 id="utils-py"><a href="http://utils.py">utils.py</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">AGE_CONF = <span class="string">&#x27;./hierarchy/age_hierarchy.txt&#x27;</span></span><br><span class="line">WORKCLASS_CONF = <span class="string">&#x27;./hierarchy/workclass_hierarchy.txt&#x27;</span></span><br><span class="line">EDU_CONF = <span class="string">&#x27;./hierarchy/education_hierarchy.txt&#x27;</span></span><br><span class="line">EDUNUM_CONF = <span class="string">&#x27;./hierarchy/edunum_hierarchy.txt&#x27;</span></span><br><span class="line">MARITAL_CONF = <span class="string">&#x27;./hierarchy/martial_hierarchy.txt&#x27;</span></span><br><span class="line">RELATIONSHIP_CONF = <span class="string">&#x27;./hierarchy/relationship_hierarchy.txt&#x27;</span></span><br><span class="line">RACE_CONF = <span class="string">&#x27;./hierarchy/race_hierarchy.txt&#x27;</span></span><br><span class="line">SEX_CONF = <span class="string">&#x27;./hierarchy/sex_hierarchy.txt&#x27;</span></span><br><span class="line">HPW_CONF = <span class="string">&#x27;./hierarchy/hours_per_week_hierarchy.txt&#x27;</span></span><br><span class="line">COUNTRY_CONF = <span class="string">&#x27;./hierarchy/country_hierarchy.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">title_column = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;workclass&#x27;</span>, <span class="string">&#x27;fnlwgt&#x27;</span>, <span class="string">&#x27;education&#x27;</span>, <span class="string">&#x27;education-num&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;marital-status&#x27;</span>, <span class="string">&#x27;occupation&#x27;</span>, <span class="string">&#x27;relationship&#x27;</span>, <span class="string">&#x27;race&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;capital-gain&#x27;</span>, <span class="string">&#x27;capital-loss&#x27;</span>, <span class="string">&#x27;hours-per-week&#x27;</span>, <span class="string">&#x27;native-country&#x27;</span>, <span class="string">&#x27;class&#x27;</span>]</span><br><span class="line"></span><br><span class="line">QI_INDEX = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">13</span>]</span><br><span class="line">IS_CAT = [<span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>]</span><br><span class="line">SA_INDEX = -<span class="number">1</span></span><br><span class="line">__DEBUG = <span class="literal">False</span></span><br><span class="line">INTUITIVE_ORDER = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">load_data: pd.DataFrame</span>):</span><br><span class="line">    load_data.replace(<span class="string">&#x27; ?&#x27;</span>, np.nan, inplace=<span class="literal">True</span>)</span><br><span class="line">    load_data.dropna(axis=<span class="number">0</span>, how=<span class="string">&#x27;any&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_data</span>():</span><br><span class="line"></span><br><span class="line">    QI_num = <span class="built_in">len</span>(QI_INDEX)</span><br><span class="line">    data = []</span><br><span class="line">    intuitive_dict = []</span><br><span class="line">    intuitive_order = []</span><br><span class="line">    intuitive_number = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(QI_num):</span><br><span class="line">        intuitive_dict.append(<span class="built_in">dict</span>())</span><br><span class="line">        intuitive_number.append(<span class="number">0</span>)</span><br><span class="line">        intuitive_order.append(<span class="built_in">list</span>())</span><br><span class="line">    data_file = <span class="built_in">open</span>(<span class="string">&#x27;Adult Data Set/adult.data.txt&#x27;</span>, <span class="string">&#x27;rU&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data_file:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="comment"># remove empty and incomplete lines</span></span><br><span class="line">        <span class="comment"># only 30162 records will be kept</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span> <span class="keyword">or</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># remove double spaces</span></span><br><span class="line">        line = line.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        temp = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        ltemp = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(QI_num):</span><br><span class="line">            index = QI_INDEX[i]</span><br><span class="line">            <span class="keyword">if</span> IS_CAT[i]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    ltemp.append(intuitive_dict[i][temp[index]])</span><br><span class="line">                <span class="keyword">except</span> KeyError:</span><br><span class="line">                    intuitive_dict[i][temp[index]] = intuitive_number[i]</span><br><span class="line">                    ltemp.append(intuitive_number[i])</span><br><span class="line">                    intuitive_number[i] += <span class="number">1</span></span><br><span class="line">                    intuitive_order[i].append(temp[index])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ltemp.append(<span class="built_in">int</span>(temp[index]))</span><br><span class="line">        ltemp.append(temp[SA_INDEX])</span><br><span class="line">        data.append(ltemp)</span><br><span class="line">    <span class="keyword">return</span> data, intuitive_order</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">txt_Reader</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename</span>):</span><br><span class="line">        self.filename = filename</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_txt</span>(<span class="params">self, path: <span class="built_in">str</span>, title_column: <span class="built_in">list</span></span>) -&gt; pd.DataFrame:</span><br><span class="line">        filepath = path + self.filename</span><br><span class="line">        txtlist = []</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, encoding=<span class="string">&#x27;gbk&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">                txtlist.append(line.strip().split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> pd.DataFrame(txtlist, columns=title_column)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">xlsx_Reader</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename</span>):</span><br><span class="line">        self.filename = filename</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_xlsx</span>(<span class="params">self, path: <span class="built_in">str</span></span>) -&gt; pd.DataFrame:</span><br><span class="line">        filepath = path + self.filename</span><br><span class="line">        <span class="keyword">return</span> pd.read_excel(filepath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_result</span>(<span class="params">result, k</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;res/adult_%d_kanonymity.data&quot;</span> %k, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> result:</span><br><span class="line">            f.write(<span class="string">&#x27;,&#x27;</span>.join(line) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">df2list</span>(<span class="params">df: pd.DataFrame</span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    data_array = np.array(df)</span><br><span class="line">    new_data_array = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> data_array:</span><br><span class="line">        line = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> item:</span><br><span class="line">            line.append(i.strip())</span><br><span class="line">        new_data_array.append(line)</span><br><span class="line">    <span class="keyword">return</span> new_data_array</span><br><span class="line">    <span class="comment">#return data_array.tolist()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_categorical_loss_metric_map</span>(<span class="params">leaves_num, hierarchies</span>):</span><br><span class="line">    loss_metric_map = &#123;attr: &#123;&#125; <span class="keyword">for</span> attr <span class="keyword">in</span> hierarchies.keys()&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nleaves_num:\n&#x27;</span>, leaves_num)</span><br><span class="line">    <span class="keyword">for</span> attr, vals <span class="keyword">in</span> hierarchies.items():</span><br><span class="line">        loss_metric_map[attr][<span class="string">&#x27;*&#x27;</span>] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> vals:</span><br><span class="line">            <span class="keyword">if</span> v <span class="keyword">in</span> leaves_num[attr].keys():</span><br><span class="line">                loss_metric_map[attr][v] = (leaves_num[attr][v] - <span class="number">1</span>) / (leaves_num[attr][<span class="string">&#x27;*&#x27;</span>] - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                loss_metric_map[attr][v] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> loss_metric_map</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">categorical_loss_metric</span>(<span class="params">qi_columns, leaves_num, hierarchies, sup</span>):</span><br><span class="line">    loss_metric_map = generate_categorical_loss_metric_map(leaves_num, hierarchies)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nloss_metric_map:\n&#x27;</span>, loss_metric_map)</span><br><span class="line">    loss_metric = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> qi_columns:</span><br><span class="line">        col = qi_columns[attr].tolist()</span><br><span class="line">        <span class="comment"># the loss for an attribute is the AVERAGE of the loss for all tuples</span></span><br><span class="line">        <span class="comment"># the loss for the entire data set is the SUM of the losses for each attribute</span></span><br><span class="line">        sum_attr_lm = <span class="built_in">sum</span>([loss_metric_map[attr][<span class="built_in">str</span>(v)] <span class="keyword">for</span> v <span class="keyword">in</span> col])</span><br><span class="line">        loss_metric += (sum_attr_lm + sup) / (<span class="built_in">len</span>(col) + sup)</span><br><span class="line">    <span class="keyword">return</span> loss_metric</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_numerical_loss_metric</span>(<span class="params">column</span>):</span><br><span class="line">    loss = <span class="number">0</span></span><br><span class="line">    <span class="comment"># initialize lowest and highest values</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(column[<span class="number">0</span>], <span class="built_in">int</span>):  <span class="comment"># string value, e.g., &#x27;35-40&#x27;</span></span><br><span class="line">        current_range = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(column[<span class="number">0</span>].replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;-&#x27;</span>))]</span><br><span class="line">        lowest, highest = current_range[<span class="number">0</span>], current_range[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># integer value, e.g., 37</span></span><br><span class="line">        lowest, highest = column[<span class="number">0</span>], column[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># iterate through column</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> column:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(v, <span class="built_in">int</span>):  <span class="comment"># extract range from table content (string, e.g., &#x27;35-40&#x27;)</span></span><br><span class="line">            current_range = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(v.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;-&#x27;</span>))]</span><br><span class="line">            loss += current_range[<span class="number">1</span>] - current_range[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># update lowest &amp; highest</span></span><br><span class="line">            lowest = <span class="built_in">min</span>(lowest, current_range[<span class="number">0</span>])</span><br><span class="line">            highest = <span class="built_in">max</span>(highest, current_range[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># integer value, loss is 0 here</span></span><br><span class="line">            lowest = <span class="built_in">min</span>(lowest, v)</span><br><span class="line">            highest = <span class="built_in">max</span>(highest, v)</span><br><span class="line"></span><br><span class="line">    max_range = highest - lowest</span><br><span class="line">    <span class="keyword">return</span> loss / (max_range * <span class="built_in">len</span>(column))  <span class="comment"># average</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numerical_loss_metric</span>(<span class="params">qi_columns</span>):</span><br><span class="line">    loss_metric = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> qi_columns:</span><br><span class="line">        col = qi_columns[attr].tolist()</span><br><span class="line">        <span class="comment"># the loss for the entire data set is the SUM of the losses for each attribute</span></span><br><span class="line">        loss_metric += compute_numerical_loss_metric(col)</span><br><span class="line">    <span class="keyword">return</span> loss_metric</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; y:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> x==y:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp_str</span>(<span class="params">element1, element2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    compare number in str format correctley</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> cmp(<span class="built_in">int</span>(element1), <span class="built_in">int</span>(element2))</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> cmp(element1, element2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp_value</span>(<span class="params">element1, element2</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(element1, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> cmp_str(element1, element2)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> cmp(element1, element2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">value</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Return the numeric type that supports addition and subtraction&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">float</span>(x)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(x, datetime):</span><br><span class="line">        <span class="keyword">return</span> time.mktime(x.timetuple())</span><br><span class="line">        <span class="comment"># return x.timestamp() # not supported by python 2.7</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">float</span>(x)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_qi_value</span>(<span class="params">x_left, x_right, connect_str=<span class="string">&#x27;~&#x27;</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Connect the interval boundary value as a generalized interval and return the result as a string</span></span><br><span class="line"><span class="string">    return:</span></span><br><span class="line"><span class="string">        result:string</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(x_left, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">        <span class="keyword">if</span> x_left == x_right:</span><br><span class="line">            result = <span class="string">&#x27;%d&#x27;</span> % (x_left)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = <span class="string">&#x27;%d%s%d&#x27;</span> % (x_left, connect_str, x_right)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(x_left, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">if</span> x_left == x_right:</span><br><span class="line">            result = x_left</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = x_left + connect_str + x_right</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(x_left, datetime):</span><br><span class="line">        <span class="comment"># Generalize the datetime type value</span></span><br><span class="line">        begin_date = x_left.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        end_date = x_right.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">        result = begin_date + connect_str + end_date</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_to_file</span>(<span class="params">result, k</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;res/adult_%d_kanonymity.data&quot;</span> %k, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> output:</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> result:</span><br><span class="line">            output.write(<span class="string">&#x27;;&#x27;</span>.join(r) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">covert_to_raw</span>(<span class="params">result, order, connect_str=<span class="string">&#x27;~&#x27;</span></span>):</span><br><span class="line"></span><br><span class="line">    covert_result = []</span><br><span class="line">    qi_len = <span class="built_in">len</span>(order)</span><br><span class="line">    <span class="keyword">for</span> record <span class="keyword">in</span> result:</span><br><span class="line">        covert_record = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(qi_len):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(order[i]) &gt; <span class="number">0</span>:</span><br><span class="line">                vtemp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> connect_str <span class="keyword">in</span> record[i]:</span><br><span class="line">                    temp = record[i].split(connect_str)</span><br><span class="line">                    raw_list = []</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(temp[<span class="number">0</span>]), <span class="built_in">int</span>(temp[<span class="number">1</span>]) + <span class="number">1</span>):</span><br><span class="line">                        raw_list.append(order[i][j])</span><br><span class="line">                    vtemp = connect_str.join(raw_list)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    vtemp = order[i][<span class="built_in">int</span>(record[i])]</span><br><span class="line">                covert_record.append(vtemp)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                covert_record.append(record[i])</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(record[-<span class="number">1</span>], <span class="built_in">str</span>):</span><br><span class="line">            covert_result.append(covert_record + [record[-<span class="number">1</span>]])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            covert_result.append(covert_record + [connect_str.join(record[-<span class="number">1</span>])])</span><br><span class="line">    <span class="keyword">return</span> covert_result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_scale</span>(<span class="params">age: <span class="built_in">str</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    pos = age.find(<span class="string">&quot;~&quot;</span>)</span><br><span class="line">    low = age[<span class="number">0</span>:pos]</span><br><span class="line">    high = age[pos + <span class="number">1</span>:<span class="built_in">len</span>(age)]</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>(low) + <span class="built_in">int</span>(high)) / <span class="number">2.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_post_ages</span>(<span class="params">post_ages: <span class="built_in">list</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    post_sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> post_ages:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;~&quot;</span> <span class="keyword">in</span> item:</span><br><span class="line">            post_sum += split_scale(item)</span><br><span class="line">        <span class="keyword">else</span>: post_sum += <span class="built_in">int</span>(item)*<span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> post_sum / <span class="built_in">len</span>(post_ages)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avg_ages</span>(<span class="params">ages: <span class="built_in">list</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(ages) / <span class="built_in">len</span>(ages)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diff_privacy_add_laplace_noise</span>(<span class="params">ages: <span class="built_in">list</span>, loc, scale</span>):</span><br><span class="line">    laplace_noise = np.random.laplace(loc, scale, <span class="built_in">len</span>(ages))</span><br><span class="line">    res = [ages[i] + laplace_noise[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ages))]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰è’™å¾·é‡Œå®‰åº“çš„ä»£ç å»githubä¸Šéšä¾¿æ‰¾ä¸€ä¸ªå°±è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹ç”µè„‘æ‰‹æœºé»‘å¤œç™½å¤©å››èƒŒæ™¯</title>
      <link href="/2024/05/02/2024-5-2-%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B-2/"/>
      <url>/2024/05/02/2024-5-2-%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹ç”µè„‘æ‰‹æœºé»‘å¤œç™½å¤©å››èƒŒæ™¯">åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹ç”µè„‘æ‰‹æœºé»‘å¤œç™½å¤©å››èƒŒæ™¯</h3><p>ä¸»è¦åšçš„é€‚é…æ˜¯æ‰‹æœºç«¯çš„èƒŒæ™¯, æ‰‹æœºç«¯èƒŒæ™¯å’Œç”µè„‘ç«¯èƒŒæ™¯æ˜¯ä¸åŒçš„, å› ä¸ºæ‰‹æœºç«¯å±å¹•æ¯”è¾ƒå°, ç”µè„‘ç«¯èƒŒæ™¯åœ¨æ‰‹æœºç«¯åªèƒ½æ˜¾ç¤ºä¸­é—´çš„ä¸€éƒ¨åˆ†, æ˜¾ç¤ºæ•ˆæœå·®, æ‰€ä»¥è¦åšé€‚é…,æ•ˆæœå¦‚ä¸‹</p><p>ç”µè„‘ç«¯ç™½å¤©èƒŒæ™¯:<br><img src="https://pb01.s3.bitiful.net/75.webp" alt="avatar"></p><p>æ‰‹æœºç«¯ç™½å¤©èƒŒæ™¯:<br><img src="https://pb01.s3.bitiful.net/206.webp" alt="avatar"></p><h4 id="pcç«¯ç™½å¤©é»‘å¤œåŒèƒŒæ™¯">pcç«¯ç™½å¤©é»‘å¤œåŒèƒŒæ™¯</h4><p>ä¿®æ”¹<code>[BlogRoot]\themes\butterfly\layout\includes\layout.pug</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ - var DefaultBg = page.defaultbg ? page.defaultbg : theme.background.default</span></span><br><span class="line"><span class="addition">+ - var DDMBg = theme.background.darkmode ? theme.background.darkmode : DefaultBg</span></span><br><span class="line"><span class="addition">+ - var DarkmodeBg = page.darkmodebg ? page.darkmodebg : DDMBg</span></span><br><span class="line">  if theme.background</span><br><span class="line">    #web_bg</span><br><span class="line"><span class="addition">+     if page.defaultbg || page.darkmodebg</span></span><br><span class="line"><span class="addition">+       style.</span></span><br><span class="line"><span class="addition">+         #web_bg&#123;</span></span><br><span class="line"><span class="addition">+           background: #&#123;DefaultBg&#125; !important;</span></span><br><span class="line"><span class="addition">+           background-attachment: local!important;</span></span><br><span class="line"><span class="addition">+           background-position: center!important;</span></span><br><span class="line"><span class="addition">+           background-size: cover!important;</span></span><br><span class="line"><span class="addition">+           background-repeat: no-repeat!important;</span></span><br><span class="line"><span class="addition">+         &#125;</span></span><br><span class="line"><span class="addition">+         [data-theme=&quot;dark&quot;]</span></span><br><span class="line"><span class="addition">+           #web_bg&#123;</span></span><br><span class="line"><span class="addition">+             background: #&#123;DarkmodeBg&#125; !important;</span></span><br><span class="line"><span class="addition">+             background-attachment: local!important;</span></span><br><span class="line"><span class="addition">+             background-position: center!important;</span></span><br><span class="line"><span class="addition">+             background-size: cover!important;</span></span><br><span class="line"><span class="addition">+             background-repeat: no-repeat!important;</span></span><br><span class="line"><span class="addition">+           &#125;</span></span><br></pre></td></tr></table></figure><h4 id="æ‰‹æœºç«¯ç™½å¤©é»‘å¤œåŒèƒŒæ™¯">æ‰‹æœºç«¯ç™½å¤©é»‘å¤œåŒèƒŒæ™¯</h4><p>åœ¨<code>[BlogRoot]\themes\butterfly\source\css\_layout</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>web-bg.styl</code>æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$web</span>-bg-night = <span class="built_in">hexo-config</span>(<span class="string">&#x27;background.darkmode&#x27;</span>) ? <span class="built_in">unquote</span>(<span class="built_in">hexo-config</span>(<span class="string">&#x27;background.darkmode&#x27;</span>)) : <span class="variable">$web</span>-bg</span><br><span class="line"><span class="variable">$mobile</span>-bg-day = <span class="built_in">hexo-config</span>(<span class="string">&#x27;background.mobileday&#x27;</span>) ? <span class="built_in">unquote</span>(<span class="built_in">hexo-config</span>(<span class="string">&#x27;background.mobileday&#x27;</span>)) : <span class="variable">$web</span>-bg</span><br><span class="line"><span class="variable">$mobile</span>-bg-night = <span class="built_in">hexo-config</span>(<span class="string">&#x27;background.mobilenight&#x27;</span>) ? <span class="built_in">unquote</span>(<span class="built_in">hexo-config</span>(<span class="string">&#x27;background.mobilenight&#x27;</span>)) : <span class="variable">$web</span>-bg-night</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#web_bg</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="variable">$web</span>-bg-night</span><br><span class="line">    <span class="attribute">background-attachment</span>: local</span><br><span class="line">    <span class="attribute">background-position</span>: center</span><br><span class="line">    <span class="attribute">background-size</span>: cover</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">800px</span>)</span><br><span class="line">  #web_bg</span><br><span class="line">    background: $mobile-bg-day !important</span><br><span class="line">    background-attachment: local !important</span><br><span class="line">    background-position: center !important</span><br><span class="line">    background-size: cover !important</span><br><span class="line">    background-repeat: no-repeat !important</span><br><span class="line">  [data-theme=&quot;dark&quot;]</span><br><span class="line">    #web_bg</span><br><span class="line">      background: $mobile-bg-night !important</span><br><span class="line">      background-attachment: local !important</span><br><span class="line">      background-position: center !important</span><br><span class="line">      background-size: cover !important</span><br><span class="line">      background-repeat: no-repeat !important</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–ä¿®æ”¹">å…¶ä»–ä¿®æ”¹</h4><p>ä¿®æ”¹<code>[BlogRoot]\themes\butterfly\source\css\var.styl</code>,åœ¨çº¦34è¡Œ</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  $text-line-height = 2</span><br><span class="line"><span class="deletion">- $web-bg = hexo-config(&#x27;background&#x27;) &amp;&amp; unquote(hexo-config(&#x27;background&#x27;))</span></span><br><span class="line"><span class="addition">+ $web-bg = hexo-config(&#x27;background.default&#x27;) &amp;&amp; unquote(hexo-config(&#x27;background.default&#x27;))</span></span><br><span class="line">  $index_top_img_height = hexo-config(&#x27;index_top_img_height&#x27;) ? convert(hexo-config(&#x27;index_top_img_height&#x27;)) : 100vh</span><br></pre></td></tr></table></figure><p>åœ¨<code>[BlogRoot]/_config.butterfly.yml</code>ä¸­æ‰¾åˆ°backgroundé…ç½®é¡¹ï¼Œä¿®æ”¹ä¸ºï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">background:</span></span><br><span class="line">  <span class="attr">default:</span>  <span class="comment">#ã€å¿…é€‰ã€‘é»˜è®¤èƒŒæ™¯</span></span><br><span class="line">  <span class="attr">darkmode:</span> <span class="comment">#ã€å¯é€‰ã€‘PCç«¯å¤œé—´æ¨¡å¼èƒŒæ™¯</span></span><br><span class="line">  <span class="attr">mobileday:</span> <span class="comment">#ã€å¯é€‰ã€‘ç§»åŠ¨ç«¯æ—¥é—´é»˜è®¤èƒŒæ™¯</span></span><br><span class="line">  <span class="attr">mobilenight:</span> <span class="comment">#ã€å¯é€‰ã€‘ç§»åŠ¨ç«¯å¤œé—´æ¨¡å¼èƒŒæ™¯</span></span><br></pre></td></tr></table></figure><p>æœ€åhexoä¸‰è¿å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> é­”æ”¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹å…¬å‘Šæ æ¬¢è¿ä¿¡æ¯</title>
      <link href="/2024/04/29/2024-4-29-%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B-1/"/>
      <url>/2024/04/29/2024-4-29-%E5%8D%9A%E5%AE%A2%E9%AD%94%E6%94%B9%E6%95%99%E7%A8%8B-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹å…¬å‘Šæ æ¬¢è¿ä¿¡æ¯">åšå®¢é­”æ”¹æ•™ç¨‹ä¹‹å…¬å‘Šæ æ¬¢è¿ä¿¡æ¯</h3><p>æœ€ç»ˆçš„æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·çš„:</p><p><img src="https://pb01.s3.bitiful.net/196.webp" alt="avatar"></p><h4 id="è…¾è®¯ä½ç½®æœåŠ¡">è…¾è®¯ä½ç½®æœåŠ¡</h4><p>åœ¨<a href="https://lbs.qq.com/map/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">è…¾è®¯ä½ç½®æœåŠ¡</a>æ³¨å†Œè´¦å·å, è¿›å…¥æ§åˆ¶å°â€“&gt;åº”ç”¨ç®¡ç†â€“&gt;æˆ‘çš„åº”ç”¨, ç‚¹å‡»åˆ›å»ºåº”ç”¨:</p><p><img src="https://pb01.s3.bitiful.net/197.webp" alt="avatar"></p><p>åº”ç”¨åç§°å’Œåº”ç”¨ç±»å‹éšä¾¿å¡«, åˆ›å»ºå®Œæˆå, ç‚¹å‡»æ·»åŠ key:<br><img src="https://pb01.s3.bitiful.net/198.webp" alt="avatar"></p><p>ç„¶ååˆ°é…é¢ç®¡ç†â€“&gt;è´¦æˆ·é¢åº¦,æ‰¾åˆ°ipå®šä½è¿™ä¸€é¡¹, ç‚¹å‡»é…é¢åˆ†é…, æ ¹æ®è‡ªå·±éœ€æ±‚åˆ†å°±å¯ä»¥:<br><img src="https://pb01.s3.bitiful.net/199.webp" alt="avatar"></p><p>è¿›å…¥å¼€å‘æ–‡æ¡£, åç»­çš„ä»£ç ä¹Ÿæ˜¯åŸºäºæ­¤å¼€å‘å‡ºæ¥çš„:<br><img src="https://pb01.s3.bitiful.net/200.webp" alt="avatar"></p><p>æµ‹è¯•ä¸‹è‡ªå·±çš„key(<strong>éå¿…è¦</strong>), è¯·æ±‚ç¤ºä¾‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://apis.map.qq.com/ws/location/v1/ip?ip=111.206.145.41&amp;key=[ä½ çš„key]</span><br></pre></td></tr></table></figure><p>æµ‹è¯•çš„è¯è®°å¾—æŠŠæ ¡éªŒå…³äº†, åƒæˆ‘è¿™æ ·è®¾ç½®å°±è¦æŠŠåŸŸåç™½åå•è®¾ç½®ä¸ºç©º</p><p>æµ‹è¯•ç»“æœå¦‚ä¸‹:<br><img src="https://pb01.s3.bitiful.net/201.webp" alt="avatar"></p><p>æµ‹è¯•ç»“æœæ²¡é—®é¢˜å°±å¯ä»¥ç»§ç»­äº†</p><h4 id="å…¶ä»–é…ç½®">å…¶ä»–é…ç½®</h4><ol><li><strong>æ–°å»º[BlogRoot]\source\js\txmap.js</strong>ï¼Œå¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼Œè®°ä½æ›¿æ¢keyçš„å†…å®¹å’Œè‡ªå·±æ‰€åœ¨ä½ç½®çš„ç»çº¬åº¦ï¼š</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ipLocation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showWelcomeIfReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ipLocation &amp;&amp; ipLocation.<span class="property">result</span> &amp;&amp; ipLocation.<span class="property">result</span>.<span class="property">location</span>) &#123;</span><br><span class="line">        <span class="title function_">showWelcome</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;ipLocation is not ready yet.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getè¯·æ±‚</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://apis.map.qq.com/ws/location/v1/ip&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&#x27;è‡ªå·±çš„key&#x27;</span>,</span><br><span class="line">        <span class="attr">output</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        ipLocation = res;</span><br><span class="line">        <span class="title function_">showWelcomeIfReady</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching ip location:&#x27;</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDistance</span>(<span class="params">e1, n1, e2, n2</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> R = <span class="number">6371</span></span><br><span class="line">    <span class="keyword">const</span> &#123; sin, cos, asin, <span class="variable constant_">PI</span>, hypot &#125; = <span class="title class_">Math</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">getPoint</span> = (<span class="params">e, n</span>) =&gt; &#123;</span><br><span class="line">        e *= <span class="variable constant_">PI</span> / <span class="number">180</span></span><br><span class="line">        n *= <span class="variable constant_">PI</span> / <span class="number">180</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">x</span>: <span class="title function_">cos</span>(n) * <span class="title function_">cos</span>(e), <span class="attr">y</span>: <span class="title function_">cos</span>(n) * <span class="title function_">sin</span>(e), <span class="attr">z</span>: <span class="title function_">sin</span>(n) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> a = <span class="title function_">getPoint</span>(e1, n1)</span><br><span class="line">    <span class="keyword">let</span> b = <span class="title function_">getPoint</span>(e2, n2)</span><br><span class="line">    <span class="keyword">let</span> c = <span class="title function_">hypot</span>(a.<span class="property">x</span> - b.<span class="property">x</span>, a.<span class="property">y</span> - b.<span class="property">y</span>, a.<span class="property">z</span> - b.<span class="property">z</span>)</span><br><span class="line">    <span class="keyword">let</span> r = <span class="title function_">asin</span>(c / <span class="number">2</span>) * <span class="number">2</span> * R</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">round</span>(r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showWelcome</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> dist = <span class="title function_">getDistance</span>(ç»åº¦, çº¬åº¦, ipLocation.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lng</span>, ipLocation.<span class="property">result</span>.<span class="property">location</span>.<span class="property">lat</span>); <span class="comment">//è¿™é‡Œæ¢æˆè‡ªå·±çš„ç»çº¬åº¦</span></span><br><span class="line">    <span class="keyword">let</span> pos = ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">nation</span>;</span><br><span class="line">    <span class="keyword">let</span> ip;</span><br><span class="line">    <span class="keyword">let</span> posdesc;</span><br><span class="line">    <span class="comment">//æ ¹æ®å›½å®¶ã€çœä»½ã€åŸå¸‚ä¿¡æ¯è‡ªå®šä¹‰æ¬¢è¿è¯­</span></span><br><span class="line">    <span class="keyword">switch</span> (ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">nation</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;æ—¥æœ¬&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;ã‚ˆã‚ã—ãï¼Œä¸€èµ·å»çœ‹æ¨±èŠ±å—&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ç¾å›½&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;Let us live in peace!&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;è‹±å›½&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;æƒ³åŒä½ ä¸€èµ·å¤œä¹˜ä¼¦æ•¦çœ¼&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ä¿„ç½—æ–¯&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;æ³•å›½&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;C&#x27;est La Vie&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;å¾·å›½&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;Die Zeit verging im Fluge.&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;æ¾³å¤§åˆ©äºš&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;ä¸€èµ·å»å¤§å ¡ç¤å§ï¼&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;åŠ æ‹¿å¤§&quot;</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ä¸­å›½&quot;</span>:</span><br><span class="line">            pos = ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">province</span> + <span class="string">&quot; &quot;</span> + ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">city</span> + <span class="string">&quot; &quot;</span> + ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">district</span>;</span><br><span class="line">            ip = ipLocation.<span class="property">result</span>.<span class="property">ip</span>;</span><br><span class="line">            <span class="keyword">switch</span> (ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">province</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;åŒ—äº¬å¸‚&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å¤©æ´¥å¸‚&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;è®²æ®µç›¸å£°å§ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ²³åŒ—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å±±åŠ¿å·å·æˆå£å’ï¼Œå¤©ä¸‹é›„å…³ã€‚é“é©¬é‡‘æˆˆç”±æ­¤å‘ï¼Œæ— é™æ±Ÿå±±ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å±±è¥¿çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å±•å¼€åå…·é•¿ä¸‰å°ºï¼Œå·²å å±±æ²³äº”ç™¾ä½™ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å†…è’™å¤è‡ªæ²»åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å¤©è‹è‹ï¼Œé‡èŒ«èŒ«ï¼Œé£å¹è‰ä½è§ç‰›ç¾Šã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;è¾½å®çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æˆ‘æƒ³åƒçƒ¤é¸¡æ¶ï¼&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å‰æ—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;çŠ¶å…ƒé˜å°±æ˜¯ä¸œåŒ—çƒ§çƒ¤ä¹‹ç‹ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é»‘é¾™æ±Ÿçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å¾ˆå–œæ¬¢å“ˆå°”æ»¨å¤§å‰§é™¢ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;ä¸Šæµ·å¸‚&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½åªæœ‰ä¸¤ä¸ªåŸå¸‚ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ±Ÿè‹çœ&quot;</span>:</span><br><span class="line">                    <span class="keyword">switch</span> (ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">city</span>) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;å—äº¬å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;è¿™æ˜¯æˆ‘æŒºæƒ³å»çš„åŸå¸‚å•¦ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;è‹å·å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;ä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="attr">default</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;æ•£è£…æ˜¯å¿…é¡»è¦æ•£è£…çš„ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æµ™æ±Ÿçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;ä¸œé£æ¸ç»¿è¥¿æ¹–æŸ³ï¼Œé›å·²è¿˜äººæœªå—å½’ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ²³å—çœ&quot;</span>:</span><br><span class="line">                    <span class="keyword">switch</span> (ipLocation.<span class="property">result</span>.<span class="property">ad_info</span>.<span class="property">city</span>) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;éƒ‘å·å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;å—é˜³å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;è‡£æœ¬å¸ƒè¡£ï¼Œèº¬è€•äºå—é˜³ã€‚æ­¤å—é˜³éå½¼å—é˜³ï¼&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;é©»é©¬åº—å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;å³°å³°æœ‰å¥‡çŸ³ï¼ŒçŸ³çŸ³æŒŸä»™æ°”ã€‚åµ–å²ˆå±±çš„èŠ±å¾ˆç¾å“¦ï¼&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;å¼€å°å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;åˆšæ­£ä¸é˜¿åŒ…é’å¤©ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">&quot;æ´›é˜³å¸‚&quot;</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;æ´›é˜³ç‰¡ä¸¹ç”²å¤©ä¸‹ã€‚&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="attr">default</span>:</span><br><span class="line">                            posdesc = <span class="string">&quot;å¯å¦å¸¦æˆ‘å“å°æ²³å—çƒ©é¢å•¦ï¼Ÿ&quot;</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å®‰å¾½çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;èšŒåŸ ä½äº†ï¼ŒèŠœæ¹–èµ·é£ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;ç¦å»ºçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;äº•é‚‘ç™½äº‘é—´ï¼Œå²©åŸè¿œå¸¦å±±ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ±Ÿè¥¿çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å±±ä¸œçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;é¥æœ›é½å·ä¹ç‚¹çƒŸï¼Œä¸€æ³“æµ·æ°´æ¯ä¸­æ³»ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ¹–åŒ—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æ¥ç¢—çƒ­å¹²é¢ï¼&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ¹–å—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;74751ï¼Œé•¿æ²™æ–¯å¡”å…‹ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å¹¿ä¸œçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;è€æ¿æ¥ä¸¤æ–¤ç¦å»ºäººã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å¹¿è¥¿å£®æ—è‡ªæ²»åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æµ·å—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æœè§‚æ—¥å‡ºé€ç™½æµªï¼Œå¤•çœ‹äº‘èµ·æ”¶éœå…‰ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å››å·çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;åº·åº·å·å¦¹å­ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;è´µå·çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;èŒ…å°ï¼Œå­¦ç”Ÿï¼Œå†å¡200ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;äº‘å—çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;ç‰é¾™é£èˆäº‘ç¼ ç»•ï¼Œä¸‡ä»å†°å·ç›´è€¸å¤©ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;è¥¿è—è‡ªæ²»åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;èººåœ¨èŒ«èŒ«è‰åŸä¸Šï¼Œä»°æœ›è“å¤©ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é™•è¥¿çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æ¥ä»½è‡Šå­é¢åŠ é¦ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;ç”˜è‚ƒçœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³ï¼Œæ˜¥é£ä¸åº¦ç‰é—¨å…³ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é’æµ·çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;ç‰›è‚‰å¹²å’Œè€é…¸å¥¶éƒ½å¥½å¥½åƒã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å®å¤å›æ—è‡ªæ²»åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;é©¼é“ƒå¤é“ä¸ç»¸è·¯ï¼Œèƒ¡é©¬çŠ¹é—»å”æ±‰é£ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;å°æ¹¾çœ&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æˆ‘åœ¨è¿™å¤´ï¼Œå¤§é™†åœ¨é‚£å¤´ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æ°¸å®šè´¼æœ‰æ®‹ç•™åœ°é¬¼åšï¼Œè¿å‡»å…‰éå²ç‰ã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº&quot;</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;æ€§æ„Ÿè·å®˜ï¼Œåœ¨çº¿å‘ç‰Œã€‚&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="attr">default</span>:</span><br><span class="line">                    posdesc = <span class="string">&quot;å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            posdesc = <span class="string">&quot;å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§ã€‚&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®æœ¬åœ°æ—¶é—´åˆ‡æ¢æ¬¢è¿è¯­</span></span><br><span class="line">    <span class="keyword">let</span> timeChange;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">5</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">11</span>) timeChange = <span class="string">&quot;&lt;span&gt;ä¸Šåˆå¥½&lt;/span&gt;ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">11</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">13</span>) timeChange = <span class="string">&quot;&lt;span&gt;ä¸­åˆå¥½&lt;/span&gt;ï¼Œè¯¥æ‘¸é±¼åƒåˆé¥­äº†ã€‚&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">13</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">15</span>) timeChange = <span class="string">&quot;&lt;span&gt;ä¸‹åˆå¥½&lt;/span&gt;ï¼Œæ‡’æ‡’åœ°ç¡ä¸ªåˆè§‰å§ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">15</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">16</span>) timeChange = <span class="string">&quot;&lt;span&gt;ä¸‰ç‚¹å‡ å•¦&lt;/span&gt;ï¼Œä¸€èµ·é¥®èŒ¶å‘€ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">16</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">19</span>) timeChange = <span class="string">&quot;&lt;span&gt;å¤•é˜³æ— é™å¥½ï¼&lt;/span&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (date.<span class="title function_">getHours</span>() &gt;= <span class="number">19</span> &amp;&amp; date.<span class="title function_">getHours</span>() &lt; <span class="number">24</span>) timeChange = <span class="string">&quot;&lt;span&gt;æ™šä¸Šå¥½&lt;/span&gt;ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> timeChange = <span class="string">&quot;å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯ï¼Œå°‘ç†¬å¤œã€‚&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰æ–‡æœ¬å’Œéœ€è¦æ”¾çš„ä½ç½®</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;welcome-info&quot;</span>).<span class="property">innerHTML</span> =</span><br><span class="line">            <span class="string">`&lt;b&gt;&lt;center&gt;ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰&lt;/center&gt;&amp;emsp;&amp;emsp;æ¬¢è¿æ¥è‡ª &lt;span style=&quot;color:#5ea6e5&quot;&gt;<span class="subst">$&#123;pos&#125;</span>&lt;/span&gt; çš„å°ä¼™ä¼´ï¼Œ<span class="subst">$&#123;timeChange&#125;</span>æ‚¨ç°åœ¨è·ç¦»ç«™é•¿çº¦ &lt;span style=&quot;color:#5ea6e5&quot;&gt;<span class="subst">$&#123;dist&#125;</span>&lt;/span&gt; å…¬é‡Œï¼Œå½“å‰çš„IPåœ°å€ä¸ºï¼š &lt;span style=&quot;color:#5ea6e5&quot;&gt;<span class="subst">$&#123;ip&#125;</span>&lt;/span&gt;ï¼Œ <span class="subst">$&#123;posdesc&#125;</span>&lt;/b&gt;`</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">// console.log(&quot;Pjaxæ— æ³•è·å–#welcome-infoå…ƒç´ ğŸ™„ğŸ™„ğŸ™„&quot;)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœä½¿ç”¨äº†pjaxåœ¨åŠ ä¸Šä¸‹é¢è¿™è¡Œä»£ç </span></span><br><span class="line"><span class="comment">// document.addEventListener(&#x27;pjax:complete&#x27;, showWelcome);</span></span><br></pre></td></tr></table></figure><ol start="2"><li><strong>åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶[BlogRoot]_config.butterfly.yml</strong>ä¸­å¼•å…¥jQueryä¾èµ–å’Œåˆšåˆšçš„jsæ–‡ä»¶ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inject: </span><br><span class="line">  bottom: </span><br><span class="line">    - &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js&quot;&gt;&lt;/script&gt; # jQuery</span><br><span class="line">    - &lt;script async data-pjax src=&quot;/js/txmap.js&quot;&gt;&lt;/script&gt; # è…¾è®¯ä½ç½®API</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>åœ¨[BlogRoot]\themes\butterfly\layout\includes\widget\card_announcement.pug</strong>çš„æœ€åä¸€è¡ŒåŠ ä¸Šè¿™ä¸ª, è¿™ä¸ªå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ›´æ”¹æ·»åŠ çš„ä½ç½®</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//- æ·»åŠ æ¬¢è¿è®¿å®¢çš„ä¿¡æ¯</span><br><span class="line">#welcome-info</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœ</strong>å½“å‰themesç›®å½•ä¸ºç©º, å°†[BlogRoot]\node_modules\hexo-theme-butterflyç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶å¤åˆ¶åˆ°[BlogRoot]\themes\butterflyç›®å½•ä¸‹å³å¯</p><ol start="4"><li><strong>åœ¨[BlogRoot]\source\css\custom.css</strong>é‡Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„å–œå¥½å»æ”¹</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ¬¢è¿ä¿¡æ¯ */</span></span><br><span class="line"><span class="selector-id">#welcome-info</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">45deg</span>, <span class="number">#b9f4f3</span>, <span class="number">#e3fbf9</span>);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#welcome-info</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#212121</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="References">References</h4><p><a href="https://ichika.cc/Article/beautiful_IPLocation/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ç»™åšå®¢æ·»åŠ è…¾è®¯åœ°å›¾å®šä½å¹¶åˆ¶ä½œä¸ªæ€§æ¬¢è¿</a></p><p><a href="https://www.fomal.cc/posts/d739261b.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">åšå®¢é­”æ”¹æ•™ç¨‹æ€»ç»“(å››)</a></p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> é­”æ”¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ</title>
      <link href="/2024/04/24/2024-4-24-B%E6%B5%8B/"/>
      <url>/2024/04/24/2024-4-24-B%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ">è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ</h2><h3 id="enspå®‰è£…è¸©å‘">enspå®‰è£…è¸©å‘</h3><p>æˆ‘è¿™å°ç”µè„‘çš„ç¯å¢ƒæ¯”è¾ƒæ··ä¹±, virtualbox, vmware, dockerä»€ä¹ˆçš„éƒ½æœ‰, è€Œä¸”è¿˜æ˜¯win11, å¯¼è‡´ç–¯ç‹‚è¸©å‘ğŸ¤£, æ•´ä¸ªå®‰è£…å¤§æ¦‚èŠ±è´¹3å°æ—¶ğŸ˜‡</p><h4 id="ç¬¬ä¸€ä¸ªå‘">ç¬¬ä¸€ä¸ªå‘</h4><p>virtualboxç‰ˆæœ¬ä¸æ”¯æŒ, æˆ‘ç”µè„‘ä¸Šçš„virtualboxæ˜¯7.0.xç‰ˆæœ¬çš„, ä¸è€ç‰ˆenspä¸å…¼å®¹, éœ€è¦é™çº§åˆ°5.2.xç‰ˆæœ¬, æœ€ç»ˆé€‰äº†5.2.44ç‰ˆæœ¬, 5.2.44ç‰ˆæœ¬çš„virtualboxåˆå’Œwin11ä¸å…¼å®¹, éœ€è¦å°†<strong>å†…æ ¸éš”ç¦»</strong>å…³é—­æ‰èƒ½æ­£å¸¸å®‰è£…, è·¯å¾„: è®¾ç½®â€“&gt;éšç§ä¸å®‰å…¨â€“&gt;windowså®‰å…¨ä¸­å¿ƒâ€“&gt;è®¾å¤‡å®‰å…¨æ€§â€“&gt;å†…æ ¸éš”ç¦»</p><h4 id="ç¬¬äºŒä¸ªå‘">ç¬¬äºŒä¸ªå‘</h4><p>é‡è£…ä¹‹åå¯åŠ¨è·¯ç”±å™¨æŠ¥é”™,é”™è¯¯ä»£ç 41, å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://blog.csdn.net/weixin_51515423/article/details/122304503" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">åšå®¢</a>, æ“ä½œä¹‹åå†æ¬¡å¯åŠ¨è·¯ç”±å™¨æŠ¥é”™, é”™è¯¯ä»£ç 40, æ¥ä¸‹æ¥å°±æ˜¯ç¬¬ä¸‰ä¸ªå‘</p><h4 id="ç¬¬ä¸‰ä¸ªå‘">ç¬¬ä¸‰ä¸ªå‘</h4><p>è·¯ç”±å™¨å¯åŠ¨æŠ¥é”™40ä¹‹å, æˆ‘ç…§ç€å®˜æ–¹æ–‡æ¡£ä¸€é€šæ“ä½œ, å‘ç°ä¾æ—§æŠ¥é”™40ğŸ˜…, ç„¶åå†³å®šå…¨éƒ¨å¸è½½é‡è£….</p><p>æ­¥éª¤:</p><ol><li>æ§åˆ¶é¢æ¿å¸è½½eNSPã€VirtualBoxã€Wiresharkã€WinCapå››ä¸ªç¨‹åºï¼Œå¦‚æœå­˜åœ¨USBCapã€Npcapï¼Œä¹Ÿå¸è½½</li><li>ä¾æ¬¡æŸ¥çœ‹å¹¶åˆ é™¤:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\huaweiï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨eNSPæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Program Filesï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨Npcapæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Program Files (x86)ï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨WinCapæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\ProgramDataï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨VirtualBoxæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Users\ä½ çš„ç”¨æˆ·åï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨.virtualboxæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Localï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨eNSPæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br></pre></td></tr></table></figure><ol start="3"><li>æ¸…ç†æ— æ•ˆæ³¨å†Œè¡¨,cmdè¾“å…¥regeditè¿›å…¥, åˆ é™¤ç›¸å…³æ³¨å†Œè¡¨, ä¸»è¦æ˜¯virtualboxç›¸å…³çš„</li></ol><p><strong>ç„¶åé‡è£…,å‘ç°è¿˜æ˜¯æŠ¥é”™40</strong>ğŸ¥°</p><p>ç„¶åæˆ‘ç”¨<strong>virtualboxå»å¯åŠ¨AR_Base</strong>, å¾—åˆ°æŠ¥é”™<code>Raw-mode is unavailable courtesy of Hyper-V. (VERR_SUPDRV_NO_RAW_MODE_HYPER_V_ROOT)</code>, è¿™æ—¶æˆ‘æ„è¯†åˆ°æ˜¯Hyper-Vçš„é—®é¢˜, ä½†æˆ‘çš„Hyper-vå…¶å®æ˜¯æ²¡æœ‰å‹¾é€‰å¯ç”¨çš„, å…¶ä»–<br>ç›¸å…³é€‰é¡¹ä¹Ÿæ²¡æœ‰å‹¾é€‰,å¦‚å›¾:</p><p><img src="https://pb01.s3.bitiful.net/190.webp" alt="avatar"></p><p>æˆ‘æƒ³åˆ°å¯èƒ½æ›¾ç»å®‰è£…Dockerå¼€å¯Hyper-Vå, å³ä½¿ç°åœ¨ä¸å‹¾é€‰äº†, å®ƒä»ç„¶æ²¡æœ‰çœŸæ­£å…³é—­.</p><p>ç®¡ç†å‘˜æƒé™æ‰“å¼€cmd, è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°hypervisorlaunchtypeçš„å€¼æ˜¯Auto,è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /set hypervisorlaunchtype off</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å…³é—­</p><p><img src="https://pb01.s3.bitiful.net/191.webp" alt="avatar"></p><p>æ‰€ä»¥ä¹‹å‰å¦‚æœæ²¡æœ‰å®‰è£…è¿‡Dockeræˆ–è€…åŠ¨è¿‡Hyper-væ˜¯ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜çš„,è§£é‡Šå¦‚ä¸‹:</p><p><strong>hypervisorlaunchtype</strong>æ˜¯Windowsæ“ä½œç³»ç»Ÿçš„å¼•å¯¼é€‰é¡¹ï¼Œç”¨äºæ§åˆ¶å¤„ç†å™¨å’Œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚è¿™ä¸ªé€‰é¡¹çš„å€¼å¯ä»¥æ˜¯&quot;Auto&quot;ã€â€œOff&quot;æˆ–&quot;Hypervisorâ€ã€‚å®ƒçš„é»˜è®¤å€¼ä¸º&quot;Auto&quot;ï¼Œè¡¨ç¤ºå¤„ç†å™¨å°†æ ¹æ®éœ€è¦è‡ªåŠ¨å¯ç”¨æˆ–ç¦ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚1å¦‚æœWindowsä¸­å®‰è£…äº†Dockerï¼Œæƒ³è¦æ­£å¸¸ä½¿ç”¨çš„è¯å°±å¿…é¡»å¼€å¯Hyper-Vï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯æç¤ºã€‚ä½†æ˜¯å¦‚æœWindowsç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨VMwareè™šæ‹Ÿæœºçš„è¯ï¼Œå¼€å¯Hyper-Våˆä¼šå¯¼è‡´è™šæ‹Ÿæœºç”¨ä¸äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½å…³é—­Hyper-Vã€‚</p><h3 id="å®éªŒ">å®éªŒ</h3><h4 id="å®éªŒå†…å®¹å’Œè¦æ±‚">å®éªŒå†…å®¹å’Œè¦æ±‚</h4><p><strong>å†…å®¹</strong>:</p><ol><li>åˆ©ç”¨åä¸ºeNSPç½‘ç»œæ¨¡æ‹Ÿå™¨ï¼Œæ­å»ºä¸ä¸‹å›¾ç›¸å¯¹åº”çš„ç½‘ç»œæ‹“æ‰‘ã€‚åœ¨å®éªŒæ‹“æ‰‘ä¸­å…±æœ‰3ä¸ªç½‘æ®µï¼ˆç½‘1ã€ç½‘2å’Œç½‘3ï¼‰ï¼Œå…¶ç½‘ç»œå‚æ•°å‚è§è¡¨æ ¼ã€‚æ¯ä¸ªç½‘æ®µä½¿ç”¨1å°äº¤æ¢æœºã€‚</li><li>è·¯ç”±å™¨R1è¿æ¥ç½‘1ä¸ç½‘2ï¼Œè·¯ç”±å™¨R2è¿æ¥ç½‘2ä¸ç½‘3ã€‚</li><li>æŒ‰ç…§è¦æ±‚å¯¹æ¯å°è®¾å¤‡è¿›è¡Œé…ç½®ï¼Œæœ€ç»ˆä¿è¯æ‰€æœ‰è®¾å¤‡çš„è¿é€šæ€§ã€‚</li></ol><p><img src="https://s3.bitiful.net/pb01/192.webp" alt="avatar"></p><table><thead><tr><th>ç½‘ç»œ</th><th>å­ç½‘æ©ç </th><th>ç½‘ç»œå·</th></tr></thead><tbody><tr><td>ç½‘1</td><td>255.255.255.0</td><td>192.168.1.0</td></tr><tr><td>ç½‘2</td><td>255.255.255.0</td><td>192.168.5.0</td></tr><tr><td>ç½‘3</td><td>255.255.255.0</td><td>192.168.3.0</td></tr></tbody></table><p><strong>è¦æ±‚</strong>:</p><ol><li>ä¸»æœºAä¸ä¸»æœºBçš„IPv4åœ°å€ã€å­ç½‘æ©ç ä»¥åŠé»˜è®¤ç½‘å…³ç­‰å‚æ•°ç”±ç½‘ç»œè®¾å¤‡ä¸­çš„DHCPæœåŠ¡è‡ªåŠ¨åˆ†é…ï¼›</li><li>ä¸»æœºCå’Œä¸»æœºDçš„IPv4åœ°å€ã€å­ç½‘æ©ç ä»¥åŠé»˜è®¤ç½‘å…³ç­‰å‚æ•°ç”±æ‰‹åŠ¨åˆ†é…ï¼Œä¸”åœ°å€çš„æœ€åä¸€ä¸ªå­—èŠ‚å¿…é¡»è®¾ç½®ä¸ºä»»ä¸€ç»„å‘˜å­¦å·çš„åä¸‰ä½ï¼Œå¦åˆ™æµ‹è¯•ä¸é€šè¿‡ã€‚</li><li>å¯¹ä¸»æœºAæ‰€è¿æ¥çš„ç½‘ç»œè®¾å¤‡ç«¯å£è¿›è¡Œé™é€Ÿï¼Œå…¶ä¸­å…¥æ–¹å‘å’Œå‡ºæ–¹å‘å‡é™åˆ¶ä¸ºç«¯å£æœ€å¤§é€Ÿç‡çš„50%ã€‚</li><li>é€‰æ‹©åˆé€‚çš„ç½‘ç»œè®¾å¤‡ï¼Œé…ç½®è‡³å°‘ä¸¤ç§é˜²ARPæ³›æ´ªæ”»å‡»åŠŸèƒ½ä»¥åŠè‡³å°‘ä¸¤ç§é˜²ARPæ¬ºéª—æ”»å‡»åŠŸèƒ½ã€‚</li></ol><h4 id="ä¿å§†çº§æ•™ç¨‹">ä¿å§†çº§æ•™ç¨‹</h4><p>é€‰ç”¨è®¾å¤‡: PC,äº¤æ¢æœºS5700,è·¯ç”±å™¨AR1220</p><p>æ€»çš„è¿æ¥å›¾:</p><p><img src="https://s3.bitiful.net/pb01/186.webp" alt="avatar"></p><p><strong>è‡ªåŠ¨è·å–IP</strong>:<br>PC1å’ŒPC2å³é”®æ‰“å¼€è®¾ç½®,ipv4å‹¾é€‰DHCP</p><p><img src="https://s3.bitiful.net/pb01/187.webp" alt="avatar"></p><p><strong>é…ç½®AR2</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sys <span class="comment"># è¿›å…¥ç³»ç»Ÿè§†å›¾</span></span><br><span class="line">int g0/0/0 <span class="comment"># é…ç½®GE 0/0/0ç«¯å£</span></span><br><span class="line">ip address 192.168.1.195 24 <span class="comment"># è®¾ç½®ç«¯å£å¤„IP mask</span></span><br><span class="line">dhcp <span class="built_in">enable</span> <span class="comment"># å¯åŠ¨DHCPæœåŠ¡</span></span><br><span class="line">ip pool ggls_p1 <span class="comment"># åˆ›å»ºIPæ± </span></span><br><span class="line">network 192.168.1.0 mask 24 <span class="comment"># å»ºç«‹ç½‘æ®µ ç½‘ç»œå· mask</span></span><br><span class="line">gateway-list 192.168.1.195 <span class="comment"># ç½‘å…³ IP</span></span><br><span class="line">int g0/0/0 </span><br><span class="line">dhcp <span class="keyword">select</span> global <span class="comment"># å¯åŠ¨åˆ†é…</span></span><br><span class="line">int g0/0/1</span><br><span class="line">ip address 192.168.5.2 24 <span class="comment"># å°†è·¯ç”±å™¨GE 0/0/1æ‹‰å…¥ 192.168.5.0 ç½‘æ®µï¼Œåé¢è¦ç”¨</span></span><br><span class="line">quit</span><br><span class="line"><span class="comment"># é…ç½®é™æ€è·¯ç”±ï¼Œåé¢è¦ç”¨</span></span><br><span class="line"><span class="comment"># æƒ³å»192.168.5.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.195</span></span><br><span class="line">ip route-static 192.168.5.0 24 192.168.5.195</span><br><span class="line"><span class="comment"># æƒ³å»192.168.3.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.195</span></span><br><span class="line">ip route-static 192.168.3.0 24 192.168.5.195</span><br><span class="line">quit</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p><code>ä¸€å®šè¦è®°å¾—ä¿å­˜,ä¸ç„¶é‡åšè™½ç„¶ä¸éš¾,ä½†å¾ˆéº»çƒ¦,åé¢çš„ä¹Ÿæ˜¯</code></p><p><strong>é…ç½®LSW2</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">vlan 1 <span class="comment"># åˆ›å»ºvlan 1</span></span><br><span class="line">int vlanif 1</span><br><span class="line">ip address 192.168.5.195 24 <span class="comment"># é…ç½®ç½‘å…³</span></span><br><span class="line">int g0/0/1 <span class="comment"># è®© GE 0/0/1åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">int g0/0/2 <span class="comment"># è®© GE 0/0/2åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">int g0/0/3 <span class="comment"># è®© GE 0/0/3åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">quit</span><br><span class="line"><span class="comment"># å’ŒAR3ã€AR4çš„é™æ€è·¯ç”±é…ç½®å¯¹åº”ï¼Œæ³¨æ„äº†è¿™æ³¢</span></span><br><span class="line"><span class="comment"># æƒ³å»192.168.1.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.2</span></span><br><span class="line">ip route-static 192.168.1.0 24 192.168.5.2</span><br><span class="line"><span class="comment"># æƒ³å»192.168.3.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.3</span></span><br><span class="line">ip route-static 192.168.3.0 24 192.168.5.3 </span><br><span class="line">quit</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p><strong>AR3é…ç½®</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/0</span><br><span class="line">ip address 192.168.5.3 24</span><br><span class="line">int g0/0/1</span><br><span class="line">ip address 192.168.3.195 24</span><br><span class="line">quit</span><br><span class="line">ip route-static 192.168.1.0 24 192.168.5.195</span><br><span class="line">ip route-static 192.168.5.0 24 192.168.5.195</span><br></pre></td></tr></table></figure><p><strong>PC3å’ŒPC4é…ç½®</strong>:</p><p>ç½‘å…³ä¸ä¹‹å‰è®¾ç½®çš„ä¸€è‡´å³å¯,åˆ†åˆ«ä¸º192.168.5.195å’Œ192.168.3.195,ipè‡ªå·±è®¾ç½®</p><p><img src="https://s3.bitiful.net/pb01/188.webp" alt="avatar"></p><p>ä¹‹åå…¨éƒ¨å¯åŠ¨,çœ‹å››å°PCä¹‹é—´æ˜¯å¦èƒ½äº’ç›¸pingé€š,å¦‚æœä¸èƒ½,å°±å»ä¸€ä¸ªä¸€ä¸ªçš„pingæ¥å£,æ‰¾åˆ°æ–­çš„åœ°æ–¹,æ’æŸ¥é—®é¢˜</p><p>PC1å’ŒPC2çš„ipä½¿ç”¨ipconfigå‘½ä»¤æŸ¥çœ‹,è‡³æ­¤è¦æ±‚1,2å°±ç»“æŸäº†</p><p><strong>é™åˆ¶é€Ÿç‡</strong>:<br>å› ä¸ºæ˜¯åƒå…†çš„ç½‘å£,é™åˆ¶åˆ°50%,å°±è®¾ç½®äº†500M</p><p>è¦é…ç½®LSW4,ä»£ç å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/1</span><br><span class="line">qos lr inbound cir 500000 <span class="comment">#500*1000=&gt; 500Mbps</span></span><br><span class="line">qos lr outbound cir 500000</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç»“æœ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/1</span><br><span class="line">dispaly this</span><br></pre></td></tr></table></figure><p><img src="https://s3.bitiful.net/pb01/195.webp" alt="avatar"></p><p><strong>åº”å¯¹ARPæ³›æ´ª</strong>:<br>å¦‚æœè®¾å¤‡å¯¹æ”¶åˆ°çš„å¤§é‡ARPæŠ¥æ–‡å…¨éƒ¨è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½å¯¼è‡´CPUè´Ÿè·è¿‡é‡è€Œæ— æ³•å¤„ç†å…¶ä»–ä¸šåŠ¡ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†ä¹‹å‰ï¼Œè®¾å¤‡éœ€è¦å¯¹ARPæŠ¥æ–‡è¿›è¡Œé™é€Ÿï¼Œä»¥ä¿æŠ¤CPUèµ„æºã€‚</p><p>å¦‚æœç½‘ç»œä¸­æœ‰ç”¨æˆ·å‘è®¾å¤‡å‘é€å¤§é‡ç›®æ ‡IPåœ°å€ä¸èƒ½è§£æçš„IPæŠ¥æ–‡ï¼ˆå³è·¯ç”±è¡¨ä¸­å­˜åœ¨è¯¥IPæŠ¥æ–‡çš„ç›®çš„IPå¯¹åº”çš„è·¯ç”±è¡¨é¡¹ï¼Œä½†è®¾å¤‡ä¸Šæ²¡æœ‰è¯¥è·¯ç”±è¡¨é¡¹ä¸­ä¸‹ä¸€è·³å¯¹åº”çš„ARPè¡¨é¡¹ï¼‰ï¼Œå°†å¯¼è‡´è®¾å¤‡è§¦å‘å¤§é‡çš„ARP Missæ¶ˆæ¯ã€‚è¿™ç§è§¦å‘ARP Missæ¶ˆæ¯çš„IPæŠ¥æ–‡ä¼šè¢«ä¸Šé€åˆ°è®¾å¤‡è¿›è¡Œå¤„ç†ï¼Œè®¾å¤‡ä¼šæ ¹æ®ARP Missæ¶ˆæ¯ç”Ÿæˆå’Œä¸‹å‘å¤§é‡ä¸´æ—¶ARPè¡¨é¡¹å¹¶å‘ç›®çš„ç½‘ç»œå‘é€å¤§é‡ARPè¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ ·å°±å¢åŠ äº†è®¾å¤‡CPUçš„è´Ÿæ‹…ï¼ŒåŒæ—¶ä¸¥é‡æ¶ˆè€—ç›®çš„ç½‘ç»œçš„å¸¦å®½èµ„æºã€‚</p><p><strong>åœ¨AR2å’ŒAR3ä¸­éƒ½è¦é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sys </span><br><span class="line"><span class="comment"># ARPæŠ¥æ–‡é™é€Ÿ</span></span><br><span class="line">int g0/0/0</span><br><span class="line">arp anti-attack rate-limit <span class="built_in">enable</span> </span><br><span class="line">arp anti-attack rate-limit 80 1</span><br><span class="line">int g0/0/1</span><br><span class="line">arp anti-attack rate-limit <span class="built_in">enable</span> </span><br><span class="line">arp anti-attack rate-limit 80 1</span><br><span class="line"><span class="comment"># ARP Missæ¶ˆæ¯é™é€Ÿ</span></span><br><span class="line">arp-miss anti-attack rate-limit <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><p><strong>åº”å¯¹ARPæ¬ºéª—</strong>:</p><p><code>ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥</code>: è¿™äº›æ£€æŸ¥æ˜¯ç”¨æ¥<strong>åˆ¤æ–­ARPæŠ¥æ–‡çš„æ ¼å¼è·ŸARPåè®®çš„è§„å®šæ˜¯å¦ä¸€è‡´</strong>ã€‚å…¶ä¸­ä»¥å¤ªç½‘æ•°æ®å¸§é¦–éƒ¨ä¸­çš„æºMACåœ°å€å’ŒARPæŠ¥æ–‡æ•°æ®åŒºä¸­çš„æºMACåœ°å€ä¸ä¸€è‡´çš„ARPæŠ¥æ–‡æ˜¯åè®®å…è®¸çš„æŠ¥æ–‡ï¼Œä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œè¯¥ç±»æŠ¥æ–‡å¾ˆå¯èƒ½æ˜¯æ”»å‡»æŠ¥æ–‡ã€‚ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥åŠŸèƒ½åï¼Œè®¾å¤‡<strong>ä¼šå¯¹æ”¶åˆ°çš„ARPæŠ¥æ–‡è¿›è¡Œä»¥å¤ªç½‘æ•°æ®å¸§é¦–éƒ¨ä¸­çš„æºMACåœ°å€å’ŒARPæŠ¥æ–‡æ•°æ®åŒºä¸­çš„æºMACåœ°å€çš„ä¸€è‡´æ€§æ£€æŸ¥</strong>ï¼Œå¦‚æœä¸¤è€…ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥ARPæŠ¥æ–‡ï¼Œå¦åˆ™å…è®¸è¯¥ARPæŠ¥æ–‡é€šè¿‡</p><p><code>ARPè¡¨é¡¹å›ºåŒ–</code>:</p><ul><li><p><strong>fixed-allæ–¹å¼</strong>, åªæœ‰å½“ARPæŠ¥æ–‡å¯¹åº”çš„MACåœ°å€ã€æ¥å£ã€VLANä¿¡æ¯å’ŒARPè¡¨é¡¹ä¸­çš„ä¿¡æ¯å®Œå…¨åŒ¹é…æ—¶ï¼Œè®¾å¤‡æ‰å¯ä»¥æ›´æ–°ARPè¡¨é¡¹çš„å…¶ä»–å†…å®¹ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·MACåœ°å€å›ºå®šï¼Œå¹¶ä¸”ç”¨æˆ·æ¥å…¥ä½ç½®ç›¸å¯¹å›ºå®šçš„åœºæ™¯ã€‚</p></li><li><p><strong>fixed-macæ–¹å¼</strong>, è®¾å¤‡æ”¶åˆ°çš„ARPæŠ¥æ–‡ä¸­çš„MACåœ°å€ä¸ARPè¡¨ä¸­å¯¹åº”æ¡ç›®çš„MACåœ°å€ä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥ARPæŠ¥æ–‡ï¼›å¦‚æœåŒ¹é…ï¼Œä½†æ˜¯æ”¶åˆ°æŠ¥æ–‡çš„æ¥å£æˆ–VLANä¿¡æ¯ä¸ARPè¡¨ä¸­å¯¹åº”æ¡ç›®ä¸åŒ¹é…ï¼Œåˆ™å¯ä»¥æ›´æ–°å¯¹åº”ARPæ¡ç›®ä¸­çš„æ¥å£å’ŒVLANä¿¡æ¯ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·MACåœ°å€å›ºå®šï¼Œä½†ç”¨æˆ·æ¥å…¥ä½ç½®é¢‘ç¹å˜åŠ¨çš„åœºæ™¯ã€‚å½“ç”¨æˆ·ä»ä¸åŒæ¥å£æ¥å…¥è®¾å¤‡æ—¶ï¼Œè®¾å¤‡ä¸Šè¯¥ç”¨æˆ·å¯¹åº”çš„ARPè¡¨é¡¹ä¸­çš„æ¥å£ä¿¡æ¯å¯ä»¥åŠæ—¶æ›´æ–°ã€‚</p></li><li><p><strong>send-ackæ–¹å¼</strong>, è®¾å¤‡æ”¶åˆ°ä¸€ä¸ªæ¶‰åŠMACåœ°å€ã€VLANã€æ¥å£ä¿®æ”¹çš„ARPæŠ¥æ–‡æ—¶ï¼Œä¸ä¼šç«‹å³æ›´æ–°ARPè¡¨é¡¹ï¼Œè€Œæ˜¯å…ˆå‘å¾…æ›´æ–°çš„ARPè¡¨é¡¹ç°æœ‰MACåœ°å€å¯¹åº”çš„ç”¨æˆ·å‘é€ä¸€ä¸ªå•æ’­çš„ARPè¯·æ±‚æŠ¥æ–‡è¿›è¡Œç¡®è®¤ï¼Œæ ¹æ®ç¡®è®¤ç»“æœå†å†³å®šæ˜¯å¦æ›´æ–°ARPè¡¨é¡¹ä¸­çš„MACåœ°å€ã€VLANå’Œæ¥å£ä¿¡æ¯ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·çš„MACåœ°å€å’Œæ¥å…¥ä½ç½®å‡é¢‘ç¹å˜åŠ¨çš„åœºæ™¯ã€‚</p></li></ul><p><strong>åœ¨AR2å’ŒAR3ä¸­éƒ½è¦é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line"><span class="comment"># ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">arp anti-attack packet-check sender-mac</span><br><span class="line"><span class="comment"># ARPè¡¨é¡¹å›ºåŒ–</span></span><br><span class="line">arp anti-attack entry-check fixed-all</span><br></pre></td></tr></table></figure><p>æœ€åæŸ¥çœ‹ä¸€ä¸‹ARPå®‰å…¨é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display arp anti-attack configuration all</span><br></pre></td></tr></table></figure><p>å¦‚å›¾:<br><img src="https://s3.bitiful.net/pb01/189.webp" alt="avatar"></p><h3 id="éªŒæ”¶é—®é¢˜">éªŒæ”¶é—®é¢˜</h3><p>æ¨èçœ‹<a href="https://blog.csdn.net/qq_31028407/article/details/131118006" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">è¥¿ç”µBæµ‹-è®¡ç®—æœºä¸“ä¸š-è®¡ç®—æœºç½‘ç»œç»¼åˆè®¾è®¡å®éªŒä¸€ç«™å¼æŒ‡å—ï¼ˆä»¥2023.4ä¸ºåŸºå‡†ï¼‰</a>è¿™ç¯‡åšå®¢, è€å¸ˆé—®é—®é¢˜ä¸€èˆ¬æ˜¯æŒ‰é¡ºåºé—®çš„, å¯¹åº”çš„é¡ºåºå°±æ˜¯ä½ ä»¬è¿›å»åçš„é¡ºåº.</p><p>æˆ‘ä»¬ç»„ç¬¬ä¸€ä¸ªäººé—®çš„æ˜¯:</p><ol><li>ç”¨çš„æ˜¯ä»€ä¹ˆè·¯ç”±?(é™æ€è·¯ç”±)</li><li>è¿˜å¯ä»¥ç”¨ä»€ä¹ˆ?(åŠ¨æ€è·¯ç”±RIP)</li><li>æœ€å¸¸ç”¨çš„åŠ¨æ€è·¯ç”±æ˜¯ä»€ä¹ˆ?(OSPF)</li><li>é™æ€è·¯ç”±è·¯ç”±è¡¨æ˜¯åœ¨å“ªäº›è®¾å¤‡ä¸Šé…ç½®çš„ï¼Œæ˜¯å¦‚ä½•é…ç½®çš„?</li></ol><p>ç¬¬äºŒä¸ª:</p><ol><li>dhcpåˆ†é…åœ°å€åœ¨å“ªå®ç°çš„ï¼Ÿ(æŒ‡å‡ºé…ç½®çš„è·¯ç”±å™¨)</li><li>dhcpçš„é…ç½®è¿‡ç¨‹ï¼Ÿ(æŠŠä»£ç å£è¿°ä¸€é, å…ˆè®¾ç½®è·¯ç”±å™¨ç«¯å£ipï¼Œç„¶åå…è®¸dhcpï¼Œåˆ›å»ºçº¿ç¨‹æ± ï¼Œé…ç½®çº¿ç¨‹æ± ç½‘æ®µã€ç½‘å…³â€¦)</li></ol><p>ç¬¬ä¸‰ä¸ª:</p><ol><li>ä¸ºä»€ä¹ˆæ˜¯500000?(å•ä½æ˜¯kb,åƒå…†ç«¯å£â€¦),ç›´æ¥é—®è¿™ä¸ªæ˜¯æˆ‘ç”µè„‘ä¸ŠæŠŠè¿™ä¸ªäº¤æ¢æœºçš„é…ç½®displayäº†, è€å¸ˆçœ‹åˆ°å°±ç›´æ¥é—®äº†</li><li>arpæ³›æ´ªæ”»å‡»æ˜¯ä»€ä¹ˆ?</li><li>arpæ³›æ´ªæ”»å‡»æ¶ˆè€—çš„æ˜¯ä»€ä¹ˆèµ„æº?(arpè¡¨é¡¹èµ„æº)</li><li>arpæ¬ºéª—æ˜¯æ€ä¹ˆåšåˆ°çš„?(ä¿®æ”¹macåœ°å€â€¦)</li></ol>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®å®‰å…¨æ£€ç´¢</title>
      <link href="/2024/04/22/2024-4-22-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%812/"/>
      <url>/2024/04/22/2024-4-22-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%812/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="æ•°æ®å®‰å…¨æ£€ç´¢">æ•°æ®å®‰å…¨æ£€ç´¢</h3><p>å¤§æ•°æ®å®‰å…¨ä¸éšç§è¿™é—¨è¯¾çš„lab3,è¦æ±‚å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/184.webp" alt="avatar"></p><p>æ–¹æ¡ˆ:<br>â€¢ä½¿ç”¨äº† pyope åº“ä¸­çš„ OPE (Order Preserving Encryption) å¯¹æ•°æ®è¿›è¡Œä¿åºåŠ å¯†, å¹¶å°†åŠ å¯†åçš„æ•°æ®å†™å…¥NE_encrypt.txtã€‚<br>â€¢å®šä¹‰ decision_node ç±»æ¥æ„å»º KD æ ‘ã€‚<br>â€¢å®ç°äº† travel_tree å‡½æ•°ï¼Œè¯¥å‡½æ•°èƒ½å¤Ÿåœ¨éå† KD æ ‘å¹¶è¿›è¡Œè¿‘é‚»æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿˜å®ç°äº†è·ç¦»è®¡ç®—å‡½æ•° distã€‚</p><h4 id="åŠ å¯†éƒ¨åˆ†ä»£ç ">åŠ å¯†éƒ¨åˆ†ä»£ç :</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE, ValueRange</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å…¥å¤„ç†txtæ–‡ä»¶,è¿”å›äºŒç»´æ•°ç»„ï¼Œæ˜æ–‡å’Œå¯†æ–‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadTxtMethod</span>(<span class="params">filename</span>):</span><br><span class="line">    cipher = OPE(<span class="string">b&#x27;long key&#x27;</span> * <span class="number">2</span>, in_range=ValueRange(<span class="number">0</span>, <span class="number">10000000</span>),</span><br><span class="line">                 out_range=ValueRange(<span class="number">0</span>, <span class="number">100000000</span>))</span><br><span class="line">    result_m = <span class="built_in">list</span>()  <span class="comment"># æ˜æ–‡ç‚¹</span></span><br><span class="line">    result_c = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(filename):  <span class="comment"># é€è¡Œæ‰“å¼€æ–‡æ¡£.</span></span><br><span class="line">        plain_text = line.split(<span class="string">&#x27; &#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        plain_text[<span class="number">0</span>] = <span class="built_in">float</span>(plain_text[<span class="number">0</span>])</span><br><span class="line">        plain_text[<span class="number">1</span>] = <span class="built_in">float</span>(plain_text[<span class="number">1</span>])</span><br><span class="line">        plain_text_arr = np.array(plain_text)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line">        result_m.append(plain_text_arr)  <span class="comment"># æŠŠç¬¬ä¸€åˆ—æ•°æ®æ·»åŠ åˆ°resultåºåˆ—ä¸­</span></span><br><span class="line">        cipher_text = []</span><br><span class="line">        cipher_text.append(cipher.encrypt(<span class="built_in">int</span>(plain_text[<span class="number">0</span>] * <span class="number">1000000</span>)))</span><br><span class="line">        cipher_text.append(cipher.encrypt(<span class="built_in">int</span>(plain_text[<span class="number">1</span>] * <span class="number">1000000</span>)))</span><br><span class="line">        cipher_text_arr = np.array(cipher_text)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line">        result_c.append(cipher_text_arr)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;åŠ å¯†&quot;</span> + <span class="built_in">str</span>(cipher_text_arr[<span class="number">0</span>]) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(cipher_text_arr[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> array(result_c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WriteTxt</span>(<span class="params">cipher_txt</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;NE_encrypt.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> cipher_txt:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">type</span>(x))</span><br><span class="line">            strings = <span class="built_in">str</span>(x[<span class="number">0</span>]) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(x[<span class="number">1</span>]) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(strings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data = LoadTxtMethod(<span class="string">&#x27;NE.txt&#x27;</span>)  <span class="comment"># è°ƒç”¨ä¸Šé¢æ•°æ®å¤„ç†ç¨‹åº</span></span><br><span class="line">    WriteTxt(data)  <span class="comment"># åŠ å¯†ä¹‹åçš„æ•°æ®å­˜æ”¾äºcipherText.txtä¸­</span></span><br></pre></td></tr></table></figure><h4 id="é‚»è¿‘æœç´¢éƒ¨åˆ†">é‚»è¿‘æœç´¢éƒ¨åˆ†:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE, ValueRange</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç±»ï¼Œç”¨äºä¿å­˜ç»“ç‚¹çš„å€¼ï¼Œå·¦å³å­æ ‘ï¼Œä»¥åŠç”¨äºåˆ’åˆ†å·¦å³å­æ ‘çš„åˆ‡åˆ†è½´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">decision_node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=<span class="literal">None</span>, col=<span class="literal">None</span>, rb=<span class="literal">None</span>, lb=<span class="literal">None</span></span>):</span><br><span class="line">        self.value = value  <span class="comment"># ç‚¹</span></span><br><span class="line">        self.col = col  <span class="comment"># åˆ‡åˆ†çš„ç»´åº¦</span></span><br><span class="line">        self.rb = rb  <span class="comment"># å³å­æ ‘</span></span><br><span class="line">        self.lb = lb  <span class="comment"># å·¦å­æ ‘</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadTxtMethod</span>(<span class="params">filename</span>):  <span class="comment"># ä¼ å…¥å½¢å‚,txtçš„åå­—.</span></span><br><span class="line">    result = <span class="built_in">list</span>()  <span class="comment"># åˆ›å»ºè¦è¿”å›çš„æ•°æ®.</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(filename):  <span class="comment"># é€è¡Œæ‰“å¼€æ–‡æ¡£.</span></span><br><span class="line">        data = line.split(<span class="string">&#x27; &#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        data[<span class="number">0</span>] = <span class="built_in">float</span>(data[<span class="number">0</span>])</span><br><span class="line">        data[<span class="number">1</span>] = <span class="built_in">float</span>(data[<span class="number">1</span>])</span><br><span class="line">        data_float = np.array(data)</span><br><span class="line">        result.append(data_float)  <span class="comment"># æŠŠç¬¬ä¸€åˆ—æ•°æ®æ·»åŠ åˆ°resultåºåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> array(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡åˆ†ç‚¹ä¸ºåæ ‡è½´ä¸Šçš„ä¸­å€¼ï¼Œæ±‚ä¸€ä¸ªåºåˆ—çš„ä¸­å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">median</span>(<span class="params">x</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(x)</span><br><span class="line">    x = <span class="built_in">list</span>(x)</span><br><span class="line">    x_order = <span class="built_in">sorted</span>(x)</span><br><span class="line">    <span class="keyword">return</span> x_order[n // <span class="number">2</span>], x.index(x_order[n // <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥jåˆ—çš„ä¸­å€¼åˆ’åˆ†æ•°æ®ï¼Œå·¦å°å³å¤§ï¼Œj=èŠ‚ç‚¹æ·±åº¦%åˆ—æ•°ï¼Œåˆ—æ•°è¿™é‡Œæ˜¯2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_tree</span>(<span class="params">x, j=<span class="number">0</span></span>):</span><br><span class="line">    rb = []</span><br><span class="line">    lb = []</span><br><span class="line">    m, n = x.shape</span><br><span class="line">    <span class="keyword">if</span> m == <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    edge, row = median(x[:, j].copy())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> x[i][j] &gt; edge:</span><br><span class="line">            rb.append(i)</span><br><span class="line">        <span class="keyword">if</span> x[i][j] &lt; edge:</span><br><span class="line">            lb.append(i)</span><br><span class="line">    rb_x = x[rb, :]</span><br><span class="line">    lb_x = x[lb, :]</span><br><span class="line">    rightBranch = build_tree(rb_x, (j + <span class="number">1</span>) % n)</span><br><span class="line">    leftBranch = build_tree(lb_x, (j + <span class="number">1</span>) % n)</span><br><span class="line">    <span class="keyword">return</span> decision_node(x[row, :], j, rightBranch, leftBranch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ ‘ï¼šè¾“å‡ºç›®æ ‡ç‚¹çš„è¿‘é‚»ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">travel_tree</span>(<span class="params">node, aim</span>):</span><br><span class="line">    <span class="keyword">global</span> pointlist  <span class="comment"># å­˜å‚¨æ’åºåçš„kè¿‘é‚»ç‚¹å’Œå¯¹åº”è·ç¦»</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">return</span></span><br><span class="line">    col = node.col</span><br><span class="line">    <span class="keyword">if</span> aim[col] &gt; node.value[col]:  <span class="comment"># é¡ºç€æ ‘è¿›è¡Œæœç´¢ï¼Œåˆ†ç±»</span></span><br><span class="line">        travel_tree(node.rb, aim)</span><br><span class="line">    <span class="keyword">if</span> aim[col] &lt; node.value[col]:</span><br><span class="line">        travel_tree(node.lb, aim)</span><br><span class="line">    dis = dist(node.value, aim)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(knears) &lt; k:  <span class="comment"># kæ˜¯è¾“å…¥çš„è¦æŸ¥è¯¢çš„ä¸ªæ•°ï¼Œå‰kä¸ªç‚¹å°±æ˜¯ç›®æ ‡ç‚¹xçš„kè¿‘é‚»</span></span><br><span class="line">        knears.setdefault(<span class="built_in">tuple</span>(node.value.tolist()), dis)  <span class="comment"># åˆ—è¡¨ä¸èƒ½ä½œä¸ºå­—å…¸çš„é”®</span></span><br><span class="line">        pointlist = <span class="built_in">sorted</span>(knears.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">elif</span> dis &lt;= pointlist[<span class="number">0</span>][<span class="number">1</span>]:</span><br><span class="line">        knears.setdefault(<span class="built_in">tuple</span>(node.value.tolist()), dis)</span><br><span class="line">        pointlist = <span class="built_in">sorted</span>(knears.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> node.rb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">or</span> node.lb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># å¯¹äºçˆ¶èŠ‚ç‚¹æ¥è¯´ï¼Œå¦‚æœç›®æ ‡ç‚¹ä¸å…¶åˆ‡åˆ†è½´ä¹‹é—´çš„è·ç¦»ä¸å¤§äºå­—å…¸ä¸­å„ç»“ç‚¹æ‰€å¯¹åº”è·ç¦»çš„çš„æœ€å¤§å€¼ï¼Œä¾¿éœ€è¦è®¿é—®è¯¥çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(aim[node.col] - node.value[node.col]) &lt; pointlist[<span class="number">0</span>][<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">if</span> aim[node.col] &lt; node.value[node.col]:</span><br><span class="line">                travel_tree(node.rb, aim)</span><br><span class="line">            <span class="keyword">if</span> aim[node.col] &gt; node.value[node.col]:</span><br><span class="line">                travel_tree(node.lb, aim)</span><br><span class="line">    <span class="keyword">return</span> pointlist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dist</span>(<span class="params">x1, x2</span>):  <span class="comment"># æ¬§å¼è·ç¦»çš„è®¡ç®—</span></span><br><span class="line">    <span class="keyword">return</span> ((np.array(x1) - np.array(x2)) ** <span class="number">2</span>).<span class="built_in">sum</span>() ** <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">cipher = OPE(<span class="string">b&#x27;long key&#x27;</span> * <span class="number">2</span>, in_range=ValueRange(<span class="number">0</span>, <span class="number">10000000</span>),</span><br><span class="line">                 out_range=ValueRange(<span class="number">0</span>, <span class="number">100000000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿åºåŠ å¯†</span></span><br><span class="line"><span class="comment"># è¾“å…¥ç»™çš„ç‚¹ï¼Œè¾“å‡ºè°ƒç”¨pyopeåº“åŠ å¯†çš„ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encryption</span>(<span class="params">point</span>):</span><br><span class="line">    point[<span class="number">0</span>] = <span class="built_in">float</span>(point[<span class="number">0</span>])</span><br><span class="line">    point[<span class="number">1</span>] = <span class="built_in">float</span>(point[<span class="number">1</span>])  <span class="comment"># æŠŠarrayä¸­çš„ç‚¹è½¬åŒ–ä¸ºfloatç±»å‹</span></span><br><span class="line">    en_point = []</span><br><span class="line">    en_point.append(cipher.encrypt(<span class="built_in">int</span>(point[<span class="number">0</span>] * <span class="number">1000000</span>)))</span><br><span class="line">    en_point.append(cipher.encrypt(<span class="built_in">int</span>(point[<span class="number">1</span>] * <span class="number">1000000</span>)))</span><br><span class="line">    en_point_arr = np.array(en_point)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> en_point_arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿åºè§£å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decryption</span>(<span class="params">point</span>):</span><br><span class="line">    point[<span class="number">0</span>] = <span class="built_in">int</span>(point[<span class="number">0</span>])</span><br><span class="line">    point[<span class="number">1</span>] = <span class="built_in">int</span>(point[<span class="number">1</span>])</span><br><span class="line">    de_point = []</span><br><span class="line">    de_point.append(cipher.decrypt(point[<span class="number">0</span>]) / <span class="number">1000000</span>)</span><br><span class="line">    de_point.append(cipher.decrypt(point[<span class="number">1</span>]) / <span class="number">1000000</span>)</span><br><span class="line">    de_point_arr = np.array(de_point)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> de_point_arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    tmp = <span class="built_in">input</span>(<span class="string">&#x27;è¯·è¾“å…¥ç›®æ ‡ç‚¹:&#x27;</span>)</span><br><span class="line">    tmp = tmp.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    point_tmp = encryption(tmp)</span><br><span class="line">    aim = []</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> point_tmp:</span><br><span class="line">        aim.append(num)</span><br><span class="line">    knears = &#123;&#125;</span><br><span class="line">    k = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;è¯·è¾“å…¥éœ€è¦æŸ¥è¯¢çš„ç‚¹çš„ä¸ªæ•°&#x27;</span>))</span><br><span class="line">    file = <span class="string">&#x27;NE_encrypt.txt&#x27;</span></span><br><span class="line">    data_c = LoadTxtMethod(file)</span><br><span class="line">    tree = build_tree(data_c)  <span class="comment"># æ„å»ºKD tree</span></span><br><span class="line"></span><br><span class="line">    pointlist = travel_tree(tree, aim)  <span class="comment"># å¯¹ç›®æ ‡ç‚¹è¿›è¡Œæ£€ç´¢</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> point <span class="keyword">in</span> pointlist[-k:]:  <span class="comment"># é‡Œé¢å­˜çš„æœ‰ç‚¹ï¼Œå’Œæ¬§å¼è·ç¦»</span></span><br><span class="line">        x = [point[<span class="number">0</span>][<span class="number">0</span>], point[<span class="number">0</span>][<span class="number">1</span>]]</span><br><span class="line">        de_point = decryption(x)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;****************--------ç¬¬&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;æ¡æ£€ç´¢æ•°æ®--------****************&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ£€ç´¢ç»“æœ: &quot;</span>, de_point)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·ç¦»ä¸º:&quot;</span>, dist(tmp, de_point))</span><br><span class="line">        i = i + <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="ç»“æœ">ç»“æœ</h4><p><img src="https://pb01.s3.bitiful.net/185.webp" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ</title>
      <link href="/2024/04/21/2024-4-21-%E5%9B%BE%E5%BA%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/2024/04/21/2024-4-21-%E5%9B%BE%E5%BA%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ">ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ</h3><p>åŸå…ˆæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯githubåšå›¾åºŠ,å¥—ä¸€å±‚Cloudflareçš„cdnæ¥åŠ é€Ÿå›½å†…è®¿é—®, ä½†å›½å†…è®¿é—®ä»ç„¶è¿‡æ…¢, ç‰¹åˆ«æ˜¯ä¸€äº›å›¾å¾ˆå¤šçš„æ–‡ç« , åŠ è½½éå¸¸æ…¢. æ‰€ä»¥æˆ‘æƒ³ç€æ”¹å–„ä¸€ä¸‹, åœ¨å¯¹æ¯”äº†ä¸€äº›è§£å†³æ–¹æ¡ˆä¹‹å, æˆ‘é€‰æ‹©äº†PicGo+<a href="https://www.bitiful.com/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ç¼¤çº·äº‘</a>æ­å»ºä¸»å›¾åºŠ, éƒ¨åˆ†å›¾ç‰‡æ”¾åœ¨ <a href="https://7bu.top/login" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å»ä¸å›¾åºŠ</a>, åŸå…ˆçš„æ–¹æ¡ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ.</p><p>æˆ‘ç”¨å»ä¸å›¾åºŠå­˜å‚¨å¸¸ç”¨å›ºå®šå›¾ç‰‡, åƒèƒŒæ™¯å›¾è¿™äº›, å•å›¾10Gçš„æµé‡, PicGo+ç¼¤çº·äº‘å­˜å‚¨æ–‡ç« å†…æ’å›¾, æ¯æœˆ10Gå…è´¹æµé‡, è™½ç„¶å»ä¸å›¾åºŠå’Œç¼¤çº·äº‘éƒ½ä¸æ˜¯åƒé˜¿é‡Œäº‘, è…¾è®¯äº‘è¿™æ ·çš„å¤§å‚, å¦‚æœå®ƒä»¬è·‘è·¯çš„è¯, æˆ‘çš„å¤‡ç”¨æ–¹æ¡ˆå¯ä»¥ç«‹é©¬é¡¶ä¸Š, ä¸¤åˆ†é’Ÿä¹‹å†…å°±å¯ä»¥åšåˆ°æ›¿æ¢å®Œæˆ, æ‰€ä»¥è¯´è¿˜æ˜¯æ²¡æœ‰å¤ªå¤§éšæ‚£</p><h4 id="ç¼¤çº·äº‘">ç¼¤çº·äº‘</h4><p>æ³¨å†Œå¹¶å®åä¹‹åå°±ä¼šæ‹¥æœ‰æ¯æœˆèµ é€çš„30Gæµé‡</p><p><strong>åˆ›å»ºæ¡¶</strong><br><img src="https://pb01.s3.bitiful.net/173.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/174.webp" alt="avatar"></p><p><strong>é˜²ç›—é“¾é…ç½®</strong><br><img src="https://pb01.s3.bitiful.net/175.webp" alt="avatar"></p><p><strong>æ·»åŠ å­ç”¨æˆ·</strong><br><img src="https://pb01.s3.bitiful.net/176.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/177.webp" alt="avatar"></p><p>Access Keyå’Œ Secret Keyè¦è®°å¥½,ç­‰ä¼šé…ç½®PicGoçš„æ—¶å€™è¦ç”¨åˆ°</p><h4 id="picGo">picGo</h4><p><strong>ä¸‹è½½picGo</strong>, å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£, å†™å¾—å¾ˆè¯¦ç»†, æˆ‘æ˜¯ä»å±±ä¸œå¤§å­¦é•œåƒä¸‹è½½çš„<br><img src="https://pb01.s3.bitiful.net/178.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/179.webp" alt="avatar"></p><p>ç”±äºç¼¤çº·äº‘ä¸æ˜¯PicGoå®˜æ–¹æ”¯æŒçš„äº‘æœåŠ¡å‚å•†, æ‰€ä»¥å¾—é æ’ä»¶æ¥å®ç°, ç”±äºæ”¯æŒs3 api, æ‰€ä»¥æˆ‘é€‰æ‹©äº†Amazon s3æ’ä»¶<br><img src="https://pb01.s3.bitiful.net/180.webp" alt="avatar"></p><p><strong>é…ç½®</strong><br><img src="https://pb01.s3.bitiful.net/181.webp" alt="avatar"></p><p>åº”ç”¨ç§˜é’¥IDå¡«Access Key, åº”ç”¨ç§˜é’¥å¡«Secret Key, æ¡¶åå¡«ä½ åˆ›å»ºçš„æ¡¶å, æ–‡ä»¶è·¯å¾„éšä¾¿å¡«(ç¬¦åˆæ ¼å¼å°±è¡Œ), åœ°åŒºå’Œè‡ªå®šä¹‰èŠ‚ç‚¹åœ¨æ¡¶ä¿¡æ¯ä¸­éƒ½æœ‰</p><p><img src="https://pb01.s3.bitiful.net/182.webp" alt="avatar"></p><p>è¦æ³¨æ„çš„æ˜¯åœ¨å¡«è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ—¶å€™å‰é¢è¦åŠ ä¸Šhttps://, å¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TypeError [ERR_INVALID_URL]: Invalid URL</span><br><span class="line">    at new NodeError (node:internal/errors:371:5)</span><br><span class="line">    at onParseError (node:internal/url:552:9)</span><br><span class="line">    at new URL (node:internal/url:628:5)</span><br><span class="line">    at parseUrl (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\url-parser\dist-cjs\index.js:29:21)</span><br><span class="line">    at toEndpointV1 (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\middleware-endpoint\dist-cjs\index.js:112:41)</span><br><span class="line">    at customEndpointProvider (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\middleware-endpoint\dist-cjs\index.js:232:65)</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/183.webp" alt="avatar"></p><p>å®ƒä»¬å®˜æ–¹å’Œæ’ä»¶æ–‡æ¡£å†™çš„æ˜¯åŒ¹é…çš„, å¯¼è‡´ä¸€å¼€å§‹è®©æˆ‘ä»¥ä¸ºæ˜¯æˆ‘çš„Node.jsç‰ˆæœ¬å¤ªé«˜å¯¼è‡´çš„</p><p>å·®ç‚¹å¿˜äº†, PicGoæ’ä»¶éœ€è¦16.0.0ç‰ˆæœ¬ä»¥ä¸Šçš„Node.jsæ‰è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> å›¾åºŠ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–</title>
      <link href="/2024/04/20/2024-4-20-%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD/"/>
      <url>/2024/04/20/2024-4-20-%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–">ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–</h2><h3 id="æ€§èƒ½æ£€æµ‹">æ€§èƒ½æ£€æµ‹</h3><h4 id="Lighthouse">Lighthouse</h4><p>Lighthouse æ˜¯ä¸€ä¸ªç½‘ç«™æ€§èƒ½æµ‹è¯„å·¥å…·ï¼Œ å®ƒæ˜¯ Google Chrome æ¨å‡ºçš„ä¸€ä¸ªå¼€æºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿå¯¹ PWA å’Œç½‘é¡µå¤šæ–¹é¢çš„æ•ˆæœæŒ‡æ ‡è¿›è¡Œè¯„æµ‹ï¼Œå¹¶ç»™å‡ºæœ€ä½³å®è·µçš„å»ºè®®ä»¥å¸®åŠ©å¼€å‘è€…æ”¹è¿›ç½‘ç«™çš„è´¨é‡ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ªè¦æµ‹è¯„çš„ç½‘å€ï¼Œå®ƒå°†é’ˆå¯¹æ­¤é¡µé¢è¿è¡Œä¸€ç³»åˆ—çš„æµ‹è¯•ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæœ‰å…³é¡µé¢æ€§èƒ½çš„æŠ¥å‘Šã€‚é€šè¿‡æŠ¥å‘Šæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“éœ€è¦é‡‡å–å“ªäº›æªæ–½æ¥æ”¹è¿›åº”ç”¨çš„æ€§èƒ½å’Œä½“éªŒã€‚</p><p>åœ¨é«˜ç‰ˆæœ¬ï¼ˆåº”è¯¥æ˜¯ &gt;= 60ï¼‰çš„ Chrome æµè§ˆå™¨ä¸­ï¼ŒLighthouse å·²ç»ç›´æ¥é›†æˆåˆ°äº†è°ƒè¯•å·¥å…· DevTools ä¸­äº†ï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œä»»ä½•å®‰è£…æˆ–ä¸‹è½½ã€‚æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ consoleã€security ç­‰é€‰é¡¹åé¢æœ‰ä¸€ä¸ª Lighthouse ï¼ˆä½ç‰ˆæœ¬çš„è°·æ­Œæµè§ˆå™¨å¯èƒ½æ˜¾ç¤ºçš„æ˜¯ Auditsï¼‰é€‰é¡¹ï¼Œé€‰æ‹©è¯¥é€‰é¡¹ï¼Œç„¶åç‚¹å‡» Analyse page load å³å¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/171.webp" alt="avatar"></p><p>ä½¿ç”¨ Lighthouse å¯¹ç½‘ç«™è¿›è¡Œæµ‹è¯„åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä»½è¯„åˆ†æŠ¥å‘Šï¼Œå®ƒåŒ…å«äº†æ€§èƒ½ï¼ˆPerformanceï¼‰ï¼Œè®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰ï¼Œæœ€ä½³å®è·µï¼ˆBest Practiceï¼‰ï¼Œæœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ï¼ŒPWAï¼ˆProgressive Web Appï¼‰äº”ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/169.webp" alt="avatar"></p><p>è¿˜æœ‰è¯¦ç»†çš„åˆ†æ:</p><p><img src="https://pb01.s3.bitiful.net/170.webp" alt="avatar"></p><p>ä»è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ä¸»è¦éœ€è¦ä¼˜åŒ–çš„æœ‰:å›¾ç‰‡,æ–‡æœ¬,csså’Œjsç­‰é™æ€èµ„æº</p><h5 id="æ€§èƒ½ï¼ˆPerformanceï¼‰">æ€§èƒ½ï¼ˆPerformanceï¼‰</h5><p>æ€§èƒ½è¯„åˆ†çš„åˆ†å€¼åŒºé—´æ˜¯0åˆ°100ï¼Œå¦‚æœå‡ºç°0åˆ†ï¼Œé€šå¸¸æ˜¯åœ¨è¿è¡Œ Lighthouse æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œæ»¡åˆ†100åˆ†ä»£è¡¨äº†ç½‘ç«™å·²ç»è¾¾åˆ°äº†98åˆ†ä½å€¼çš„æ•°æ®ï¼Œè€Œ50åˆ†åˆ™æ˜¯75åˆ†ä½å€¼çš„æ•°æ®ã€‚</p><p>å½±å“è¯„åˆ†çš„æ€§èƒ½æŒ‡æ ‡ï¼šæ€§èƒ½æµ‹è¯•ç»“æœä¼šåˆ†æˆ Metricsï¼ŒDiagnosticï¼ŒOpportunities ä¸‰éƒ¨åˆ†ï¼Œä½†åªæœ‰ Metrics éƒ¨åˆ†çš„æŒ‡æ ‡é¡¹ä¼šå¯¹åˆ†æ•°äº§ç”Ÿç›´æ¥å½±å“ã€‚</p><p>Lighthouse ä¼šè¡¡é‡ä»¥ä¸‹ Metrics æ€§èƒ½æŒ‡æ ‡é¡¹ï¼š</p><ul><li>é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFirst Contentful Paintï¼‰ã€‚å³æµè§ˆå™¨é¦–æ¬¡å°†ä»»æ„å†…å®¹ï¼ˆå¦‚æ–‡å­—ã€å›¾åƒã€canvas ç­‰ï¼‰ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„æ—¶é—´ç‚¹ã€‚</li><li>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ï¼ˆFirst Meaningful Paintï¼‰ã€‚è¡¡é‡äº†ç”¨æˆ·æ„ŸçŸ¥é¡µé¢çš„ä¸»è¦å†…å®¹ï¼ˆprimary contentï¼‰å¯è§çš„æ—¶é—´ã€‚å¯¹äºä¸åŒçš„ç«™ç‚¹ï¼Œé¦–è¦å†…å®¹æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ï¼šå¯¹äºåšå®¢æ–‡ç« ï¼Œæ ‡é¢˜åŠé¦–å±æ–‡å­—æ˜¯é¦–è¦å†…å®¹ï¼Œè€Œå¯¹äºè´­ç‰©ç½‘ç«™æ¥è¯´ï¼Œå›¾ç‰‡ä¹Ÿä¼šå˜å¾—å¾ˆé‡è¦ã€‚</li><li>é¦–æ¬¡ CPU ç©ºé—²ï¼ˆFirst CPU Idleï¼‰ã€‚å³é¡µé¢é¦–æ¬¡èƒ½å¤Ÿå¯¹è¾“å…¥åšå‡ºååº”çš„æ—¶é—´ç‚¹ï¼Œå…¶å‡ºç°æ—¶æœºå¾€å¾€åœ¨é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶å®Œæˆä¹‹åã€‚è¯¥æŒ‡æ ‡ç›®å‰ä»å¤„äºå®éªŒé˜¶æ®µã€‚</li><li>å¯äº¤äº’æ—¶é—´ï¼ˆTime to Interactiveï¼‰ã€‚æŒ‡çš„æ˜¯æ‰€æœ‰çš„é¡µé¢å†…å®¹éƒ½å·²ç»æˆåŠŸåŠ è½½ï¼Œä¸”èƒ½å¤Ÿå¿«é€Ÿåœ°å¯¹ç”¨æˆ·çš„æ“ä½œåšå‡ºååº”çš„æ—¶é—´ç‚¹ã€‚è¯¥æŒ‡æ ‡ç›®å‰ä»å¤„äºå®éªŒé˜¶æ®µã€‚</li><li>é€Ÿåº¦æŒ‡æ ‡ï¼ˆSpeed Indexï¼‰ã€‚è¡¡é‡äº†é¦–å±å¯è§å†…å®¹ç»˜åˆ¶åœ¨å±å¹•ä¸Šçš„é€Ÿåº¦ã€‚åœ¨é¦–æ¬¡åŠ è½½é¡µé¢çš„è¿‡ç¨‹ä¸­å°½é‡å±•ç°æ›´å¤šçš„å†…å®¹ï¼Œå¾€å¾€èƒ½ç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒï¼Œæ‰€ä»¥é€Ÿåº¦æŒ‡æ ‡çš„å€¼çº¦å°è¶Šå¥½ã€‚</li><li>è¾“å…¥å»¶è¿Ÿä¼°å€¼ï¼ˆEstimated Input Latencyï¼‰ã€‚è¿™ä¸ªæŒ‡æ ‡è¡¡é‡äº†é¡µé¢å¯¹ç”¨æˆ·è¾“å…¥è¡Œä¸ºçš„ååº”é€Ÿåº¦ï¼Œå…¶åŸºå‡†å€¼åº”ä½äº 50msã€‚</li></ul><p>Metrics éƒ¨åˆ†çš„æŒ‡æ ‡é¡¹ä¼šç›´æ¥å½±å“åˆ†æ•°ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„ä¸»è¦å‚è€ƒç‚¹ã€‚</p><p>å¦å¤–çš„ä¸¤éƒ¨åˆ†ä¸­ï¼Œ Opportunities æŒ‡çš„æ˜¯ä¼˜åŒ–æœºä¼šï¼Œå®ƒæä¾›äº†è¯¦ç»†çš„å»ºè®®å’Œæ–‡æ¡£ï¼Œæ¥è§£é‡Šä½åˆ†çš„åŸå› ï¼Œå¸®åŠ©æˆ‘ä»¬å…·ä½“è¿›è¡Œå®ç°å’Œæ”¹è¿›ã€‚Diagnostics æŒ‡çš„æ˜¯ç°åœ¨å­˜åœ¨çš„é—®é¢˜ï¼Œä¸ºè¿›ä¸€æ­¥æ”¹å–„æ€§èƒ½çš„å®éªŒå’Œè°ƒæ•´ç»™å‡ºäº†æŒ‡å¯¼ã€‚è¿™ä¸¤è€…ä¸ä¼šçº³å…¥åˆ†æ•°çš„è®¡ç®—ã€‚</p><p>æ¯ä¸€é¡¹æ€§èƒ½æŒ‡æ ‡å¯¹è¯„åˆ†çš„è´¡çŒ®éƒ½æœ‰å…¶è®¡ç®—é€»è¾‘ï¼ŒLighthouse ä¼šå°†åŸå§‹çš„æ€§èƒ½å€¼æ˜ å°„æˆä¸º 0-100 ä¹‹é—´çš„æ•°å­—ã€‚</p><p>é’ˆå¯¹ä¸åŒçš„è¯„åˆ†ï¼ŒLighthouse ç”¨äº†ä¸åŒçš„é¢œè‰²è¿›è¡Œæ ‡æ³¨ï¼Œåˆ†å€¼åŒºé—´å’Œé¢œè‰²çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li><code>0 - 49ï¼ˆæ…¢ï¼‰ï¼šçº¢è‰²</code></li><li><code>50 - 89ï¼ˆå¹³å‡å€¼ï¼‰ï¼š æ©™è‰²</code></li><li><code>90 - 100ï¼ˆå¿«ï¼‰ï¼š ç»¿è‰²</code></li></ul><h5 id="è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰">è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰</h5><p>è®¿é—®æ— éšœç¢è¯„åˆ†çš„åˆ†å€¼ç”±ç›¸å…³æŒ‡æ ‡çš„åŠ æƒå¹³å‡å€¼è®¡ç®—è€Œæ¥ã€‚å¯ä»¥åœ¨è¯„åˆ†è¯¦æƒ…æŸ¥é˜…æ¯é¡¹æŒ‡æ ‡çš„å…·ä½“æƒé‡ã€‚åŒç†ï¼Œè¾ƒå¤§æƒé‡çš„æŒ‡æ ‡é¡¹å¯¹åˆ†æ•°çš„å½±å“è¾ƒå¤§ã€‚</p><p>æ— éšœç¢æ€§çš„æ¯ä¸ªæŒ‡æ ‡é¡¹æµ‹è¯•ç»“æœä¸ºpassæˆ–è€…failï¼Œä¸æ€§èƒ½æŒ‡æ ‡é¡¹çš„è®¡ç®—æ–¹å¼ä¸åŒï¼Œå½“é¡µé¢åªæ˜¯éƒ¨åˆ†é€šè¿‡æŸé¡¹æŒ‡æ ‡æ—¶ï¼Œé¡µé¢çš„è¿™é¡¹æŒ‡æ ‡å°†ä¸ä¼šå¾—åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡µé¢ä¸­çš„ä¸€äº›å…ƒç´ æœ‰å±å¹•é˜…è¯»å™¨å‹å¥½çš„å‘½åï¼Œè€Œå…¶ä»–çš„å…ƒç´ æ²¡æœ‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢çš„ screenreader-friendly-names æŒ‡æ ‡é¡¹å¾—åˆ†ä¸º0ã€‚</p><h5 id="æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest-Practiceï¼‰">æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest Practiceï¼‰</h5><p>æœ€ä½³å®è·µè¯„åˆ†çš„åˆ†æ•°åŒºé—´ä¸º0-100ã€‚å½±å“è¿™é¡¹è¯„åˆ†çš„æŒ‡æ ‡é¡¹çš„æƒé‡éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>æ¯”å¦‚ï¼šæ¨èä½¿ç”¨ httpsï¼Œè·¨åŸŸçš„è·³è½¬é“¾æ¥éœ€è¦ä½¿ç”¨ rel æ ‡è¯†ï¼Œä¸èƒ½ä½¿ç”¨åºŸå¼ƒçš„ APIç­‰ç­‰ã€‚</p><h5 id="æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰">æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰</h5><p>æ¯”å¦‚ï¼šå›¾ç‰‡å…ƒç´ ä½¿ç”¨ alt å±æ€§ç­‰ç­‰æé«˜æœç´¢å¼•æ“æœç´¢æ’åï¼Œä¾¿äºæœç´¢å¼•æ“èƒ½æ‰¾åˆ°ä½ è¿™ä¸ªç½‘ç«™ã€‚</p><h5 id="PWAï¼ˆProgressive-Web-Appï¼‰">PWAï¼ˆProgressive Web Appï¼‰</h5><p>Lighthouse ä½¿ç”¨ PWA åŸºå‡†æ£€æŸ¥é¡¹åˆ—è¡¨ï¼ˆBaseline PWA Checklistï¼‰è¿›è¡Œæµ‹è¯„ï¼Œæµ‹è¯„ç»“æœå°†è¿™äº›æŒ‡æ ‡é¡¹åˆ†æˆäº†å››ä¸ªç±»åˆ«ï¼Œå…±åŒ…å«12ä¸ªè‡ªåŠ¨æµ‹è¯•é¡¹å’Œ3ä¸ªæ‰‹åŠ¨æµ‹è¯•é¡¹ï¼Œå…¶ä¸­å„ä¸ªè‡ªåŠ¨æµ‹è¯•é¡¹çš„è¯„åˆ†æƒé‡æ˜¯ç›¸åŒçš„ã€‚PWA çš„è¯„æµ‹æŒ‡æ ‡å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸é‡è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™å››ä¸ªç±»åˆ«è¯¦ç»†äº†è§£ä¸€ä¸‹åŸºå‡†æŒ‡æ ‡é¡¹ã€‚</p><p><strong>å¿«é€Ÿå¯é </strong>ï¼š</p><ol><li>é¡µé¢åœ¨ç§»åŠ¨ç½‘ç»œæ¡ä»¶ä¸‹èƒ½å¤Ÿå¿«é€ŸåŠ è½½ã€‚</li><li>åœ¨ç¦»çº¿æ¡ä»¶ä¸‹é¡µé¢èƒ½å¤Ÿè¿”å›çŠ¶æ€ç 200ã€‚</li><li>start_url åœ¨ç¦»çº¿æ¡ä»¶ä¸‹è¿”å›çŠ¶æ€ç 200ã€‚æ‰“å¼€è¯¥ PWA æ—¶åŠ è½½çš„ URLã€‚</li></ol><p><strong>å¯å®‰è£…</strong>ï¼š</p><ol><li>å§‹ç»ˆä½¿ç”¨ HTTPSã€‚</li><li>æ³¨å†Œ Service Worker æ¥ç¼“å­˜é¡µé¢ä»¥åŠ start_urlã€‚</li><li>ä½¿ç”¨ manifest æ–‡ä»¶æ¥å®ç°å®‰è£… PWA çš„éœ€æ±‚ï¼Œæµè§ˆå™¨èƒ½å¤Ÿä¸»åŠ¨é€šçŸ¥ç”¨æˆ·å°†åº”ç”¨æ·»åŠ åˆ°æ¡Œé¢ï¼Œå¢åŠ ç•™å­˜ç‡ã€‚</li></ol><p><strong>PWA ä¼˜åŒ–</strong>ï¼š</p><ol><li>å°† HTTP æµé‡é‡å®šå‘åˆ° HTTPSã€‚</li><li>é…ç½®è‡ªå®šä¹‰å¯åŠ¨ç”»é¢ã€‚</li><li>è®¾ç½®åœ°å€æ ä¸»é¢˜é¢œè‰²ã€‚</li><li>é¡µé¢å†…å®¹é’ˆå¯¹è§†å£å¤§å°è‡ªé€‚åº”ï¼Œå¯¹ç§»åŠ¨ç”¨æˆ·çš„å±•ç¤ºæ›´å‹å¥½ã€‚</li><li>ä½¿ç”¨äº†æ ‡ç­¾ï¼Œå¹¶è®¾ç½®äº† width æˆ– initial-scale å±æ€§ã€‚</li><li>å½“ JavaScript æ–‡ä»¶ä¸å¯ç”¨æ—¶ï¼Œæä¾›é™çº§æªæ–½ï¼Œé¡µé¢èƒ½æ˜¾ç¤ºåŸºæœ¬å†…å®¹è€Œä¸å‡ºç°ç™½å±ã€‚</li></ol><p><strong>æ‰‹åŠ¨æµ‹è¯•é¡¹</strong>ï¼š</p><ol><li>ç«™ç‚¹è·¨æµè§ˆå™¨å¯ç”¨ï¼Œå¦‚ä¸»æµæµè§ˆå™¨ Chrome, Edge, Firefox åŠ Safari ç­‰ã€‚</li><li>é¡µé¢é—´åˆ‡æ¢æµç•…ï¼Œå³ä½¿åœ¨è¾ƒå·®çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œåˆ‡æ¢åŠ¨ç”»ä¹Ÿåº”è¯¥ç®€æ´é¡ºç•…ï¼Œè¿™æ˜¯æé«˜ç”¨æˆ·æ„ŸçŸ¥ä½“éªŒçš„å…³é”®ã€‚</li><li>ä¿è¯æ¯ä¸ªé¡µé¢éƒ½æœ‰ç‹¬ä¸€æ— äºŒçš„ URLï¼Œèƒ½å¤Ÿåœ¨æ–°çš„æµè§ˆå™¨çª—å£æ‰“å¼€ï¼Œä¸”æ–¹ä¾¿åœ¨ç¤¾äº¤åª’ä½“ä¸Šè¿›è¡Œåˆ†äº«ã€‚</li><li>é™¤äº†ä¸Šè¿°åŸºå‡†æŒ‡æ ‡é¡¹ä¹‹å¤–ï¼Œä¸ºäº†è®© PWA çš„ä½“éªŒæ›´åŠ å®Œç¾ï¼Œè¿˜æœ‰ä¸€äº› Lighthouse æœªå®ç°æ£€æŸ¥çš„è¿›é˜¶æŒ‡æ ‡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½œä¸ºç¤ºèŒƒæ€§å‚è€ƒçš„ PWA çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ç”¨æˆ·ä½“éªŒã€ç¼“å­˜ã€æ¨é€é€šçŸ¥ç­‰ç­‰ã€‚</li></ol><h3 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</h3><h4 id="å›¾ç‰‡ä¼˜åŒ–">å›¾ç‰‡ä¼˜åŒ–</h4><p>æ•´ä½“æ€è·¯å°±æ˜¯<code>å‹ç¼©å›¾ç‰‡</code>ï¼Œå‡å°‘å›¾ç‰‡ä½“ç§¯ï¼Œæé«˜åŠ è½½é€Ÿåº¦.æ¨èé‡‡ç”¨webpæ ¼å¼,åœ¨å›¾ç‰‡è´¨é‡ç›¸ä¼¼çš„æƒ…å†µä¸‹å¯ä»¥èŠ‚çœçº¦50%çš„ä½“ç§¯</p><p>æˆ‘ä¹‹å‰çš„å›¾ç‰‡ä»¥pngä¸ºä¸»,è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯webp,ç”±äºå›¾ç‰‡å¤ªå¤š,å…¨è½¬å¾ˆéº»çƒ¦,æˆ‘å…ˆå°†éƒ¨åˆ†å¸¸ç”¨png(èƒŒæ™¯å›¾,å°é¢å›¾ç­‰)è½¬æˆäº†webp,ç„¶åå°†å…¨éƒ¨pngè¿›è¡Œå‹ç¼©,ä¹‹åæ–°å¢çš„å›¾ç‰‡å…¨è½¬ä¸ºwebpæ ¼å¼</p><p>ä½¿ç”¨å·¥å…·:<a href="https://imagestool.com/zh_CN/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">imagestool</a>,æ”¯æŒæ‰¹é‡è½¬æ¢,è½¬æ¢é€Ÿåº¦å¾ˆå¿«</p><p>è¿˜æœ‰å°±æ˜¯<code>æ‡’åŠ è½½</code>,æœ‰èŠ‚çœæµé‡ä¸æé«˜æ€§èƒ½çš„ä½œç”¨ã€‚Butterflyä¸»é¢˜å†…ç½®äº†å›¾ç‰‡æ‡’åŠ è½½çš„é€‰é¡¹ï¼Œåœ¨_config.butterfly.ymlæ–‡ä»¶ä¸‹å°†å¯¹åº”é¡¹è®¾ç½®ä¸ºå¦‚ä¸‹å³å¯ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Lazyload (åœ–ç‰‡æ‡¶åŠ è¼‰)</span></span><br><span class="line"><span class="comment"># https://github.com/verlok/vanilla-lazyload</span></span><br><span class="line"><span class="attr">lazyload:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post é€‰æ‹©åœ¨å“ªäº›åœ°æ–¹å¯ç”¨å›¾ç‰‡æ‡’åŠ è½½</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="comment"># ä½ è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡</span></span><br><span class="line">  <span class="attr">blur:</span> <span class="literal">true</span><span class="comment"># æ¨¡ç³Šæ•ˆæœ</span></span><br></pre></td></tr></table></figure><h4 id="å­—ä½“ä¼˜åŒ–">å­—ä½“ä¼˜åŒ–</h4><p>ä»Lighthouseçš„è¯¦æƒ…åˆ†æä¸­æˆ‘å¾—çŸ¥ç½‘ç«™é¦–é¡µçš„å­—ä½“åŠ è½½é€Ÿåº¦å¾ˆæ…¢,å¦‚å›¾:</p><p><img src="https://pb01.s3.bitiful.net/172.webp" alt="avatar"></p><p>æˆ‘ä»¬ä»ç½‘ä¸Šä¸‹è½½çš„å­—ä½“é€šå¸¸éƒ½æ˜¯TTFæ ¼å¼ï¼Œttf(TrueTypeFont)æ˜¯ä¸€ç§å­—åº“åç§°ï¼Œæ˜¯Appleå…¬å¸å’ŒMicrosoftå…¬å¸å…±åŒæ¨å‡ºçš„å­—ä½“æ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ ¼å¼ä¹‹ä¸€ï¼Œä½†æ˜¯ä¸€äº›å¥½çœ‹çš„å­—ä½“å¾€å¾€ä½“ç§¯éƒ½ä¼šå¾ˆå¤§ï¼Œç½‘ç«™æ¯æ¬¡è¿›å»éƒ½è¦åŠ è½½ä¸€ä¸ªè¿™ä¹ˆå¤§çš„æ–‡ä»¶ï¼Œé€Ÿåº¦è‚¯å®šä¼šå¾ˆæ…¢ï¼</p><p>é‡‡ç”¨fonttoolsç¼–ç å‹ç¼©+è½¬woff2æ ¼å¼äºŒçº§å‹ç¼©,å‚è€ƒ<a href="https://blog.csdn.net/littleduo/article/details/124563106" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">æœ‰æ•ˆçš„å­—ä½“å‹ç¼©æ–¹æ³•</a></p><h4 id="é™æ€èµ„æºä¼˜åŒ–">é™æ€èµ„æºä¼˜åŒ–</h4><p>å®‰è£…Gulpæ’ä»¶ï¼šåœ¨åšå®¢æ ¹ç›®å½•[Blogroot]æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --global gulp-cli <span class="comment">#å…¨å±€å®‰è£…gulpæŒ‡ä»¤é›†</span></span><br><span class="line">npm install gulp --save <span class="comment">#å®‰è£…gulpæ’ä»¶</span></span><br></pre></td></tr></table></figure><p>å®‰è£…å„ä¸ªä¸‹å±æ’ä»¶ä»¥å®ç°å¯¹å„ç±»é™æ€èµ„æºçš„å‹ç¼©</p><p><strong>HTMLå‹ç¼©</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-htmlclean --save-dev</span><br><span class="line">npm install gulp-html-minifier-terser --save-dev</span><br><span class="line"><span class="comment"># ç”¨gulp-html-minifier-terserå¯ä»¥å‹ç¼©HTMLä¸­çš„ES6è¯­æ³•</span></span><br></pre></td></tr></table></figure><p><strong>CSSå‹ç¼©</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-htmlclean --save-dev</span><br></pre></td></tr></table></figure><p><strong>JSå‹ç¼©</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-terser --save-dev</span><br></pre></td></tr></table></figure><p><strong>å­—ä½“åŒ…å‹ç¼©</strong><br>font-minä»…æ”¯æŒå‹ç¼©ttfæ ¼å¼çš„å­—ä½“åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-fontmin --save-dev</span><br></pre></td></tr></table></figure><p>ä¸ºGulpåˆ›å»ºgulpfile.jsä»»åŠ¡è„šæœ¬ã€‚åœ¨åšå®¢æ ¹ç›®å½•[Blogroot]ä¸‹æ–°å»ºgulpfile.js,æ‰“å¼€[Blogroot]\gulpfile.js,è¾“å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨åˆ°çš„å„ä¸ªæ’ä»¶</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cleanCSS = <span class="built_in">require</span>(<span class="string">&#x27;gulp-clean-css&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-html-minifier-terser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlclean&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fontmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-fontmin&#x27;</span>);</span><br><span class="line"><span class="comment">// gulp-tester</span></span><br><span class="line"><span class="keyword">var</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;gulp-terser&#x27;</span>);</span><br><span class="line"><span class="comment">// å‹ç¼©js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;compress&#x27;</span>, <span class="title function_">async</span>() =&gt;&#123;</span><br><span class="line">  gulp.<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.js&#x27;</span>, <span class="string">&#x27;!./public/**/*.min.js&#x27;</span>])</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">terser</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©css</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.css&#x27;</span>])</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">cleanCSS</span>(&#123;</span><br><span class="line">            <span class="attr">compatibility</span>: <span class="string">&#x27;ie11&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="comment">//æ¸…é™¤htmlæ³¨é‡Š</span></span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©html</span></span><br><span class="line">            <span class="attr">collapseBooleanAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//çœç•¥å¸ƒå°”å±æ€§çš„å€¼ï¼Œä¾‹å¦‚ï¼š&lt;input checked=&quot;true&quot;/&gt; ==&gt; &lt;input /&gt;</span></span><br><span class="line">            <span class="attr">removeEmptyAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤æ‰€æœ‰ç©ºæ ¼ä½œå±æ€§å€¼ï¼Œä¾‹å¦‚ï¼š&lt;input id=&quot;&quot; /&gt; ==&gt; &lt;input /&gt;</span></span><br><span class="line">            <span class="attr">removeScriptTypeAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤&lt;script&gt;çš„type=&quot;text/javascript&quot;</span></span><br><span class="line">            <span class="attr">removeStyleLinkTypeAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤&lt;style&gt;å’Œ&lt;link&gt;çš„ type=&quot;text/css&quot;</span></span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©é¡µé¢ JS</span></span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©é¡µé¢ CSS</span></span><br><span class="line">            <span class="attr">minifyURLs</span>: <span class="literal">true</span>  <span class="comment">//å‹ç¼©é¡µé¢URL</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©å­—ä½“</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">minifyFont</span>(<span class="params">text, cb</span>) &#123;</span><br><span class="line">  gulp</span><br><span class="line">    .<span class="title function_">src</span>(<span class="string">&#x27;./public/fonts/*.ttf&#x27;</span>) <span class="comment">//åŸå­—ä½“æ‰€åœ¨ç›®å½•</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">fontmin</span>(&#123;</span><br><span class="line">      <span class="attr">text</span>: text</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public/fontsdest/&#x27;</span>)) <span class="comment">//å‹ç¼©åçš„è¾“å‡ºç›®å½•</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;mini-font&#x27;</span>, <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffers = [];</span><br><span class="line">  gulp</span><br><span class="line">    .<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.html&#x27;</span>]) <span class="comment">//HTMLæ–‡ä»¶æ‰€åœ¨ç›®å½•è¯·æ ¹æ®è‡ªèº«æƒ…å†µä¿®æ”¹</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">file</span>) &#123;</span><br><span class="line">      buffers.<span class="title function_">push</span>(file.<span class="property">contents</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> text = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(buffers).<span class="title function_">toString</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">      <span class="title function_">minifyFont</span>(text, cb);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è¿è¡Œgulpå‘½ä»¤æ—¶ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>, gulp.<span class="title function_">parallel</span>(</span><br><span class="line">  <span class="string">&#x27;compress&#x27;</span>, <span class="string">&#x27;minify-css&#x27;</span>, <span class="string">&#x27;minify-html&#x27;</span>,<span class="string">&#x27;mini-font&#x27;</span></span><br><span class="line">))</span><br></pre></td></tr></table></figure><p>åœ¨æ¯æ¬¡è¿è¡Œå®Œhexo generateç”Ÿæˆé™æ€é¡µé¢åï¼Œè¿è¡Œgulpå¯¹å…¶è¿›è¡Œå‹ç¼©ã€‚æŒ‡ä»¤æµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">gulp</span><br><span class="line">hexo server æˆ– hexo deploy</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿˜å¯ä»¥é€šè¿‡<code>å‡å°‘åŠ è½½é¡¹</code>çš„æ–¹å¼æ¥ä¼˜åŒ–:</p><ul><li>å‡å°‘å¡ç‰‡çš„å‡ºåœºåŠ¨ç”»wowjsã€Live2Dã€canvaså…ƒç´ ç­‰(å…¶ä¸­Live2Dæ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„)</li><li>å¦‚æœéƒ¨åˆ†jså’Œcssæ–‡ä»¶åªæœ‰éƒ¨åˆ†é¡µé¢éœ€è¦å¼•ç”¨ï¼Œå°½é‡ä¸å…¨å±€å¼•ç”¨ï¼ŒåŒæ—¶åˆ é™¤ç©ºæ ¼ã€ç©ºè¡Œã€æ³¨é‡Šã€å‡å°‘æ— æ„ä¹‰çš„å•ä½</li><li>cssæ–‡ä»¶å°½é‡æ·»åŠ mediaå­—æ®µæŒ‡å®šåŠ è½½è®¾å¤‡ï¼Œjsæ–‡ä»¶çš„å¼•å…¥å¯ä»¥åŠ å…¥ çš„ asyncã€defer å±æ€§å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ DOM æ¸²æŸ“</li></ul>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçº¿ç¨‹æ¨¡å‹</title>
      <link href="/2024/04/16/2024-4-14-redis%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/"/>
      <url>/2024/04/16/2024-4-14-redis%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨">Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨</h2><h4 id="Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ">Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ</h4><p>redis6.0åï¼Œå…¨é¢æ”¯æŒå¤šçº¿ç¨‹ã€‚rediså•çº¿ç¨‹æŒ‡çš„æ˜¯ <code>æ¥æ”¶è¯·æ±‚ã€è§£æè¯·æ±‚ã€è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œã€è¿”å›æ•°æ®</code>ç»™å®¢æˆ·ç«¯è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ä»¥åŠRedisçš„ç½‘ç»œIOæ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç§°redisä¸ºå•çº¿ç¨‹ã€‚</p><p>ä½†æ˜¯redisæœåŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå¯åŠ¨åå°çº¿ç¨‹ï¼Œå¸¸è§çš„æœ‰ä¸¤ä¸ª</p><ul><li>åå°åˆ·ç›˜çº¿ç¨‹ï¼šå½“æˆ‘ä»¬é…ç½®AOFç­–ç•¥ä¸ºeverysecæ—¶ï¼Œæ¯éš”ä¸€ç§’ï¼Œç”±åå°çº¿ç¨‹å®Œæˆåˆ·ç›˜æ“ä½œ</li><li>åå°é‡Šæ”¾å†…å­˜çº¿ç¨‹ï¼šredis æä¾›unlinkå‘½ä»¤ï¼Œå¼‚æ­¥é‡Šæ”¾å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å¤§key</li></ul><p>ä¹‹æ‰€ä»¥æœ‰åå°çº¿ç¨‹ï¼Œåªä¸ºäº†ä¸è®©ä¸»çº¿ç¨‹å»æ‰§è¡Œè¿™äº›æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæ— æ³•å“åº”è¯·æ±‚ã€‚</p><h4 id="Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ">Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ</h4><p>Redis çš„å¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› æ­¤ Redis ç“¶é¢ˆå¯èƒ½æ˜¯æœºå™¨çš„å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ï¼Œè€Œå¹¶é CPUï¼Œæ‰€ä»¥ Redis æ ¸å¿ƒç½‘ç»œæ¨¡å‹ä½¿ç”¨å•çº¿ç¨‹å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”å•çº¿ç¨‹é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´å¹¶å‘ç«äº‰é—®é¢˜ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</p><p><code>Redis 6.0å¼•å…¥å¤šçº¿ç¨‹åï¼Œä¼šäº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜å—ï¼Ÿ</code><br>ä¸ä¼š,å¼•å…¥çš„å¤šçº¿ç¨‹åªæ˜¯é’ˆå¯¹ç½‘ç»œIOï¼Œåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œä»ç„¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œ</p><h4 id="Redis-6-0-ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ">Redis 6.0 ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</h4><p>è™½ç„¶ Redis çš„ä¸»è¦å·¥ä½œï¼ˆç½‘ç»œ I/O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯åœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼Œä¹Ÿé‡‡ç”¨äº†å¤šä¸ª I/O çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œè¿™æ˜¯å› ä¸ºéšç€ç½‘ç»œç¡¬ä»¶çš„æ€§èƒ½æå‡ï¼ŒRedis çš„æ€§èƒ½ç“¶é¢ˆæœ‰æ—¶ä¼šå‡ºç°åœ¨ç½‘ç»œ I/O çš„å¤„ç†ä¸Šã€‚</p><p>æ‰€ä»¥ä¸ºäº†æé«˜ç½‘ç»œ I/O çš„å¹¶è¡Œåº¦ï¼ŒRedis 6.0 å¯¹äºç½‘ç»œ I/O é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚å¯¹äºå‘½ä»¤çš„æ‰§è¡Œï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ï¼Œä¸è¦è¯¯è§£ Redis æœ‰å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‘½ä»¤ã€‚Redis å®˜æ–¹è¡¨ç¤ºï¼ŒRedis 6.0 ç‰ˆæœ¬å¼•å…¥çš„å¤šçº¿ç¨‹ I/O ç‰¹æ€§å¯¹æ€§èƒ½æå‡è‡³å°‘æ˜¯ä¸€å€ä»¥ä¸Šã€‚</p><h4 id="Redis-é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ">Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ</h4><ol><li>Redis çš„å¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œ</li><li>Redis é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´å¹¶å‘ç«äº‰é—®é¢˜ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</li><li>Redis é‡‡ç”¨äº† I/O å¤šè·¯å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼Œæ¥å¤„ç†å®¢æˆ·ç«¯äº§ç”Ÿçš„äº‹ä»¶,å³è®©ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ä¸å¤šä¸ªå·²å®Œæˆè¿æ¥socketè¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥ç§°ä¸ºå¤šè·¯å¤ç”¨ã€‚ç”¨æˆ·æ€çš„çº¿ç¨‹æ€ä¹ˆæ„ŸçŸ¥å‘¢ï¼Ÿå®ç°è¿™ä¸€æœºåˆ¶çš„æ ¸å¿ƒæ˜¯ï¼šå†…æ ¸æä¾›çš„ select() / epoll() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œæ¥å…è®¸Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶å’Œå¤šä¸ªå·²å®Œæˆè¿æ¥çš„ Socketè¿›è¡Œé€šä¿¡ã€‚è®©å¤„äºç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œå‘ç°è¯·æ±‚ç½‘ç»œäº‹ä»¶çš„socketï¼Œçº¿ç¨‹æ‰å¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†.ç±»ä¼¼äºCPUå¹¶å‘è°ƒåº¦çº¿ç¨‹ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ª Redis çº¿ç¨‹å¤„ç†å¤šä¸ª IO æµï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰çš„æ•ˆæœã€‚</li></ol><h4 id="Redis-å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰">Redis å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰</h4><p>Redis 6.0 ç‰ˆæœ¬ä¹‹å‰çš„å•çº¿ç¨‹æ¨¡å¼å¦‚ä¸‹å›¾ï¼š<br><img src="https://pb01.s3.bitiful.net/168.webp" alt="avatar"></p><p>Redis åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåšä¸‹é¢è¿™å‡ ä»¶äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œè°ƒç”¨ epoll_create() åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡å’Œè°ƒç”¨ socket() åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ socket</li><li>ç„¶åï¼Œè°ƒç”¨ bind() ç»‘å®šæœåŠ¡ç«¯IPã€ç«¯å£å’Œè°ƒç”¨ listen() æœåŠ¡ç«¯å¼€å§‹ç›‘å¬è¯¥ç«¯å£ï¼›</li><li>ç„¶åï¼Œå°†è°ƒç”¨ epoll_ctl() å°† listen socket åŠ å…¥åˆ° epollï¼ŒåŒæ—¶æ³¨å†Œã€Œè¿æ¥äº‹ä»¶ã€å¤„ç†å‡½æ•°ã€‚</li></ul><p>åˆå§‹åŒ–å®Œåï¼Œä¸»çº¿ç¨‹å°±è¿›å…¥åˆ°ä¸€ä¸ªäº‹ä»¶å¾ªç¯å‡½æ•°ï¼Œä¸»è¦ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li><p>é¦–å…ˆï¼Œå…ˆè°ƒç”¨å¤„ç†å‘é€é˜Ÿåˆ—å‡½æ•°ï¼Œçœ‹æ˜¯å‘é€é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å‘é€ä»»åŠ¡ï¼Œåˆ™é€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šæ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</p></li><li><p>æ¥ç€ï¼Œè°ƒç”¨ epoll_wait å‡½æ•°ç­‰å¾…äº‹ä»¶çš„åˆ°æ¥ï¼š</p><p>â—‹å¦‚æœæ˜¯è¿æ¥äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt; è°ƒç”¨ epoll_ctl å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</p><p>â—‹å¦‚æœæ˜¯è¯»äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨è¯»äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</p><p>â—‹å¦‚æœæ˜¯å†™äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨å†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯I-Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ">ä»€ä¹ˆæ˜¯I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ</h3><h4 id="åŸºäºTCPåè®®çš„Socketé€šä¿¡">åŸºäºTCPåè®®çš„Socketé€šä¿¡</h4><p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´è¦è¿›è¡Œé€šä¿¡ï¼Œæœ€åŸºæœ¬çš„ç½‘ç»œI/Oæ¨¡å‹å°±æ˜¯é€šè¿‡socketè¿›è¡ŒTCPåè®®é€šä¿¡ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æœåŠ¡ç«¯è°ƒç”¨socket()å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªç›‘å¬è¯·æ±‚çš„socketï¼Œ</li><li>æœåŠ¡ç«¯è°ƒç”¨bind()å‡½æ•°ï¼Œåœ¨æ­¤ç›‘å¬socketä¸Šï¼Œç»‘å®šæœåŠ¡ç«¯çš„IPã€åº”ç”¨ç¨‹åºçš„ç«¯å£å·</li><li>è¿™æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯çš„å†…æ ¸èƒ½å¤Ÿæ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸”å‘é€åˆ°ç›¸åº”çš„åº”ç”¨ç¨‹åº</li><li>æœåŠ¡ç«¯è°ƒç”¨listen()å‡½æ•°ï¼Œå¼€å§‹ç›‘å¬ç«¯å£,å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨connect()å‡½æ•°ï¼Œç»‘å®šæœåŠ¡ç«¯çš„IPã€ç«¯å£å·ï¼Œè¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹.æ¡æ‰‹æˆåŠŸåï¼Œä¼šå°†<strong>å·²å®Œæˆè¿æ¥çš„socket</strong>ï¼Œæ”¾å…¥æœåŠ¡ç«¯å†…æ ¸çš„TCPå…¨è¿æ¥é˜Ÿåˆ—ä¸­</li><li>æœåŠ¡ç«¯é€šè¿‡è°ƒç”¨accept()å‡½æ•°ï¼Œä»å†…æ ¸è·å–å·²å®Œæˆè¿æ¥çš„socketè¿›è¡Œé€šä¿¡,è‹¥TCPå…¨è¿æ¥é˜Ÿåˆ—ä¸­ï¼Œæ— å·²å®Œæˆè¿æ¥çš„socketï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„åˆ°æ¥</li></ul><p>åŸºäºTCPåè®®çš„socketé€šä¿¡ï¼Œæ˜¯<strong>åŒæ­¥é˜»å¡</strong>çš„ï¼Œå½“æœåŠ¡ç«¯è¿˜æ²¡å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œ I/O ï¼Œæˆ–è€…è¯»å†™æ“ä½œå‘ç”Ÿé˜»å¡ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯æ— æ³•ä¸æœåŠ¡ç«¯è¿æ¥çš„,å³æœåŠ¡ç«¯åªèƒ½ä¸å®¢æˆ·ç«¯è¿›è¡Œä¸€å¯¹ä¸€è¿æ¥é€šä¿¡ï¼Œä¸€ä¸ªæœåŠ¡ç«¯åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ï¼Œå¾ˆä½æ•ˆ</p><h4 id="åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O">åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O</h4><p>è¦æƒ³å®ç°æœåŠ¡ç«¯åŒæ—¶æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ï¼Œæœ€åŸå§‹çš„æ–¹å¼å°±æ˜¯ç”¨å¤šè¿›ç¨‹ï¼Œå³ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚æ¯å½“æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®Œæˆè¿æ¥ï¼Œè°ƒç”¨accept()å‡½æ•°è¿”å›ä¸€ä¸ªå·²å®Œæˆè¿æ¥çš„socketï¼Œä¸»è¿›ç¨‹å°±ä¼šé€šè¿‡fork()è°ƒç”¨ï¼Œäº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</p><p>è¿™æ ·è™½ç„¶è§£å†³äº†åªèƒ½æœåŠ¡äºä¸€ä¸ªå®¢æˆ·ç«¯çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ¯äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå¿…ä¼šå æ®ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œè€Œä¸”è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½å¤§æ‰“æŠ˜æ‰£ã€‚</p><h4 id="åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O">åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O</h4><p>æ”¹è¿›å¤šè¿›ç¨‹ä»£ä»·é«˜çš„ç¼ºç‚¹ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹æ¥æœåŠ¡äºå®¢æˆ·ç«¯<br>çº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹çš„æ‰§è¡Œæµï¼Œæ‰€ä»¥å¯ä»¥å…±äº«è¿›ç¨‹çš„å¾ˆå¤šèµ„æºï¼Œå¯¹äºä¸€äº›ç§æœ‰æ•°æ®ï¼Œæ‰éœ€è¦è¿›è¡Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå‡å°‘äº†å¾ˆå¤šå¼€é”€ã€‚<br>é€šè¿‡çº¿ç¨‹æ± ï¼Œæ¥é¿å…é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹ï¼Œé”€æ¯çº¿ç¨‹ã€‚æé«˜æ€§èƒ½</p><p>ä½†æ˜¯è¿˜ä¸å¤Ÿå®Œç¾ï¼Œå› ä¸ºæœ¬è´¨ä¸Šï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡ï¼Œè¿˜æ˜¯åŸºäºä¸€å¯¹ä¸€çš„æ–¹å¼ï¼Œåªä¸è¿‡æ¨¡å‹ç¼©å°ä¸ºçº¿ç¨‹,èƒ½ä¸èƒ½è®©ä¸€ä¸ªè¿›ç¨‹åŒæ—¶ä¸å¤šä¸ªsocketè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ</p><h4 id="å¼•å…¥I-Oå¤šè·¯å¤ç”¨æ¨¡å‹">å¼•å…¥I/Oå¤šè·¯å¤ç”¨æ¨¡å‹</h4><p>ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯ä»¥ç»´æŠ¤å¤šä¸ªå·²å®Œæˆè¿æ¥çš„socket</p><p><code>è¿›ç¨‹æ€ä¹ˆçŸ¥é“ï¼Œå“ªä¸ªsocketæœ‰äº‹ä»¶è¯·æ±‚å‘¢ï¼Ÿ</code><br>å†…æ ¸æä¾›äº†ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œselect()/poll()/epoll()ï¼Œç”¨æˆ·æ€çš„è¿›ç¨‹é€šè¿‡è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå°±å¯ä»¥å¾—çŸ¥ï¼Œå“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ã€‚</p><p><strong>select()/poll()</strong>:</p><p>æœ¬è´¨éƒ½æ˜¯åœ¨ç”¨æˆ·æ€çº¿æ€§å­˜å‚¨socketæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå½“è°ƒç”¨å‡½æ•°select()/poll()æ—¶ï¼Œä¼šå°†å­˜å‚¨çš„é›†åˆæ‹·è´åˆ°å†…æ ¸ï¼Œå†…æ ¸é€šè¿‡éå†åˆ¤æ–­ï¼Œå“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ï¼Œå…·ä½“åˆ†ä¸ºè¯»/å†™äº‹ä»¶ï¼Œè¿›è¡Œç›¸åº”çš„æ ‡è®°ã€‚</p><p>å†…æ ¸æ ‡è®°å®Œæˆåï¼Œå°†é›†åˆæ‹·è´å›ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€é€šè¿‡éå†çš„æ–¹å¼ï¼ŒæŸ¥çœ‹å“ªäº›æ–‡ä»¶æè¿°ç¬¦è¢«æ ‡è®°ï¼Œè¿›è€Œå¾—çŸ¥å“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ï¼Œå…·ä½“åˆ†ä¸ºè¯»/å†™äº‹ä»¶ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p><p>ç¼ºç‚¹ï¼š<br>å¯¹äº select()/poll() æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€æ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œï¼Œè¿˜ä¼šå‘ç”Ÿ 2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸æ ‡è®°åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p><p>æ˜¾è€Œæ˜“è§ï¼Œéšç€å¹¶å‘æ•°é‡æç¤ºï¼Œæ‹·è´ &amp; éå† äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ï¼Œå°†ä¼šéå¸¸å¤§ã€‚</p><p><strong>epoll()</strong>:<br>epoll()å‡½æ•°ï¼Œä¸åŒäºä»¥ä¸Šä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„åœ°æ–¹åœ¨äº: åœ¨å†…æ ¸ä¸­ä¼šç”¨çº¢é»‘æ ‘ç»“æ„ï¼Œä¿å­˜è¿›ç¨‹ç»´æŠ¤çš„socketæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå³å°†å·²å®Œæˆè¿æ¥çš„socketï¼Œé€šè¿‡epoll_ctl() å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œ, çº¢é»‘æ ‘è¿›è¡ŒæŸ¥æ‰¾ã€æ·»åŠ ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºlog(N)ï¼Œæ€§èƒ½å¥½</p><p>å¹¶ä¸”åœ¨å†…æ ¸ä¸­ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªæœ‰äº‹ä»¶å‘ç”Ÿçš„socketé“¾è¡¨ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡epoll_wait()å‡½æ•°ï¼Œå³å¯å¾—åˆ°æœ‰äº‹ä»¶å‘ç”Ÿçš„socket,èŠ‚çœäº†ç”¨æˆ·æ€ä¸å†…æ ¸æ€è¿›è¡Œéå†çš„è¿‡ç¨‹ï¼Œæå‡æ€§èƒ½</p><p>é‡‡ç”¨ epoll æ¨¡å‹è¿›è¡Œç½‘ç»œI/Oï¼Œè¢«ç§°ä¸ºè§£å†³ <strong>C10K</strong> é—®é¢˜çš„åˆ©å™¨ï¼š<br>æ”¯æŒä¸€ä¸ªè¿›ç¨‹æ‰“å¼€å¤§æ•°ç›®çš„socketæè¿°ç¬¦(FD),å®ƒæ‰€æ”¯æŒçš„FDä¸Šé™æ˜¯æœ€å¤§å¯ä»¥æ‰“å¼€æ–‡ä»¶çš„æ•°ç›®</p><p>IOæ•ˆç‡ä¸éšFDæ•°ç›®å¢åŠ è€Œçº¿æ€§ä¸‹é™, select/pollæ¯æ¬¡è°ƒç”¨éƒ½ä¼šçº¿æ€§è½®è¯¢æ‰«æå…¨éƒ¨çš„fdé›†åˆï¼Œå¯¼è‡´æ•ˆç‡å‘ˆç°çº¿æ€§ä¸‹é™ã€‚epollä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåªä¼šå¯¹<code>æ´»è·ƒ</code>çš„socketè¿›è¡Œæ“ä½œï¼Œè¿™æ˜¯å› ä¸ºåœ¨å†…æ ¸å®ç°ä¸­epollæ˜¯æ ¹æ®æ¯ä¸ªfdä¸Šé¢çš„å›è°ƒå‡½æ•°å®ç°çš„</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisæŒä¹…åŒ–(AOF|RDB)</title>
      <link href="/2024/04/12/2024-4-12-redis%E6%8C%81%E4%B9%85%E5%8C%96/"/>
      <url>/2024/04/12/2024-4-12-redis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="RedisæŒä¹…åŒ–-AOF-RDB">RedisæŒä¹…åŒ–(AOF|RDB)</h2><h3 id="AOF">AOF</h3><h4 id="AOFæ˜¯ä»€ä¹ˆ">AOFæ˜¯ä»€ä¹ˆ?</h4><p>AOFå…¨ç§°æ˜¯append only file, å³åªè¿½åŠ æ–‡ä»¶ã€‚</p><p>AOFæŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜RedisæœåŠ¡å™¨æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ã€‚</p><p>AOFé»˜è®¤æ˜¯ä¸å¼€å¯çš„,éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br></pre></td></tr></table></figure><p>AOFæŒä¹…åŒ–é…ç½®é¡¹è¯´æ˜ï¼š</p><ul><li>appendonlyï¼šæ˜¯å¦å¼€å¯AOFæŒä¹…åŒ–</li><li>appendfilenameï¼šæŒä¹…åŒ–æ–‡ä»¶å</li></ul><p>rediså¤„ç†å†™å‘½ä»¤çš„æ—¶,ä¼šé‡‡å–å…ˆå†™å†…å­˜æ•°æ®,å†è®°å½•AOFæ—¥å¿—çš„æ–¹å¼,è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„:</p><ul><li>å‡å°‘é¢å¤–æ£€æŸ¥å¼€é”€: åªæœ‰å†…å­˜æ•°æ®è¢«ä¿®æ”¹æˆåŠŸåæ‰ä¼šå†™AOFæ—¥å¿—,ä¿è¯äº†æ—¥å¿—éƒ½æ˜¯å¯æ‰§è¡Œä¸”æ­£ç¡®çš„</li><li>ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œ</li></ul><p><strong>é£é™©</strong></p><p>å¦‚æœå‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå†™æ—¥å¿—ä¹‹å‰å®•æœºäº†ï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚</p><p>å¯èƒ½ä¼šé˜»å¡ä¸‹ä¸€æ¡å†™å‘½ä»¤çš„æ‰§è¡Œ: å†™æ“ä½œå’Œè®°å½•æ—¥å¿—éƒ½æ˜¯ä¸»è¿›ç¨‹(ä¸»è¿›ç¨‹ä¸­çš„redis_aof_write_threadçº¿ç¨‹),å¦‚æœåœ¨åˆ·ç›˜æ—¶,æœåŠ¡å™¨I/Oå‹åŠ›è¿‡å¤§,å¯¼è‡´å†™ç¡¬ç›˜é€Ÿåº¦å¾ˆæ…¢,å°±ä¼šé˜»å¡åç»­çš„å†™å‘½ä»¤</p><h4 id="å†™AOFæ—¥å¿—çš„è¿‡ç¨‹">å†™AOFæ—¥å¿—çš„è¿‡ç¨‹</h4><p>redisåœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œä¼šä»¥åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ°æ—¥å¿—ç¼“å­˜server.aof_bufä¸­,æ¥ä¸‹æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨write(),å°†æ—¥å¿—ç¼“å­˜server.aof_bufä¸­çš„å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚</p><p>æœ‰ä¸‰ç§å†™å›ç­–ç•¥,éœ€è¦é€šè¿‡è®¾ç½®redis.confæ–‡ä»¶ä¸­appendfsyncå‚æ•°æ¥é…ç½®ï¼š</p><p>AOFæŒä¹…åŒ–é…ç½®é¡¹è¯´æ˜ï¼š</p><ul><li>appendfsyncï¼šæŒä¹…åŒ–ç­–ç•¥<ul><li>alwaysï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼Œæ•°æ®å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ€§èƒ½æœ€å·®</li><li>everysecï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œ<code>redisçš„åå°å¼‚æ­¥çº¿ç¨‹</code>æ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜</li><li>noï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±<code>æ“ä½œç³»ç»Ÿ</code>å†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</li></ul></li></ul><h4 id="AOFé‡å†™">AOFé‡å†™</h4><p>AOFé‡å†™æ˜¯æŒ‡å¯¹AOFæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°å‘½ä»¤é›†åˆ,å¯ä»¥æœ‰æ•ˆå‡å°AOFæ–‡ä»¶çš„ä½“ç§¯ï¼Œä»¥æå‡æ•°æ®æ¢å¤çš„æ€§èƒ½ã€‚</p><p>é‡å†™è§¦å‘çš„æ¡ä»¶:</p><ul><li><code>auto-aof-rewrite-min-size</code>:è¡¨ç¤ºè¿è¡ŒAOFé‡å†™æ—¶æ–‡ä»¶çš„æœ€å°å¤§å°ï¼Œé»˜è®¤ä¸º64MBã€‚</li><li><code>auto-aof-rewrite-percentage</code>:è¿™ä¸ªå€¼çš„è®¡ç®—æ–¹å¼æ˜¯ï¼Œå½“å‰aofæ–‡ä»¶å¤§å°å’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„å·®å€¼ï¼Œå†é™¤ä»¥ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°ã€‚ä¹Ÿå°±æ˜¯å½“å‰aofæ–‡ä»¶æ¯”ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶çš„å¢é‡å¤§å°ï¼Œå’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„æ¯”å€¼ã€‚</li></ul><p><strong>æµç¨‹</strong>:è¯»å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å‘½ä»¤è®°å½•åˆ°<code>æ–°çš„ AOF æ–‡ä»¶</code>ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œåï¼Œå°±å°†æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ‰ç°æœ‰çš„ AOF æ–‡ä»¶</p><p><strong>ä¸ºä»€ä¹ˆè¦æ–°å»ºä¸€ä¸ªAOFæ–‡ä»¶?</strong><br>å¦‚æœåœ¨åŸå…ˆçš„AOFæ–‡ä»¶è¿›è¡Œé‡å†™,å¦‚æœé‡å†™å¤±è´¥,å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´,å¯¼è‡´æ±¡æŸ“,å¯èƒ½æ— æ³•ç”¨äºæ¢å¤</p><p><code>ä¸ºä»€ä¹ˆæ˜¯åå°å­è¿›ç¨‹è€Œä¸ç”¨å­çº¿ç¨‹?</code><br>å­çº¿ç¨‹ä¼šå…±äº«å†…å­˜,ä¸»è¿›ç¨‹è¦å†™,å­çº¿ç¨‹è¦è¯»,è¦åŠ é”é˜²æ­¢è¯»å†™å¹¶å‘æ“ä½œ,æ€§èƒ½å·®</p><p><strong>é‡‡ç”¨å­è¿›ç¨‹ï¼Œå†™æ—¶å¤åˆ¶æé«˜æ€§èƒ½:</strong><br>é‡‡ç”¨å­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹ä¼šä¸ºå­è¿›ç¨‹åˆ†é…ä¸ä¸»è¿›ç¨‹ç›¸åŒçš„é¡µè¡¨ï¼Œå³è™šæ‹Ÿç©ºé—´æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œè¾¾åˆ°æ•°æ®å…±äº«ï¼Œå¹¶ä¸”ä¸éœ€è¦åŠ é”æ“ä½œ.ä½†ä¼šå¯¹è¿™å—å…±äº«çš„ç‰©ç†å†…å­˜è®¾ç½®ä¸ºåªè¯»çŠ¶æ€,å¦‚æœä¸»è¿›ç¨‹ æˆ– å­è¿›ç¨‹ å¯¹è¿™å—å†…å­˜å‘ç”Ÿå†™æ“ä½œï¼Œä¼šè§¦å‘å†™æ—¶å¤åˆ¶.CPU è§¦å‘å†™ä¿æŠ¤ä¸­æ–­ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œç‰©ç†å†…å­˜çš„å¤åˆ¶ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸ºå¯è¯»å†™ï¼Œæœ€åæ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œ,è¿™æ ·å°±é¿å…äº†åŠ é”æ“ä½œï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶ï¼Œæ¥æé«˜æ€§èƒ½.(ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœä¸»è¿›ç¨‹åœ¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™æ—¶,æ²¡æœ‰æ‰§è¡Œå†™å…¥æ“ä½œ,å°±ä¸ä¼šçœŸæ­£åˆ†é…å†…å­˜èµ„æº,å°±æ˜¯å†™æ—¶å¤åˆ¶æŠ€æœ¯COWçš„åº”ç”¨)</p><h4 id="AOFåå°é‡å†™æœºåˆ¶æè¿°">AOFåå°é‡å†™æœºåˆ¶æè¿°</h4><p>è¿›è¡ŒAOFæ—¥å¿—åå°é‡å†™æ—¶ï¼Œä¸»è¿›ç¨‹forkå­è¿›ç¨‹ï¼Œå¹¶ä¸”ä¸ºå­è¿›ç¨‹åˆ†é…ä¸ä¸»è¿›ç¨‹ç›¸åŒçš„é¡µè¡¨ï¼Œå³è™šæ‹Ÿç©ºé—´æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œè¾¾åˆ°æ•°æ®å…±äº«ï¼Œå¹¶ä¸”é€šè¿‡å†™æ—¶å¤åˆ¶ï¼Œæ¥é¿å…åŠ é”</p><p>å­è¿›ç¨‹æ”¶é›†å†…å­˜ä¸­çš„é”®å€¼å¯¹è½¬åŒ–ä¸ºä¸€æ¡å‘½ä»¤ï¼Œå†™å…¥æ–°çš„AOFæ–‡ä»¶ï¼Œä½†åœ¨å†™å…¥è¿‡ç¨‹ï¼Œä¸»è¿›ç¨‹ä»ç„¶å¯ä»¥å¤„ç†å‘½ä»¤ï¼Œå½“ç¢°åˆ°å†™æ“ä½œå‘½ä»¤æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æ“ä½œï¼š<br>è§¦å‘å†™æ—¶å¤åˆ¶è¿‡ç¨‹ï¼ŒCPU è§¦å‘å†™ä¿æŠ¤ä¸­æ–­ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œç‰©ç†å†…å­˜çš„å¤åˆ¶ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸ºå¯è¯»å†™ï¼Œæœ€åä¸»è¿›ç¨‹æ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œ</p><p><code>ä½†å­è¿›ç¨‹æ”¶é›†çš„AOFæ–‡ä»¶ æ•°æ®å°±ä¸ä¸€è‡´äº†ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</code></p><p>redis åœ¨AOFåå°é‡å†™è§¦å‘æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªAOFé‡å†™ç¼“å†²åŒº,é‡å†™è¿‡ç¨‹ï¼Œä¸»è¿›ç¨‹æ‰§è¡Œæ›´æ–°å†…å­˜æ•°æ®æ—¶ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>æ‰§è¡Œå‘½ä»¤ï¼Œæ›´æ–°å†…å­˜æ•°æ®</li><li>å°†å‘½ä»¤è®°å½•åˆ°ä¸¤ä¸ªä½ç½®:æ—§çš„AOFæ–‡ä»¶å’ŒAOFé‡å†™ç¼“å†²åŒº</li><li>å½“å­è¿›ç¨‹ AOFé‡å†™å®Œæ¯•ï¼Œä¼šå‘é€ä¸€ä¸ªä¿¡å·å‘Šè¯‰ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹è°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼šå°†AOFé‡å†™ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥è¿½åŠ åˆ°æ–°çš„ AOFæ–‡ä»¶æœ«å°¾ï¼Œæ›¿æ¢æ—§çš„AOFæ–‡ä»¶ï¼Œé‡å†™è¿‡ç¨‹å°±ç»“æŸã€‚ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤äº†</li></ol><p><code>åå°é‡å†™ï¼Œä»€ä¹ˆé˜¶æ®µä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Ÿ</code></p><ol><li>åˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­,ç”±äºè¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ç­‰æ•°æ®ç»“æ„: é˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³,é¡µè¡¨è¶Šå¤§,é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿</li><li>åˆ›å»ºå®Œå­è¿›ç¨‹å,å¦‚æœçˆ¶è¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼ˆå­è¿›ç¨‹ä¸€èˆ¬åªè¯»ï¼‰,å°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶,è¿™æœŸé—´ä¼šæ‹·è´ç‰©ç†å†…å­˜,å¦‚æœå†…å­˜è¶Šå¤§,è‡ªç„¶é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿</li><li>å­è¿›ç¨‹ AOFé‡å†™å®Œæ¯•,å‘é€ä¿¡å·é€šçŸ¥ä¸»è¿›ç¨‹,ä¸»è¿›ç¨‹ä¼šè°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°,æ‰§è¡Œæ—¶ä¹Ÿä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡</li></ol><p><code>ä»€ä¹ˆä¼˜åŒ–ï¼Œè®©ä¸»è¿›ç¨‹é˜»å¡æ—¶é—´å°½é‡ç¼©å°ï¼Ÿ</code><br><strong>å†™æ—¶å¤åˆ¶</strong>ï¼Œåœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´ä¸»è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚å½“å†²çªå‘ç”Ÿï¼Œå†è¿›è¡Œè§£å†³ï¼Œæ¥æé«˜æ•ˆç‡ã€‚ä¹Ÿå¯ä»¥å‡å°‘å†…å­˜åˆ†é…ã€‚</p><h3 id="RDB">RDB</h3><h4 id="RDBå¿«ç…§æ˜¯ä»€ä¹ˆ-å¦‚ä½•ç”Ÿæˆ">RDBå¿«ç…§æ˜¯ä»€ä¹ˆ?å¦‚ä½•ç”Ÿæˆ?</h4><p>RDB å¿«ç…§è®°å½•çš„æ˜¯å†…å­˜ä¸­çš„å®é™…æ•°æ®ï¼ŒäºŒè¿›åˆ¶æ ¼å¼ï¼›æ‰€ä»¥åœ¨redisé‡å¯æ¢å¤æ•°æ®æ—¶ï¼Œåªéœ€è¦åŠ è½½rdbæ–‡ä»¶åˆ°å†…å­˜å³å¯ï¼Œé€Ÿåº¦è¾ƒå¿«</p><p>redisæä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ä¸»åŠ¨ç”Ÿæˆrdbæ–‡ä»¶<br>â—saveï¼šä¸»è¿›ç¨‹æ¥æ‰§è¡Œå…¨é‡å¿«ç…§æ“ä½œï¼Œè‹¥å†…å­˜æ•°æ®å¤ªå¤šï¼Œä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Œä¸æ¨è<br>â—bgsaveï¼šä¸»è¿›ç¨‹fork å­è¿›ç¨‹ï¼Œæ¥æ‰§è¡Œå…¨é‡å¿«ç…§æ“ä½œï¼Œè¿™ç§æ€æƒ³åœ¨AOFåå°é‡å†™æ—¥å¿—ä¹Ÿç”¨è¿‡ï¼Œé¿å…ä¸»çº¿ç¨‹çš„é˜»å¡</p><p>è¿˜å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥ç”Ÿæˆå¿«ç…§<br>é»˜è®¤é…ç½®ï¼šæ‰§è¡Œçš„æ˜¯ bgsave å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¼šåˆ›å»ºå­è¿›ç¨‹æ¥ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure><p>åªè¦æ»¡è¶³ä¸Šé¢æ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šæ‰§è¡Œ bgsaveï¼Œå®ƒä»¬çš„æ„æ€åˆ†åˆ«æ˜¯ï¼š<br>900 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 1 æ¬¡ä¿®æ”¹ï¼›<br>300 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 10 æ¬¡ä¿®æ”¹ï¼›<br>60 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 10000 æ¬¡ä¿®æ”¹ã€‚</p><h4 id="æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ">æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ</h4><p>Redis åŒæ ·é‡‡ç”¨<code>å†™æ—¶å¤åˆ¶</code>æŠ€æœ¯ï¼Œæ¥æ”¯æŒå¿«ç…§ï¼Œæ‰§è¡Œå¿«ç…§æ—¶æ•°æ®èƒ½è¢«ä¿®æ”¹ï¼Œå…·ä½“è¿‡ç¨‹ï¼š</p><p>ä¸»è¿›ç¨‹forkåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ¥æ‰§è¡Œbgsaveå‘½ä»¤,ä¸»è¿›ç¨‹ä¼šå°†è‡ªå·±çš„é¡µè¡¨å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œè™šæ‹Ÿç©ºé—´æŒ‡å‘ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œæ¥è¾¾åˆ°ç©ºé—´å…±äº«.å­è¿›ç¨‹åœ¨è®°å½•å®é™…æ•°æ®åˆ°RDBæ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¸»è¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå†™æ“ä½œå‘½ä»¤ï¼Œé‚£ä¹ˆå…±äº«ç©ºé—´å°±ä¸ä¼šå‘ç”Ÿå†²çªï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ã€‚</p><p>è‹¥ä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œå†™æ“ä½œå‘½ä»¤ï¼Œå¦‚ä¸»çº¿ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰è¦ä¿®æ”¹å…±äº«æ•°æ®é‡Œçš„æŸä¸€å—æ•°æ®ï¼ˆæ¯”å¦‚é”®å€¼å¯¹ Aï¼‰æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œè¿™å—æ•°æ®çš„ç‰©ç†å†…å­˜å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼ˆé”®å€¼å¯¹ Aâ€™ï¼‰ï¼Œç„¶åä¸»çº¿ç¨‹åœ¨è¿™ä¸ªæ•°æ®å‰¯æœ¬ï¼ˆé”®å€¼å¯¹ Aâ€™ï¼‰è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ä¸æ­¤åŒæ—¶ï¼Œbgsave å­è¿›ç¨‹å¯ä»¥ç»§ç»­æŠŠåŸæ¥çš„æ•°æ®ï¼ˆé”®å€¼å¯¹ Aï¼‰å†™å…¥åˆ° RDB æ–‡ä»¶ã€‚</p><p>bgsave å¿«ç…§è¿‡ç¨‹ä¸­ï¼Œ<strong>å¦‚æœä¸»çº¿ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼Œå‘ç”Ÿäº†å†™æ—¶å¤åˆ¶åï¼Œæœ¬æ¬¡RDB å¿«ç…§ä¿å­˜çš„æ˜¯åŸæœ¬çš„å†…å­˜æ•°æ®ï¼Œè€Œä¸»çº¿ç¨‹åˆšä¿®æ”¹çš„æ•°æ®ï¼Œæ˜¯æ²¡åŠæ³•åœ¨è¿™ä¸€æ—¶é—´å†™å…¥ RDB æ–‡ä»¶çš„ï¼Œåªèƒ½äº¤ç”±ä¸‹ä¸€æ¬¡çš„ bgsave å¿«ç…§</strong></p><p><code>æ€ä¹ˆå°†RDBæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Ÿ</code></p><p>RDB æ–‡ä»¶çš„åŠ è½½å·¥ä½œæ˜¯åœ¨redisæœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ï¼ŒRedis å¹¶æ²¡æœ‰æä¾›ä¸“é—¨ç”¨äºåŠ è½½ RDB æ–‡ä»¶çš„å‘½ä»¤ã€‚</p><p><strong>RDB å¿«ç…§çš„ç¼ºç‚¹</strong><br>æ¯ä¸€æ¬¡æ‰§è¡ŒRDBå¿«ç…§ï¼Œè®°å½•çš„æ˜¯å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ªå…¨é‡å¿«ç…§ï¼Œå½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œé¢‘ç¹è®°å½•å¿«ç…§ï¼Œè™½ç„¶å¯ä»¥é‡‡ç”¨å­è¿›ç¨‹æ¥æ‰§è¡Œï¼Œä½†è¿˜æ˜¯ä¼šå½±å“redisçš„æ€§èƒ½,å¦‚æœè®°å½•çš„å¤ªä¸é¢‘ç¹ï¼Œé‚£ä¹ˆå½“æœåŠ¡å™¨å®•æœºï¼Œä¸¢å¤±çš„æ•°æ®å°±éå¸¸å¤š</p><h4 id="å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ">å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ</h4><p>åœ¨ Redis æ‰§è¡Œ RDB æŒä¹…åŒ–æœŸé—´ï¼Œåˆš fork æ—¶ï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯é€”ä¸­ä¸»è¿›ç¨‹å¤„ç†äº†å†™æ“ä½œï¼Œä¿®æ”¹äº†å…±äº«å†…å­˜ï¼Œäºæ˜¯å½“å‰è¢«ä¿®æ”¹çš„æ•°æ®çš„ç‰©ç†å†…å­˜å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ã€‚é‚£ä¹ˆæç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„å…±äº«å†…å­˜éƒ½è¢«ä¿®æ”¹ï¼Œåˆ™æ­¤æ—¶çš„å†…å­˜å ç”¨æ˜¯åŸå…ˆçš„ 2 å€ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹å†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦ç•™æ„ä¸‹å¿«ç…§è¿‡ç¨‹ä¸­å†…å­˜çš„å˜åŒ–ï¼Œé˜²æ­¢å†…å­˜è¢«å æ»¡äº†ã€‚</p><h4 id="AOFæ—¥å¿—-RDBå¿«ç…§-åŒºåˆ«">AOFæ—¥å¿— &amp; RDBå¿«ç…§ åŒºåˆ«</h4><p>å®ƒä»¬éƒ½æ˜¯redisæ•°æ®åº“å†…å­˜æŒä¹…åŒ–çš„æŠ€æœ¯</p><ol><li>è®°å½•çš„å†…å®¹ä¸åŒï¼šAOF æ–‡ä»¶çš„å†…å®¹æ˜¯æ“ä½œå‘½ä»¤ï¼›RDB æ–‡ä»¶çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li>æ¢å¤æ•°æ®æ—¶ï¼Œè€—è´¹çš„æ—¶é—´ä¸åŒï¼šRDB æ¢å¤æ•°æ®çš„æ•ˆç‡ä¼šæ¯” AOF é«˜äº›ï¼Œå› ä¸ºç›´æ¥å°† RDB æ–‡ä»¶è¯»å…¥å†…å­˜å°±å¯ä»¥ï¼ŒAOF éœ€è¦é¢å¤–æ‰§è¡Œæ“ä½œå‘½ä»¤çš„æ­¥éª¤æ‰èƒ½æ¢å¤æ•°æ®ï¼Œé€Ÿåº¦æ…¢</li><li>åœ¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸¢å¤±æ•°æ®å¤šå°‘æ–¹é¢ï¼šRDBæ˜¯ä¸€ä¸ªå…¨é‡å¿«ç…§ï¼Œä¸èƒ½é¢‘ç¹æ‰§è¡Œï¼Œå¦åˆ™ä¼šå½±å“æ€§èƒ½,æ‰€ä»¥ä¸¢å¤±æ•°æ®ç›¸å¯¹æ¥è¯´è¾ƒå¤š.AOFæ”¯æŒç§’çº§è®°å½•å‘½ä»¤åˆ°AOFæ–‡ä»¶ä¸­,æ‰€ä»¥ä¸¢å¤±çš„æ•°æ®ç›¸å¯¹æ¥è¯´è¾ƒå°‘</li></ol><h3 id="AOF-RDBæ··åˆæŒä¹…åŒ–">AOF|RDBæ··åˆæŒä¹…åŒ–</h3><h4 id="AOF-RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ">AOF|RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h4><p><code>æ··åˆæŒä¹…åŒ–å¯ä»¥åˆ©ç”¨è¿™ä¸¤ç§æ—¥å¿—çš„ä¼˜ç‚¹ï¼š</code>AOFå¯ä»¥æ”¯æŒç§’çº§è®°å½•æ—¥å¿—ï¼Œä½¿å¾—æ•°æ®æ›´å°‘çš„ä¸¢å¤±,RDBåœ¨æ•°æ®æ¢å¤æ—¶éå¸¸å¿«ï¼Œä¸éœ€è¦é‡æ–°æ‰§è¡Œå‘½ä»¤</p><p><code>æ··åˆæŒä¹…åŒ–çš„è¿‡ç¨‹åªå‘ç”Ÿåœ¨AOFæ—¥å¿—é‡å†™çš„è¿‡ç¨‹</code>ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>å½“AOFæ—¥å¿—è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè§¦å‘åå°é‡å†™æœºåˆ¶,ä¸»è¿›ç¨‹forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶ä¸”å°†ä¸»è¿›ç¨‹çš„é¡µè¡¨å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹</li><li>å­è¿›ç¨‹ä¸ä¸»è¿›ç¨‹å…±äº«ç©ºé—´ï¼Œå¯¹å½“å‰å†…å­˜æ•°æ®æ‰§è¡ŒRDBå¿«ç…§ï¼Œå°†RDBæ ¼å¼çš„æ—¥å¿—è®°å½•åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­</li><li>å¹¶ä¸”åœ¨é‡å†™è¿‡ç¨‹ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„å†™æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨AOFé‡å†™ç¼“å†²åŒºé‡Œï¼Œå½“RDBå¿«ç…§è®°å½•å®Œæ¯•ï¼ŒAOFé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶</li><li>å†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹,å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</li></ol><p>ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®ã€‚</p><p><strong>å¥½å¤„</strong>ï¼š<br>é‡å¯RedisåŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯RDBå†…å®¹ï¼Œè¿™æ ·åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—æ•°æ®æ›´å°‘çš„ä¸¢å¤±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½</title>
      <link href="/2024/04/09/2024-4-9-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%811/"/>
      <url>/2024/04/09/2024-4-9-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%811/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½">ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½</h3><p>å¤§æ•°æ®å®‰å…¨ä¸éšç§è¿™é—¨è¯¾çš„lab1,è¦æ±‚å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/164.webp" alt="avatar"></p><p><strong>å®ç°æ€è·¯</strong>:<br>â€¢é€šè¿‡Socketå®ç°æ–‡ä»¶ä¼ è¾“ï¼Œä½¿ç”¨TCPåè®®ç¡®ä¿æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚<br>â€¢ä»£ç é€šè¿‡è¯»å–æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œä¼ è¾“ï¼Œæ”¯æŒä»»æ„ç±»å‹çš„æ–‡ä»¶ã€‚<br>â€¢é€šè¿‡AESåŠ å¯†ç®—æ³•è¿›è¡Œæ–‡ä»¶æ•°æ®çš„åŠ å¯†å’Œè§£å¯†ã€‚<br>â€¢ä½¿ç”¨RSAåŠ å¯†ç®—æ³•å¯¹AESå¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿å¯†é’¥çš„å®‰å…¨ä¼ è¾“ã€‚<br>â€¢é€šè¿‡åœ¨AESå¯†é’¥ä¸­åŠ å…¥æ—¶é—´æˆ³çš„æ–¹å¼ï¼Œç¡®ä¿æ¯æ¬¡ç”Ÿæˆä¸åŒçš„å¯†é’¥ï¼Œä»è€Œä¿è¯ç›¸åŒæ–‡ä»¶æ¯æ¬¡å‘é€çš„åŠ å¯†ç»“æœä¸åŒã€‚</p><p>å…·ä½“å®ç°:<br>å®¢æˆ·ç«¯ (client.py)</p><ol><li>è¿æ¥æœåŠ¡å™¨<br>oåˆ›å»ºSocketå¹¶è¿æ¥åˆ°æœåŠ¡å™¨çš„æŒ‡å®šç«¯å£ã€‚</li><li>AESå¯†é’¥ç”Ÿæˆä¸åŠ å¯†<br>oç”Ÿæˆ16å­—èŠ‚çš„éšæœºAESå¯†é’¥ã€‚<br>oåŠ å…¥æ—¶é—´æˆ³ç”Ÿæˆå”¯ä¸€çš„AESå¯†é’¥ã€‚<br>oä½¿ç”¨RSAå…¬é’¥åŠ å¯†AESå¯†é’¥å¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚</li><li>æ–‡ä»¶ä¼ è¾“<br>oè¯»å–æ–‡ä»¶ä¿¡æ¯ï¼ˆæ–‡ä»¶åå’Œå¤§å°ï¼‰ï¼Œå‘é€ç»™æœåŠ¡å™¨ã€‚<br>oåˆ†å—è¯»å–æ–‡ä»¶æ•°æ®ï¼Œä½¿ç”¨AESè¿›è¡ŒåŠ å¯†ï¼Œå‘é€åŠ å¯†æ•°æ®åˆ°æœåŠ¡å™¨ã€‚<br>æœåŠ¡ç«¯ (server.py)</li><li>ç›‘å¬å®¢æˆ·ç«¯è¿æ¥<br>oåˆ›å»ºSocketï¼Œç»‘å®šæŒ‡å®šç«¯å£ï¼Œå¹¶è®¾ç½®ç›‘å¬é˜Ÿåˆ—ã€‚</li><li>æ¥æ”¶å¹¶è§£å¯†AESå¯†é’¥<br>oç”ŸæˆRSAå¯†é’¥å¯¹ï¼Œå¹¶å°†å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚<br>oæ¥æ”¶åŠ å¯†çš„AESå¯†é’¥å¹¶ä½¿ç”¨RSAç§é’¥è§£å¯†ã€‚</li><li>æ–‡ä»¶æ¥æ”¶<br>oæ¥æ”¶æ–‡ä»¶ä¿¡æ¯ï¼ˆæ–‡ä»¶åå’Œå¤§å°ï¼‰ã€‚<br>oåˆ†å—æ¥æ”¶åŠ å¯†æ–‡ä»¶æ•°æ®ï¼Œä½¿ç”¨AESè§£å¯†ï¼Œå†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</li></ol><p>è¿è¡Œç»“æœå¦‚ä¸‹:<br><img src="https://pb01.s3.bitiful.net/167.png" alt="avatar"></p><p><img src="https://pb01.s3.bitiful.net/168.png" alt="avatar"><br>å›¾ä¸­æ ‡é»„çš„å†…å®¹æ˜¯RSAåŠ å¯†çš„AESç§˜é’¥, æ ‡è“è‰²çš„æ˜¯AESåŠ å¯†çš„å¯†æ–‡, æ ‡ç»¿çš„æ˜¯åŸæ–‡, åŸæ–‡åé¢å‡ºç°\x05çš„åŸå› æ˜¯å®¢æˆ·ç«¯å‘é€æ–‡ä»¶å‰å¯¹æ–‡ä»¶è¿›è¡Œäº†PKCS7å¡«å……,  å®¢æˆ·ç«¯è¿™é‡Œæ‰“å°å‡ºçš„æ˜¯æœªç»å–æ¶ˆå¡«å……çš„å†…å®¹</p><p>æˆ‘ä»¬å†æ¥ä¸€æ¬¡, å¯ä»¥å‘ç°ç”Ÿæˆäº†ä¸åŒçš„AESç§˜é’¥, è‡ªç„¶ä¹Ÿå°±å®ç°äº†ç›¸åŒæ–‡ä»¶æ¯æ¬¡å‘é€çš„åŠ å¯†ç»“æœä¸åŒ</p><p><img src="https://pb01.s3.bitiful.net/169.png" alt="avatar"></p><p><img src="https://pb01.s3.bitiful.net/170.png" alt="avatar"></p><h4 id="æœåŠ¡ç«¯ä»£ç ">æœåŠ¡ç«¯ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">iv = <span class="string">&#x27;1425374853627180&#x27;</span>  <span class="comment"># åˆå§‹å‘é‡</span></span><br><span class="line">BUFF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å»é™¤æœ«å°¾å¡«å……å­—ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpadding</span>(<span class="params">text</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    <span class="built_in">print</span>(text[length - <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> text[<span class="number">0</span>:length - text[length - <span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">socket_service</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="comment">#  è®¾ç½®socketå¯ä»¥é‡ç”¨å·²ç»‘å®šåœ°å€</span></span><br><span class="line">        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        s.bind((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">9001</span>))  <span class="comment"># ç»‘å®šç«¯å£ä¸º9001</span></span><br><span class="line">        s.listen(<span class="number">10</span>)  <span class="comment"># è®¾ç½®ç›‘å¬æ•°,æœ€å¤šå…è®¸10ä¸ªå®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç­‰å¾…è¿æ¥...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># è°ƒç”¨accepté˜»å¡ï¼š ç­‰å¾…è¯·æ±‚å¹¶æ¥å—(ç¨‹åºä¼šåœç•™åœ¨è¿™ä¸€æ—¦æ”¶åˆ°è¿æ¥è¯·æ±‚å³å¼€å¯æ¥å—æ•°æ®çš„çº¿ç¨‹)</span></span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        <span class="comment"># æ¥æ”¶æ•°æ®</span></span><br><span class="line">        t = threading.Thread(target=deal_data, args=(conn, addr))</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deal_data</span>(<span class="params">conn, addr</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ¥æ”¶åˆ°æ¥è‡ª &#123;0&#125;çš„è¿æ¥&#x27;</span>.<span class="built_in">format</span>(addr))</span><br><span class="line">    <span class="comment"># æ”¶åˆ°è¯·æ±‚åçš„å›å¤</span></span><br><span class="line">    conn.send(<span class="string">&#x27;welcome!&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> key:</span><br><span class="line">            s1_recv_data = conn.recv(BUFF)</span><br><span class="line">            <span class="keyword">if</span> s1_recv_data.decode(<span class="string">&#x27;utf-8&#x27;</span>) == <span class="string">&#x27;changekey&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹äº¤æ¢ç§˜é’¥!&#x27;</span>)</span><br><span class="line">                <span class="comment"># ä½¿ç”¨RSAäº§ç”Ÿä¸€å¯¹å…¬é’¥å’Œç§é’¥</span></span><br><span class="line">                (pubkey, privkey) = rsa.newkeys(<span class="number">512</span>, poolsize=<span class="number">8</span>)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; åˆ›å»ºRSAç§˜é’¥å¯¹!&#x27;</span>)</span><br><span class="line">                <span class="comment"># å°†å…¬é’¥æ¨¡æ•°å’ŒæŒ‡æ•°å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                modulus = pubkey.n</span><br><span class="line">                exponent = pubkey.e</span><br><span class="line">                conn.send(<span class="built_in">str</span>(modulus).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                conn.send(<span class="built_in">str</span>(exponent).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å‘é€RSAå…¬é’¥&#x27;</span>)</span><br><span class="line">                <span class="comment"># æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">                key = conn.recv(BUFF)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,</span><br><span class="line">                                    time.localtime(time.time())) + <span class="string">&#x27; æ¥æ”¶åŠ å¯†åçš„AESç§˜é’¥:&#x27;</span> + key.decode(<span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">                                                                                                           <span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">                <span class="comment"># æœåŠ¡ç«¯ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°AESå¯†é’¥</span></span><br><span class="line">                key = rsa.decrypt(key, privkey)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; è§£å¯†AESç§˜é’¥ä¸­&#x27;</span>)</span><br><span class="line">                key = key.decode()</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; AESç§˜é’¥:&#x27;</span> + key)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”³è¯·ç›¸åŒå¤§å°çš„ç©ºé—´å­˜æ”¾å‘é€è¿‡æ¥çš„æ–‡ä»¶åä¸æ–‡ä»¶å¤§å°ä¿¡æ¯</span></span><br><span class="line">        fileinfo_size = struct.calcsize(<span class="string">&#x27;128sl&#x27;</span>)</span><br><span class="line">        <span class="comment"># æ¥æ”¶æ–‡ä»¶åä¸æ–‡ä»¶å¤§å°ä¿¡æ¯</span></span><br><span class="line">        buf = conn.recv(fileinfo_size)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æ¥æ”¶åˆ°æ–‡ä»¶å¤´ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> buf:</span><br><span class="line">            <span class="comment"># è·å–æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°</span></span><br><span class="line">            filename, filesize = struct.unpack(<span class="string">&#x27;128sl&#x27;</span>, buf)</span><br><span class="line">            fn = filename.strip(<span class="string">b&#x27;\00&#x27;</span>)</span><br><span class="line">            fn = fn.decode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;æ–‡ä»¶åæ˜¯ &#123;0&#125;, æ–‡ä»¶å¤§å°æ˜¯ &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(fn), filesize))</span><br><span class="line">            recvd_size = <span class="number">0</span>  <span class="comment"># å®šä¹‰å·²æ¥æ”¶æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line">            <span class="comment"># å­˜å‚¨åœ¨è¯¥è„šæœ¬æ‰€åœ¨ç›®å½•ä¸‹é¢</span></span><br><span class="line">            fp = <span class="built_in">open</span>(<span class="string">&#x27;./&#x27;</span> + <span class="built_in">str</span>(fn), <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ¥æ”¶...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filesize % <span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">                filesize += <span class="number">16</span> - filesize % <span class="number">16</span></span><br><span class="line">            <span class="comment"># å°†åˆ†æ‰¹æ¬¡ä¼ è¾“çš„äºŒè¿›åˆ¶æµä¾æ¬¡å†™å…¥åˆ°æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> recvd_size == filesize:</span><br><span class="line">                <span class="keyword">if</span> filesize - recvd_size &gt; <span class="number">1024</span>:</span><br><span class="line">                    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">                    recvd_size += <span class="built_in">len</span>(data)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data = conn.recv(filesize - recvd_size)</span><br><span class="line">                    recvd_size = filesize</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å°†åŠ å¯†æ•°æ®è½¬æ¢ä½bytesç±»å‹æ•°æ®</span></span><br><span class="line">                cipher = AES.new(key.encode(<span class="string">&#x27;utf8&#x27;</span>), AES.MODE_CBC, iv.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">                text_decrypted = cipher.decrypt(data)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(text_decrypted))</span><br><span class="line">                <span class="built_in">print</span>(text_decrypted)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(text_decrypted) &lt; <span class="number">1024</span>:</span><br><span class="line">                    text_decrypted = unpadding(text_decrypted)</span><br><span class="line">                <span class="built_in">print</span>(text_decrypted)</span><br><span class="line">                fp.write(text_decrypted)</span><br><span class="line">            fp.close()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸæ¥æ”¶...&#x27;</span>)</span><br><span class="line">        <span class="comment"># ä¼ è¾“ç»“æŸæ–­å¼€è¿æ¥</span></span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    socket_service()</span><br></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯ä»£ç ">å®¢æˆ·ç«¯ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line">key0 = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()  <span class="comment"># éšæœºç”Ÿæˆç§˜é’¥,16ä½å­—ç¬¦ä¸²</span></span><br><span class="line">iv = <span class="string">&#x27;1425374853627180&#x27;</span>  <span class="comment"># åˆå§‹å‘é‡</span></span><br><span class="line">BUFF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">text</span>):</span><br><span class="line">    bs = AES.block_size  <span class="comment"># 16å­—èŠ‚</span></span><br><span class="line">    length = <span class="built_in">len</span>(text)   <span class="comment"># è·å–æ˜æ–‡é•¿åº¦,å­—ç¬¦</span></span><br><span class="line">    bytes_length = <span class="built_in">len</span>(<span class="built_in">bytes</span>(text, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    padding = length <span class="keyword">if</span> (bytes_length == length) <span class="keyword">else</span> bytes_length</span><br><span class="line">    padding_size = bs - padding % bs</span><br><span class="line">    padding_text = <span class="built_in">chr</span>(padding_size) * padding_size   <span class="comment"># æŒ‰ç…§PKCS7å¡«å……æ–¹å¼ç”Ÿæˆå¡«å……æ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°åŠŸèƒ½ï¼šå¯¹æ˜æ–‡è¿›è¡ŒPKCS7å¡«å……</span></span><br><span class="line"><span class="comment"># å‚æ•°textï¼šéœ€è¦å¡«å……çš„æ˜æ–‡</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼ï¼šå¡«å……åçš„æ˜æ–‡</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">socket_client</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆ›å»ºsocket,ipv4+æµ</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">9001</span>))</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(s.recv(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ ä¸Šç»™å¯†é’¥åŠ ä¸Šæ—¶é—´æˆ³ï¼Œä¿è¯ç›¸åŒçš„æ˜æ–‡ï¼Œæ¯æ¬¡å‘é€çš„å¯†æ–‡ä¸åŒ</span></span><br><span class="line">    t = time.time()</span><br><span class="line">    t_str = <span class="built_in">str</span>(<span class="built_in">int</span>(t))</span><br><span class="line">    key = key0[<span class="number">0</span>:<span class="number">8</span>] + t_str[<span class="number">2</span>:<span class="number">10</span>]  <span class="comment"># å–key0å‰å…«ä½å’Œæ—¶é—´æˆ³ä¸­çš„åå…«ä½ç”Ÿæˆæ–°key</span></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹äº¤æ¢ç§˜é’¥!&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">&#x27;changekey&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    modulus = <span class="built_in">int</span>(s.recv(BUFF).decode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æ¥æ”¶å…¬é’¥æ¨¡æ•°</span></span><br><span class="line">    exponent = <span class="built_in">int</span>(s.recv(BUFF).decode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æ¥æ”¶å…¬é’¥æŒ‡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹æ„å»ºRSAå…¬é’¥&#x27;</span>)</span><br><span class="line">    pubkey = rsa.PublicKey(modulus, exponent)  <span class="comment"># æ„å»ºå…¬é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; åŠ å¯†AESç§˜é’¥&#x27;</span>)</span><br><span class="line">    crypto = rsa.encrypt(key.encode(<span class="string">&#x27;utf-8&#x27;</span>), pubkey)  <span class="comment"># ç”¨RSAå…¬é’¥å¯¹AESå¯†é’¥è¿›è¡ŒåŠ å¯†</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å‘é€åŠ å¯†åçš„AESç§˜é’¥:&#x27;</span> + crypto.decode(</span><br><span class="line">        <span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">    s.send(crypto)  <span class="comment"># å‘é€åŠ å¯†åçš„AESå¯†é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éœ€è¦ä¼ è¾“çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    filepath = <span class="string">&#x27;C:/XingYan/1.png&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="comment"># å®šä¹‰å®šä¹‰æ–‡ä»¶ä¿¡æ¯ã€‚128sè¡¨ç¤ºæ–‡ä»¶åä¸º128bytesé•¿ï¼Œlè¡¨ç¤ºä¸€ä¸ªintæˆ–longï¼Œåœ¨æ­¤ä¸ºæ–‡ä»¶å¤§å°</span></span><br><span class="line">        fileinfo_size = struct.calcsize(<span class="string">&#x27;128sl&#x27;</span>)</span><br><span class="line">        <span class="comment"># æ‰“åŒ…æ–‡ä»¶åå’Œå¤§å°</span></span><br><span class="line">        filehead = struct.pack(<span class="string">&#x27;128sl&#x27;</span>, os.path.basename(filepath).encode(<span class="string">&#x27;utf-8&#x27;</span>), os.stat(filepath).st_size)</span><br><span class="line">        s.send(filehead)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†ä¼ è¾“æ–‡ä»¶ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åˆ†å¤šæ¬¡ä¸Šä¼ è‡³æœåŠ¡å™¨</span></span><br><span class="line">        fp = <span class="built_in">open</span>(filepath, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            data = fp.read(<span class="number">1024</span>)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;0&#125; å‘é€ç»“æŸ...&#x27;</span>.<span class="built_in">format</span>(os.path.basename(filepath)))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(data) &lt; <span class="number">1024</span>:</span><br><span class="line">                newdata = data.decode(<span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(newdata))</span><br><span class="line">                newdata = padding(newdata)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(newdata))</span><br><span class="line">                data = newdata.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">            cipher = AES.new(key.encode(<span class="string">&#x27;utf8&#x27;</span>), AES.MODE_CBC, iv.encode(<span class="string">&#x27;utf8&#x27;</span>))  <span class="comment"># AESåŠ å¯†å¯¹è±¡</span></span><br><span class="line">            encryptedbytes = cipher.encrypt(data)</span><br><span class="line">            s.send(encryptedbytes)</span><br><span class="line">            <span class="built_in">print</span>(encryptedbytes)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">len</span>(encryptedbytes))</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    socket_client()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
            <tag> å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisç¼“å­˜é—®é¢˜:ç©¿é€,å‡»ç©¿,é›ªå´©,åŒå†™ä¸€è‡´æ€§ç­‰</title>
      <link href="/2024/03/15/2024-3-15-redis%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/15/2024-3-15-redis%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Redisç¼“å­˜é—®é¢˜-Redisç¼“å­˜é—®é¢˜-ç©¿é€-å‡»ç©¿-é›ªå´©-åŒå†™ä¸€è‡´æ€§ç­‰">Redisç¼“å­˜é—®é¢˜:Redisç¼“å­˜é—®é¢˜:ç©¿é€,å‡»ç©¿,é›ªå´©,åŒå†™ä¸€è‡´æ€§ç­‰</h2><p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹,æ•°æ®åº“å¾€å¾€æ˜¯æœ€è–„å¼±çš„ç¯èŠ‚,æˆ‘ä»¬é€šå¸¸é€‰æ‹©ä½¿ç”¨<code>redis</code>æ¥è¿›è¡Œç¼“å­˜,ä»¥èµ·åˆ°ç¼“å†²ä½œç”¨,æ¥é™ä½æ•°æ®åº“çš„å‹åŠ›,ä½†æ˜¯ä¸€æ—¦ç¼“å­˜å‡ºç°é—®é¢˜,ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒ,ä»è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒ.ä»Šå¤©å°±èŠèŠå¸¸è§çš„<code>redis</code>ç¼“å­˜é—®é¢˜.</p><h3 id="ç¼“å­˜å‡»ç©¿">ç¼“å­˜å‡»ç©¿</h3><p>ç¼“å­˜å‡»ç©¿ä¸€èˆ¬æŒ‡redisä¸­çš„ä¸€ä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸ,å¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“çš„æƒ…å†µ,å¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒ.</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ,è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ¡ˆ(è¦è€ƒè™‘ä¸šåŠ¡ç‰¹æ€§,ä½“é‡ä»¥åŠæˆæœ¬),<strong>å‰æ</strong>æ˜¯çƒ­ç‚¹æ•°æ®ä¸èƒ½é¢‘ç¹å‘ç”Ÿæ”¹å˜,å¦åˆ™å°±ä¼šå‡ºç°ç¼“å­˜æ±¡æŸ“.æœ€å¥½æ˜¯æ ¹æ®ä¸€å®šçš„ç­–ç•¥è¿›è¡Œå®šæ—¶æ›´æ–°</li><li>é‡è¦æ¥å£é™æµ,åšå¥½ç†”æ–­å’Œé™çº§çš„å‡†å¤‡,sentinelæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</li><li>ä½¿ç”¨äº’æ–¥é”,ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æ•°æ®åº“,è¿™ä½•å°ä¸æ˜¯ä¸€ç§é™æµå‘¢</li></ol><h3 id="ç¼“å­˜ç©¿é€">ç¼“å­˜ç©¿é€</h3><p>ç¼“å­˜ç©¿é€æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®,ç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚.è¿™ç§æƒ…å†µæœ€å¯èƒ½å°±æ˜¯æœ‰äººè¯•å›¾æ¶æ„æ”»å‡»ç³»ç»Ÿ</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>åŠ æ ¡éªŒ:æ‹¦æˆªéæ³•è¯·æ±‚,ç”¨æˆ·é‰´æƒç­‰</li><li>redisç¼“å­˜ä¸€ä¸ªæ— æ•ˆå€¼,ä»¥é˜²æ­¢å¯¹åŒä¸€ä¸ªkeyåœ¨æ•°æ®åº“ä¸­çš„å¤šæ¬¡æŸ¥è¯¢,ä½†redisä¸­å¯èƒ½ä¼šå‡ºç°å¤§é‡æ— æ•ˆå€¼,å¯¼è‡´ç¼“å­˜æ±¡æŸ“,æ‰€ä»¥è¦å°†æœ‰æ•ˆæ—¶é—´è®¾ç½®å¾—çŸ­ä¸€äº›</li><li>æ·»åŠ å¸ƒéš†è¿‡æ»¤å™¨,åœ¨å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å‰,å…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨</li></ol><p>ä¸€èˆ¬æ¥è¯´è¿™ä¸‰ç§æ–¹æ¡ˆæ˜¯<strong>åŒæ—¶ä½¿ç”¨</strong>çš„,ç¬¬ä¸€å±‚ä¸€èˆ¬æ˜¯æ ¡éªŒ,æ‹¦æˆªéƒ¨åˆ†éæ³•ç”¨æˆ·å’Œä¸åˆç†è¯·æ±‚(æ‹¦æˆªä¸å¯èƒ½å…¨éƒ¨æ‹¦æˆªè€Œä¸”å¦‚æœæ”»å‡»è€…é€šè¿‡æŸäº›æ–¹å¼æŒæ¡äº†å¤§é‡åˆæ³•ç”¨æˆ·å‘¢),ç¬¬äºŒå±‚æ˜¯å¸ƒéš†è¿‡æ»¤å™¨,å°½é‡é¿å…å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®,ä½†ä»ç„¶æœ‰è¯¯åˆ¤çš„å¯èƒ½æ€§,ç¬¬ä¸‰å±‚å†ç¼“å­˜ä¸€ä¸ªæ— æ•ˆå€¼,åšåˆ°å°½å¯èƒ½é™ä½é£é™©</p><h3 id="ç¼“å­˜é›ªå´©">ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜é›ªå´©ä¸€èˆ¬æŒ‡reidsä¸­å¤§æ‰¹é‡æ•°æ®åœ¨æçŸ­æ—¶é—´å†…(åŒæ—¶)è¿‡æœŸ,å¯¼è‡´å¤§é‡çš„æŸ¥è¯¢æ•°æ®åº“</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>åœ¨å­˜å‚¨æ•°æ®æ—¶,è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºä¸€ä¸ªéšæœºå€¼(ä¹Ÿå¯ä»¥ç†è§£æˆç»™å›ºå®šçš„è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºå€¼,ç±»ä¼¼å¯†ç å­¦ä¸­çš„åŠ ç›),å°½é‡ä¿è¯ä¸ä¼šæœ‰å¤§é‡æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸ</li><li>å°†çƒ­ç‚¹æ•°æ®å°½é‡å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®åº“ä¸­</li><li>å¤šçº§ç¼“å­˜</li><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ(åŒç¼“å­˜å‡»ç©¿ä¸­çš„)</li></ol><h3 id="ç¼“å­˜æ±¡æŸ“">ç¼“å­˜æ±¡æŸ“</h3><p>ç¼“å­˜æ±¡æŸ“æŒ‡çš„æ˜¯ç¼“å­˜ä¸­ä¸€äº›åªä¼šè¢«è®¿é—®ä¸€æ¬¡æˆ–è€…å‡ æ¬¡çš„çš„æ•°æ®,è¢«è®¿é—®å®Œå,å†ä¹Ÿä¸ä¼šè¢«è®¿é—®åˆ°,ä½†è¿™éƒ¨åˆ†æ•°æ®ä¾ç„¶ç•™å­˜åœ¨ç¼“å­˜ä¸­,æ¶ˆè€—ç¼“å­˜ç©ºé—´,ä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“redisçš„æ€§èƒ½</p><p>redisç¼“å­˜çš„maxmemoryåº”è¯¥è®¾ç½®å¤šå¤§,è¿™æ˜¯ä¸€ä¸ªå…³ä¹æ€§èƒ½å’Œæˆæœ¬çš„é—®é¢˜,éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæƒè¡¡,ä½†æ™®éæ¨èçš„æ˜¯è®¾ç½®ä¸ºæ€»æ•°æ®é‡çš„15%-30%(å…¶ä»–åšå®¢éƒ½è¿™ä¹ˆå†™,è€Œä¸”èŒƒå›´è¿˜æŒºå¤§,åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ğŸ¤”)</p><h4 id="ç¼“å­˜æ·˜æ±°ç­–ç•¥">ç¼“å­˜æ·˜æ±°ç­–ç•¥</h4><p>å®˜æ–¹æ–‡æ¡£å†™äº†8ç§,å¦‚ä¸‹å›¾:<br><img src="https://pb01.s3.bitiful.net/157.png" alt="avatar"></p><ul><li><p>noeviction(ä¸é©±é€,å³ä¸æ·˜æ±°)</p><p>é»˜è®¤ç­–ç•¥,å½“ç¼“å­˜è¾¾åˆ°maxmemoryæ—¶,redisä¼šæ‹’ç»æ‰€æœ‰å†™è¯·æ±‚,å¹¶è¿”å›é”™è¯¯ä¿¡æ¯,æ­¤æ—¶rediså·²ç»è¿›å…¥åªè¯»æ¨¡å¼,æ— æ³•å†è¿›è¡Œå†™æ“ä½œ,ä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»æ“ä½œ</p></li><li><p>allkeys-lru<br>æ‰€æœ‰keyé‡‡ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°,å³ä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key</p></li><li><p>allkeys-lfu<br>æ‰€æœ‰keyé‡‡ç”¨LFUç®—æ³•è¿›è¡Œæ·˜æ±°,å³ä¼˜å…ˆåˆ é™¤æœ€ä¸å¸¸ç”¨çš„key</p></li><li><p>volatile-lru<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>volatile-lfu<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨LFUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>allkeys-random<br>æ‰€æœ‰keyé‡‡ç”¨éšæœºåˆ é™¤</p></li><li><p>volatile-random<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨éšæœºåˆ é™¤</p></li><li><p>volatile-ttl<br>åˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸ºtrueå’Œå‰©ä½™æœ€çŸ­ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰å€¼çš„å¯†é’¥ã€‚</p></li></ul><h2 id="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§">ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§</h2><p>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p><p>æ›´æ–°ç¼“å­˜æœ‰å››ç§è®¾è®¡æ¨¡å¼: Cache aside, Read through, Write through, Write behind caching</p><h3 id="ç¼“å­˜æ›´æ–°æ¨¡å¼">ç¼“å­˜æ›´æ–°æ¨¡å¼</h3><h4 id="Cache-Aside-æ—è·¯ç¼“å­˜">Cache Aside(æ—è·¯ç¼“å­˜)</h4><ul><li>å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»cacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚</li><li>å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»cacheä¸­å–æ•°æ®ï¼Œå–åˆ°åè¿”å›ã€‚</li><li>æ›´æ–°ï¼šæ›´æ–°æ•°æ®åº“, æ›´æ–°/åˆ é™¤ç¼“å­˜</li></ul><p><strong>é‚£ä¹ˆåˆ°åº•æ˜¯æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ é™¤ç¼“å­˜å‘¢?</strong></p><p>å¦‚æœè¯»çš„é¢‘ç‡é«˜, é€‰æ‹©æ›´æ–°ç¼“å­˜, è¿™æ ·å¯ä»¥æé«˜ç¼“å­˜å‘½ä¸­ç‡</p><p>å¦‚æœå†™çš„é¢‘ç‡é«˜, é€‰æ‹©åˆ é™¤ç¼“å­˜, ç­‰åˆ°è¦è¯»çš„æ—¶å€™å†å†™å…¥ç¼“å­˜, å¯ä»¥å‡å°‘æ— æ•ˆçš„å†™æ“ä½œå’Œå‡å°‘ç¼“å­˜æ•°æ®é‡</p><h4 id="Read-Through-è¯»ç©¿">Read Through(è¯»ç©¿)</h4><p>Read Through å¥—è·¯å°±æ˜¯åœ¨æŸ¥è¯¢æ“ä½œä¸­æ›´æ–°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ŒCache Asideæ˜¯ç”±è°ƒç”¨æ–¹è´Ÿè´£æŠŠæ•°æ®åŠ è½½å…¥ç¼“å­˜ï¼Œè€ŒRead Throughåˆ™ç”¨ç¼“å­˜æœåŠ¡è‡ªå·±æ¥åŠ è½½ï¼Œä»è€Œå¯¹åº”ç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p><h4 id="Write-Through-å†™ç©¿">Write Through(å†™ç©¿)</h4><p>Write Through å¥—è·¯å’ŒRead Throughç›¸ä»¿ï¼Œä¸è¿‡æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶å‘ç”Ÿã€‚å½“æœ‰æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œç„¶åè¿”å›ã€‚å¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™æ›´æ–°ç¼“å­˜ï¼Œç„¶åå†ç”±Cacheè‡ªå·±æ›´æ–°æ•°æ®åº“ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼‰</p><h4 id="Write-Behind-Caching-å†™å›">Write Behind Caching(å†™å›)</h4><p>åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œä¸æ›´æ–°æ•°æ®åº“ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜ä¼šå¼‚æ­¥åœ°æ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯è®©æ•°æ®çš„I/Oæ“ä½œé£å¿«æ— æ¯”ï¼ˆå› ä¸ºç›´æ¥æ“ä½œå†…å­˜å˜› ï¼‰ï¼Œå› ä¸ºå¼‚æ­¥ï¼Œè¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚ä½†æ˜¯ï¼Œå…¶å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œæ•°æ®ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šä¸¢å¤±</p><p>ä¸€èˆ¬è€Œè¨€(å³ä¸æ˜¯ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯), æˆ‘ä»¬<strong>é€‰ç”¨Cache Aside(æ—è·¯ç¼“å­˜)æ¨¡å¼</strong>, ä¸‹é¢æˆ‘ä»¬çš„è®¨è®ºä¹ŸåŸºäºæ­¤æ¨¡å¼.</p><h3 id="æ“ä½œç¼“å­˜-æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ">æ“ä½œç¼“å­˜ &amp; æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ</h3><h4 id="é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š">é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š</h4><p><strong>å¦‚æœé‡‡ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œåœ¨æ›´æ–°æ•°æ®åº“ï¼Œä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿ</strong></p><ol><li>çº¿ç¨‹Aå…ˆæŠŠç¼“å­˜çš„Aæ•°æ®åˆ é™¤ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæƒ³è¦è¯»å–Aæ•°æ®ï¼Œå‘ç°ç¼“å­˜å¤±æ•ˆï¼Œä»æ•°æ®åº“è¯»å–Aæ•°æ®ï¼Œå¹¶ä¸”æ›´æ–°ç¼“å­˜ï¼Œ</li><li>åˆ‡æ¢å›çº¿ç¨‹Aï¼Œçº¿ç¨‹Aæ›´æ–°æ•°æ®åº“æ•°æ®ã€‚</li></ol><p>è‡³æ­¤ï¼Œæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå·²ç»å‡ºç°ï¼Œæ•°æ®åº“çš„å†™å…¥è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°æ­¤ç°è±¡</p><p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ æ€ä¹ˆæ ·ï¼Ÿ</strong></p><ol><li>çº¿ç¨‹Aè¯»å–ç¼“å­˜Aæ•°æ®ï¼Œå‘ç°ç¼“å­˜å¤±æ•ˆï¼Œæ‰€ä»¥å»æ•°æ®åº“è¯»å–ï¼Œæ­¤æ—¶è¿˜æœªå†™å…¥ç¼“å­˜ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°æ•°æ®åº“ï¼Œå¹¶ä¸”åˆ é™¤å¯¹åº”çš„ç¼“å­˜ï¼Œ</li><li>åˆ‡æ¢å›çº¿ç¨‹Aï¼Œçº¿ç¨‹Aå°†è¯»å–åˆ°çš„æ—§å€¼ï¼Œå†™å…¥ç¼“å­˜</li></ol><p>åˆå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯ç›¸æ¯”å…ˆåˆ é™¤ç¼“å­˜ï¼Œå‘ç”Ÿæ¦‚ç‡å°å¾ˆå¤šï¼Œå¿…é¡»<strong>åŒæ—¶æ»¡è¶³</strong>:</p><ul><li>è¯»è¯·æ±‚çš„æ—¶å€™ï¼Œç¼“å­˜åˆšå¥½å¤±æ•ˆ</li><li>è¯»è¯·æ±‚ ä¸ å†™è¯·æ±‚ å¹¶å‘</li></ul><p>æ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”åˆ é™¤äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚æ‰€ä»¥æ¨èå…ˆ<code>æ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</code></p><p><strong>è¿˜æ˜¯å­˜åœ¨ä¸ä¸€è‡´çš„å¯èƒ½ï¼Œæ€ä¹ˆå®ç°æœ€ç»ˆçš„ä¸€è‡´æ€§å‘¢ï¼Ÿ</strong></p><ol><li>å»¶è¿ŸåŒåˆ ç­–ç•¥<br>å»¶è¿ŸåŒåˆ ç­–ç•¥æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ•°æ®åº“å­˜å‚¨å’Œç¼“å­˜æ•°æ®ä¿æŒä¸€è‡´æ€§çš„å¸¸ç”¨ç­–ç•¥ï¼Œä½†å®ƒä¸æ˜¯å¼ºä¸€è‡´ã€‚å…¶å®ä¸ç®¡å“ªç§æ–¹æ¡ˆï¼Œéƒ½é¿å…ä¸äº†Rediså­˜åœ¨è„æ•°æ®çš„é—®é¢˜ï¼Œåªèƒ½å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œè¦æƒ³å½»åº•è§£å†³ï¼Œå¾—è¦ç”¨åˆ°åŒæ­¥é”å’Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘å±‚é¢è§£å†³ã€‚</li></ol><p>ä¸é‡‡ç”¨å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜çš„æ–¹æ¡ˆ, è€Œæ˜¯ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œé‡Œé¢çš„ä¸ä¸€è‡´é—®é¢˜ï¼Œç”¨å»¶è¿ŸåŒåˆ è§£å†³<br>1ã€å…ˆåˆ é™¤ç¼“å­˜ 2ã€å†å†™æ•°æ®åº“ 3ã€ä¼‘çœ 500msï¼ˆç»Ÿè®¡çº¿ç¨‹è¯»å–æ•°æ®å’Œå†™ç¼“å­˜çš„æ—¶é—´ï¼‰ ï¼ˆä¼‘çœ çš„ä½œç”¨æ˜¯å½“å‰çº¿ç¨‹ç­‰å…¶ä»–çº¿ç¨‹è¯»å®Œäº†æ•°æ®åå†™å…¥ç¼“å­˜åï¼Œåˆ é™¤ç¼“å­˜ï¼‰ 4ã€å†åˆ é™¤ç¼“å­˜</p><ol start="2"><li>è®¾ç½®è¾ƒçŸ­çš„ç¼“å­˜è¿‡æœŸæ—¶é—´<br>æ²¿ç”¨å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜,å°±ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´(åªè¦å®ƒå¤ŸçŸ­,å°±ä¸å®¹æ˜“è¯»åˆ°é”™è¯¯æ•°æ®)</li></ol><h4 id="é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰">é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰</h4><p><strong>å¦‚æœé‡‡ç”¨å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong></p><ol><li>çº¿ç¨‹Aæ›´æ–°äº†ç¼“å­˜ï¼Œæ­¤æ—¶å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°ç¼“å­˜ï¼Œæ›´æ–°æ•°æ®åº“ï¼Œæ­¤æ—¶åˆ‡æ¢å›çº¿ç¨‹A</li><li>çº¿ç¨‹Aæ›´æ–°æ•°æ®åº“</li></ol><p>æ­¤æ—¶å°±å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼Œæ•°æ®åº“çš„å†™å…¥è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°æ­¤ç°è±¡ã€‚</p><p><strong>åè¿‡æ¥ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜å‘¢?</strong></p><ol><li>çº¿ç¨‹Aæ›´æ–°äº†æ•°æ®åº“ï¼Œè¿˜æœªå†™å…¥ç¼“å­˜ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°äº†æ•°æ®åº“ï¼Œå¹¶ä¸”å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶åˆ‡æ¢åˆ°çº¿ç¨‹A</li><li>çº¿ç¨‹AæŠŠç¼“å­˜å†™å…¥ï¼Œè¦†ç›–äº†ä¹‹å‰çº¿ç¨‹Bçš„ç¼“å­˜</li></ol><p>è‡³æ­¤ï¼Œæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œåˆå‡ºç°äº†ã€‚ç¼“å­˜çš„å†™å…¥é€šå¸¸è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ï¼Œæ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”æ›´æ–°äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚æ‰€ä»¥<code>æ¨èå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</code></p><h3 id="ä¿è¯æ“ä½œåŸå­æ€§">ä¿è¯æ“ä½œåŸå­æ€§</h3><p>æ“ä½œæ•°æ®åº“å’Œæ“ä½œç¼“å­˜å…¶å®æ˜¯ä¸¤ä¸ªæ“ä½œï¼Œå‰é¢çš„æ‰€æœ‰åˆ†æéƒ½æ˜¯å»ºç«‹åœ¨è¿™ä¸¤ä¸ªæ“ä½œéƒ½èƒ½åŒæ—¶æ‰§è¡ŒæˆåŠŸï¼Œåªè¦å‡ºç°ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸï¼Œä¸€ä¸ªæ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œå°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¼šå¯¹æ•æ„Ÿä¸šåŠ¡é€ æˆå½±å“ã€‚ä¸‹é¢å°±æ˜¯ä¸¤ç§è§£å†³æ–¹æ¡ˆ.</p><h4 id="é˜Ÿåˆ—-é‡è¯•æœºåˆ¶">é˜Ÿåˆ—+é‡è¯•æœºåˆ¶</h4><p><img src="https://pb01.s3.bitiful.net/158.png" alt="avatar"></p><ul><li>æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</li><li>ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥</li><li>å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—</li><li>è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key</li><li>ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</li></ul><p>è¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œä¼šå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚</p><h4 id="åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶">åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶</h4><p><img src="https://pb01.s3.bitiful.net/159.png" alt="avatar"></p><p>æœ¬æ–¹æ¡ˆå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚å…³é”®æ˜¯ä½¿ç”¨canalæ¡†æ¶è®¢é˜…binlog</p><ul><li>è¦å¼€å¯mysqlçš„binlogï¼Œéœ€è¦è®¾ç½®binlog_formatä¸ºROWæ¨¡å¼ï¼Œå¹¶ä¸”è®¾ç½®server_idï¼Œä¿è¯å”¯ä¸€æ€§ã€‚ä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ï¼Œé‡å¯mysqlæœåŠ¡ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin # å¼€å¯ binlog</span><br><span class="line">binlog-format=ROW # é€‰æ‹© ROW æ¨¡å¼</span><br><span class="line">server_id=1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹ Binlog æˆåŠŸã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ binlog æ—¥å¿—æ˜¯å¦å¼€å¯</span></span><br><span class="line">show variables like &#x27;log_%&#x27;;</span><br></pre></td></tr></table></figure><ul><li>MySQL æ‰§è¡Œ SQL è¯­å¥åˆ›å»º canal å•ç‹¬ä½¿ç”¨çš„è´¦å·ï¼Œç”¨æ¥è¿›è¡Œ Binlog çš„åŒæ­¥å’Œç›‘å¬</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> canal IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;canal&#x27;</span>;  </span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h4 id="Reference">Reference:</h4><ol><li><a href="https://coolshell.cn/articles/17416.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ç¼“å­˜æ›´æ–°çš„å¥—è·¯</a></li><li>Javaå…¨æ ˆçŸ¥è¯†ä½“ç³»</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“åˆ†åº“åˆ†è¡¨</title>
      <link href="/2024/03/02/2024-3-2-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/"/>
      <url>/2024/03/02/2024-3-2-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="æ•°æ®åº“åˆ†åº“åˆ†è¡¨">æ•°æ®åº“åˆ†åº“åˆ†è¡¨</h2><h3 id="åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ">åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ</h3><p>åˆ†åº“åˆ†è¡¨å…¶å®æ˜¯åˆ†åº“,åˆ†è¡¨,åˆ†åº“åˆ†è¡¨çš„æ€»ç§°</p><h4 id="åˆ†åº“">åˆ†åº“</h4><p>å°†æ•°æ®æŒ‰ç…§ä¸€å®šè§„åˆ™å­˜å‚¨åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­,æ¯ä¸ªæ•°æ®åº“å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®</p><p><code>åˆ†åº“ä¸»è¦è§£å†³çš„æ˜¯å¹¶å‘é‡è¿‡å¤§çš„é—®é¢˜</code>ï¼Œå¹¶å‘é‡ä¸€æ—¦ä¸Šå‡ï¼Œé‚£ä¹ˆæ•°æ®åº“å°±å¯èƒ½æˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆï¼Œå› ä¸ºæ•°æ®åº“çš„è¿æ¥æ•°é‡æ˜¯æœ‰ä¸Šé™çš„ï¼Œè™½ç„¶å¯ä»¥è¿›è¡Œè°ƒæ•´ï¼Œä½†å¹¶ä¸æ˜¯æ— é™è°ƒæ•´çš„ã€‚æ‰€ä»¥ï¼Œå½“æ•°æ®åº“çš„è¯»æˆ–è€…å†™çš„ QPS(æ¯ç§’æŸ¥è¯¢æ•°) å¤ªé«˜ï¼Œä»è€Œå¯¼è‡´ä½ çš„æ•°æ®åº“è¿æ¥æ•°é‡ä¸è¶³çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°åˆ†åº“äº†ï¼Œé€šè¿‡åœ¨å¢åŠ æ•°æ®åº“å®ä¾‹çš„æ–¹å¼æ¥æä¾›æ›´å¤šçš„æ•°æ®åº“è¿æ¥ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„å¹¶å‘åº¦ã€‚<br>è¿™é‡Œæ‹¿ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“æ¥ä¸¾ä¾‹ï¼Œå½“ä½ å¾®æœåŠ¡åœ¨åšæœåŠ¡æ‹†åˆ†çš„æ—¶å€™ï¼Œä½ ä¼šæŒ‰ç…§åŠŸèƒ½æ¨¡å—å»æŠŠä½ çš„ç³»ç»Ÿè¿›è¡ŒæœåŠ¡æ‹†åˆ†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å°†æ¯ä¸ªæ¨¡å—çš„æ•°æ®ä»ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“ä¸­æ‹†å¼€ï¼Œåˆ†æˆè®¢å•ã€ç‰©æµã€å•†å“ã€ç”¨æˆ·ç­‰å¤šä¸ªæ•°æ®åº“ï¼Œç„¶åéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæ¯ä¸ªå•ç‹¬çš„ä¸šåŠ¡æ•°æ®åº“ä¹Ÿéœ€è¦è¿›è¡Œåˆ†åº“äº†ï¼Œå¦‚ä¸‹å›¾æ‰€æ˜¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/154.png" alt="avatar"></p><h4 id="åˆ†è¡¨">åˆ†è¡¨</h4><p>å°†ä¸€å¼ è¡¨æŒ‰ç…§ä¸€å®šè§„åˆ™æ‹†åˆ†æˆå¤šå¼ è¡¨,æ¯å¼ è¡¨å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®</p><p><code>ç›¸æ¯”è¾ƒäºåˆ†åº“ï¼Œåˆ†è¡¨ä¸»è¦è§£å†³çš„æ˜¯æ•°æ®é‡å¤§çš„é—®é¢˜</code>ï¼Œå³é€šè¿‡å°†æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ï¼Œå‡å°‘å•è¡¨çš„æ•°æ®é‡ï¼Œä»è€Œæå‡æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h4 id="åˆ†åº“åˆ†è¡¨">åˆ†åº“åˆ†è¡¨</h4><p>è¿™ä¸€èˆ¬å‘ç”Ÿåœ¨æ•°æ®åº“è¿æ¥ä¸å¤Ÿï¼ˆåˆ†åº“è§£å†³çš„é—®é¢˜ï¼‰ä»¥åŠå•è¡¨æ•°æ®é‡è¿‡å¤§å¯¼è‡´æŸ¥è¯¢é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼ˆåˆ†è¡¨è§£å†³çš„é—®é¢˜ï¼‰è¿™ä¸¤ä¸ªé—®é¢˜å…±åŒå­˜åœ¨çš„æ—¶å€™ï¼Œä¸è¿‡åœ¨åˆ†åº“åˆ†è¡¨ä¹‹å‰ï¼Œå¯ä»¥å…ˆè€ƒè™‘ä¸€ä¸‹èƒ½ä¸èƒ½ä¼˜åŒ–å…ˆã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨çš„è¡Œæ•°å¦‚æœè¶…è¿‡äº† 1000 ä¸‡è¡Œä¹‹åï¼Œå°±éœ€è¦è€ƒè™‘åšåˆ†åº“åˆ†è¡¨äº†ï¼Œå°äºè¿™ä¸ªæ•°æ®é‡çš„æ—¶å€™ï¼Œé‡åˆ°æ€§èƒ½é—®é¢˜å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚ä½†å…¶å®è¿™ä¹ˆè¯´æ˜¯ä¸å‡†ç¡®çš„,éœ€è¦æ ¹æ®è¡¨å­—æ®µæ•°é‡ã€è¡¨ä¸­æ•°æ®æ•°é‡ä»¥åŠä¸šåŠ¡çš„å…·ä½“æƒ…å†µæ¥ç»¼åˆè€ƒè™‘,æ— æ³•ç»™å‡ºä¸€ä¸ªç¡®åˆ‡çš„å€¼.</p><ul><li><strong>å¸¸â»…çš„ä¼˜åŒ–æ‰‹æ®µ</strong></li></ul><ol><li>æ•°æ®åº“çš„åŸºæœ¬ä¼˜åŒ–ï¼šåšå¥½ç´¢å¼•ã€å‡å°‘å¤šè¡¨ joinã€å‡å°‘å†—ä½™å­—æ®µ</li><li>å‡å°‘æ•°æ®åº“å‹åŠ›ï¼šåœ¨æ•°æ®åº“ä¹‹å‰åŠ ä¸€å±‚ç¼“å­˜ï¼ŒæŠŠä¸€äº›å¯ä»¥æ¥å—å»¶è¿Ÿçš„ï¼Œä»¥åŠæ•°æ®åº“å˜åŒ–é¢‘ç‡è¾ƒä½çš„å†…å®¹æ”¾åˆ°æœ¬åœ°ç¼“å­˜æˆ–è€…åˆ†å¸ƒå¼ç¼“å­˜å½“ä¸­ã€‚</li><li>å†·çƒ­æ•°æ®çš„éš”ç¦»ï¼šå³æ•°æ®å½’æ¡£ï¼Œå¯ä»¥å°†ä¸€äº›æ›´æ–°ä»¥åŠä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®å•ç‹¬éš”ç¦»å‡ºæ¥ï¼Œå¯ä»¥æ”¾åˆ°å†å²è¡¨æˆ–è€…ç¦»çº¿æ•°ä»“å½“ä¸­ï¼Œå‡å°‘è¡¨ä¸­çš„æ•°æ®é‡æ¥æå‡æ•ˆç‡</li><li>æ•°æ®åº“åˆ†åŒºï¼šæ•°æ®åº“åˆ†åŒºä¹‹åï¼Œå°†æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„è¡¨å½“ä¸­ï¼Œå°½é‡å‡å°‘å•è¡¨çš„æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>åˆ†å¸ƒå¼æ•°æ®åº“ï¼šå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæå‡å®¹é‡</li></ol><h4 id="åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«">åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«</h4><p>æˆ‘ä»¬ä¸Šé¢æè¿‡ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§çš„è¯ï¼Œä¼˜å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸æ˜¯è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–é‡Œé¢æåˆ°äº†ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯å¯¹æ•°æ®å®ç°åˆ†åŒºæ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹è¦æ€ä¹ˆç†è§£å‘¢ï¼Ÿä»¥åŠè¿™ä¸¤ä¸ªè¿‡ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆè¯´ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯åˆ†åŒºå’Œåˆ†è¡¨ç›¸åŒçš„ç‚¹ï¼Œéƒ½æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå¯¹ä¸€å¼ æ•°æ®é‡ç‰¹åˆ«å¤§çš„è¡¨è¿›è¡Œåˆ†è§£ï¼Œä½¿å¾—è¡¨çš„æ•°æ®é‡å‡å°‘ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚è¿™æ ·å¬èµ·æ¥ä½ å¯èƒ½æ„Ÿè§‰æ²¡å·®å¤šå°‘ï¼Œå› ä¸ºä¸¤è€…çš„åŒºåˆ«éƒ½æ˜¯æŠŠè¡¨è¿›è¡Œæ‹†åˆ†ï¼Œé‚£å…·ä½“æœ‰ä»€ä¹ˆå·®åˆ«å—ï¼Ÿä¸»è¦å°±æ˜¯åˆ†åŒºå’Œåˆ†è¡¨åæ•°æ®çš„å­˜å‚¨æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>è¿™ä¸ªè¦ä» MySQL çš„ç´¢å¼•è¯´èµ·ï¼Œåœ¨ Innodb ä¸­ï¼ˆ8.0ä¹‹å‰ï¼‰ï¼Œè¡¨å­˜å‚¨ä¸»è¦ä¾èµ–ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ .frm æ–‡ä»¶å’Œ.ibd æ–‡ä»¶ã€‚.frmæ–‡ä»¶ç”¨äºå­˜å‚¨è¡¨ç»“æ„å®šä¹‰ä¿¡æ¯ï¼Œè€Œ.ibdæ–‡ä»¶åˆ™ç”¨äºå­˜å‚¨è¡¨æ•°æ®ã€‚</p><p>æ‹¿orderè¡¨æ¥ä¸¾ä¾‹,åˆ†åŒºå­˜å‚¨æ—¶ä¼šåœ¨ MySQL çš„ data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç”¨æˆ·å+è¡¨å+åˆ†åŒºå.ibd çš„æ–‡ä»¶ï¼ˆå¦‚ï¼šorder_p1.ibdï¼‰ï¼Œç”¨æ¥å­˜å‚¨ order è¡¨ä¸­ç¬¬ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ï¼ŒåŒæ ·ä¼šæœ‰ order_p2.ibd å’Œorder_p3.ibd æ¥å­˜å‚¨ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªåˆ†åŒºçš„æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">order_p1.ibd</span><br><span class="line">order_p2.ibd</span><br><span class="line">order_p3.ibd</span><br><span class="line">order.frm</span><br></pre></td></tr></table></figure><p>åˆ†è¡¨å­˜å‚¨çš„æ—¶å€™ä¼šåœ¨ MySQL çš„ Data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç¼€ä¸º .frmï¼Œåå­—ä¸º&quot;order_1.frm&quot;çš„è¡¨æ ¼æ–‡ä»¶ï¼Œå­˜å‚¨ orderè¡¨ä¸­ç¬¬ä¸€ä¸ªåˆ†è¡¨çš„æ•°æ®ï¼ŒåŒæ ·ä¼šæœ‰å¦å¤–çš„ order_2.frm å’Œorder_3.frm æ¥å­˜å‚¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªåˆ†è¡¨çš„æ•°æ®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">order_1.ibd</span><br><span class="line">order_1.frm</span><br><span class="line">order_2.ibd</span><br><span class="line">order_2.frm</span><br><span class="line">order_3.ibd</span><br><span class="line">order_3.frm</span><br></pre></td></tr></table></figure><p><code>æ‰€ä»¥ç®€å•æ¥è¯´,ä¸¤è€…çš„åŒºåˆ«æ˜¯:</code></p><ul><li>æ•°æ®åœ¨åšäº†åˆ†åŒºåï¼Œè¡¨é¢æ˜¯è¿˜æ˜¯åªæœ‰ä¸€å¼ è¡¨ï¼Œåªä¸è¿‡æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„ä½ç½®ä¸Šäº†ï¼ˆåŒä¸€ä¸ª.frmæ–‡ä»¶ï¼‰ï¼Œåœ¨åšæ•°æ®è¯»å–çš„æ—¶å€™æ“ä½œçš„è¡¨åè¿˜æ˜¯usersè¡¨ï¼Œæ•°æ®åº“ä¼šè‡ªå·±å»ç»„ç»‡å„ä¸ªåˆ†åŒºçš„æ•°æ®ã€‚</li><li>æ•°æ®åœ¨è¿›è¡Œäº†åˆ†è¡¨åï¼Œä¸ç®¡æ˜¯è¡¨é¢ä¸Šè¿˜æ˜¯å®é™…ä¸Šï¼Œéƒ½å·²ç»ä¸æ˜¯åŒä¸€å¼ è¡¨äº†ï¼Œå…¶åˆ†æˆäº†å¤šå¼ è¡¨ï¼ˆå¤šä¸ª.frm æ–‡ä»¶ ï¼‰ã€‚æ‰€ä»¥æ•°æ®åº“åœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™éœ€è¦å»æŒ‡å®šå¯¹åº”çš„è¡¨å</li></ul><h3 id="å¦‚ä½•åˆ†åº“åˆ†è¡¨">å¦‚ä½•åˆ†åº“åˆ†è¡¨</h3><p>åˆ†åº“å’Œåˆ†è¡¨éƒ½æœ‰ä¸¤ç§æ‹†åˆ†æ–¹å¼ï¼Œä¸€ç§æ˜¯å‚ç›´æ‹†åˆ†ï¼Œä¸€ç§æ˜¯æ°´å¹³æ‹†åˆ†ã€‚</p><h4 id="å‚ç›´æ‹†åˆ†">å‚ç›´æ‹†åˆ†</h4><p>å‚ç›´æ‹†åˆ†å°±æ˜¯é€šè¿‡å°†æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå‡å°‘ï¼Œç„¶åæ•°æ®çš„è¡Œæ•°ä¸å˜ï¼Œåˆ—æ•°å‡å°‘ï¼Œæ¥ä½¿å¾—æ¯ä¸ªè¡¨ä¸­çš„æ•°æ®é‡ä¸‹é™.æ¯”å¦‚ä¹‹å‰æåˆ°çš„ç”µå•†æ•°æ®åº“,å°†å…¶æ‹†åˆ†ä¸ºè®¢å•æ•°æ®åº“,å•†å“æ•°æ®åº“,ç”¨æˆ·æ•°æ®åº“ç­‰,è¿™å°±å±äºå‚ç›´æ‹†åˆ†.å¦‚æœå°†ç”¨æˆ·è¡¨å¸¸ç”¨ä¿¡æ¯åˆ†ä¸ºç”¨æˆ·ä¸»è¡¨,ä¸å¸¸ç”¨ä¿¡æ¯åˆ†ä¸ºç”¨æˆ·æ‰©å±•è¡¨,å°±æ˜¯è¡¨çš„å‚ç›´æ‹†åˆ†.å‚ç›´æ‹†åˆ†ä¸»è¦æ˜¯æ ¹æ®<code>ä¸šåŠ¡</code>æ¥å†³å®šçš„,ä¸åŒçš„ä¸šåŠ¡æœ‰ç€ä¸åŒçš„æ‹†åˆ†æ–¹æ¡ˆ.</p><h4 id="æ°´å¹³æ‹†åˆ†">æ°´å¹³æ‹†åˆ†</h4><p>æ°´å¹³æ‹†åˆ†å°±æ˜¯å°†æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªè¡¨ä¸­ï¼Œå³æ•°æ®è¡¨ä¸­åˆ—æ•°ä¸å˜ï¼Œè¡Œæ•°å‡å°‘ï¼Œæ¥ä½¿å¾—æ¯ä¸ªè¡¨ä¸­çš„æ•°æ®é‡ä¸‹é™.æ°´å¹³æ‹†åˆ†çš„<code>å…³é”®</code>åœ¨äº<strong>åˆ†ç‰‡é”®çš„é€‰æ‹©</strong>,åˆ†ç‰‡é”®æ˜¯ç”¨äºå°†æ•°æ®åº“ï¼ˆè¡¨ï¼‰æ°´å¹³æ‹†åˆ†çš„æ•°æ®åº“å­—æ®µ,å®ƒç›´æ¥å½±å“äº†åˆ†åº“åˆ†è¡¨çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é€‰æ‹©åˆ†ç‰‡é”®çš„å…³é”®å› ç´ ï¼š</p><ul><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡å‡åŒ€</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ•°æ®å°½é‡å‡åŒ€çš„åˆ†å¸ƒåˆ°å„ä¸ªæ•°æ®åº“ä¸­,é¿å…å‡ºç°çƒ­ç‚¹æ•°æ®é›†ä¸­åœ¨æŸä¸ªåˆ†ç‰‡ä¸Šçš„æƒ…å†µã€‚</li><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡å”¯ä¸€</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥é¿å…æ•°æ®é‡å¤ï¼Œæé«˜æ•°æ®çš„å”¯ä¸€æ€§ã€‚</li><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡ä¸å˜</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥é¿å…å¯¹æ‹†åˆ†ç»“æœçš„å¤šæ¬¡ä¿®æ”¹ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>é€‰æ‹©åˆ†ç‰‡é”®è¿˜åº”è€ƒè™‘æ•°æ®çš„è®¿é—®é¢‘ç‡ã€‚å°†ç»å¸¸è®¿é—®çš„æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸Šï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œé™ä½è·¨åˆ†ç‰‡æŸ¥è¯¢çš„å¼€é”€ã€‚</li></ul><h4 id="å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•">å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•</h4><h5 id="å“ˆå¸Œå–æ¨¡-HASH-MOD">å“ˆå¸Œå–æ¨¡(HASH_MOD)</h5><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„æ°´å¹³æ‹†åˆ†ç®—æ³•ï¼Œå®ƒé€šè¿‡å°†åˆ†ç‰‡é”®çš„å“ˆå¸Œå€¼å¯¹åˆ†ç‰‡æ•°é‡å–æ¨¡ï¼Œæ¥ç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨çš„åˆ†ç‰‡ã€‚å“ˆå¸Œå€¼å¯èƒ½å‡ºç°è´Ÿæ•°,è¦å…ˆå¯¹å…¶æ±‚ç»å¯¹å€¼ä¹‹åå†å–æ¨¡,ä¸‹é¢æ˜¯ShardingSphereä¸­HASH_MODç®—æ³•çš„å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">HashModShardingAlgorithm</span> <span class="keyword">implements</span> <span class="title class_">StandardShardingAlgorithm</span>&lt;Comparable&lt;?&gt;&gt;, ShardingAutoTableAlgorithm &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SHARDING_COUNT_KEY</span> <span class="operator">=</span> <span class="string">&quot;sharding-count&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> shardingCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(<span class="keyword">final</span> Properties props)</span> &#123;</span><br><span class="line">        shardingCount = getShardingCount(props);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getShardingCount</span><span class="params">(<span class="keyword">final</span> Properties props)</span> &#123;</span><br><span class="line">        ShardingSpherePreconditions.checkState(props.containsKey(SHARDING_COUNT_KEY), () -&gt; <span class="keyword">new</span> <span class="title class_">ShardingAlgorithmInitializationException</span>(getType(), <span class="string">&quot;Sharding count cannot be null.&quot;</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.parseInt(String.valueOf(props.getProperty(SHARDING_COUNT_KEY)));</span><br><span class="line">        ShardingSpherePreconditions.checkState(result &gt; <span class="number">0</span>, () -&gt; <span class="keyword">new</span> <span class="title class_">ShardingAlgorithmInitializationException</span>(getType(), <span class="string">&quot;Sharding count must be a positive integer.&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doSharding</span><span class="params">(<span class="keyword">final</span> Collection&lt;String&gt; availableTargetNames, <span class="keyword">final</span> PreciseShardingValue&lt;Comparable&lt;?&gt;&gt; shardingValue)</span> &#123;</span><br><span class="line">        ShardingSpherePreconditions.checkNotNull(shardingValue.getValue(), NullShardingValueException::<span class="keyword">new</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> String.valueOf(hashShardingValue(shardingValue.getValue()) % shardingCount);</span><br><span class="line">        <span class="keyword">return</span> ShardingAutoTableAlgorithmUtils.findMatchedTargetName(availableTargetNames, suffix, shardingValue.getDataNodeInfo()).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;String&gt; <span class="title function_">doSharding</span><span class="params">(<span class="keyword">final</span> Collection&lt;String&gt; availableTargetNames, <span class="keyword">final</span> RangeShardingValue&lt;Comparable&lt;?&gt;&gt; shardingValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> availableTargetNames;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">hashShardingValue</span><span class="params">(<span class="keyword">final</span> Object shardingValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs((<span class="type">long</span>) shardingValue.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAutoTablesAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> shardingCount;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HASH_MOD&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h5><p>æˆ‘ä»¬åœ¨åšåˆ†åº“åˆ†è¡¨çš„æ—¶å€™ï¼Œæœ€å¼€å§‹æ ¹æ®ä¸šåŠ¡åˆ†æï¼Œåªéœ€è¦ 128 å¼ è¡¨å°±å¯ä»¥æ»¡è¶³æ•°æ®é‡çš„è¦æ±‚äº†ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„æ‰©å±•ï¼Œ128 å¼ è¡¨å¯èƒ½å·²ç»ä¸å¤Ÿç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡æ–°åˆ†è¡¨äº†ï¼Œæ¯”å¦‚å¢åŠ ä¸€å¼ æ–°çš„è¡¨ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœé‡‡ç”¨ Hashå–æ¨¡çš„æ–¹å¼ï¼Œå°±ä¼šå¯¼è‡´ 128 + 1 å¼ è¡¨çš„æ•°æ®éœ€è¦é‡æ–°è¿›è¡Œåˆ†é…ï¼Œæˆæœ¬éå¸¸é«˜ã€‚è€Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±æ˜¯ä¸“é—¨è§£å†³è¿™ç±»é—®é¢˜çš„ç®—æ³•ï¼Œå…¶å¯ä»¥æœ‰æ•ˆåœ°è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶çš„å¤±æ•ˆé—®é¢˜ã€‚</p><p>å®ç°ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é¦–å…ˆéœ€è¦æ„é€ ä¸€ä¸ª<strong>å“ˆå¸Œç¯</strong>ï¼Œç„¶ååˆ’åˆ†å›ºå®šæ•°é‡çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ 2çš„32æ¬¡æ–¹ã€‚æ¥ä¸‹æ¥å°†128å¼ è¡¨ä½œä¸ºèŠ‚ç‚¹æ˜ å°„åˆ°è¿™äº›è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šé¢éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬å°±éœ€è¦å­˜å‚¨æ•°æ®äº†ï¼Œç°åœ¨æˆ‘ä»¬è¦æŠŠåˆ†ç‰‡é”®ä¹Ÿæ ¹æ®åŒæ ·çš„ç®—æ³•è¿›è¡Œ Hashï¼Œå¹¶ä¸”ä¹Ÿå°†å…¶æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šé¢ã€‚ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œåœ¨è¿™ä¸ª Hash ç¯ä¸Šé¢çš„è™šæ‹ŸèŠ‚ç‚¹å°±åŒ…å«ä¸¤éƒ¨åˆ†æ•°æ®çš„æ˜ å°„äº†ï¼Œä¸€éƒ¨åˆ†æ˜¯å­˜å‚¨æ•°æ®çš„åˆ†è¡¨çš„æ˜ å°„ï¼Œä¸€éƒ¨åˆ†æ˜¯çœŸå®è¦å­˜å‚¨çš„æ•°æ®çš„æ˜ å°„ã€‚</p><p>æˆ‘ä»¬æœ€ç»ˆç›®çš„æ˜¯å°†è¿™äº›æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“åˆ†è¡¨ä¸­ï¼Œé‚£ä¹ˆåšå¥½å“ˆå¸Œä¹‹åï¼Œè¿™äº›æ•°æ®åˆè¦ä¿å­˜åœ¨å“ªä¸ªæ•°æ®åº“è¡¨èŠ‚ç‚¹ä¸­å‘¢ï¼Ÿè¿™ä¸ªå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æŒ‰ç…§æ•°æ®çš„ä½ç½®ï¼Œæ²¿ç€é¡ºæ—¶é’ˆçš„æ–¹å‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®åº“è¡¨èŠ‚ç‚¹å°±æ˜¯æ•°æ®è¦å­˜æ”¾çš„æ•°æ®åº“è¡¨èŠ‚ç‚¹ã€‚</p><p>å›åˆ°å¼€å¤´çš„é—®é¢˜,æˆ‘ä»¬è¦æ·»åŠ ç¬¬129å¼ è¡¨,åªè¦å°†ç¬¬129å¼ è¡¨çš„è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Š,ç„¶åå°†æ•°æ®é‡æ–°åˆ†é…å³å¯,è¿™æ ·åªä¼šå½±å“åˆ°å“ˆå¸Œç¯ä¸Šæ–°å¢èŠ‚ç‚¹é¡ºæ—¶é’ˆæ—‹è½¬çš„<strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®</strong>,è€Œä¸ä¼šå½±å“åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><p><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p><p><code>ä¼˜ç‚¹:</code></p><ul><li>æ•°æ®å‡è¡¡ï¼šåœ¨å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åªä¼šå½±å“åˆ°å°‘é‡çš„æ•°æ®è¿ç§»ï¼Œä¿æŒäº†æ•°æ®çš„å‡è¡¡æ€§ã€‚</li><li>é«˜æ‰©å±•æ€§ï¼šå½“èŠ‚ç‚¹æ•°ç›®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¯¹äºå·²ç»å­˜åœ¨çš„æ•°æ®ï¼Œåªæœ‰éƒ¨åˆ†æ•°æ®éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œä¸ä¼šå½±å“åˆ°æ•´ä½“çš„æ•°æ®ç»“æ„ã€‚</li></ul><p><code>ç¼ºç‚¹:</code></p><ul><li>Hash å€¾æ–œï¼šåœ¨èŠ‚ç‚¹æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œç”±äºå“ˆå¸Œç©ºé—´æ˜¯æœ‰é™çš„ï¼ŒèŠ‚ç‚¹çš„åˆ†å¸ƒå¯èƒ½ä¸å¤Ÿå‡åŒ€ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œã€‚</li><li>èŠ‚ç‚¹çš„é¢‘ç¹å˜æ›´ï¼š å¦‚æœé¢‘ç¹æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œä»è€Œé€ æˆç³»ç»Ÿå‹åŠ›ã€‚</li></ul><p><strong>Hash å€¾æ–œçš„è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li><p>åŠ›å¤§ç –é£,å¢åŠ èŠ‚ç‚¹,å°½å¯èƒ½åœ°åˆ†æ•£èŠ‚ç‚¹ï¼Œä½¿å¾—æ•°æ®åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€,ä½†è¿™ä¸å¤ªç°å®,å› ä¸ºæœ‰è¿™ä¸ªæ¡ä»¶ä¹Ÿå°±ä¸ä¼šå‡ºç° Hash å€¾æ–œçš„é—®é¢˜äº†ã€‚</p></li><li><p>å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹,å³æˆ‘ä»¬å°†ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹æ‹†åˆ†æˆå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œç„¶åæ•°æ®åœ¨æ˜ å°„çš„æ—¶å€™å…ˆå°†æ•°æ®æ˜ å°„åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œç„¶åè™šæ‹ŸèŠ‚ç‚¹åœ¨å¯¹åº”çš„ç‰©ç†èŠ‚ç‚¹è¿›è¡Œå­˜å‚¨å’Œè¯»å–å°±å¯ä»¥äº†ï¼Œæœ‰äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¥å…¥ï¼Œæ•°æ®åœ¨åˆ†å¸ƒçš„æ—¶å€™å°±ä¼šå°½å¯èƒ½åœ°åˆ†æ•£ï¼Œç„¶ååœ¨å¢åŠ æˆ–è€…å‡å°‘æœåŠ¡å™¨æ•°é‡çš„æ—¶å€™ï¼Œå—åˆ°å½±å“çš„æ•°æ®èŒƒå›´ä¹Ÿä¸ä¼šæœ‰é‚£ä¹ˆå¤šã€‚</p></li></ol><h5 id="å…¶ä»–ç®—æ³•">å…¶ä»–ç®—æ³•</h5><p>ShardingSphereçš„åˆ†ç‰‡ç®—æ³•è¿˜æœ‰å¦‚ä¸‹å›¾è¿™äº›:</p><p><img src="https://pb01.s3.bitiful.net/155.png" alt="avatar"></p><h3 id="åˆ†è¡¨ä¹‹åçš„å…¨å±€-ID-å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ">åˆ†è¡¨ä¹‹åçš„å…¨å±€ ID å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ</h3><p>æˆ‘ä»¬åœ¨å•è¡¨ä¸­å¯ä»¥é‡‡ç”¨æ•°æ®åº“ä¸»é”®æ¥åšå”¯ä¸€çš„ IDï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº†åˆ†åº“åˆ†è¡¨çš„å½¢å¼ï¼Œé‚£ä¹ˆå¤šå¼ å•è¡¨ä¸­çš„è‡ªå¢ä¸»é”®å°±ä¸€å®šä¼šå‘ç”Ÿå†²çªï¼Œé‚£è¿™æ ·çš„è¯ä½ ç”Ÿæˆçš„ID å°±ä¸å…·å¤‡å…¨å±€å”¯ä¸€æ€§äº†</p><h4 id="UUID">UUID</h4><p>UUIDæ˜¯å¯ä»¥åšåˆ°å…¨å±€å”¯ä¸€æ€§çš„ï¼Œè€Œä¸”ç”Ÿæˆæ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œè€Œä¸”æ€§èƒ½å¾ˆé«˜ï¼Œä¸ä¾èµ–äºç½‘ç»œï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¸ä½¿ç”¨ä»–ä½œä¸ºå”¯ä¸€ IDï¼Œä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š</p><ol><li>UUID å¤ªâ»“äº†ï¼Œå®ƒæœ‰ 32 ä½ 16è¿›åˆ¶çš„æ•°å­—ï¼Œä¸”å­—ç¬¦ä¸²çš„æŸ¥è¯¢æ•ˆç‡ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œåœ¨ä½œä¸ºåˆ†å¸ƒå¼ ID æŸ¥è¯¢çš„æ—¶å€™å­˜åœ¨æŸ¥è¯¢æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚åˆèŒƒå›´æŸ¥è¯¢ä»¥åŠä¸æ–¹ä¾¿å±•ç¤ºç­‰é—®é¢˜ã€‚</li><li><strong>ä¸å…·æœ‰ä¸šåŠ¡æ€§</strong>ï¼Œæ ‡å‡†çš„ UUID æ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12)ï¼Œä¸€å…±32ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éšä¾¿ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œâ€œ340a3413-b8a2-c1e6-f922-895398142390â€,å¯¹äºè¿™ä¸ªå­—ç¬¦ä¸²æ¥è¯´ï¼Œå¾ˆéš¾çœ‹å‡ºå…¶è¡¨è¾¾çš„å«ä¹‰ï¼Œå¦‚æœä½¿ç”¨å…¶ä½œä¸ºå…¨å±€å”¯ä¸€æ ‡è¯†ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾ˆéš¾è¿›è¡Œé—®é¢˜çš„æ’æŸ¥ä»¥åŠå¼€å‘è¿‡ç¨‹ä¸­çš„è°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘ UUID ä½œä¸ºå…¨å±€å”¯ä¸€æ ‡è¯†</li></ol><h4 id="åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®">åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®</h4><p>åˆ©ç”¨ä¸€ä¸ªè¡¨æ¥å­˜æ”¾è‡ªå¢ ID ï¼Œç„¶åæ‰€æœ‰çš„è¡¨åœ¨éœ€è¦ä¸»é”®çš„æ—¶å€™æ¥è¿™å¼ è¡¨é‡Œé¢å–å°±å¯ä»¥äº†ï¼Œè¿™æ ·åšå°±å¯ä»¥å®ç°å…¨å±€å”¯ä¸€ï¼Œè¿˜å®ç°äº†è‡ªå¢æ•ˆæœï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚è¿™æ ·ä¸å¦å®šï¼Œç¡®å®å¯ä»¥å®ç°å…¨å±€å”¯ä¸€è€Œä¸”è¿˜èƒ½å®ç°è‡ªå¢æ•ˆæœï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯<strong>è¿™å¼ å•è¡¨æœ€ç»ˆä¼šæˆä¸ºäº†ç³»ç»Ÿæ‰©å±•çš„ç“¶é¢ˆ</strong>ï¼Œè€Œä¸”ä¹Ÿå­˜åœ¨<strong>å•ç‚¹é—®é¢˜</strong>ï¼Œä¸€æ—¦è¿™å¼ è¡¨æœ‰ä¸€å¤©çªç„¶æŒ‚äº†ï¼Œé‚£æ•´ä¸ªæ•°æ®åº“çš„æ’å…¥ä¸å°±ç˜«ç—ªäº†å—ï¼Ÿ</p><h4 id="åŸºäºå¤šä¸ªå•è¡¨-æ­¥â»“åšè‡ªå¢ä¸»é”®">åŸºäºå¤šä¸ªå•è¡¨+æ­¥â»“åšè‡ªå¢ä¸»é”®</h4><p>è®¾ç½®èµ·å§‹å€¼å’Œæ­¥é•¿,æ¯”å¦‚table_001èµ·å§‹å€¼ä¸º10000,æ­¥é•¿ä¸º10000,å…¶èŒƒå›´å°±ä¸º10000-19999,table_002èµ·å§‹å€¼ä¸º20000,æ­¥é•¿ä¸º10000,å…¶èŒƒå›´å°±ä¸º20000-29999,ä»¥æ­¤ç±»æ¨,è¿™æ ·å°±å¯ä»¥å®ç°å…¨å±€å”¯ä¸€,è€Œä¸”è¿˜èƒ½å®ç°è‡ªå¢æ•ˆæœ.ä½†æ˜¯åˆæœ‰äº†ä¸€ä¸ªæ–°çš„é—®é¢˜,é‚£å°±æ˜¯table_001å¦‚æœ ID åˆ°äº†19999 ï¼Œè¿™ä¸ªæ€ä¹ˆåŠï¼Ÿé‚£å°±é‡æ–°ç”Ÿæˆä¸€ä¸ªèµ·å§‹å€¼ï¼štable_001çš„æ–°èµ·å§‹å€¼ä¸º80000,å…¶èŒƒå›´ä¸º80000-89999,ä»¥æ­¤ç±»æ¨.</p><h4 id="é›ªèŠ±ç®—æ³•">é›ªèŠ±ç®—æ³•</h4><p>é›ªèŠ±ç®—æ³•æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸â»…çš„åˆ†å¸ƒå¼ ID çš„ç”Ÿæˆæ–¹å¼ï¼Œå®ƒå…·æœ‰å…¨å±€å”¯ä¸€ã€é€’å¢ã€é«˜å¯ç”¨çš„ç‰¹ç‚¹ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†ä¸€ä¸ª 64ä½çš„IDåˆ’åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³ã€æ•°æ®ä¸­å¿ƒæ ‡è¯†ã€æœºå™¨æ ‡è¯†å’Œåºåˆ—å·ç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/156.png" alt="avatar"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œé›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ ID æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æœ€é«˜1ä½å›ºå®šå€¼0ï¼Œå› ä¸ºç”Ÿæˆçš„ id æ˜¯æ­£æ•´æ•°ï¼Œå¦‚æœæ˜¯1å°±æ˜¯è´Ÿæ•°äº†ã€‚</li><li>æ¥ä¸‹æ¥41ä½å­˜å‚¨æ¯«ç§’çº§æ—¶é—´æˆ³ï¼Œ2^41/(1000606024365)=69ï¼Œå¤§æ¦‚å¯ä»¥ä½¿ç”¨69å¹´ã€‚</li><li>å†æ¥ä¸‹10ä½å­˜å‚¨æœºå™¨ç ï¼ŒåŒ…æ‹¬5ä½ datacenterId å’Œ5ä½ workerIdã€‚æœ€å¤šå¯ä»¥éƒ¨ç½²2^10=1024å°æœºå™¨ã€‚</li><li>æœ€å12ä½å­˜å‚¨åºåˆ—å·ã€‚åŒä¸€æ¯«ç§’æ—¶é—´æˆ³æ—¶ï¼Œé€šè¿‡è¿™ä¸ªé€’å¢çš„åºåˆ—å·æ¥åŒºåˆ†ã€‚å³å¯¹äºåŒä¸€å°æœºå™¨è€Œè¨€ï¼ŒåŒä¸€æ¯«ç§’æ—¶é—´æˆ³ä¸‹ï¼Œå¯ä»¥ç”Ÿæˆ2^12=4096ä¸ªä¸é‡å¤ idã€‚</li></ol><p>å¯ä»¥å°†é›ªèŠ±ç®—æ³•ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡è¿›è¡Œéƒ¨ç½²ï¼Œç„¶åéœ€è¦å…¨å±€å”¯ä¸€ id çš„ç³»ç»Ÿï¼Œè¯·æ±‚é›ªèŠ±ç®—æ³•æœåŠ¡è·å– id å³å¯ã€‚å¯¹äºæ¯ä¸€ä¸ªé›ªèŠ±ç®—æ³•æœåŠ¡ï¼Œéœ€è¦å…ˆæŒ‡å®š10ä½çš„æœºå™¨ç ï¼Œè¿™ä¸ªæ ¹æ®è‡ªèº«ä¸šåŠ¡è¿›è¡Œè®¾å®šå³å¯ã€‚ä¾‹å¦‚æœºæˆ¿å·+æœºå™¨å·ï¼Œæœºå™¨å·+æœåŠ¡å·ï¼Œæˆ–è€…æ˜¯å…¶ä»–å¯åŒºåˆ«æ ‡è¯†çš„10ä½æ¯”ç‰¹ä½çš„æ•´æ•°å€¼éƒ½è¡Œã€‚</p><p>å½“ç„¶é›ªèŠ±ç®—æ³•ä¹Ÿæœ‰å…¶ç¼ºç‚¹:<strong>ä¾èµ–æœåŠ¡å™¨æ—¶é—´ï¼ŒæœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨æ—¶å¯èƒ½ä¼šç”Ÿæˆé‡å¤ id</strong>ã€‚ç®—æ³•ä¸­å¯é€šè¿‡è®°å½•æœ€åä¸€ä¸ªç”Ÿæˆ id æ—¶çš„æ—¶é—´æˆ³æ¥è§£å†³ï¼Œæ¯æ¬¡ç”Ÿæˆ id ä¹‹å‰æ¯”è¾ƒå½“å‰æœåŠ¡å™¨æ—¶é’Ÿæ˜¯å¦è¢«å›æ‹¨ï¼Œé¿å…ç”Ÿæˆé‡å¤ idã€‚</p><p>åƒç™¾åº¦,ç¾å›¢ç­‰å¤§å‚éƒ½åœ¨githubä¸Šå¼€æºäº†è‡ªå·±çš„åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p><h3 id="åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢">åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢</h3><h4 id="å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢">å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢</h4><p>ç”±äºå¸¦æœ‰åˆ†ç‰‡é”®,æˆ‘ä»¬å¯ä»¥å®šä½åˆ°å…·ä½“çš„åº“å’Œè¡¨,ç„¶åè¿›è¡ŒæŸ¥è¯¢.</p><h4 id="ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢">ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢</h4><p>ä»¥ç”µå•†ç½‘ç«™ä¸ºä¾‹ï¼Œç”µå•†ç½‘ç«™ä¸Šä¸ä»…æœ‰ä¹°å®¶ï¼Œè¿˜æœ‰å–å®¶ï¼Œä»–ä»¬çš„æŸ¥è¯¢ä¹Ÿå¾ˆé«˜é¢‘ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé’ˆå¯¹å–å®¶æŸ¥è¯¢ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„æ–¹æ¡ˆï¼ŒåŒæ­¥å‡ºä¸€å¼ æŒ‰ç…§å–å®¶ç»´åº¦åšåˆ†è¡¨çš„è¡¨æ¥ã€‚è™½ç„¶è¿™ç§æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ç§’çº§çš„å»¶è¿Ÿï¼Œä½†æ˜¯ä¸€èˆ¬ä¸šåŠ¡ä¸Šæ¥è¯´éƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€æ¡è®¢å•åˆ›å»ºå‡ºæ¥ä¹‹åï¼Œä¼šåœ¨ä¹°å®¶è¡¨åˆ›å»ºä¸€æ¡è®°å½•ï¼Œä»¥ä¹°å®¶IDä½œä¸ºåˆ†è¡¨å­—æ®µï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šåœ¨å–å®¶è¡¨åˆ›å»ºä¸€æ¡è®°å½•å‡ºæ¥ï¼Œç”¨å–å®¶IDè¿›è¡Œåˆ†è¡¨ã€‚å¹¶ä¸”è¿™å¼ å–å®¶è¡¨ä¸ä¼šåšä»»ä½•å†™æ“ä½œï¼Œåªæä¾›æŸ¥è¯¢æœåŠ¡ï¼Œå®Œå…¨å¯ä»¥ç”¨ä¸€äº›æ¯”è¾ƒå»‰ä»·çš„æœºå­å»éƒ¨ç½²æ•°æ®åº“å®ä¾‹ã€‚è¿™æ ·ï¼Œå–å®¶çš„åˆ†â»šç­‰æŸ¥è¯¢å°±å¯ä»¥ç›´è¿å–å®¶è¡¨åšæŸ¥è¯¢äº†ã€‚</p><h4 id="ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢">ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤§å‚ç”¨çš„æ¯”è¾ƒå¤šçš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®ä»“åº“æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼šæŠŠè¿™äº›æ•°æ®åŒæ­¥åˆ°åƒTiDBã€PolarDBã€HBaseç­‰è¿™äº›æ•°æ®åº“ä¸­ï¼Œæˆ–è€…åŒæ­¥åˆ°ESä¸­ï¼Œç„¶ååœ¨è¿™äº›æ•°æ®åº“ä¸­åšæ•°æ®çš„èšåˆæŸ¥è¯¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†åº“åˆ†è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜</title>
      <link href="/2024/03/01/2024-3-1-%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/01/2024-3-1-%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜">åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2><h3 id="é”™æŠŠç‰ˆæœ¬å‡çº§">é”™æŠŠç‰ˆæœ¬å‡çº§</h3><p>æœ€è¿‘é˜¿é‡Œäº‘æ˜¾ç¤ºæˆ‘çš„åšå®¢ç½‘ç«™æœ‰æ¼æ´,æˆ‘ä¾¿æƒ³ç€å»æŠŠå®ƒç»™ä¿®äº†,ç”±äºç»éªŒä¸è¶³ä¸”æ²¡æœ‰è®¤çœŸçœ‹å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,æˆ‘æŠŠcentosä»ç‰ˆæœ¬7ç›´æ¥å‡åˆ°äº†ç‰ˆæœ¬8,å¯¼è‡´åšå®¢ç½‘ç«™æŒ‚äº†,æœåŠ¡ä¸å¯ç”¨.ç”±äºæ˜¯å¤§ç‰ˆæœ¬å‡çº§,è€Œä¸”ä¹‹å‰ä¹Ÿé”™è¯¯å‡çº§äº†ä¸€äº›ä¸œè¥¿,äºæ˜¯æˆ‘é€‰æ‹©äº†é‡ç½®ç¯å¢ƒç„¶åé‡æ–°éƒ¨ç½².äº‹åæƒ³äº†ä¸€ä¸‹,ä¸»è¦é—®é¢˜æœ‰ä¸¤ç‚¹:</p><ol><li>æ²¡æœ‰ä»”ç»†çœ‹å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,ä½¿ç”¨äº†æ›´å®½èŒƒå›´çš„updateå‘½ä»¤,å¯¼è‡´centoså’Œä¸€äº›ç»„ä»¶é”™è¯¯å‡çº§,ä»è€Œå¯¼è‡´åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®.</li><li>æ²¡æœ‰å¤‡ä»½æ‰‹æ®µ,é˜¿é‡Œäº‘å…¶å®æä¾›äº†å¿«ç…§,ä½†æˆ‘ä»¥ä¸ºè‡ªå·±ä¸ä¼šç”¨ä¸Š,è€Œä¸”èƒ½çœä¸€ç¬”é’±,ä¹Ÿå°±æ²¡å¼€é€š</li></ol><p>é˜¿é‡Œäº‘é‡ç½®ç¯å¢ƒçš„æ–¹æ³•:</p><ol><li><p>åœæ­¢äº‘æœåŠ¡å™¨<br><img src="https://pb01.s3.bitiful.net/144.png" alt="avatar"></p></li><li><p>æ‰¾åˆ°æ›´æ¢æ“ä½œç³»ç»Ÿé€‰é¡¹,é€‰æ‹©æ›´æ¢ç³»ç»Ÿç›˜<br><img src="https://pb01.s3.bitiful.net/145.png" alt="avatar"></p></li><li><p>å¯¹ç³»ç»Ÿç›˜åšåˆå§‹è®¾ç½®<br><img src="https://pb01.s3.bitiful.net/146.png" alt="avatar"></p></li></ol><h3 id="åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®">åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®</h3><p>è¿™ä¸ªé—®é¢˜åœ¨äºæµè§ˆå™¨,æˆ‘ä¸€ç›´æ²¡æœ‰ç»™æˆ‘çš„ç½‘ç«™é…ç½®SSLè¯ä¹¦,æ‰€ä»¥ä¸€ç›´ç”¨çš„æ˜¯httpåè®®,ç°åœ¨edgeæµè§ˆå™¨å’Œchromeæµè§ˆå™¨å·²ç»å¼ºåˆ¶å°†httpè½¬æ¢ä¸ºhttps,å¯¼è‡´æˆ‘çš„ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®.è§£å†³æ–¹æ¡ˆæœ‰å¦‚ä¸‹ä¸¤ç§:</p><h4 id="1-æ›´æ”¹HSTS">1.æ›´æ”¹HSTS</h4><p>åœ¨edgeæµè§ˆå™¨ä¸­,è¾“å…¥edge://net-internals/#hsts,åœ¨Delete domain sercurity policiesä¸­è¾“å…¥é¡¹ç›®çš„åŸŸåï¼Œå¹¶Delete,ç„¶åé‡æ–°è®¿é—®ç½‘ç«™å³å¯.chromeæµè§ˆå™¨è¾“å…¥chrome://net-internals/#hstså³å¯.</p><p><img src="https://pb01.s3.bitiful.net/147.png" alt="avatar"></p><h4 id="2-é…ç½®SSLè¯ä¹¦">2.é…ç½®SSLè¯ä¹¦</h4><p>ä¹‹å‰æ²¡é…ç½®SSLè¯ä¹¦çš„åŸå› æ˜¯è§‰å¾—æ²¡å¿…è¦,æœ¬èº«ç½‘ç«™è®¿é—®é‡ä¸å¤§,èƒ½ç”¨å°±è¡Œ,ç°åœ¨éšç€æµè§ˆå™¨å®‰å…¨ç­–ç•¥çš„å‡çº§,ä¹Ÿå°±ä¸å¾—ä¸é…ç½®äº†.</p><ol><li>è´­ä¹°SSLè¯ä¹¦<br>ç”±äºé˜¿é‡Œäº‘ç°åœ¨çš„å…è´¹è¯ä¹¦åªæä¾›ä¸‰ä¸ªæœˆ,æ‰€ä»¥æˆ‘é€‰æ‹©äº†68å…ƒä¸€å¹´çš„è¯ä¹¦</li></ol><p><img src="https://pb01.s3.bitiful.net/148.png" alt="avatar"></p><ol start="2"><li><p>é…ç½®DNSè§£æ<br>æ ¹æ®SSLè¯ä¹¦æä¾›çš„ä¿¡æ¯æ·»åŠ ä¸€æ¡è®°å½•,ä»¥ä¾¿é€šè¿‡éªŒè¯,å½“ç„¶å¦‚æœæœåŠ¡å™¨,åŸŸåéƒ½æ˜¯é˜¿é‡Œäº‘çš„,å®ƒä¼šä¸ºä½ è‡ªåŠ¨æ·»åŠ ,ä½†ä¼šæœ‰ç‚¹æ…¢.<br><img src="https://pb01.s3.bitiful.net/153.png" alt="avatar"></p></li><li><p>è¯ä¹¦ä¸‹è½½<br>æˆ‘æ˜¯ä¸‹è½½Nginxçš„è¯ä¹¦<br><img src="https://pb01.s3.bitiful.net/150.png" alt="avatar"><br>ç„¶åå°†ä¸‹è½½ä¸‹æ¥çš„keyå’Œpemæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š,å¯ä»¥ä¸æŒ‰æˆ‘çš„æ“ä½œæ¥<br><img src="https://pb01.s3.bitiful.net/149.png" alt="avatar"></p></li></ol><p>æˆ‘çš„æ“ä½œå¦‚ä¸‹:åœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªSSLæ–‡ä»¶å¤¹ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/</span><br><span class="line"><span class="built_in">mkdir</span> SSL</span><br></pre></td></tr></table></figure><ol start="4"><li>é…ç½®nginx<br>è¿™é‡Œéœ€è¦ä¿®æ”¹nginx.confæ–‡ä»¶,æ·»åŠ httpsåè®®çš„é…ç½®</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure><p>è¿›å…¥åæ‰¾åˆ°serverå—,ç›‘å¬443ç«¯å£çš„é‚£ä¸ª,80çš„é‚£ä¸ªæ˜¯httpåè®®çš„é…ç½®,å¯ä»¥æ³¨é‡Šæ‰,ä¹Ÿå¯ä»¥ä¿ç•™(<strong>è®°å¾—æ£€æŸ¥443ç«¯å£æ˜¯å¦æ‰“å¼€</strong>).<br><img src="https://pb01.s3.bitiful.net/151.png" alt="avatar"></p><p>å°†å…¶å–æ¶ˆæ³¨é‡Š,å°†rootæ”¹ä¸ºåšå®¢æ ¹ç›®å½•,æŠŠpemæ–‡ä»¶å’Œkeyæ›¿æ¢ä¸Šå»,å¦‚æœä¸‹è½½çš„ä¸æ˜¯Nginxçš„è¯ä¹¦,å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹,è‡ªå·±æ³¨æ„å°±å¥½<br><img src="https://pb01.s3.bitiful.net/152.png" alt="avatar"></p><ol start="5"><li>é‡å¯NginxæœåŠ¡</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure><p>çœ‹NginxæœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx.service</span><br></pre></td></tr></table></figure><ol start="6"><li>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ<br>ä½¿ç”¨httpsåè®®è®¿é—®ä½ çš„ç½‘ç«™,å¦‚æœå‡ºç°äº†é”çš„æ ‡è¯†,å°±ä»£è¡¨é…ç½®æˆåŠŸ.</li></ol>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</title>
      <link href="/2024/02/26/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/"/>
      <url>/2024/02/26/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h4 id="å£°æ˜-æœ¬æ–‡è½¬è½½è‡ª-a-href-https-segmentfault-com-a-1190000044102356-style-color-177cb0-text-decoration-underline-text-decoration-style-dotted-Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ-a">å£°æ˜:æœ¬æ–‡è½¬è½½è‡ª<a href="https://segmentfault.com/a/1190000044102356" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</a></h4><h1 id="Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ">Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</h1><h2 id="1-ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•">1. ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•</h2><h3 id="1-1-æ•°æ®è„±æ•çš„å®šä¹‰">1.1 æ•°æ®è„±æ•çš„å®šä¹‰</h3><p>æ•°æ®è„±æ•ç™¾åº¦ç™¾ç§‘ä¸­æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p><p>æ•°æ®è„±æ•ï¼ŒæŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¼€å‘ã€æµ‹è¯•å’Œå…¶å®ƒéç”Ÿäº§ç¯å¢ƒä»¥åŠå¤–åŒ…ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨è„±æ•åçš„çœŸå®æ•°æ®é›†ã€‚åœ¨æ¶‰åŠå®¢æˆ·å®‰å…¨æ•°æ®æˆ–è€…ä¸€äº›å•†ä¸šæ€§æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸è¿åç³»ç»Ÿè§„åˆ™æ¡ä»¶ä¸‹ï¼Œå¯¹çœŸå®æ•°æ®è¿›è¡Œæ”¹é€ å¹¶æä¾›æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·ã€å¡å·ã€å®¢æˆ·å·ç­‰ä¸ªäººä¿¡æ¯éƒ½éœ€è¦è¿›è¡Œæ•°æ®è„±æ•ã€‚æ˜¯æ•°æ®åº“å®‰å…¨æŠ€æœ¯ä¹‹ä¸€ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ•°æ®è„±æ•æ˜¯æŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚</p><p>åœ¨æ•°æ®è„±æ•è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä¸åŒçš„ç®—æ³•å’ŒæŠ€æœ¯ï¼Œä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œåœºæ™¯å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºèº«ä»½è¯å·ç ï¼Œå¯ä»¥ä½¿ç”¨æ©ç ç®—æ³•ï¼ˆmaskingï¼‰å°†å‰å‡ ä½æ•°å­—ä¿ç•™ï¼Œå…¶ä»–ä½ç”¨â€œXâ€æˆ–&quot;*&quot;ä»£æ›¿ï¼›å¯¹äºå§“åï¼Œå¯ä»¥ä½¿ç”¨ä¼ªé€ ï¼ˆpseudonymizationï¼‰ç®—æ³•ï¼Œå°†çœŸå®å§“åæ›¿æ¢æˆéšæœºç”Ÿæˆçš„å‡åã€‚</p><h3 id="1-2-å¸¸ç”¨è„±æ•è§„åˆ™">1.2 å¸¸ç”¨è„±æ•è§„åˆ™</h3><p>æ›¿æ¢ã€é‡æ’ã€åŠ å¯†ã€æˆªæ–­ã€æ©ç </p><h2 id="2-Hutoolå·¥å…·ä»‹ç»">2. Hutoolå·¥å…·ä»‹ç»</h2><h3 id="2-1-å¼•å…¥Mavené…ç½®">2.1 å¼•å…¥Mavené…ç½®</h3><p>åœ¨é¡¹ç›®çš„pom.xmlçš„dependenciesä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼Œè¿™é‡Œä»¥5.8.16ç‰ˆæœ¬ä¸ºä¾‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool\-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šHutool 5.xæ”¯æŒJDK8+ï¼Œ å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨JDK7ï¼Œè¯·ä½¿ç”¨Hutool 4.xç‰ˆæœ¬ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ•°æ®è„±æ•å·¥å…·ç±»åªæœ‰åœ¨5.6+ç‰ˆæœ¬ä»¥ä¸Šæ‰æä¾›ã€‚</p><h3 id="2-2-HutoolåŒ…å«çš„ç»„ä»¶">2.2 HutoolåŒ…å«çš„ç»„ä»¶</h3><p>ä¸€ä¸ªJavaåŸºç¡€å·¥å…·ç±»ï¼Œå¯¹æ–‡ä»¶ã€æµã€åŠ å¯†è§£å¯†ã€è½¬ç ã€æ­£åˆ™ã€çº¿ç¨‹ã€XMLç­‰JDKæ–¹æ³•è¿›è¡Œå°è£…ï¼Œç»„æˆå„ç§Utilå·¥å…·ç±»ï¼ŒåŒæ—¶æä¾›ä»¥ä¸‹ç»„ä»¶ï¼š</p><table><thead><tr><th>æ¨¡å—</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>hutool-aop</td><td>JDKåŠ¨æ€ä»£ç†å°è£…ï¼Œæä¾›éIOCä¸‹çš„åˆ‡é¢æ”¯æŒ</td></tr><tr><td>hutool-bloomFilter</td><td>å¸ƒéš†è¿‡æ»¤ï¼Œæä¾›ä¸€äº›Hashç®—æ³•çš„å¸ƒéš†è¿‡æ»¤</td></tr><tr><td>hutool-cache</td><td>ç®€å•ç¼“å­˜å®ç°</td></tr><tr><td>hutool-core</td><td>æ ¸å¿ƒï¼ŒåŒ…æ‹¬Beanæ“ä½œã€æ—¥æœŸã€å„ç§Utilç­‰</td></tr><tr><td>hutool-cron</td><td>å®šæ—¶ä»»åŠ¡æ¨¡å—ï¼Œæä¾›ç±»Crontabè¡¨è¾¾å¼çš„å®šæ—¶ä»»åŠ¡</td></tr><tr><td>hutool-crypto</td><td>åŠ å¯†è§£å¯†æ¨¡å—ï¼Œæä¾›å¯¹ç§°ã€éå¯¹ç§°å’Œæ‘˜è¦ç®—æ³•å°è£…</td></tr><tr><td>hutool-db</td><td>JDBCå°è£…åçš„æ•°æ®æ“ä½œï¼ŒåŸºäºActiveRecordæ€æƒ³</td></tr><tr><td>hutool-dfa</td><td>åŸºäºDFAæ¨¡å‹çš„å¤šå…³é”®å­—æŸ¥æ‰¾</td></tr><tr><td>hutool-extra</td><td>æ‰©å±•æ¨¡å—ï¼Œå¯¹ç¬¬ä¸‰æ–¹å°è£…ï¼ˆæ¨¡æ¿å¼•æ“ã€é‚®ä»¶ã€Servletã€äºŒç»´ç ã€Emojiã€FTPã€åˆ†è¯ç­‰ï¼‰</td></tr><tr><td>hutool-http</td><td>åŸºäºHttpUrlConnectionçš„Httpå®¢æˆ·ç«¯å°è£…</td></tr><tr><td>hutool-log</td><td>è‡ªåŠ¨è¯†åˆ«æ—¥å¿—å®ç°çš„æ—¥å¿—é—¨é¢</td></tr><tr><td>hutool-script</td><td>è„šæœ¬æ‰§è¡Œå°è£…ï¼Œä¾‹å¦‚Javascript</td></tr><tr><td>hutool-setting</td><td>åŠŸèƒ½æ›´å¼ºå¤§çš„Settingé…ç½®æ–‡ä»¶å’ŒPropertieså°è£…</td></tr><tr><td>hutool-system</td><td>ç³»ç»Ÿå‚æ•°è°ƒç”¨å°è£…ï¼ˆJVMä¿¡æ¯ç­‰ï¼‰</td></tr><tr><td>hutool-json</td><td>JSONå®ç°</td></tr><tr><td>hutool-captcha</td><td>å›¾ç‰‡éªŒè¯ç å®ç°</td></tr><tr><td>hutool-poi</td><td>é’ˆå¯¹POIä¸­Excelå’ŒWordçš„å°è£…</td></tr><tr><td>hutool-socket</td><td>åŸºäºJavaçš„NIOå’ŒAIOçš„Socketå°è£…</td></tr><tr><td>hutool-jwt</td><td>JSON Web Token (JWT)å°è£…å®ç°</td></tr></tbody></table><p>å¯ä»¥æ ¹æ®éœ€æ±‚å¯¹æ¯ä¸ªæ¨¡å—å•ç‹¬å¼•å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼•å…¥<code>hutool-all</code>æ–¹å¼å¼•å…¥æ‰€æœ‰æ¨¡å—ï¼Œæœ¬æ–‡æ‰€ä½¿ç”¨çš„æ•°æ®è„±æ•å·¥å…·å°±æ˜¯åœ¨hutool.coreæ¨¡å—ã€‚</p><h3 id="2-3-Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹">2.3 Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹</h3><p>ç°é˜¶æ®µæœ€æ–°ç‰ˆæœ¬çš„Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹å¦‚ä¸‹ï¼ŒåŸºæœ¬è¦†ç›–äº†å¸¸è§çš„æ•æ„Ÿä¿¡æ¯ã€‚</p><ol><li>ç”¨æˆ·id</li><li>ä¸­æ–‡å§“å</li><li>èº«ä»½è¯å·</li><li>åº§æœºå·</li><li>æ‰‹æœºå·</li><li>åœ°å€</li><li>ç”µå­é‚®ä»¶</li><li>å¯†ç </li><li>ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ã€æ–°èƒ½æºè½¦è¾†</li><li>é“¶è¡Œå¡</li></ol><h2 id="3-Hutoolæ•°æ®è„±æ•å®æ“">3. Hutoolæ•°æ®è„±æ•å®æ“</h2><h3 id="3-1-ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•">3.1 ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•</h3><p>Hutoolæä¾›çš„è„±æ•æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s3.bitiful.net/pb01/193.webp" alt="avatar"></p><p>æ³¨æ„ï¼šHutool è„±æ•æ˜¯é€šè¿‡*æ¥ä»£æ›¿æ•æ„Ÿä¿¡æ¯çš„ï¼Œå…·ä½“å®ç°æ˜¯åœ¨StrUtil.hideæ–¹æ³•ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰éšè—ç¬¦å·ï¼Œåˆ™å¯ä»¥æŠŠHutoolçš„æºç æ‹·å‡ºæ¥ï¼Œé‡æ–°å®ç°å³å¯ã€‚</p><p>è¿™é‡Œä»¥æ‰‹æœºå·ã€é“¶è¡Œå¡å·ã€èº«ä»½è¯å·ã€å¯†ç ä¿¡æ¯çš„è„±æ•ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å¯¹åº”çš„æµ‹è¯•ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.DesensitizedUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Hutoolå®ç°æ•°æ®è„±æ•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuToolDesensitizationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPhoneDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String phone=<span class="string">&quot;13723231234&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.mobilePhone(phone)); <span class="comment">//è¾“å‡ºï¼š137****1234</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBankCardDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String bankCard=<span class="string">&quot;6217000130008255666&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.bankCard(bankCard)); <span class="comment">//è¾“å‡ºï¼š6217 **** **** *** 5666</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIdCardNumDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String idCardNum=<span class="string">&quot;411021199901102321&quot;</span>;</span><br><span class="line">        <span class="comment">//åªæ˜¾ç¤ºå‰4ä½å’Œå2ä½</span></span><br><span class="line">        System.out.println(DesensitizedUtil.idCardNum(idCardNum,<span class="number">4</span>,<span class="number">2</span>)); <span class="comment">//è¾“å‡ºï¼š4110************21</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPasswordDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String password=<span class="string">&quot;www.jd.com_35711&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.password(password)); <span class="comment">//è¾“å‡ºï¼š****************</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨Hutoolå°è£…å¥½çš„å·¥å…·ç±»å®ç°æ•°æ®è„±æ•ã€‚</p><h3 id="3-2-é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•">3.2 é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•</h3><p>ç°åœ¨æœ‰äº†æ•°æ®è„±æ•å·¥å…·ç±»ï¼Œå¦‚æœå‰ç«¯éœ€è¦æ˜¾ç¤ºæ•°æ®æ•°æ®çš„åœ°æ–¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨æ¯ä¸ªåœ°æ–¹éƒ½è°ƒç”¨ä¸€ä¸ªå·¥å…·ç±»ï¼Œè¿™æ ·å°±æ˜¾å¾—ä»£ç å¤ªå†—ä½™äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•é€šè¿‡æ³¨è§£çš„æ–¹å¼ä¼˜é›…çš„å®Œæˆæ•°æ®è„±æ•å‘¢ï¼Ÿ</p><p>å¦‚æœé¡¹ç›®æ˜¯åŸºäºspringbootçš„webé¡¹ç›®ï¼Œåˆ™å¯ä»¥åˆ©ç”¨springbootè‡ªå¸¦çš„jacksonè‡ªå®šä¹‰åºåˆ—åŒ–å®ç°ã€‚å®ƒçš„å®ç°åŸæ¥å…¶å®å°±æ˜¯åœ¨jsonè¿›è¡Œåºåˆ—åŒ–æ¸²æŸ“ç»™å‰ç«¯æ—¶ï¼Œè¿›è¡Œè„±æ•ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼šè„±æ•ç­–ç•¥çš„æšä¸¾ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:è„±æ•ç­–ç•¥æšä¸¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DesensitizationTypeEnum</span> &#123;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰</span></span><br><span class="line">    MY_RULE,</span><br><span class="line">    <span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">    USER_ID,</span><br><span class="line">    <span class="comment">//ä¸­æ–‡å</span></span><br><span class="line">    CHINESE_NAME,</span><br><span class="line">    <span class="comment">//èº«ä»½è¯å·</span></span><br><span class="line">    ID_CARD,</span><br><span class="line">    <span class="comment">//åº§æœºå·</span></span><br><span class="line">    FIXED_PHONE,</span><br><span class="line">    <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    MOBILE_PHONE,</span><br><span class="line">    <span class="comment">//åœ°å€</span></span><br><span class="line">    ADDRESS,</span><br><span class="line">    <span class="comment">//ç”µå­é‚®ä»¶</span></span><br><span class="line">    EMAIL,</span><br><span class="line">    <span class="comment">//å¯†ç </span></span><br><span class="line">    PASSWORD,</span><br><span class="line">    <span class="comment">//ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ã€æ–°èƒ½æºè½¦è¾†</span></span><br><span class="line">    CAR_LICENSE,</span><br><span class="line">    <span class="comment">//é“¶è¡Œå¡</span></span><br><span class="line">    BANK_CARD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¡¨ç¤ºæ”¯æŒçš„è„±æ•ç±»å‹ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºè„±æ•çš„ Desensitization æ³¨è§£ã€‚</strong></p><ul><li>@Retention(RetentionPolicy.RUNTIME)ï¼šè¿è¡Œæ—¶ç”Ÿæ•ˆã€‚</li><li>@Target(ElementType.FIELD)ï¼šå¯ç”¨åœ¨å­—æ®µä¸Šã€‚</li><li>@JacksonAnnotationsInsideï¼šæ­¤æ³¨è§£å¯ä»¥ç‚¹è¿›å»çœ‹ä¸€ä¸‹æ˜¯ä¸€ä¸ªå…ƒæ³¨è§£ï¼Œä¸»è¦æ˜¯ç”¨æˆ·æ‰“åŒ…å…¶ä»–æ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚</li><li>@JsonSerializeï¼šä¸Šé¢è¯´åˆ°è¿‡ï¼Œè¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯å¯è‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œå¯ä»¥ç”¨åœ¨æ³¨è§£ä¸Šï¼Œæ–¹æ³•ä¸Šï¼Œå­—æ®µä¸Šï¼Œç±»ä¸Šï¼Œè¿è¡Œæ—¶ç”Ÿæ•ˆç­‰ç­‰ï¼Œæ ¹æ®æä¾›çš„åºåˆ—åŒ–ç±»é‡Œé¢çš„é‡å†™æ–¹æ³•å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonSerialize(using = DesensitizationSerialize.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Desensitization &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•æ•°æ®ç±»å‹ï¼Œåœ¨MY_RULEçš„æ—¶å€™ï¼ŒstartIncludeå’ŒendExcludeç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DesensitizationTypeEnum <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> DesensitizationTypeEnum.MY_RULE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•å¼€å§‹ä½ç½®ï¼ˆåŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">startInclude</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•ç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">endExclude</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šåªæœ‰ä½¿ç”¨äº†è‡ªå®šä¹‰çš„è„±æ•æšä¸¾MY_RULEçš„æ—¶å€™ï¼Œå¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®æ‰ç”Ÿæ•ˆã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºè‡ªå®šçš„åºåˆ—åŒ–ç±»</strong></p><p>è¿™ä¸€æ­¥æ˜¯æˆ‘ä»¬å®ç°æ•°æ®è„±æ•çš„å…³é”®ã€‚è‡ªå®šä¹‰åºåˆ—åŒ–ç±»ç»§æ‰¿ JsonSerializerï¼Œå®ç°ContextualSerializeræ¥å£ï¼Œå¹¶é‡å†™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰åºåˆ—åŒ–ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesensitizationSerialize</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;String&gt; <span class="keyword">implements</span> <span class="title class_">ContextualSerializer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DesensitizationTypeEnum type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer startInclude;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer endExclude;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(String str, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰ç±»å‹è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> MY_RULE:</span><br><span class="line">                jsonGenerator.writeString(CharSequenceUtil.hide(str, startInclude, endExclude));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// userIdè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> USER_ID:</span><br><span class="line">                jsonGenerator.writeString(String.valueOf(DesensitizedUtil.userId()));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// ä¸­æ–‡å§“åè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> CHINESE_NAME:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.chineseName(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// èº«ä»½è¯è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> ID_CARD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.idCardNum(String.valueOf(str), <span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å›ºå®šç”µè¯è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> FIXED_PHONE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.fixedPhone(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// æ‰‹æœºå·è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> MOBILE_PHONE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.mobilePhone(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// åœ°å€è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> ADDRESS:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.address(String.valueOf(str), <span class="number">8</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// é‚®ç®±è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> EMAIL:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.email(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å¯†ç è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> PASSWORD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.password(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// ä¸­å›½è½¦ç‰Œè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> CAR_LICENSE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.carLicense(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// é“¶è¡Œå¡è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> BANK_CARD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.bankCard(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JsonSerializer&lt;?&gt; createContextual(SerializerProvider serializerProvider, BeanProperty beanProperty) <span class="keyword">throws</span> JsonMappingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (beanProperty != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ•°æ®ç±»å‹æ˜¯å¦ä¸ºStringç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123;</span><br><span class="line">                <span class="comment">// è·å–å®šä¹‰çš„æ³¨è§£</span></span><br><span class="line">                <span class="type">Desensitization</span> <span class="variable">desensitization</span> <span class="operator">=</span> beanProperty.getAnnotation(Desensitization.class);</span><br><span class="line">                <span class="comment">// ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization == <span class="literal">null</span>) &#123;</span><br><span class="line">                    desensitization = beanProperty.getContextAnnotation(Desensitization.class);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¸ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// åˆ›å»ºå®šä¹‰çš„åºåˆ—åŒ–ç±»çš„å®ä¾‹å¹¶ä¸”è¿”å›ï¼Œå…¥å‚ä¸ºæ³¨è§£å®šä¹‰çš„type,å¼€å§‹ä½ç½®ï¼Œç»“æŸä½ç½®ã€‚</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DesensitizationSerialize</span>(desensitization.type(), desensitization.startInclude(),</span><br><span class="line">                            desensitization.endExclude());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> serializerProvider.findValueSerializer(beanProperty.getType(), beanProperty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> serializerProvider.findNullValueSerializer(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šè¿°ä¸‰æ­¥ï¼Œå·²ç»å®Œæˆäº†é€šè¿‡æ³¨è§£å®ç°æ•°æ®è„±æ•äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¦æµ‹è¯•çš„pojoï¼Œå¯¹åº”çš„å­—æ®µåŠ å…¥è¦è„±æ•çš„ç­–ç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPojo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.MOBILE_PHONE)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.PASSWORD)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.MY_RULE, startInclude = 0, endExclude = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†™ä¸€ä¸ªæµ‹è¯•çš„controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestPojo <span class="title function_">testDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">TestPojo</span> <span class="variable">testPojo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestPojo</span>();</span><br><span class="line">        testPojo.setUserName(<span class="string">&quot;æˆ‘æ˜¯ç”¨æˆ·å&quot;</span>);</span><br><span class="line">        testPojo.setAddress(<span class="string">&quot;åœ°çƒä¸­å›½-åŒ—äº¬å¸‚é€šå·åŒºäº¬ä¸œæ€»éƒ¨2å·æ¥¼&quot;</span>);</span><br><span class="line">        testPojo.setPhone(<span class="string">&quot;13782946666&quot;</span>);</span><br><span class="line">        testPojo.setPassword(<span class="string">&quot;sunyangwei123123123.&quot;</span>);</span><br><span class="line">        System.out.println(testPojo);</span><br><span class="line">        <span class="keyword">return</span> testPojo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s3.bitiful.net/pb01/194.webp" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå®ç°äº†æ•°æ®è„±æ•ã€‚</p><h2 id="4-å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è">4. å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è</h2><p>é™¤äº†æœ¬æ–‡ä»‹ç»çš„Hutoolå·¥å…·ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ•°æ®è„±æ•å·¥å…·ï¼Œå¸¸è§è„±æ•æ–¹æ³•æˆ–å·¥å…·å¦‚ä¸‹æ‰€ç¤ºï¼š</p><h3 id="4-1-Apache-ShardingSphere">4.1 Apache ShardingSphere</h3><p>Apache ShardingSphereä¸‹é¢å­˜åœ¨ä¸€ä¸ªæ•°æ®è„±æ•æ¨¡å—ï¼Œæ­¤æ¨¡å—é›†æˆçš„å¸¸ç”¨çš„æ•°æ®è„±æ•çš„åŠŸèƒ½ã€‚å…¶åŸºæœ¬åŸç†æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„SQLè¿›è¡Œè§£ææ‹¦æˆªï¼Œå¹¶ä¾é ç”¨æˆ·çš„è„±æ•é…ç½®è¿›è¡ŒSQLçš„æ”¹å†™ï¼Œä»è€Œå®ç°å¯¹åŸæ–‡å­—æ®µçš„åŠ å¯†åŠåŠ å¯†å­—æ®µçš„è§£å¯†ã€‚æœ€ç»ˆå®ç°å¯¹ç”¨æˆ·æ— æ„Ÿçš„åŠ è§£å¯†å­˜å‚¨ã€æŸ¥è¯¢ã€‚</p><p>å…·ä½“å®ç°æ–¹å¼å¯å‚è€ƒä¸‹é¢æ–‡ç« ï¼š <a href="https://jaskey.github.io/blog/2020/03/18/sharding-sphere-data-desensitization/">https://jaskey.github.io/blog/2020/03/18/sharding-sphere-data-desensitization/</a></p><h3 id="4-2-FastJSON">4.2 FastJSON</h3><p>å¹³æ—¶å¼€å‘Webé¡¹ç›®çš„æ—¶å€™ï¼Œé™¤äº†é»˜è®¤çš„Springè‡ªå¸¦çš„åºåˆ—åŒ–å·¥å…·ï¼ŒFastJsonä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„Spring web Restfulæ¥å£åºåˆ—åŒ–çš„å·¥å…·ã€‚</p><p>FastJSONå®ç°æ•°æ®è„±æ•çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>åŸºäºæ³¨è§£@JSONFieldå®ç°ï¼šéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç”¨äºè„±æ•çš„åºåˆ—åŒ–çš„ç±»ï¼Œç„¶ååœ¨éœ€è¦è„±æ•çš„å­—æ®µä¸Šé€šè¿‡@JSONFieldä¸­çš„serializeUsing æŒ‡å®šä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„åºåˆ—åŒ–ç±»å‹å³å¯ã€‚</li><li>åŸºäºåºåˆ—åŒ–è¿‡æ»¤å™¨ï¼šéœ€è¦å®ç°ValueFilteræ¥å£ï¼Œé‡å†™processæ–¹æ³•å®Œæˆè‡ªå®šä¹‰è„±æ•ï¼Œç„¶ååœ¨JSONè½¬æ¢æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„è½¬æ¢ç­–ç•¥ã€‚å…·ä½“å®ç°å¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š <a href="https://juejin.cn/post/7067916686141161479">https://juejin.cn/post/7067916686141161479</a></li></ul><h3 id="4-3-Mybatis-mate">4.3 Mybatis-mate</h3><p>mybatisplusä¹Ÿæä¾›äº†æ•°æ®è„±æ•æ¨¡å—ï¼Œmybatis-mateï¼Œä¸è¿‡åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦é…ç½®æˆæƒç ã€‚</p><p>é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\# Mybatis Mate é…ç½®</span><br><span class="line">mybatis-mate:</span><br><span class="line">  cert:</span><br><span class="line">    grant: jxftsdfggggx</span><br><span class="line">    license: GKXP9r4MCJhGID/DTGigcBcLmZjb1YZGjE4GXaAoxbtGsPC20sxpEtiUr2F7Nb1ANTUekvF6Syo6DzraA4M4oacwoLVTglzfvaEfadfsd232485eLJK1QsskrSJmreMnEaNh9lsV7Lpbxy9JeGCeM0HPEbRvq8Y+8dUt5bQYLklsa3ZIBexir+4XykZY15uqn1pYIp4pEK0+aINTa57xjJNoWuBIqm7BdFIb4l1TAcPYMTsMXhF5hfMmKD2h391HxWTshJ6jbt4YqdKD167AgeoM+B+DE1jxlLjcpskY+kFs9piOS7RCcmKBBUOgX2BD/JxhR2gQ==</span><br></pre></td></tr></table></figure><p>å…·ä½“å®ç°å¯å‚è€ƒbaomidouæä¾›çš„å¦‚ä¸‹ä»£ç ï¼š <a href="https://gitee.com/baomidou/mybatis-mate-examples">https://gitee.com/baomidou/mybatis-mate-examples</a></p><h2 id="5-æ€»ç»“">5. æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†æ•°æ®è„±æ•çš„ç›¸å…³å†…å®¹ï¼Œé¦–å…ˆä»‹ç»äº†æ•°æ®è„±æ•çš„æ¦‚å¿µï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†å¸¸ç”¨çš„æ•°æ®è„±æ•è§„åˆ™ï¼›éšåä»‹ç»äº†æœ¬æ–‡çš„é‡ç‚¹Hutoolå·¥å…·åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å®æ“ï¼Œåˆ†åˆ«æ¼”ç¤ºäº†ä½¿ç”¨DesensitizedUtilå·¥å…·ç±»ã€é…åˆJacksoné€šè¿‡æ³¨è§£çš„æ–¹å¼å®Œæˆæ•°æ®è„±æ•ï¼›æœ€åï¼Œä»‹ç»äº†ä¸€äº›å¸¸è§çš„æ•°æ®è„±æ•æ–¹æ³•ï¼Œå¹¶é™„ä¸Šäº†å¯¹åº”çš„æ•™ç¨‹é“¾æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œæœ¬æ–‡å†…å®¹å¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¿˜è¯·å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p><h2 id="6-å‚è€ƒå†…å®¹">6. å‚è€ƒå†…å®¹</h2><p>Hutoolå·¥å…·å®˜ç½‘ï¼š <a href="https://hutool.cn/docs/#/?id=%f0%9f%93%9a%e7%ae%80%e4%bb%8b">https://hutool.cn/docs/#/?id=%f0%9f%93%9a%e7%ae%80%e4%bb%8b</a></p><p>èŠèŠå¦‚ä½•è‡ªå®šä¹‰æ•°æ®è„±æ•ï¼š <a href="https://juejin.cn/post/7046567603971719204">https://juejin.cn/post/7046567603971719204</a></p><p>FastJSONå®ç°æ•°æ®è„±æ•ï¼š <a href="https://juejin.cn/post/7067916686141161479">https://juejin.cn/post/7067916686141161479</a></p><blockquote><p>ä½œè€…ï¼šäº¬ä¸œç§‘æŠ€ å­™æ‰¬å¨</p><p>æ¥æºï¼šäº¬ä¸œäº‘å¼€å‘è€…ç¤¾åŒº</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> è½¬è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“è¿æ¥æ± </title>
      <link href="/2024/02/16/2024-2-16-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/"/>
      <url>/2024/02/16/2024-2-16-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="æ•°æ®åº“è¿æ¥æ± ">æ•°æ®åº“è¿æ¥æ± </h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± ">ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± </h3><p>å½“ä¸€ä¸ªæ•°æ®åº“æ“ä½œä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç¨‹åºéœ€è¦å’Œæ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ã€æ•°æ®åº“ç”¨æˆ·éªŒè¯ï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥ï¼Œæœ€åç”¨æˆ·é€€å‡ºã€å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥ã€‚æ¯æ¬¡ä»»åŠ¡éƒ½æ‰§è¡Œè¿™æ ·çš„æµç¨‹ï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹ä¸­ï¼ŒçœŸæ­£æœ‰æ•ˆè€Œä¸”å˜åŒ–çš„åªæœ‰<code>æ‰§è¡ŒSQL</code>è¯­å¥è¿™ä¸€æ­¥éª¤ï¼Œè€Œä¸”æ¯æ¬¡å»ºç«‹è¿æ¥ã€ç”¨æˆ·éªŒè¯ã€å…³é—­è¿æ¥éƒ½è€—è´¹æ—¶é—´ã€‚</p><p>å› æ­¤ï¼Œè€ƒè™‘èƒ½ä¸èƒ½å°†è¿æ¥åªåˆ›å»ºä¸€æ¬¡ï¼Œç„¶åå¤ç”¨é•¿è¿æ¥æ‰§è¡Œ SQL è¯­å¥å‘¢ï¼Ÿè¿™éœ€è¦<strong>æ± åŒ–æŠ€æœ¯</strong>ã€‚</p><p>æ± åŒ–æŠ€æœ¯å¯ä»¥å‡å°‘èµ„æºå¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Œæé«˜ç¨‹åºçš„å“åº”æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½æå‡éå¸¸æ˜æ˜¾ã€‚<br>é€‚åˆä½¿ç”¨æ± åŒ–æŠ€æœ¯ç¼“å­˜çš„èµ„æºå¯¹è±¡å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¯¹è±¡åˆ›å»ºæ—¶é—´é•¿</li><li>å¯¹è±¡å ç”¨èµ„æºå¤š</li><li>å¯¹è±¡åˆ›å»ºåå¯ä»¥é‡å¤ä½¿ç”¨</li></ul><h3 id="æ•°æ®åº“è¿æ¥æ± -2">æ•°æ®åº“è¿æ¥æ± </h3><p>æ•°æ®åº“è¿æ¥æ± æ˜¯ç¨‹åºå¯åŠ¨æ—¶å»ºç«‹ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†è¿™äº›è¿æ¥ç»„æˆä¸€ä¸ªè¿æ¥æ± ï¼Œå½“ç¨‹åºéœ€è¦ç”¨åˆ°è¿æ¥å»è¿›è¡Œæ•°æ®åº“æ“ä½œçš„æ—¶å€™,ç›´æ¥ä»è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªè¿æ¥å¯¹è±¡ä½¿ç”¨ï¼Œä½¿ç”¨å®Œæ¯•åï¼Œå°†è¿æ¥å¯¹è±¡å½’è¿˜ç»™è¿æ¥æ± ã€‚</p><p><strong>ä¼˜ç‚¹</strong>:<br>ï¼ˆ1ï¼‰èµ„æºå¤ç”¨ã€‚é¿å…äº†é¢‘ç¹çš„åˆ›å»ºã€é‡Šæ”¾è¿æ¥å¼•èµ·çš„æ€§èƒ½å¼€é”€ï¼Œå‡å°‘ç³»ç»Ÿæ¶ˆè€—ï¼Œå¢è¿›ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„ç¨³å®šï¼ˆå‡å°‘å†…å­˜ç¢ç‰‡å’Œæ•°æ®åº“ä¸´æ—¶çº¿ç¨‹/è¿›ç¨‹æ•°é‡ï¼‰ã€‚<br>ï¼ˆ2ï¼‰æ›´å¿«çš„ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–å®Œæˆåï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†ä»æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„å¼€é”€ï¼Œä»è€Œç¼©å‡äº†ç³»ç»Ÿæ•´ä½“å“åº”æ—¶é—´ã€‚<br>ï¼ˆ3ï¼‰ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼ã€‚æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„è¿æ¥å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶æ”¶å›è¢«å ç”¨è¿æ¥ã€‚ä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„éœ²ã€‚</p><h4 id="å…³é”®å‚æ•°-ä»¥HikariCPä¸ºä¾‹">å…³é”®å‚æ•°(ä»¥HikariCPä¸ºä¾‹)</h4><ol><li><code>connectionTimeout</code>ï¼šå®¢æˆ·ç«¯ç­‰å¾…æ± ä¸­è¿æ¥çš„æœ€å¤§äº‹ä»¶ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åˆ™ä¼šæŠ›å‡º SQLExceptionï¼Œæœ€ä½å¯æ¥å—æ—¶é—´ä¸º 250msï¼Œé»˜è®¤å€¼ä¸º30000ms</li><li><code>maximumPoolSize</code>ï¼šè¿æ¥æ± ä¸­çš„æœ€å¤§è¿æ¥æ•°ã€‚é»˜è®¤ä¸º 10</li><li><code>minimumIdle</code>ï¼šæ§åˆ¶ HikariCP ä¸­ç»´æŠ¤çš„æœ€å°ç©ºé—²è¿æ¥æ•°ã€‚å½“ç©ºé—²è¿æ¥æ•°å°äº minimumIdle å¹¶ä¸”æ± ä¸­çš„æ€»è¿æ¥æ•°å°‘äº maximumPoolSize æ—¶ï¼ŒHikariCP å°†æ·»åŠ å…¶ä»–è¿æ¥ç›´åˆ° maximumPoolSizeã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œå¯¹å³°å€¼éœ€æ±‚çš„å“åº”èƒ½åŠ›å»ºè®®ä¸è¦è®¾ç½®æ­¤å€¼ã€‚ é»˜è®¤å€¼ä¸ maximumPoolSize ç›¸åŒ</li><li><code>idleTimeout</code>ï¼šæ± ä¸­è¿æ¥ä¿æŒç©ºé—²çŠ¶æ€çš„æœ€é•¿æ—¶é—´ï¼Œåªæœ‰åœ¨å®šä¹‰çš„minimumIdle å°äºmaximumPoolSizeæ—¶ç”Ÿæ•ˆï¼Œå…è®¸çš„æœ€å°æ—¶é—´ä¸º 10000ms,é»˜è®¤ä¸º 600000ms.å½“ä½ é…ç½®äº†minimumIdle ä¸”å®ƒçš„å€¼è¿˜å’ŒmaximumPoolSizeä¸åŒçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºå‘Šè¯‰HikariCPï¼Œä½ è‡³å°‘å¾—ç»™æˆ‘åˆ›å»ºminimumIdle å¤šçš„è¿æ¥å¤‡ç€ã€‚ä½†æ˜¯å½“ä½ çš„ç³»ç»Ÿå¿™çš„æŠŠminimumIdle ä¸ªå¤‡ç€çš„è¿æ¥éƒ½æ‹¿èµ°ä½¿ç”¨æ—¶ï¼Œæ­¤æ—¶å†é—®HikariCPç´¢è¦ï¼Œå®ƒå°±å¾—ç»™ä½ åˆ›å»ºå¤šäºminimumIdle çš„è¿æ¥ï¼Œé™¤éæœ‰è¿æ¥è¿˜å›æ¥ï¼Œå¦åˆ™æˆ‘å°±å¾—ä¸€ç›´ç»™ä½ åˆ›å»ºæ–°çš„ï¼Œç›´åˆ°è¾¾åˆ°ä¸Šé™â€”â€”maximumPoolSizeã€‚ä½†æ˜¯ï¼Œå½“ä½ çš„ç³»ç»Ÿè¿‡äº†å¿™ç¢ŒæœŸï¼Œé—²ä¸‹æ¥çš„æ—¶å€™ï¼Œå¤šåˆ›å»ºå‡ºæ¥çš„é‚£äº›è¿æ¥ï¼ŒHikariCPå°±å¾—æŠ½ç©ºç»™å¹²æ‰ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¿ç•™minimumIdle ä¸ªå°±å¥½äº†ï¼Œå¤šäº†æµªè´¹ã€‚æ­¤æ—¶è¿™ä¸ªidleTimeoutå‚æ•°å°±æœ‰ç”¨äº†ï¼Œå®ƒå°±æ˜¯ç”¨æ¥å‘Šè¯‰HikariCPï¼Œå¤šå‡ºæ¥çš„è¿™äº›è¿æ¥ï¼Œå¤šé•¿æ—¶é—´æ²¡å†è¢«ä½¿ç”¨ï¼Œä½ å°±å¯ä»¥å¹²æ‰äº†ã€‚</li><li><code>connectionTestQuery</code>: ç”¨æ¥æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨çš„ SQL æŸ¥è¯¢ï¼ŒHikariCP é»˜è®¤ä¼šä½¿ç”¨ <code>SELECT 1</code> è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœè®¾ç½®ä¸ºnullï¼Œåˆ™ä¸ä¼šè¿›è¡Œæµ‹è¯•ã€‚</li><li><code>maxLifetime</code>: <strong>æœ€æœ‰å¯èƒ½å‡ºç°å‘çš„å‚æ•°</strong>.æ± ä¸­è¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º1800000msï¼Œå³30åˆ†é’Ÿã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºå­˜æ´»æ—¶é—´æ— é™å¤§ã€‚å¦‚æœä¸ç­‰äº0ä¸”å°äº30ç§’åˆ™ä¼šè¢«é‡ç½®å›30åˆ†é’Ÿã€‚å¦‚æœè®¾ç½®äº†maxLifetimeï¼Œåˆ™HikariCPç»™æ± ä¸­åˆ›å»ºçš„æ¯ä¸ªè¿æ¥ï¼Œéƒ½ä¼šå®šæ—¶æ£€æµ‹ï¼Œä¸ç®¡è¿™ä¸ªè¿æ¥ä¸Šä¸€æ¬¡æ˜¯ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„ï¼Œåªè¦åœ¨æ£€æµ‹æ—¶å®ƒæ²¡åœ¨ä½¿ç”¨ä¸­ï¼Œå°±ä¼šè¢«æ·˜æ±°ã€‚æ³¨æ„ï¼Œè¿™å°±æ˜¯maxLifetimeå‚æ•°éš¾ä»¥è¢«ç†è§£çš„åŸå› â€”â€”å“ªæ€•æ˜¯ä¸€ä¸ªåˆšç”¨å®Œå½’è¿˜çš„è¿æ¥ï¼Œä¸å¹¸ç¢°å·§èµ¶ä¸Šæ£€æµ‹äº†ï¼Œåªèƒ½è¯´æ°¸åˆ«â€”â€”ä½¿å¾—è¿™ä¸ªå‚æ•°èƒŒåçš„é€»è¾‘æ˜¾å¾—éå¸¸ä¸åˆç†ã€‚ä½†ç»è¿‡æœç´¢,<code>ä½œè€…çš„æƒ³æ³•æ˜¯</code>:ä¸€ä¸ªè¿æ¥å³ä½¿ä¸€ç›´èƒ½ç”¨ï¼Œä¹Ÿä¸åº”è¯¥ä¸€ç›´å­˜åœ¨ä¸‹å»ï¼Œåº”è¯¥å®šæ—¶çš„å…³é—­ï¼ˆå“ªæ€•ä¸€å¤©å…³ä¸€æ¬¡ï¼‰ï¼Œå¥½è®©æ•°æ®åº“æœåŠ¡å™¨é‚£è¾¹æ¸…ç†æ‰ä¸€äº›æµªè´¹çš„èµ„æºã€‚æ‰€ä»¥è¿™æ‰æ˜¯maxLifetimeæœ€æ ¹æœ¬å­˜åœ¨çš„åŸå› ã€‚</li></ol><h4 id="è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚">è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚</h4><ol><li>ç»éªŒå…¬å¼ï¼Œè¿æ¥æ•°=ï¼ˆæ ¸å¿ƒæ•°*2ï¼‰+æœ‰æ•ˆç£ç›˜æ•°ã€‚</li></ol><p>å‡å¦‚æœåŠ¡å™¨CPUæ˜¯i7çš„8æ ¸ï¼Œé‚£ä¹ˆè¿æ¥æ± è¿æ¥æ•°å¤§å°ä¸º 8âˆ—2+1=9 ã€‚è¿™ä»…ä»…æ˜¯ä¸€ä¸ªç»éªŒå…¬å¼ï¼Œå…·ä½“çš„è¿˜è¦å’Œçº¿ç¨‹æ± æ•°é‡ä»¥åŠå…·ä½“ä¸šåŠ¡ç»“åˆåœ¨ä¸€èµ·ã€‚</p><ol start="2"><li>IOå¯†é›†å‹ä»»åŠ¡</li></ol><p>å¦‚æœä»»åŠ¡æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªIOå¯†é›†å‹çš„ä»»åŠ¡ã€‚åœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼ˆå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼‰ï¼Œæ€»å…±è€—æ—¶100+5=105msï¼Œè€Œå…¶ä¸­åªæœ‰5msæ˜¯ç”¨äºè®¡ç®—æ“ä½œçš„ï¼ˆæ¶ˆè€—cpuï¼‰ï¼Œå¦å¤–çš„100msç­‰å¾…ioå“åº”ï¼ŒCPUåˆ©ç”¨ç‡ä¸º5/(100+5)ã€‚</p><p>ä½¿ç”¨çº¿ç¨‹æ± æ˜¯ä¸ºäº†å°½é‡æé«˜CPUçš„åˆ©ç”¨ç‡ï¼Œå‡å°‘å¯¹CPUèµ„æºçš„æµªè´¹ï¼Œå‡è®¾ä»¥100%çš„CPUåˆ©ç”¨ç‡æ¥è¯´ï¼Œè¦è¾¾åˆ°100%çš„CPUåˆ©ç”¨ç‡ï¼Œå¯¹äºä¸€ä¸ªCPUå°±è¦è®¾ç½®å…¶åˆ©ç”¨ç‡çš„å€’æ•°ä¸ªæ•°çš„çº¿ç¨‹æ•°ï¼Œä¹Ÿå³1/(5/(100+5))=21ï¼Œ4ä¸ªCPUçš„è¯å°±ä¹˜ä»¥4ï¼Œå³84ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹æ± è¦è®¾ç½®84ä¸ªçº¿ç¨‹æ•°ï¼Œç„¶åè¿æ¥æ± ä¹Ÿæ˜¯è®¾ç½®ä¸º84ä¸ªè¿æ¥ã€‚</p><h4 id="è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«">è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«</h4><ul><li><p>é•¿è¿æ¥æ˜¯ä¸€äº›é©±åŠ¨ã€é©±åŠ¨æ¶æ„ã€ORM(å³Object-Relational Mapping)å·¥å…·çš„ç‰¹æ€§ï¼Œç”±é©±åŠ¨æ¥ä¿æŒè¿æ¥å¥æŸ„çš„æ‰“å¼€ï¼Œä»¥ä¾¿åç»­çš„æ•°æ®åº“æ“ä½œå¯ä»¥é‡ç”¨è¿æ¥ï¼Œä»è€Œå‡å°‘æ•°æ®åº“çš„è¿æ¥å¼€é”€ã€‚</p></li><li><p>è¿æ¥æ± æ˜¯åº”ç”¨æœåŠ¡å™¨çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥é€šè¿‡å‚æ•°æ¥é…ç½®è¿æ¥æ•°ã€è¿æ¥æ£€æŸ¥ã€è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚</p></li><li><p>è¿æ¥æ± å†…çš„è¿æ¥ï¼Œå…¶å®å°±æ˜¯é•¿è¿æ¥ã€‚</p></li></ul><h3 id="å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± ">å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± </h3><p>å®ç°ä¸€ä¸ªè¿æ¥æ± ï¼Œæœ€å…³é”®çš„æ˜¯<strong>å‡è¡¡</strong>å’Œ<strong>ä¿æ´»</strong>.è¿æ¥æ± çš„â€œæ± â€é€šè¿‡é˜Ÿåˆ—æ•°æ®ç»“æ„è¿›è¡Œå®ç°ï¼Œé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ä¿è¯äº†ä½¿ç”¨è¿æ¥çš„å‡è¡¡æ€§ï¼Œæ¯ä¸€æ¡è¿æ¥éƒ½å¯ä»¥å‡åŒ€çš„è¢«ä½¿ç”¨åˆ°.è¿æ¥æ± å¯¹å¤–æä¾›get()å’Œfree()ä¸¤ä¸ªAPIï¼Œget()ç”¨äºä»é˜Ÿé¦–â€œå‡ºé˜Ÿâ€è·å–ä¸€æ¡å¯ç”¨è¿æ¥ï¼Œfree()ç”¨äºå°†ä½¿ç”¨å®Œçš„è¿æ¥ä»å¯¹å°¾â€œå…¥é˜Ÿâ€é‡Šæ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>ä¸šåŠ¡ä»£ç åœ¨ä½å³°æ—¶ä¼šé™ä½get()åŠ¨ä½œï¼Œæ‰€ä»¥è¿æ¥æ± ä¸­çš„è¿æ¥åœ¨é•¿æ—¶é—´ä¸ç”¨æ—¶ä¼šå¯¼è‡´å¤±æ•ˆï¼Œæ­¤æ—¶ä¿æ´»çº¿ç¨‹åœ¨ç›‘æµ‹åˆ°get()çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½æ—¶ï¼Œä¼šæ¨¡æ‹Ÿä¸šåŠ¡ç¨‹åºè°ƒç”¨get()è·å–è¿æ¥åå‘é€å¿ƒè·³åŒ…ï¼Œç„¶åå†é€šè¿‡free()å°†è¢«ä¿æ´»çš„è¿æ¥æ”¾å›é˜Ÿåˆ—ä¸­ï¼Œè¾¾åˆ°è¿æ¥æ± ä¸­æ‰€æœ‰è¿æ¥ä¿æ´»çš„ç›®çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾èµ›Cé¢˜å­¦ä¹ </title>
      <link href="/2024/01/24/2024-1-MCM/"/>
      <url>/2024/01/24/2024-1-MCM/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ç¾èµ›Cé¢˜å­¦ä¹ ">ç¾èµ›Cé¢˜å­¦ä¹ </h2><p>å¦‚æœè‡ªå»ºæ¨¡å‹,å¯ä»¥å‚è€ƒ2218931çš„4.2.1,2218931çš„è®ºæ–‡æè¿°å€¼å¾—å­¦ä¹ ,æœ€åçš„ä¿¡ä¹Ÿæ¯”è¾ƒæœ‰ç‰¹è‰²</p><p>è·Ÿç°å®ç›¸ç»“åˆä¹Ÿæ˜¯å¾ˆé‡è¦çš„ç‚¹,æœ€å¥½èƒ½æœ‰æ¡ˆä¾‹æ”¯æ’‘,è™½ç„¶è¯´åœ¨Cé¢˜ä¸­ä¸å¸¸è§,ä½†å…¶å®æœ‰çš„åœ°æ–¹ä¹Ÿå¯ä»¥åŠ ä¸Š</p><h3 id="æ—¶é—´åºåˆ—é¢„æµ‹">æ—¶é—´åºåˆ—é¢„æµ‹</h3><p>å¯ä»¥å…³æ³¨ä¸€äº›ç‰¹æ®Šçš„æ—¶é—´èŠ‚ç‚¹ï¼Œæ¯”å¦‚èŠ‚å‡æ—¥ï¼Œå­£èŠ‚æ€§ï¼ŒèŠ‚å‡æ—¥å’Œå­£èŠ‚æ€§éƒ½æœ‰å¯èƒ½å½±å“æ—¶é—´åºåˆ—çš„é¢„æµ‹ã€‚</p><ul><li><p>ARIMA:ç»å…¸æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ï¼Œä½¿ç”¨è‡ªå›å½’ç§¯åˆ†ç§»åŠ¨å¹³å‡æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å¯ä»¥å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå¹³æ»‘å¤„ç†,å¯ä»¥å‚è€ƒä¸‹2203120çš„å†™æ³•ã€‚</p></li><li><p>GRU:æ—¶é—´åºåˆ—é¢„æµ‹,å’ŒLSTMç±»ä¼¼ï¼Œä½†æ˜¯GRUçš„æ›´æ–°é—¨å’Œé—å¿˜é—¨åˆå¹¶ä¸ºæ›´æ–°é—¨ï¼Œè¾“å…¥é—¨å’Œè¾“å‡ºé—¨åˆå¹¶ä¸ºè¾“å‡ºé—¨ï¼Œæ‰€ä»¥GRUçš„å‚æ•°æ›´å°‘,æ›´ä¾¿äºè®¡ç®—.</p></li><li><p>SIR:SIRæ¨¡å‹ï¼Œç”¨äºä¼ æŸ“ç—…ä¼ æ’­çš„é¢„æµ‹ï¼ŒSè¡¨ç¤ºæ˜“æ„Ÿè€…ï¼ŒIè¡¨ç¤ºæ„ŸæŸ“è€…ï¼ŒRè¡¨ç¤ºåº·å¤è€…,ä¹Ÿé€‚ç”¨äºæŸäº›çªç„¶çˆ†ç«çš„äº‹ä»¶ã€‚</p></li><li><p>Prophet:æ—¶é—´åºåˆ—é¢„æµ‹ï¼Œä½¿ç”¨Facebookçš„Prophetç®—æ³•ï¼Œè¯¥ç®—æ³•åŸºäºæ—¶é—´åºåˆ—å†å²æ•°æ®ï¼Œæ‹Ÿåˆå‡ºä¸€ä¸ªè¶‹åŠ¿å’Œå­£èŠ‚æ€§ï¼Œç„¶åé¢„æµ‹æœªæ¥çš„æ—¶é—´åºåˆ—ã€‚å‚è€ƒ2301192,2200688</p></li><li><p>å¡å°”æ›¼æ»¤æ³¢ç®—æ³•</p></li><li><p>LightGBM:LightGBMæ˜¯ä¸€ç§åŸºäºæ¢¯åº¦æå‡å†³ç­–æ ‘çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒå…·æœ‰é«˜æ•ˆæ€§ã€å¯æ‰©å±•æ€§å’Œå¯è§£é‡Šæ€§ç­‰ç‰¹ç‚¹ã€‚åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä»»åŠ¡ä¸­ï¼ŒLightGBMå¯ä»¥æœ‰æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¯è§£é‡Šçš„é¢„æµ‹ç»“æœã€‚</p></li><li><p>XGBoost:XGBoostæ˜¯ä¸€ç§åŸºäºæ¢¯åº¦æå‡å†³ç­–æ ‘çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒå…·æœ‰é«˜æ•ˆæ€§ã€å¯æ‰©å±•æ€§å’Œå¯è§£é‡Šæ€§ç­‰ç‰¹ç‚¹ã€‚</p></li><li><p>LSTM:é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memoryï¼ŒLSTMï¼‰æ˜¯ä¸€ç§å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰çš„å˜ä½“ï¼Œå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†æ—¶é—´åºåˆ—æ•°æ®ã€‚LSTMé€šè¿‡å¼•å…¥è®°å¿†å•å…ƒå’Œé—¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ•æ‰å’Œä¼ é€’æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»ã€‚å¯ä¸å‚è€ƒä¸‹2204883</p></li><li><p>ARIMA-LSTM:è¿™ä¸¤ä¸ªæ¨¡å‹ç»“åˆæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„,2212336,æŠŠLSTMæ¢æˆGRUä¹Ÿæ˜¯å·®ä¸å¤šçš„æ•ˆæœ</p></li><li><p>ARIMA-SVM:æ¥è‡ª2100948,å¯èƒ½å‚è€ƒäº†<code>https://blog.csdn.net/u014356002/article/details/53163684</code>,SVMå’ŒLSTMéƒ½ç”¨æ¥æ•æ‰éçº¿æ€§éƒ¨åˆ†,ä½†åœ¨é¢„æµ‹ä¸ŠSVMä¸å¦‚LSTM,ä½†SVMå¯è§£é‡Šæ€§ç›¸å¯¹æ›´å¥½</p></li></ul><p>å¤šæ¨¡å‹å †å :å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™é‡Œé¢çš„<code>https://blog.csdn.net/keypig_zz/article/details/82819558</code>,è¿™ä¸ªå›¾å’Œæµç¨‹å¯ä»¥å‚è€ƒ</p><h3 id="éæ—¶é—´åºåˆ—é¢„æµ‹">éæ—¶é—´åºåˆ—é¢„æµ‹</h3><ul><li><p>GSRF:ç½‘æ ¼æœç´¢çš„éšæœºæ£®æ—ç®—æ³•</p></li><li><p>ç»´ç‰¹æ¯”ç®—æ³•:ä¸»è¦ç”¨äºè§£å†³éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHMMï¼‰ä¸­çš„çŠ¶æ€åºåˆ—é¢„æµ‹é—®é¢˜ã€‚åœ¨è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€ç”Ÿç‰©ä¿¡æ¯å­¦ç­‰é¢†åŸŸä¸­ï¼Œç»´ç‰¹æ¯”ç®—æ³•è¢«ç”¨äºæ ¹æ®è§‚æµ‹åºåˆ—é¢„æµ‹æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—ã€‚</p></li><li><p>MMOEæ¨¡å‹:æ˜¯ä¸€ç§å¤šä»»åŠ¡å­¦ä¹ æ¶æ„ï¼Œæ—¨åœ¨æé«˜æ¨¡å‹åœ¨å¤„ç†å¤šä¸ªç›¸å…³ä»»åŠ¡æ—¶çš„æ€§èƒ½ã€‚è¯¥æ¨¡å‹ç”±è°·æ­Œåœ¨2018å¹´çš„KDDä¼šè®®ä¸Šæå‡ºï¼Œå¹¶å› å…¶æœ‰æ•ˆçš„å‚æ•°å…±äº«æœºåˆ¶å’Œä»»åŠ¡ç‰¹å®šå¤„ç†èƒ½åŠ›è€Œè¢«ä¸šç•Œå¹¿æ³›é‡‡ç”¨ã€‚æ¥æºäº2307946,å…¶ç”¨äºé¢„æµ‹å°è¯•æ¬¡æ•°ç™¾åˆ†æ¯”.</p></li><li><p>å¤šå…ƒçº¿æ€§å›å½’:ç”¨äºé¢„æµ‹å¤šä¸ªè‡ªå˜é‡å¯¹å› å˜é‡çš„å½±å“ã€‚</p></li></ul><h3 id="èšç±»ç®—æ³•-åˆ†ç±»">èšç±»ç®—æ³•(åˆ†ç±»)</h3><ul><li><p>k-means:k-meansèšç±»ç®—æ³•,äººä¸ºå†³å®šåˆå§‹èšç±»ä¸­å¿ƒ,è¾ƒä¸ºä¸»è§‚,å¯æ”¹ç”¨k-means++,æˆ–è€…ä½¿ç”¨Gap Statisticæ–¹æ³•ç¡®å®šæœ€ä½³kå€¼</p></li><li><p>k-means++:k-means++èšç±»ç®—æ³•</p></li><li><p>DBSCAN:DBSCANèšç±»ç®—æ³•</p></li><li><p>BIRCH:BIRCHèšç±»ç®—æ³•</p></li><li><p>GMM:GMMèšç±»ç®—æ³•,èšç±»æ•ˆæœæ¯”kmeanså¥½,å¦‚æœåç»­è¦é™ç»´,å¯ä»¥è€ƒè™‘ä½¿ç”¨kmeans++</p></li><li><p>è°±èšç±»:è°±èšç±»ç®—æ³•</p></li><li><p>å±‚æ¬¡èšç±»:å±‚æ¬¡èšç±»ç®—æ³•</p></li><li><p>R-CNNå®¶æ—: R-CNN , Fast R-CNN , Faster R-CNN , Mask R-CNN,ç‰©ä½“æ£€æµ‹ç®—æ³•,åœ¨2106138ä¸­ç”¨äºåˆ†ç±»å¤§é»„èœ‚å’Œèƒ¡èœ‚</p></li></ul><h3 id="å…¶ä»–">å…¶ä»–</h3><p><strong>æ•°æ®å¤„ç†æµç¨‹å»ºè®®å‚è€ƒä¸€ä¸‹2208834</strong></p><p>æ¨¡å‹æœ€å¥½éƒ½è¦æœ‰<strong>è®­ç»ƒé›†</strong>å’Œ<strong>æµ‹è¯•é›†</strong>ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†æœ€å¥½è¦åˆ†å¼€ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†æœ€å¥½è¦éšæœºæ‰“ä¹±ï¼Œè¿™æ ·æ¨¡å‹æ‰èƒ½æœ‰æ›´å¥½çš„æ•ˆæœã€‚æµ‹è¯•é›†å¯ä»¥ä»å·²æœ‰æ•°æ®ä¸­éšæœºæŠ½å–ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ï¼Œä¹Ÿå¯ä»¥ä»è®­ç»ƒé›†ä¸­åˆ’åˆ†ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ã€‚è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¯”ä¾‹å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®­ç»ƒé›†çš„æ¯”ä¾‹è¦å¤§äºæµ‹è¯•é›†çš„æ¯”ä¾‹ã€‚</p><p><strong>å½±å“å› å­</strong>æœ€å¥½ä¿ç•™5-8ä¸ªï¼Œå¦‚æœå½±å“å› å­å¤ªå¤šï¼Œæ¨¡å‹å¯èƒ½ä¼šè¿‡æ‹Ÿåˆï¼Œå¦‚æœå½±å“å› å­å¤ªå°‘ï¼Œæ¨¡å‹å¯èƒ½ä¼šæ¬ æ‹Ÿåˆã€‚æœ€å¥½æ˜¯ä»å¤šä¸ªå½±å“å› å­ä¸­æŒ‘é€‰å‡ºæ¥.</p><p>æ­¥éª¤å¦‚ä¸‹:</p><ol><li>æ•°æ®æ”¶é›†ã€æ•°æ®æ¸…æ´—ã€æ•°æ®æ ‡å‡†åŒ–</li><li>ç›¸å…³æ€§åˆ†æï¼Œåˆ†æå„å› å­ä¹‹é—´çš„ç›¸å…³æ€§ã€‚é«˜åº¦ç›¸å…³çš„å› å­å¯èƒ½ä»£è¡¨ç›¸ä¼¼çš„ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘åˆå¹¶æˆ–åªä¿ç•™ä¸€ä¸ªã€‚</li><li>ä½¿ç”¨PCA(ä¸»æˆåˆ†åˆ†ææ³•)è¿›è¡Œé™ç»´ï¼Œé€‰æ‹©æœ€é‡è¦çš„5-8ä¸ªå½±å“å› å­.</li><li>ç¡®å®šæƒé‡:ä½¿ç”¨å±‚æ¬¡åˆ†ææ³•ã€ç†µæƒæ³•ã€ä¸»æˆåˆ†åˆ†ææ³•ã€å˜å¼‚ç³»æ•°æ³•ç­‰æ–¹æ³•ç¡®å®šæƒé‡.</li></ol><p><strong>ç™½å™ªå£°æµ‹è¯•</strong>: ç™½å™ªå£°æµ‹è¯•æ˜¯ç”¨æ¥æ£€éªŒæ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦ä¸ºéšæœºæ¸¸èµ°çš„ï¼Œå¦‚æœæ—¶é—´åºåˆ—æ•°æ®æ˜¯éšæœºæ¸¸èµ°çš„ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å…·æœ‰å‡åŒ€çš„åˆ†å¸ƒã€‚ç™½å™ªå£°æµ‹è¯•å¯ä»¥ä½¿ç”¨ADF(Augmented Dickey-Fuller)æ£€éªŒæ–¹æ³•æ¥åˆ¤æ–­æ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦ä¸ºéšæœºæ¸¸èµ°ã€‚å¦‚æœADFæ£€éªŒç»“æœçš„på€¼å°äº0.05ï¼Œé‚£ä¹ˆæ—¶é—´åºåˆ—æ•°æ®å°±ä¸æ˜¯éšæœºæ¸¸èµ°çš„ã€‚</p><ul><li><p><strong>ADFæµ‹è¯•</strong>:æ˜¯ä¸€ç§ç»Ÿè®¡æ£€éªŒæ–¹æ³•ï¼Œç”¨äºç¡®å®šä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦å¹³ç¨³ã€‚åœ¨ç»æµå­¦å’Œé‡‘èå­¦ä¸­ï¼Œæ—¶é—´åºåˆ—æ•°æ®çš„å¹³ç¨³æ€§æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºé¢„æµ‹æœªæ¥çš„ç»æµæ´»åŠ¨ã€‚å¦‚æœä¸€ä¸ªæ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ï¼Œé‚£ä¹ˆå®ƒçš„ç»Ÿè®¡ç‰¹æ€§ï¼ˆå¦‚å‡å€¼ã€æ–¹å·®å’Œè‡ªåæ–¹å·®ï¼‰ä¸ä¼šéšæ—¶é—´å˜åŒ–ã€‚å¦‚æœæ•°æ®å¹³ç¨³,å¯ä»¥ä½¿ç”¨åŸå§‹æ•°æ®,å¦‚æœä¸å¹³ç¨³,åˆ™è¦å¯¹æ•°æ®è¿›è¡Œå¤„ç†.å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹:</p><ol><li><p>å·®åˆ†ï¼šå¦‚æœæ•°æ®æ˜¯éå¹³ç¨³çš„ï¼Œé€šè¿‡å¯¹æ•°æ®è¿›è¡Œä¸€é˜¶æˆ–æ›´é«˜é˜¶çš„å·®åˆ†ï¼Œå¯ä»¥å»é™¤æ•°æ®ä¸­çš„è¶‹åŠ¿ã€å­£èŠ‚æ€§æˆ–å…¶ä»–æ—¶é—´åŠ¨æ€ç‰¹å¾ï¼Œä»è€Œä½¿æ•°æ®å˜å¾—å¹³ç¨³ã€‚å·®åˆ†æ˜¯ä¸€ç§å¸¸è§çš„æ—¶é—´åºåˆ—å¹³ç¨³åŒ–æŠ€æœ¯ã€‚</p></li><li><p>å­£èŠ‚æ€§è°ƒæ•´ï¼šå¯¹äºå…·æœ‰å­£èŠ‚æ€§æ³¢åŠ¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å­£èŠ‚æ€§è°ƒæ•´æ¥å»é™¤å­£èŠ‚æ€§å› ç´ ï¼Œä½¿æ•°æ®æ›´åŠ å¹³ç¨³ã€‚è¿™å¯ä»¥é€šè¿‡ç§»åŠ¨å¹³å‡ã€å­£èŠ‚æ€§åˆ†è§£æ—¶é—´åºåˆ—é¢„æµ‹ï¼ˆSTLï¼‰ç­‰æ–¹æ³•æ¥å®ç°ã€‚</p></li><li><p>æ¼‚ç™½ï¼šæ¼‚ç™½æ˜¯ä¸€ç§ç»Ÿè®¡æŠ€æœ¯ï¼Œé€šè¿‡å®ƒå¯ä»¥ä»æ—¶é—´åºåˆ—ä¸­å»é™¤é•¿æœŸè¶‹åŠ¿å’Œå­£èŠ‚æ€§æˆåˆ†ï¼Œåªä¿ç•™çŸ­æœŸæ³¢åŠ¨ã€‚è¿™å¯ä»¥é€šè¿‡è‡ªå›å½’æ¨¡å‹ï¼ˆå¦‚ARæ¨¡å‹ï¼‰æ¥å®ç°ã€‚</p></li><li><p>Box-Coxå˜æ¢ï¼šè¿™æ˜¯ä¸€ç§ç”¨äºå¤„ç†éæ­£æ€åˆ†å¸ƒæ•°æ®çš„æŠ€æœ¯ï¼Œé€šè¿‡å˜æ¢å¯ä»¥å°†æ•°æ®è½¬æ¢ä¸ºæ­£æ€åˆ†å¸ƒï¼Œæœ‰æ—¶è¿™ä¹Ÿæœ‰åŠ©äºæé«˜æ•°æ®çš„å¹³ç¨³æ€§ã€‚</p></li><li><p>å¤„ç†å¼‚å¸¸å€¼ï¼šæ£€æŸ¥æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨å¼‚å¸¸å€¼æˆ–ç¦»ç¾¤å€¼ï¼Œå¹¶è€ƒè™‘æ˜¯å¦éœ€è¦å°†å…¶åˆ é™¤æˆ–è¿›è¡ŒæŸç§å½¢å¼çš„è°ƒæ•´ã€‚</p></li><li><p>ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹ï¼šæœ‰æ—¶ï¼Œä½¿ç”¨æ›´é«˜çº§çš„ç»æµè®¡é‡æ¨¡å‹ï¼ˆå¦‚å‘é‡è‡ªå›å½’æ¨¡å‹VARæˆ–çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼‰å¯ä»¥å¤„ç†éå¹³ç¨³æ•°æ®ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¯¹æ•°æ®è¿›è¡Œå¹³ç¨³åŒ–å¤„ç†ã€‚</p></li></ol></li><li><p>CTGAN:ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œå¯ç”¨äºæ‹“å±•æ•°æ®é›†(è°¨æ…ä½¿ç”¨)</p></li><li><p><strong>OpenFE</strong>:æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„ç‰¹å¾è‡ªåŠ¨ç”Ÿæˆç®—æ³•OpenFEï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°ç”Ÿæˆæœ‰ç”¨çš„ç‰¹å¾ï¼Œæé«˜æ¨¡å‹å­¦ä¹ æ€§èƒ½(GBDTç›¸å…³æ¨¡å‹å’ŒSOATç¥ç»ç½‘ç»œ).</p></li><li><p>Bootstrapæ–¹æ³•:é€šè¿‡é‡å¤æŠ½æ ·å’Œè®¡ç®—ç»Ÿè®¡é‡æ¥ä¼°è®¡æ€»ä½“çš„åˆ†å¸ƒ,å¯ä»¥ç”¨æ¥è¿›è¡Œå‡è®¾æ£€éªŒ,ç½®ä¿¡åŒºé—´æ„å»º,ç¨³å¥æ€§åˆ†æç­‰ã€‚è®ºæ–‡2309397å¯¹é¢„æµ‹ç»“æœä½¿ç”¨Bootstrapæ–¹æ³•æ„å»ºç½®ä¿¡åŒºé—´,å–ç½®ä¿¡æ°´å¹³95%æ—¶çš„ç»“æœä½œä¸ºé¢„æµ‹åŒºé—´ã€‚</p></li></ul><p>å›¾å»ºè®®15-20å¼ ,è¡¨å»ºè®®3-8ä¸ª,æ€»æ•°20-25æœ€ä½³</p><p>ä½¿ç”¨æ¯”è¾ƒé«˜çº§çš„æ¨¡å‹æœ€å¥½ç”»ä¸ŠåŸç†å›¾,æ¨¡å‹è¿›è¡Œç»“åˆä¹Ÿæœ€å¥½ç”»å›¾è¡¨ç¤ºä¸€ä¸‹.å¦‚æœå»ºç«‹çš„æ¨¡å‹æ¯”è¾ƒç®€å•,é‚£å°±å¾—åœ¨åˆ†æå’Œå›¾åƒä¸Šä¸‹åŠŸå¤«.æ¯ä¸€ä¸ªtaskçš„åˆ†æè‡³å°‘å¾—æœ‰ä¸€å¼ å›¾</p><p>å¯ä»¥ç”¨ä¼ªä»£ç å»å±•ç¤ºä¸€äº›ä¸å¥½ç”¨å›¾è¡¨å±•ç¤ºçš„è¡Œä¸šæ€§çš„ç®—æ³•,ä¾‹å¦‚2200401çš„äº¤æ˜“ç­–ç•¥</p><ul><li>NSGS-II:å¤šç›®æ ‡ä¼˜åŒ–ç®—æ³•,å‚è€ƒ2218743</li></ul><p>ç®€å•çš„å›¾ä¹Ÿå¯ä»¥ç”»å¾—ä¸ä¸€æ ·,æ¯”å¦‚æŠ˜çº¿å›¾,æˆ‘ä»¬å¯ä»¥å°†æœ€å€¼æ ‡è®°å‡ºæ¥,å°†å¼‚å¸¸å€¼æ ‡è®°å‡ºç­‰ç­‰</p><p><img src="https://pb01.s3.bitiful.net/143.png" alt="avatar"></p><p>è¯äº‘å¯è§†åŒ–ä¹Ÿå¯ä»¥ä½œä¸ºä¸€å¤§äº®ç‚¹</p><p>21å¹´çš„å¯ä»¥çœ‹ä¸‹2107079</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MCM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm install æŠ¥é”™ npm notice Beginning October 4, 2021, all connections to the npm registry - including for package installation - must use TLS 1.2 or higher.</title>
      <link href="/2024/01/11/2024-1-11-npm%E6%8A%A5%E9%94%99/"/>
      <url>/2024/01/11/2024-1-11-npm%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="npm-install-æŠ¥é”™-npm-notice-Beginning-October-4-2021-all-connections-to-the-npm-registry-including-for-package-installation-must-use-TLS-1-2-or-higher-You-are-currently-using-plaintext-http-to-connect-Please-visit-the-GitHub-blog-for-more-information-https-github-blog-2021-08-23-npm-registry-deprecating-tls-1-0-tls-1-1">npm install æŠ¥é”™:npm notice Beginning October 4, 2021, all connections to the npm registry - including for package installation - must use TLS 1.2 or higher. You are currently using plaintext http to connect. Please visit the GitHub blog for more information: <a href="https://github.blog/2021-08-23-npm-registry-deprecating-tls-1-0-tls-1-1/">https://github.blog/2021-08-23-npm-registry-deprecating-tls-1-0-tls-1-1/</a></h3><p><img src="https://pb01.s3.bitiful.net/203.webp" alt="avatar"></p><p>é¦–å…ˆè¿›å…¥æ‰€ç»™çš„ç½‘å€æŸ¥çœ‹:<br><img src="https://pb01.s3.bitiful.net/204.webp" alt="avatar"></p><p>æŸ¥çœ‹è‡ªå·±çš„Node.jså’Œnpmç‰ˆæœ¬:<br><img src="https://pb01.s3.bitiful.net/205.webp" alt="avatar"></p><p>å‘ç°ç‰ˆæœ¬å¤Ÿé«˜(Node.jsæœ€å¥½åœ¨18åŠä»¥ä¸Š, npmåœ¨7åŠä»¥ä¸Š)</p><p>æ‰§è¡Œæ‰€ç»™ä»£ç :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g https://tls-test.npmjs.com/tls-test-1.0.0.tgz</span><br></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œnpm install,å‘ç°ä¾æ—§æŠ¥é”™</p><p>æŸ¥çœ‹è®¾ç½®çš„npmæº:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure><p>å‘ç°æºæ˜¯<code>http://registry.npmjs.org</code>, æ²¡ç”¨httpsåè®®, è¿›è¡Œæ¢æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmjs.org</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œnpm install, æˆåŠŸ</p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ </title>
      <link href="/2023/12/29/openguass/"/>
      <url>/2023/12/29/openguass/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ ">è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ </h3><p><em><strong>ä»…è®°å½•å¹³å°æ ‡æ³¨ä¸­ç­‰éš¾åº¦åŠä»¥ä¸Šçš„é¢˜ç›®</strong></em></p><p><strong>è¯•å·ç¼–å·:41</strong><br><strong>è¯•å·åç§°:gongsi</strong></p><p><strong>æ¡ä»¶</strong>:<br>å…¬å¸æ•°æ®åº“æœ‰å¦‚ä¸‹å…³ç³»æ¨¡å¼ï¼š å‘˜å·¥employeeï¼ˆå‘˜å·¥å·enoï¼Œå‘˜å·¥å§“åenameï¼Œå‘˜å·¥å¹´é¾„eageï¼Œæ‰€åœ¨éƒ¨é—¨å·dnoï¼Œå·¥èµ„salaryï¼Œå·¥ä½œæ—¥æœŸworkï¼‰ï¼› éƒ¨é—¨depart(éƒ¨é—¨å·dnoï¼Œéƒ¨é—¨åç§°dnameï¼Œéƒ¨é—¨ç»ç†å‘˜å·¥å·dman)ã€‚</p><h4 id="é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚">é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dno, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">from</span> employee <span class="keyword">group</span> <span class="keyword">by</span> dno</span><br></pre></td></tr></table></figure><h4 id="é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚">é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> salary <span class="keyword">from</span> employee a </span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.salary<span class="operator">&gt;=</span>a.salary) <span class="operator">-</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.salary<span class="operator">&lt;=</span>a.salary)</span><br><span class="line"><span class="keyword">between</span> <span class="number">-1</span> <span class="keyword">and</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ¯”è¾ƒ<strong>å®¹æ˜“è¸©å‘</strong>çš„åœ°æ–¹æ˜¯é¢˜ç›®æ²¡æœ‰è¯´æ˜å®ƒå¯¹<strong>ä¸­ä½æ•°çš„å®šä¹‰</strong>,è¿™é‡Œæ˜¯å°†å¤šä¸ªä¸­ä½æ•°è¿”å›å›å»,è€Œä¸ç”¨æ±‚å¹³å‡,è€Œç½‘ä¸Šå¤§å¤šæ•°ç±»ä¼¼çš„éœ€æ±‚éƒ½æ˜¯åªèƒ½è¿”å›ä¸€ä¸ªä¸­ä½æ•°,æ‰€ä»¥æœ‰å¤šä¸ªä¸­ä½æ•°æ˜¯éƒ½è¿›è¡Œäº†æ±‚å¹³å‡æ“ä½œ,ä½†è¿™é‡Œæ˜¯æ²¡æœ‰çš„,æ‰€ä»¥éœ€è¦ç‰¹åˆ«æ³¨æ„</p><h4 id="é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚">é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> dno,salary <span class="keyword">from</span> employee a </span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.dno<span class="operator">=</span>a.dno <span class="keyword">and</span> b.salary<span class="operator">&gt;=</span>a.salary) <span class="operator">-</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.dno<span class="operator">=</span>a.dno <span class="keyword">and</span> b.salary<span class="operator">&lt;=</span>a.salary)</span><br><span class="line"><span class="keyword">between</span> <span class="number">-1</span> <span class="keyword">and</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF">é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF</h4><p>å·¥ä½œæ—¥æœŸåŒ…å«å¤šä¸ªæ—¥æœŸï¼Œä¸­é—´ç”¨é€—å·,åˆ†éš”ï¼Œ<strong>å‰åå¯èƒ½æœ‰å¤šä¸ªç©ºæ ¼</strong>ï¼Œå¦‚2022-11-11,2022-11-12,2018-08-01ï¼ŒæŸ¥è¯¢æ¯ä¸ªå‘˜å·¥çš„å‘˜å·¥å·ï¼Œå§“åå’Œå·¥ä½œæ—¥æœŸï¼Œå…¶ä¸­å·¥ä½œæ—¥æœŸè¦æ±‚å°†åŸæœ‰æ—¥æœŸæ‹†åˆ†ä¸ºå•ä¸ªæ—¥æœŸã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> eno,ename,<span class="built_in">trim</span>(regexp_split_to_table(work,<span class="string">&#x27;,&#x27;</span>)) <span class="keyword">as</span> work <span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸ªäººè§‰å¾—æ˜¯è¿™å¥—ç»ƒä¹ é‡Œ<strong>æœ€éš¾</strong>çš„ä¸€é“äº†,ä½†openGaussçš„regexp_split_to_tableå‡½æ•°å·²ç»å¸®æˆ‘ä»¬å®ç°äº†<strong>è¡Œè½¬åˆ—</strong>è¿™ä¸ªæœ€éš¾çš„ç‚¹,ç„¶åtrimå‡½æ•°å»ä¸€ä¸‹ç©ºæ ¼,å°±å‡ºæ¥äº†.å½“ç„¶åˆ«çš„æ–¹æ³•ä¹Ÿå¯ä»¥åš,ç½‘ä¸Šä¸€æœéƒ½æœ‰,ä½†å‡½æ•°ç”¨èµ·æ¥å°±æ˜¯çˆ½ğŸ¤ª</p><h4 id="é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get-age-count-s-e-ï¼Œè¿”å›å¹´é¾„åœ¨-s-e-èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚">é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get_age_count(s,e)ï¼Œè¿”å›å¹´é¾„åœ¨[s,e]èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> get_age_count(s <span class="type">integer</span>, e <span class="type">integer</span>)  </span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">integer</span> <span class="keyword">AS</span> $total$  </span><br><span class="line"><span class="keyword">declare</span>  </span><br><span class="line">    total <span class="type">integer</span>;  </span><br><span class="line"><span class="keyword">BEGIN</span>  </span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> total <span class="keyword">FROM</span> employee <span class="keyword">WHERE</span> eage<span class="operator">&gt;=</span>s <span class="keyword">AND</span> eage<span class="operator">&lt;=</span>e;  </span><br><span class="line">   <span class="keyword">RETURN</span> total;  </span><br><span class="line"><span class="keyword">END</span>;  </span><br><span class="line">$total$ <span class="keyword">LANGUAGE</span> plpgsql;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å°±è¦ä»”ç»†çœ‹ä¸‹openGaussçš„æ‰‹å†Œ,æˆ‘ä¸€å¼€å§‹æŒ‰MySQLå‡½æ•°çš„æ ¼å¼å†™å°±é”™äº†,åæ¥ä»”ç»†çœ‹äº†ä¸‹æ‰‹å†Œæ‰å‘ç°openGaussè‡ªå®šä¹‰å‡½æ•°æ˜¯<strong>PostgreSQLæ ¼å¼</strong>çš„,è¿™ç‚¹è¦æ³¨æ„.</p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openGauss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç´¢å¼•ä¸€</title>
      <link href="/2023/12/29/MySQL%E7%B4%A2%E5%BC%95/"/>
      <url>/2023/12/29/MySQL%E7%B4%A2%E5%BC%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLç´¢å¼•ä¸€">MySQLç´¢å¼•ä¸€</h2><h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•">ä»€ä¹ˆæ˜¯ç´¢å¼•</h3><p>ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„<strong>æ•°æ®ç»“æ„</strong>ã€‚</p><p>ç´¢å¼•çš„ä½œç”¨å°±ç›¸å½“äºä¹¦çš„ç›®å½•ã€‚æ‰“ä¸ªæ¯”æ–¹: æˆ‘ä»¬åœ¨æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç›®å½•ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ä¸€é¡µä¸€é¡µçš„å»æ‰¾æˆ‘ä»¬éœ€è¦æŸ¥çš„é‚£ä¸ªå­—ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚å¦‚æœæœ‰ç›®å½•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå»ç›®å½•é‡ŒæŸ¥æ‰¾å­—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µå°±è¡Œäº†ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œæ— è®ºæ˜¯ Innodb è¿˜æ˜¯ MyIsamï¼Œéƒ½ä½¿ç”¨äº† <strong>B+æ ‘</strong>ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><h3 id="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹">ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹:</p><ul><li>æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“IOæˆæœ¬</li><li>é™ä½æ•°æ®æ’åºæˆæœ¬ï¼Œé™ä½CPUæ¶ˆè€—</li><li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</li></ul><p>ç¼ºç‚¹:</p><ul><li>ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´</li><li>ç´¢å¼•éœ€è¦å®šæœŸç»´æŠ¤ï¼Œå¢åˆ æ”¹æ•°æ®æ—¶éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œé™ä½æ•°æ®å†™å…¥æ•ˆç‡</li></ul><h3 id="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹">ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹</h3><h4 id="å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</h4><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥é”®-å€¼(key-value)å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œåªè¦è¾“å…¥å¾…æŸ¥æ‰¾å€¼å³ keyï¼Œå°±å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„å€¼å³ valueã€‚å› æ­¤å“ˆå¸Œè¡¨å¯ä»¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼ˆæ¥è¿‘ Oï¼ˆ1ï¼‰ï¼‰ã€‚</p><p>ä¸ºä½•èƒ½å¤Ÿé€šè¿‡ key å¿«é€Ÿå–å‡º value å‘¢ï¼Ÿ åŸå› åœ¨äº <strong>å“ˆå¸Œç®—æ³•</strong>ï¼ˆä¹Ÿå«æ•£åˆ—ç®—æ³•ï¼‰ã€‚é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰¾åˆ° key å¯¹åº”çš„ indexï¼Œæ‰¾åˆ°äº† index ä¹Ÿå°±æ‰¾åˆ°äº†å¯¹åº”çš„ valueã€‚</p><p><img src="https://pb01.s3.bitiful.net/141.png" alt="avatar"></p><p>ä½†æ˜¯, å“ˆå¸Œè¡¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹: å°±æ˜¯å“ˆå¸Œå†²çªã€‚</p><p>å“ˆå¸Œå†²çª: ä¸¤ä¸ªä¸åŒçš„ key é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°äº†ç›¸åŒçš„ç»“æœï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä¸ºå“ˆå¸Œå†²çªã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è§£å†³åŠæ³•æ˜¯ <code>é“¾åœ°å€æ³•</code>ã€‚é“¾åœ°å€æ³•å°±æ˜¯å°†å“ˆå¸Œå†²çªæ•°æ®å­˜æ”¾åœ¨é“¾è¡¨ä¸­ã€‚å°±æ¯”å¦‚ JDK1.8 ä¹‹å‰ HashMap å°±æ˜¯é€šè¿‡é“¾åœ°å€æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ã€‚ä¸è¿‡ï¼ŒJDK1.8 ä»¥åHashMapä¸ºäº†å‡å°‘é“¾è¡¨è¿‡é•¿çš„æ—¶å€™æœç´¢æ—¶é—´è¿‡é•¿å¼•å…¥äº†çº¢é»‘æ ‘ã€‚</p><p>ä¸ºäº†å‡å°‘ Hash å†²çªçš„å‘ç”Ÿï¼Œä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥â€œå‡åŒ€åœ°â€å°†æ•°æ®åˆ†å¸ƒåœ¨æ•´ä¸ªå¯èƒ½çš„å“ˆå¸Œå€¼é›†åˆä¸­ã€‚</p><p>MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä¸ç›´æ¥æ”¯æŒå¸¸è§„çš„å“ˆå¸Œç´¢å¼•ï¼Œä½†æ˜¯ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¸­å­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„<code>â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€</code>ï¼ˆAdaptive Hash Indexï¼‰ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„çº¯å“ˆå¸Œç´¢å¼•ï¼Œè€Œæ˜¯ç»“åˆäº† B+Tree å’Œå“ˆå¸Œç´¢å¼•çš„ç‰¹ç‚¹ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‚åº”å®é™…åº”ç”¨ä¸­çš„æ•°æ®è®¿é—®æ¨¡å¼å’Œæ€§èƒ½éœ€æ±‚ã€‚è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•çš„æ¯ä¸ªå“ˆå¸Œæ¡¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªå°å‹çš„ B+Tree ç»“æ„ã€‚è¿™ä¸ª B+Tree ç»“æ„å¯ä»¥å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªé”®ã€‚è¿™æœ‰åŠ©äºå‡å°‘å“ˆå¸Œå†²çªé“¾çš„é•¿åº¦ï¼Œæé«˜äº†ç´¢å¼•çš„æ•ˆç‡ã€‚</p><p>æ—¢ç„¶å“ˆå¸Œè¡¨è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆ MySQL æ²¡æœ‰ä½¿ç”¨å…¶ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ ä¸»è¦æ˜¯å› ä¸º Hash ç´¢å¼•<strong>ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚å‡å¦‚æˆ‘ä»¬è¦å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ’åºæˆ–è€…è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œé‚£ Hash ç´¢å¼•å¯å°±ä¸è¡Œäº†ã€‚å¹¶ä¸”ï¼Œ<strong>æ¯æ¬¡ IO åªèƒ½å–ä¸€ä¸ª</strong>ã€‚</p><h4 id="äºŒå‰æŸ¥æ‰¾æ ‘">äºŒå‰æŸ¥æ‰¾æ ‘</h4><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºæ ¹èŠ‚ç‚¹çš„å€¼ã€‚</li><li>å³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼ã€‚</li><li>å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ã€‚</li></ul><p>å½“äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯å¹³è¡¡çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æ·±åº¦ç›¸å·®ä¸è¶…è¿‡ 1 çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log2(N))ï¼Œå…·æœ‰æ¯”è¾ƒé«˜çš„æ•ˆç‡ã€‚ç„¶è€Œï¼Œå½“äºŒå‰æŸ¥æ‰¾æ ‘ä¸å¹³è¡¡æ—¶ï¼Œä¾‹å¦‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆæœ‰åºæ’å…¥èŠ‚ç‚¹ï¼‰ï¼Œæ ‘ä¼šé€€åŒ–æˆçº¿æ€§é“¾è¡¨ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ–œæ ‘ï¼‰ï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡æ€¥å‰§ä¸‹é™ï¼Œæ—¶é—´å¤æ‚é€€åŒ–ä¸º Oï¼ˆNï¼‰ã€‚</p><p>äºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹: å°±æ˜¯å¹³è¡¡æ€§ä¸å¥½ã€‚è¿™å°±å¯¼è‡´å…¶ä¸é€‚åˆä½œä¸º MySQL åº•å±‚ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚</p><h4 id="å¹³è¡¡äºŒå‰æ ‘-AVLæ ‘">å¹³è¡¡äºŒå‰æ ‘(AVLæ ‘)</h4><p>AVL æ ‘çš„ç‰¹ç‚¹æ˜¯ä¿è¯ä»»ä½•èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ä¹‹å·®ä¸è¶…è¿‡ 1ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºé«˜åº¦å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤åœ¨å¹³å‡å’Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><p>AVL æ ‘é‡‡ç”¨äº†æ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚ä¸»è¦æœ‰å››ç§æ—‹è½¬æ“ä½œï¼šLL æ—‹è½¬ã€RR æ—‹è½¬ã€LR æ—‹è½¬å’Œ RL æ—‹è½¬ã€‚å…¶ä¸­ LL æ—‹è½¬å’Œ RR æ—‹è½¬åˆ†åˆ«ç”¨äºå¤„ç†å·¦å·¦å’Œå³å³å¤±è¡¡ï¼Œè€Œ LR æ—‹è½¬å’Œ RL æ—‹è½¬åˆ™ç”¨äºå¤„ç†å·¦å³å’Œå³å·¦å¤±è¡¡ã€‚</p><p>ç”±äº AVL æ ‘éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œå› æ­¤ä¼šæœ‰è¾ƒå¤§çš„è®¡ç®—å¼€é”€è¿›è€Œé™ä½äº†æŸ¥è¯¢æ€§èƒ½ã€‚å¹¶ä¸”ï¼Œåœ¨ä½¿ç”¨ AVL æ ‘æ—¶ï¼Œæ¯ä¸ªæ ‘èŠ‚ç‚¹ä»…å­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼Œè€Œæ¯æ¬¡è¿›è¡Œç£ç›˜ IO æ—¶åªèƒ½è¯»å–ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢çš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œå¤šæ¬¡ç£ç›˜ IOã€‚ ç£ç›˜ IO æ˜¯ä¸€é¡¹è€—æ—¶çš„æ“ä½œï¼Œåœ¨è®¾è®¡æ•°æ®åº“ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜å…ˆè€ƒè™‘å¦‚ä½•æœ€å¤§é™åº¦åœ°å‡å°‘ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°ã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼ŒAVL æ ‘ä½¿ç”¨çš„å¹¶ä¸å¤šã€‚</p><h4 id="çº¢é»‘æ ‘">çº¢é»‘æ ‘</h4><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œé€šè¿‡åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶è¿›è¡Œé¢œè‰²å˜æ¢å’Œæ—‹è½¬æ“ä½œï¼Œä½¿å¾—æ ‘å§‹ç»ˆä¿æŒå¹³è¡¡çŠ¶æ€ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹éçº¢å³é»‘ï¼›</li><li>æ ¹èŠ‚ç‚¹æ€»æ˜¯é»‘è‰²çš„ï¼›</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼‰ï¼›</li><li>å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆåä¹‹ä¸ä¸€å®šï¼‰ï¼›</li><li>ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œå¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆå³ç›¸åŒçš„é»‘è‰²é«˜åº¦ï¼‰ã€‚</li></ol><p><img src="https://pb01.s3.bitiful.net/142.png" alt="avatar"></p><p>å’Œ AVL æ ‘ä¸åŒçš„æ˜¯ï¼Œçº¢é»‘æ ‘å¹¶ä¸è¿½æ±‚ä¸¥æ ¼çš„å¹³è¡¡ï¼Œè€Œæ˜¯å¤§è‡´çš„å¹³è¡¡ã€‚æ­£å› å¦‚æ­¤ï¼Œçº¢é»‘æ ‘çš„<strong>æŸ¥è¯¢æ•ˆç‡ç¨æœ‰ä¸‹é™</strong>ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„å¹³è¡¡æ€§ç›¸å¯¹è¾ƒå¼±ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ‘çš„é«˜åº¦è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ•°æ®éœ€è¦è¿›è¡Œå¤šæ¬¡ç£ç›˜ IO æ“ä½œæ‰èƒ½æŸ¥è¯¢åˆ°ï¼Œè¿™ä¹Ÿæ˜¯ MySQL æ²¡æœ‰é€‰æ‹©çº¢é»‘æ ‘çš„ä¸»è¦åŸå› ã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œçº¢é»‘æ ‘çš„<strong>æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡å¤§å¤§æé«˜äº†</strong>ï¼Œå› ä¸ºçº¢é»‘æ ‘åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶åªéœ€è¿›è¡Œ O(1) æ¬¡æ•°çš„æ—‹è½¬å’Œå˜è‰²æ“ä½œï¼Œå³å¯ä¿æŒåŸºæœ¬å¹³è¡¡çŠ¶æ€ï¼Œè€Œä¸éœ€è¦åƒ AVL æ ‘ä¸€æ ·è¿›è¡Œ O(logn) æ¬¡æ•°çš„æ—‹è½¬æ“ä½œã€‚</p><p>çº¢é»‘æ ‘çš„åº”ç”¨è¿˜æ˜¯æ¯”è¾ƒå¹¿æ³›çš„ï¼ŒTreeMapã€TreeSet ä»¥åŠ JDK1.8 çš„ HashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚å¯¹äºæ•°æ®åœ¨å†…å­˜ä¸­çš„è¿™ç§æƒ…å†µæ¥è¯´ï¼Œçº¢é»‘æ ‘çš„è¡¨ç°æ˜¯éå¸¸ä¼˜å¼‚çš„ã€‚</p><h4 id="B-æ ‘-B-æ ‘">B æ ‘&amp; B+æ ‘</h4><p>B æ ‘ä¹Ÿç§° B-æ ‘,å…¨ç§°ä¸º å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ ï¼ŒB+ æ ‘æ˜¯ B æ ‘çš„ä¸€ç§å˜ä½“ã€‚ç›®å‰å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨ B-Tree æˆ–å…¶å˜ç§ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><p><strong>B æ ‘&amp; B+æ ‘ä¸¤è€…æœ‰ä½•å¼‚åŒå‘¢ï¼Ÿ</strong></p><ul><li>B æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾é”®(key) ä¹Ÿå­˜æ”¾æ•°æ®(data)ï¼Œè€Œ B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾ key å’Œ dataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾ keyã€‚</li><li>B æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„;B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ã€‚</li><li>B æ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€Œ B+æ ‘çš„æ£€ç´¢æ•ˆç‡å°±å¾ˆç¨³å®šäº†ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­èŠ‚ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ã€‚</li><li>åœ¨ B æ ‘ä¸­è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°è¦æŸ¥æ‰¾çš„ä¸‹é™ï¼Œç„¶åå¯¹ B æ ‘è¿›è¡Œä¸­åºéå†ï¼Œç›´åˆ°æ‰¾åˆ°æŸ¥æ‰¾çš„ä¸Šé™ï¼›è€Œ B+æ ‘çš„èŒƒå›´æŸ¥è¯¢ï¼Œåªéœ€è¦å¯¹é“¾è¡¨è¿›è¡Œéå†å³å¯ã€‚</li></ul><p>ç»¼ä¸Šï¼ŒB+æ ‘ä¸ B æ ‘ç›¸æ¯”ï¼Œå…·å¤‡æ›´å°‘çš„ IO æ¬¡æ•°ã€æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡å’Œæ›´é€‚äºèŒƒå›´æŸ¥è¯¢è¿™äº›ä¼˜åŠ¿ã€‚</p><h3 id="ç´¢å¼•ç±»å‹æ€»ç»“">ç´¢å¼•ç±»å‹æ€»ç»“</h3><p><strong>åˆ†ç±»</strong></p><ul><li>ä¸»é”®ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆä¸å¯ä»¥æœ‰ NULLï¼‰+ è¡¨ä¸­åªæœ‰ä¸€ä¸ªã€‚</li><li>æ™®é€šç´¢å¼•ï¼šä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆå¯ä»¥æœ‰ NULLï¼‰ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚</li><li>è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ <code>ElasticSearch</code> ä»£æ›¿ã€‚</li></ul><p>MySQL 8.x ä¸­å®ç°çš„ç´¢å¼•æ–°ç‰¹æ€§ï¼š</p><ul><li>éšè—ç´¢å¼•ï¼šä¹Ÿç§°ä¸ºä¸å¯è§ç´¢å¼•ï¼Œä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ç»´æŠ¤ï¼Œé€šå¸¸ä¼šè½¯åˆ é™¤å’Œç°åº¦å‘å¸ƒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä¸»é”®ä¸èƒ½è®¾ç½®ä¸ºéšè—ï¼ˆåŒ…æ‹¬æ˜¾å¼è®¾ç½®æˆ–éšå¼è®¾ç½®ï¼‰ã€‚</li><li>é™åºç´¢å¼•ï¼šä¹‹å‰çš„ç‰ˆæœ¬å°±æ”¯æŒé€šè¿‡ desc æ¥æŒ‡å®šç´¢å¼•ä¸ºé™åºï¼Œä½†å®é™…ä¸Šåˆ›å»ºçš„ä»ç„¶æ˜¯å¸¸è§„çš„å‡åºç´¢å¼•ã€‚ç›´åˆ° MySQL 8.x ç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼•ã€‚å¦å¤–ï¼Œåœ¨ MySQL 8.x ç‰ˆæœ¬ä¸­ï¼Œä¸å†å¯¹ GROUP BY è¯­å¥è¿›è¡Œéšå¼æ’åºã€‚</li><li>å‡½æ•°ç´¢å¼•ï¼šä» MySQL 8.0.13 ç‰ˆæœ¬å¼€å§‹æ”¯æŒåœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ç´¢å¼•ä¸­å¯ä»¥åŒ…å«å‡½æ•°æˆ–è€…è¡¨è¾¾å¼ã€‚</li></ul><h4 id="ä¸»é”®ç´¢å¼•">ä¸»é”®ç´¢å¼•</h4><p><code>not null</code> +<code>unique</code></p><p>åœ¨ MySQL çš„ InnoDB çš„è¡¨ä¸­ï¼Œå½“æ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šè¡¨çš„ä¸»é”®æ—¶ï¼ŒInnoDB ä¼šè‡ªåŠ¨å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦æœ‰å”¯ä¸€ç´¢å¼•ä¸”ä¸å…è®¸å­˜åœ¨ null å€¼çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€‰æ‹©è¯¥å­—æ®µä¸ºé»˜è®¤çš„ä¸»é”®ï¼Œå¦åˆ™ InnoDB å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 6Byte çš„è‡ªå¢ä¸»é”®ã€‚</p><h4 id="äºŒçº§ç´¢å¼•">äºŒçº§ç´¢å¼•</h4><p>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ã€‚å³é€šè¿‡äºŒçº§ç´¢å¼•å¯ä»¥å®šä½ä¸»é”®.å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•å±äºäºŒçº§ç´¢å¼•</p><ul><li>æ™®é€šç´¢å¼•:ä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•:åˆ—å€¼å”¯ä¸€,ä½†å¯¹NULLä¸ç”Ÿæ•ˆ</li><li>å‰ç¼€ç´¢å¼•:ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå¯¹å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå¯ä»¥åªç´¢å¼•å­—æ®µçš„å‰å‡ ä¸ªå­—ç¬¦ã€‚</li><li>å…¨æ–‡ç´¢å¼•:åŸºäºåˆ†è¯,å¸¸ç”¨äºå¤§æ–‡æœ¬æœç´¢å…³é”®è¯,matchå’Œagainstå…³é”®å­—</li></ul><h4 id="èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•</h4><p>ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·æ”¾çš„ç´¢å¼•</p><h4 id="éèšç°‡ç´¢å¼•">éèšç°‡ç´¢å¼•</h4><p>ç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•,å¦‚äºŒçº§ç´¢å¼•</p><h3 id="ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢">ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢?</h3><p>è®¾ç½®è‡ªå¢å,æ’å…¥æ•°æ®æ—¶,æ’å…¥é€Ÿåº¦æ›´å¿«,å› ä¸ºæ¯æ¬¡æ’å…¥æ•°æ®æ—¶,æ•°æ®åº“ä¸ç”¨ç§»åŠ¨å…¶ä»–æ•°æ®,åªéœ€è¦ç§»åŠ¨æŒ‡é’ˆå³å¯.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„ç´¢å¼•å€¼éƒ½æ˜¯éšæœºçš„ï¼Œå› æ­¤æ¯æ¬¡æ’å…¥æ–°çš„æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šæ’å…¥åˆ°ç°æœ‰æ•°æ®é¡µä¸­é—´çš„æŸä¸ªä½ç½®ï¼Œè¿™å°†ä¸å¾—ä¸ç§»åŠ¨å…¶å®ƒæ•°æ®æ¥æ»¡è¶³æ–°æ•°æ®çš„æ’å…¥ï¼Œç”šè‡³éœ€è¦ä»ä¸€ä¸ªé¡µé¢å¤åˆ¶æ•°æ®åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬é€šå¸¸å°†è¿™ç§æƒ…å†µç§°ä¸º<strong>é¡µåˆ†è£‚</strong>ã€‚é¡µåˆ†è£‚è¿˜æœ‰å¯èƒ½ä¼šé€ æˆå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„ä¸ç´§å‡‘ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡</p><p><strong>éè‡ªå¢ä¸»é”®</strong>:</p><p><img src="https://pb01.s3.bitiful.net/yefen.webp" alt="avatar"><br><strong>è‡ªå¢ä¸»é”®</strong>:</p><p><img src="https://pb01.s3.bitiful.net/newyefen.webp" alt="avatar"></p><h3 id="é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º-NOT-NULL">é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º NOT NULL</h3><p>Mysqléš¾ä»¥ä¼˜åŒ–å¼•ç”¨å¯ç©ºåˆ—æŸ¥è¯¢ï¼Œå®ƒä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ã€‚å¯ç©ºåˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜éœ€è¦mysqlå†…éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¯ç©ºåˆ—è¢«ç´¢å¼•åï¼Œæ¯æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œè¿˜èƒ½å¯¼è‡´MYisamè¡¨ä¸­å›ºå®šå¤§å°çš„ç´¢å¼•å˜æˆå¯å˜å¤§å°çš„ç´¢å¼•ã€‚            â€”â€”â€”â€”ã€Šé«˜æ€§èƒ½MySQLã€‹</p><h3 id="References">References</h3><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLè§„èŒƒ</title>
      <link href="/2023/12/24/MySQL%E8%A7%84%E8%8C%83/"/>
      <url>/2023/12/24/MySQL%E8%A7%84%E8%8C%83/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLè§„èŒƒ">MySQLè§„èŒƒ</h2><h3 id="æ•°æ®åº“å‘½åè§„èŒƒ">æ•°æ®åº“å‘½åè§„èŒƒ</h3><ul><li>æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰²</li><li>æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨ MySQL ä¿ç•™å…³é”®å­—ï¼ˆå¦‚æœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰</li><li>æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€å¥½ä¸è¦è¶…è¿‡ 32 ä¸ªå­—ç¬¦</li><li>ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥ tmp_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥ bak_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ (æ—¶é—´æˆ³) ä¸ºåç¼€</li><li>æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰</li></ul><h3 id="æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ">æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ</h3><h4 id="æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨-InnoDB-å­˜å‚¨å¼•æ“">æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“</h4><p>æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ InnoDB æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“</p><h4 id="æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨-UTF8">æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8</h4><p>å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå¦‚æœæ•°æ®åº“ä¸­æœ‰å­˜å‚¨ emoji è¡¨æƒ…çš„éœ€è¦ï¼Œå­—ç¬¦é›†éœ€è¦é‡‡ç”¨ utf8mb4 å­—ç¬¦é›†ã€‚</p><h4 id="æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š">æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š</h4><p>ä½¿ç”¨ comment ä»å¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ï¼Œä»ä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤</p><h4 id="å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨-500-ä¸‡ä»¥å†…">å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨ 500 ä¸‡ä»¥å†…</h4><p>500 ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œåªæ˜¯ç»éªŒå€¼ï¼Œå¦‚æœå•è¡¨è¶…è¿‡ 500 ä¸‡åï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ€¥å‰§ä¸‹é™.è¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ï¼Œå¤‡ä»½ï¼Œæ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚</p><p>å¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°</p><h4 id="è°¨æ…ä½¿ç”¨-MySQL-åˆ†åŒºè¡¨">è°¨æ…ä½¿ç”¨ MySQL åˆ†åŒºè¡¨</h4><p>åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨ç°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªè¡¨ï¼›</p><p>è°¨æ…é€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆç‡å¯èƒ½æ›´ä½ï¼›</p><p>å»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ®ã€‚</p><h4 id="ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­">ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­</h4><p>é¿å…æ›´å¤šçš„å…³è”æ“ä½œã€‚</p><h4 id="ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ">ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ</h4><ul><li>é¢„ç•™å­—æ®µçš„å‘½åå¾ˆéš¾åšåˆ°è§åè¯†ä¹‰ã€‚</li><li>é¢„ç•™å­—æ®µæ— æ³•ç¡®è®¤å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•é€‰æ‹©åˆé€‚çš„ç±»å‹ã€‚</li><li>å¯¹é¢„ç•™å­—æ®µç±»å‹çš„ä¿®æ”¹ï¼Œä¼šå¯¹è¡¨è¿›è¡Œé”å®šã€‚</li></ul><h4 id="ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®">ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®</h4><p>åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶ä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ¶ˆè€—è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚</p><p>æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯</p><h4 id="ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š">ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œè®¾è®¡å…³ç³»æ•°æ®åº“æ—¶éœ€è¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œä½†ä¸ºäº†æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹†åˆ†å‡ºå¤šå¼ è¡¨ã€‚è€Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶éœ€è¦å¯¹å¤šå¼ è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œæœ‰æ—¶ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä¼šé™ä½èŒƒå¼çš„è¦æ±‚ï¼Œåœ¨è¡¨ä¸­ä¿å­˜ä¸€å®šçš„å†—ä½™ä¿¡æ¯ï¼Œä¹Ÿå«åšåèŒƒå¼ã€‚ä½†è¦æ³¨æ„åèŒƒå¼ä¸€å®šè¦é€‚åº¦ã€‚</p><h4 id="ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•">ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•</h4><h4 id="ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ-æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“">ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“</h4><h3 id="æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ">æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ</h3><h4 id="ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹">ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹</h4><p>å­˜å‚¨å­—èŠ‚è¶Šå°ï¼Œå ç”¨ä¹Ÿå°±ç©ºé—´è¶Šå°ï¼Œæ€§èƒ½ä¹Ÿè¶Šå¥½ã€‚</p><p><strong>a.æŸäº›å­—ç¬¦ä¸²å¯ä»¥è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨</strong>,æ¯”å¦‚å¯ä»¥å°† IP åœ°å€è½¬æ¢æˆæ•´å‹æ•°æ®ã€‚æ•°å­—æ˜¯è¿ç»­çš„ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å°ã€‚</p><p>MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€</p><ul><li><strong>INET_ATON()</strong>ï¼šæŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½)</li><li><strong>INET_NTOA()</strong> :æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ INET_ATON() æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ INET_NTOA() æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚</li></ul><p><strong>b.å¯¹äºéè´Ÿå‹çš„æ•°æ® (å¦‚è‡ªå¢ ID,æ•´å‹ IPï¼Œå¹´é¾„) æ¥è¯´,è¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨</strong>ã€‚æ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´</p><p><strong>c.å°æ•°å€¼ç±»å‹ï¼ˆæ¯”å¦‚å¹´é¾„ã€çŠ¶æ€è¡¨ç¤ºå¦‚ 0/1ï¼‰ä¼˜å…ˆä½¿ç”¨ TINYINT ç±»å‹ã€‚</strong></p><h4 id="é¿å…ä½¿ç”¨-TEXT-BLOB-ç±»å‹">é¿å…ä½¿ç”¨ TEXT,BLOB ç±»å‹</h4><p>æ¯”å¦‚ TEXT ç±»å‹çš„å­—æ®µï¼Œå¦‚æœæŸ¥è¯¢æ—¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œä¼šå˜æˆå…¨è¡¨æ‰«æï¼Œæ€§èƒ½æå·®</p><h4 id="é¿å…ä½¿ç”¨ENUMç±»å‹">é¿å…ä½¿ç”¨ENUMç±»å‹</h4><ul><li>ä¿®æ”¹ ENUM å€¼éœ€è¦ä½¿ç”¨ ALTER è¯­å¥ï¼›</li><li>ENUM ç±»å‹çš„ ORDER BY æ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œï¼›</li><li>ENUM æ•°æ®ç±»å‹å­˜åœ¨ä¸€äº›é™åˆ¶æ¯”å¦‚å»ºè®®ä¸è¦ä½¿ç”¨æ•°å€¼ä½œä¸º ENUM çš„æšä¸¾å€¼ã€‚</li></ul><h4 id="å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º-NOT-NULL">å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL</h4><ul><li>ç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ï¼›</li><li>è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†ã€‚</li></ul><h4 id="ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ">ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ</h4><p>å¯¹äºæ—¥æœŸç±»å‹æ¥è¯´ï¼Œ ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸã€‚å¯ä»¥è€ƒè™‘ DATETIMEã€TIMESTAMP å’Œ æ•°å€¼å‹æ—¶é—´æˆ³ã€‚</p><p>è¿™ä¸‰ç§ç§æ–¹å¼éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿ï¼Œæ ¹æ®å®é™…åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ‰æ˜¯ç‹é“ã€‚ä¸‹é¢å†å¯¹è¿™ä¸‰ç§æ–¹å¼åšä¸€ä¸ªç®€å•çš„å¯¹æ¯”ï¼Œä»¥ä¾›å¤§å®¶å®é™…å¼€å‘ä¸­é€‰æ‹©æ­£ç¡®çš„å­˜æ”¾æ—¶é—´çš„æ•°æ®ç±»å‹ï¼š</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">å­˜å‚¨ç©ºé—´</th><th style="text-align:center">æ—¥æœŸæ ¼å¼</th><th style="text-align:center">æ—¥æœŸèŒƒå›´</th><th style="text-align:center">æ˜¯å¦å¸¦æ—¶åŒºä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center">DATETIME</td><td style="text-align:center">5~8 å­—èŠ‚</td><td style="text-align:center">YYYY-MM-DD hh:mm:ss[.fraction]</td><td style="text-align:center">1000-01-01 00:00:00[.000000] ï½ 9999-12-31 23:59:59[.999999]</td><td style="text-align:center">å¦</td></tr><tr><td style="text-align:center">TIMESTAMP</td><td style="text-align:center">4~7 å­—èŠ‚</td><td style="text-align:center">YYYY-MM-DD hh:mm:ss[.fraction]</td><td style="text-align:center">1970-01-01 00:00:01[.000000] ï½ 2038-01-19 03:14:07[.999999]</td><td style="text-align:center">æ˜¯</td></tr><tr><td style="text-align:center">æ•°å€¼å‹æ—¶é—´æˆ³</td><td style="text-align:center">4 å­—èŠ‚</td><td style="text-align:center">å…¨æ•°å­—å¦‚ 1578707612</td><td style="text-align:center">1970-01-01 00:00:01 ä¹‹åçš„æ—¶é—´</td><td style="text-align:center">å¦</td></tr></tbody></table><h4 id="åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨-decimal-ç±»å‹">åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹</h4><p><strong>éç²¾å‡†æµ®ç‚¹ï¼šfloat,double</strong><br><strong>ç²¾å‡†æµ®ç‚¹ï¼šdecimal</strong></p><p>decimal ç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨<strong>è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦</strong>ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯ 4 ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨ 9 ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>å¹¶ä¸”ï¼Œdecimal å¯ç”¨äºå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´å‹æ•°æ®ä¸è¿‡ï¼Œ ç”±äº decimal éœ€è¦é¢å¤–çš„ç©ºé—´å’Œè®¡ç®—å¼€é”€ï¼Œåº”è¯¥å°½é‡åªåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œç²¾ç¡®è®¡ç®—æ—¶æ‰ä½¿ç”¨ decimal ã€‚</p><h4 id="å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ">å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ</h4><h3 id="ç´¢å¼•è®¾è®¡è§„èŒƒ">ç´¢å¼•è®¾è®¡è§„èŒƒ</h3><h4 id="é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡-å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡-5-ä¸ª">é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡,å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª</h4><p>ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·å¯ä»¥é™ä½æ•ˆç‡ã€‚</p><p>ç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>å› ä¸º MySQL ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œå°±ä¼šå¢åŠ  MySQL ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•">ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•</h4><p>å…¨æ–‡ç´¢å¼•ä¸é€‚ç”¨äº OLTP(è”æœºäº‹åŠ¡å¤„ç†) åœºæ™¯ã€‚</p><h4 id="ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•">ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•</h4><p>5.6 ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ª sql åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6 ä»¥åï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½ã€‚</p><h4 id="æ¯ä¸ª-InnoDB-è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®">æ¯ä¸ª InnoDB è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®</h4><p>InnoDB æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ã€‚</p><p>InnoDB æ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„:</p><ul><li>ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸ä½¿ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰</li><li>ä¸è¦ä½¿ç”¨ UUID,MD5,HASH,å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰</li><li>ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ ID å€¼</li></ul><h4 id="å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®">å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®</h4><ul><li>å‡ºç°åœ¨ SELECTã€UPDATEã€DELETE è¯­å¥çš„ WHERE ä»å¥ä¸­çš„åˆ—</li><li>åŒ…å«åœ¨ ORDER BYã€GROUP BYã€DISTINCT ä¸­çš„å­—æ®µ</li><li>å¹¶ä¸è¦å°†ç¬¦åˆ 1 å’Œ 2 ä¸­çš„å­—æ®µçš„åˆ—éƒ½å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œ é€šå¸¸å°† 1ã€2 ä¸­çš„å­—æ®µå»ºç«‹è”åˆç´¢å¼•æ•ˆæœæ›´å¥½</li><li>å¤šè¡¨ join çš„å…³è”åˆ—</li></ul><h4 id="å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº">å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº</h4><p>å»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯ï¼šå¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœº IOï¼Œå¢åŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚</p><ul><li>åŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦=åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡/åˆ—çš„æ€»è¡Œæ•°ï¼‰</li><li>å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIO æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰</li><li>ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰</li></ul><h4 id="é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰">é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰</h4><ul><li>é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id)</li><li>å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a)</li></ul><h4 id="å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•">å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•</h4><blockquote><p>è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ (where,select,order by,group by åŒ…å«çš„å­—æ®µ) çš„ç´¢å¼•</p></blockquote><p>è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š</p><ul><li><strong>é¿å… InnoDB è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢:</strong> InnoDB æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äº InnoDB æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li><li><strong>å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡:</strong> ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® IO è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ IO è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº IOã€‚</li></ul><h4 id="ç´¢å¼•-SET-è§„èŒƒ">ç´¢å¼• SET è§„èŒƒ</h4><p>å°½é‡é¿å…ä½¿ç”¨å¤–é”®çº¦æŸ</p><ul><li>ä¸å»ºè®®ä½¿ç”¨å¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼Œä½†ä¸€å®šè¦åœ¨è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”é”®ä¸Šå»ºç«‹ç´¢å¼•</li><li>å¤–é”®å¯ç”¨äºä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ï¼Œä½†å»ºè®®åœ¨ä¸šåŠ¡ç«¯å®ç°</li><li>å¤–é”®ä¼šå½±å“çˆ¶è¡¨å’Œå­è¡¨çš„å†™æ“ä½œä»è€Œé™ä½æ€§èƒ½</li></ul><h3 id="æ•°æ®åº“-SQL-å¼€å‘è§„èŒƒ">æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ</h3><h4 id="å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ">å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ</h4><h4 id="ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„-SQL-è¯­å¥">ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„ SQL è¯­å¥</h4><h4 id="å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•">å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•</h4><p>é¿å…ä½¿ç”¨åŒ%å·çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦‚ï¼š<code>a like '%123%'</code>ï¼Œï¼ˆå¦‚æœæ— å‰ç½®%,åªæœ‰åç½®%ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰</p><p>ä¸€ä¸ª SQL åªèƒ½åˆ©ç”¨åˆ°å¤åˆç´¢å¼•ä¸­çš„ä¸€åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚å¦‚ï¼šæœ‰ a,b,c åˆ—çš„è”åˆç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ a åˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™åœ¨ b,c åˆ—ä¸Šçš„ç´¢å¼•å°†ä¸ä¼šè¢«ç”¨åˆ°ã€‚</p><p>åœ¨å®šä¹‰è”åˆç´¢å¼•æ—¶ï¼Œå¦‚æœ a åˆ—è¦ç”¨åˆ°èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œå°±è¦æŠŠ a åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å³ä¾§ï¼Œä½¿ç”¨ left join æˆ– not exists æ¥ä¼˜åŒ– not in æ“ä½œï¼Œå› ä¸º not in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨-SELECT-å¿…é¡»ä½¿ç”¨-SELECT-å­—æ®µåˆ—è¡¨-æŸ¥è¯¢">ç¦æ­¢ä½¿ç”¨ SELECT * å¿…é¡»ä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢</h4><p><code>SELECT *</code> ä¼šæ¶ˆè€—æ›´å¤šçš„ CPUã€‚<br><code>SELECT *</code> æ— ç”¨å­—æ®µå¢åŠ ç½‘ç»œå¸¦å®½èµ„æºæ¶ˆè€—ï¼Œå¢åŠ æ•°æ®ä¼ è¾“æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¤§å­—æ®µï¼ˆå¦‚ varcharã€blobã€textï¼‰ã€‚<br><code>SELECT *</code> æ— æ³•ä½¿ç”¨ MySQL ä¼˜åŒ–å™¨è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼ˆåŸºäº MySQL ä¼˜åŒ–å™¨çš„â€œè¦†ç›–ç´¢å¼•â€ç­–ç•¥åˆæ˜¯é€Ÿåº¦æå¿«ï¼Œæ•ˆç‡æé«˜ï¼Œä¸šç•Œæä¸ºæ¨èçš„æŸ¥è¯¢ä¼˜åŒ–æ–¹å¼ï¼‰<br><code>SELECT &lt;å­—æ®µåˆ—è¡¨&gt;</code> å¯å‡å°‘è¡¨ç»“æ„å˜æ›´å¸¦æ¥çš„å½±å“</p><h4 id="ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„-INSERT-è¯­å¥">ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„ INSERT è¯­å¥</h4><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åº”ä½¿ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t(c1,c2,c3) <span class="keyword">values</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ">å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ</h4><ul><li>é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘ SQL ç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€ SQL æ‰€å¸¦æ¥çš„ SQL æ³¨å…¥çš„é—®é¢˜ã€‚</li><li>åªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’ SQL è¯­å¥æ›´é«˜æ•ˆã€‚</li><li>ç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">prepare</span> ins <span class="keyword">from</span> <span class="string">&#x27;insert into t select ?,?&#x27;</span>;  #é¢„ç¼–è¯‘</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@a</span><span class="operator">=</span><span class="number">999</span>,<span class="variable">@b</span><span class="operator">=</span><span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="keyword">execute</span> ins <span class="keyword">using</span> <span class="variable">@a</span>,<span class="variable">@b</span>; #ä¼ å‚ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥</span><br></pre></td></tr></table></figure><h4 id="é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢">é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢</h4><h4 id="é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º-join-æ“ä½œ">é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œ</h4><p>é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL(ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥) æ—¶,æ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š</strong> å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p><h4 id="é¿å…ä½¿ç”¨-JOIN-å…³è”å¤ªå¤šçš„è¡¨">é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨</h4><p>ä¼šå ç”¨å¤§é‡å†…å­˜,æœ‰å¯èƒ½å‡ºç°å†…å­˜æº¢å‡º</p><h4 id="å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°">å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°</h4><p>æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œï¼Œåˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆç‡ã€‚</p><h4 id="å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ-or-åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨-in-ä»£æ›¿-or">å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ or åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨ in ä»£æ›¿ or</h4><p>in çš„å€¼ä¸è¦è¶…è¿‡ 500 ä¸ªï¼Œin æ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œor å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨-order-by-rand-è¿›è¡Œéšæœºæ’åº">ç¦æ­¢ä½¿ç”¨ order by rand() è¿›è¡Œéšæœºæ’åº</h4><p>order by rand() ä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU å’Œ IO åŠå†…å­˜èµ„æºã€‚æ¨èåœ¨ç¨‹åºä¸­è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æ–¹å¼ã€‚</p><h4 id="WHERE-ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—">WHERE ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—</h4><p>å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•</p><p><strong>ä¸æ¨èï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> <span class="type">date</span>(create_time)<span class="operator">=</span><span class="string">&#x27;20190101&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>æ¨èï¼š</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> create_time <span class="operator">&gt;=</span> <span class="string">&#x27;20190101&#x27;</span> <span class="keyword">and</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;20190102&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨-UNION-ALL-è€Œä¸æ˜¯-UNION">åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION</h4><ul><li>UNION ä¼šæŠŠä¸¤ä¸ªç»“æœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åå†è¿›è¡Œå»é‡æ“ä½œ</li><li>UNION ALL ä¸ä¼šå†å¯¹ç»“æœé›†è¿›è¡Œå»é‡æ“ä½œ</li></ul><h4 id="æ‹†åˆ†å¤æ‚çš„å¤§-SQL-ä¸ºå¤šä¸ªå°-SQL">æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL</h4><ul><li>å¤§ SQL é€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„ SQL</li><li>MySQL ä¸­ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®—</li><li>SQL æ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡</li></ul><h4 id="ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢">ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢</h4><ul><li>ä¸ºæ•°æ®åº“è¿ç§»å’Œåˆ†åº“åˆ†è¡¨ç•™å‡ºä½™åœ°</li><li>é™ä½ä¸šåŠ¡è€¦åˆåº¦</li><li>é¿å…æƒé™è¿‡å¤§è€Œäº§ç”Ÿçš„å®‰å…¨é£é™©</li></ul><h3 id="æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ">æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ</h3><h4 id="è¶…-100-ä¸‡è¡Œçš„æ‰¹é‡å†™-UPDATE-DELETE-INSERT-æ“ä½œ-è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ">è¶… 100 ä¸‡è¡Œçš„æ‰¹é‡å†™ (UPDATE,DELETE,INSERT) æ“ä½œ,è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ</h4><p><strong>å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿ</strong></p><p>ä¸»ä»ç¯å¢ƒä¸­,å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿï¼Œå¤§æ‰¹é‡çš„å†™æ“ä½œä¸€èˆ¬éƒ½éœ€è¦æ‰§è¡Œä¸€å®šé•¿çš„æ—¶é—´ï¼Œè€Œåªæœ‰å½“ä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šåœ¨å…¶ä»–ä»åº“ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥ä¼šé€ æˆä¸»åº“ä¸ä»åº“é•¿æ—¶é—´çš„å»¶è¿Ÿæƒ…å†µ</p><p><strong>binlog æ—¥å¿—ä¸º row æ ¼å¼æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—</strong></p><p>å¤§æ‰¹é‡å†™æ“ä½œä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯å¯¹äº row æ ¼å¼äºŒè¿›åˆ¶æ•°æ®è€Œè¨€ï¼Œç”±äºåœ¨ row æ ¼å¼ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®è¶Šå¤šï¼Œäº§ç”Ÿçš„æ—¥å¿—é‡ä¹Ÿå°±ä¼šè¶Šå¤šï¼Œæ—¥å¿—çš„ä¼ è¾“å’Œæ¢å¤æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆä¸»ä»å»¶è¿Ÿçš„ä¸€ä¸ªåŸå› </p><p><strong>é¿å…äº§ç”Ÿå¤§äº‹åŠ¡æ“ä½œ</strong></p><p>å¤§æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼Œä¸€å®šæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ï¼Œè¿™å°±ä¼šé€ æˆè¡¨ä¸­å¤§æ‰¹é‡æ•°æ®è¿›è¡Œé”å®šï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„é˜»å¡ï¼Œé˜»å¡ä¼šå¯¹ MySQL çš„æ€§èƒ½äº§ç”Ÿéå¸¸å¤§çš„å½±å“ã€‚ç‰¹åˆ«æ˜¯é•¿æ—¶é—´çš„é˜»å¡ä¼šå æ»¡æ‰€æœ‰æ•°æ®åº“çš„å¯ç”¨è¿æ¥ï¼Œè¿™ä¼šä½¿ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¶ä»–åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œå› æ­¤ä¸€å®šè¦æ³¨æ„å¤§æ‰¹é‡å†™æ“ä½œè¦è¿›è¡Œåˆ†æ‰¹</p><h4 id="å¯¹äºå¤§è¡¨ä½¿ç”¨-pt-online-schema-change-ä¿®æ”¹è¡¨ç»“æ„">å¯¹äºå¤§è¡¨ä½¿ç”¨ pt-online-schema-change ä¿®æ”¹è¡¨ç»“æ„</h4><ul><li>é¿å…å¤§è¡¨ä¿®æ”¹äº§ç”Ÿçš„ä¸»ä»å»¶è¿Ÿ</li><li>é¿å…åœ¨å¯¹è¡¨å­—æ®µè¿›è¡Œä¿®æ”¹æ—¶è¿›è¡Œé”è¡¨</li></ul><p>å¯¹å¤§è¡¨æ•°æ®ç»“æ„çš„ä¿®æ”¹ä¸€å®šè¦è°¨æ…ï¼Œä¼šé€ æˆä¸¥é‡çš„é”è¡¨æ“ä½œï¼Œå°¤å…¶æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæ˜¯ä¸èƒ½å®¹å¿çš„ã€‚</p><p><code>pt-online-schema-change</code> å®ƒä¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ªä¸åŸè¡¨ç»“æ„ç›¸åŒçš„æ–°è¡¨ï¼Œå¹¶ä¸”åœ¨æ–°è¡¨ä¸Šè¿›è¡Œè¡¨ç»“æ„çš„ä¿®æ”¹ï¼Œç„¶åå†æŠŠåŸè¡¨ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œå¹¶åœ¨åŸè¡¨ä¸­å¢åŠ ä¸€äº›è§¦å‘å™¨ã€‚æŠŠåŸè¡¨ä¸­æ–°å¢çš„æ•°æ®ä¹Ÿå¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œåœ¨è¡Œæ‰€æœ‰æ•°æ®å¤åˆ¶å®Œæˆä¹‹åï¼ŒæŠŠæ–°è¡¨å‘½åæˆåŸè¡¨ï¼Œå¹¶æŠŠåŸæ¥çš„è¡¨åˆ é™¤æ‰ã€‚æŠŠåŸæ¥ä¸€ä¸ª DDL æ“ä½œï¼Œåˆ†è§£æˆå¤šä¸ªå°çš„æ‰¹æ¬¡è¿›è¡Œã€‚</p><h4 id="ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ-super-æƒé™">ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ super æƒé™</h4><ul><li>å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œè¿˜è¿è¡Œ 1 ä¸ªæœ‰ super æƒé™çš„ç”¨æˆ·è¿æ¥</li><li>super æƒé™åªèƒ½ç•™ç»™ DBA å¤„ç†é—®é¢˜çš„è´¦å·ä½¿ç”¨</li></ul><h4 id="å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·-éµå¾ªæƒé™æœ€å°åŸåˆ™">å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·,éµå¾ªæƒé™æœ€å°åŸåˆ™</h4><ul><li>ç¨‹åºä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ª DB ä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“</li><li>ç¨‹åºä½¿ç”¨çš„è´¦å·åŸåˆ™ä¸Šä¸å‡†æœ‰ drop æƒé™</li></ul><p><strong>Reference:</strong><br><a href="https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">MySQLé«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé”</title>
      <link href="/2023/12/21/MySQL%E9%94%81/"/>
      <url>/2023/12/21/MySQL%E9%94%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="MySQLé”">MySQLé”</h3><h4 id="è¡¨çº§é”å’Œè¡Œçº§é”">è¡¨çº§é”å’Œè¡Œçº§é”</h4><p><strong>MyISAM</strong> (MySQL5.5ç‰ˆæœ¬ä»¥å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“) ä»…ä»…æ”¯æŒè¡¨çº§é”ï¼Œä¸€é”å°±é”æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ€§éå¸¸å·®ã€‚</p><p><strong>InnoDB</strong> (MySQL5.5ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“) ä¸å…‰æ”¯æŒè¡¨çº§é”ï¼Œè¿˜æ”¯æŒè¡Œçº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚</p><p><strong>è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”ï¼š</strong></p><ul><li><p><strong>è¡¨çº§é”</strong>ï¼š MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚ä¸è¿‡ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æä½ã€‚è¡¨çº§é”å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</p></li><li><p><strong>è¡Œçº§é”</strong>ï¼š MySQL ä¸­é”çš„ç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯ é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é” ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚<strong>å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”</strong>ã€‚è¡Œçº§é”å’Œå­˜å‚¨å¼•æ“æœ‰å…³ï¼Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚é¢å®ç°çš„ã€‚</p></li></ul><p>InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œè¡¨çº§é”æ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ UPDATEã€DELETE è¯­å¥æ—¶ï¼Œå¦‚æœ WHEREæ¡ä»¶ä¸­å­—æ®µæ²¡æœ‰å‘½ä¸­å”¯ä¸€ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ‰«æå…¨è¡¨å¯¹è¡¨ä¸­çš„æ‰€æœ‰è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚</p><h4 id="InnoDB-æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ">InnoDB æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ</h4><p>MySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š</p><ul><li><strong>è®°å½•é”</strong>ï¼ˆRecord Lockï¼‰ï¼šå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚</li><li><strong>é—´éš™é”</strong>ï¼ˆGap Lockï¼‰ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li></ul><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å°±æ— æ³•æ’å…¥ id = 4 è¿™æ¡è®°å½•äº†ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é˜²æ­¢å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</p><p><img src="https://pb01.s3.bitiful.net/gap.drawio.webp" alt="avatar"></p><p>é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚</p><ul><li><strong>ä¸´é”®é”</strong>ï¼ˆNext-Key Lockï¼‰ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p>Next-Key Lock ç§°ä¸ºä¸´é”®é”ï¼Œæ˜¯ Record Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸º(3ï¼Œ5] çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å³ä¸èƒ½æ’å…¥ id = 4 è®°å½•ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ id = 5 è¿™æ¡è®°å½•ã€‚</p><p><img src="https://pb01.s3.bitiful.net/nextkey.drawio.webp" alt="avatar"></p><p>next-key lock æ˜¯åŒ…å«é—´éš™é”+è®°å½•é”çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„ã€‚</p><p>è™½ç„¶ç›¸åŒèŒƒå›´çš„é—´éš™é”æ˜¯å¤šä¸ªäº‹åŠ¡ç›¸äº’å…¼å®¹çš„ï¼Œä½†å¯¹äºè®°å½•é”ï¼Œæˆ‘ä»¬æ˜¯è¦è€ƒè™‘ X å‹ä¸ S å‹å…³ç³»ï¼ŒX å‹çš„è®°å½•é”ä¸ X å‹çš„è®°å½•é”æ˜¯å†²çªçš„ã€‚</p><p>åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« <code>REPEATABLE-READ</code>(å¯é‡å¤è¯») ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>Next-Key Lock</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ <code>Next-Key Lock</code> è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º <code>Record Lock</code>ï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</p><h4 id="æ„å‘é”">æ„å‘é”</h4><p>å¦‚æœéœ€è¦ç”¨åˆ°è¡¨é”çš„è¯ï¼Œå¦‚ä½•åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ²¡æœ‰è¡Œé”å‘¢(<strong>è¡¨é”å’Œè¡Œé”æ˜¯æ»¡è¶³è¯»è¯»å…±äº«ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥çš„</strong>)ï¼Œä¸€è¡Œä¸€è¡Œéå†è‚¯å®šæ˜¯ä¸è¡Œï¼Œæ€§èƒ½å¤ªå·®ã€‚æˆ‘ä»¬éœ€è¦ç”¨åšæ„å‘é”æ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚</p><p>æ˜¯ä¸€ç§è¡¨çº§é”ã€‚</p><p>æ„å‘é”æ˜¯ä¸€ç§è¡¨çº§é”,åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>æ„å‘å…±äº«é”</strong>ï¼ˆISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”</li><li><strong>æ„å‘æ’ä»–é”</strong>ï¼ˆIXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”</li></ul><p>æ„å‘é”æ˜¯ç”±æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº«/æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚</p><p>æ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„:</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">IS é”</th><th style="text-align:center">IX é”</th></tr></thead><tbody><tr><td style="text-align:center">IS é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr><tr><td style="text-align:center">IX é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr></tbody></table><p>æ„å‘é”å’Œå…±äº«é”å’Œæ’å®ƒé”äº’æ–¥ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼‰ã€‚</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">IS é”</th><th style="text-align:center">IX é”</th></tr></thead><tbody><tr><td style="text-align:center">S é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">äº’æ–¥</td></tr><tr><td style="text-align:center">X é”</td><td style="text-align:center">äº’æ–¥</td><td style="text-align:center">äº’æ–¥</td></tr></tbody></table><h4 id="è‡ªå¢é”">è‡ªå¢é”</h4><p>è®¾ç½®<code>AUTO_INCREMENT</code>çš„åˆ—éƒ½ä¼šæ¶‰åŠåˆ°è‡ªå¢é”.</p><p>AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œé”ä¸æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾ã€‚</p><p>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”ï¼Œç„¶åä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µèµ‹å€¼(é€’å¢çš„å€¼)ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å¦‚æœè¦å‘è¯¥è¡¨æ’å…¥è¯­å¥éƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œä¿è¯æ’å…¥æ•°æ®æ—¶ï¼Œè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µçš„å€¼æ˜¯è¿ç»­é€’å¢çš„ã€‚</p><p>ä½†æ˜¯ï¼Œ AUTO-INC é”å†å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œä¼šå½±å“æ’å…¥æ€§èƒ½ï¼Œå› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ’å…¥ä¼šè¢«é˜»å¡ã€‚</p><p>å› æ­¤ï¼Œ åœ¨ MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§è½»é‡çº§çš„é”æ¥å®ç°è‡ªå¢ã€‚</p><p>ä¸€æ ·ä¹Ÿæ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸ª <code>innodb_autoinc_lock_mode</code> çš„ç³»ç»Ÿå˜é‡ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶é€‰æ‹©ç”¨ AUTO-INC é”ï¼Œè¿˜æ˜¯è½»é‡çº§çš„é”ã€‚</p><table><thead><tr><th style="text-align:center">innodb_autoinc_lock_mode</th><th style="text-align:center">ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">ä¼ ç»Ÿæ¨¡å¼</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">è¿ç»­æ¨¡å¼ï¼ˆMySQL 8.0 ä¹‹å‰é»˜è®¤ï¼‰</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">äº¤é”™æ¨¡å¼(MySQL 8.0 ä¹‹åé»˜è®¤)</td></tr></tbody></table><ul><li>å½“ <strong>innodb_autoinc_lock_mode = 0</strong>ï¼Œå°±é‡‡ç”¨ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼›</li><li>å½“ <strong>innodb_autoinc_lock_mode = 2</strong>ï¼Œå°±é‡‡ç”¨è½»é‡çº§é”ï¼Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰è¯­å¥æ‰§è¡Œåæ‰é‡Šæ”¾ã€‚</li><li>å½“ <strong>innodb_autoinc_lock_mode = 1</strong>ï¼š<ul><li>æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›</li><li>ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›</li></ul></li></ul><h4 id="References">References</h4><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLäº‹åŠ¡</title>
      <link href="/2023/12/21/MySQL%E4%BA%8B%E5%8A%A1/"/>
      <url>/2023/12/21/MySQL%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="MySQLäº‹åŠ¡">MySQLäº‹åŠ¡</h3><h4 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡">ä»€ä¹ˆæ˜¯äº‹åŠ¡</h4><p><strong>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</strong>ã€‚</p><p>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»éƒ½æˆåŠŸæˆ–è€…éƒ½å¤±è´¥ã€‚</p><ol><li>å°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒ</li><li>å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒ</li></ol><p>äº‹åŠ¡ä¼šæŠŠè¿™ä¸¤ä¸ªæ“ä½œçœ‹æˆé€»è¾‘ä¸Šçš„ä¸€ä¸ªæ•´ä½“ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢å´å¹¶æ²¡æœ‰å¢åŠ çš„æƒ…å†µã€‚</p><h4 id="æ•°æ®åº“äº‹åŠ¡">æ•°æ®åº“äº‹åŠ¡</h4><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æŒ‡åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯æ•°æ®åº“äº‹åŠ¡ã€‚</p><p>æ•°æ®åº“äº‹åŠ¡åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ¥è§¦çš„æœ€å¤šäº†ã€‚å¦‚æœä½ çš„é¡¹ç›®å±äºå•ä½“æ¶æ„çš„è¯ï¼Œä½ æ¥è§¦åˆ°çš„å¾€å¾€å°±æ˜¯æ•°æ®åº“äº‹åŠ¡äº†ã€‚é‚£æ•°æ®åº“äº‹åŠ¡æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼Œæ•°æ®åº“äº‹åŠ¡å¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¹Ÿå°±æ˜¯ SQL è¯­å¥ï¼‰æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ã€‚æ„æˆè¿™ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“çš„è¿™äº›æ•°æ®åº“æ“ä½œéµå¾ªï¼š<strong>è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</strong> ã€‚</p><p><img src="https://pb01.s3.bitiful.net/140.png" alt="avatar"></p><h4 id="äº‹åŠ¡çš„-ACID-ç‰¹æ€§">äº‹åŠ¡çš„ ACID ç‰¹æ€§</h4><p>ACIDï¼Œæ˜¯æŒ‡å…³ç³»å‹æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ‰§è¡Œçš„å››ä¸ªåŸºæœ¬è¦ç´ çš„ç¼©å†™ã€‚åŒ…å«ï¼š</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</li></ul><h5 id="åŸå­æ€§ï¼ˆAtomicityï¼‰">åŸå­æ€§ï¼ˆAtomicityï¼‰</h5><p><strong>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</strong></p><p>äº‹åŠ¡çš„åŸå­æ€§æ˜¯äº‹åŠ¡<strong>æœ€æ ¸å¿ƒ</strong>çš„ç‰¹æ€§ã€‚</p><h5 id="ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰">ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</h5><p><strong>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ã€‚</strong></p><p>æ¯”å¦‚å°æ˜ç»™å°çº¢è½¬è´¦ï¼Œè½¬è´¦å‰åå°æ˜å’Œå°çº¢çš„ä½™é¢çš„å˜åŒ–å¤§å°æ˜¯ç›¸åŒçš„ã€‚</p><h5 id="éš”ç¦»æ€§ï¼ˆIsolationï¼‰">éš”ç¦»æ€§ï¼ˆIsolationï¼‰</h5><p><strong>éš”ç¦»æ€§æ˜¯æŒ‡å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶ä»–ç”¨æˆ·çš„äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚</strong></p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·æ­£åœ¨æ“ä½œæ•°æ®åº“ Aï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½æ“ä½œæ•°æ®åº“ Aã€‚</p><h5 id="æŒä¹…æ€§ï¼ˆDurabilityï¼‰">æŒä¹…æ€§ï¼ˆDurabilityï¼‰</h5><p><strong>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥å³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶å½±å“ã€‚</strong></p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å·²ç»å†™å…¥ç£ç›˜ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœï¼Œè¿™ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜ä¹Ÿä¸åº”è¯¥ä¸¢å¤±ã€‚</p><p>ğŸŒˆ è¿™é‡Œè¦é¢å¤–è¡¥å……ä¸€ç‚¹ï¼šåªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ä¹Ÿå°±æ˜¯è¯´ <strong>Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„</strong>ï¼</p><h4 id="MySQLäº‹åŠ¡æ“ä½œ">MySQLäº‹åŠ¡æ“ä½œ</h4><p>mysqlä¸­äº‹åŠ¡<strong>é»˜è®¤æ˜¯éšå¼äº‹åŠ¡</strong>ï¼Œæ‰§è¡Œinsertã€updateã€deleteæ“ä½œçš„æ—¶å€™ï¼Œæ•°æ®åº“è‡ªåŠ¨å¼€å¯äº‹åŠ¡ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p><p>æ˜¯å¦å¼€å¯éšå¼äº‹åŠ¡æ˜¯ç”±å˜é‡autocommitæ§åˆ¶çš„ã€‚</p><h4 id="éšå¼äº‹åŠ¡">éšå¼äº‹åŠ¡</h4><p>äº‹åŠ¡è‡ªåŠ¨å¼€å¯ã€æäº¤æˆ–å›æ»šï¼Œæ¯”å¦‚insertã€updateã€deleteè¯­å¥ï¼Œäº‹åŠ¡çš„å¼€å¯ã€æäº¤æˆ–å›æ»šç”±mysqlå†…éƒ¨è‡ªåŠ¨æ§åˆ¶çš„ã€‚</p><p>æŸ¥çœ‹å˜é‡autocommitæ˜¯å¦å¼€å¯äº†è‡ªåŠ¨æäº¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;autocommit&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> autocommit   <span class="operator">|</span> <span class="keyword">ON</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="æ˜¾å¼äº‹åŠ¡">æ˜¾å¼äº‹åŠ¡</h4><p>æ˜¾å¼äº‹åŠ¡éœ€è¦æ‰‹åŠ¨å¼€å¯ã€æäº¤æˆ–å›æ»šï¼Œç”±å¼€å‘è€…è‡ªå·±æ§åˆ¶ã€‚</p><p><strong>æ–¹å¼1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®ä¸è‡ªåŠ¨æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"># æ‰§è¡Œäº‹åŠ¡æ“ä½œ</span><br><span class="line">SQL1,SQL2...</span><br><span class="line">## æäº¤æˆ–å›æ»š</span><br><span class="line"><span class="keyword">commit</span><span class="operator">|</span><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯ä¸€ä¸ªäº‹åŠ¡</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"># æ‰§è¡Œäº‹åŠ¡æ“ä½œ</span><br><span class="line">SQL1,SQL2...</span><br><span class="line">## æäº¤æˆ–å›æ»š</span><br><span class="line"><span class="keyword">commit</span><span class="operator">|</span><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><h4 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜">å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜?</h4><p>åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚</p><h5 id="è„è¯»ï¼ˆDirty-readï¼‰">è„è¯»ï¼ˆDirty readï¼‰</h5><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡æ¥è¯´æ˜¯å¯è§çš„ï¼Œå³ä½¿å½“å‰äº‹åŠ¡æ²¡æœ‰æäº¤ã€‚è¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†è¿™ä¸ªè¿˜æœªæäº¤çš„æ•°æ®ï¼Œä½†ç¬¬ä¸€ä¸ªäº‹åŠ¡çªç„¶å›æ»šï¼Œå¯¼è‡´æ•°æ®å¹¶æ²¡æœ‰è¢«æäº¤åˆ°æ•°æ®åº“ï¼Œé‚£ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯è„è¯»çš„ç”±æ¥ã€‚</p><h5 id="ä¸¢å¤±ä¿®æ”¹ï¼ˆLost-to-modifyï¼‰">ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰</h5><p>åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚</p><h5 id="ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable-readï¼‰">ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable readï¼‰</h5><p>æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><h5 id="å¹»è¯»ï¼ˆPhantom-readï¼‰">å¹»è¯»ï¼ˆPhantom readï¼‰</h5><p>å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°æœ‰å®ƒæœ¬æ¥æ²¡æœ‰çš„æ•°æ®ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚</p><p><strong>ä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><p><code>ä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤ã€‚</code></p><h4 id="å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ">å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4><p>MySQL ä¸­å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æ— éå°±ä¸¤ç§ï¼š<strong>é” å’Œ MVCC</strong>ã€‚é”å¯ä»¥çœ‹ä½œæ˜¯æ‚²è§‚æ§åˆ¶çš„æ¨¡å¼ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¹è§‚æ§åˆ¶çš„æ¨¡å¼ã€‚</p><p>é”æ§åˆ¶æ–¹å¼ä¸‹ä¼šé€šè¿‡é”æ¥æ˜¾ç¤ºæ§åˆ¶å…±äº«èµ„æºè€Œä¸æ˜¯é€šè¿‡è°ƒåº¦æ‰‹æ®µï¼ŒMySQLä¸­ä¸»è¦æ˜¯é€šè¿‡<strong>è¯»å†™é”</strong>æ¥å®ç°å¹¶å‘æ§åˆ¶ã€‚</p><ul><li><strong>å…±äº«é”ï¼ˆS é”ï¼‰</strong>ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚</li><li><strong>æ’ä»–é”ï¼ˆX é”ï¼‰</strong>ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡è®°å½•åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚</li></ul><p>è¯»å†™é”å¯ä»¥åšåˆ°è¯»è¯»å¹¶è¡Œï¼Œä½†æ˜¯æ— æ³•åšåˆ°å†™è¯»ã€å†™å†™å¹¶è¡Œã€‚å¦å¤–ï¼Œæ ¹æ®æ ¹æ®é”ç²’åº¦çš„ä¸åŒï¼Œåˆè¢«åˆ†ä¸ºè¡¨çº§é” å’Œ è¡Œçº§é”ã€‚InnoDB(MySQL5.5ç‰ˆæœ¬åçš„é»˜è®¤å­˜å‚¨å¼•æ“) ä¸å…‰æ”¯æŒè¡¨çº§é”ï¼Œè¿˜æ”¯æŒè¡Œçº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚</p><p>è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚ä¸è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨å…±äº«é”å’Œæ’ä»–é”ã€‚</p><p>MVCC æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ–¹æ³•ï¼Œå³å¯¹ä¸€ä»½æ•°æ®ä¼šå­˜å‚¨å¤šä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡äº‹åŠ¡çš„å¯è§æ€§æ¥ä¿è¯äº‹åŠ¡èƒ½çœ‹åˆ°è‡ªå·±åº”è¯¥çœ‹åˆ°çš„ç‰ˆæœ¬ã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬åˆ†é…å™¨æ¥ä¸ºæ¯ä¸€è¡Œæ•°æ®è®¾ç½®ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æ˜¯å”¯ä¸€çš„ã€‚</p><p>MVCC åœ¨ MySQL ä¸­å®ç°æ‰€ä¾èµ–çš„æ‰‹æ®µä¸»è¦æ˜¯: <strong>éšè—å­—æ®µã€read viewã€undo log</strong>ã€‚</p><ul><li>undo log : undo log ç”¨äºè®°å½•æŸè¡Œæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚</li><li>read view å’Œ éšè—å­—æ®µ : ç”¨æ¥åˆ¤æ–­å½“å‰ç‰ˆæœ¬æ•°æ®çš„å¯è§æ€§ã€‚</li></ul><h4 id="éš”ç¦»çº§åˆ«">éš”ç¦»çº§åˆ«</h4><p>SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</p><ul><li>READ-UNCOMMITTED(è¯»å–æœªæäº¤) ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</li><li>READ-COMMITTED(è¯»å–å·²æäº¤) ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>REPEATABLE-READ(å¯é‡å¤è¯») ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–) ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚</li></ul><p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>SELECT @@tx_isolation;</code>å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º<code>SELECT @@transaction_isolation;</code></p><p>ä»ä¸Šé¢å¯¹ SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†çš„ SQL éš”ç¦»çº§åˆ«å®šä¹‰é‡Œï¼ŒREPEATABLE-READ(å¯é‡å¤è¯»)æ˜¯ä¸å¯ä»¥é˜²æ­¢å¹»è¯»çš„ã€‚</p><p>ä½†æ˜¯ï¼InnoDB å®ç°çš„ REPEATABLE-READ éš”ç¦»çº§åˆ«å…¶å®æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š</p><ul><li><strong>å¿«ç…§è¯»</strong>ï¼šç”± MVCC æœºåˆ¶æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚</li><li><strong>å½“å‰è¯»</strong>ï¼šä½¿ç”¨ Next-Key Lock è¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ï¼ŒNext-Key Lock æ˜¯è¡Œé”ï¼ˆRecord Lockï¼‰å’Œé—´éš™é”ï¼ˆGap Lockï¼‰çš„ç»“åˆï¼Œè¡Œé”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è¡Œï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è¡Œï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p>å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯ READ-COMMITTED ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ REPEATABLE-READ å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ° SERIALIZABLE éš”ç¦»çº§åˆ«ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸¾ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜è¿™å››ç§éš”ç¦»çº§åˆ«ï¼Œæœ‰ä¸€å¼ è´¦æˆ·ä½™é¢è¡¨ï¼Œé‡Œé¢æœ‰ä¸€æ¡è´¦æˆ·ä½™é¢ä¸º 100 ä¸‡çš„è®°å½•ã€‚ç„¶åæœ‰ä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ A åªè´Ÿè´£æŸ¥è¯¢ä½™é¢ï¼Œäº‹åŠ¡ B åˆ™ä¼šå°†æˆ‘çš„ä½™é¢æ”¹æˆ 200 ä¸‡ï¼Œä¸‹é¢æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œä¸¤ä¸ªäº‹åŠ¡çš„è¡Œä¸ºï¼š</p><p><img src="https://pb01.s3.bitiful.net/45.webp" alt="avatar"></p><p>åœ¨ä¸åŒéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A æ‰§è¡Œè¿‡ç¨‹ä¸­æŸ¥è¯¢åˆ°çš„ä½™é¢å¯èƒ½ä¼šä¸åŒï¼š</p><ul><li><p><code>ã€Œè¯»æœªæäº¤ã€</code>:äº‹åŠ¡ B ä¿®æ”¹ä½™é¢åï¼Œè™½ç„¶æ²¡æœ‰æäº¤äº‹åŠ¡ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä½™é¢å·²ç»å¯ä»¥è¢«äº‹åŠ¡ A çœ‹è§äº†ï¼Œäºæ˜¯äº‹åŠ¡ A ä¸­ä½™é¢ V1 æŸ¥è¯¢çš„å€¼æ˜¯ 200 ä¸‡ï¼Œä½™é¢ V2ã€V3 è‡ªç„¶ä¹Ÿæ˜¯ 200 ä¸‡äº†ï¼›</p></li><li><p><code>ã€Œè¯»å·²æäº¤ã€</code>:äº‹åŠ¡ B ä¿®æ”¹ä½™é¢åï¼Œå› ä¸ºæ²¡æœ‰æäº¤äº‹åŠ¡ï¼Œæ‰€ä»¥äº‹åŠ¡ A ä¸­ä½™é¢ V1 çš„å€¼è¿˜æ˜¯ 100 ä¸‡ï¼Œç­‰äº‹åŠ¡ B æäº¤å®Œåï¼Œæœ€æ–°çš„ä½™é¢æ•°æ®æ‰èƒ½è¢«äº‹åŠ¡ A çœ‹è§ï¼Œå› æ­¤é¢ V2ã€V3 éƒ½æ˜¯ 200 ä¸‡ï¼›</p></li><li><p><code>ã€Œå¯é‡å¤è¯»ã€</code>:äº‹åŠ¡ A åªèƒ½çœ‹è§å¯åŠ¨äº‹åŠ¡æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥ä½™é¢ V1ã€ä½™é¢ V2 çš„å€¼éƒ½æ˜¯ 100 ä¸‡ï¼Œå½“äº‹åŠ¡ A æäº¤äº‹åŠ¡åï¼Œå°±èƒ½çœ‹è§æœ€æ–°çš„ä½™é¢æ•°æ®äº†ï¼Œæ‰€ä»¥ä½™é¢ V3 çš„å€¼æ˜¯ 200 ä¸‡ï¼›</p></li><li><p><code>ã€Œä¸²è¡ŒåŒ–ã€</code>:äº‹åŠ¡ B åœ¨æ‰§è¡Œå°†ä½™é¢ 100 ä¸‡ä¿®æ”¹ä¸º 200 ä¸‡æ—¶ï¼Œç”±äºæ­¤å‰äº‹åŠ¡ A æ‰§è¡Œäº†è¯»æ“ä½œï¼Œè¿™æ ·å°±å‘ç”Ÿäº†è¯»å†™å†²çªï¼Œäºæ˜¯å°±ä¼šè¢«é”ä½ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤åï¼Œäº‹åŠ¡ B æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥ä» A çš„è§’åº¦çœ‹ï¼Œä½™é¢ V1ã€V2 çš„å€¼æ˜¯ 100 ä¸‡ï¼Œä½™é¢ V3 çš„å€¼æ˜¯ 200ä¸‡ã€‚</p></li></ul><p>è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>å¯¹äº<code>ã€Œè¯»æœªæäº¤ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå› ä¸ºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®å°±å¥½äº†ï¼›</p><p>å¯¹äº<code>ã€Œä¸²è¡ŒåŒ–ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œé€šè¿‡åŠ è¯»å†™é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ï¼›</p><p>å¯¹äº<code>ã€Œè¯»å·²æäº¤ã€</code>å’Œ<code>ã€Œå¯é‡å¤è¯»ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯é€šè¿‡ <code>Read View</code> æ¥å®ç°çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«<strong>åœ¨äºåˆ›å»º Read View çš„æ—¶æœºä¸åŒï¼Œå¤§å®¶å¯ä»¥æŠŠ Read View ç†è§£æˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå°±åƒç›¸æœºæ‹ç…§é‚£æ ·ï¼Œå®šæ ¼æŸä¸€æ—¶åˆ»çš„é£æ™¯ã€‚ã€Œè¯»å·²æäº¤ã€éš”ç¦»çº§åˆ«æ˜¯åœ¨æ¯ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œè€Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯åŠ¨äº‹åŠ¡æ—¶ã€ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View</strong>ã€‚</p><p>æ³¨æ„ï¼Œæ‰§è¡Œäº† begin/start transaction å‘½ä»¤åï¼Œå¹¶ä¸ä»£è¡¨äº‹åŠ¡å¯åŠ¨äº†ã€‚åªæœ‰åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œæ‰§è¡Œäº†ç¬¬ä¸€æ¡ SQL è¯­å¥ï¼Œæ‰æ˜¯äº‹åŠ¡çœŸæ­£å¯åŠ¨çš„æ—¶æœºï¼›</p><h4 id="References">References</h4><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»åŠ è½½æœºåˆ¶</title>
      <link href="/2023/12/21/JVM4/"/>
      <url>/2023/12/21/JVM4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ç±»åŠ è½½æœºåˆ¶">ç±»åŠ è½½æœºåˆ¶</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å­—èŠ‚ç æ–‡ä»¶çš„ç»“æ„ï¼Œä»¥åŠJVMå¦‚ä½•å¯¹å†…å­˜è¿›è¡Œç®¡ç†ï¼Œç°åœ¨åªå‰©ä¸‹æœ€åä¸€ä¸ªè°œå›¢ç­‰å¾…è§£å¼€äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç±»å­—èŠ‚ç æ–‡ä»¶åˆ°åº•æ˜¯å¦‚ä½•åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼ŒåŠ è½½ä¹‹ååˆä¼šåšä»€ä¹ˆäº‹æƒ…ã€‚</p><h3 id="ç±»åŠ è½½è¿‡ç¨‹">ç±»åŠ è½½è¿‡ç¨‹</h3><p>é¦–å…ˆï¼Œè¦åŠ è½½ä¸€ä¸ªç±»ï¼Œä¸€å®šæ˜¯å‡ºäºæŸç§ç›®çš„çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è¿è¡Œæˆ‘ä»¬çš„Javaç¨‹åºï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦åŠ è½½ä¸»ç±»æ‰èƒ½è¿è¡Œä¸»ç±»ä¸­çš„ä¸»æ–¹æ³•ï¼Œåˆæˆ–æ˜¯æˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®åº“é©±åŠ¨ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åå°„æ¥å°†å¯¹åº”çš„æ•°æ®åº“é©±åŠ¨ç±»è¿›è¡ŒåŠ è½½ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¦‚æœç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œé‚£ä¹ˆä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼š</p><ul><li>ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶</li><li>ä½¿ç”¨æŸä¸ªç±»çš„é™æ€æˆå‘˜ï¼ˆåŒ…æ‹¬æ–¹æ³•å’Œå­—æ®µï¼‰çš„æ—¶å€™ï¼ˆå½“ç„¶ï¼Œfinalç±»å‹çš„é™æ€å­—æ®µæœ‰å¯èƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«æ”¾åˆ°äº†å½“å‰ç±»çš„å¸¸é‡æ± ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šè§¦å‘è‡ªåŠ¨åŠ è½½çš„ï¼‰</li><li>ä½¿ç”¨åå°„å¯¹ç±»ä¿¡æ¯è¿›è¡Œè·å–çš„æ—¶å€™ï¼ˆä¹‹å‰çš„æ•°æ®åº“é©±åŠ¨å°±æ˜¯è¿™æ ·çš„ï¼‰</li><li>åŠ è½½ä¸€ä¸ªç±»çš„å­ç±»æ—¶</li><li>åŠ è½½æ¥å£çš„å®ç°ç±»ï¼Œä¸”æ¥å£å¸¦æœ‰<code>default</code>çš„æ–¹æ³•é»˜è®¤å®ç°æ—¶</li></ul><p>æ¯”å¦‚è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆéœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªç±»ä¸­çš„æˆå‘˜å­—æ®µï¼Œæ‰€ä»¥å°±å¿…é¡»å°†å¦ä¸€ä¸ªç±»åŠ è½½ä¹‹åæ‰èƒ½è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Test.str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘è¢«åˆå§‹åŒ–äº†ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘è¢«è°ƒç”¨äº†!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸€ä¸ªä¸å¤ªå¥½ç†è§£çš„æƒ…å†µï¼Œæˆ‘ä»¬ç°åœ¨å°†é™æ€æˆå‘˜å˜é‡ä¿®æ”¹ä¸ºfinalç±»å‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Test.str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘è¢«åˆå§‹åŒ–äº†ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘è¢«è°ƒç”¨äº†!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Testç±»çš„é™æ€æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”æ­¤é™æ€æˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªfinalç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¯èƒ½å†å‘ç”Ÿæ”¹å˜ã€‚é‚£ä¹ˆå„ä½è§‰å¾—ï¼ŒTestç±»ä¼šåƒä¸Šé¢ä¸€æ ·è¢«åˆå§‹åŒ–å—ï¼Ÿ</p><p>æŒ‰ç…§æ­£å¸¸é€»è¾‘æ¥è¯´ï¼Œæ—¢ç„¶è¦ç”¨åˆ°å…¶ä»–ç±»ä¸­çš„å­—æ®µï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦åŠ è½½å…¶ä»–ç±»ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ç»“æœå‘ç°ï¼Œå¹¶æ²¡æœ‰å¯¹Testç±»è¿›è¡ŒåŠ è½½ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ•´ä¸ª<code>Test.str</code>ç›´æ¥è¢«æ›¿æ¢ä¸ºäº†å¯¹åº”çš„å­—ç¬¦ä¸²ï¼ˆå› ä¸ºfinalä¸å¯èƒ½å‘ç”Ÿæ”¹å˜çš„ï¼Œç¼–è¯‘å°±ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç›´æ¥æ¥ä¸ªå­—ç¬¦ä¸²æ¯”ä½ å»åŠ è½½ç±»åœ¨è·å–å¿«å¾—å¤šä¸æ˜¯å—ï¼Œåæ­£ç»“æœéƒ½ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥è¯´ç¼–è¯‘ä¹‹åï¼Œå®é™…ä¸Šè·ŸTestç±»åŠæ¯›é’±å…³ç³»éƒ½æ²¡æœ‰äº†ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå½“ä½ åœ¨æŸäº›æƒ…å†µä¸‹ç–‘æƒ‘ä¸ºä»€ä¹ˆç±»åŠ è½½äº†æˆ–æ˜¯æ²¡æœ‰åŠ è½½æ—¶ï¼Œå¯ä»¥ä»å­—èŠ‚ç æŒ‡ä»¤çš„è§’åº¦å»è¿›è¡Œåˆ†æï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦é‡åˆ°<code>new</code>ã€<code>getstatic</code>ã€<code>putstatic</code>ã€<code>invokestatic</code>è¿™äº›æŒ‡ä»¤æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œç±»åŠ è½½</p><p>å¥½äº†ï¼ŒèŠå®Œäº†ç±»çš„åŠ è½½è§¦å‘æ¡ä»¶ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ä¸€ä¸‹ç±»çš„è¯¦ç»†åŠ è½½æµç¨‹ã€‚</p><p><img src="https://pb01.s3.bitiful.net/136.png" alt="avatar"></p><p>é¦–å…ˆç±»çš„ç”Ÿå‘½å‘¨æœŸä¸€å…±æœ‰7ä¸ªé˜¶æ®µï¼Œè€Œé¦–å½“å…¶å†²çš„å°±æ˜¯<strong>åŠ è½½</strong>ã€‚</p><p>åŠ è½½é˜¶æ®µéœ€è¦è·å–æ­¤ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ä»ç¡¬ç›˜ä¸­è¯»å–ä¸€ä¸ªclassæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<strong>æ–‡ä»¶è¾“å…¥æµ</strong>æ¥è·å–ç±»æ–‡ä»¶çš„<code>byte[]ï¼ˆäºŒè¿›åˆ¶å­—èŠ‚æµï¼‰</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å„ç§é€”å¾„è·å–ï¼Œç”šè‡³ç½‘ç»œä¼ è¾“å¹¶åŠ è½½ä¸€ä¸ªç±»ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚ç„¶åäº¤ç»™ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼ˆç±»åŠ è½½å™¨å¯ä»¥æ˜¯JDKå†…ç½®çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼€å‘è€…è‡ªå·±æ’¸çš„ï¼‰ç±»çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œå¹¶ä¸”åœ¨å †å†…å­˜ä¸­ä¼šç”Ÿæˆä¸€ä¸ªä»£è¡¨å½“å‰ç±»çš„Classç±»å¯¹è±¡ï¼ˆé‚£ä¹ˆæ€è€ƒä¸€ä¸‹ï¼ŒåŒä¸€ä¸ªClassæ–‡ä»¶åŠ è½½çš„ç±»ï¼Œæ˜¯å”¯ä¸€å­˜åœ¨çš„å—ï¼Ÿï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤å¯¹è±¡ä»¥åŠåå°„æœºåˆ¶æ¥è®¿é—®è¿™ä¸ªç±»çš„å„ç§ä¿¡æ¯ã€‚</p><p>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoader(ç±»åŠ è½½å™¨)ã€‚ä¸è¿‡ï¼Œæ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆå³<strong>ä¸ä¼šå¯¼è‡´ç±»åŠ è½½</strong>ï¼‰ï¼Œè€Œæ˜¯ JVM åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ï¼Œæ•°ç»„ç±»é€šè¿‡getClassLoader()æ–¹æ³•è·å– ClassLoader çš„æ—¶å€™å’Œè¯¥æ•°ç»„çš„å…ƒç´ ç±»å‹çš„ ClassLoader æ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µï¼ˆåŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å»å®Œæˆè¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„ loadClass() æ–¹æ³•ï¼‰ã€‚</p><p>åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œ(å¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œ)æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªç»“æŸï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å°±å·²ç»å¼€å§‹äº†ã€‚</p><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹<strong>éªŒè¯</strong>é˜¶æ®µï¼ŒéªŒè¯é˜¶æ®µç›¸å½“äºæ˜¯å¯¹åŠ è½½çš„ç±»è¿›è¡Œä¸€æ¬¡è§„èŒƒæ ¡éªŒï¼Œå¦‚æœè¯´ç±»çš„ä»»ä½•åœ°æ–¹ä¸ç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒï¼Œé‚£ä¹ˆè¿™ä¸ªç±»æ˜¯ä¸ä¼šéªŒè¯é€šè¿‡çš„ï¼Œå¦‚æœæ²¡æœ‰éªŒè¯æœºåˆ¶ï¼Œé‚£ä¹ˆä¸€æ—¦å‡ºç°å±å®³è™šæ‹Ÿæœºçš„æ“ä½œï¼Œæ•´ä¸ªç¨‹åºä¼šå‡ºç°æ— æ³•é¢„æ–™çš„åæœã€‚</p><p>éªŒè¯é˜¶æ®µä¸»è¦ç”±å››ä¸ªæ£€éªŒé˜¶æ®µç»„æˆï¼š</p><ol><li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆClass æ–‡ä»¶æ ¼å¼æ£€æŸ¥ï¼‰</li><li>å…ƒæ•°æ®éªŒè¯ï¼ˆå­—èŠ‚ç è¯­ä¹‰æ£€æŸ¥ï¼‰</li><li>å­—èŠ‚ç éªŒè¯ï¼ˆç¨‹åºè¯­ä¹‰æ£€æŸ¥ï¼‰</li><li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼ˆç±»çš„æ­£ç¡®æ€§æ£€æŸ¥ï¼‰</li></ol><p><img src="https://pb01.s3.bitiful.net/137.png" alt="avatar"></p><p>æ–‡ä»¶æ ¼å¼éªŒè¯è¿™ä¸€é˜¶æ®µæ˜¯åŸºäºè¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œçš„ï¼Œä¸»è¦ç›®çš„æ˜¯ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ª Java ç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚é™¤äº†è¿™ä¸€é˜¶æ®µä¹‹å¤–ï¼Œ<strong>å…¶ä½™ä¸‰ä¸ªéªŒè¯é˜¶æ®µéƒ½æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„ä¸Šè¿›è¡Œçš„ï¼Œä¸ä¼šå†ç›´æ¥è¯»å–ã€æ“ä½œå­—èŠ‚æµäº†</strong>ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯<strong>å‡†å¤‡</strong>é˜¶æ®µäº†ï¼Œè¿™ä¸ªé˜¶æ®µä¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ºä¸€äº›å­—æ®µè®¾å®šåˆå§‹å€¼ï¼Œæ³¨æ„æ˜¯ç³»ç»Ÿè§„å®šçš„åˆå§‹å€¼ï¼Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šçš„åˆå§‹å€¼ã€‚</p><p>å†å¾€ä¸‹å°±æ˜¯<strong>è§£æ</strong>é˜¶æ®µï¼Œæ­¤é˜¶æ®µæ˜¯å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰å¼•ç”¨å˜é‡çš„æŒ‡å‘éƒ½æ˜¯å·²ç»åˆ‡åˆ‡å®å®åœ°æŒ‡å‘äº†å†…å­˜ä¸­çš„å¯¹è±¡äº†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œé“¾æ¥è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ—¶å€™ç±»åŸºæœ¬ä¸Šå·²ç»å®Œæˆå¤§éƒ¨åˆ†å†…å®¹çš„åˆå§‹åŒ–äº†ã€‚</p><p>æœ€åå°±æ˜¯çœŸæ­£çš„<strong>åˆå§‹åŒ–</strong>é˜¶æ®µäº†ã€‚</p><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³• <code>&lt;clinit&gt; ()</code>æ–¹æ³•çš„è¿‡ç¨‹ï¼Œæ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œè¿™ä¸€æ­¥ JVM æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç (å­—èŠ‚ç )ã€‚</p><blockquote><p>è¯´æ˜ï¼š<code>&lt;clinit&gt; ()</code>æ–¹æ³•æ˜¯ç¼–è¯‘ä¹‹åè‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p></blockquote><hr><h3 id="ç±»åŠ è½½å™¨-ClassLoader">ç±»åŠ è½½å™¨(ClassLoader)</h3><p>å¼€å§‹ä»‹ç»ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰ï¼Œç®€å•å›é¡¾ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p>ç±»åŠ è½½è¿‡ç¨‹ï¼š<strong>åŠ è½½-&gt;é“¾æ¥-&gt;åˆå§‹åŒ–</strong>ã€‚<br>é“¾æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥ï¼š<strong>éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ</strong>ã€‚</p><p><img src="https://pb01.s3.bitiful.net/138.png" alt="avatar"></p><p>åŠ è½½æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£</li></ol><ul><li>ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½è¿™ä¸€æ­¥ã€‚</li><li>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoaderã€‚</li><li>æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆæ•°ç»„ç±»æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œæ˜¯ç”± JVM ç›´æ¥ç”Ÿæˆçš„ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±<strong>æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼‰</strong>ã€‚ å­—èŠ‚ç å¯ä»¥æ˜¯ Java æºç¨‹åºï¼ˆ.javaæ–‡ä»¶ï¼‰ç»è¿‡ javac ç¼–è¯‘å¾—æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆæˆ–è€…é€šè¿‡ç½‘ç»œä¸‹è½½å¾—æ¥ã€‚</p><p>å…¶å®é™¤äº†åŠ è½½ç±»ä¹‹å¤–ï¼Œç±»åŠ è½½å™¨è¿˜å¯ä»¥åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºå¦‚æ–‡æœ¬ã€å›¾åƒã€é…ç½®æ–‡ä»¶ã€è§†é¢‘ç­‰ç­‰æ–‡ä»¶èµ„æºã€‚</p><h4 id="ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™">ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™</h4><p>JVM å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†ç±»åœ¨å…·ä½“ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ï¼Œè¿™æ ·å¯¹å†…å­˜æ›´åŠ å‹å¥½ã€‚å¯¹äºå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ ClassLoader ä¸­ã€‚</p><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¯´ï¼Œç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡</strong>ã€‚</p><h4 id="ç±»åŠ è½½å™¨æ€»ç»“">ç±»åŠ è½½å™¨æ€»ç»“</h4><p>JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼š</p><ol><li><strong>BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨)</strong>: æœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++å®ç°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º nullï¼Œå¹¶ä¸”æ²¡æœ‰çˆ¶çº§ï¼Œä¸»è¦ç”¨æ¥åŠ è½½ JDK å†…éƒ¨çš„æ ¸å¿ƒç±»åº“ï¼ˆ <code>%JAVA_HOME%/lib</code>ç›®å½•ä¸‹çš„ <code>rt.jar</code>ã€<code>resources.jar</code>ã€<code>charsets.jar</code>ç­‰ jar åŒ…å’Œç±»ï¼‰ä»¥åŠè¢« <code>-Xbootclasspath</code>å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨)</strong>: ä¸»è¦è´Ÿè´£åŠ è½½ <code>%JRE_HOME%/lib/ext</code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ä»¥åŠè¢« <code>java.ext.dirs</code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</strong>: é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ classpath ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚</li></ol><p>é™¤äº†è¿™ä¸‰ç§ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ï¼Œä»¥æ»¡è¶³è‡ªå·±çš„ç‰¹æ®Šéœ€æ±‚ã€‚å°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ å¯†ï¼ŒåŠ è½½æ—¶å†åˆ©ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¯¹å…¶è§£å¯†ã€‚</p><p><img src="https://pb01.s3.bitiful.net/139.png" alt="avatar"></p><p>é™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ JVM è‡ªèº«çš„ä¸€éƒ¨åˆ†ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åœ¨ JVM å¤–éƒ¨å®ç°çš„ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ª ClassLoaderæŠ½è±¡ç±»ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚æ¯ä¸ª ClassLoader å¯ä»¥é€šè¿‡getParent()è·å–å…¶çˆ¶ ClassLoaderï¼Œå¦‚æœè·å–åˆ° ClassLoader ä¸ºnullçš„è¯ï¼Œé‚£ä¹ˆè¯¥ç±»å°±æ˜¯æ˜¯é€šè¿‡ å¯åŠ¨ç±»åŠ è½½å™¨ åŠ è½½çš„</p><p><strong>ä¸ºä»€ä¹ˆè·å–åˆ°çš„ClassLoader ä¸ºnullå°±æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„å‘¢ï¼Ÿ</strong> è¿™æ˜¯å› ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ç”± C++ å®ç°ï¼Œç”±äºè¿™ä¸ª C++ å®ç°çš„ç±»åŠ è½½å™¨åœ¨ Java ä¸­æ˜¯æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç±»çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„ç»“æœæ˜¯ nullã€‚</p><h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>æˆ‘ä»¬å‰é¢ä¹Ÿè¯´è¯´äº†ï¼Œé™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨,å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoaderã€‚å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå¾ˆæ˜æ˜¾éœ€è¦ç»§æ‰¿ ClassLoaderæŠ½è±¡ç±»ã€‚</p><p>ClassLoader ç±»æœ‰ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•ï¼š</p><ul><li><strong>protected Class loadClass(String name, boolean resolve)</strong>ï¼šåŠ è½½æŒ‡å®šäºŒè¿›åˆ¶åç§°çš„ç±»ï¼Œå®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶ ã€‚name ä¸ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œresolve å¦‚æœä¸º trueï¼Œåœ¨åŠ è½½æ—¶è°ƒç”¨ resolveClass(Class&lt;?&gt; c) æ–¹æ³•è§£æè¯¥ç±»ã€‚</li><li><strong>protected Class findClass(String name)</strong>ï¼šæ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°æ¥æŸ¥æ‰¾ç±»ï¼Œé»˜è®¤å®ç°æ˜¯ç©ºæ–¹æ³•ã€‚</li></ul><p>å®˜æ–¹ API æ–‡æ¡£ä¸­å†™åˆ°ï¼š</p><blockquote><p>å»ºè®® ClassLoaderçš„å­ç±»é‡å†™ findClass(String name)æ–¹æ³•è€Œä¸æ˜¯loadClass(String name, boolean resolve) æ–¹æ³•ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ ClassLoader ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚</p><h3 id="åŒäº²å§”æ´¾æ¨¡å‹">åŒäº²å§”æ´¾æ¨¡å‹</h3><h4 id="åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»">åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»</h4><p>ç±»åŠ è½½å™¨æœ‰å¾ˆå¤šç§ï¼Œå½“æˆ‘ä»¬æƒ³è¦åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå…·ä½“æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼Ÿè¿™å°±éœ€è¦æåˆ°åŒäº²å§”æ´¾æ¨¡å‹äº†ã€‚</p><p><code>ClassLoader</code> ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚æ¯ä¸ª <code>ClassLoader</code> å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„çˆ¶ç±»åŠ è½½å™¨ã€‚éœ€è¦æŸ¥æ‰¾ç±»æˆ–èµ„æºæ—¶ï¼Œ<code>ClassLoader</code> å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p><p>ä¸‹å›¾å±•ç¤ºçš„å„ç§ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„â€œ<strong>åŒäº²å§”æ´¾æ¨¡å‹(Parents Delegation Model)</strong>â€ã€‚</p><p><img src="https://pb01.s3.bitiful.net/139.png" alt="avatar"></p><p>æ³¨æ„ âš ï¸ï¼šåŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ç§å¼ºåˆ¶æ€§çš„çº¦æŸï¼Œåªæ˜¯ JDK å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å› ä¸ºæŸäº›ç‰¹æ®Šéœ€æ±‚æƒ³è¦æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„.</p><p>å…¶å®è¿™ä¸ªåŒäº²ç¿»è¯‘çš„å®¹æ˜“è®©åˆ«äººè¯¯è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç†è§£çš„åŒäº²éƒ½æ˜¯çˆ¶æ¯ï¼Œè¿™é‡Œçš„åŒäº²æ›´å¤šåœ°è¡¨è¾¾çš„æ˜¯â€œçˆ¶æ¯è¿™ä¸€è¾ˆâ€çš„äººè€Œå·²ï¼Œå¹¶ä¸æ˜¯è¯´çœŸçš„æœ‰ä¸€ä¸ª MotherClassLoader å’Œä¸€ä¸ªFatherClassLoader ã€‚</p><p>å¦å¤–ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// ç»„åˆ</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent;</span><br><span class="line">  <span class="keyword">protected</span> <span class="title function_">ClassLoader</span><span class="params">(ClassLoader parent)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>(checkCreateClassLoader(), parent);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸€æ¡éå¸¸ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼š<strong>ç»„åˆä¼˜äºç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿</strong>ã€‚</p><h4 id="åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹">åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹</h4><ol><li>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ï¼ˆæ¯ä¸ªçˆ¶ç±»åŠ è½½å™¨éƒ½ä¼šèµ°ä¸€éè¿™ä¸ªæµç¨‹ï¼‰ã€‚</li><li>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä¸­ã€‚</li><li>åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼ˆè°ƒç”¨è‡ªå·±çš„ findClass() æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</li><li>å¦‚æœå­ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå®ƒä¼šæŠ›å‡ºä¸€ä¸ª ClassNotFoundException å¼‚å¸¸ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">//é¦–å…ˆï¼Œæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœ c ä¸º nullï¼Œåˆ™è¯´æ˜è¯¥ç±»æ²¡æœ‰è¢«åŠ è½½è¿‡</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™é€šè¿‡çˆ¶ç±»çš„loadClassæ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™è°ƒç”¨å¯åŠ¨ç±»åŠ è½½å™¨æ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">//éç©ºçˆ¶ç±»çš„ç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°ç›¸åº”çš„ç±»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œåˆ™è°ƒç”¨findClassæ–¹æ³•æ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                <span class="comment">//ç”¨æˆ·å¯é€šè¿‡è¦†å†™è¯¥æ–¹æ³•ï¼Œæ¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//ç”¨äºç»Ÿè®¡ç±»åŠ è½½å™¨ç›¸å…³çš„ä¿¡æ¯</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            <span class="comment">//å¯¹ç±»è¿›è¡Œlinkæ“ä½œ</span></span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š<br><strong>JVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™</strong>: JVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ª Class æ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸åŒã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº† Java ç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œ<strong>å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½</strong>ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œ<strong>ä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹</strong>ã€‚</p><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º <code>java.lang.Object </code>ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°ä¸¤ä¸ªä¸åŒçš„ <code>Object</code> ç±»ã€‚åŒäº²å§”æ´¾æ¨¡å‹å¯ä»¥ä¿è¯åŠ è½½çš„æ˜¯ JRE é‡Œçš„é‚£ä¸ª <code>Object</code> ç±»ï¼Œè€Œä¸æ˜¯ä½ å†™çš„ <code>Object</code> ç±»ã€‚è¿™æ˜¯å› ä¸º <code>AppClassLoader</code> åœ¨åŠ è½½ä½ çš„ <code>Object</code> ç±»æ—¶ï¼Œä¼šå§”æ‰˜ç»™ <code>ExtClassLoader</code> å»åŠ è½½ï¼Œè€Œ <code>ExtClassLoader</code> åˆä¼šå§”æ‰˜ç»™ <code>BootstrapClassLoader</code>ï¼Œ<code>BootstrapClassLoader</code> å‘ç°è‡ªå·±å·²ç»åŠ è½½è¿‡äº† <code>Object</code> ç±»ï¼Œä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå»åŠ è½½ä½ å†™çš„ <code>Object</code> ç±»ã€‚</p><h4 id="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•">æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•</h4><p>æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•å°±è¦<strong>è‡ªå®šä¹‰åŠ è½½å™¨,é‡å†™loadClassæ–¹æ³•</strong>. è‡ªå®šä¹‰åŠ è½½å™¨çš„è¯ï¼Œéœ€è¦ç»§æ‰¿ <code>ClassLoader</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ <code>ClassLoader</code> ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯é‡å†™ loadClass() æ–¹æ³•æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹å‘¢ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹å·²ç»è§£é‡Šäº†ï¼š</p><blockquote><p>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</p></blockquote><p>é‡å†™ loadClass()æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å˜ä¼ ç»ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ã€‚ä¾‹å¦‚ï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥åœ¨å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ä¹‹å‰ï¼Œå…ˆè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œæˆ–è€…åœ¨çˆ¶ç±»åŠ è½½å™¨è¿”å›ä¹‹åï¼Œå†å°è¯•ä»å…¶ä»–åœ°æ–¹åŠ è½½è¿™ä¸ªç±»ã€‚å…·ä½“çš„è§„åˆ™ç”±æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚å®šåˆ¶åŒ–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»æ–‡ä»¶ç»“æ„</title>
      <link href="/2023/12/20/JVM3/"/>
      <url>/2023/12/20/JVM3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ç±»æ–‡ä»¶ç»“æ„">ç±»æ–‡ä»¶ç»“æ„</h2><p>åœ¨æˆ‘ä»¬å­¦ä¹ Cè¯­è¨€çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç¼–ç¨‹è¿‡ç¨‹ä¼šç»å†å¦‚ä¸‹å‡ ä¸ªé˜¶æ®µï¼šå†™ä»£ç ã€ä¿å­˜ã€ç¼–è¯‘ã€è¿è¡Œã€‚å®é™…ä¸Šï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯ç¼–è¯‘ï¼Œå› ä¸ºåªæœ‰ç»å†äº†ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„ä»£ç æ‰èƒ½å¤Ÿç¿»è¯‘ä¸ºæœºå™¨å¯ä»¥ç›´æ¥è¿è¡Œçš„äºŒè¿›åˆ¶ä»£ç ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ä¹‹åæ‰èƒ½è¿è¡Œã€‚</p><blockquote><p>å¦‚æœå…¨ä¸–ç•Œæ‰€æœ‰çš„è®¡ç®—æœºæŒ‡ä»¤é›†åªæœ‰x86ä¸€ç§ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰Windowsä¸€ç§ï¼Œé‚£ä¹Ÿè®¸å°±ä¸ä¼šæœ‰Javaè¯­è¨€çš„å‡ºç°ã€‚</p></blockquote><p>éšç€æ—¶ä»£çš„å‘å±•ï¼Œäººä»¬è¿«åˆ‡å¸Œæœ›èƒ½å¤Ÿåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿã€ä¸åŒçš„è®¡ç®—æœºæ¶æ„ä¸­è¿è¡ŒåŒä¸€å¥—ç¼–è¯‘ä¹‹åçš„ä»£ç ã€‚æœ¬åœ°ä»£ç ä¸åº”è¯¥æ˜¯æˆ‘ä»¬ç¼–ç¨‹çš„å”¯ä¸€é€‰æ‹©ï¼Œæ‰€ä»¥ï¼Œè¶Šæ¥è¶Šå¤šçš„è¯­è¨€é€‰æ‹©äº†ä¸æ“ä½œç³»ç»Ÿå’Œæœºå™¨æŒ‡ä»¤é›†æ— å…³çš„ä¸­ç«‹æ ¼å¼ä½œä¸ºç¼–è¯‘åçš„å­˜å‚¨æ ¼å¼ã€‚</p><p>â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼ŒJavaæœ€å¼•ä»¥ä¸ºå‚²çš„å£å·ï¼Œæ ‡å¿—ç€å¹³å°ä¸å†æ˜¯é™åˆ¶ç¼–ç¨‹è¯­è¨€çš„é˜»ç¢ã€‚</p><p>å®é™…ä¸Šï¼ŒJavaæ­£å¼åˆ©ç”¨äº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œå°†æºä»£ç ç¼–è¯‘ä¸ºå¹³å°æ— å…³çš„ä¸­é—´æ ¼å¼ï¼Œå¹¶é€šè¿‡å¯¹åº”çš„Javaè™šæ‹Ÿæœºè¯»å–å’Œè¿è¡Œè¿™äº›ä¸­é—´æ ¼å¼çš„ç¼–è¯‘æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ä¸åŒå¹³å°çš„è™šæ‹Ÿæœºå¦‚ä½•ç¼–å†™ï¼Œè€ŒJavaè¯­è¨€æœ¬èº«å¾ˆè½»æ¾åœ°å®ç°äº†è·¨å¹³å°ã€‚</p><p>ç°åœ¨ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è¯­è¨€éƒ½æ”¯æŒå°†æºä»£ç ç¼–è¯‘ä¸º<code>.class</code>å­—èŠ‚ç æ–‡ä»¶æ ¼å¼ï¼Œä»¥ä¾¿èƒ½å¤Ÿç›´æ¥äº¤ç»™JVMè¿è¡Œï¼ŒåŒ…æ‹¬Kotlinï¼ˆå®‰å“å¼€å‘å®˜æ–¹æŒ‡å®šè¯­è¨€ï¼‰ã€Groovyã€Scalaç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/129.png" alt="avatar"></p><p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œæˆ‘ä»¬çš„æºä»£ç ç¼–è¯‘ä¹‹åï¼Œæ˜¯å¦‚ä½•ä¿å­˜åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ã€‚</p><hr><h3 id="ç±»æ–‡ä»¶ä¿¡æ¯">ç±»æ–‡ä»¶ä¿¡æ¯</h3><p>æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨<code>javap</code>å‘½ä»¤æ¥å¯¹å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œåç¼–è¯‘æŸ¥çœ‹çš„ï¼Œé‚£ä¹ˆï¼Œå®ƒä»¥äºŒè¿›åˆ¶æ ¼å¼æ˜¯æ€ä¹ˆä¿å­˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨WinHexè½¯ä»¶ï¼ˆMacå¹³å°å¯ä»¥ä½¿ç”¨<a href="https://www.macwk.com/soft/010-editor">010 Editor</a>ï¼‰æ¥ä»¥åå…­è¿›åˆ¶æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> i++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°æˆ‘ä»¬åœ¨IDEAä¸­ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶ï¼Œå°†å…¶æ‹–åŠ¨è¿›å»ï¼š</p><p><img src="https://pb01.s3.bitiful.net/130.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ–‡ä»¶ä¸­ï¼Œå…¨æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åˆ†ç»„çš„æ ·å­ï¼Œä»å·¦ä¸Šè§’å¼€å§‹ï¼Œä¸€è¡Œä¸€è¡Œå‘ä¸‹è¯»å–ã€‚</p><p>å®é™…ä¸ŠClassæ–‡ä»¶é‡‡ç”¨äº†ä¸€ç§ç±»ä¼¼äºCä¸­ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic; //Class æ–‡ä»¶çš„æ ‡å¿—</span><br><span class="line">    u2             minor_version;//Class çš„å°ç‰ˆæœ¬å·</span><br><span class="line">    u2             major_version;//Class çš„å¤§ç‰ˆæœ¬å·</span><br><span class="line">    u2             constant_pool_count;//å¸¸é‡æ± çš„æ•°é‡</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];//å¸¸é‡æ± </span><br><span class="line">    u2             access_flags;//Class çš„è®¿é—®æ ‡è®°</span><br><span class="line">    u2             this_class;//å½“å‰ç±»</span><br><span class="line">    u2             super_class;//çˆ¶ç±»</span><br><span class="line">    u2             interfaces_count;//æ¥å£æ•°é‡</span><br><span class="line">    u2             interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span><br><span class="line">    u2             fields_count;//å­—æ®µæ•°é‡</span><br><span class="line">    field_info     fields[fields_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªå­—æ®µ</span><br><span class="line">    u2             methods_count;//æ–¹æ³•æ•°é‡</span><br><span class="line">    method_info    methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span><br><span class="line">    u2             attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span><br><span class="line">    attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€ŒClassæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ç§å…è®¸å­˜åœ¨çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªæ˜¯æ— ç¬¦å·æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯è¡¨ã€‚</p><ul><li>æ— ç¬¦å·æ•°ä¸€èˆ¬æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç”¨u1ã€u2ã€u4ã€u8æ¥è¡¨ç¤ºï¼Œè¡¨ç¤º1ä¸ªå­—èŠ‚~8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ã€‚å¯ä»¥è¡¨ç¤ºæ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–æ˜¯ä»¥UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</li><li>è¡¨åŒ…å«å¤šä¸ªæ— ç¬¦å·æ•°ï¼Œå¹¶ä¸”ä»¥&quot;_info&quot;ç»“å°¾ã€‚</li></ul><p>æˆ‘ä»¬é¦–å…ˆä»æœ€ç®€å•çš„å¼€å§‹çœ‹èµ·ã€‚</p><p><img src="https://pb01.s3.bitiful.net/131.png" alt="avatar"></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‰4ä¸ªå­—èŠ‚ï¼ˆå…±32ä½ï¼‰ç»„æˆäº†<strong>é­”æ•°</strong>ï¼ˆå…¶å®å°±æ˜¯è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªJVMå¯ä»¥è¿è¡Œçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé™¤äº†Javaä»¥å¤–ï¼Œå…¶ä»–æŸäº›æ–‡ä»¶ä¸­ä¹Ÿé‡‡ç”¨äº†è¿™ç§é­”æ•°æœºåˆ¶æ¥è¿›è¡ŒåŒºåˆ†ï¼Œè¿™ç§æ–¹å¼æ¯”ç›´æ¥èµ·ä¸ªæ–‡ä»¶æ‰©å±•åæ›´å®‰å…¨ï¼‰</p><p>å­—èŠ‚ç æ–‡ä»¶çš„é­”æ•°ä¸ºï¼šCAFEBABEï¼ˆè¿™åå­—èƒ½æƒ³å‡ºæ¥ä¹Ÿæ˜¯æŒºéš¾çš„äº†ï¼Œæ¯•ç«Ÿ4ä¸ªbitä½åªèƒ½è¡¨ç¤ºå‡ºA-Fè¿™å‡ ä¸ªå­—æ¯ï¼‰</p><p>ç´§æ¥ç€é­”æ•°çš„åé¢4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯å­—èŠ‚ç æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œæ³¨æ„å‰ä¸¤ä¸ªæ˜¯æ¬¡è¦ç‰ˆæœ¬å·ï¼ˆç°åœ¨åŸºæœ¬éƒ½ä¸ç”¨äº†ï¼Œéƒ½æ˜¯ç›´æ¥Java8ã€Java9è¿™æ ·å‘½åäº†ï¼‰ï¼Œåé¢ä¸¤ä¸ªæ˜¯<strong>ä¸»è¦ç‰ˆæœ¬å·</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸»ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ä¸Šé¢çš„å°±æ˜¯34ï¼Œæ³¨æ„è¿™æ˜¯ä»¥16è¿›åˆ¶è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬æŠŠå®ƒæ¢ç®—ä¸º10è¿›åˆ¶åï¼Œå¾—åˆ°çš„ç»“æœä¸ºï¼š<code>34  -&gt;  3*16 + 4 = 52</code>ï¼Œå…¶ä¸­<code>52</code>ä»£è¡¨çš„æ˜¯<code>JDK8</code>ç¼–è¯‘çš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ51æ˜¯JDK7ã€50æ˜¯JDK6ã€53æ˜¯JDK9ï¼Œä»¥æ­¤ç±»æ¨ï¼‰</p><p>JVMä¼š<strong>æ ¹æ®ç‰ˆæœ¬å·å†³å®šæ˜¯å¦èƒ½å¤Ÿè¿è¡Œ</strong>ï¼Œæ¯”å¦‚JDK6åªèƒ½æ”¯æŒç‰ˆæœ¬å·ä¸º1.1~6çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»æ˜¯Java6ä¹‹å‰çš„ç¯å¢ƒç¼–è¯‘å‡ºæ¥çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•è¿è¡Œã€‚åˆæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å®‰è£…çš„æ˜¯JDK8ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒçš„ç‰ˆæœ¬å·ä¸º1.1~8ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªé€šè¿‡Java7ç¼–è¯‘å‡ºæ¥çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä¾ç„¶æ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œæ‰€ä»¥è¯´Javaç‰ˆæœ¬æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚</p><p>ç´§æ¥ç€ï¼Œå°±æ˜¯ç±»çš„<strong>å¸¸é‡æ± </strong>äº†ï¼Œè¿™é‡Œé¢å­˜æ”¾äº†ç±»ä¸­æ‰€æœ‰çš„å¸¸é‡ä¿¡æ¯ï¼ˆæ³¨æ„è¿™é‡Œçš„å¸¸é‡å¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„finalç±»å‹å¸¸é‡ï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œä¸€äº›éœ€è¦ç”¨åˆ°çš„å¸¸é‡æ•°æ®ï¼Œæ¯”å¦‚å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ç­‰ï¼‰ç”±äºå¸¸é‡çš„æ•°é‡ä¸æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥åœ¨æœ€å¼€å§‹çš„ä½ç½®ä¼šå­˜æ”¾å¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡ï¼ˆæ˜¯ä»1å¼€å§‹è®¡ç®—çš„ï¼Œä¸æ˜¯0ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯18ï¼Œç¿»è¯‘ä¸º10è¿›åˆ¶å°±æ˜¯24ï¼Œæ‰€ä»¥å®é™…ä¸Šæœ‰23ä¸ªå¸¸é‡ï¼‰</p><p>æ¥ç€å†å¾€ä¸‹ï¼Œå°±æ˜¯å¸¸é‡æ± é‡Œé¢çš„æ•°æ®äº†ï¼Œå¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œè¿™ 14 ç§è¡¨æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šå¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ª u1 ç±»å‹çš„æ ‡å¿—ä½ -tag æ¥æ ‡è¯†å¸¸é‡çš„ç±»å‹ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹,éƒ½æ˜¯ä»¥_infoç»“å°¾</p><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">æ ‡å¿—</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">CONSTANT_Utf8_info</td><td style="text-align:center">1</td><td style="text-align:center">UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">CONSTANT_Integer_info</td><td style="text-align:center">3</td><td style="text-align:center">æ•´å½¢å­—é¢é‡ï¼ˆç¬¬ä¸€ç« æˆ‘ä»¬æ¼”ç¤ºçš„å¾ˆå¤§çš„æ•°å­—ï¼Œå®é™…ä¸Šå°±æ˜¯ä»¥å­—é¢é‡å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­çš„ï¼‰</td></tr><tr><td style="text-align:center">CONSTANT_Float_info</td><td style="text-align:center">4</td><td style="text-align:center">æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Long_info</td><td style="text-align:center">5</td><td style="text-align:center">é•¿æ•´å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Double_info</td><td style="text-align:center">6</td><td style="text-align:center">åŒç²¾åº¦æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Class_info</td><td style="text-align:center">7</td><td style="text-align:center">ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_String_info</td><td style="text-align:center">8</td><td style="text-align:center">å­—ç¬¦ä¸²ç±»å‹çš„å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Fieldref_info</td><td style="text-align:center">9</td><td style="text-align:center">å­—æ®µçš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_Methodref_info</td><td style="text-align:center">10</td><td style="text-align:center">æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_InterfaceMethodref_info</td><td style="text-align:center">11</td><td style="text-align:center">æ¥å£æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_NameAndType_info</td><td style="text-align:center">12</td><td style="text-align:center">å­—æ®µæˆ–æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_MethodType_info</td><td style="text-align:center">16</td><td style="text-align:center">æ–¹æ³•ç±»å‹</td></tr><tr><td style="text-align:center">CONSTANT_MethodHandle_info</td><td style="text-align:center">15</td><td style="text-align:center">è¡¨ç¤ºæ–¹æ³•å¥æŸ„</td></tr><tr><td style="text-align:center">CONSTANT_InvokeDynamic_info</td><td style="text-align:center">18</td><td style="text-align:center">è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹</td></tr></tbody></table><p>æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ª<code>CONSTANT_Methodref_info</code>è¡¨ä¸­å­˜æ”¾äº†ä»€ä¹ˆæ•°æ®ï¼Œè¿™é‡Œæˆ‘åªåˆ—å‡ºå®ƒçš„ç»“æ„è¡¨ï¼ˆè¯¦ç»†çš„ç»“æ„è¡¨å¯ä»¥æŸ¥é˜…ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº ç¬¬ä¸‰ç‰ˆã€‹ä¸­222é¡µæ€»è¡¨ï¼‰ï¼š</p><table><thead><tr><th style="text-align:center">å¸¸é‡</th><th style="text-align:center">é¡¹ç›®</th><th style="text-align:center">ç±»å‹</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">CONSTANT_Methodref_info</td><td style="text-align:center">tag</td><td style="text-align:center">u1</td><td style="text-align:center">å€¼ä¸º10</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">index</td><td style="text-align:center">u2</td><td style="text-align:center">æŒ‡å‘å£°æ˜æ–¹æ³•çš„ç±»æè¿°çˆ¶CONSTANT_Class_infoç´¢å¼•é¡¹</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">index</td><td style="text-align:center">u2</td><td style="text-align:center">æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦CONSTANT_NameAndType_infoç´¢å¼•é¡¹</td></tr></tbody></table><p>åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨<strong>è®¿é—®æ ‡å¿—</strong>ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ª Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦ä¸º public æˆ–è€… abstract ç±»å‹ï¼Œå¦‚æœæ˜¯ç±»çš„è¯æ˜¯å¦å£°æ˜ä¸º final ç­‰ç­‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u2             access_flags;//Class çš„è®¿é—®æ ‡è®°</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒåªå äº†2ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¡¨ç¤ºè®¿é—®æ ‡å¿—å‘¢?</p><p><img src="https://pb01.s3.bitiful.net/132.png" alt="avatar"></p><p>æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„Mainç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„classç±»å‹ï¼Œå¹¶ä¸”è®¿é—®æƒé™ä¸ºpublicï¼Œé‚£ä¹ˆå®ƒçš„è®¿é—®æ ‡å¿—å€¼æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š</p><p><code>ACC_PUBLIC | ACC_SUPER = 0x0001 | 0x0020 = 0x0021</code>ï¼ˆè¿™é‡Œè¿›è¡Œçš„æ˜¯æŒ‰ä½æˆ–è¿ç®—ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><p>å†å¾€ä¸‹å°±æ˜¯ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u2             this_class;//å½“å‰ç±»</span><br><span class="line">u2             super_class;//çˆ¶ç±»</span><br><span class="line">u2             interfaces_count;//æ¥å£æ•°é‡</span><br><span class="line">u2             interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/133.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å€¼ä¹Ÿæ˜¯æŒ‡å‘<strong>å¸¸é‡æ± ä¸­çš„å€¼</strong>ï¼Œå…¶ä¸­2å·å¸¸é‡æ­£æ˜¯å­˜å‚¨çš„å½“å‰ç±»ä¿¡æ¯ï¼Œ3å·å¸¸é‡å­˜å‚¨çš„æ˜¯çˆ¶ç±»ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸å†å€’æ¨å›å»äº†ï¼Œç”±äºæ²¡æœ‰æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œæ¥å£æ•°é‡ä¸º0ï¼Œå¦‚æœä¸ä¸º0è¿˜ä¼šæœ‰ä¸€ä¸ªç´¢å¼•è¡¨æ¥å¼•ç”¨æ¥å£ã€‚</p><p>Java ç±»çš„ç»§æ‰¿å…³ç³»ç”±ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆä¸‰é¡¹ç¡®å®šã€‚ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆæŒ‰ç…§é¡ºåºæ’åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œ<strong>ç±»ç´¢å¼•</strong>ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œ<strong>çˆ¶ç±»ç´¢å¼•</strong>ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äº Java è¯­è¨€çš„å•ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº† java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ Java ç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº† java.lang.Object å¤–ï¼Œæ‰€æœ‰ Java ç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚<strong>æ¥å£ç´¢å¼•é›†åˆ</strong>ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†é‚£äº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements (å¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯æ¥å£çš„è¯åˆ™æ˜¯extends) åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</p><p>æ¥ç€å°±æ˜¯<strong>å­—æ®µè¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             fields_count;//å­—æ®µæ•°é‡</span><br><span class="line">field_info     fields[fields_count];//ä¸€ä¸ªç±»ä¼šå¯ä»¥æœ‰ä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰å£°æ˜ä»»ä½•å­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç»™Mainç±»æ·»åŠ ä¸€ä¸ªå­—æ®µå†é‡æ–°åŠ è½½ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> i++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/134.png" alt="avatar"></p><ul><li><strong>access_flags:</strong> å­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublic ,private,protectedä¿®é¥°ç¬¦ï¼‰ï¼Œæ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰,å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransient ä¿®é¥°ç¬¦ï¼‰,å¯å˜æ€§ï¼ˆfinalï¼‰,å¯è§æ€§ï¼ˆvolatile ä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ã€‚</li><li><strong>name_index:</strong> å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºçš„å­—æ®µçš„åç§°ï¼›</li><li><strong>descriptor_index:</strong> å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ï¼›</li><li><strong>attributes_count:</strong> ä¸€ä¸ªå­—æ®µè¿˜ä¼šæ‹¥æœ‰ä¸€äº›é¢å¤–çš„å±æ€§ï¼Œattributes_count å­˜æ”¾å±æ€§çš„ä¸ªæ•°ï¼›</li><li><strong>attributes[attributes_count]:</strong> å­˜æ”¾å…·ä½“å±æ€§å…·ä½“å†…å®¹ã€‚</li></ul><p>ä¸Šè¿°è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œå¾ˆé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚è€Œå­—æ®µå«ä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹è¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­å¸¸é‡æ¥æè¿°ã€‚</p><p>æ¥ç€å°±æ˜¯æˆ‘ä»¬çš„<strong>æ–¹æ³•è¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             methods_count;//æ–¹æ³•æ•°é‡</span><br><span class="line">method_info    methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span><br></pre></td></tr></table></figure><p>methods_count è¡¨ç¤ºæ–¹æ³•çš„æ•°é‡ï¼Œè€Œ method_info è¡¨ç¤ºæ–¹æ³•è¡¨ã€‚</p><p>Class æ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°å‡ ä¹é‡‡ç”¨äº†å®Œå…¨ä¸€è‡´çš„æ–¹å¼ã€‚æ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•ã€å±æ€§è¡¨é›†åˆå‡ é¡¹ã€‚</p><p><strong>method_info(æ–¹æ³•è¡¨çš„) ç»“æ„:</strong></p><p><img src="https://pb01.s3.bitiful.net/135.png" alt="avatar"></p><p>æœ€åï¼Œå°±æ˜¯<strong>å±æ€§è¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span><br><span class="line">attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ</span><br></pre></td></tr></table></figure><p>åœ¨ Class æ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚ä¸ Class æ–‡ä»¶ä¸­å…¶å®ƒçš„æ•°æ®é¡¹ç›®è¦æ±‚çš„é¡ºåºã€é•¿åº¦å’Œå†…å®¹ä¸åŒï¼Œå±æ€§è¡¨é›†åˆçš„é™åˆ¶ç¨å¾®å®½æ¾ä¸€äº›ï¼Œä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå¹¶ä¸”åªè¦ä¸ä¸å·²æœ‰çš„å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¼šå¿½ç•¥æ‰å®ƒä¸è®¤è¯†çš„å±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMåƒåœ¾å›æ”¶æœºåˆ¶</title>
      <link href="/2023/12/19/JVM2/"/>
      <url>/2023/12/19/JVM2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åƒåœ¾å›æ”¶æœºåˆ¶">åƒåœ¾å›æ”¶æœºåˆ¶</h2><p>æˆ‘ä»¬å‰é¢æåˆ°ï¼ŒJavaä¼šè‡ªåŠ¨ç®¡ç†å’Œé‡Šæ”¾å†…å­˜ï¼Œå®ƒä¸åƒC/C++é‚£æ ·è¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼ŒJVMæä¾›äº†ä¸€å¥—å…¨è‡ªåŠ¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå½“ä¸€ä¸ªJavaå¯¹è±¡ä¸å†ç”¨åˆ°æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å°†å…¶è¿›è¡Œå›æ”¶å¹¶é‡Šæ”¾å†…å­˜ï¼Œé‚£ä¹ˆå¯¹è±¡æ‰€å å†…å­˜åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›æ”¶ï¼Œå¦‚ä½•åˆ¤å®šå¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œä»¥åŠå¦‚ä½•å»è¿›è¡Œå›æ”¶å·¥ä½œä¹Ÿæ˜¯JVMéœ€è¦å…³æ³¨çš„é—®é¢˜ã€‚</p><h3 id="å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•">å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥å¥—è®¨è®ºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼šå¯¹è±¡åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«åˆ¤å®šä¸ºä¸å†ä½¿ç”¨å·²ç»å¯ä»¥å›æ”¶äº†ï¼Ÿè¿™é‡Œå°±éœ€è¦æåˆ°ä»¥ä¸‹å‡ ç§åƒåœ¾å›æ”¶ç®—æ³•äº†ã€‚</p><p><img src="https://pb01.s3.bitiful.net/108.png" alt="avatar"></p><h4 id="å¼•ç”¨è®¡æ•°æ³•">å¼•ç”¨è®¡æ•°æ³•</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬è¦ç»å¸¸æ“ä½œä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆé¦–å…ˆä¸€å®šä¼šåˆ›å»ºä¸€ä¸ªå¼•ç”¨å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//strå°±æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå®ƒæŒæœ‰å¯¹åé¢å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ä»£è¡¨åé¢è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æœ¬èº«</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;lbwnb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//str.xxxxx...</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡è¿˜æœ‰ä½¿ç”¨ä»·å€¼ï¼Œæˆ‘ä»¬å°±ä¼šé€šè¿‡å®ƒçš„å¼•ç”¨å˜é‡æ¥è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¯å¦è¿™æ ·åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜éœ€è¦è¢«ä½¿ç”¨ï¼š</p><ul><li>æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª <strong>å¼•ç”¨è®¡æ•°å™¨</strong>ï¼Œç”¨äºå­˜æ”¾å¼•ç”¨è®¡æ•°ï¼ˆå…¶å®å°±æ˜¯å­˜æ”¾è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼‰</li><li>æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨æ­¤å¯¹è±¡æ—¶ï¼Œå¼•ç”¨è®¡æ•°<code>+1</code></li><li>å½“å¼•ç”¨å¤±æ•ˆï¼ˆ æ¯”å¦‚ç¦»å¼€äº†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæˆ–æ˜¯å¼•ç”¨è¢«è®¾å®šä¸º<code>null</code>ï¼‰æ—¶ï¼Œå¼•ç”¨è®¡æ•°<code>-1</code></li><li>å½“å¼•ç”¨è®¡æ•°ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡ä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ—¶æˆ‘ä»¬å·²ç»æ²¡æœ‰ä»»ä½•æ–¹æ³•å¯ä»¥å¾—åˆ°æ­¤å¯¹è±¡çš„å¼•ç”¨äº†</li></ul><p>ä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="type">Test</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">        a.another = b;</span><br><span class="line">        b.another = a;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaå’Œbèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„ä¸¤ä¸ªå¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">        a = b = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        Test another;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œé‚£ä¹ˆå½“å‡ºç°ä»¥ä¸Šæƒ…å†µæ—¶ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•åœ¨å¾—åˆ°æ­¤å¯¹è±¡çš„å¼•ç”¨äº†ï¼Œå¹¶ä¸”æ­¤å¯¹è±¡æˆ‘ä»¬ä¹Ÿæ— éœ€å†ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªå¯¹è±¡ç›´æ¥å­˜åœ¨ç›¸äº’å¼•ç”¨çš„æƒ…å†µï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°å™¨çš„å€¼å°†ä¼šæ°¸è¿œæ˜¯<code>1</code>ï¼Œä½†æ˜¯å®é™…ä¸Šæ­¤å¯¹è±¡å·²ç»æ²¡æœ‰ä»»ä½•ç”¨é€”äº†ã€‚æ‰€ä»¥å¼•ç”¨è®¡æ•°æ³•å¹¶ä¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•">å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>ç›®å‰æ¯”è¾ƒä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬Javaï¼‰ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå®ƒé‡‡ç”¨äº†ç±»ä¼¼äºæ ‘ç»“æ„çš„æœç´¢æœºåˆ¶ã€‚</p><p>é¦–å…ˆæ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨éƒ½æœ‰æœºä¼šæˆä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ï¼Œå¯ä»¥è¢«é€‰å®šä½œä¸ºæ ¹èŠ‚ç‚¹æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li>ä½äºè™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ä¸­æ‰€å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼ˆå…¶å®å°±æ˜¯æˆ‘ä»¬æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼‰åŒæ ·ä¹ŸåŒ…æ‹¬æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>ç±»çš„é™æ€æˆå‘˜å˜é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­ï¼Œå¸¸é‡æ± é‡Œé¢å¼•ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„<code>String</code>ç±»å‹å¯¹è±¡ã€‚</li><li>è¢«æ·»åŠ äº†é”çš„å¯¹è±¡ï¼ˆæ¯”å¦‚synchronizedå…³é”®å­—ï¼‰</li><li>è™šæ‹Ÿæœºå†…éƒ¨éœ€è¦ç”¨åˆ°çš„å¯¹è±¡ã€‚</li></ul><p><img src="https://pb01.s3.bitiful.net/109.png" alt="avatar"></p><p>ä¸€æ—¦å·²ç»å­˜åœ¨çš„æ ¹èŠ‚ç‚¹ä¸æ»¡è¶³å­˜åœ¨çš„æ¡ä»¶æ—¶ï¼Œé‚£ä¹ˆæ ¹èŠ‚ç‚¹ä¸å¯¹è±¡ä¹‹é—´çš„è¿æ¥å°†è¢«æ–­å¼€ã€‚æ­¤æ—¶è™½ç„¶å¯¹è±¡1ä»å­˜åœ¨å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯ç”±äºå…¶æ²¡æœ‰ä»»ä½•æ ¹èŠ‚ç‚¹å¼•ç”¨ï¼Œæ‰€ä»¥æ­¤å¯¹è±¡å³å¯è¢«åˆ¤å®šä¸ºä¸å†ä½¿ç”¨ã€‚æ¯”å¦‚æŸä¸ªæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæˆè¿”å›ä¹‹åï¼š</p><p><img src="https://pb01.s3.bitiful.net/110.png" alt="avatar"></p><p>è¿™æ ·å°±èƒ½å¾ˆå¥½åœ°è§£å†³æˆ‘ä»¬åˆšåˆšæåˆ°çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å†æ¥é‡ç°ä¸€ä¸‹å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼š</p><p><img src="https://pb01.s3.bitiful.net/111.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡1å’Œå¯¹è±¡2ä¾ç„¶æ˜¯å­˜åœ¨å¾ªç¯å¼•ç”¨çš„ï¼Œä½†æ˜¯åªæœ‰ä»–ä»¬å„è‡ªçš„GC Rootsæ–­å¼€ï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/112.png" alt="avatar"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€åè¿›è¡Œä¸€ä¸‹æ€»ç»“ï¼šå¦‚æœæŸä¸ªå¯¹è±¡æ— æ³•åˆ°è¾¾ä»»ä½•GC Rootsï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><h4 id="æœ€ç»ˆåˆ¤å®š">æœ€ç»ˆåˆ¤å®š</h4><p>è™½ç„¶åœ¨ç»å†äº†å¯è¾¾æ€§åˆ†æç®—æ³•ä¹‹ååŸºæœ¬å¯èƒ½åˆ¤å®šå“ªäº›å¯¹è±¡èƒ½å¤Ÿè¢«å›æ”¶ï¼Œä½†æ˜¯å¹¶ä¸ä»£è¡¨æ­¤å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨æœ€ç»ˆåˆ¤å®šé˜¶æ®µå¯¹å…¶è¿›è¡ŒæŒ½ç•™ã€‚</p><p>è¿˜è®°å¾—<code>Object</code>ç±»ä¸­çš„<code>finalize()</code>æ–¹æ³•å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called by the garbage collector on an object when garbage collection</span></span><br><span class="line"><span class="comment"> * determines that there are no more references to the object.</span></span><br><span class="line"><span class="comment"> * A subclass overrides the &#123;<span class="doctag">@code</span> finalize&#125; method to dispose of</span></span><br><span class="line"><span class="comment"> * system resources or to perform other cleanup.</span></span><br><span class="line"><span class="comment"> * ...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•æ­£æ˜¯æœ€ç»ˆåˆ¤å®šæ–¹æ³•ï¼Œå¦‚æœå­ç±»é‡å†™äº†æ­¤æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»å¯¹è±¡åœ¨è¢«åˆ¤å®šä¸ºå¯å›æ”¶æ—¶ï¼Œä¼šè¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ<code>finalize()</code>æ–¹æ³•ï¼Œè€Œåœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå½“å‰å¯¹è±¡æ˜¯å®Œå…¨æœ‰å¯èƒ½é‡æ–°å»ºç«‹GC Rootsçš„ï¼æ‰€ä»¥ï¼Œå¦‚æœåœ¨äºŒæ¬¡ç¡®è®¤åå¯¹è±¡ä¸æ»¡è¶³å¯å›æ”¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œå·§å¦™åœ°é€ƒè¿‡äº†åƒåœ¾å›æ”¶çš„å‘½è¿ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test a;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        a = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">        a  = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç­‰å¾…åƒåœ¾</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æˆ‘ä»¬æ¥çœ‹çœ‹aæœ‰æ²¡æœ‰è¢«å›æ”¶</span></span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            System.out.println(<span class="built_in">this</span>+<span class="string">&quot; å¼€å§‹äº†å®ƒçš„æ•‘èµä¹‹è·¯ï¼&quot;</span>);</span><br><span class="line">            a = <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>finalize()</code>æ–¹æ³•å¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œè€Œæ˜¯è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„<code>Finalizer</code>çº¿ç¨‹ï¼ˆæ­£æ˜¯å› ä¸ºä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œæ‰€ä»¥å‰é¢æ‰éœ€è¦ç­‰å¾…1ç§’é’Ÿï¼‰è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(Thread.currentThread());</span><br><span class="line">        a = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread[Finalizer,8,system]</span><br><span class="line">com.test.Main$Test@232204a1</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼ŒåŒä¸€ä¸ªå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•åªä¼šæœ‰ä¸€æ¬¡è°ƒç”¨æœºä¼šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¿ç»­ä¸¤æ¬¡è¿™æ ·æ“ä½œï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ï¼Œå¯¹è±¡å¿…å®šè¢«å›æ”¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    a = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">    a  = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">    System.gc();</span><br><span class="line">    <span class="comment">//ç­‰åƒåœ¾å›æ”¶ä¸€ä¸‹</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">    a  = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">    System.gc();</span><br><span class="line">    <span class="comment">//ç­‰åƒåœ¾å›æ”¶ä¸€ä¸‹</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œ<code>finalize()</code>æ–¹æ³•ä¹Ÿå¹¶ä¸æ˜¯ä¸“é—¨é˜²æ­¢å¯¹è±¡è¢«å›æ”¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥é‡Šæ”¾ä¸€äº›ç¨‹åºä½¿ç”¨ä¸­çš„èµ„æºç­‰ã€‚</p><p>æœ€åï¼Œæ€»ç»“æˆä¸€å¼ å›¾ï¼š</p><p><img src="https://pb01.s3.bitiful.net/113.png" alt="avatar"></p><p>å½“ç„¶ï¼Œé™¤äº†å †ä¸­çš„å¯¹è±¡ä»¥å¤–ï¼Œæ–¹æ³•åŒºä¸­çš„æ•°æ®ä¹Ÿæ˜¯å¯ä»¥è¢«åƒåœ¾å›æ”¶çš„ï¼Œä½†æ˜¯å›æ”¶æ¡ä»¶æ¯”è¾ƒä¸¥æ ¼ï¼Œè¿™é‡Œå°±æš‚æ—¶ä¸è°ˆäº†ã€‚</p><hr><h3 id="åƒåœ¾å›æ”¶ç®—æ³•">åƒåœ¾å›æ”¶ç®—æ³•</h3><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥å‡†ç¡®åœ°çŸ¥é“å †ä¸­çš„å“ªäº›å¯¹è±¡å¯ä»¥è¢«å›æ”¶äº†ï¼Œé‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±è¯¥è€ƒè™‘å¦‚ä½•å¯¹å¯¹è±¡è¿›è¡Œå›æ”¶äº†ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šä¸å®šæœŸåœ°æ£€æŸ¥å †ä¸­çš„å¯¹è±¡ï¼ŒæŸ¥çœ‹å®ƒä»¬æ˜¯å¦æ»¡è¶³è¢«å›æ”¶çš„æ¡ä»¶ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶å—ï¼Ÿ</p><h4 id="åˆ†ä»£æ”¶é›†æœºåˆ¶">åˆ†ä»£æ”¶é›†æœºåˆ¶</h4><p>å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¯¹å †ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¾æ¬¡åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶ï¼Œè¿™æ ·çš„æ•ˆç‡å…¶å®æ˜¯å¾ˆä½çš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½åœ°å›æ”¶æœºåˆ¶å‘¢ï¼Ÿç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ†ä»£ç®¡ç†ã€‚</p><p>æ¯”å¦‚æŸäº›å¯¹è±¡ï¼Œåœ¨å¤šæ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œéƒ½æœªè¢«åˆ¤å®šä¸ºå¯å›æ”¶å¯¹è±¡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è¿™ä¸€éƒ¨åˆ†å¯¹è±¡æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶è®©åƒåœ¾æ”¶é›†å™¨å‡å°‘å›æ”¶æ­¤åŒºåŸŸå¯¹è±¡çš„é¢‘ç‡ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½åœ°æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡äº†ã€‚</p><p>å› æ­¤ï¼ŒJavaè™šæ‹Ÿæœºå°†å †å†…å­˜åˆ’åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>ã€<strong>è€å¹´ä»£</strong>å’Œ<strong>æ°¸ä¹…ä»£</strong>ï¼ˆå…¶ä¸­æ°¸ä¹…ä»£æ˜¯HotSpotè™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œåœ¨JDK8ä¹‹å‰æ–¹æ³•åŒºå®é™…ä¸Šå°±æ˜¯é‡‡ç”¨çš„æ°¸ä¹…ä»£ä½œä¸ºå®ç°ï¼Œè€Œåœ¨JDK8ä¹‹åï¼Œæ–¹æ³•åŒºç”±å…ƒç©ºé—´å®ç°ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå®¹é‡å¤§å°å–å†³äºç‰©ç†æœºå®é™…å¤§å°ï¼Œä¹‹åä¼šè¯¦ç»†ä»‹ç»ï¼‰è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„æ˜¯<strong>æ–°ç”Ÿä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ã€‚</p><p>ä¸åŒçš„åˆ†ä»£å†…å­˜å›æ”¶æœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€äº›ä¸åŒä¹‹å¤„ï¼Œåœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ–°ç”Ÿä»£è¢«åˆ’åˆ†ä¸ºä¸‰å—ï¼Œä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œé»˜è®¤æ¯”ä¾‹ä¸º8ï¼š1ï¼š1ï¼Œè€å¹´ä»£çš„GCè¯„ç‡ç›¸å¯¹è¾ƒä½ï¼Œæ°¸ä¹…ä»£ä¸€èˆ¬å­˜æ”¾ç±»ä¿¡æ¯ç­‰ï¼ˆå…¶å®å°±æ˜¯æ–¹æ³•åŒºçš„å®ç°ï¼‰å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://pb01.s3.bitiful.net/114.png" alt="avatar"></p><p>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåœ¨ä¸€å¼€å§‹éƒ½ä¼šè¿›å…¥åˆ°æ–°ç”Ÿä»£çš„EdenåŒºï¼ˆå¦‚æœæ˜¯å¤§å¯¹è±¡ä¼šè¢«ç›´æ¥ä¸¢è¿›è€å¹´ä»£ï¼‰ï¼Œåœ¨è¿›è¡Œæ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾å›æ”¶æ—¶ï¼Œé¦–å…ˆä¼šå¯¹æ‰€æœ‰æ–°ç”Ÿä»£åŒºåŸŸçš„å¯¹è±¡è¿›è¡Œæ‰«æï¼Œå¹¶å›æ”¶é‚£äº›ä¸å†ä½¿ç”¨å¯¹è±¡ï¼š</p><p><img src="https://pb01.s3.bitiful.net/115.png" alt="avatar"></p><p>æ¥ç€ï¼Œåœ¨ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹åï¼ŒEdenåŒºåŸŸæ²¡æœ‰è¢«å›æ”¶çš„å¯¹è±¡ï¼Œä¼šè¿›å…¥åˆ°SurvivoråŒºã€‚åœ¨ä¸€å¼€å§‹Fromå’ŒToéƒ½æ˜¯ç©ºçš„ï¼Œè€ŒGCä¹‹åï¼Œæ‰€æœ‰EdenåŒºåŸŸå­˜æ´»çš„å¯¹è±¡éƒ½ä¼šç›´æ¥è¢«æ”¾å…¥åˆ°FromåŒºï¼Œæœ€åFromå’ŒToä¼šå‘ç”Ÿä¸€æ¬¡äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®å‰å­˜æ”¾æˆ‘ä»¬å¯¹è±¡çš„FromåŒºï¼Œå˜ä¸ºToåŒºï¼Œè€ŒToåŒºå˜ä¸ºFromåŒºï¼š</p><p><img src="https://pb01.s3.bitiful.net/116.png" alt="avatar"></p><p>æ¥ç€å°±æ˜¯ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶äº†ï¼Œæ“ä½œä¸ä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™æ—¶ç”±äºæˆ‘ä»¬FromåŒºåŸŸä¸­å·²ç»å­˜åœ¨å¯¹è±¡äº†ï¼Œæ‰€ä»¥ï¼Œåœ¨EdenåŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°FromåŒºä¹‹åï¼Œæ‰€æœ‰ToåŒºåŸŸä¸­çš„å¯¹è±¡ä¼šè¿›è¡Œå¹´é¾„åˆ¤å®šï¼ˆæ¯ç»å†ä¸€è½®GCå¹´é¾„<code>+1</code>ï¼Œå½“å¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¤§äºè¿™ä¸ªé˜ˆå€¼çš„è¯,ä¼šç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ï¼Œå¦åˆ™ç§»åŠ¨åˆ°FromåŒºï¼‰</p><p><img src="https://pb01.s3.bitiful.net/117.png" alt="avatar"></p><p>æœ€ååƒä¸Šé¢ä¸€æ ·äº¤æ¢ToåŒºå’ŒFromåŒºï¼Œä¹‹åä¸æ–­é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚</p><h4 id="ç©ºé—´åˆ†é…æ‹…ä¿">ç©ºé—´åˆ†é…æ‹…ä¿</h4><p>æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰è¿™æ ·ä¸€ç§æç«¯æƒ…å†µï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ–°ç”Ÿä»£çš„å›æ”¶ç‡æ˜¯å¾ˆé«˜çš„ï¼Œæ‰€ä»¥è¯´ä¸ç”¨å¤ªæ‹…å¿ƒä¼šç»å¸¸å‡ºç°è¿™ç§é—®é¢˜ï¼‰ï¼Œåœ¨ä¸€æ¬¡GCåï¼Œæ–°ç”Ÿä»£EdenåŒºä»ç„¶å­˜åœ¨å¤§é‡çš„å¯¹è±¡ï¼ˆå› ä¸ºGCä¹‹åå­˜æ´»å¯¹è±¡ä¼šè¿›å…¥åˆ°ä¸€ä¸ªSurvivoråŒºï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™æ—¶å·²ç»è¶…å‡ºSurvivoråŒºçš„å®¹é‡äº†ï¼Œè‚¯å®šæ˜¯è£…ä¸ä¸‹çš„ï¼‰é‚£ä¹ˆç°åœ¨è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶äº†ï¼Œå¯ä»¥æŠŠSurvivoråŒºæ— æ³•å®¹çº³çš„å¯¹è±¡ç›´æ¥é€åˆ°è€å¹´ä»£ï¼Œè®©è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆå½“ç„¶è€å¹´ä»£ä¹Ÿå¾—è£…å¾—ä¸‹æ‰è¡Œï¼‰ã€‚å½“æ–°ç”Ÿä»£æ— æ³•å®¹çº³æ›´å¤šçš„çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥æŠŠæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ï¼Œè¿™æ ·æ–°ç”Ÿä»£å°±è…¾å‡ºäº†ç©ºé—´æ¥å®¹çº³æ›´å¤šçš„å¯¹è±¡ã€‚</p><p>å¥½ï¼Œé‚£æ—¢ç„¶æ–°ç”Ÿä»£è£…ä¸ä¸‹å°±ä¸¢ç»™è€å¹´ä»£ï¼Œé‚£ä¹ˆè¦æ˜¯è€å¹´ä»£ä¹Ÿè£…ä¸ä¸‹æ–°ç”Ÿä»£çš„æ•°æ®å‘¢ï¼Ÿè¿™æ—¶ï¼Œè€å¹´ä»£è‚¯å®šæ‹…ä¿äººæ˜¯å½“ä¸æˆäº†ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯ï¼Œé¦–å…ˆä¼šåˆ¤æ–­ä¸€ä¸‹ä¹‹å‰çš„æ¯æ¬¡åƒåœ¾å›æ”¶è¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°æ˜¯å¦å°äºå½“å‰è€å¹´ä»£çš„å‰©ä½™ç©ºé—´ï¼Œå¦‚æœå°äºï¼Œé‚£ä¹ˆè¯´æ˜ä¹Ÿè®¸å¯ä»¥æ”¾å¾—ä¸‹ï¼ˆä¸è¿‡ä¹Ÿä»…ä»…æ˜¯ä¹Ÿè®¸ï¼Œä¾ç„¶æœ‰å¯èƒ½æ”¾ä¸ä¸‹ï¼Œå› ä¸ºåˆ¤æ–­çš„å®é™…ä¸Šåªæ˜¯å¹³å‡å€¼ï¼Œä¸‡ä¸€è¿™ä¸€æ¬¡çªç„¶éå¸¸å¤§å‘¢ï¼‰ï¼Œå¦åˆ™ï¼Œä¼šå…ˆæ¥ä¸€æ¬¡Full GCï¼Œè¿›è¡Œä¸€æ¬¡å¤§è§„æ¨¡åƒåœ¾å›æ”¶ï¼Œæ¥å°è¯•è…¾å‡ºç©ºé—´ï¼Œå†æ¬¡åˆ¤æ–­è€å¹´ä»£æ˜¯å¦æœ‰ç©ºé—´å­˜æ”¾ï¼Œè¦æ˜¯è¿˜æ˜¯è£…ä¸ä¸‹ï¼Œç›´æ¥æŠ›å‡ºOOMé”™è¯¯ï¼Œæ‘†çƒ‚ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä¸€æ¬¡Minor GCçš„æ•´ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="https://pb01.s3.bitiful.net/118.png" alt="avatar"></p><hr><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•">æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†æ•´ä¸ªå †å†…å­˜å®é™…ä¸Šæ˜¯ä»¥åˆ†ä»£æ”¶é›†æœºåˆ¶ä¸ºä¸»ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰è®²åˆ°å…·ä½“çš„æ”¶é›†è¿‡ç¨‹ï¼Œé‚£ä¹ˆï¼Œå…·ä½“çš„å›æ”¶è¿‡ç¨‹åˆæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æœ€å¤è€çš„<code>æ ‡è®°-æ¸…é™¤</code>ç®—æ³•ã€‚</p><p>é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†ä¾æ¬¡å›æ”¶æ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œæˆ–æ˜¯æ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåªå›æ”¶æœªæ ‡è®°çš„å¯¹è±¡ã€‚</p><p>å¦‚æœæŒ‰ç…§å‰è€…çš„ç†è§£ï¼Œæ•´ä¸ªæ ‡è®°-æ¸…é™¤è¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œç»™ä¸€ä¸ªæ ‡è®°ä½ï¼Œå‡è®¾ä¸º 0 (false)ï¼›</li><li>åœ¨æ ‡è®°é˜¶æ®µï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆæˆ–ç”¨æˆ·å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼‰çš„æ ‡è®°ä½è®¾ç½®ä¸º 1 (true)ï¼›</li><li>æ‰«æé˜¶æ®µæ¸…é™¤çš„å°±æ˜¯æ ‡è®°ä½ä¸º 0 (false)çš„å¯¹è±¡ã€‚</li></ol><p><img src="https://pb01.s3.bitiful.net/119.png" alt="avatar"></p><p>è™½ç„¶æ­¤æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ ï¼Œé¦–å…ˆå¦‚æœå†…å­˜ä¸­å­˜åœ¨å¤§é‡çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šå­˜åœ¨å¤§é‡çš„æ ‡è®°ï¼Œå¹¶ä¸”å¤§è§„æ¨¡è¿›è¡Œæ¸…é™¤ã€‚å¹¶ä¸”ä¸€æ¬¡æ ‡è®°æ¸…é™¤ä¹‹åï¼Œè¿ç»­çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå‡ºç°è®¸è®¸å¤šå¤šçš„ç©ºéš™ï¼Œç¢ç‰‡åŒ–ä¼šå¯¼è‡´è¿ç»­å†…å­˜ç©ºé—´åˆ©ç”¨ç‡é™ä½ã€‚</p><h4 id="æ ‡è®°-å¤åˆ¶ç®—æ³•">æ ‡è®°-å¤åˆ¶ç®—æ³•</h4><p>æ—¢ç„¶æ ‡è®°æ¸…é™¤ç®—æ³•åœ¨é¢å¯¹å¤§é‡å¯¹è±¡æ—¶æ•ˆç‡ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ã€‚å®ƒå°†å®¹é‡åˆ†ä¸ºåŒæ ·å¤§å°çš„ä¸¤å—åŒºåŸŸï¼Œ</p><p>æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯å°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—åŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—åŒºåŸŸï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶ç»“æŸåï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å—åŒºåŸŸä¸­ï¼Œå¹¶ä¸€æ¬¡æ€§æ¸…ç©ºå½“å‰åŒºåŸŸã€‚è™½ç„¶æµªè´¹äº†ä¸€äº›æ—¶é—´è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œä½†æ˜¯è¿™æ ·èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¯¹è±¡å¤§é¢ç§¯å›æ”¶åç©ºé—´ç¢ç‰‡åŒ–ä¸¥é‡çš„é—®é¢˜ã€‚</p><p><img src="https://pb01.s3.bitiful.net/120.png" alt="avatar"></p><p>è¿™ç§ç®—æ³•å°±éå¸¸é€‚ç”¨äºæ–°ç”Ÿä»£ï¼ˆå› ä¸ºæ–°ç”Ÿä»£çš„å›æ”¶æ•ˆç‡æé«˜ï¼Œä¸€èˆ¬ä¸ä¼šç•™ä¸‹å¤ªå¤šçš„å¯¹è±¡ï¼‰çš„åƒåœ¾å›æ”¶ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„æ–°ç”Ÿä»£SurvivoråŒºå…¶å®å°±æ˜¯è¿™ä¸ªæ€è·¯ï¼ŒåŒ…æ‹¬8:1:1çš„æ¯”ä¾‹ä¹Ÿæ­£æ˜¯ä¸ºäº†å¯¹æ ‡è®°å¤åˆ¶ç®—æ³•è¿›è¡Œä¼˜åŒ–è€Œé‡‡å–çš„ã€‚</p><h4 id="æ ‡è®°-æ•´ç†ç®—æ³•">æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>è™½ç„¶æ ‡è®°-å¤åˆ¶ç®—æ³•èƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹æ–°ç”Ÿä»£é«˜å›æ”¶ç‡çš„åœºæ™¯ï¼Œä½†æ˜¯æ”¾åˆ°è€å¹´ä»£ï¼Œå®ƒå°±æ˜¾å¾—å¾ˆé¸¡è‚‹äº†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬é•¿æœŸéƒ½å›æ”¶ä¸åˆ°çš„å¯¹è±¡ï¼Œæ‰æœ‰æœºä¼šè¿›å…¥åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬éƒ½æ˜¯äº›é’‰å­æˆ·ï¼Œå¯èƒ½ä¸€æ¬¡GCåï¼Œä»ç„¶å­˜ç•™å¾ˆå¤šå¯¹è±¡ã€‚è€Œæ ‡è®°å¤åˆ¶ç®—æ³•ä¼šåœ¨GCåå®Œæ•´å¤åˆ¶æ•´ä¸ªåŒºåŸŸå†…å®¹ï¼Œå¹¶ä¸”ä¼šæŠ˜æŸ50%çš„åŒºåŸŸï¼Œæ˜¾ç„¶è¿™å¹¶ä¸é€‚ç”¨äºè€å¹´ä»£ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬èƒ½å¦è¿™æ ·ï¼Œåœ¨æ ‡è®°æ‰€æœ‰å¾…å›æ”¶å¯¹è±¡ä¹‹åï¼Œä¸æ€¥ç€å»è¿›è¡Œå›æ”¶æ“ä½œï¼Œè€Œæ˜¯å°†æ‰€æœ‰å¾…å›æ”¶çš„å¯¹è±¡æ•´é½æ’åˆ—åœ¨ä¸€æ®µå†…å­˜ç©ºé—´ä¸­ï¼Œè€Œéœ€è¦å›æ”¶çš„å¯¹è±¡å…¨éƒ¨å¾€åä¸¢ï¼Œè¿™æ ·ï¼Œå‰åŠéƒ¨åˆ†çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯æ— éœ€è¿›è¡Œå›æ”¶çš„ï¼Œè€ŒååŠéƒ¨åˆ†ç›´æ¥ä¸€æ¬¡æ€§æ¸…é™¤å³å¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/121.png" alt="avatar"></p><p>è™½ç„¶è¿™æ ·èƒ½ä¿è¯å†…å­˜ç©ºé—´å……åˆ†ä½¿ç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æ ‡è®°å¤åˆ¶ç®—æ³•é‚£ä¹ˆç¹æ‚ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå®ƒçš„æ•ˆç‡æ¯”å‰ä¸¤è€…éƒ½ä½ã€‚ç”šè‡³ï¼Œç”±äºéœ€è¦ä¿®æ”¹å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ­¤æ—¶ç¨‹åºå¿…é¡»è¦æš‚åœæ‰å¯ä»¥ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºå‘ç”Ÿåœé¡¿ï¼ˆè¢«ç§°ä¸ºâ€œStop The Worldâ€ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ‡è®°æ¸…é™¤ç®—æ³•å’Œæ ‡è®°æ•´ç†ç®—æ³•æ··åˆä½¿ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¿˜ä¸æ˜¯å¾ˆå‡Œä¹±çš„æ—¶å€™ï¼Œé‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•å…¶å®æ˜¯æ²¡æœ‰å¤šå¤§é—®é¢˜çš„ï¼Œå½“å†…å­˜ç©ºé—´å‡Œä¹±åˆ°ä¸€å®šç¨‹åº¦åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ¬¡æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><hr><h3 id="åƒåœ¾æ”¶é›†å™¨å®ç°">åƒåœ¾æ”¶é›†å™¨å®ç°</h3><p>èŠå®Œäº†å¯¹è±¡å­˜æ´»åˆ¤å®šå’Œåƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ¥ç€æˆ‘ä»¬å°±è¦çœ‹çœ‹å…·ä½“æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨çš„å®ç°äº†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£é€‰æ‹©æ›´é€‚åˆå®ƒä»¬çš„æ”¶é›†å™¨ã€‚</p><h4 id="Serialæ”¶é›†å™¨">Serialæ”¶é›†å™¨</h4><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯å…ƒè€çº§åˆ«çš„æ”¶é›†å™¨äº†ï¼Œåœ¨JDK1.3.1ä¹‹å‰ï¼Œæ˜¯è™šæ‹Ÿæœºæ–°ç”Ÿä»£åŒºåŸŸæ”¶é›†å™¨çš„å”¯ä¸€é€‰æ‹©ã€‚è¿™æ˜¯ä¸€æ¬¾å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œéœ€è¦æš‚åœæ‰€æœ‰çš„çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚å®ƒçš„æ–°ç”Ÿä»£æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><p><img src="https://pb01.s3.bitiful.net/122.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è¿›å…¥åˆ°åƒåœ¾å›æ”¶é˜¶æ®µæ—¶ï¼Œæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹å¿…é¡»ç­‰å¾…GCçº¿ç¨‹å®Œæˆå·¥ä½œï¼Œå°±ç›¸å½“äºä½ æ‰“ä¸€æŠŠLOL 40åˆ†é’Ÿï¼Œä¸­é€”æ¯éš”1åˆ†é’Ÿç½‘ç»œå°±å¡5ç§’é’Ÿï¼Œå¯èƒ½è¿™æ—¶ä½ æ­£åœ¨æ‰“å›¢ï¼Œç»“æœä½ è¢«ç‰©ç†æ§åˆ¶ç›´æ¥åœ¨é‚£é‡Œç«™äº†5ç§’é’Ÿï¼Œè¿™ç¡®å®è®©äººéš¾ä»¥æ¥å—ã€‚</p><p>è™½ç„¶ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯ä¼˜åŠ¿ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p><ol><li>è®¾è®¡ç®€å•è€Œé«˜æ•ˆã€‚</li><li>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå†…å­˜ä¸€èˆ¬ä¸å¤§ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li></ol><p>æ‰€ä»¥ï¼Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆä¸€èˆ¬ç”¨äºä¸€äº›æ¡Œé¢çº§å›¾å½¢åŒ–ç•Œé¢åº”ç”¨ç¨‹åºï¼‰ä¸‹çš„æ–°ç”Ÿä»£ä¸­ï¼Œé»˜è®¤åƒåœ¾æ”¶é›†å™¨è‡³ä»Šä¾ç„¶æ˜¯Serialæ”¶é›†å™¨ã€‚</p><h4 id="Serial-Oldæ”¶é›†å™¨">Serial Oldæ”¶é›†å™¨</h4><p><strong>Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚</p><h4 id="ParNewæ”¶é›†å™¨">ParNewæ”¶é›†å™¨</h4><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ç›¸å½“äºæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒå¤šçº¿ç¨‹åƒåœ¾æ”¶é›†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/123.png" alt="avatar"></p><p>é™¤äº†å¤šçº¿ç¨‹æ”¯æŒä»¥å¤–ï¼Œå…¶ä»–å†…å®¹åŸºæœ¬ä¸Serialæ”¶é›†å™¨ä¸€è‡´ï¼Œæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œæ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p><h4 id="Parallel-Scavenge-Parallel-Oldæ”¶é›†å™¨">Parallel Scavenge/Parallel Oldæ”¶é›†å™¨</h4><p>Parallel ScavengeåŒæ ·æ˜¯ä¸€æ¬¾é¢å‘æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒæ ·é‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•å®ç°ï¼Œåœ¨JDK6æ—¶ä¹Ÿæ¨å‡ºäº†å…¶è€å¹´ä»£æ”¶é›†å™¨Parallel Oldï¼Œé‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼š</p><p><img src="https://pb01.s3.bitiful.net/124.png" alt="avatar"></p><p>ä¸ParNewæ”¶é›†å™¨ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨è¡¡é‡ä¸€ä¸ªååé‡ï¼Œå¹¶æ ¹æ®ååé‡æ¥å†³å®šæ¯æ¬¡åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œè¿™ç§è‡ªé€‚åº”æœºåˆ¶ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°æƒè¡¡å½“å‰æœºå™¨çš„æ€§èƒ½ï¼Œæ ¹æ®æ€§èƒ½é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆã€‚</p><p>ç›®å‰JDK8é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ Parallel Scavenge + Parallel Old çš„åƒåœ¾å›æ”¶æ–¹æ¡ˆã€‚</p><h4 id="CMSæ”¶é›†å™¨">CMSæ”¶é›†å™¨</h4><p>åœ¨JDK1.5ï¼ŒHotSpotæ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweep,å³å¹¶è¡Œæ‰«ææ ‡è®°ï¼‰æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆæ³¨æ„è¿™é‡Œçš„å¹¶å‘å’Œä¹‹å‰çš„å¹¶è¡Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¹¶å‘å¯ä»¥ç†è§£ä¸ºåŒæ—¶è¿è¡Œç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼Œè€Œå¹¶è¡Œå¯ä»¥ç†è§£ä¸ºå¤šæ¡GCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼‰æ”¶é›†å™¨ï¼Œ<strong>å®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ</strong>ã€‚</p><p>å®ƒä¸»è¦é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š</p><p><img src="https://pb01.s3.bitiful.net/125.png" alt="avatar"></p><p>å®ƒçš„åƒåœ¾å›æ”¶åˆ†ä¸º4ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong> æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong> åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong> é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong> å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li></ul><p>è™½ç„¶å®ƒçš„ä¼˜ç‚¹éå¸¸ä¹‹å¤§ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´å¯ç”¨è¿ç»­ç©ºé—´é€æ¸å˜å°‘ï¼Œé•¿æœŸè¿™æ ·ä¸‹æ¥ï¼Œä¼šæœ‰æ›´é«˜çš„æ¦‚ç‡è§¦å‘Full GCï¼Œå¹¶ä¸”åœ¨ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå ç”¨ä¸€éƒ¨åˆ†çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œé€Ÿåº¦ä¸€å®šç¨‹åº¦ä¸Šå‡æ…¢ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœä½ å¸Œæœ›çš„æ˜¯æœ€ä½çš„GCåœé¡¿æ—¶é—´ï¼Œè¿™æ¬¾åƒåœ¾æ”¶é›†å™¨æ— ç–‘æ˜¯æœ€ä½³é€‰æ‹©ï¼Œä¸è¿‡è‡ªä»G1æ”¶é›†å™¨é—®ä¸–ä¹‹åï¼ŒCMSæ”¶é›†å™¨ä¸å†æ¨èä½¿ç”¨äº†ã€‚</p><h4 id="Garbage-First-G1-æ”¶é›†å™¨">Garbage First (G1) æ”¶é›†å™¨</h4><p>æ­¤åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€æ¬¾åˆ’æ—¶ä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨JDK7çš„æ—¶å€™æ­£å¼èµ°ä¸Šå†å²èˆå°ï¼Œå®ƒæ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘äºæœåŠ¡ç«¯çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶ä¸”åœ¨JDK9æ—¶ï¼Œå–ä»£äº†JDK8é»˜è®¤çš„ Parallel Scavenge + Parallel Old çš„å›æ”¶æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬çš„åƒåœ¾å›æ”¶åˆ†ä¸º<code>Minor GC</code>ã€<code>Major GC </code>å’Œ<code>Full GC</code>ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ•´ä¸ªå †å†…å­˜çš„åƒåœ¾å›æ”¶ï¼Œè€ŒG1æ”¶é›†å™¨å·§å¦™åœ°ç»•è¿‡äº†è¿™äº›çº¦å®šï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆ<code>2048</code>ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹<code>Region</code>å—ï¼Œæ¯ä¸ª<code>Regionå—</code>çš„å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”éƒ½ä¸º2çš„Næ¬¡å¹‚ã€‚æ‰€æœ‰çš„<code>Region</code>å¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><p>é‚£ä¹ˆåˆ†å‡ºè¿™äº›<code>Region</code>æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæ¯ä¸€ä¸ª<code>Region</code>éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªç”±å†³å®šæ‰®æ¼”å“ªä¸ªè§’è‰²ï¼ˆEdenã€Survivorå’Œè€å¹´ä»£ï¼‰ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®å¯¹åº”çš„è§’è‰²é‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥ã€‚æ­¤å¤–ï¼ŒG1æ”¶é›†å™¨è¿˜å­˜åœ¨ä¸€ä¸ªHumongousåŒºåŸŸï¼Œå®ƒä¸“é—¨ç”¨äºå­˜æ”¾å¤§å¯¹è±¡ï¼ˆä¸€èˆ¬è®¤ä¸ºå¤§å°è¶…è¿‡äº†Regionå®¹é‡ä¸€åŠçš„å¯¹è±¡ä¸ºå¤§å¯¹è±¡ï¼‰è¿™æ ·ï¼Œæ–°ç”Ÿä»£ã€è€å¹´ä»£åœ¨ç‰©ç†ä¸Šï¼Œä¸å†æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œè€Œæ˜¯åˆ°å¤„åˆ†å¸ƒçš„ã€‚</p><p><img src="https://pb01.s3.bitiful.net/126.png" alt="avatar"></p><p>å®ƒçš„å›æ”¶è¿‡ç¨‹ä¸CMSå¤§ä½“ç±»ä¼¼ï¼š</p><p><img src="https://pb01.s3.bitiful.net/127.png" alt="avatar"></p><p>åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li><p>**åˆå§‹æ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼š**ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</p></li><li><p>**å¹¶å‘æ ‡è®°ï¼š**ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>**æœ€ç»ˆæ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼š**å¯¹ç”¨æˆ·çº¿ç¨‹åšä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µæ¼æ ‡çš„é‚£éƒ¨åˆ†å¯¹è±¡ã€‚</p></li><li><p>**ç­›é€‰å›æ”¶ï¼š**è´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šä¸ªæ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</p></li></ul><p>å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>**å¹¶è¡Œä¸å¹¶å‘ï¼š**G1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li>**åˆ†ä»£æ”¶é›†ï¼š**è™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</li><li>**ç©ºé—´æ•´åˆï¼š**ä¸ CMS çš„â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚</li><li>**å¯é¢„æµ‹çš„åœé¡¿ï¼š**è¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚</li></ul><hr><h3 id="å…ƒç©ºé—´">å…ƒç©ºé—´</h3><p>JDK8ä¹‹å‰ï¼ŒHotspotè™šæ‹Ÿæœºçš„æ–¹æ³•åŒºå®é™…ä¸Šæ˜¯æ°¸ä¹…ä»£å®ç°çš„ã€‚åœ¨JDK8ä¹‹åï¼ŒHotspotè™šæ‹Ÿæœºä¸å†ä½¿ç”¨æ°¸ä¹…ä»£ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å…¨æ–°çš„å…ƒç©ºé—´ã€‚ç±»çš„å…ƒä¿¡æ¯è¢«å­˜å‚¨åœ¨å…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´æ²¡æœ‰ä½¿ç”¨å †å†…å­˜ï¼Œè€Œæ˜¯ä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸã€‚æ‰€ä»¥ï¼Œç†è®ºä¸Šç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„å†…å­˜æœ‰å¤šå¤§ï¼Œå…ƒç©ºé—´å°±æœ‰å¤šå¤§ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°æ°¸ä¹…ä»£å­˜åœ¨æ—¶çš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚è¿™é¡¹æ”¹é€ ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œæ°¸ä¹…ä»£çš„è°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®æ°¸ä¹…ä»£çš„å¤§å°ï¼Œä½†æ˜¯å¾ˆéš¾ç¡®å®šä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œå› ä¸ºå…¶ä¸­çš„å½±å“å› ç´ å¾ˆå¤šï¼Œæ¯”å¦‚ç±»æ•°é‡çš„å¤šå°‘ã€å¸¸é‡æ•°é‡çš„å¤šå°‘ç­‰ã€‚</p><p>å› æ­¤åœ¨JDK8æ—¶ç›´æ¥å°†æœ¬åœ°å†…å­˜ä½œä¸ºå…ƒç©ºé—´ï¼ˆ<strong>Metaspace</strong>ï¼‰çš„åŒºåŸŸï¼Œç‰©ç†å†…å­˜æœ‰å¤šå¤§ï¼Œå…ƒç©ºé—´å†…å­˜å°±å¯ä»¥æœ‰å¤šå¤§ï¼Œè¿™æ ·æ°¸ä¹…ä»£çš„ç©ºé—´åˆ†é…é—®é¢˜å°±è®²è§£äº†ï¼Œæ‰€ä»¥æœ€ç»ˆå®ƒå˜æˆäº†è¿™æ ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/128.png" alt="avatar"></p><hr><h3 id="å…¶ä»–å¼•ç”¨ç±»å‹">å…¶ä»–å¼•ç”¨ç±»å‹</h3><p><strong>1ï¼å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</strong></p><p>ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œ<strong>åƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒ</strong>ã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚</p><p><strong>2ï¼è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</strong><br>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚<strong>å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜</strong>ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>3ï¼å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong><br>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜</strong>ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>4ï¼è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</strong><br>&quot;è™šå¼•ç”¨&quot;é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶</strong>ã€‚</p><p><strong>è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨</strong>ã€‚</p><p>è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</p><p>ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬<strong>å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨</strong>ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸ºè½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå†…å­˜åŒºåŸŸ</title>
      <link href="/2023/12/18/JVM1/"/>
      <url>/2023/12/18/JVM1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="JVMå†…å­˜åŒºåŸŸ">JVMå†…å­˜åŒºåŸŸ</h1><p>åœ¨ä¼ ç»Ÿçš„C/C++å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é€šè¿‡ä½¿ç”¨ç”³è¯·å†…å­˜çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡æˆ–æ˜¯å­˜æ”¾æŸäº›æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦åœ¨ä½•æ—¶é‡Šæ”¾è¿™äº›å†…å­˜ï¼Œæ€ä¹ˆæ‰èƒ½ä½¿å¾—å†…å­˜çš„ä½¿ç”¨æœ€é«˜æ•ˆï¼Œå› æ­¤ï¼Œå†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªéå¸¸ä¸¥è‚ƒçš„é—®é¢˜ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Cè¯­è¨€<strong>mallocå‡½æ•°</strong>åŠ¨æ€ç”³è¯·å†…å­˜ï¼Œå¹¶ç”¨äºå­˜æ”¾æ•°æ®ï¼Œè€Œåœ¨Javaä¸­ï¼Œè¿™ç§æ“ä½œå®é™…ä¸Šæ˜¯ä¸å…è®¸çš„ï¼ŒJavaåªæ”¯æŒç›´æ¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ç±»å‹ï¼Œè‡³äºå†…å­˜åˆ°åº•å¦‚ä½•åˆ†é…ï¼Œå¹¶ä¸æ˜¯ç”±æˆ‘ä»¬æ¥å¤„ç†ï¼Œè€Œæ˜¯JVMå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ§åˆ¶ï¼Œè¿™æ ·å°±å¸®åŠ©æˆ‘ä»¬èŠ‚çœå¾ˆå¤šå†…å­˜ä¸Šçš„å·¥ä½œï¼Œè™½ç„¶å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦å‡ºç°å†…å­˜é—®é¢˜ï¼Œæˆ‘ä»¬å°±æ— æ³•åƒC/C++é‚£æ ·å¯¹æ‰€ç®¡ç†çš„å†…å­˜è¿›è¡Œåˆç†åœ°å¤„ç†ï¼Œå› ä¸ºæ‰€æœ‰çš„å†…å­˜æ“ä½œéƒ½æ˜¯ç”±JVMåœ¨è¿›è¡Œï¼Œåªæœ‰äº†è§£äº†JVMçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨å‡ºç°å†…å­˜ç›¸å…³é—®é¢˜æ—¶æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="å†…å­˜åŒºåŸŸåˆ’åˆ†">å†…å­˜åŒºåŸŸåˆ’åˆ†</h2><p>æ—¢ç„¶è¦ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆè‚¯å®šä¸ä¼šæ˜¯æ‚ä¹±æ— ç« çš„ï¼ŒJVMå¯¹å†…å­˜çš„ç®¡ç†é‡‡ç”¨çš„æ˜¯åˆ†åŒºæ²»ç†ï¼Œä¸åŒçš„å†…å­˜åŒºåŸŸæœ‰ç€å„è‡ªçš„èŒè´£æ‰€åœ¨ï¼Œåœ¨è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œå†…å­˜åŒºåŸŸå¦‚ä¸‹åˆ’åˆ†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/92.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/93.png" alt="avatar"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜åŒºåŸŸä¸€å…±åˆ†ä¸º5ä¸ªåŒºåŸŸï¼Œå…¶ä¸­æ–¹æ³•åŒº,å †å’Œç›´æ¥å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œéšç€è™šæ‹Ÿæœºçš„åˆ›å»ºè€Œåˆ›å»ºï¼Œè™šæ‹Ÿæœºçš„ç»“æŸè€Œé”€æ¯ï¼Œè€Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åŒºåŸŸï¼Œå¹¶ä¸”çº¿ç¨‹å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œç»“æŸä¹‹åä¼šè‡ªåŠ¨é”€æ¯ã€‚å†…å­˜åˆ’åˆ†å®Œæˆä¹‹åï¼Œæˆ‘ä»¬çš„JVMæ‰§è¡Œå¼•æ“å’Œæœ¬åœ°åº“æ¥å£ï¼Œä¹Ÿå°±æ˜¯Javaç¨‹åºå¼€å§‹è¿è¡Œä¹‹åå°±ä¼šæ ¹æ®åˆ†åŒºåˆç†åœ°ä½¿ç”¨å¯¹åº”åŒºåŸŸçš„å†…å­˜äº†ã€‚</p><h3 id="å¤§è‡´åˆ’åˆ†">å¤§è‡´åˆ’åˆ†</h3><h4 id="ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Œå®ƒå’Œæˆ‘ä»¬çš„ä¼ ç»Ÿ8086 CPUä¸­PCå¯„å­˜å™¨çš„å·¥ä½œå·®ä¸å¤šï¼Œå› ä¸ºJVMè™šæ‹Ÿæœºç›®çš„å°±æ˜¯å®ç°ç‰©ç†æœºé‚£æ ·çš„ç¨‹åºæ‰§è¡Œã€‚åœ¨8086 CPUä¸­ï¼ŒPCä½œä¸ºç¨‹åºè®¡æ•°å™¨ï¼Œè´Ÿè´£å‚¨å­˜å†…å­˜åœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘ä¸‹ä¸€æ¡å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¯è§£é‡Šæ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ï¼ŒPCå¯„å­˜å™¨çš„å€¼å°±ä¼šè‡ªåŠ¨è¢«æ›´æ–°ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸæ—¶ï¼Œå°±ä¼šæ ¹æ®å½“å‰åœ°å€æ‰€æŒ‡å‘çš„æŒ‡ä»¤ï¼Œè¿›è¡Œæ‰§è¡Œã€‚</p><p>è€ŒJVMä¸­çš„ç¨‹åºè®¡æ•°å™¨å¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œè€Œè¡Œå·æ­£å¥½å°±æŒ‡çš„æ˜¯æŸä¸€æ¡æŒ‡ä»¤ï¼Œå­—èŠ‚ç è§£é‡Šå™¨åœ¨å·¥ä½œæ—¶ä¹Ÿä¼šæ”¹å˜è¿™ä¸ªå€¼ï¼Œæ¥æŒ‡å®šä¸‹ä¸€æ¡å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p><p>å› ä¸ºJavaçš„å¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¾é æ—¶é—´ç‰‡è½®è½¬ç®—æ³•è¿›è¡Œçš„ï¼Œå› æ­¤ä¸€ä¸ªCPUåŒä¸€æ—¶é—´ä¹Ÿåªä¼šå¤„ç†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“æŸä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡æ¶ˆè€—å®Œæˆåï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œè€Œå½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®ä¼šè¢«ä¿å­˜åˆ°å½“å‰çº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨ä¸­ï¼Œå½“ä¸‹æ¬¡è½®è½¬åˆ°æ­¤çº¿ç¨‹æ—¶ï¼Œåˆç»§ç»­æ ¹æ®ä¹‹å‰çš„æ‰§è¡Œä½ç½®ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><p>ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚</p><p>ç¨‹åºè®¡æ•°å™¨å› ä¸ºåªéœ€è¦è®°å½•å¾ˆå°‘çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åªå ç”¨å¾ˆå°‘ä¸€éƒ¨åˆ†å†…å­˜ã€‚</p><p>âš ï¸ æ³¨æ„ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°<strong>OutOfMemoryError</strong>çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚</p><h4 id="è™šæ‹Ÿæœºæ ˆ">è™šæ‹Ÿæœºæ ˆ</h4><p>è™šæ‹Ÿæœºæ ˆå°±æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„éƒ¨åˆ†ï¼Œçœ‹åå­—å°±çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼Œæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆå…¶å®å°±æ˜¯æ ˆé‡Œé¢çš„ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œæ ˆå¸§ä¸­åŒ…æ‹¬äº†å½“å‰æ–¹æ³•çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/95.png" alt="avatar"></p><p>å…¶ä¸­å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ï¼Œåœ¨classæ–‡ä»¶ä¸­å°±å·²ç»å®šä¹‰å¥½äº†</p><p><strong>æ“ä½œæ•°æ ˆ</strong>ä¸»è¦ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„<strong>ä¸­é—´è®¡ç®—ç»“æœ</strong>ã€‚å¦å¤–ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„<strong>ä¸´æ—¶å˜é‡</strong>ä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­</p><p>æ¯ä¸ªæ ˆå¸§è¿˜ä¿å­˜äº†ä¸€ä¸ª<strong>å¯ä»¥æŒ‡å‘å½“å‰æ–¹æ³•æ‰€åœ¨ç±»</strong>çš„<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œç›®çš„æ˜¯ï¼šå½“å‰æ–¹æ³•ä¸­å¦‚æœéœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä»è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œç„¶åå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç„¶åå°±èƒ½ç›´æ¥è°ƒç”¨å¯¹åº”æ–¹æ³•ï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥</p><p><img src="https://pb01.s3.bitiful.net/94.png" alt="avatar"></p><p>æœ€åæ˜¯<strong>æ–¹æ³•å‡ºå£</strong>ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•è¯¥å¦‚ä½•ç»“æŸï¼Œæ˜¯æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯æ­£å¸¸è¿”å›ï¼Œä¸ç®¡å“ªç§è¿”å›æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ æ ˆå¸§éšç€æ–¹æ³•è°ƒç”¨è€Œåˆ›å»ºï¼Œéšç€æ–¹æ³•ç»“æŸè€Œé”€æ¯ã€‚æ— è®ºæ–¹æ³•æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆéƒ½ç®—ä½œæ–¹æ³•ç»“æŸã€‚</p><p>ç¨‹åºè¿è¡Œä¸­æ ˆå¯èƒ½ä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š</p><ul><li><strong>StackOverFlowError</strong>ï¼š è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚</li><li><strong>OutOfMemoryError</strong>ï¼š å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹æ•´ä¸ªè™šæ‹Ÿæœºæ ˆçš„è¿ä½œæµç¨‹ï¼Œæˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> a();</span><br><span class="line">        System.out.println(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">b</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">c</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬çš„ä¸»æ–¹æ³•æ‰§è¡Œåï¼Œä¼šä¾æ¬¡æ‰§è¡Œä¸‰ä¸ªæ–¹æ³•<code>a() -&gt; b() -&gt; c() -&gt; è¿”å›</code>ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥è§‚å¯Ÿä¸€ä¸‹åç¼–è¯‘ä¹‹åçš„ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.test.Main();   #è¿™ä¸ªæ˜¯æ„é€ æ–¹æ³•</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/test/Main;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;    #ä¸»æ–¹æ³•</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">2</span>                  <span class="comment">// Method a:()I</span></span><br><span class="line">         <span class="number">3</span>: istore_1</span><br><span class="line">         <span class="number">4</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">7</span>: iload_1</span><br><span class="line">         <span class="number">8</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">11</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">11</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">12</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">4</span>       <span class="number">8</span>     <span class="number">1</span>   res   I</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">a</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">5</span>                  <span class="comment">// Method b:()I</span></span><br><span class="line">         <span class="number">3</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">b</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">6</span>                  <span class="comment">// Method c:()I</span></span><br><span class="line">         <span class="number">3</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">14</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">c</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_0</span><br><span class="line">         <span class="number">3</span>: bipush        <span class="number">20</span></span><br><span class="line">         <span class="number">5</span>: istore_1</span><br><span class="line">         <span class="number">6</span>: iload_0</span><br><span class="line">         <span class="number">7</span>: iload_1</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">18</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">19</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">20</span>: <span class="number">6</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">3</span>       <span class="number">7</span>     <span class="number">0</span>     a   I</span><br><span class="line">            <span class="number">6</span>       <span class="number">4</span>     <span class="number">1</span>     b   I</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬æ•´ä¸ªæ–¹æ³•çš„æœ€å¤§æ“ä½œæ•°æ ˆæ·±åº¦ã€å±€éƒ¨å˜é‡è¡¨éƒ½æ˜¯å·²ç»ç¡®å®šå¥½çš„ï¼Œå½“æˆ‘ä»¬ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›ä¿¡æ¯å°è£…ä¸ºå¯¹åº”çš„æ ˆå¸§ï¼Œæˆ‘ä»¬ä»<code>main</code>æ–¹æ³•å¼€å§‹çœ‹èµ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/96.png" alt="avatar"></p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­å¾€ä¸‹ï¼Œåˆ°äº†<code> 0: invokestatic  #2                  // Method a:()I</code>æ—¶ï¼Œéœ€è¦è°ƒç”¨æ–¹æ³•<code>a()</code>ï¼Œè¿™æ—¶å½“å‰æ–¹æ³•å°±ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œè€Œæ˜¯å»æ‰§è¡Œæ–¹æ³•<code>a()</code>ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œå°†æ­¤æ–¹æ³•ä¹Ÿå…¥æ ˆï¼Œæ³¨æ„æ˜¯æ”¾å…¥åˆ°æ ˆé¡¶ä½ç½®ï¼Œ<code>main</code>æ–¹æ³•çš„æ ˆå¸§ä¼šè¢«å‹ä¸‹å»ï¼š</p><p><img src="https://pb01.s3.bitiful.net/97.png" alt="avatar"></p><p>è¿™æ—¶ï¼Œè¿›å…¥æ–¹æ³•aä¹‹åï¼Œåˆç»§è€Œè¿›å…¥åˆ°æ–¹æ³•bï¼Œæœ€ååœ¨è¿›å…¥cï¼Œå› æ­¤ï¼Œåˆ°è¾¾æ–¹æ³•cçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºæ ˆå˜æˆäº†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/98.png" alt="avatar"></p><p>ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ‰§è¡Œæ–¹æ³•cä¸­çš„æŒ‡ä»¤ï¼Œæœ€åè¿”å›a+bçš„ç»“æœï¼Œåœ¨æ–¹æ³•cè¿”å›ä¹‹åï¼Œä¹Ÿå°±ä»£è¡¨æ–¹æ³•cå·²ç»æ‰§è¡Œç»“æŸäº†ï¼Œæ ˆå¸§4ä¼šè‡ªåŠ¨å‡ºæ ˆï¼Œè¿™æ—¶æ ˆå¸§3å°±å¾—åˆ°äº†ä¸Šä¸€æ ˆå¸§è¿”å›çš„ç»“æœï¼Œå¹¶ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºç´§æ¥ç€é©¬ä¸Šå°±è¿”å›ï¼Œæ‰€ä»¥ç»§ç»­é‡å¤æ ˆå¸§4çš„æ“ä½œï¼Œæ­¤æ—¶æ ˆå¸§3ä¹Ÿå‡ºæ ˆå¹¶ç»§ç»­å°†ç»“æœäº¤ç»™ä¸‹ä¸€ä¸ªæ ˆå¸§2ï¼Œæœ€åæ ˆå¸§2å†å°†ç»“æœè¿”å›ç»™æ ˆå¸§1ï¼Œç„¶åæ ˆå¸§1å°±å¯ä»¥ç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œæœ€åè¾“å‡ºç»“æœã€‚</p><p><img src="https://pb01.s3.bitiful.net/99.png" alt="avatar"></p><h4 id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡</strong>ã€‚</p><p>æœ¬åœ°æ–¹æ³•æ ˆåœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§é”™è¯¯ã€‚</p><h4 id="å †">å †</h4><p>å †æ˜¯æ•´ä¸ªJavaåº”ç”¨ç¨‹åºå…±äº«çš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æ•´ä¸ªè™šæ‹Ÿæœºæœ€å¤§çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œè€Œæ­¤åŒºåŸŸçš„èŒè´£å°±æ˜¯å­˜æ”¾å’Œç®¡ç†å¯¹è±¡å’Œæ•°ç»„ã€‚</p><p>Java ä¸–ç•Œä¸­â€œ<strong>å‡ ä¹</strong>â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…ï¼Œä½†æ˜¯ï¼Œéšç€ JIT ç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ä» JDK 1.7 å¼€å§‹å·²ç»é»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œ<strong>å¦‚æœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜</strong>ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ GC å †ï¼ˆGarbage Collected Heapï¼‰ã€‚ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenã€Survivorã€Old ç­‰ç©ºé—´ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p>ä¸‹å›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 éƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ï¼Œæœ€ä¸‹é¢ä¸€å±‚å±äºæ°¸ä¹…ä»£ã€‚</p><p><img src="https://pb01.s3.bitiful.net/100.png" alt="avatar"></p><p><strong>JDK 8 ç‰ˆæœ¬ä¹‹å PermGen(æ°¸ä¹…ä»£) å·²è¢« Metaspace(å…ƒç©ºé—´) å–ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜</strong>ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ Eden åŒºåˆ†é…ã€‚å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC(æ–°ç”Ÿä»£åƒåœ¾å›æ”¶)ã€‚åœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šå˜ä¸º1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1,æ¯ç»å†ä¸€æ¬¡Minor GCä¸”å­˜æ´»ä¸‹æ¥,å¹´é¾„+1)ã€‚å½“å¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼(<strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</strong>)ã€‚</p><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£:</strong></p><p>å¯¹äºä¸€ä¸ªå¤§å¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆåœ¨Eden å°è¯•åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºä¸äº†ï¼Œå°±ä¼šè§¦å‘Minor GCã€‚éšåç»§ç»­å°è¯•åœ¨EdenåŒºå­˜æ”¾ï¼Œå‘ç°ä»ç„¶æ”¾ä¸ä¸‹ï¼Œå°è¯•ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œè§¦å‘ Full GC æ¸…ç†ç©ºé—´,å†æ¬¡æ”¾å…¥è€å¹´ä»£ï¼Œå¦‚æœæ”¾ä¸ä¸‹å°±æŠ¥OutOfMemoryé”™è¯¯ã€‚</p><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„è¡Œä¸ºæ˜¯ç”±è™šæ‹ŸæœºåŠ¨æ€å†³å®šçš„ï¼Œå®ƒä¸å…·ä½“ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨å’Œç›¸å…³å‚æ•°æœ‰å…³ã€‚<strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œæ—¨åœ¨é¿å…å°†å¤§å¯¹è±¡æ”¾å…¥æ–°ç”Ÿä»£ï¼Œä»è€Œå‡å°‘æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡å’Œæˆæœ¬</strong>ã€‚</p><p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š<br><strong>1. éƒ¨åˆ†æ”¶é›† (Partial GC)</strong>ï¼š</p><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</li></ul><p><strong>2. æ•´å †æ”¶é›† (Full GC)</strong>ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºã€‚</p><ul><li>è§¦å‘æ¡ä»¶1ï¼šæ¯æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹³å‡å¤§å°å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶2ï¼šMinor GCåå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶3ï¼šæ°¸ä¹…ä»£å†…å­˜ä¸è¶³ï¼ˆJDK8ä¹‹å‰ï¼‰</li><li>è§¦å‘æ¡ä»¶4ï¼šæ‰‹åŠ¨è°ƒç”¨<code>System.gc()</code>æ–¹æ³•</li></ul><p>å †è¿™é‡Œæœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ OutOfMemoryError é”™è¯¯ï¼Œå¹¶ä¸”å‡ºç°è¿™ç§é”™è¯¯ä¹‹åçš„è¡¨ç°å½¢å¼è¿˜ä¼šæœ‰å‡ ç§ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>java.lang.OutOfMemoryError: GC Overhead Limit Exceeded</strong>ï¼šå½“ JVM èŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚</li><li><strong>java.lang.OutOfMemoryError: Java heap space</strong> :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘æ­¤é”™è¯¯ã€‚(å’Œé…ç½®çš„æœ€å¤§å †å†…å­˜æœ‰å…³ï¼Œä¸”å—åˆ¶äºç‰©ç†å†…å­˜å¤§å°ã€‚æœ€å¤§å †å†…å­˜å¯é€šè¿‡-Xmxå‚æ•°é…ç½®ï¼Œè‹¥æ²¡æœ‰ç‰¹åˆ«é…ç½®ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼)</li></ul><h4 id="æ–¹æ³•åŒº">æ–¹æ³•åŒº</h4><p>æ–¹æ³•åŒºä¹Ÿæ˜¯æ•´ä¸ªJavaåº”ç”¨ç¨‹åºå…±äº«çš„åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨æ‰€æœ‰çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€åŠ¨æ€ç¼–è¯‘ç¼“å­˜ç­‰æ•°æ®ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç±»ä¿¡æ¯è¡¨ï¼Œä¸€ä¸ªæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p>æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚å¹¶ä¸”ï¼Œæ°¸ä¹…ä»£æ˜¯ JDK 1.8 ä¹‹å‰çš„æ–¹æ³•åŒºå®ç°ï¼ŒJDK 1.8 åŠä»¥åæ–¹æ³•åŒºçš„å®ç°å˜æˆäº†å…ƒç©ºé—´ã€‚</p><p><img src="https://pb01.s3.bitiful.net/101.png" alt="avatar"></p><p>é¦–å…ˆç±»ä¿¡æ¯è¡¨ä¸­å­˜æ”¾çš„æ˜¯å½“å‰åº”ç”¨ç¨‹åºåŠ è½½çš„æ‰€æœ‰ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶ä¼šå°†ç¼–è¯‘æ—¶ç”Ÿæˆçš„å¸¸é‡æ± æ•°æ®å…¨éƒ¨å­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚å½“ç„¶ï¼Œå¸¸é‡ä¹Ÿå¹¶ä¸æ˜¯åªèƒ½ä»ç±»ä¿¡æ¯ä¸­è·å–ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šæœ‰æ–°çš„å¸¸é‡è¿›å…¥åˆ°å¸¸é‡æ± ã€‚</p><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><p>Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨çš„ å¸¸é‡æ± è¡¨ã€‚</p><p>å¸¸é‡æ± è¡¨ä¼šåœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠŸèƒ½ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„ç¬¦å·è¡¨ï¼Œå°½ç®¡å®ƒåŒ…å«äº†æ¯”å…¸å‹ç¬¦å·è¡¨æ›´å¹¿æ³›çš„æ•°æ®ã€‚</p><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong><br>å­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</p><p>JDK1.7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£ã€‚JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± å’Œé™æ€å˜é‡ä»æ°¸ä¹…ä»£ç§»åŠ¨äº† Java å †ä¸­ã€‚</p><p><strong>JDK 1.7 ä¸ºä»€ä¹ˆè¦å°†å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åŠ¨åˆ°å †ä¸­ï¼Ÿ</strong><br>ä¸»è¦æ˜¯å› ä¸ºæ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºå®ç°ï¼‰çš„ GC å›æ”¶æ•ˆç‡å¤ªä½ï¼Œåªæœ‰åœ¨æ•´å †æ”¶é›† (Full GC)çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œ GCã€‚Java ç¨‹åºä¸­é€šå¸¸ä¼šæœ‰å¤§é‡çš„è¢«åˆ›å»ºçš„å­—ç¬¦ä¸²ç­‰å¾…å›æ”¶ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åˆ°å †ä¸­ï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåŠæ—¶åœ°å›æ”¶å­—ç¬¦ä¸²å†…å­˜ã€‚</p><p>æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(str1 == str2);</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œç”±äº<code>str1</code>å’Œ<code>str2</code>æ˜¯å•ç‹¬åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å®é™…ä¸Šä¼šåœ¨å †ä¸­å­˜æ”¾ï¼Œä¿å­˜åœ¨ä¸åŒçš„åœ°å€ï¼š</p><p><img src="https://pb01.s3.bitiful.net/102.png" alt="avatar"></p><p>æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨<code>==</code>åˆ¤æ–­æ—¶ï¼Œå¾—åˆ°çš„ç»“æœ<code>false</code>ï¼Œè€Œä½¿ç”¨<code>equals</code>æ—¶å› ä¸ºæ¯”è¾ƒçš„æ˜¯å€¼ï¼Œæ‰€ä»¥å¾—åˆ°<code>true</code>ã€‚ç°åœ¨æˆ‘ä»¬æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(str1 == str2);</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨newçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åŒå¼•å·åˆ›å»ºï¼Œé‚£ä¹ˆè¿™æ—¶å¾—åˆ°çš„ç»“æœå°±å˜æˆäº†ä¸¤ä¸ª<code>true</code>ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™å…¶å®æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨åŒå¼•å·èµ‹å€¼ï¼Œä¼šå…ˆåœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™å°†å¼•ç”¨ç›´æ¥æŒ‡å‘è¯¥å­—ç¬¦ä¸²ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†å°†å¼•ç”¨æŒ‡å‘è¯¥å­—ç¬¦ä¸²ï¼š</p><p><img src="https://pb01.s3.bitiful.net/103.png" alt="avatar"></p><p>å®é™…ä¸Šä¸¤æ¬¡è°ƒç”¨Stringç±»çš„<code>intern()</code>æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„æ•ˆæœå·®ä¸å¤šï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šå°†å †ä¸­å­—ç¬¦ä¸²å¤åˆ¶å¹¶æ”¾å…¥å¸¸é‡æ± ä¸­ï¼Œç¬¬äºŒæ¬¡é€šè¿‡æ­¤æ–¹æ³•è·å–å­—ç¬¦ä¸²æ—¶ï¼Œä¼šæŸ¥çœ‹å¸¸é‡æ± ä¸­æ˜¯å¦åŒ…å«ï¼Œå¦‚æœåŒ…å«é‚£ä¹ˆä¼šç›´æ¥è¿”å›å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²çš„åœ°å€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸èƒ½ç›´æ¥å†™&quot;abc&quot;ï¼ŒåŒå¼•å·çš„å½¢å¼ï¼Œå†™äº†å°±ç›´æ¥åœ¨å¸¸é‡æ± é‡Œé¢å§abcåˆ›å¥½äº†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(str1.intern() == str2.intern());</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/104.png" alt="avatar"></p><p>æ‰€ä»¥ä¸Šè¿°ç»“æœä¸­å¾—åˆ°çš„ä¾ç„¶æ˜¯ä¸¤ä¸ª<code>true</code>ã€‚åœ¨JDK1.7ä¹‹åï¼Œç¨å¾®æœ‰ä¸€äº›åŒºåˆ«ï¼Œåœ¨è°ƒç”¨<code>intern()</code>æ–¹æ³•æ—¶ï¼Œå½“å¸¸é‡æ± ä¸­æ²¡æœ‰å¯¹åº”çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¸ä¼šå†è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œè€Œæ˜¯å°†å…¶ç›´æ¥ä¿®æ”¹ä¸ºæŒ‡å‘å½“å‰å­—ç¬¦ä¸²å †ä¸­çš„çš„å¼•ç”¨ï¼š</p><p><img src="https://pb01.s3.bitiful.net/105.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="comment">//ä¸èƒ½ç›´æ¥å†™&quot;abc&quot;ï¼ŒåŒå¼•å·çš„å½¢å¼ï¼Œå†™äº†å°±ç›´æ¥åœ¨å¸¸é‡æ± é‡Œé¢å§abcåˆ›å¥½äº†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    System.out.println(str1.intern() == str1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åæˆ‘ä»¬ä¼šå‘ç°ï¼Œ<code>str1.intern()</code>å’Œ<code>str1</code>éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œç»“æœä¸º<code>true</code>ã€‚</p><p>æœ€åæˆ‘ä»¬å†æ¥è¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼Œå„ä¸ªå†…å­˜åŒºåŸŸçš„ç”¨é€”ï¼š</p><ul><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰ç¨‹åºè®¡æ•°å™¨ï¼šä¿å­˜å½“å‰ç¨‹åºçš„æ‰§è¡Œä½ç½®ã€‚</li><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰è™šæ‹Ÿæœºæ ˆï¼šé€šè¿‡æ ˆå¸§æ¥ç»´æŒæ–¹æ³•è°ƒç”¨é¡ºåºï¼Œå¸®åŠ©æ§åˆ¶ç¨‹åºæœ‰åºè¿è¡Œã€‚</li><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰æœ¬åœ°æ–¹æ³•æ ˆï¼šåŒä¸Šï¼Œä½œç”¨ä¸æœ¬åœ°æ–¹æ³•ã€‚</li><li>å †ï¼šå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„éƒ½åœ¨è¿™é‡Œä¿å­˜,å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚</li><li>æ–¹æ³•åŒºï¼šç±»ä¿¡æ¯ã€å³æ—¶ç¼–è¯‘å™¨çš„ä»£ç ç¼“å­˜ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li></ul><h3 id="çˆ†å†…å­˜å’Œçˆ†æ ˆ">çˆ†å†…å­˜å’Œçˆ†æ ˆ</h3><p>å®é™…ä¸Šï¼Œåœ¨Javaç¨‹åºè¿è¡Œæ—¶ï¼Œå†…å­˜å®¹é‡ä¸å¯èƒ½æ˜¯æ— é™åˆ¶çš„ï¼Œå½“æˆ‘ä»¬çš„å¯¹è±¡åˆ›å»ºè¿‡å¤šæˆ–æ˜¯æ•°ç»„å®¹é‡è¿‡å¤§æ—¶ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„å †å†…å­˜ä¸è¶³ä»¥å­˜æ”¾æ›´å¤šæ–°çš„å¯¹è±¡æˆ–æ˜¯æ•°ç»„ï¼Œè¿™æ—¶å°±ä¼šå‡ºç°é”™è¯¯ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[Integer.MAX_VALUE];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”³è¯·äº†ä¸€ä¸ªå®¹é‡ä¸º21äº¿å¤šçš„intå‹æ•°ç»„ï¼Œæ˜¾ç„¶ï¼Œå¦‚æ­¤ä¹‹å¤§çš„æ•°ç»„ä¸å¯èƒ½æ”¾åœ¨æˆ‘ä»¬çš„å †å†…å­˜ä¸­ï¼Œæ‰€ä»¥ç¨‹åºè¿è¡Œæ—¶å°±ä¼šè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Requested array size exceeds VM limit</span><br><span class="line">at com.test.Main.main(Main.java:<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¾—åˆ°äº†ä¸€ä¸ª<code>OutOfMemoryError</code>é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å†…å­˜æº¢å‡ºé”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°æ¥æ§åˆ¶å †å†…å­˜çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmsæœ€å°å€¼ -Xmxæœ€å¤§å€¼</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨é™åˆ¶å †å†…å­˜ä¸ºå›ºå®šå€¼1Må¤§å°ï¼Œå¹¶ä¸”åœ¨æŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶ä¿å­˜å½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ï¼š</p><p><img src="https://pb01.s3.bitiful.net/106.png" alt="avatar"></p><p>æ³¨æ„å †å†…å­˜ä¸è¦è®¾ç½®å¤ªå°ï¼Œä¸ç„¶è¿è™šæ‹Ÿæœºéƒ½ä¸è¶³ä»¥å¯åŠ¨ï¼Œæ¥ç€æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªä¸€å®šä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Test&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">Test</span>());    <span class="comment">//æ— é™åˆ›å»ºTestå¯¹è±¡å¹¶ä¸¢è¿›Listä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¨‹åºè¿è¡Œä¹‹åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid35172.hprof ...</span><br><span class="line">Heap dump file created [12895344 bytes in 0.028 secs]</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3210)</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3181)</span><br><span class="line">at java.util.ArrayList.grow(ArrayList.java:267)</span><br><span class="line">at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:241)</span><br><span class="line">at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:233)</span><br><span class="line">at java.util.ArrayList.add(ArrayList.java:464)</span><br><span class="line">at com.test.Main.main(Main.java:10)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é”™è¯¯å‡ºç°åŸå› æ­£æ˜¯<code>Java heap space</code>ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜æ»¡äº†ï¼Œå¹¶ä¸”æ ¹æ®æˆ‘ä»¬è®¾å®šçš„VMå‚æ•°ï¼Œå †å†…å­˜ä¿å­˜äº†å¿«ç…§ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨IDEAå†…ç½®çš„Profilerä¸­è¿›è¡ŒæŸ¥çœ‹ï¼š</p><p><img src="https://pb01.s3.bitiful.net/107.png" alt="avatar"></p><p>å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹åˆ°ï¼Œåœ¨åˆ›å»ºäº†360146ä¸ªTestå¯¹è±¡ä¹‹åï¼Œå †å†…å­˜ä¸å¤Ÿäº†ï¼Œäºæ˜¯å°±æŠ›å‡ºäº†å†…å­˜æº¢å‡ºé”™è¯¯ã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè™šæ‹Ÿæœºæ ˆä¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶æ’å…¥æ ˆå¸§ï¼Œé‚£ä¹ˆï¼Œè®¾æƒ³å¦‚æœå‡ºç°æ— é™é€’å½’çš„æƒ…å†µå‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªæ°¸æ— ä¼‘æ­¢çš„ç¨‹åºï¼Œå¹¶ä¸”ä¼šä¸æ–­ç»§ç»­å‘ä¸‹è°ƒç”¨testæ–¹æ³•æœ¬èº«ï¼Œé‚£ä¹ˆæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„é€»è¾‘æ¨å¯¼ï¼Œæ— é™åœ°æ’å…¥æ ˆå¸§é‚£ä¹ˆä¸€å®šä¼šå°†è™šæ‹Ÿæœºæ ˆå¡æ»¡ï¼Œæ‰€ä»¥ï¼Œå½“æ ˆçš„æ·±åº¦å·²ç»ä¸è¶³ä»¥ç»§ç»­æ’å…¥æ ˆå¸§æ—¶ï¼Œå°±ä¼šè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.StackOverflowError</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">....ä»¥ä¸‹çœç•¥å¾ˆå¤šè¡Œ</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ ˆæº¢å‡ºï¼Œå®ƒå’Œå †æº¢å‡ºæ¯”è¾ƒç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”±äºå®¹çº³ä¸ä¸‹æ‰å¯¼è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-Xss</code>æ¥è®¾å®šæ ˆå®¹é‡ã€‚</p><h3 id="ç”³è¯·å †å¤–å†…å­˜">ç”³è¯·å †å¤–å†…å­˜</h3><p>é™¤äº†å †å†…å­˜å¯ä»¥å­˜æ”¾å¯¹è±¡æ•°æ®ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”³è¯·å †å¤–å†…å­˜ï¼ˆç›´æ¥å†…å­˜ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸å—JVMç®¡æ§çš„å†…å­˜åŒºåŸŸï¼Œè¿™éƒ¨åˆ†åŒºåŸŸçš„å†…å­˜éœ€è¦æˆ‘ä»¬è‡ªè¡Œå»ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®é™…ä¸Šæœ¬è´¨å°±æ˜¯JVMé€šè¿‡C/C++è°ƒç”¨<code>malloc</code>å‡½æ•°ç”³è¯·çš„å†…å­˜ï¼Œå½“ç„¶å¾—æˆ‘ä»¬è‡ªå·±å»é‡Šæ”¾äº†ã€‚ä¸è¿‡è™½ç„¶æ˜¯ç›´æ¥å†…å­˜ï¼Œä¸ä¼šå—åˆ°å †å†…å­˜å®¹é‡é™åˆ¶ï¼Œä½†æ˜¯ä¾ç„¶ä¼šå—åˆ°æœ¬æœºæœ€å¤§å†…å­˜çš„é™åˆ¶ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¯èƒ½æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æåˆ°ä¸€ä¸ªå †å¤–å†…å­˜æ“ä½œç±»ï¼š<code>Unsafe</code>ï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œè™½ç„¶Javaæä¾›å †å¤–å†…å­˜çš„æ“ä½œç±»ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒæ˜¯ä¸å®‰å…¨çš„ï¼Œåªæœ‰ä½ å®Œå…¨äº†è§£åº•å±‚åŸç†å¹¶ä¸”èƒ½å¤Ÿåˆç†æ§åˆ¶å †å¤–å†…å­˜ï¼Œæ‰èƒ½å®‰å…¨åœ°ä½¿ç”¨å †å¤–å†…å­˜ã€‚</p><p>æ³¨æ„è¿™ä¸ªç±»ä¸è®©æˆ‘ä»¬newï¼Œä¹Ÿæ²¡æœ‰ç›´æ¥è·å–æ–¹å¼ï¼ˆå‹æ ¹å°±æ²¡æƒ³è®©æˆ‘ä»¬ç”¨ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Unsafe</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">registerNatives</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        registerNatives();</span><br><span class="line">        sun.reflect.Reflection.registerMethodsToFilter(Unsafe.class, <span class="string">&quot;getUnsafe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Unsafe</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">theUnsafe</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Unsafe</span>();</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;</span><br><span class="line">        Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (!VM.isSystemDomainLoader(caller.getClassLoader()))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Unsafe&quot;</span>);   <span class="comment">//ä¸æ˜¯JDKçš„ç±»ï¼Œä¸è®©ç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> theUnsafe;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±é€šè¿‡åå°„ç»™ä»–æå‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">    unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‹¿åˆ°Unsafeç±»ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç”³è¯·å †å¤–å†…å­˜äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦ç”³è¯·ä¸€ä¸ªintå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶åœ¨æ­¤ç©ºé—´ä¸­å­˜æ”¾ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">    unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”³è¯·4å­—èŠ‚å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å¾—åˆ°å¯¹åº”ä½ç½®çš„åœ°å€</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> unsafe.allocateMemory(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">//åœ¨å¯¹åº”çš„åœ°å€ä¸Šè®¾å®šintçš„å€¼</span></span><br><span class="line">    unsafe.putInt(address, <span class="number">6666666</span>);</span><br><span class="line">    <span class="comment">//è·å–å¯¹åº”åœ°å€ä¸Šçš„Intå‹æ•°å€¼</span></span><br><span class="line">    System.out.println(unsafe.getInt(address));</span><br><span class="line">    <span class="comment">//é‡Šæ”¾ç”³è¯·åˆ°çš„å†…å®¹</span></span><br><span class="line">    unsafe.freeMemory(address);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±äºå†…å­˜å·²ç»é‡Šæ”¾ï¼Œè¿™æ—¶æ•°æ®å°±æ²¡äº†</span></span><br><span class="line">    System.out.println(unsafe.getInt(address));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹<code>allocateMemory</code>åº•å±‚æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹C++æºç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jlong, <span class="built_in">Unsafe_AllocateMemory0</span>(JNIEnv *env, jobject unsafe, jlong size)) &#123;</span><br><span class="line">  <span class="type">size_t</span> sz = (<span class="type">size_t</span>)size;</span><br><span class="line"></span><br><span class="line">  sz = <span class="built_in">align_up</span>(sz, HeapWordSize);</span><br><span class="line">  <span class="type">void</span>* x = os::<span class="built_in">malloc</span>(sz, mtOther);   <span class="comment">//è¿™é‡Œè°ƒç”¨äº†os::mallocæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">addr_to_java</span>(x);</span><br><span class="line">&#125; UNSAFE_END</span><br></pre></td></tr></table></figure><p>æ¥ç€æ¥çœ‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">os::malloc</span><span class="params">(<span class="type">size_t</span> size, MEMFLAGS flags)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> os::<span class="built_in">malloc</span>(size, flags, CALLER_PC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">os::malloc</span><span class="params">(<span class="type">size_t</span> size, MEMFLAGS memflags, <span class="type">const</span> NativeCallStack&amp; stack)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  u_char* ptr;</span><br><span class="line">  ptr = (u_char*)::<span class="built_in">malloc</span>(alloc_size);   <span class="comment">//è°ƒç”¨C++æ ‡å‡†åº“å‡½æ•° malloc(size)</span></span><br><span class="line">....</span><br><span class="line">  <span class="comment">// we do not track guard memory</span></span><br><span class="line">  <span class="keyword">return</span> MemTracker::<span class="built_in">record_malloc</span>((address)ptr, size, memflags, stack, level);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸Šé¢çš„Javaä»£ç è½¬æ¢ä¸ºCä»£ç ï¼Œå·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ„æ€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> * a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *a = <span class="number">6666666</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¯´ï¼Œç›´æ¥å†…å­˜å®é™…ä¸Šå°±æ˜¯JVMç”³è¯·çš„ä¸€å—é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å®ƒå¹¶ä¸åœ¨å—ç®¡æ§çš„å‡ ç§å†…å­˜ç©ºé—´ä¸­ï¼Œå½“ç„¶è¿™äº›å†…å­˜ä¾ç„¶å±äºæ˜¯JVMçš„ï¼Œç”±äºJVMæä¾›çš„å †å†…å­˜ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ç­‰å·¥ä½œï¼Œæ•ˆç‡ä¸å¦‚ç›´æ¥ç”³è¯·å’Œæ“ä½œå†…å­˜æ¥å¾—å¿«ï¼Œä¸€äº›æ¯”è¾ƒè¿½æ±‚æè‡´æ€§èƒ½çš„æ¡†æ¶ä¼šç”¨åˆ°å †å¤–å†…å­˜æ¥æå‡è¿è¡Œé€Ÿåº¦ï¼Œå¦‚nioæ¡†æ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå¯åŠ¨æµç¨‹(JDK8)</title>
      <link href="/2023/12/17/JVM%E5%90%AF%E5%8A%A8/"/>
      <url>/2023/12/17/JVM%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="JVMå¯åŠ¨æµç¨‹-JDK8">JVMå¯åŠ¨æµç¨‹(JDK8)</h2><p>JVMçš„å¯åŠ¨å…¥å£æ˜¯ä½äºjdk/src/share/bin/java.cçš„JLI_Launchå‡½æ•°,å…¶å®šä¹‰å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">JLI_Launch</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv,              <span class="comment">/* main argc, argc */</span></span></span><br><span class="line"><span class="params">        <span class="type">int</span> jargc, <span class="type">const</span> <span class="type">char</span>** jargv,          <span class="comment">/* java args */</span></span></span><br><span class="line"><span class="params">        <span class="type">int</span> appclassc, <span class="type">const</span> <span class="type">char</span>** appclassv,  <span class="comment">/* app classpath */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* fullversion,                <span class="comment">/* full version defined */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* dotversion,                 <span class="comment">/* dot version defined */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* pname,                      <span class="comment">/* program name */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* lname,                      <span class="comment">/* launcher name */</span></span></span><br><span class="line"><span class="params">        jboolean javaargs,                      <span class="comment">/* JAVA_ARGS */</span></span></span><br><span class="line"><span class="params">        jboolean cpwildcard,                    <span class="comment">/* classpath wildcard */</span></span></span><br><span class="line"><span class="params">        jboolean javaw,                         <span class="comment">/* windows-only javaw */</span></span></span><br><span class="line"><span class="params">        jint     ergo_class                     <span class="comment">/* ergnomics policy */</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure><h4 id="1-åˆå§‹åŒ–">1.åˆå§‹åŒ–</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">InitLauncher(javaw);  <span class="comment">//åˆå§‹åŒ–å¯åŠ¨å™¨</span></span><br><span class="line">DumpState();  <span class="comment">//æ‰“å°å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">//ç¡®ä¿å¼€å¯å¯åŠ¨å™¨è·Ÿè¸ªçŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Command line args:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; argc ; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;argv[%d] = %s\n&quot;</span>, i, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    AddOption(<span class="string">&quot;-Dsun.java.launcher.diag=true&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-é€‰æ‹©jreç‰ˆæœ¬">2.é€‰æ‹©jreç‰ˆæœ¬</h4><p>è§£æå‚æ•°ï¼Œè¯»å–manifestæ–‡ä»¶ï¼Œjreç‰ˆæœ¬æ ¡éªŒï¼ŒåŠ è½½jreä»¥ä¾¿ç¡®è®¤æ˜¯å¦å­˜åœ¨ï¼Œæœ€åå°†ç›¸å…³ç¯å¢ƒå˜é‡æ”¾ç½®å¥½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectVersion(argc, argv, &amp;main_class);</span><br></pre></td></tr></table></figure><h4 id="3-åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ">3.åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ</h4><p>ç¡®å®šæ•°æ®æ¨¡å‹ï¼Œæ˜¯32ä½è¿˜æ˜¯64ä½ï¼Œä»¥åŠjvmæœ¬èº«çš„ä¸€äº›é…ç½®åœ¨jvm.cfgæ–‡ä»¶ä¸­è¯»å–å’Œè§£æ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CreateExecutionEnvironment(&amp;argc, &amp;argv,</span><br><span class="line">                               jrepath, <span class="keyword">sizeof</span>(jrepath), <span class="comment">//jreè·¯å¾„</span></span><br><span class="line">                               jvmpath, <span class="keyword">sizeof</span>(jvmpath), <span class="comment">//jvmè·¯å¾„</span></span><br><span class="line">                               jvmcfg,  <span class="keyword">sizeof</span>(jvmcfg)); <span class="comment">//jvmé…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h4 id="4-åŠ è½½jvm-soåº“">4.åŠ è½½jvm.soåº“</h4><p>åŠ¨æ€åŠ è½½jvm.soè¿™ä¸ªå…±äº«åº“ï¼Œå¹¶æŠŠjvm.soä¸­çš„ç›¸å…³å‡½æ•°å¯¼å‡ºå¹¶ä¸”åˆå§‹åŒ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!IsJavaArgs()) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€äº›ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">        SetJvmEnvironment(argc,argv);</span><br><span class="line">    &#125;</span><br><span class="line">    ifn.CreateJavaVM = <span class="number">0</span>;</span><br><span class="line">    ifn.GetDefaultJavaVMInitArgs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">        start = CounterGet();     <span class="comment">// è®°å½•å¯åŠ¨æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ è½½VM, é‡ä¸­ä¹‹é‡</span></span><br><span class="line">    <span class="keyword">if</span> (!LoadJavaVM(jvmpath, &amp;ifn)) &#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">        end   = CounterGet();</span><br><span class="line">    &#125;</span><br><span class="line">    JLI_TraceLauncher(<span class="string">&quot;%ld micro seconds to LoadJavaVM\n&quot;</span>,</span><br><span class="line">             (<span class="type">long</span>)(jint)Counter2Micros(end-start));</span><br><span class="line">    ++argv;</span><br><span class="line">    --argc;</span><br><span class="line">    <span class="comment">// è§£ææ›´å¤šå‚æ•°ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (IsJavaArgs()) &#123;</span><br><span class="line">        <span class="comment">/* Preprocess wrapper arguments */</span></span><br><span class="line">        TranslateApplicationArgs(jargc, jargv, &amp;argc, &amp;argv);</span><br><span class="line">        <span class="keyword">if</span> (!AddApplicationOptions(appclassc, appclassv)) &#123;</span><br><span class="line">            <span class="keyword">return</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* Set default CLASSPATH */</span></span><br><span class="line">        cpath = getenv(<span class="string">&quot;CLASSPATH&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cpath == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            cpath = <span class="string">&quot;.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SetClassPath(cpath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Parse command line options; if the return value of</span></span><br><span class="line"><span class="comment">     * ParseArguments is false, the program should exit.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// è§£æå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!ParseArguments(&amp;argc, &amp;argv, &amp;mode, &amp;what, &amp;ret, jrepath))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>(ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Override class path if -jar flag was specified */</span></span><br><span class="line">    <span class="keyword">if</span> (mode == LM_JAR) &#123;</span><br><span class="line">        SetClassPath(what);     <span class="comment">/* Override class path */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* set the -Dsun.java.command pseudo property */</span></span><br><span class="line">    SetJavaCommandLineProp(what, argc, argv);</span><br><span class="line">    <span class="comment">/* Set the -Dsun.java.launcher pseudo property */</span></span><br><span class="line">    SetJavaLauncherProp();</span><br><span class="line">    <span class="comment">/* set the -Dsun.java.launcher.* platform properties */</span></span><br><span class="line">    SetJavaLauncherPlatformProps();</span><br></pre></td></tr></table></figure><h4 id="5-åˆå§‹åŒ–jvm">5.åˆå§‹åŒ–jvm</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> JVMInit(&amp;ifn, threadStackSize, argc, argv, mode, what, ret);</span><br></pre></td></tr></table></figure><p>JVMInitå‡½æ•°æœ€åä¸€å¥æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ContinueInNewThread(ifn, threadStackSize, argc, argv, mode, what, ret);</span><br></pre></td></tr></table></figure><p>ç»§ç»­çœ‹ContinueInNewThreadå‡½æ•°,ä¼šè¿›å…¥ContinueInNewThread0å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ContinueInNewThread0(JavaMain, threadStackSize, (<span class="type">void</span>*)&amp;args);</span><br></pre></td></tr></table></figure><p>å®ç°åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡ŒJavaMainå‡½æ•°</p><ol><li>åˆå§‹åŒ–è™šæ‹Ÿæœºï¼Œå¦‚æœæŠ¥é”™ç›´æ¥é€€å‡ºã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Initialize the virtual machine */</span></span><br><span class="line">start = CounterGet();</span><br><span class="line"><span class="keyword">if</span> (!InitializeJVM(&amp;vm, &amp;env, &amp;ifn)) &#123;</span><br><span class="line">    JLI_ReportErrorMessage(JVM_ERROR1);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åŠ è½½ä¸»ç±»</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainClass = LoadMainClass(env, mode, what);</span><br></pre></td></tr></table></figure><ol start="3"><li>è·å–Application Main Class</li></ol><p>æŸäº›æ²¡æœ‰ä¸»æ–¹æ³•çš„Javaç¨‹åºæ¯”å¦‚JavaFXåº”ç”¨ï¼Œä¼šè·å–Application Main Class</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * In some cases when launching an application that needs a helper, e.g., a</span></span><br><span class="line"><span class="comment"> * JavaFX application with no main method, the mainClass will not be the</span></span><br><span class="line"><span class="comment"> * applications own main class but rather a helper class. To keep things</span></span><br><span class="line"><span class="comment"> * consistent in the UI we need to track and report the application main class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">appClass = GetApplicationClass(env);</span><br></pre></td></tr></table></figure><ol start="4"><li>åˆå§‹åŒ–å®Œæˆ</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PostJVMInit(env, appClass, vm);</span><br></pre></td></tr></table></figure><ol start="5"><li>è·å–ä¸»ç±»ä¸­çš„ä¸»æ–¹æ³•</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainID = (*env)-&gt;GetStaticMethodID(env, mainClass, <span class="string">&quot;main&quot;</span>,<span class="string">&quot;([Ljava/lang/String;)V&quot;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨å­—èŠ‚ç ä¸­void main(String[] args)è¡¨ç¤ºä¸º([Ljava/lang/String;)V</p><ol start="6"><li>è°ƒç”¨ä¸»æ–¹æ³•</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Invoke main method. */</span></span><br><span class="line">(*env)-&gt;CallStaticVoidMethod(env, mainClass, mainID, mainArgs);</span><br></pre></td></tr></table></figure><ol start="7"><li>LEAVEå‡½æ•°ç»“æŸçº¿ç¨‹,é”€æ¯JVM</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The launcher&#x27;s exit code (in the absence of calls to</span></span><br><span class="line"><span class="comment"> * System.exit) will be non-zero if main threw an exception.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ret = (*env)-&gt;ExceptionOccurred(env) == <span class="literal">NULL</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">LEAVE();</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾å¦‚ä¸‹:<br><img src="https://pb01.s3.bitiful.net/91.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››</title>
      <link href="/2023/12/16/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C4/"/>
      <url>/2023/12/16/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››">è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››</h3><h4 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚</h4><ol><li>æµæ°´ç¯å®éªŒï¼šåˆ©ç”¨8255çš„Aå£ã€Bå£ã€Cå£å¾ªç¯ç‚¹äº®å‘å…‰äºŒæç®¡ã€‚</li><li>æ ¹æ®è¾“å…¥æ§åˆ¶ç¯çš„äº®ç­</li><li>åœ¨å®Œæˆ(1)åŸºç¡€ä¸Šï¼Œå¢åŠ é€šè¿‡è¯»å–å¼€å…³æ§åˆ¶æµæ°´ç¯çš„å¾ªç¯æ–¹å‘å’Œå¾ªç¯æ–¹å¼ã€‚</li></ol><p>è·Ÿä¸Šä¸€æ¬¡å®éªŒåŸºæœ¬ç›¸åŒ,æ¢äº†ä¸ªèŠ¯ç‰‡,ç„¶åæ§åˆ¶çš„èŒƒå›´ä»å…«é¢—å‘å…‰äºŒæç®¡å˜ä¸ºäº†åå…­é¢—å‘å…‰äºŒæç®¡</p><h4 id="åŸºç¡€ç‰ˆ">åŸºç¡€ç‰ˆ</h4><p>ç®€å•å®ç°äº†åŠŸèƒ½1å’Œ2,å…¨1å·¦ç§»,å…¨0å³ç§»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">COM_ADD EQU 0273H </span><br><span class="line">PA_ADD EQU 0270H </span><br><span class="line">PB_ADD EQU 0271H </span><br><span class="line">PC_ADD EQU 0272H </span><br><span class="line">_STACK SEGMENT STACK </span><br><span class="line"> DW 100 DUP(?) </span><br><span class="line">_STACK ENDS </span><br><span class="line">_DATA SEGMENT WORD PUBLIC &#x27;DATA&#x27; </span><br><span class="line">_DATA ENDS </span><br><span class="line">CODE SEGMENT </span><br><span class="line">START PROC NEAR </span><br><span class="line">ASSUME CS:CODE, DS:_DATA, SS:_STACK </span><br><span class="line">MOV AX,_DATA  ; å°†æ•°æ®æ®µåœ°å€åŠ è½½åˆ°AXå¯„å­˜å™¨</span><br><span class="line">MOV DS,AX ; å°†æ•°æ®æ®µåœ°å€ä¼ é€ç»™æ•°æ®æ®µå¯„å­˜å™¨DS</span><br><span class="line">NOP </span><br><span class="line">MOV DX,COM_ADD ; å°†ä¸²å£åœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">MOV AL,82H ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º82H</span><br><span class="line">OUT DX,AL </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">INPUT:</span><br><span class="line"> ; æ¸…é›¶æ“ä½œ</span><br><span class="line">MOV     AX, 0FFFFH </span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; è¾“å…¥æ“ä½œ</span><br><span class="line">MOVDX, PB_ADD</span><br><span class="line">INal, DX</span><br><span class="line">mov    ah, 0</span><br><span class="line"></span><br><span class="line">; åˆ¤æ–­</span><br><span class="line">CMPal, 0FFH ;å…¨1</span><br><span class="line">JZ low1</span><br><span class="line">CMPal, 0 ;å…¨0</span><br><span class="line">JZ high1</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUTDX, al</span><br><span class="line">JMPINPUT</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">low1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">low2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">low3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">low4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º15-8çš„æƒ…å†µ</span><br><span class="line">high1:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">high2:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh2</span><br><span class="line">MOV    AX, 0FFFFH</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º7-0çš„æƒ…å†µ</span><br><span class="line">high3:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">high4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Delay PROC NEAR</span><br><span class="line">Delay1:</span><br><span class="line">XORCX,CX</span><br><span class="line">LOOP$</span><br><span class="line">RET</span><br><span class="line">DelayENDP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">START ENDP </span><br><span class="line">CODE ENDS </span><br><span class="line">END START</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´ç‰ˆ">å®Œæ•´ç‰ˆ</h4><p>å¢åŠ äº†ä¸€äº›åŠŸèƒ½:</p><ul><li>è¾“å…¥ä¸º11010000æ—¶,æµæ°´ç¯å±•ç¤º00001101</li><li>è¾“å…¥ä¸º00001111æ—¶,å‰8é¢—å‘å…‰äºŒæç®¡å·¦ç§»,å8é¢—å‘å…‰äºŒæç®¡å³ç§»</li><li>è¾“å…¥ä¸º11110000æ—¶,å‰8é¢—å‘å…‰äºŒæç®¡å³ç§»,å8é¢—å‘å…‰äºŒæç®¡å·¦ç§»</li></ul><p>è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç è¿˜æ²¡æœ‰åœ¨è¯•éªŒç®±ä¸Šè·‘è¿‡,æœ¬æ¥æˆ‘æ˜¯æƒ³éªŒè¯å®ŒåŸºç¡€ç‰ˆååŠ ä¸Šçš„,ä½†å½“æ—¶æˆ‘çš„è¯•éªŒç®±å‡ºäº†ä¸€äº›é—®é¢˜,æµªè´¹äº†æˆ‘å¥½å¤šæ—¶é—´,æ‰€ä»¥å®éªŒçš„æ—¶å€™åªè·‘äº†åŸºç¡€ç‰ˆ,åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">COM_ADD EQU 0273H </span><br><span class="line">PA_ADD EQU 0270H </span><br><span class="line">PB_ADD EQU 0271H </span><br><span class="line">PC_ADD EQU 0272H </span><br><span class="line">_STACK SEGMENT STACK </span><br><span class="line"> DW 100 DUP(?) </span><br><span class="line">_STACK ENDS </span><br><span class="line">_DATA SEGMENT WORD PUBLIC &#x27;DATA&#x27; </span><br><span class="line">_DATA ENDS </span><br><span class="line">CODE SEGMENT </span><br><span class="line">START PROC NEAR </span><br><span class="line">ASSUME CS:CODE, DS:_DATA, SS:_STACK </span><br><span class="line">MOV AX,_DATA  ; å°†æ•°æ®æ®µåœ°å€åŠ è½½åˆ°AXå¯„å­˜å™¨</span><br><span class="line">MOV DS,AX ; å°†æ•°æ®æ®µåœ°å€ä¼ é€ç»™æ•°æ®æ®µå¯„å­˜å™¨DS</span><br><span class="line">NOP </span><br><span class="line">MOV DX,COM_ADD ; å°†ä¸²å£åœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">MOV AL,82H ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º82H</span><br><span class="line">OUT DX,AL </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">INPUT:</span><br><span class="line"> ; æ¸…é›¶æ“ä½œ</span><br><span class="line">MOV     AX, 0FFFFH </span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; è¾“å…¥æ“ä½œ</span><br><span class="line">MOVDX, PB_ADD</span><br><span class="line">INal, DX</span><br><span class="line">mov    ah, 0</span><br><span class="line">; åˆ¤æ–­</span><br><span class="line">        CMPal, 0D0H </span><br><span class="line">JZ mid</span><br><span class="line">        cmp al, 0FH </span><br><span class="line">        JZ lar1 </span><br><span class="line">        cmp al, 0F0H </span><br><span class="line">        JZ ral1</span><br><span class="line">CMPal, 0FFH ;å…¨1,</span><br><span class="line">JZ low1</span><br><span class="line">CMPal, 0 ;å…¨0</span><br><span class="line">JZ high1</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUTDX, al</span><br><span class="line">JMPINPUT</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">mid:</span><br><span class="line">shl al,4</span><br><span class="line">        shr al,4</span><br><span class="line">        shr ah,4</span><br><span class="line">        add al,ah</span><br><span class="line">        mov ah,0</span><br><span class="line">        mov dx, PA_ADD ;00001101</span><br><span class="line">        out dx,ax</span><br><span class="line">        jmp INPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">ral1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">ral2:</span><br><span class="line">RORal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">ral3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">ral4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">lar1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">lar2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">lar3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">lar4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">low1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">low2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">low3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">low4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º15-8çš„æƒ…å†µ</span><br><span class="line">high1:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">high2:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh2</span><br><span class="line">MOV    AX, 0FFFFH</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º7-0çš„æƒ…å†µ</span><br><span class="line">high3:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">high4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Delay PROC NEAR</span><br><span class="line">Delay1:</span><br><span class="line">XORCX,CX</span><br><span class="line">LOOP$</span><br><span class="line">RET</span><br><span class="line">DelayENDP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">START ENDP </span><br><span class="line">CODE ENDS </span><br><span class="line">END START</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰</title>
      <link href="/2023/12/11/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C3/"/>
      <url>/2023/12/11/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰">è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰</h3><h4 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚</h4><ol><li>å¼€å…³Yiä¸ºä½ç”µå¹³æ—¶å¯¹åº”çš„å‘å…‰äºŒæç®¡äº®ï¼ŒYiä¸ºé«˜ç”µå¹³æ—¶å¯¹åº”çš„å‘å…‰äºŒæç®¡ç­ã€‚</li><li>å½“å¼€å…³Yiå…¨ä¸ºé«˜ç”µå¹³æ—¶ï¼Œå‘å…‰äºŒæç®¡Qiä»å·¦è‡³å³è½®æµç‚¹äº®ã€‚</li><li>å½“å¼€å…³Yiå…¨ä¸ºä½ç”µå¹³æ—¶ï¼Œå‘å…‰äºŒæç®¡Qiä»å³è‡³å·¦è½®æµç‚¹äº®ã€‚</li><li>è‡ªä¸»è®¾è®¡æ§åˆ¶åŠæ˜¾ç¤ºæ¨¡å¼ï¼Œå®Œæˆç¼–ç¨‹è°ƒè¯•ï¼Œæ¼”ç¤ºå®éªŒç»“æœã€‚</li></ol><p>æˆ‘æ²¡åšè¦æ±‚1,å½“å¼€å…³Yiä¸æ˜¯å…¨ä¸ºä½ç”µå¹³å’Œé«˜ç”µå¹³æ—¶,å‘å…‰äºŒæç®¡QiæŒ‰1423çš„é¡ºåºç‚¹äº®,è¿™é‡Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ”¹,å¯ä»¥æŠŠå‰©ä¸‹çš„å››ä¸ªä¹ŸåŠ ä¸Šå»,é¡ºåºä¹Ÿå¯ä»¥æ”¹,å¦‚æœä½ è¦åšè¦æ±‚1,å¼€å…³Yiä¸ºæŸç‰¹å®šå€¼æ—¶è·³è½¬Lightæ›´å¥½(åœ¨å®éªŒå››ä¸­å®ç°ç±»ä¼¼åŠŸèƒ½)</p><h4 id="ä»£ç ">ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">IO244equ230h;244</span><br><span class="line">IO273equ230h;273</span><br><span class="line"></span><br><span class="line">_stack segmentstack</span><br><span class="line">       dw 100 DUP(?)</span><br><span class="line">_stackends</span><br><span class="line"></span><br><span class="line">_data segmentword public &#x27;DATA&#x27;</span><br><span class="line">_dataends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">main proc</span><br><span class="line">        assume cs:code,ds:_data,ss:_stack</span><br><span class="line">; åˆå§‹åŒ–å¯„å­˜å™¨</span><br><span class="line">        mov    ax,_data</span><br><span class="line">        mov    ds,ax</span><br><span class="line">        mov    bx,0fefeh</span><br><span class="line">start:  mov    dx,IO244 ; è¯»å–244å¼•è„šçš„è¾“å…¥å€¼</span><br><span class="line">        in     al,dx</span><br><span class="line">        mov    ah,al</span><br><span class="line">        cmp    al,0ffh ; åˆ¤æ–­è¾“å…¥å€¼æ˜¯å¦ä¸º0xffï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿›è¡Œç¿»è½¬æ“ä½œ       </span><br><span class="line">        jnz    Next0</span><br><span class="line">        call   ROLeft ; è°ƒç”¨ROLeftå‡½æ•°è¿›è¡Œå·¦ç§»æ“ä½œ</span><br><span class="line">        jmp    Next2</span><br><span class="line">Next0:  cmp    al,0 ; åˆ¤æ–­è¾“å…¥å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³è½¬Next1         </span><br><span class="line">        jnz    Next1</span><br><span class="line">        call   RORight </span><br><span class="line">        jmp    Next2</span><br><span class="line">Next1:  call   Light</span><br><span class="line">Next2:  call   Delay</span><br><span class="line">        jmp    start</span><br><span class="line">main endp</span><br><span class="line"></span><br><span class="line">ROLeft procnear</span><br><span class="line">; å·¦ç§»blå¯„å­˜å™¨ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨alå¯„å­˜å™¨ä¸­</span><br><span class="line">        rol    bl,1</span><br><span class="line">        mov    al,bl</span><br><span class="line">; è¾“å‡ºå·¦ç§»åçš„å€¼åˆ°273å¼•è„š</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">        ret</span><br><span class="line">ROLeft endp</span><br><span class="line"></span><br><span class="line">RORight proc near</span><br><span class="line">; å³ç§»blå¯„å­˜å™¨ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨alå¯„å­˜å™¨ä¸­</span><br><span class="line">        ror    bl,1</span><br><span class="line">        mov    al,bl</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">        ret</span><br><span class="line">RORight endp</span><br><span class="line"></span><br><span class="line">Light proc near</span><br><span class="line">xor    bh,1  ;bxé«˜å…«ä½ä¸1å¼‚æˆ–</span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,8 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,2 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,4 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">        ret</span><br><span class="line">Light endp</span><br><span class="line"></span><br><span class="line">Delay proc near                 </span><br><span class="line">        xor    cx,cx</span><br><span class="line">delay1: loop   delay1</span><br><span class="line">        ret</span><br><span class="line">Delay endp</span><br><span class="line">code ends</span><br><span class="line">ENDmain</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Butterflyåšå®¢æ·»åŠ Googleåˆ†æ</title>
      <link href="/2023/12/05/%E5%8D%9A%E5%AE%A2%E5%88%86%E6%9E%90/"/>
      <url>/2023/12/05/%E5%8D%9A%E5%AE%A2%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Hexo-Butterflyåšå®¢æ·»åŠ Googleåˆ†æ">Hexo Butterflyåšå®¢æ·»åŠ Googleåˆ†æ</h2><p>è¿›å…¥è°·æ­Œåˆ†æå®˜ç½‘:<a href="https://analytics.google.com/analytics/web/">https://analytics.google.com/analytics/web/</a><br>å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/48.png" alt="avatar"></p><p>ç‚¹å‡»å¼€å§‹è¯„ä¼°</p><p><img src="https://pb01.s3.bitiful.net/50.png" alt="avatar"></p><p>è¾“å…¥è´¦æˆ·å,éšä¾¿å¡«å°±è¡Œ,ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="https://pb01.s3.bitiful.net/51.png" alt="avatar"></p><p>è¾“å…¥å±æ€§åç§°(éšä¾¿å¡«),å¡«ä¸Šä½ çš„åšå®¢åŸŸå,ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p>å‰©ä¸‹çš„æ­¥éª¤æŒ‰è‡ªå·±çš„æƒ…å†µå¡«å°±è¡Œ</p><p>æœ€åä¼šå¼¹å‡ºä¸€ä¸ªå¼¹çª—,ä¸Šé¢ä¼šæœ‰ä¸€ä¸ªè·Ÿè¸ªid,ä¸€èˆ¬ä»¥UAå¼€å¤´,å°†å®ƒå¤åˆ¶ä¸‹æ¥,åœ¨_config.butterfly.ymlæ–‡ä»¶ä¸­æœç´¢google_analytics,åœ¨è¿™ä¸ªåé¢æŠŠä½ çš„è·Ÿè¸ªidå¡«è¿›å»,å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/52.png" alt="avatar"></p><p>å¦‚æœä½ å°å¿ƒæŠŠè°·æ­Œåˆ†æçš„ç½‘å€å…³äº†,åº”è¯¥æ€ä¹ˆæ‰¾è·Ÿè¸ªidå‘¢?</p><p>è¿›å…¥åå°,ç‚¹å‡»ç®¡ç†:<br><img src="https://pb01.s3.bitiful.net/53.png" alt="avatar"></p><p>æ‰¾åˆ°èµ„æºå­˜å–ç®¡ç†,ç‚¹å‡»:<br><img src="https://pb01.s3.bitiful.net/54.png" alt="avatar"></p><p>ç‚¹å¼€æŸ¥çœ‹ä½¿ç”¨è€…çš„è´¦æˆ·è¯¦ç»†èµ„æ–™å°±èƒ½æ‰¾åˆ°:</p><p><img src="https://pb01.s3.bitiful.net/56.png" alt="avatar"></p><p>ä¸‹å›¾æˆ‘æ‰“çº¢è‰²ç çš„å°±æ˜¯è·Ÿè¸ªid:</p><p><img src="https://pb01.s3.bitiful.net/55.png" alt="avatar"></p><p>æ›´æ”¹å¥½äº†ä»¥å,é‡æ–°éƒ¨ç½²åšå®¢,æœ€åçœ‹åˆ°è¿™æ ·çš„é¡µé¢:</p><p><img src="https://pb01.s3.bitiful.net/49.png" alt="avatar"></p><p>å°±å¤§åŠŸå‘Šæˆå•¦!</p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Retrofit2ç®€æ˜è®²è§£</title>
      <link href="/2023/12/05/2023-12-5-Retrofit2/"/>
      <url>/2023/12/05/2023-12-5-Retrofit2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="Retrofit2ç®€æ˜è®²è§£">Retrofit2ç®€æ˜è®²è§£</h3><h4 id="ä»€ä¹ˆæ˜¯Retrofit">ä»€ä¹ˆæ˜¯Retrofit</h4><p>retrofitæ˜¯ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œå¯ä»¥ç†è§£ä¸ºokhttpçš„åŠ å¼ºç‰ˆï¼Œåº•å±‚å°è£…äº†okhttpã€‚å‡†ç¡®æ¥è¯´ï¼ŒRetrofitæ˜¯ä¸€ä¸ªRESTfulçš„httpç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚å› ä¸ºç½‘ç»œè¯·æ±‚å·¥ä½œæœ¬è´¨ä¸Šæ˜¯ç”±okhttpæ¥å®Œæˆï¼Œè€ŒRetrofitè´Ÿè´£ç½‘ç»œè¯·æ±‚æ¥å£çš„å°è£…ã€‚</p><p><img src="https://pb01.s3.bitiful.net/45.png" alt="avatar"></p><p><strong>æœ¬è´¨è¿‡ç¨‹</strong>ï¼šAppåº”ç”¨ç¨‹åºé€šè¿‡Retrofitè¯·æ±‚ç½‘ç»œï¼Œå®è´¨ä¸Šæ˜¯ä½¿ç”¨Retrofitæ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°,å³Headerã€Urlç­‰ä¿¡æ¯ï¼Œä¹‹åç”±okhttpæ¥å®Œæˆåç»­çš„è¯·æ±‚å·¥ä½œã€‚åœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®åï¼Œokhttpå°†åŸå§‹æ•°æ®äº¤ç»™Retrofitï¼ŒRetrofitæ ¹æ®ç”¨æˆ·éœ€æ±‚è§£æã€‚</p><p><img src="https://pb01.s3.bitiful.net/46.png" alt="avatar"></p><h4 id="ä½¿ç”¨ä»‹ç»">ä½¿ç”¨ä»‹ç»</h4><p>ä½¿ç”¨ Retrofit çš„æ­¥éª¤å…±æœ‰7ä¸ªï¼š</p><p><strong>æ­¥éª¤1</strong>ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–<br><strong>æ­¥éª¤2</strong>ï¼šåˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»<br><strong>æ­¥éª¤3</strong>ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£<br><strong>æ­¥éª¤4</strong>ï¼šåˆ›å»ºRetrofitå®ä¾‹ å¹¶ åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹<br><strong>æ­¥éª¤5</strong>ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ / åŒæ­¥ï¼‰</p><h5 id="æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–">æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–</h5><p>å¦‚å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/47.png" alt="avatar"></p><h5 id="æ­¥éª¤2ï¼šåˆ›å»º-æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»">æ­¥éª¤2ï¼šåˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»</h5><p>åœ¨æ­£å¼çš„è¯·æ±‚ç½‘ç»œæ•°æ®ä¸­ï¼Œè¿”å›çš„æ•°æ®çš„å¤–åµŒå¥—éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæºå¸¦çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å®ä½“æ•°æ®ä¸€èµ·è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå°è£…ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®å›è°ƒç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ID */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/** å¯¹è±¡ */</span></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="comment">/** æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="comment">/** å¯¹è¯ */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ChatChoice&gt; choices;</span><br><span class="line">    <span class="comment">/** åˆ›å»º */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> created;</span><br><span class="line">    <span class="comment">/** è€—æ */</span></span><br><span class="line">    <span class="keyword">private</span> Usage usage;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3ï¼šåˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£">æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£</h5><p>è¿™ä¸ªç±»å°±æ˜¯Retrofitå°†okhttpè¯·æ±‚æŠ½è±¡æˆjavaçš„æ¥å£ç±»ï¼Œç”¨æ³¨è§£æè¿°å’Œé…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°ï¼Œå°è£…Urlåœ°å€å’Œç½‘ç»œæ•°æ®è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOpenAiApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/chat/completions&quot;)</span></span><br><span class="line">    Single&lt;ChatCompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ–¹æ³•å¤´éƒ¨æ·»åŠ @POSTæ³¨è§£ï¼Œè¡¨ç¤ºé‡‡ç”¨postæ–¹æ³•è®¿é—®ç½‘ç»œè¯·æ±‚ï¼Œæ‹¬å·å†…çš„æ˜¯è¯·æ±‚çš„åœ°å€(Urlçš„ä¸€éƒ¨åˆ†) ï¼Œå…¶ä¸­è¿”å›ç±»å‹æ˜¯Single&lt;*&gt;ï¼Œ*è¡¨ç¤ºæ¥æ”¶æ•°æ®çš„ç±»ï¼ŒChatCompletionResponseæ˜¯ä¸Šé¢å°è£…çš„ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„ç»Ÿä¸€å…¬å…±ç±»</p><h5 id="æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹-å¹¶-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹">æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹ å¹¶ åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">IOpenAiApi</span> <span class="variable">openAiApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(configuration.getApiHost())<span class="comment">//å¾—åˆ°url</span></span><br><span class="line">                .client(okHttpClient)<span class="comment">//è®¾ç½®å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">//        RxJava2CallAdapterFactoryçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">//        1.å°†Androidçš„Callå¯¹è±¡è½¬æ¢ä¸ºRxJavaçš„Observableç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">//        2.å¤„ç†Callçš„é”™è¯¯å’Œç»“æœï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRxJavaçš„onErrorå’ŒonNextäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//        3.æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚é‡è¯•ã€ç½‘ç»œé”™è¯¯ç­‰ã€‚</span></span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .addConverterFactory(JacksonConverterFactory.create())<span class="comment">//åœ¨è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨jacksonåº“è¿›è¡Œjsonè½¬æ¢</span></span><br><span class="line">                .build().create(IOpenAiApi.class);</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥-åŒæ­¥ï¼‰">æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ / åŒæ­¥ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSession</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IOpenAiApi openAiApi;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSession</span><span class="params">(IOpenAiApi openAiApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.openAiApi = openAiApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(chatCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="References">References</h4><ol><li><p><a href="https://www.jianshu.com/p/a3e162261ab6" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Carsonå¸¦ä½ å­¦Androidï¼šç½‘ç»œè¯·æ±‚åº“Retrofitä½¿ç”¨æ•™ç¨‹(å«å®ä¾‹è®²è§£)</a></p></li><li><p><a href="https://juejin.cn/post/6978777076073660429" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Retrofit2 å®æˆ˜ï¼ˆä¸€ã€ä½¿ç”¨è¯¦è§£ç¯‡ï¼‰</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹ç«¯å£</title>
      <link href="/2023/12/04/2023-12-4-DDD%E6%9E%B6%E6%9E%84-4/"/>
      <url>/2023/12/04/2023-12-4-DDD%E6%9E%B6%E6%9E%84-4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="DDDæ¶æ„ä¹‹ç«¯å£">DDDæ¶æ„ä¹‹ç«¯å£</h3><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé€‚é…å™¨ï¼ˆAdapterï¼‰æ¨¡å¼æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚é€‚é…å™¨æ¨¡å¼å…è®¸å°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢„æœŸçš„æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ååŒå·¥ä½œã€‚åœ¨DDDä¸­ï¼Œé€‚é…å™¨é€šå¸¸ä¸ç«¯å£ï¼ˆPortï¼‰æ¦‚å¿µç»“åˆä½¿ç”¨ï¼Œå½¢æˆ&quot;ç«¯å£å’Œé€‚é…å™¨&quot;ï¼ˆPorts and Adaptersï¼‰æ¶æ„ï¼Œä¹Ÿç§°ä¸º&quot;å…­è¾¹å½¢æ¶æ„&quot;ï¼ˆHexagonal Architectureï¼‰ã€‚è¿™ç§æ¶æ„é£æ ¼æ—¨åœ¨å°†åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’è§£è€¦ã€‚</p><h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4><p>Port åœ¨è¿™ç§æ¶æ„ä¸­ä»£è¡¨äº†åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…¥å£æˆ–å‡ºå£ç‚¹ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„æ¥å£ï¼Œä½†ä¸å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ç«¯å£å¯ä»¥æ˜¯é©±åŠ¨ç«¯å£ï¼ˆDriving Portsï¼Œé€šå¸¸æ˜¯è¾“å…¥ç«¯å£ï¼‰æˆ–è¢«é©±åŠ¨ç«¯å£ï¼ˆDriven Portsï¼Œé€šå¸¸æ˜¯è¾“å‡ºç«¯å£ï¼‰ã€‚</p><h4 id="ç‰¹æ€§">ç‰¹æ€§</h4><ul><li><strong>æŠ½è±¡æ€§</strong>ï¼šç«¯å£æä¾›äº†æœåŠ¡è¡Œä¸ºçš„æŠ½è±¡æè¿°ï¼Œæ˜ç¡®äº†æœåŠ¡çš„åŠŸèƒ½å’Œå¤–éƒ¨ä¾èµ–ã€‚</li><li><strong>ç‹¬ç«‹æ€§</strong>ï¼šç«¯å£ç‹¬ç«‹äºå…·ä½“å®ç°ï¼Œå…è®¸æœåŠ¡å®ç°çš„çµæ´»æ›¿æ¢æˆ–æ‰©å±•ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥ä¸ºåŒä¸€ç«¯å£æä¾›ä¸åŒçš„é€‚é…å™¨å®ç°ï¼Œä»¥é€‚åº”ä¸åŒçš„è¿è¡Œç¯å¢ƒæˆ–éœ€æ±‚ã€‚</li></ul><h4 id="ç”¨é€”">ç”¨é€”</h4><ul><li><strong>æ ‡å‡†å®šä¹‰</strong>ï¼šç«¯å£å’Œé€‚é…å™¨å®šä¹‰äº†æœåŠ¡çš„æ ‡å‡†è¡Œä¸ºå’Œå¤–éƒ¨ä¾èµ–ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li><strong>éš”ç¦»å˜åŒ–</strong>ï¼šå½“å¤–éƒ¨ç³»ç»Ÿå˜åŒ–æ—¶ï¼Œåªéœ€æ›´æ¢æˆ–ä¿®æ”¹é€‚é…å™¨ï¼Œæ— éœ€æ”¹åŠ¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>ä¿ƒè¿›æµ‹è¯•</strong>ï¼šå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿé€‚é…å™¨æ¥æµ‹è¯•æ ¸å¿ƒé€»è¾‘ï¼Œè€Œä¸ä¾èµ–çœŸå®çš„å¤–éƒ¨ç³»ç»Ÿã€‚</li></ul><h4 id="å®ç°">å®ç°</h4><p>å®ç°ç«¯å£å’Œé€‚é…å™¨æ¶æ„é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>å®šä¹‰ç«¯å£</strong>ï¼šåœ¨é¢†åŸŸå±‚å®šä¹‰æ¸…æ™°çš„æ¥å£ï¼Œè¿™äº›æ¥å£ä»£è¡¨äº†åº”ç”¨ç¨‹åºä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’ç‚¹ã€‚</li><li><strong>åˆ›å»ºé€‚é…å™¨</strong>ï¼šåœ¨åŸºç¡€å±‚æˆ–åº”ç”¨å±‚å®ç°é€‚é…å™¨ï¼Œè¿™äº›é€‚é…å™¨è´Ÿè´£å°†ç«¯å£çš„æŠ½è±¡æ“ä½œè½¬æ¢ä¸ºå…·ä½“çš„å¤–éƒ¨è°ƒç”¨ã€‚</li><li><strong>ä¾èµ–å€’ç½®</strong>ï¼šåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¾èµ–äºç«¯å£æ¥å£ï¼Œè€Œä¸æ˜¯é€‚é…å™¨çš„å…·ä½“å®ç°ã€‚è¿™æ ·ï¼Œé€‚é…å™¨å¯ä»¥éšæ—¶è¢«æ›¿æ¢ï¼Œè€Œä¸å½±å“æ ¸å¿ƒé€»è¾‘ã€‚</li><li><strong>é…ç½®å’Œç»„è£…</strong>ï¼šåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ ¹æ®éœ€è¦å°†é€‚é…å™¨ä¸ç›¸åº”çš„ç«¯å£è¿æ¥èµ·æ¥ã€‚</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒDDDä¸­çš„é€‚é…å™¨æ¨¡å¼æœ‰åŠ©äºæ„å»ºä¸€ä¸ªçµæ´»ã€å¯ç»´æŠ¤ä¸”æ˜“äºæµ‹è¯•çš„ç³»ç»Ÿã€‚</p><h4 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨DDDæ¶æ„ä¸­å®ç°é€‚é…å™¨æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ”¯ä»˜ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ”¯ä»˜ç«¯å£å’Œä¸€ä¸ªé€‚é…å™¨ï¼Œè¯¥é€‚é…å™¨è´Ÿè´£è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ”¯ä»˜ç«¯å£ï¼ˆPortï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæè¿°äº†æ”¯ä»˜æœåŠ¡åº”è¯¥æä¾›çš„æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentPort</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œå®ƒå®ç°äº†æ”¯ä»˜ç«¯å£ï¼Œå¹¶è´Ÿè´£è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalPaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">makePayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„å…·ä½“è°ƒç”¨é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Calling external payment service for amount: &quot;</span> + amount);</span><br><span class="line">        <span class="comment">// å‡è®¾æ”¯ä»˜æ€»æ˜¯æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentAdapter</span> <span class="keyword">implements</span> <span class="title class_">PaymentPort</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ExternalPaymentService externalPaymentService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentAdapter</span><span class="params">(ExternalPaymentService externalPaymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.externalPaymentService = externalPaymentService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£</span></span><br><span class="line">        <span class="keyword">return</span> externalPaymentService.makePayment(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¸­ä½¿ç”¨æ”¯ä»˜ç«¯å£ï¼Œè€Œä¸ä¾èµ–äºé€‚é…å™¨çš„å…·ä½“å®ç°ã€‚è¿™æ ·ï¼Œå¦‚æœå°†æ¥éœ€è¦æ›´æ¢å¤–éƒ¨æ”¯ä»˜æœåŠ¡ï¼Œæˆ‘ä»¬åªéœ€æä¾›ä¸€ä¸ªæ–°çš„é€‚é…å™¨å®ç°å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentPort paymentPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentService</span><span class="params">(PaymentPort paymentPort)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentPort = paymentPort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processUserPayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (paymentPort.processPayment(amount)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Payment processed successfully.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Payment failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºçš„å¯åŠ¨æˆ–é…ç½®é˜¶æ®µç»„è£…è¿™äº›ç»„ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">ExternalPaymentService</span> <span class="variable">externalPaymentService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExternalPaymentService</span>();</span><br><span class="line">        <span class="comment">// åˆ›å»ºé€‚é…å™¨çš„å®ä¾‹ï¼Œæ³¨å…¥å¤–éƒ¨æ”¯ä»˜æœåŠ¡</span></span><br><span class="line">        <span class="type">PaymentAdapter</span> <span class="variable">paymentAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentAdapter</span>(externalPaymentService);</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ”¯ä»˜æœåŠ¡çš„å®ä¾‹ï¼Œæ³¨å…¥é€‚é…å™¨</span></span><br><span class="line">        <span class="type">PaymentService</span> <span class="variable">paymentService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentService</span>(paymentAdapter);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†ç”¨æˆ·æ”¯ä»˜</span></span><br><span class="line">        paymentService.processUserPayment(<span class="number">100.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPaymentAdapter è´Ÿè´£è°ƒç”¨å¤–éƒ¨çš„æ”¯ä»˜æ¥å£ ExternalPaymentService.makePaymentã€‚PaymentService ä½¿ç”¨ PaymentPort æ¥å£ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’ï¼Œè¿™æ ·å°±å®ç°äº†é¢†åŸŸé€»è¾‘ä¸å¤–éƒ¨æœåŠ¡ä¹‹é—´çš„è§£è€¦ã€‚å¦‚æœéœ€è¦æ›´æ¢æ”¯ä»˜æœåŠ¡æä¾›å•†ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„ PaymentAdapterï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ PaymentService çš„ä»£ç ã€‚</p><h3 id="References">References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenAI SDKå¼€å‘(2)</title>
      <link href="/2023/12/04/2023-12-4-OpenAI-SDK%E5%BC%80%E5%8F%91-2/"/>
      <url>/2023/12/04/2023-12-4-OpenAI-SDK%E5%BC%80%E5%8F%91-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="OpenAI-SDKå¼€å‘-2-okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡">OpenAI SDKå¼€å‘(2) okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡</h2><p>æœ¬æ¬¡å¼€å‘å®Œæˆäº†æµå¼åº”ç­”,ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯okhttp3çš„eventsource</p><h4 id="æµç¨‹éªŒè¯">æµç¨‹éªŒè¯</h4><p>è·Ÿä¹‹å‰çš„ä¸»è¦åŒºåˆ«å°±æ˜¯éœ€è¦ä½¿ç”¨eventsourceæ¥ç›‘å¬æµå¼åº”ç­”,è¦å°†ChatCompletionRequestä¸­çš„streamå‚æ•°è®¾ç½®ä¸ºtrue,ä»¥okHttpClientå¼€å¯EventSource Factory,ä»¥å…¨æ–°çš„requestæ ¼å¼ä¼ é€’æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_client_stream</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException, InterruptedException &#123;</span><br><span class="line">        <span class="type">HttpLoggingInterceptor</span> <span class="variable">httpLoggingInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpLoggingInterceptor</span>();</span><br><span class="line">        httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line"></span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span></span><br><span class="line">                .Builder()</span><br><span class="line">                .addInterceptor(httpLoggingInterceptor)</span><br><span class="line">                .addInterceptor(chain -&gt; &#123;</span><br><span class="line">                    <span class="type">Request</span> <span class="variable">original</span> <span class="operator">=</span> chain.request();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ä»è¯·æ±‚ä¸­è·å– token å‚æ•°ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯·æ±‚è·¯å¾„ä¸­</span></span><br><span class="line">                    <span class="type">HttpUrl</span> <span class="variable">url</span> <span class="operator">=</span> original.url().newBuilder()</span><br><span class="line">                            .addQueryParameter(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">                    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> original.newBuilder()</span><br><span class="line">                            .url(url)</span><br><span class="line">                            .header(Header.AUTHORIZATION.getValue(), <span class="string">&quot;Bearer &quot;</span> + <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                            .header(Header.CONTENT_TYPE.getValue(), ContentType.JSON.getValue())</span><br><span class="line">                            .method(original.method(), original.body())</span><br><span class="line">                            .build();</span><br><span class="line">                    <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> Message.builder().role(Constants.Role.USER).content(<span class="string">&quot;å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;</span>).build();</span><br><span class="line">        <span class="type">ChatCompletionRequest</span> <span class="variable">chatCompletion</span> <span class="operator">=</span> ChatCompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .messages(Collections.singletonList(message))</span><br><span class="line">                .model(ChatCompletionRequest.Model.GPT_3_5_TURBO.getCode())</span><br><span class="line">                .stream(<span class="literal">true</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        EventSource.<span class="type">Factory</span> <span class="variable">factory</span> <span class="operator">=</span> EventSources.createFactory(okHttpClient);</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(chatCompletion);<span class="comment">//å°†chatCompletionè½¬ä¸ºjsonæ ¼å¼</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">                .url(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                .post(RequestBody.create(MediaType.parse(ContentType.JSON.getValue()), requestBody))</span><br><span class="line">                <span class="comment">//MediaType.parseç”¨æ¥å£°æ˜æµè§ˆå™¨å°†ä»¥ä»€ä¹ˆå½¢å¼ã€ä»€ä¹ˆç¼–ç å¯¹requestBodyè¿›è¡Œè§£æ</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">EventSource</span> <span class="variable">eventSource</span> <span class="operator">=</span> factory.newEventSource(request, <span class="keyword">new</span> <span class="title class_">EventSourceListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(EventSource eventSource, String id, String type, String data)</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ æ–¹æ³•">æ·»åŠ æ–¹æ³•</h4><p>åœ¨OpenAiSessionæ¥å£ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•,åœ¨ä¼ å…¥å‚æ•°ä¸ºChatCompletionRequestå’ŒEventSourceListeneræ—¶é‡‡ç”¨æµå¼åº”ç­”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é—®ç­”æ¨¡å‹ GPT-3.5/4.0 &amp; æµå¼åé¦ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventSourceListener   å®ç°ç›‘å¬ï¼›é€šè¿‡ç›‘å¬çš„ onEvent æ–¹æ³•æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EventSource <span class="title function_">chatCompletions</span><span class="params">(ChatCompletionRequest chatCompletionRequest, EventSourceListener eventSourceListener)</span> <span class="keyword">throws</span> JsonProcessingException;</span><br></pre></td></tr></table></figure><h4 id="å®ç°">å®ç°</h4><p>æ·»åŠ DefaultOpenAiSessionç±»ä¸­çš„chatCompletionsæ–¹æ³•,å®ç°æµå¼åº”ç­”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> EventSource <span class="title function_">chatCompletions</span><span class="params">(ChatCompletionRequest chatCompletionRequest, EventSourceListener eventSourceListener)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="comment">// æ ¸å¿ƒå‚æ•°æ ¡éªŒï¼›ä¸å¯¹ç”¨æˆ·çš„ä¼ å‚åšæ›´æ”¹ï¼Œåªè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!chatCompletionRequest.isStream()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;illegal parameter stream is false!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºè¯·æ±‚ä¿¡æ¯</span></span><br><span class="line">    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">            <span class="comment">// url: https://api.openai.com/v1/chat/completions - é€šè¿‡ IOpenAiApi é…ç½®çš„ POST æ¥å£ï¼Œç”¨è¿™æ ·çš„æ–¹å¼ä»ç»Ÿä¸€çš„åœ°æ–¹è·å–é…ç½®ä¿¡æ¯</span></span><br><span class="line">            .url(configuration.getApiHost().concat(IOpenAiApi.v1_chat_completions))</span><br><span class="line">            <span class="comment">// å°è£…è¯·æ±‚å‚æ•°ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨äº† Fastjson ä¹Ÿå¯ä»¥æ›¿æ¢ ObjectMapper è½¬æ¢å¯¹è±¡</span></span><br><span class="line">            .post(RequestBody.create(MediaType.parse(ContentType.JSON.getValue()), <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(chatCompletionRequest)))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç»“æœä¿¡æ¯ï¼›EventSource å¯¹è±¡å¯ä»¥å–æ¶ˆåº”ç­”</span></span><br><span class="line">    <span class="keyword">return</span> factory.newEventSource(request, eventSourceListener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> okhttp3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹ä»“å‚¨</title>
      <link href="/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-3/"/>
      <url>/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="DDDæ¶æ„ä¹‹ä»“å‚¨">DDDæ¶æ„ä¹‹ä»“å‚¨</h3><p>Repositoryï¼ˆä»“å‚¨ï¼‰æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒç”¨äºå°†æ•°æ®è®¿é—®é€»è¾‘å°è£…èµ·æ¥ï¼Œä½¿å¾—é¢†åŸŸå±‚å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•ã€ä¸€è‡´çš„æ¥å£æ¥è®¿é—®èšåˆæ ¹æˆ–å®ä½“å¯¹è±¡ã€‚è¿™ä¸ªæ¨¡å¼çš„å…³é”®åœ¨äºæä¾›äº†ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œé¢†åŸŸå±‚é€šè¿‡è¿™ä¸ªæ¥å£ä¸æ•°æ®å­˜å‚¨å±‚è¿›è¡Œäº¤äº’ï¼Œè€Œä¸éœ€è¦çŸ¥é“èƒŒåå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p><h4 id="ç‰¹æ€§">ç‰¹æ€§</h4><ul><li><strong>å°è£…æŒä¹…åŒ–æ“ä½œ</strong>ï¼šRepositoryè´Ÿè´£å°è£…æ‰€æœ‰ä¸æ•°æ®æºäº¤äº’çš„æ“ä½œï¼Œå¦‚åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ï¼ˆCRUDï¼‰æ“ä½œã€‚è¿™æ ·ï¼Œé¢†åŸŸå±‚çš„ä»£ç å°±å¯ä»¥é¿å…ç›´æ¥å¤„ç†æ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨æœºåˆ¶çš„å¤æ‚æ€§ã€‚</li><li><strong>é¢†åŸŸå¯¹è±¡çš„é›†åˆç®¡ç†</strong>ï¼šRepositoryé€šå¸¸è¢«è§†ä¸ºé¢†åŸŸå¯¹è±¡çš„é›†åˆï¼Œæä¾›äº†æŸ¥è¯¢å’Œè¿‡æ»¤è¿™äº›å¯¹è±¡çš„æ–¹æ³•ï¼Œä½¿å¾—é¢†åŸŸå¯¹è±¡çš„è·å–å’Œç®¡ç†æ›´åŠ æ–¹ä¾¿ã€‚<br>æŠ½è±¡æ¥å£ï¼šRepositoryå®šä¹‰äº†ä¸€ä¸ªä¸æŒä¹…åŒ–æœºåˆ¶æ— å…³çš„æ¥å£ï¼Œè¿™ä½¿å¾—é¢†åŸŸå±‚çš„ä»£ç å¯ä»¥åœ¨ä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ã€‚</li></ul><h4 id="ç”¨é€”">ç”¨é€”</h4><ol><li><strong>æ•°æ®è®¿é—®æŠ½è±¡</strong>ï¼šRepositoryä¸ºé¢†åŸŸå±‚æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„æ•°æ®è®¿é—®æ¥å£ï¼Œä½¿å¾—é¢†åŸŸå¯¹è±¡å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸æ˜¯æ•°æ®è®¿é—®çš„ç»†èŠ‚ã€‚</li><li><strong>é¢†åŸŸå¯¹è±¡çš„æŸ¥è¯¢å’Œç®¡ç†</strong>ï¼šRepositoryä½¿å¾—å¯¹é¢†åŸŸå¯¹è±¡çš„æŸ¥è¯¢å’Œç®¡ç†å˜å¾—æ›´åŠ æ–¹ä¾¿å’Œçµæ´»ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</li><li><strong>é¢†åŸŸé€»è¾‘ä¸æ•°æ®å­˜å‚¨åˆ†ç¦»</strong>ï¼šé€šè¿‡Repositoryæ¨¡å¼ï¼Œé¢†åŸŸé€»è¾‘ä¸æ•°æ®å­˜å‚¨é€»è¾‘åˆ†ç¦»ï¼Œæé«˜äº†é¢†åŸŸæ¨¡å‹çš„çº¯ç²¹æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</li><li><strong>ä¼˜åŒ–æ•°æ®è®¿é—®</strong>ï¼šRepositoryå®ç°å¯ä»¥åŒ…å«æ•°æ®è®¿é—®çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¦‚ç¼“å­˜ã€æ‰¹å¤„ç†æ“ä½œç­‰ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ">å®ç°æ‰‹æ®µ</h4><p>åœ¨å®è·µä¸­ï¼ŒRepositoryæ¨¡å¼é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ol><li><strong>å®šä¹‰Repositoryæ¥å£</strong>ï¼šåœ¨é¢†åŸŸå±‚å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªRepositoryæ¥å£ï¼Œè¿™äº›æ¥å£å£°æ˜äº†æ‰€éœ€çš„æ•°æ®è®¿é—®æ–¹æ³•ã€‚</li><li><strong>å®ç°Repositoryæ¥å£</strong>ï¼šåœ¨åŸºç¡€è®¾æ–½å±‚æˆ–æ•°æ®è®¿é—®å±‚å®ç°è¿™äº›æ¥å£ï¼Œå…·ä½“å®ç°å¯èƒ½æ˜¯ä½¿ç”¨ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå¦‚MyBatisã€Hibernateç­‰ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æ•°æ®åº“è®¿é—®APIï¼Œå¦‚JDBCç­‰ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å°†å…·ä½“çš„Repositoryå®ç°æ³¨å…¥åˆ°éœ€è¦å®ƒä»¬çš„é¢†åŸŸæœåŠ¡æˆ–åº”ç”¨æœåŠ¡ä¸­ã€‚è¿™æ ·åšå¯ä»¥è¿›ä¸€æ­¥è§£è€¦é¢†åŸŸå±‚å’Œæ•°æ®è®¿é—®å±‚ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå•å…ƒæµ‹è¯•ã€‚</li><li><strong>ä½¿ç”¨è§„èŒƒæ¨¡å¼ï¼ˆSpecification Patternï¼‰</strong>ï¼šæœ‰æ—¶å€™ï¼Œä¸ºäº†æ„å»ºå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨è§„èŒƒæ¨¡å¼ï¼Œè¿™æ˜¯ä¸€ç§å…è®¸å°†ä¸šåŠ¡è§„åˆ™å°è£…ä¸ºå•ç‹¬çš„ä¸šåŠ¡é€»è¾‘å•å…ƒçš„æ¨¡å¼ï¼Œè¿™äº›å•å…ƒå¯ä»¥è¢«Repositoryç”¨æ¥æ„å»ºæŸ¥è¯¢ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒRepositoryæ¨¡å¼æ˜¯DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæœ‰åŠ©äºä¿æŒé¢†åŸŸæ¨¡å‹çš„èšç„¦å’Œæ¸…æ™°ï¼ŒåŒæ—¶æä¾›äº†çµæ´»ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤çš„æ•°æ®è®¿é—®ç­–ç•¥ã€‚</p><h4 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨DDDæ¶æ„ä¸­å®ç°Repositoryæ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å®ä½“å’Œç”¨æˆ·ä»“å‚¨æ¥å£ï¼Œä»¥åŠä¸€ä¸ªåŸºäºå†…å­˜çš„ä»“å‚¨å®ç°ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”¨æˆ·å®ä½“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ã€getterå’Œsetterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ç”¨æˆ·ä»“å‚¨çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªåŸºäºå†…å­˜çš„ä»“å‚¨å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, User&gt; database = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">idGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> database.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(database.values());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setId(idGenerator.incrementAndGet());</span><br><span class="line">        &#125;</span><br><span class="line">        database.put(user.getId(), user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        database.remove(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨æœåŠ¡ä¸­ä½¿ç”¨è¿™ä¸ªä»“å‚¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(String username, String email)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        newUser.setUsername(username);</span><br><span class="line">        newUser.setEmail(email);</span><br><span class="line">        userRepository.save(newUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–ä¸šåŠ¡é€»è¾‘æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚Springï¼‰æ¥è‡ªåŠ¨æ³¨å…¥ä»“å‚¨çš„å®ç°ã€‚è¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºæœåŠ¡å’Œä»“å‚¨çš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserRepository</span> <span class="variable">userRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserRepository</span>();</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>(userRepository);</span><br><span class="line"></span><br><span class="line">        userService.createUser(<span class="string">&quot;XiaoFuGe&quot;</span>, <span class="string">&quot;xiaofuge@qq.com&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;User found: &quot;</span> + user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†Repositoryæ¨¡å¼çš„åŸºæœ¬ç»“æ„å’Œç”¨æ³•ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä»“å‚¨çš„å®ç°å¯èƒ½ä¼šè¿æ¥åˆ°æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨ORMæ¡†æ¶æ¥å¤„ç†æ•°æ®æŒä¹…åŒ–çš„ç»†èŠ‚ã€‚æ­¤å¤–ï¼Œä»“å‚¨æ¥å£å¯èƒ½ä¼šåŒ…å«æ›´å¤æ‚çš„æŸ¥è¯¢æ–¹æ³•ï¼Œä»¥æ”¯æŒå„ç§ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="References">References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹é¢†åŸŸ,èšåˆ,å®ä½“,å€¼å¯¹è±¡</title>
      <link href="/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-2/"/>
      <url>/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="DDDæ¶æ„ä¹‹é¢†åŸŸ-èšåˆ-å®ä½“-å€¼å¯¹è±¡">DDDæ¶æ„ä¹‹é¢†åŸŸ,èšåˆ,å®ä½“,å€¼å¯¹è±¡</h2><h3 id="Domainï¼ˆé¢†åŸŸï¼‰">Domainï¼ˆé¢†åŸŸï¼‰</h3><p>åœ¨DDDä¸­ï¼Œé¢†åŸŸæ˜¯æŒ‡å…·ä½“ä¸šåŠ¡é¢†åŸŸçš„çŸ¥è¯†ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ä»¥åŠä¸šåŠ¡è§„åˆ™çš„é›†åˆã€‚å®ƒæ˜¯è½¯ä»¶è¦è§£å†³é—®é¢˜çš„ä¸šåŠ¡ç¯å¢ƒï¼Œé€šå¸¸ç”±ä¸€ç³»åˆ—å­é¢†åŸŸç»„æˆï¼Œæ¯ä¸ªå­é¢†åŸŸä»£è¡¨ä¸šåŠ¡ä¸­çš„ä¸€ä¸ªç‰¹å®šéƒ¨åˆ†ã€‚</p><h4 id="é¢†åŸŸçš„ç‰¹æ€§">é¢†åŸŸçš„ç‰¹æ€§</h4><ol><li><strong>ä¸šåŠ¡ä¸­å¿ƒ</strong>ï¼šé¢†åŸŸæ˜¯å›´ç»•ä¸šåŠ¡éœ€æ±‚å’Œä¸šåŠ¡è§„åˆ™æ„å»ºçš„ï¼Œå®ƒæ˜¯è½¯ä»¶è®¾è®¡çš„æ ¸å¿ƒã€‚</li><li><strong>æ¨¡å‹é©±åŠ¨</strong>ï¼šé¢†åŸŸæ¨¡å‹æ˜¯å¯¹ä¸šåŠ¡çŸ¥è¯†çš„æŠ½è±¡ï¼Œå®ƒé€šè¿‡é¢†åŸŸå®ä½“ã€å€¼å¯¹è±¡ã€æœåŠ¡ã€èšåˆç­‰æ¦‚å¿µæ¥è¡¨è¾¾ã€‚</li><li><strong>è¯­è¨€ä¸€è‡´æ€§</strong>ï¼šé¢†åŸŸæ¨¡å‹çš„æ„å»ºåŸºäºç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰ï¼Œè¿™æ˜¯å¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶å…±åŒä½¿ç”¨çš„è¯­è¨€ï¼Œç¡®ä¿æ²Ÿé€šæ— æ­§ä¹‰ã€‚</li><li><strong>è¾¹ç•Œæ¸…æ™°</strong>ï¼šé¢†åŸŸæ¨¡å‹å®šä¹‰äº†æ¸…æ™°çš„è¾¹ç•Œï¼Œè¿™äº›è¾¹ç•Œåˆ’åˆ†äº†ä¸åŒçš„å­é¢†åŸŸå’Œèšåˆï¼Œæœ‰åŠ©äºç®¡ç†å¤æ‚æ€§å’Œç»´æŠ¤æ€§ã€‚</li></ol><h4 id="é¢†åŸŸçš„ç”¨é€”">é¢†åŸŸçš„ç”¨é€”</h4><p>ä¸šåŠ¡é€»è¾‘çš„å°è£…ï¼šé¢†åŸŸæ¨¡å‹å°è£…äº†ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å¾—ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®æ“ä½œé›†ä¸­ç®¡ç†ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤ã€‚<br>æ²Ÿé€šå·¥å…·ï¼šé¢†åŸŸæ¨¡å‹ä½œä¸ºå¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶ä¹‹é—´çš„å…±åŒè¯­è¨€ï¼Œæœ‰åŠ©äºæé«˜æ²Ÿé€šæ•ˆç‡ï¼Œç¡®ä¿è½¯ä»¶å¼€å‘ç´§å¯†è·Ÿéšä¸šåŠ¡éœ€æ±‚ã€‚<br>è½¯ä»¶è®¾è®¡çš„åŸºç¡€ï¼šé¢†åŸŸæ¨¡å‹æ˜¯è½¯ä»¶è®¾è®¡çš„åŸºç¡€ï¼Œå®ƒæŒ‡å¯¼ç€è½¯ä»¶çš„æ¶æ„å’Œå®ç°ã€‚</p><h4 id="å®ç°æ‰‹æ®µ">å®ç°æ‰‹æ®µ</h4><ol><li><strong>å®ä½“ï¼ˆEntityï¼‰</strong>ï¼šå…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ï¼Œä»£è¡¨ä¸šåŠ¡ä¸­çš„å®ä½“ã€‚</li><li><strong>å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</strong>ï¼šæè¿°é¢†åŸŸä¸­çš„ä¸€äº›ç‰¹æ€§æˆ–æ¦‚å¿µï¼Œæ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚</li><li><strong>èšåˆï¼ˆAggregateï¼‰</strong>ï¼šä¸€ç»„ç›¸å…³çš„å®ä½“å’Œå€¼å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬ä¸€èµ·æ„æˆä¸€ä¸ªæ•°æ®å’Œä¸šåŠ¡è§„åˆ™çš„å•å…ƒã€‚</li><li><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</strong>ï¼šåœ¨é¢†åŸŸæ¨¡å‹ä¸­æ‰§è¡Œç‰¹å®šä¸šåŠ¡é€»è¾‘çš„æ— çŠ¶æ€æœåŠ¡ï¼Œé€šå¸¸æ“ä½œå¤šä¸ªå®ä½“æˆ–èšåˆã€‚</li><li><strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</strong>ï¼šè¡¨ç¤ºé¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦ä¸šåŠ¡äº‹ä»¶ï¼Œç”¨äºè§£è€¦ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ã€‚</li><li><strong>ä»“å‚¨ï¼ˆRepositoryï¼‰</strong>ï¼šæä¾›å¯¹èšåˆæ ¹çš„æŒä¹…åŒ–æ“ä½œï¼Œå¦‚ä¿å­˜å’Œæ£€ç´¢ï¼Œé€šå¸¸ä¸æ•°æ®åº“äº¤äº’ã€‚</li><li><strong>é¢†åŸŸé€‚é…å™¨ï¼ˆDomain Adapterï¼‰</strong>ï¼šé¢†åŸŸé€‚é…å™¨æ˜¯é€‚é…å™¨æ¨¡å¼åœ¨DDDä¸­çš„åº”ç”¨ï¼Œå®ƒçš„ç›®çš„æ˜¯ä½¿å¾—é¢†åŸŸæ¨¡å‹èƒ½å¤Ÿä¸å¤–éƒ¨ç³»ç»Ÿæˆ–æŠ€æœ¯ç»†èŠ‚è¿›è¡Œäº¤äº’ï¼Œè€Œä¸ä¼šå—åˆ°æ±¡æŸ“ã€‚</li><li><strong>å·¥å‚ï¼ˆFactoryï¼‰</strong>ï¼šç”¨äºåˆ›å»ºå¤æ‚çš„èšåˆæˆ–å®ä½“ï¼Œå°è£…åˆ›å»ºé€»è¾‘ã€‚å¦‚ OpenAié¡¹ç›®ã€Lottery é¡¹ç›®éƒ½è¿ç”¨äº†å·¥å‚ï¼Œä¹ŸåŒ…æ‹¬å¦‚ chatglm-sdk-java çš„å¼€å‘ï¼Œå°±æ˜¯ä¼šè¯æ¨¡å‹ç»“æ„ç”¨å·¥å‚å¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ol><p>é€šè¿‡è¿™äº›å®ç°æ‰‹æ®µï¼ŒDDDä½¿å¾—è½¯ä»¶è®¾è®¡æ›´åŠ è´´è¿‘ä¸šåŠ¡éœ€æ±‚ï¼Œæé«˜äº†è½¯ä»¶çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç†è§£ä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œè®¾è®¡å‡ºæ›´åŠ å¥å£®å’Œçµæ´»çš„ç³»ç»Ÿã€‚</p><h3 id="èšåˆå¯¹è±¡">èšåˆå¯¹è±¡</h3><p>èšåˆæ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬ä¸€èµ·å½¢æˆä¸€ä¸ªå•ä¸€çš„å•å…ƒã€‚</p><h4 id="æ¦‚å¿µ">æ¦‚å¿µ</h4><p>èšåˆæ˜¯é¢†åŸŸæ¨¡å‹ä¸­çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç»„å…·æœ‰å†…èšæ€§çš„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œè¿™äº›å¯¹è±¡ä¸€èµ·å·¥ä½œä»¥æ‰§è¡ŒæŸäº›ä¸šåŠ¡è§„åˆ™æˆ–æ“ä½œã€‚èšåˆå®šä¹‰äº†ä¸€ç»„å¯¹è±¡çš„è¾¹ç•Œï¼Œè¿™äº›å¯¹è±¡å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå•ä¸€çš„å•å…ƒè¿›è¡Œå¤„ç†ã€‚</p><p><strong>å…³é”®</strong>ï¼šèšåˆå†…å®ç°äº‹åŠ¡ä¸€è‡´æ€§ã€èšåˆå¤–å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h4 id="ç‰¹æ€§">ç‰¹æ€§</h4><ol><li><strong>ä¸€è‡´æ€§è¾¹ç•Œ</strong>ï¼šèšåˆç¡®ä¿å…¶å†…éƒ¨å¯¹è±¡çš„çŠ¶æ€å˜åŒ–æ˜¯ä¸€è‡´çš„ã€‚å½“å¯¹èšåˆå†…çš„å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œè¿™äº›æ“ä½œå¿…é¡»ä¿æŒèšåˆå†…æ‰€æœ‰å¯¹è±¡çš„ä¸€è‡´æ€§ã€‚</li><li><strong>æ ¹å®ä½“</strong>ï¼šæ¯ä¸ªèšåˆéƒ½æœ‰ä¸€ä¸ªæ ¹å®ä½“ï¼ˆAggregate Rootï¼‰ï¼Œå®ƒæ˜¯èšåˆçš„å…¥å£ç‚¹ã€‚æ ¹å®ä½“æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå…¶ä»–å¯¹è±¡é€šè¿‡æ ¹å®ä½“ä¸èšåˆäº¤äº’ã€‚</li><li><strong>äº‹åŠ¡è¾¹ç•Œ</strong>ï¼šèšåˆä¹Ÿå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œã€‚åœ¨èšåˆå†…éƒ¨ï¼Œæ‰€æœ‰çš„å˜æ›´æ“ä½œåº”è¯¥æ˜¯åŸå­çš„ï¼Œå³å®ƒä»¬è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ol><h4 id="ç”¨é€”">ç”¨é€”</h4><ol><li><strong>å°è£…ä¸šåŠ¡é€»è¾‘</strong>ï¼šèšåˆé€šè¿‡å°†ç›¸å…³çš„å¯¹è±¡å’Œæ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„ä¸šåŠ¡é€»è¾‘æ¨¡å‹ï¼Œæœ‰åŠ©äºä¸šåŠ¡è§„åˆ™çš„å®æ–½å’Œç»´æŠ¤ã€‚</li><li><strong>ä¿è¯ä¸€è‡´æ€§</strong>ï¼šèšåˆç¡®ä¿å†…éƒ¨çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡å®šä¹‰æ¸…æ™°çš„è¾¹ç•Œå’Œè§„åˆ™ï¼Œèšåˆå¯ä»¥åœ¨å†…éƒ¨å¼ºåˆ¶æ‰§è¡Œä¸šåŠ¡è§„åˆ™ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>ç®€åŒ–å¤æ‚æ€§</strong>ï¼šèšåˆé€šè¿‡ç»„ç»‡ç›¸å…³çš„å¯¹è±¡ï¼Œç®€åŒ–äº†é¢†åŸŸæ¨¡å‹çš„å¤æ‚æ€§ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œæ‰©å±•ç³»ç»Ÿã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ-2">å®ç°æ‰‹æ®µ</h4><ol><li><strong>å®šä¹‰èšåˆæ ¹</strong>ï¼šé€‰æ‹©åˆé€‚çš„èšåˆæ ¹æ˜¯å®ç°èšåˆçš„ç¬¬ä¸€æ­¥ã€‚èšåˆæ ¹åº”è¯¥æ˜¯èƒ½å¤Ÿä»£è¡¨æ•´ä¸ªèšåˆçš„å®ä½“ï¼Œå¹¶ä¸”æ‹¥æœ‰å”¯ä¸€æ ‡è¯†ã€‚</li><li><strong>é™åˆ¶è®¿é—®è·¯å¾„</strong>ï¼šåªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹èšåˆå†…çš„å¯¹è±¡ï¼Œä¸å…è®¸ç›´æ¥ä¿®æ”¹èšåˆå†…éƒ¨å¯¹è±¡çš„çŠ¶æ€ï¼Œä»¥æ­¤æ¥ç»´æŠ¤è¾¹ç•Œå’Œä¸€è‡´æ€§ã€‚</li><li><strong>è®¾è®¡äº‹åŠ¡ç­–ç•¥</strong>ï¼šåœ¨èšåˆå†…éƒ¨å®ç°äº‹åŠ¡ä¸€è‡´æ€§ï¼Œç¡®ä¿æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚å¯¹äºèšåˆä¹‹é—´çš„äº¤äº’ï¼Œå¯ä»¥é‡‡ç”¨é¢†åŸŸäº‹ä»¶æˆ–å…¶ä»–æœºåˆ¶æ¥å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</li><li><strong>å°è£…ä¸šåŠ¡è§„åˆ™</strong>ï¼šåœ¨èšåˆå†…éƒ¨å®ç°ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰çš„ä¸šåŠ¡æ“ä½œéƒ½éµå¾ªè¿™äº›è§„åˆ™ã€‚<br>æŒä¹…åŒ–ï¼šèšåˆæ ¹é€šå¸¸ä¸æ•°æ®æŒä¹…åŒ–å±‚äº¤äº’ï¼Œä»¥ä¿å­˜èšåˆçš„çŠ¶æ€ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹è±¡-å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æˆ–å…¶ä»–æ•°æ®æ˜ å°„æŠ€æœ¯ã€‚</li></ol><p>é€šè¿‡è¿™äº›å®ç°æ‰‹æ®µï¼ŒDDDä¸­çš„èšåˆæ¨¡å‹èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºæ—¢ç¬¦åˆä¸šåŠ¡éœ€æ±‚åˆå…·æœ‰è‰¯å¥½æ¶æ„è®¾è®¡çš„è½¯ä»¶ç³»ç»Ÿã€‚</p><h3 id="å®ä½“">å®ä½“</h3><p>å®ä½“ï¼ˆEntityï¼‰åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Design, DDDï¼‰ä¸­æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºå…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ã€‚ä»¥ä¸‹æ˜¯å®ä½“çš„è¯¦ç»†ä»‹ç»ï¼š</p><h4 id="æ¦‚å¿µ-2">æ¦‚å¿µ</h4><p>å®ä½“ = å”¯ä¸€æ ‡è¯† + çŠ¶æ€å±æ€§ + è¡Œä¸ºåŠ¨ä½œï¼ˆåŠŸèƒ½ï¼‰ï¼Œæ˜¯DDDä¸­çš„ä¸€ä¸ªåŸºæœ¬æ„å»ºå—ï¼Œå®ƒä»£è¡¨äº†å…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ã€‚å®ä½“ä¸ä»…ä»…åŒ…å«æ•°æ®ï¼ˆçŠ¶æ€å±æ€§ï¼‰ï¼Œè¿˜åŒ…å«äº†ç›¸å…³çš„è¡Œä¸ºï¼ˆåŠŸèƒ½ï¼‰ï¼Œå¹¶ä¸”å®ƒçš„æ ‡è¯†åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚</p><h4 id="ç‰¹æ€§-2">ç‰¹æ€§</h4><ol><li><strong>å”¯ä¸€æ ‡è¯†</strong>ï¼šå®ä½“å…·æœ‰ä¸€ä¸ªå¯ä»¥åŒºåˆ†å…¶ä»–å®ä½“çš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªIDã€ä¸€ä¸ªå¤åˆé”®æˆ–è€…æ˜¯ä¸€ä¸ªè‡ªç„¶é”®ï¼Œå…³é”®æ˜¯å®ƒèƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è¯†å®ä½“å®ä¾‹ã€‚</li><li><strong>é¢†åŸŸæ ‡è¯†</strong>ï¼šå®ä½“çš„æ ‡è¯†é€šå¸¸æ¥æºäºä¸šåŠ¡é¢†åŸŸï¼Œä¾‹å¦‚ç”¨æˆ·IDã€è®¢å•IDç­‰ã€‚è¿™äº›æ ‡è¯†ç¬¦åœ¨ä¸šåŠ¡ä¸Šæœ‰ç‰¹å®šçš„å«ä¹‰ï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ã€‚</li><li><strong>å§”æ´¾æ ‡è¯†</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ä½“çš„æ ‡è¯†å¯èƒ½æ˜¯ç”±ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¦‚æ•°æ®åº“ä¸­çš„è‡ªå¢ä¸»é”®ã€‚è¿™ç§æ ‡è¯†ç¬¦è™½ç„¶å¯ä»¥å”¯ä¸€æ ‡è¯†å®ä½“ï¼Œä½†å®ƒå¹¶ä¸ç›´æ¥æ¥æºäºä¸šåŠ¡é¢†åŸŸã€‚</li></ol><h4 id="ç”¨é€”-2">ç”¨é€”</h4><ol><li><strong>è¡¨è¾¾ä¸šåŠ¡æ¦‚å¿µ</strong>ï¼šå®ä½“ç”¨äºåœ¨è½¯ä»¶ä¸­è¡¨è¾¾å…·ä½“çš„ä¸šåŠ¡æ¦‚å¿µï¼Œå¦‚ç”¨æˆ·ã€è®¢å•ã€äº¤æ˜“ç­‰ã€‚é€šè¿‡å®ä½“çš„å±æ€§å’Œè¡Œä¸ºï¼Œå¯ä»¥æè¿°è¿™äº›ä¸šåŠ¡å¯¹è±¡çš„ç‰¹å¾å’Œèƒ½åŠ›ã€‚</li><li><strong>å°è£…ä¸šåŠ¡é€»è¾‘</strong>ï¼šå®ä½“ä¸ä»…ä»…æ‰¿è½½æ•°æ®ï¼Œè¿˜å°è£…äº†ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘ã€‚è¿™äº›é€»è¾‘åŒ…æ‹¬éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ã€æ‰§è¡Œä¸šåŠ¡è§„åˆ™ã€è®¡ç®—å±æ€§å€¼ç­‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯ä¸šåŠ¡é€»è¾‘çš„é›†ä¸­å’Œä¸€è‡´æ€§ã€‚</li><li><strong>ä¿æŒæ•°æ®ä¸€è‡´æ€§</strong>ï¼šå®ä½“è´Ÿè´£ç»´æŠ¤è‡ªèº«çš„çŠ¶æ€å’Œæ•°æ®ä¸€è‡´æ€§ã€‚å®ƒç¡®ä¿è‡ªå·±çš„å±æ€§å’Œå…³è”å…³ç³»åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯æ­£ç¡®å’Œå®Œæ•´çš„ï¼Œä»è€Œé¿å…æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ-3">å®ç°æ‰‹æ®µ</h4><p>åœ¨å®ç°å®ä½“æ—¶ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä»¥ä¸‹æ‰‹æ®µï¼š</p><ol><li><strong>å®šä¹‰å®ä½“ç±»</strong>ï¼šåœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªç±»ï¼Œè¯¥ç±»åŒ…å«å®ä½“çš„å±æ€§ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ç­‰ã€‚</li><li><strong>å®ç°å”¯ä¸€æ ‡è¯†</strong>ï¼šä¸ºå®ä½“ç±»æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†çš„å±æ€§ï¼Œå¦‚IDï¼Œå¹¶ç¡®ä¿åœ¨å®ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸­è¿™ä¸ªæ ‡è¯†ä¿æŒä¸å˜ã€‚</li><li><strong>å°è£…è¡Œä¸º</strong>ï¼šåœ¨å®ä½“ç±»ä¸­å®ç°ä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æ“ä½œå®ä½“çš„çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡è§„åˆ™ã€‚</li><li><strong>ä½¿ç”¨ORMæ¡†æ¶</strong>ï¼šåˆ©ç”¨ORMæ¡†æ¶å°†å®ä½“æ˜ å°„åˆ°æ•°æ®åº“è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–æ•°æ®æŒä¹…åŒ–çš„æ“ä½œã€‚</li><li><strong>å®ç°é¢†åŸŸæœåŠ¡</strong>ï¼šå¯¹äºè·¨å®ä½“æˆ–è·¨èšåˆçš„æ“ä½œï¼Œå¯ä»¥å®ç°é¢†åŸŸæœåŠ¡æ¥å¤„ç†è¿™äº›æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨å®ä½“ä¸­ç›´æ¥å®ç°ã€‚</li><li><strong>ä½¿ç”¨é¢†åŸŸäº‹ä»¶</strong>ï¼šå½“å®ä½“çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼Œè¿™æ ·å¯ä»¥é€šçŸ¥å…¶ä»–éƒ¨åˆ†çš„ç³»ç»Ÿè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</li></ol><p>é€šè¿‡ä¸Šè¿°æ‰‹æ®µï¼Œå®ä½“åœ¨DDDæ¶æ„ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå®ƒä¸ä»…ä»£è¡¨äº†ä¸šåŠ¡æ¦‚å¿µï¼Œè¿˜å°è£…äº†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶é€šè¿‡å…¶å”¯ä¸€æ ‡è¯†ç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h3 id="å€¼å¯¹è±¡">å€¼å¯¹è±¡</h3><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Design, DDDï¼‰ä¸­ï¼Œå€¼å¯¹è±¡ï¼ˆValue Objectï¼‰æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºå°è£…å’Œè¡¨ç¤ºé¢†åŸŸä¸­çš„æ¦‚å¿µï¼Œå…¶ç‰¹ç‚¹æ˜¯å®ƒä»¬æè¿°äº†é¢†åŸŸä¸­çš„æŸäº›å±æ€§æˆ–åº¦é‡ï¼Œä½†ä¸å…·æœ‰å”¯ä¸€æ ‡è¯†ã€‚</p><p>å€¼å¯¹è±¡ = å€¼ + å¯¹è±¡ï¼Œç”¨äºæè¿°å¯¹è±¡å±æ€§çš„å€¼ï¼Œè¡¨ç¤ºå…·ä½“å›ºå®šä¸å˜çš„å±æ€§å€¼ä¿¡æ¯ã€‚</p><h4 id="æ¦‚å¿µ-3">æ¦‚å¿µ</h4><p>å€¼å¯¹è±¡æ˜¯ç”±ä¸€ç»„å±æ€§ç»„æˆçš„ï¼Œå®ƒä»¬å…±åŒæè¿°äº†ä¸€ä¸ªé¢†åŸŸæ¦‚å¿µã€‚ä¸å®ä½“ï¼ˆEntityï¼‰ä¸åŒï¼Œå€¼å¯¹è±¡ä¸éœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥åŒºåˆ†å®ƒä»¬ã€‚å€¼å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºï¼Œå®ƒä»¬çš„çŠ¶æ€å°±ä¸åº”è¯¥æ”¹å˜ã€‚</p><h4 id="ç‰¹æ€§-3">ç‰¹æ€§</h4><ol><li><strong>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</strong>ï¼šå€¼å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå®ƒçš„çŠ¶æ€å°±ä¸åº”è¯¥å‘ç”Ÿå˜åŒ–ã€‚è¿™æœ‰åŠ©äºä¿è¯é¢†åŸŸæ¨¡å‹çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚</li><li><strong>ç­‰ä»·æ€§ï¼ˆEqualityï¼‰</strong>ï¼šå€¼å¯¹è±¡çš„ç­‰ä»·æ€§ä¸æ˜¯åŸºäºèº«ä»½æˆ–å¼•ç”¨ï¼Œè€Œæ˜¯åŸºäºå¯¹è±¡çš„å±æ€§å€¼ã€‚å¦‚æœä¸¤ä¸ªå€¼å¯¹è±¡çš„æ‰€æœ‰å±æ€§å€¼éƒ½ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°±è¢«è®¤ä¸ºæ˜¯ç­‰ä»·çš„ã€‚</li><li><strong>æ›¿æ¢æ€§ï¼ˆReplaceabilityï¼‰</strong>ï¼šç”±äºå€¼å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä»»ä½•éœ€è¦æ”¹å˜å€¼å¯¹è±¡çš„æ“ä½œéƒ½ä¼šå¯¼è‡´åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼å¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„å®ä¾‹ã€‚</li><li><strong>ä¾§é‡äºæè¿°äº‹ç‰©çš„çŠ¶æ€</strong>ï¼šå€¼å¯¹è±¡é€šå¸¸ç”¨æ¥æè¿°äº‹ç‰©çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯äº‹ç‰©çš„å”¯ä¸€èº«ä»½ã€‚</li><li><strong>å¯å¤ç”¨æ€§ï¼ˆReusabilityï¼‰</strong>ï¼šå€¼å¯¹è±¡å¯ä»¥åœ¨ä¸åŒçš„é¢†åŸŸå®ä½“æˆ–å…¶ä»–å€¼å¯¹è±¡ä¸­é‡å¤ä½¿ç”¨ã€‚</li></ol><h4 id="ç”¨é€”-3">ç”¨é€”</h4><p>å€¼å¯¹è±¡çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥è¡¨ç¤ºï¼š</p><p>é‡‘é¢å’Œè´§å¸ï¼ˆå¦‚ä»·æ ¼ã€å·¥èµ„ã€è´¹ç”¨ç­‰ï¼‰<br>åº¦é‡å’Œæ•°æ®ï¼ˆå¦‚é‡é‡ã€é•¿åº¦ã€ä½“ç§¯ç­‰ï¼‰<br>èŒƒå›´æˆ–åŒºé—´ï¼ˆå¦‚æ—¥æœŸèŒƒå›´ã€æ¸©åº¦åŒºé—´ç­‰ï¼‰<br>å¤æ‚çš„æ•°å­¦æ¨¡å‹ï¼ˆå¦‚åæ ‡ã€å‘é‡ç­‰ï¼‰<br>ä»»ä½•å…¶ä»–éœ€è¦å°è£…çš„å±æ€§é›†åˆ</p><h4 id="å®ç°æ‰‹æ®µ-4">å®ç°æ‰‹æ®µ</h4><p>åœ¨å®ç°å€¼å¯¹è±¡æ—¶ï¼Œé€šå¸¸ä¼šéµå¾ªä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>å®šä¹‰ä¸å¯å˜ç±»ï¼šç¡®ä¿ç±»çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æ„é€ å‡½æ•°æ¥è®¾ç½®ã€‚<br>é‡å†™equalså’ŒhashCodeæ–¹æ³•ï¼šè¿™æ ·å¯ä»¥ç¡®ä¿å€¼å¯¹è±¡çš„ç­‰ä»·æ€§æ˜¯åŸºäºå®ƒä»¬çš„å±æ€§å€¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚<br>æä¾›åªè¯»è®¿é—®å™¨ï¼šåªæä¾›è·å–å±æ€§å€¼çš„æ–¹æ³•ï¼Œä¸æä¾›ä¿®æ”¹å±æ€§å€¼çš„æ–¹æ³•ã€‚<br>ä½¿ç”¨å·¥å‚æ–¹æ³•æˆ–æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹ï¼šè¿™æœ‰åŠ©äºç¡®ä¿å€¼å¯¹è±¡çš„æœ‰æ•ˆæ€§å’Œä¸€è‡´æ€§ã€‚<br>è€ƒè™‘åºåˆ—åŒ–æ”¯æŒï¼šå¦‚æœå€¼å¯¹è±¡éœ€è¦åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œéœ€è¦æä¾›åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ”¯æŒã€‚</p><h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4><p>ä»¥è®¢å•çŠ¶æ€ä¸ºä¾‹ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå€¼å¯¹è±¡æ¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Order</span> StatusVO&#123;</span><br><span class="line">    PLACED(<span class="number">0</span>,<span class="string">&quot;ä¸‹å•&quot;</span>),</span><br><span class="line">    PAID(<span class="number">1</span>,<span class="string">&quot;æ”¯ä»˜&quot;</span>),</span><br><span class="line">    COMPLETED(<span class="number">2</span>,<span class="string">&quot;å®Œæˆ&quot;</span>),</span><br><span class="line">    CANCELLED(<span class="number">3</span>,<span class="string">&quot;é€€å•&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line"></span><br><span class="line">OrderStatusVO(intcode,String description)&#123;</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">    <span class="built_in">this</span>.description = description;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> description;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®codeè·å–å¯¹åº”çš„OrderStatus</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">OrderStatusVOfromCode</span><span class="params">(<span class="type">int</span> code)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(OrderStatusVO status:OrderStatusVO.values())&#123;</span><br><span class="line">        <span class="keyword">if</span>(status.getCode()==code)&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">throw</span> newIllegalArgumentException(<span class="string">&quot;Invalid code for OrderStatus:&quot;</span>+code);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒOrderStatusVOæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹çš„å€¼å¯¹è±¡ï¼Œå®ƒå°è£…äº†è®¢å•çŠ¶æ€çš„ä»£ç å’Œæè¿°ã€‚å®ƒæ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”æä¾›äº†åŸºäºå±æ€§å€¼çš„ç­‰ä»·æ€§ã€‚é€šè¿‡å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿è®¢å•çŠ¶æ€çš„å€¼æ˜¯å—é™çš„ï¼Œå¹¶ä¸”æ¯ä¸ªçŠ¶æ€éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„å«ä¹‰ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œè®¢å•çŠ¶æ€å¯èƒ½ä¼šä»¥æ•´æ•°å½¢å¼å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œ0è¡¨ç¤ºä¸‹å•ï¼Œ1è¡¨ç¤ºæ”¯ä»˜ç­‰ï¼‰ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨OrderStatusVOæšä¸¾æ¥ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯ç±»å‹å®‰å…¨çš„å€¼ï¼Œè€Œä¸æ˜¯è£¸éœ²çš„æ•´æ•°ã€‚è¿™æ ·å¯ä»¥å‡å°‘é”™è¯¯ï¼Œå¹¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>å½“éœ€è¦å°†è®¢å•çŠ¶æ€å­˜å‚¨åˆ°æ•°æ®åº“ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨æšä¸¾çš„codeå€¼ã€‚å½“ä»æ•°æ®åº“ä¸­è¯»å–è®¢å•çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨fromCodeæ–¹æ³•æ¥å°†æ•´æ•°å€¼è½¬æ¢å›OrderStatusVOæšä¸¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ä¸°å¯Œçš„æšä¸¾ç±»å‹è€Œä¸æ˜¯ç®€å•çš„æ•´æ•°ã€‚</p><p>å€¼å¯¹è±¡ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºæ›´å¤æ‚çš„ç»“æ„ï¼Œæ¯”å¦‚ä¸€ä¸ªåœ°å€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> classAddressVO&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringstreet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringcity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringzipCode;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringcountry;</span><br><span class="line"></span><br><span class="line">    publicAddress(Stringstreet,Stringcity,StringzipCode,Stringcountry)&#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥æ·»åŠ éªŒè¯é€»è¾‘ä»¥ç¡®ä¿åœ°å€çš„æœ‰æ•ˆæ€§</span></span><br><span class="line">        <span class="built_in">this</span>.street=street;</span><br><span class="line">        <span class="built_in">this</span>.city=city;</span><br><span class="line">        <span class="built_in">this</span>.zipCode=zipCode;</span><br><span class="line">        <span class="built_in">this</span>.country=country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åªè¯»è®¿é—®å™¨</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStreet</span><span class="params">()</span>&#123;</span><br><span class="line">        returnstreet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span>&#123;</span><br><span class="line">        returncity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getZipCode</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zipCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCountry</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™equalså’ŒhashCodeæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Objecto)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>==o)returntrue;</span><br><span class="line">        <span class="keyword">if</span>(o==<span class="literal">null</span>||getClass()!=o.getClass())returnfalse;</span><br><span class="line">        Address address=(Address)o;</span><br><span class="line">        <span class="keyword">return</span> street.equals(address.street)&amp;&amp;</span><br><span class="line">        city.equals(address.city)&amp;&amp;</span><br><span class="line">        zipCode.equals(address.zipCode)&amp;&amp;</span><br><span class="line">        country.equals(address.country);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(street,city,zipCode,country);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAddressVOæ˜¯ä¸€ä¸ªä¸å¯å˜çš„å€¼å¯¹è±¡ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªåœ°å€çš„æ‰€æœ‰éƒ¨åˆ†ã€‚å®ƒæä¾›äº†åªè¯»è®¿é—®å™¨ï¼Œå¹¶ä¸”é‡å†™äº†equalså’ŒhashCodeæ–¹æ³•ä»¥ç¡®ä¿åŸºäºå±æ€§å€¼çš„ç­‰ä»·æ€§ã€‚è¿™æ ·çš„è®¾è®¡æœ‰åŠ©äºç¡®ä¿åœ°å€çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„å®ä½“ä¹‹é—´é‡å¤ä½¿ç”¨ï¼Œä¾‹å¦‚ç”¨æˆ·å’Œå•†åº—éƒ½å¯èƒ½æœ‰åœ°å€ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå€¼å¯¹è±¡æ˜¯DDDä¸­ç”¨äºå°è£…é¢†åŸŸæ¦‚å¿µçš„é‡è¦å·¥å…·ï¼Œå®ƒä»¬é€šè¿‡æä¾›ä¸å¯å˜æ€§ã€åŸºäºå±æ€§çš„ç­‰ä»·æ€§å’Œæ›¿æ¢æ€§æ¥å¸®åŠ©æ„å»ºä¸€ä¸ªæ¸…æ™°ã€ä¸€è‡´å’Œå¯ç»´æŠ¤çš„é¢†åŸŸæ¨¡å‹ã€‚</p><h3 id="References">References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenAI SDKå¼€å‘(1)</title>
      <link href="/2023/12/03/2023-12-3-OpenAI-SDK%E5%BC%80%E5%8F%91-1/"/>
      <url>/2023/12/03/2023-12-3-OpenAI-SDK%E5%BC%80%E5%8F%91-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="OpenAI-SDKå¼€å‘-1">OpenAI SDKå¼€å‘(1)</h2><p>æœ¬æ¬¡å®Œæˆçš„æ˜¯åŸºæœ¬æ¡†æ¶çš„æ­å»º,é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/36.png" alt="avatar"></p><h3 id="common">common</h3><h5 id="Constants">Constants</h5><p>commonåŒ…ä¸‹å®šä¹‰äº†Constantsç±»,é‡Œé¢æš‚æ—¶å†™äº†ä¸€ä¸ªæšä¸¾å¯¹è±¡Role,æ˜¯è¦ç”¨åœ¨Messageä¸­çš„ä¸€ä¸ªå‚æ•°,è€ŒMessageåœ¨Requestå’ŒResponseä¸­éƒ½æœ‰,æ‰€ä»¥æ”¾åœ¨commonåŒ…ä¸‹,åé¢ä¼šç”¨åˆ°.</p><p><img src="https://pb01.s3.bitiful.net/37.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®˜ç½‘æ”¯æŒçš„è¯·æ±‚è§’è‰²ç±»å‹ï¼›systemã€userã€assistant</span></span><br><span class="line"><span class="comment">     * https://platform.openai.com/docs/guides/chat/introduction</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Role</span> &#123;</span><br><span class="line"></span><br><span class="line">        SYSTEM(<span class="string">&quot;system&quot;</span>),</span><br><span class="line">        USER(<span class="string">&quot;user&quot;</span>),</span><br><span class="line">        ASSISTANT(<span class="string">&quot;assistant&quot;</span>),</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">        Role(String code) &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="domain">domain</h3><h4 id="chat-èŠå¤©æ¨¡å‹">chat(èŠå¤©æ¨¡å‹)</h4><h5 id="ChatChoice">ChatChoice</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatChoice</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> index;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;message&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;finish_reason&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String finishReason;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢å®šä¹‰çš„æ˜¯choicesä¸­çš„å‡ ä¸ªå‚æ•°,choiceså‚æ•°æ˜¯åœ¨Responseä¸­çš„</p><p><img src="https://pb01.s3.bitiful.net/38.png" alt="avatar"></p><h5 id="ChatCompletionRequest-èŠå¤©å®Œæˆè¯·æ±‚">ChatCompletionRequest(èŠå¤©å®Œæˆè¯·æ±‚)</h5><p>æŠŠmodelå•ç‹¬å†™äº†ä¸€ä¸ªæšä¸¾ç±»,å®šä¹‰ç±»æ‰€éœ€å‚æ•°</p><p>è¿™äº›å‚æ•°é‡Œåªæœ‰modelå’Œmessageæ˜¯å¿…é¡»çš„,å…¶ä»–çš„éƒ½æ˜¯å¯é€‰çš„,æ‰€ä»¥ç”¨Builderæ¨¡å¼æ¥æ„å»ºå¯¹è±¡</p><p><img src="https://pb01.s3.bitiful.net/39.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionRequest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** é»˜è®¤æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">model</span> <span class="operator">=</span> Model.GPT_3_5_TURBO.getCode();</span><br><span class="line">    <span class="comment">/** é—®é¢˜æè¿° */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Message&gt; messages;</span><br><span class="line">    <span class="comment">/** æ§åˆ¶æ¸©åº¦ã€éšæœºæ€§ã€‘ï¼›0åˆ°2ä¹‹é—´ã€‚è¾ƒé«˜çš„å€¼(å¦‚0.8)å°†ä½¿è¾“å‡ºæ›´åŠ éšæœºï¼Œè€Œè¾ƒä½çš„å€¼(å¦‚0.2)å°†ä½¿è¾“å‡ºæ›´åŠ é›†ä¸­å’Œç¡®å®š */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">temperature</span> <span class="operator">=</span> <span class="number">0.2</span>;</span><br><span class="line">    <span class="comment">/** å¤šæ ·æ€§æ§åˆ¶ï¼›ä½¿ç”¨æ¸©åº¦é‡‡æ ·çš„æ›¿ä»£æ–¹æ³•ç§°ä¸ºæ ¸å¿ƒé‡‡æ ·ï¼Œå…¶ä¸­æ¨¡å‹è€ƒè™‘å…·æœ‰top_pæ¦‚ç‡è´¨é‡çš„ä»¤ç‰Œçš„ç»“æœã€‚å› æ­¤ï¼Œ0.1 æ„å‘³ç€åªè€ƒè™‘åŒ…å«å‰ 10% æ¦‚ç‡è´¨é‡çš„ä»£å¸ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;top_p&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Double</span> <span class="variable">topP</span> <span class="operator">=</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="comment">/** ä¸ºæ¯ä¸ªæç¤ºç”Ÿæˆçš„å®Œæˆæ¬¡æ•° */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/** æ˜¯å¦ä¸ºæµå¼è¾“å‡ºï¼›å°±æ˜¯ä¸€è¹¦ä¸€è¹¦çš„ï¼Œå‡ºæ¥ç»“æœ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/** åœæ­¢è¾“å‡ºæ ‡è¯† */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; stop;</span><br><span class="line">    <span class="comment">/** è¾“å‡ºå­—ç¬¦ä¸²é™åˆ¶ï¼›0 ~ 4096 */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;max_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">maxTokens</span> <span class="operator">=</span> <span class="number">2048</span>;</span><br><span class="line">    <span class="comment">/** é¢‘ç‡æƒ©ç½šï¼›é™ä½æ¨¡å‹é‡å¤åŒä¸€è¡Œçš„å¯èƒ½æ€§ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;frequency_penalty&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">frequencyPenalty</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** å­˜åœ¨æƒ©ç½šï¼›å¢å¼ºæ¨¡å‹è°ˆè®ºæ–°è¯é¢˜çš„å¯èƒ½æ€§ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;presence_penalty&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">presencePenalty</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** ç”Ÿæˆå¤šä¸ªè°ƒç”¨ç»“æœï¼Œåªæ˜¾ç¤ºæœ€ä½³çš„ã€‚è¿™æ ·ä¼šæ›´å¤šçš„æ¶ˆè€—ä½ çš„ api token */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;logit_bias&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map logitBias;</span><br><span class="line">    <span class="comment">/** è°ƒç”¨æ ‡è¯†ï¼Œé¿å…é‡å¤è°ƒç”¨ */</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Model</span> &#123;</span><br><span class="line">        <span class="comment">/** gpt-3.5-turbo */</span></span><br><span class="line">        GPT_3_5_TURBO(<span class="string">&quot;gpt-3.5-turbo&quot;</span>),</span><br><span class="line">        <span class="comment">/** GPT4.0 */</span></span><br><span class="line">        GPT_4(<span class="string">&quot;gpt-4&quot;</span>),</span><br><span class="line">        <span class="comment">/** GPT4.0 è¶…é•¿ä¸Šä¸‹æ–‡ */</span></span><br><span class="line">        GPT_4_32K(<span class="string">&quot;gpt-4-32k&quot;</span>),</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ChatCompletionResponse-èŠå¤©å®Œæˆå“åº”">ChatCompletionResponse(èŠå¤©å®Œæˆå“åº”)</h5><p>å®šä¹‰äº†Responseä¸­çš„å‚æ•°</p><p><img src="https://pb01.s3.bitiful.net/38.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ID */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/** å¯¹è±¡ */</span></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="comment">/** æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="comment">/** å¯¹è¯ */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ChatChoice&gt; choices;</span><br><span class="line">    <span class="comment">/** åˆ›å»º */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> created;</span><br><span class="line">    <span class="comment">/** è€—æ */</span></span><br><span class="line">    <span class="keyword">private</span> Usage usage;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Message">Message</h5><p>å®šä¹‰çš„èŠå¤©æ¶ˆæ¯å¯¹è±¡ï¼ŒåŒ…å«æ¶ˆæ¯è§’è‰²ã€æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Message</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.role = builder.role;</span><br><span class="line">        <span class="built_in">this</span>.content = builder.content;</span><br><span class="line">        <span class="built_in">this</span>.name = builder.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºé€ è€…æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String role;</span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">role</span><span class="params">(Constants.Role role)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.role = role.getCode();</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">content</span><span class="params">(String content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">name</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Message <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="other">other</h4><h5 id="Usage-ä½¿ç”¨é‡">Usage(ä½¿ç”¨é‡)</h5><p>æ˜¯Responseä¸­çš„ä¸€ä¸ªå‚æ•°,è®°å½•äº†tokençš„ä½¿ç”¨é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Usage</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æç¤ºä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;prompt_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> promptTokens;</span><br><span class="line">    <span class="comment">/** å®Œæˆä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;completion_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> completionTokens;</span><br><span class="line">    <span class="comment">/** æ€»é‡ä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;total_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> totalTokens;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getPromptTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> promptTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPromptTokens</span><span class="params">(<span class="type">long</span> promptTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.promptTokens = promptTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getCompletionTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> completionTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompletionTokens</span><span class="params">(<span class="type">long</span> completionTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.completionTokens = completionTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTotalTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalTokens</span><span class="params">(<span class="type">long</span> totalTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.totalTokens = totalTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="OpenAiResponse">OpenAiResponse</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenAiResponse</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; data;</span><br><span class="line">    <span class="keyword">private</span> Error error;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Error</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        <span class="keyword">private</span> String type;</span><br><span class="line">        <span class="keyword">private</span> String param;</span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="qa-é—®ç­”æ¨¡å‹">qa(é—®ç­”æ¨¡å‹)</h4><p><img src="https://pb01.s3.bitiful.net/40.png" alt="avatar"><br>å¾ˆå¿«å°±ä¸èƒ½ç”¨äº†,è€Œä¸”è·ŸèŠå¤©æ¨¡å‹å·®ä¸å¤š,å°±ä¸è´´ä»£ç äº†</p><h5 id="QAChoice">QAChoice</h5><p><img src="https://pb01.s3.bitiful.net/41.png" alt="avatar"></p><h5 id="QACompletionRequest">QACompletionRequest</h5><p>modelå’Œpromptå‚æ•°å¿…è¦,å…¶ä»–å‚æ•°å¯é€‰</p><p><img src="https://pb01.s3.bitiful.net/42.png" alt="avatar"></p><h5 id="QACompletionResponse">QACompletionResponse</h5><p><img src="https://pb01.s3.bitiful.net/43.png" alt="avatar"></p><h3 id="interceptor">interceptor</h3><h5 id="OpenAiInterceptor-è‡ªå®šä¹‰æ‹¦æˆªå™¨">OpenAiInterceptor(è‡ªå®šä¹‰æ‹¦æˆªå™¨)</h5><p>authæ–¹æ³•å°†tokenå‚æ•°åŠ å…¥urlå¯¹è±¡,è¿”å›ä¸€ä¸ªæ–°çš„è¯·æ±‚,interceptå¯¹è¯¥è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åå°†å¤„ç†åçš„è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼ˆæˆ–ç›®æ ‡æ–¹æ³•ï¼‰ç»§ç»­å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenAiInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** OpenAi apiKey éœ€è¦åœ¨å®˜ç½‘ç”³è¯· */</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    <span class="comment">/** è®¿é—®æˆæƒæ¥å£çš„è®¤è¯ Token */</span></span><br><span class="line">    <span class="keyword">private</span> String authToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OpenAiInterceptor</span><span class="params">(String apiKey, String authToken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.apiKey = apiKey;</span><br><span class="line">        <span class="built_in">this</span>.authToken = authToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Response <span class="title function_">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(<span class="built_in">this</span>.auth(apiKey, chain.request()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Request <span class="title function_">auth</span><span class="params">(String apiKey, Request original)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®Tokenä¿¡æ¯ï¼›å¦‚æœæ²¡æœ‰æ­¤ç±»é™åˆ¶ï¼Œæ˜¯ä¸éœ€è¦è®¾ç½®çš„ã€‚</span></span><br><span class="line">        <span class="type">HttpUrl</span> <span class="variable">url</span> <span class="operator">=</span> original.url().newBuilder()</span><br><span class="line">                .addQueryParameter(<span class="string">&quot;token&quot;</span>, authToken)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> original.newBuilder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .header(Header.AUTHORIZATION.getValue(), <span class="string">&quot;Bearer &quot;</span> + apiKey)</span><br><span class="line">                .header(Header.CONTENT_TYPE.getValue(), ContentType.JSON.getValue())</span><br><span class="line">                .method(original.method(), original.body())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="session">session</h3><h5 id="IOpenAiApi">IOpenAiApi</h5><p>å®šä¹‰è®¿é—®æ¥å£,ä¼ å…¥è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOpenAiApi</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Body</span>æ³¨è§£ç”¨äºæè¿°ä¸€ä¸ªæ¥å£ä¸­çš„ä¸€ä¸ªæ–¹æ³•å‚æ•°ï¼Œè¯¥å‚æ•°å°†æ¥æ”¶è¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">     * å½“å¤„ç†HTTP POSTè¯·æ±‚æ—¶ï¼Œé€šå¸¸å°†è¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®æ˜ å°„åˆ°æ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qaCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                    è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/completions&quot;)</span></span><br><span class="line">    Single&lt;QACompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> QACompletionRequest qaCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/chat/completions&quot;)</span></span><br><span class="line">    Single&lt;ChatCompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="OpenAiSession">OpenAiSession</h5><p>ä¼šè¯æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qaCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                    è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    QACompletionResponse <span class="title function_">completions</span><span class="params">(QACompletionRequest qaCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”ï¼›ç®€å•è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> question è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>         è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    QACompletionResponse <span class="title function_">completions</span><span class="params">(String question)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="OpenAiSessionFactory">OpenAiSessionFactory</h5><p>ä¼šè¯å·¥å‚æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenAiSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    OpenAiSession <span class="title function_">openSession</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Configuration">Configuration</h5><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Configuration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String apiHost;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line"><span class="comment">//    @NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String authToken;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="DefaultOpenAiSession">DefaultOpenAiSession</h5><p>å®ç°OpenAiSessionæ¥å£</p><p>blockingGet()æ˜¯RxJavaä¸­Single<T>ä¸­çš„æ–¹æ³•,ç”¨äºå°†å½“å‰çº¿ç¨‹é˜»å¡,è¿™é‡Œçš„ä½œç”¨æ˜¯å°†å¼‚æ­¥è®¡ç®—çš„ç»“æœè½¬æ¢ä¸ºåŒæ­¥ç»“æœï¼Œä½¿å¾—è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„çº¿ç¨‹ä¼šç­‰å¾…å¼‚æ­¥è®¡ç®—å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSession</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IOpenAiApi openAiApi;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSession</span><span class="params">(IOpenAiApi openAiApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.openAiApi = openAiApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QACompletionResponse <span class="title function_">completions</span><span class="params">(QACompletionRequest qaCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(qaCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QACompletionResponse <span class="title function_">completions</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="type">QACompletionRequest</span> <span class="variable">request</span> <span class="operator">=</span> QACompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .prompt(question)</span><br><span class="line">                .build();</span><br><span class="line">        Single&lt;QACompletionResponse&gt; completions = <span class="built_in">this</span>.openAiApi.completions(request);</span><br><span class="line">        <span class="keyword">return</span> completions.blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(chatCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="DefaultOpenAiSessionFactory">DefaultOpenAiSessionFactory</h5><p>å®ç°OpenAiSessionFactoryæ¥å£,å…¶å®å®ç°çš„æ˜¯IOpenAiApiæ¥å£,è¿”å›ä¸€ä¸ªDefaultOpenAiSession(openAiApi)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSessionFactory</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Configuration configuration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSessionFactory</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OpenAiSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ—¥å¿—é…ç½®</span></span><br><span class="line">        <span class="type">HttpLoggingInterceptor</span> <span class="variable">httpLoggingInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpLoggingInterceptor</span>();</span><br><span class="line">        httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.HEADERS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å¼€å¯ Http å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span></span><br><span class="line">                .Builder()</span><br><span class="line">                .addInterceptor(httpLoggingInterceptor)</span><br><span class="line">                .addInterceptor(<span class="keyword">new</span> <span class="title class_">OpenAiInterceptor</span>(configuration.getApiKey(), configuration.getAuthToken()))</span><br><span class="line">                .connectTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .writeTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .readTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å®ç°IOpenAiApiæ¥å£,åˆ›å»º API æœåŠ¡,å³ç½‘ç»œè¯·æ±‚æ¥å£å¯¹è±¡å®ä¾‹</span></span><br><span class="line">        <span class="type">IOpenAiApi</span> <span class="variable">openAiApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(configuration.getApiHost())<span class="comment">//å¾—åˆ°url</span></span><br><span class="line">                .client(okHttpClient)<span class="comment">//è®¾ç½®å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">//        RxJava2CallAdapterFactoryçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">//        1.å°†Androidçš„Callå¯¹è±¡è½¬æ¢ä¸ºRxJavaçš„Observableç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">//        2.å¤„ç†Callçš„é”™è¯¯å’Œç»“æœï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRxJavaçš„onErrorå’ŒonNextäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//        3.æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚é‡è¯•ã€ç½‘ç»œé”™è¯¯ç­‰ã€‚</span></span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .addConverterFactory(JacksonConverterFactory.create())<span class="comment">//åœ¨è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨jacksonåº“è¿›è¡Œjsonè½¬æ¢</span></span><br><span class="line">                .build().create(IOpenAiApi.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultOpenAiSession</span>(openAiApi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</h3><p>ä¼ url,key,tokenå’Œrequestå°±è¡Œ</p><p><img src="https://pb01.s3.bitiful.net/44.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OpenAiSession openAiSession;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_OpenAiSessionFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        configuration.setApiHost(<span class="string">&quot;https://api.openai-proxy.com/&quot;</span>);</span><br><span class="line">        configuration.setApiKey(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        configuration.setAuthToken(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. ä¼šè¯å·¥å‚</span></span><br><span class="line">        <span class="type">OpenAiSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultOpenAiSessionFactory</span>(configuration);</span><br><span class="line">        <span class="comment">// 3. å¼€å¯ä¼šè¯</span></span><br><span class="line">        <span class="built_in">this</span>.openAiSession = factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤å¯¹è¯æ¨¡å‹ 3.5 æ¥è¿‘äºå®˜ç½‘ä½“éªŒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_chat_completions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºå‚æ•°</span></span><br><span class="line">        <span class="type">ChatCompletionRequest</span> <span class="variable">chatCompletion</span> <span class="operator">=</span> ChatCompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .messages(Collections.singletonList(Message.builder().role(Constants.Role.USER).content(<span class="string">&quot;å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;</span>).build()))</span><br><span class="line">                .model(ChatCompletionRequest.Model.GPT_3_5_TURBO.getCode())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 2. å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="type">ChatCompletionResponse</span> <span class="variable">chatCompletionResponse</span> <span class="operator">=</span> openAiSession.completions(chatCompletion);</span><br><span class="line">        <span class="comment">// 3. è§£æç»“æœ</span></span><br><span class="line">        chatCompletionResponse.getChoices().forEach(e -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ(è¯¦ç»†æ³¨é‡Šç‰ˆ)</title>
      <link href="/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C2/"/>
      <url>/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ-è¯¦ç»†æ³¨é‡Šç‰ˆ">è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ(è¯¦ç»†æ³¨é‡Šç‰ˆ)</h3><p><strong>ç¯å¢ƒ</strong>:VSCode+MASM/TASMæ’ä»¶(å»ºè®®ä½¿ç”¨ç›¸åŒç¯å¢ƒ,å­¦æ ¡æœºæˆ¿ç¯å¢ƒæœ‰ç‚¹è€,å¯èƒ½ä¼šå‡ºä¸€äº›å¥‡æ€ªçš„é—®é¢˜)</p><p><img src="https://pb01.s3.bitiful.net/32.png" alt="avatar"></p><h4 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚</h4><ol><li>è¾“å…¥ä¸€ä¸ªä¸è¶…è¿‡5ä½çš„åè¿›åˆ¶æ•°,å›è½¦ç»“æŸè¾“å…¥,å¹¶å°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°,è¾“å‡ºåˆ°å±å¹•ä¸Š</li><li>è¾“å…¥éæ•°å­—å­—ç¬¦,æŠ¥é”™,é‡æ–°è¾“å…¥</li><li>è¾“å…¥qæˆ–Q,ç»“æŸç¨‹åº</li><li>è¾“å…¥å­—ç¬¦ä¸²,ç©ºæ ¼ç»“æŸè¾“å…¥,ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ•°å­—çš„ä¸ªæ•° <strong>(é€‰åš)</strong></li></ol><h4 id="åŸºç¡€ç‰ˆæœ¬-ä¸åš4">åŸºç¡€ç‰ˆæœ¬(ä¸åš4)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">_STACK SEGMENT PARA STACK&#x27;_STACK&#x27;</span><br><span class="line">DB 128 DUP(0)</span><br><span class="line">_STACK ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA SEGMENT</span><br><span class="line">    hello DB &#x27;Input a number or an instruction!!Q OR q: EXIT&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    wrong DB 0AH,0DH,&#x27;Wrong Input(only numbers!)&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    endofhex DB 0AH,0DH,&#x27;Binary:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish DB 0AH,0DH,&#x27;Finished&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    got DB 5 DUP(0)</span><br><span class="line">DATA ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CODE SEGMENT</span><br><span class="line">assume cs:CODE,ds:DATA,ss:_STACK</span><br><span class="line"></span><br><span class="line">START:</span><br><span class="line"></span><br><span class="line">beginofread:</span><br><span class="line">    mov ax,DATA</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;å–åç§»åœ°å€</span><br><span class="line">    mov dx,offset hello</span><br><span class="line">    ;æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¸…é›¶BX</span><br><span class="line">    mov bx,0H</span><br><span class="line">    ; åˆå§‹åŒ–DIå’ŒCX</span><br><span class="line">    mov di,offset got</span><br><span class="line">    mov cx,0H</span><br><span class="line">readchar:</span><br><span class="line">    ; è¯»å–å­—ç¬¦</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¯”è¾ƒBXæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³åˆ°notfirst</span><br><span class="line">    cmp bx,0H</span><br><span class="line">    jne notfirst</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºQæˆ–qï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€€å‡ºç¨‹åº</span><br><span class="line">    cmp al,&#x27;Q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    cmp al,&#x27;q&#x27;</span><br><span class="line">    je exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">notfirst:</span><br><span class="line">;åˆ¤æ–­æ˜¯å¦åˆæ³•</span><br><span class="line">    mov bx,01H</span><br><span class="line">    call legalcheck</span><br><span class="line">;ä¸åˆæ³•é‡æ–°å¼€å§‹</span><br><span class="line">    cmp bx,02H</span><br><span class="line">    je beginofread</span><br><span class="line">;æ¢è¡Œè¾“å…¥ç»“æŸ</span><br><span class="line">    cmp bx,04H</span><br><span class="line">    je endofinput</span><br><span class="line"></span><br><span class="line">    jmp loadinmemory</span><br><span class="line"></span><br><span class="line">loadinmemory:</span><br><span class="line">;è¾“å…¥å­˜å…¥å†…å­˜</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc cx</span><br><span class="line">    inc di</span><br><span class="line">    jmp readchar</span><br><span class="line"></span><br><span class="line">endofinput:</span><br><span class="line">;å–å‰5ä½</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov di,offset got</span><br><span class="line"></span><br><span class="line">;å°†æ•°å­—è½¬æ¢ä¸ºasciiç </span><br><span class="line">beginofhandle:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov bl,[di]</span><br><span class="line">    ; å°†å¯„å­˜å™¨BXä¸­çš„å€¼å‡å»30H</span><br><span class="line">    sub bx,30H  </span><br><span class="line">    add dx,bx</span><br><span class="line">    ;å¤„ç†å®Œæ¯•</span><br><span class="line">    cmp cx,1H</span><br><span class="line">    je endofhandle</span><br><span class="line">    ;axæ¸…é›¶,ä¹˜10</span><br><span class="line">    call mulAHdxtodx</span><br><span class="line">    ;å¾…å¤„ç†å­—ç¬¦å‡ä¸€</span><br><span class="line">    dec cx</span><br><span class="line">    ;ä¸‹ä¸€ä½</span><br><span class="line">    inc di</span><br><span class="line">    jmp beginofhandle</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºASCIIç </span><br><span class="line">endofhandle:</span><br><span class="line">;è¾“å‡º2è¿›åˆ¶</span><br><span class="line">    call binaryoutput</span><br><span class="line">;è·³è½¬é‡æ–°å¼€å§‹</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line">binaryoutput:</span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov cx,10H ;å¾ªç¯16æ¬¡</span><br><span class="line">    ;å¼€å§‹å¾ªç¯</span><br><span class="line">beginofoutputloop:</span><br><span class="line">;å·¦ç§»1ä½</span><br><span class="line">    shl bx,1</span><br><span class="line">;ä¸è¿›ä½åˆ™è·³è½¬</span><br><span class="line">    jnc out0</span><br><span class="line">    mov dl,&#x27;1&#x27;</span><br><span class="line">    jmp outputdl</span><br><span class="line">out0:</span><br><span class="line">    mov dl,&#x27;0&#x27;</span><br><span class="line">outputdl:</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    dec cx ;å¾ªç¯æ¬¡æ•°å‡1</span><br><span class="line">    cmp cx,0H ;åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸ</span><br><span class="line">    jne beginofoutputloop</span><br><span class="line">    ;ç»“æŸå¾ªç¯,è¾“å‡ºç»“æŸè¯­å¥</span><br><span class="line">    mov dx,offset finish </span><br><span class="line">    mov ah,09H </span><br><span class="line">    int 21H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">legalcheck:</span><br><span class="line">;åˆ¤æ–­æ¢è¡Œ</span><br><span class="line">    cmp al,0DH</span><br><span class="line">    je endlegalnextline</span><br><span class="line">;åˆ¤æ–­æ•°å­—0-9</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb endlegalfalse</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja endlegalfalse</span><br><span class="line"></span><br><span class="line">endlegaltrue:</span><br><span class="line">    mov bx,03H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalnextline:</span><br><span class="line">    mov bx,04H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalfalse:</span><br><span class="line">;è¾“å‡ºwrongè¯­å¥</span><br><span class="line">    mov dx,offset wrong</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">;é‡æ–°å¼€å§‹ç¨‹åº</span><br><span class="line">    mov bx,02H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mulAHdxtodx:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov ax,0H</span><br><span class="line">    </span><br><span class="line">loopofmul:</span><br><span class="line">    add ax,dx</span><br><span class="line">    inc bx</span><br><span class="line">    cmp bx,0AH</span><br><span class="line">    jb loopofmul</span><br><span class="line">    mov dx,ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">    mov ah,4CH</span><br><span class="line">    int 21H</span><br><span class="line">CODE ENDS</span><br><span class="line">END START</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ:</strong></p><p><img src="https://pb01.s3.bitiful.net/34.png" alt="avatar"></p><h4 id="å®Œæ•´ç‰ˆ-å®éªŒç»“æŸåå®Œæˆ">å®Œæ•´ç‰ˆ(å®éªŒç»“æŸåå®Œæˆ)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">_STACK SEGMENT PARA STACK&#x27;_STACK&#x27;</span><br><span class="line">DB 128 DUP(0)</span><br><span class="line">_STACK ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA SEGMENT</span><br><span class="line">    hello DB &#x27;Input a number or an instruction!!Q OR q: EXIT,s:SEARCH&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    wrong DB 0AH,0DH,&#x27;Wrong Input(only numbers!)&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    endofhex DB 0AH,0DH,&#x27;Binary:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish DB 0AH,0DH,&#x27;Finished&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    hello2 DB 0AH,0DH,&#x27;Search number inyour string. Space to end input&#x27;,0AH,0DH,&#x27;Input string:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish2 DB 0AH,0DH,&#x27;FINISHED!!!&#x27;,0AH,0DH,&#x27;THERE ARE &#x27;,&#x27;$&#x27;</span><br><span class="line">    finish3 DB &#x27; numbers&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    got DB 5 DUP(0)</span><br><span class="line">DATA ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CODE SEGMENT</span><br><span class="line">assume cs:CODE,ds:DATA,ss:_STACK</span><br><span class="line"></span><br><span class="line">START:</span><br><span class="line"></span><br><span class="line">beginofread:</span><br><span class="line">    mov ax,DATA</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;å–åç§»åœ°å€</span><br><span class="line">    mov dx,offset hello</span><br><span class="line">    ;æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¸…é›¶BX</span><br><span class="line">    mov bx,0H</span><br><span class="line">    ; åˆå§‹åŒ–DIå’ŒCX</span><br><span class="line">    mov di,offset got</span><br><span class="line">    mov cx,0H</span><br><span class="line">readchar:</span><br><span class="line">    ; è¯»å–å­—ç¬¦</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¯”è¾ƒBXæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³åˆ°notfirst</span><br><span class="line">    cmp bx,0H</span><br><span class="line">    jne notfirst</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºQæˆ–qï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€€å‡ºç¨‹åº</span><br><span class="line">    cmp al,&#x27;Q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    cmp al,&#x27;q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºsï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œæœç´¢æ“ä½œ</span><br><span class="line">    cmp al,&#x27;s&#x27;</span><br><span class="line">    je counterofnumber</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">notfirst:</span><br><span class="line">;åˆ¤æ–­æ˜¯å¦åˆæ³•</span><br><span class="line">    mov bx,01H</span><br><span class="line">    call legalcheck</span><br><span class="line">;ä¸åˆæ³•é‡æ–°å¼€å§‹</span><br><span class="line">    cmp bx,02H</span><br><span class="line">    je beginofread</span><br><span class="line">;æ¢è¡Œè¾“å…¥ç»“æŸ</span><br><span class="line">    cmp bx,04H</span><br><span class="line">    je endofinput</span><br><span class="line"></span><br><span class="line">    jmp loadinmemory</span><br><span class="line"></span><br><span class="line">loadinmemory:</span><br><span class="line">;è¾“å…¥å­˜å…¥å†…å­˜</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc cx</span><br><span class="line">    inc di</span><br><span class="line">    jmp readchar</span><br><span class="line"></span><br><span class="line">endofinput:</span><br><span class="line">;å–å‰5ä½</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov di,offset got</span><br><span class="line"></span><br><span class="line">;å°†æ•°å­—è½¬æ¢ä¸ºasciiç </span><br><span class="line">beginofhandle:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov bl,[di]</span><br><span class="line">    ; å°†å¯„å­˜å™¨BXä¸­çš„å€¼å‡å»30H</span><br><span class="line">    sub bx,30H  </span><br><span class="line">    add dx,bx</span><br><span class="line">    ;å¤„ç†å®Œæ¯•</span><br><span class="line">    cmp cx,1H</span><br><span class="line">    je endofhandle</span><br><span class="line">    ;axæ¸…é›¶,ä¹˜10</span><br><span class="line">    call mulAHdxtodx</span><br><span class="line">    ;å¾…å¤„ç†å­—ç¬¦å‡ä¸€</span><br><span class="line">    dec cx</span><br><span class="line">    ;ä¸‹ä¸€ä½</span><br><span class="line">    inc di</span><br><span class="line">    jmp beginofhandle</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºASCIIç </span><br><span class="line">endofhandle:</span><br><span class="line">;è¾“å‡º2è¿›åˆ¶</span><br><span class="line">    call binaryoutput</span><br><span class="line">;è·³è½¬é‡æ–°å¼€å§‹</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line">binaryoutput:</span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov cx,10H ;å¾ªç¯16æ¬¡</span><br><span class="line">    ;å¼€å§‹å¾ªç¯</span><br><span class="line">beginofoutputloop:</span><br><span class="line">;å·¦ç§»1ä½</span><br><span class="line">    shl bx,1</span><br><span class="line">;ä¸è¿›ä½åˆ™è·³è½¬</span><br><span class="line">    jnc out0</span><br><span class="line">    mov dl,&#x27;1&#x27;</span><br><span class="line">    jmp outputdl</span><br><span class="line">out0:</span><br><span class="line">    mov dl,&#x27;0&#x27;</span><br><span class="line">outputdl:</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    dec cx ;å¾ªç¯æ¬¡æ•°å‡1</span><br><span class="line">    cmp cx,0H ;åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸ</span><br><span class="line">    jne beginofoutputloop</span><br><span class="line">    ;ç»“æŸå¾ªç¯,è¾“å‡ºç»“æŸè¯­å¥</span><br><span class="line">    mov dx,offset finish </span><br><span class="line">    mov ah,09H </span><br><span class="line">    int 21H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">legalcheck:</span><br><span class="line">;åˆ¤æ–­æ¢è¡Œ</span><br><span class="line">    cmp al,0DH</span><br><span class="line">    je endlegalnextline</span><br><span class="line">;åˆ¤æ–­æ•°å­—0-9</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb endlegalfalse</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja endlegalfalse</span><br><span class="line"></span><br><span class="line">endlegaltrue:</span><br><span class="line">    mov bx,03H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalnextline:</span><br><span class="line">    mov bx,04H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalfalse:</span><br><span class="line">;è¾“å‡ºwrongè¯­å¥</span><br><span class="line">    mov dx,offset wrong</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">;é‡æ–°å¼€å§‹ç¨‹åº</span><br><span class="line">    mov bx,02H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">mulAHdxtodx:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov ax,0H</span><br><span class="line">    </span><br><span class="line">loopofmul:</span><br><span class="line">    add ax,dx</span><br><span class="line">    inc bx</span><br><span class="line">    cmp bx,0AH</span><br><span class="line">    jb loopofmul</span><br><span class="line">    mov dx,ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">counterofnumber:</span><br><span class="line">    mov dx,offset hello2</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    mov cx,0H</span><br><span class="line">beginofcount:</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ;ç©ºæ ¼å®Œæˆè¾“å…¥</span><br><span class="line">    cmp al,20H</span><br><span class="line">    je endofcount</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb notnum</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja notnum</span><br><span class="line">isnum:</span><br><span class="line">    inc cx</span><br><span class="line">    jmp beginofcount</span><br><span class="line">notnum:</span><br><span class="line">    jmp beginofcount</span><br><span class="line">endofcount:</span><br><span class="line">    add cx,30H</span><br><span class="line">    mov dx,offset finish2</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov dl,cl</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    mov dx,offset finish3</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ;è·³å›å¼€å§‹ä½ç½®</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">    mov ah,4CH</span><br><span class="line">    int 21H</span><br><span class="line">CODE ENDS</span><br><span class="line">END START</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ:</strong><br><img src="https://pb01.s3.bitiful.net/35.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€(è¯¦ç»†æ³¨é‡Šç‰ˆ)</title>
      <link href="/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C1/"/>
      <url>/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€-è¯¦ç»†æ³¨é‡Šç‰ˆ">è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€(è¯¦ç»†æ³¨é‡Šç‰ˆ)</h3><p><strong>ç¯å¢ƒ</strong>:VSCode+MASM/TASMæ’ä»¶(å»ºè®®ä½¿ç”¨ç›¸åŒç¯å¢ƒ,å­¦æ ¡æœºæˆ¿ç¯å¢ƒæœ‰ç‚¹è€,å¯èƒ½ä¼šå‡ºä¸€äº›å¥‡æ€ªçš„é—®é¢˜)</p><p><img src="https://pb01.s3.bitiful.net/32.png" alt="avatar"></p><h4 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚</h4><ol><li>æ‰“å°Hello World!</li><li>æ‰“å°è¾“å…¥çš„å§“å</li><li>æ‰“å°è¾“å…¥çš„id</li><li>å°†è¾“å…¥çš„å­—ç¬¦è½¬æ¢æˆASCIIç </li><li>è¾“å…¥qæˆ–Qé€€å‡ºç¨‹åº</li></ol><h4 id="ä»£ç ">ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">stack segment</span><br><span class="line">    db 128 dup(0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">   msg1 db &#x27;hello world!$&#x27;       ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºâ€œhello world!â€</span><br><span class="line">   msg2 db &#x27;please input your name:$&#x27;  ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥åå­—</span><br><span class="line">   msg3 db &#x27;please input your id:$&#x27;    ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥ID</span><br><span class="line">   msg4 db &#x27;please input a char:$&#x27;    ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">   buffer db &#x27;$&#x27;                  ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç©ºå­—ç¬¦ä¸² </span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">; å°†æ•°æ®æ®µåœ°å€èµ‹å€¼ç»™AX</span><br><span class="line">    mov ax,data</span><br><span class="line">    ; å°†AXçš„å€¼èµ‹å€¼ç»™DS</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ; å°†AXçš„å€¼èµ‹å€¼ç»™ES</span><br><span class="line">    mov es,ax</span><br><span class="line"></span><br><span class="line">; æ˜¾ç¤ºâ€œhello world!â€å­—ç¬¦ä¸²</span><br><span class="line">    lea dx, msg1</span><br><span class="line">    mov ah, 9</span><br><span class="line">    int 21h  ;ä¸­æ–­è°ƒç”¨æŒ‡ä»¤</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">; å›è½¦æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh  </span><br><span class="line">    mov ah, 2  </span><br><span class="line">    int 21h</span><br><span class="line">mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥åå­—</span><br><span class="line">    lea dx, msg2</span><br><span class="line">    mov ah, 9</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ; è¾“å…¥åå­—</span><br><span class="line">    lea dx, buffer</span><br><span class="line">    mov ah, 0Ah</span><br><span class="line">    mov al, 00h</span><br><span class="line">    int 21h</span><br><span class="line">    ; æ¸…ç©ºç¼“å†²åŒº</span><br><span class="line">    xor bx,bx</span><br><span class="line">mov bl,buffer[1]</span><br><span class="line">mov buffer[bx+2],&#x27;$&#x27;</span><br><span class="line"></span><br><span class="line">    ;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºå§“å</span><br><span class="line">lea dx, offset [buffer+2]      </span><br><span class="line">    mov ah, 09h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥ID</span><br><span class="line">lea dx, msg3</span><br><span class="line">mov ah,9</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥IDçš„åç»­æ“ä½œ</span><br><span class="line">lea dx,buffer</span><br><span class="line">mov ah,0Ah</span><br><span class="line">mov al,00h</span><br><span class="line">int 21h</span><br><span class="line"> </span><br><span class="line">;æ¸…ç©ºç¼“å†²åŒº</span><br><span class="line">xor bx,bx</span><br><span class="line">mov bl,buffer[1]</span><br><span class="line">mov buffer[bx+2],&#x27;$&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">; æ˜¾ç¤ºID</span><br><span class="line">lea dx, offset [buffer+2]      </span><br><span class="line">    mov ah, 09h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmpq:</span><br><span class="line">mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">; æ˜¾ç¤ºæç¤ºè¾“å…¥å­—ç¬¦çš„å­—ç¬¦ä¸²</span><br><span class="line">lea dx,msg4</span><br><span class="line">mov ah,9</span><br><span class="line">int 21h</span><br><span class="line">    </span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">;è¾“å…¥ä¸€ä¸ªå­—ç¬¦å¹¶å›æ˜¾</span><br><span class="line">    mov ah, 1</span><br><span class="line">    int 21h ;æ‰§è¡Œä¸­æ–­1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmp al, &#x27;q&#x27;</span><br><span class="line">    ;è‹¥ç­‰äºqï¼Œåˆ™è·³è½¬åˆ°ending</span><br><span class="line">    je ending</span><br><span class="line">    cmp al, &#x27;Q&#x27;</span><br><span class="line">    ;è‹¥ç­‰äºQï¼Œåˆ™è·³è½¬åˆ°ending</span><br><span class="line">    je ending</span><br><span class="line">;ä½å…«ä½å­˜å…¥bl</span><br><span class="line">    mov bl, al</span><br><span class="line">;é«˜å…«ä½å­˜å…¥bh</span><br><span class="line">    mov bh, al</span><br><span class="line">    ;å›è½¦+æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 9</span><br><span class="line">    mov ah, 2</span><br><span class="line">    and bl, 0F0h  ;å–blé«˜å››ä½</span><br><span class="line">    mov cl, 4  </span><br><span class="line">;å³ç§»4ä½,é«˜4ä½å˜ä¸ºä½4ä½</span><br><span class="line">    shr bl, cl</span><br><span class="line">    cmp bl, 9</span><br><span class="line">    ja alph1</span><br><span class="line">;å¤„ç†æ•°å­—</span><br><span class="line">numb1:</span><br><span class="line">;è½¬æ¢ä¸ºasciiç </span><br><span class="line">    add bl, &#x27;0&#x27;</span><br><span class="line">    mov dl, bl</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h ;æ‰§è¡Œ2å·ä¸­æ–­,æ˜¾ç¤ºè¾“å‡º</span><br><span class="line">    jmp low4</span><br><span class="line">alph1:</span><br><span class="line">;è½¬æ¢ä¸ºasciiç </span><br><span class="line">    add bl, 37h</span><br><span class="line">    mov dl, bl</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">low4:</span><br><span class="line">    and bh, 0Fh  ;å–ä½å››ä½</span><br><span class="line">    cmp bh, 9</span><br><span class="line">    ja alph2</span><br><span class="line">numb2:</span><br><span class="line">    add bh, &#x27;0&#x27;  ;åŠ 0</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp cmpq</span><br><span class="line">alph2:</span><br><span class="line">    add bh, 37h ;åŠ A</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h </span><br><span class="line">    jmp cmpq</span><br><span class="line">ending:</span><br><span class="line">    ;å›è½¦+æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    ;ç»ˆæ­¢ç¨‹åº</span><br><span class="line">    mov ax, 4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœ">è¿è¡Œç»“æœ</h4><p><img src="https://pb01.s3.bitiful.net/33.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="/2023/12/01/2023-12-1-DDD%E6%9E%B6%E6%9E%84-1/"/>
      <url>/2023/12/01/2023-12-1-DDD%E6%9E%B6%E6%9E%84-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="DDDæ˜¯ä»€ä¹ˆï¼Ÿ">DDDæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>DDD æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Designï¼‰çš„ç¼©å†™ï¼Œè¿™æ˜¯ä¸€ç§ä¸»è¦è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œç”± Eric Evans åœ¨ä»–çš„ä¹¦ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šè½¯ä»¶æ ¸å¿ƒå¤æ‚æ€§åº”å¯¹ä¹‹é“ã€‹ï¼ˆDomain-Driven Design: Tackling Complexity in the Heart of Softwareï¼‰ä¸­é¦–æ¬¡æå‡ºã€‚</p><p>DDD ä¸»è¦å…³æ³¨äºåˆ›å»ºä¸ä¸šåŠ¡é¢†åŸŸç´§å¯†ç›¸å…³çš„è½¯ä»¶æ¨¡å‹ï¼Œä»¥ç¡®ä¿è½¯ä»¶èƒ½å¤Ÿå‡†ç¡®åœ°è§£å†³å®é™…é—®é¢˜ã€‚</p><p>DDD çš„æ ¸å¿ƒç†å¿µåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><p><strong>é¢†åŸŸæ¨¡å‹ï¼ˆDomain Modelï¼‰ï¼š</strong><br>é¢†åŸŸæ¨¡å‹æ˜¯å¯¹ç‰¹å®šä¸šåŠ¡é¢†åŸŸçŸ¥è¯†çš„ç²¾ç¡®è¡¨è¿°ï¼Œå®ƒåŒ…æ‹¬ä¸šåŠ¡ä¸­çš„å®ä½“ï¼ˆEntitiesï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰ã€æœåŠ¡ï¼ˆServicesï¼‰ã€èšåˆï¼ˆAggregatesï¼‰ã€èšåˆæ ¹ï¼ˆAggregate Rootsï¼‰ç­‰æ¦‚å¿µã€‚é¢†åŸŸæ¨¡å‹æ˜¯DDDçš„æ ¸å¿ƒï¼Œå®ƒåæ˜ äº†ä¸šåŠ¡ä¸“å®¶çš„è¯­è¨€å’Œå†³ç­–ã€‚</p></li><li><p><strong>ç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰ï¼š</strong><br>ç»Ÿä¸€è¯­è¨€æ˜¯å¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶å…±åŒä½¿ç”¨çš„è¯­è¨€ï¼Œå®ƒåœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä¿æŒä¸€è‡´ã€‚ç»Ÿä¸€è¯­è¨€ç¡®ä¿æ‰€æœ‰äººéƒ½å¯¹ä¸šåŠ¡æ¦‚å¿µæœ‰ç€ç›¸åŒçš„ç†è§£ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬å’Œè¯¯è§£ã€‚</p></li><li><p><strong>é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰ï¼š</strong><br>é™ç•Œä¸Šä¸‹æ–‡æ˜¯æ˜ç¡®ç•Œå®šçš„ç³»ç»Ÿè¾¹ç•Œï¼Œåœ¨è¿™ä¸ªè¾¹ç•Œå†…éƒ¨æœ‰ä¸€å¥—ç»Ÿä¸€çš„æ¨¡å‹å’Œè¯­è¨€ã€‚ä¸åŒçš„é™ç•Œä¸Šä¸‹æ–‡ä¹‹é—´å¯èƒ½æœ‰ä¸åŒçš„æ¨¡å‹ï¼Œå®ƒä»¬é€šè¿‡ä¸Šä¸‹æ–‡æ˜ å°„ï¼ˆContext Mappingï¼‰æ¥è¿›è¡Œäº¤äº’å’Œé›†æˆã€‚</p></li><li><p><strong>èšåˆï¼ˆAggregateï¼‰ï¼š</strong><br>èšåˆæ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬è¢«è§†ä¸ºæ•°æ®ä¿®æ”¹çš„å•å…ƒã€‚æ¯ä¸ªèšåˆéƒ½æœ‰ä¸€ä¸ªèšåˆæ ¹ï¼Œå®ƒæ˜¯å¤–éƒ¨å¯¹è±¡ä¸èšåˆå†…éƒ¨å¯¹è±¡äº¤äº’çš„å”¯ä¸€å…¥å£ã€‚</p></li><li><p><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Servicesï¼‰ï¼š</strong><br>å½“æŸäº›è¡Œä¸ºä¸è‡ªç„¶å±äºä»»ä½•å®ä½“æˆ–å€¼å¯¹è±¡æ—¶ï¼Œè¿™äº›è¡Œä¸ºå¯ä»¥è¢«å®šä¹‰ä¸ºé¢†åŸŸæœåŠ¡ã€‚é¢†åŸŸæœåŠ¡é€šå¸¸è¡¨ç¤ºé¢†åŸŸä¸­çš„ä¸€äº›æ“ä½œæˆ–ä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p><strong>åº”ç”¨æœåŠ¡ï¼ˆApplication Servicesï¼‰ï¼š</strong><br>åº”ç”¨æœåŠ¡æ˜¯è½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬åè°ƒé¢†åŸŸå¯¹è±¡æ¥æ‰§è¡Œä»»åŠ¡ã€‚å®ƒä»¬è´Ÿè´£åº”ç”¨ç¨‹åºçš„å·¥ä½œæµç¨‹ï¼Œä½†ä¸åŒ…å«ä¸šåŠ¡è§„åˆ™æˆ–çŸ¥è¯†ã€‚</p></li><li><p><strong>åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰ï¼š</strong><br>åŸºç¡€è®¾æ–½åŒ…æ‹¬ä¸ºé¢†åŸŸæ¨¡å‹æä¾›æŒä¹…åŒ–æœºåˆ¶ï¼ˆå¦‚æ•°æ®åº“ï¼‰ã€æ¶ˆæ¯ä¼ é€’ã€åº”ç”¨ç¨‹åºçš„é…ç½®ç­‰æŠ€æœ¯ç»„ä»¶ã€‚</p></li><li><p><strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰ï¼š</strong><br>é¢†åŸŸäº‹ä»¶æ˜¯é¢†åŸŸä¸­å‘ç”Ÿçš„æœ‰æ„ä¹‰çš„ä¸šåŠ¡äº‹ä»¶ï¼Œå®ƒä»¬å¯ä»¥è§¦å‘å…¶ä»–å­ç³»ç»Ÿçš„ååº”æˆ–æµç¨‹ã€‚</p></li></ol><p>DDD çš„ç›®æ ‡æ˜¯é€šè¿‡å°†è½¯ä»¶çš„å…³æ³¨ç‚¹é›†ä¸­åœ¨<strong>æ ¸å¿ƒé¢†åŸŸ</strong>ä¸Šï¼Œå¹¶é€šè¿‡ä¸°å¯Œçš„é¢†åŸŸæ¨¡å‹æ¥ç®¡ç†å¤æ‚æ€§ï¼Œä»è€Œæé«˜è½¯ä»¶çš„<strong>è´¨é‡å’Œç»´æŠ¤æ€§</strong>ã€‚DDD å¼ºè°ƒä¸ä¸šåŠ¡ä¸“å®¶çš„ç´§å¯†åˆä½œï¼Œä»¥ç¡®ä¿è½¯ä»¶è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿå‡†ç¡®åæ˜ <strong>ä¸šåŠ¡éœ€æ±‚</strong>ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè½¯ä»¶å¼€å‘å›¢é˜Ÿå¯ä»¥åˆ›å»ºå‡ºæ›´åŠ çµæ´»ã€å¯æ‰©å±•ä¸”ä¸ä¸šåŠ¡ç´§å¯†ç»“åˆçš„ç³»ç»Ÿã€‚</p><p>å…¶ä¸­DDDæ‰€æåˆ°çš„è½¯ä»¶è®¾è®¡æ–¹æ³•æ¶µç›–äº†ï¼šèŒƒå¼ã€æ¨¡å‹ã€æ¡†æ¶ã€æ–¹æ³•è®ºï¼Œä¸»è¦æ´»åŠ¨åŒ…æ‹¬å»ºæ¨¡ã€æµ‹è¯•ã€å·¥ç¨‹ã€å¼€å‘ã€éƒ¨ç½²ã€ç»´æŠ¤ã€‚</p><p>è½¯ä»¶è®¾è®¡æ–¹æ³•æ˜¯æŒ‡ä¸€ç³»åˆ—ç”¨äºæŒ‡å¯¼è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„åŸåˆ™ã€æ¦‚å¿µå’Œå®è·µã€‚è¿™äº›æ–¹æ³•é€šå¸¸åŒ…æ‹¬èŒƒå¼ã€æ¨¡å‹ã€æ¡†æ¶å’Œæ–¹æ³•è®ºã€‚ä¸‹é¢æˆ‘å°†åˆ†åˆ«ä»‹ç»è¿™äº›æ¦‚å¿µä»¥åŠè½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨ã€‚</p><h4 id="èŒƒå¼-Paradigms">èŒƒå¼ (Paradigms)</h4><p>èŒƒå¼æ˜¯æŒ‡è½¯ä»¶è®¾è®¡å’Œå¼€å‘çš„åŸºæœ¬é£æ ¼æˆ–å“²å­¦ã€‚å®ƒé€šå¸¸å®šä¹‰äº†ç¼–ç¨‹çš„åŸºæœ¬åŸåˆ™å’Œæ¨¡å¼ã€‚å¸¸è§çš„è½¯ä»¶è®¾è®¡èŒƒå¼åŒ…æ‹¬ï¼š</p><ul><li><strong>ç»“æ„åŒ–ç¼–ç¨‹</strong>ï¼šå¼ºè°ƒç¨‹åºç»“æ„çš„é‡è¦æ€§ï¼Œä½¿ç”¨é¡ºåºã€é€‰æ‹©å’Œå¾ªç¯æ§åˆ¶ç»“æ„ã€‚</li><li><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP)</strong>ï¼šåŸºäºå¯¹è±¡çš„æ¦‚å¿µï¼Œå°†æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ–¹æ³•å°è£…åœ¨ä¸€èµ·ã€‚</li><li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šå°†è®¡ç®—è§†ä¸ºæ•°å­¦å‡½æ•°çš„è¯„ä¼°ï¼Œé¿å…çŠ¶æ€æ”¹å˜å’Œå¯å˜æ•°æ®ã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹</strong>ï¼šä»¥äº‹ä»¶ä¸ºä¸­å¿ƒï¼Œå“åº”ç”¨æˆ·æ“ä½œã€æ¶ˆæ¯æˆ–å…¶ä»–ç³»ç»Ÿäº‹ä»¶ã€‚</li></ul><h4 id="æ¨¡å‹-Models">æ¨¡å‹ (Models)</h4><p>æ¨¡å‹æ˜¯å¯¹è½¯ä»¶ç³»ç»Ÿçš„æŠ½è±¡è¡¨ç¤ºï¼Œç”¨äºå¸®åŠ©ç†è§£ã€è®¾è®¡å’Œæµ‹è¯•ç³»ç»Ÿã€‚å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å‹åŒ…æ‹¬ï¼š</p><ul><li><strong>UML (ç»Ÿä¸€å»ºæ¨¡è¯­è¨€)</strong>ï¼šä¸€å¥—å›¾å½¢åŒ–çš„å»ºæ¨¡è¯­è¨€ï¼Œç”¨äºæè¿°ã€è®¾è®¡å’Œæ–‡æ¡£åŒ–è½¯ä»¶é¡¹ç›®ã€‚</li><li><strong>ERæ¨¡å‹ (å®ä½“-å…³ç³»æ¨¡å‹)</strong>ï¼šç”¨äºæ•°æ®åº“è®¾è®¡ï¼Œæè¿°æ•°æ®çš„å®ä½“åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚</li><li><strong>çŠ¶æ€æœºæ¨¡å‹</strong>ï¼šæè¿°ç³»ç»Ÿå¯èƒ½çš„çŠ¶æ€ã€äº‹ä»¶å’Œåœ¨è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶çš„è½¬æ¢ã€‚</li></ul><h4 id="æ¡†æ¶-Frameworks">æ¡†æ¶ (Frameworks)</h4><p>æ¡†æ¶æ˜¯ä¸€å¥—é¢„å…ˆåˆ¶å®šçš„ä»£ç åº“å’Œç»„ä»¶ï¼Œç”¨äºæä¾›è½¯ä»¶å¼€å‘çš„éª¨æ¶ã€‚æ¡†æ¶é€šå¸¸å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„ç»“æ„ï¼Œæä¾›äº†ä¸€ç»„é€šç”¨çš„åŠŸèƒ½å’Œæ¨¡å¼ï¼Œä»¥ä¾¿å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå®ç°ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>Spring Framework</strong>ï¼šä¸€ä¸ªç”¨äºJavaåº”ç”¨ç¨‹åºçš„å…¨é¢ç¼–ç¨‹å’Œé…ç½®æ¨¡å‹ã€‚</li><li><strong>Ruby on Rails</strong>ï¼šä¸€ä¸ªç”¨äºå¿«é€Ÿå¼€å‘Webåº”ç”¨ç¨‹åºçš„Rubyæ¡†æ¶ã€‚</li><li><strong>Django</strong>ï¼šä¸€ä¸ªé«˜çº§Python Webæ¡†æ¶ï¼Œé¼“åŠ±å¿«é€Ÿå¼€å‘å’Œå¹²å‡€ã€å®ç”¨çš„è®¾è®¡ã€‚</li></ul><h4 id="æ–¹æ³•è®º-Methodologies">æ–¹æ³•è®º (Methodologies)</h4><p>æ–¹æ³•è®ºæ˜¯æŒ‡ä¸€å¥—æŒ‡å¯¼è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„è§„åˆ™å’Œå®è·µã€‚å®ƒåŒ…æ‹¬é¡¹ç›®ç®¡ç†ã€å¼€å‘æµç¨‹ã€å›¢é˜Ÿåä½œç­‰æ–¹é¢ã€‚å¸¸è§çš„è½¯ä»¶å¼€å‘æ–¹æ³•è®ºæœ‰ï¼š</p><ul><li><strong>æ•æ·å¼€å‘</strong>ï¼šä¸€ç§è¿­ä»£å’Œå¢é‡çš„å¼€å‘æ–¹æ³•ï¼Œå¼ºè°ƒçµæ´»æ€§å’Œå®¢æˆ·åˆä½œã€‚</li><li><strong>Scrum</strong>ï¼šä¸€ç§æ•æ·å¼€å‘æ¡†æ¶ï¼Œç”¨äºç®¡ç†å¤æ‚çš„è½¯ä»¶å’Œäº§å“å¼€å‘ã€‚</li><li><strong>ç€‘å¸ƒæ¨¡å‹</strong>ï¼šä¸€ç§çº¿æ€§é¡ºåºçš„å¼€å‘æ–¹æ³•ï¼Œå°†é¡¹ç›®åˆ†ä¸ºä¸åŒé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</li></ul><h4 id="ä¸»è¦æ´»åŠ¨">ä¸»è¦æ´»åŠ¨</h4><p>è½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨åŒ…æ‹¬ï¼š</p><ul><li><strong>å»ºæ¨¡ (Modeling)</strong> ï¼šé€šè¿‡åˆ›å»ºæ¨¡å‹æ¥è¡¨ç¤ºç³»ç»Ÿçš„ä¸åŒæ–¹é¢ï¼Œå¦‚ä½¿ç”¨UMLå›¾æ¥æè¿°ç³»ç»Ÿæ¶æ„ã€‚</li><li><strong>æµ‹è¯• (Testing)</strong> ï¼šç¡®ä¿è½¯ä»¶çš„è´¨é‡ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•å’ŒéªŒæ”¶æµ‹è¯•ã€‚</li><li><strong>å·¥ç¨‹ (Engineering)</strong> ï¼šåº”ç”¨å·¥ç¨‹åŸåˆ™å’Œå®è·µæ¥æ„å»ºè½¯ä»¶ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€å®ç°å’Œæµ‹è¯•ã€‚</li><li><strong>å¼€å‘ (Development)</strong> ï¼šç¼–å†™ä»£ç å’Œå®ç°åŠŸèƒ½ï¼Œå°†è®¾è®¡è½¬åŒ–ä¸ºå®é™…çš„è½¯ä»¶äº§å“ã€‚</li><li><strong>éƒ¨ç½² (Deployment)</strong> ï¼šå°†è½¯ä»¶å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä½¿å…¶å¯ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚</li><li><strong>ç»´æŠ¤ (Maintenance)</strong> ï¼šåœ¨è½¯ä»¶å‘å¸ƒåå¯¹å…¶è¿›è¡Œæ›´æ–°å’Œæ”¹è¿›ï¼Œä¿®å¤ç¼ºé™·ï¼Œæå‡æ€§èƒ½å’Œé€‚åº”æ€§ã€‚</li></ul><p>æ¯ä¸ªæ´»åŠ¨éƒ½æ˜¯è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ç›¸äº’ä¾èµ–ï¼Œå…±åŒç¡®ä¿è½¯ä»¶é¡¹ç›®çš„æˆåŠŸã€‚</p><h4 id="ç»´æŠ¤-Maintenance">ç»´æŠ¤ (Maintenance)</h4><p>è½¯ä»¶ç»´æŠ¤æ˜¯åœ¨è½¯ä»¶å‘å¸ƒåè¿›è¡Œçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li><strong>çº é”™</strong>ï¼šä¿®å¤è½¯ä»¶ä¸­å‘ç°çš„ç¼ºé™·æˆ–é”™è¯¯ã€‚</li><li><strong>é€‚åº”æ€§ç»´æŠ¤</strong>ï¼šä¿®æ”¹è½¯ä»¶ä»¥é€‚åº”ç¯å¢ƒçš„å˜åŒ–ï¼Œå¦‚æ“ä½œç³»ç»Ÿå‡çº§ã€ç¡¬ä»¶æ›´æ¢ç­‰ã€‚</li><li><strong>å®Œå–„æ€§ç»´æŠ¤</strong>ï¼šå¢åŠ æ–°åŠŸèƒ½æˆ–æå‡æ€§èƒ½ï¼Œä»¥æ»¡è¶³ç”¨æˆ·æ–°çš„æˆ–å˜åŒ–çš„éœ€æ±‚ã€‚</li><li><strong>é¢„é˜²æ€§ç»´æŠ¤</strong>ï¼šæ”¹è¿›è½¯ä»¶å†…éƒ¨ç»“æ„ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„é—®é¢˜å‘ç”Ÿï¼Œæé«˜è½¯ä»¶çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul><p>è½¯ä»¶ç»´æŠ¤æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œå®ƒç¡®ä¿è½¯ä»¶èƒ½å¤Ÿé•¿æœŸæœ‰æ•ˆåœ°æœåŠ¡äºç”¨æˆ·ã€‚</p><h4 id="æ€»ç»“">æ€»ç»“</h4><p>è½¯ä»¶è®¾è®¡æ–¹æ³•æ˜¯ä¸€ä¸ªå¤æ‚çš„é¢†åŸŸï¼Œæ¶‰åŠå¤šç§æ¦‚å¿µå’Œå®è·µã€‚èŒƒå¼æä¾›äº†è®¾è®¡å“²å­¦ï¼Œæ¨¡å‹å¸®åŠ©æˆ‘ä»¬ç†è§£å’ŒæŠ½è±¡ç³»ç»Ÿï¼Œæ¡†æ¶ä¸ºå¼€å‘æä¾›äº†åŸºç¡€ç»“æ„ï¼Œæ–¹æ³•è®ºæŒ‡å¯¼æ•´ä¸ªå¼€å‘è¿‡ç¨‹ã€‚è½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨â€”â€”å»ºæ¨¡ã€æµ‹è¯•ã€å·¥ç¨‹ã€å¼€å‘ã€éƒ¨ç½²å’Œç»´æŠ¤â€”â€”æ˜¯ç¡®ä¿è½¯ä»¶é¡¹ç›®æˆåŠŸçš„å…³é”®æ­¥éª¤ã€‚æ¯ä¸ªæ´»åŠ¨éƒ½éœ€è¦ä¸“ä¸šçŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œä»¥åŠå¯¹åº”çš„å·¥å…·å’ŒæŠ€æœ¯çš„æ”¯æŒã€‚é€šè¿‡è¿™äº›æ´»åŠ¨çš„ååŒå·¥ä½œï¼Œè½¯ä»¶å·¥ç¨‹å¸ˆèƒ½å¤Ÿäº¤ä»˜é«˜è´¨é‡ã€æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„è½¯ä»¶äº§å“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³no main manifest attribute, in app.jar(Docker)</title>
      <link href="/2023/11/25/Docker(3)/"/>
      <url>/2023/11/25/Docker(3)/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è§£å†³no-main-manifest-attribute-in-app-jar">è§£å†³no main manifest attribute, in app.jar</h3><p><strong>ç¯å¢ƒ:SpringBoot2.6.13+java8</strong></p><ul><li><strong>é‡ç‚¹</strong>:pom.xmlæ–‡ä»¶æ˜¯IDEAè‡ªåŠ¨é…çš„</li></ul><p>æˆ‘åœ¨å°†ä¸€ä¸ªSpringBootç¨‹åºæ‰“åŒ…æˆé•œåƒéƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸Š,ç„¶åæ‰§è¡Œrunå‘½ä»¤å¯åŠ¨å®¹å™¨:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm springboot-test:1.0</span><br></pre></td></tr></table></figure><p>springboot-test:1.0æ˜¯æˆ‘çš„é•œåƒ</p><p>å‡ºç°æŠ¥é”™:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no main manifest attribute, in app.jar</span><br></pre></td></tr></table></figure><p>æˆ‘æ’æŸ¥å‡ºæ¥é—®é¢˜å°±åœ¨pom.xmlæ–‡ä»¶ä¸­æˆ‘ç”»çº¢çº¿çš„è¿™ä¸€å¥<br><img src="https://pb01.s3.bitiful.net/30.png" alt="avatar"></p><p>æ”¹ä¸ºä¸‹é¢è¿™å¼ å›¾è¿™æ ·å°±å¥½äº†<br><img src="https://pb01.s3.bitiful.net/31.png" alt="avatar"></p><p>å®Œæ•´çš„pom.xmlæ–‡ä»¶å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.6.13<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.dockertest.DockerTestApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">layout</span>&gt;</span>JAR<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ</title>
      <link href="/2023/11/25/Docker(2)/"/>
      <url>/2023/11/25/Docker(2)/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ">è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ</h3><p>å®é™…ä¸Šæ‰€æœ‰å¸¸ç”¨çš„åº”ç”¨ç¨‹åºéƒ½æœ‰å¯¹åº”çš„é•œåƒï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½è¿™äº›é•œåƒç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œè€Œä¸éœ€è¦è‡ªå·±å»æ‰‹åŠ¨å®‰è£…ï¼Œé¡¶å¤šéœ€è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„é…ç½®ã€‚ä½†æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜åœ¨é‡åˆ°å°ä¼—é¡¹ç›®çš„æ—¶å€™ï¼Œå¯èƒ½æ²¡æœ‰æä¾›é•œåƒï¼Œè¿™æ—¶å°±è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®‰è£…ï¼Œæ¥ç€æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•æ„å»ºæˆ‘ä»¬è‡ªå·±çš„Dockeré•œåƒã€‚æ„å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨commitå‘½ä»¤æ¥å®Œæˆï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä½¿ç”¨Dockerfileæ¥å®Œæˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦åœ¨Ubuntuçš„baseé•œåƒä¸­å®‰è£…Javaç¯å¢ƒï¼Œå¹¶å°†å…¶æ‰“åŒ…ä¸ºæ–°çš„é•œåƒï¼ˆè¿™ä¸ªæ–°çš„é•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Java8ç¯å¢ƒçš„Ubuntuç³»ç»Ÿé•œåƒï¼‰</p><h4 id="ç¬¬ä¸€ç§-commitå‘½ä»¤-ä¸æ¨è">ç¬¬ä¸€ç§:commitå‘½ä»¤(ä¸æ¨è)</h4><p>æ‹‰å–Ubuntué•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/16.png" alt="avatar"><br>æ¥ç€å¯åŠ¨Ubuntuï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it ubuntu</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/17.png" alt="avatar"></p><p>æ›´æ–°apt</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/18.png" alt="avatar"><br>aptå®‰è£…javaç¯å¢ƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure><p>å®‰è£…å®ŒæˆåæŸ¥çœ‹ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/19.png" alt="avatar"></p><p>é€€å‡ºUbuntuåˆ°Dockerç¯å¢ƒä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/20.png" alt="avatar"><br>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/21.png" alt="avatar"></p><p>ä½¿ç”¨commitå‘½ä»¤å°†å®¹å™¨æ‰“åŒ…ä¸ºæ–°çš„é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit å®¹å™¨åç§°/ID æ–°çš„é•œåƒåç§°</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/22.png" alt="avatar"></p><p>æŸ¥çœ‹é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/23.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é•œåƒå·²ç»è¢«æ‰“åŒ…å¥½äº†</p><p>è¿™ä¸ªæ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å°±æ˜¯å¦‚æœè¿™ä¸ªé•œåƒä¸æ˜¯æˆ‘ä»¬æ„å»ºçš„æˆ–è€…æ„å»ºå®Œè¿‡äº†ä¸€æ®µæ—¶é—´,æˆ‘ä»¬å°±ä¸çŸ¥é“å…·ä½“è¿™ä¸ªé•œåƒçš„æ„å»ºè¿‡ç¨‹,ä¹Ÿå°±æ˜¯è¯´<strong>æˆ‘ä»¬ä¸èƒ½ç¡®ä¿è¿™ä¸ªé•œåƒç™¾åˆ†ç™¾å®‰å…¨</strong>,è¿™å°±å¼•å‡ºäº†ä¸‹é¢è¿™ç§æ„å»ºæ–¹å¼</p><h4 id="ç¬¬äºŒç§-Dockerfile-æ¨è">ç¬¬äºŒç§:Dockerfile(æ¨è)</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªåä¸ºDockerfileçš„æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch Dockerfile</span><br></pre></td></tr></table></figure><p>vimæ‰“å¼€Dockerfileè¿›è¡Œç¼–è¾‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi Dockerfile</span><br></pre></td></tr></table></figure><p><img src="https://pic-bed-1c9.pages.dev/img/24.png" alt="avatar"></p><p>Dockerfileå†…éƒ¨éœ€è¦æˆ‘ä»¬ç¼–å†™å¤šç§æŒ‡ä»¤æ¥å‘Šè¯‰Dockeræˆ‘ä»¬çš„é•œåƒçš„ç›¸å…³ä¿¡æ¯</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨FROMæŒ‡ä»¤æ¥é€‰æ‹©å½“å‰é•œåƒçš„åŸºç¡€é•œåƒï¼ˆå¿…é¡»ä»¥è¿™ä¸ªæŒ‡ä»¤å¼€å§‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ubuntuä½œä¸ºåŸºç¡€é•œåƒå³å¯ï¼Œå½“ç„¶å¦‚æœä¸éœ€è¦ä»»ä½•åŸºç¡€é•œåƒçš„è¯ï¼Œç›´æ¥ä½¿ç”¨scratchè¡¨ç¤ºä»é›¶å¼€å§‹æ„å»º:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br></pre></td></tr></table></figure><p>åœ¨å®¹å™¨ä¸­è¿è¡ŒRUNå‘½ä»¤æ¥å®‰è£…Javaç¯å¢ƒäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y openjdk-8-jdk</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/25.png" alt="avatar"><br>æ¯æ¡æŒ‡ä»¤æ‰§è¡Œä¹‹åï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒå±‚</p><p>é€€å‡ºå¹¶ä¿å­˜,è¿è¡Œbuildå‘½ä»¤æ„å»ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t é•œåƒåç§° æ„å»ºç›®å½•</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/26.png" alt="avatar"><br>æ‰§è¡Œåï¼ŒDockerä¼šåœ¨æ„å»ºç›®å½•ä¸­å¯»æ‰¾Dockerfileæ–‡ä»¶ï¼Œç„¶åå¼€å§‹ä¾æ¬¡æ‰§è¡ŒDockerfileä¸­çš„æŒ‡ä»¤ï¼š</p><p>â€“tag, -t: é•œåƒçš„åå­—åŠæ ‡ç­¾ï¼Œé€šå¸¸ name:tag æˆ–è€… name æ ¼å¼ï¼›å¯ä»¥åœ¨ä¸€æ¬¡æ„å»ºä¸­ä¸ºä¸€ä¸ªé•œåƒè®¾ç½®å¤šä¸ªæ ‡ç­¾ã€‚æ„å»ºç›®å½•çš„.ä»£è¡¨å½“å‰ç›®å½•</p><p>æ„å»ºå®ŒæˆåæŸ¥çœ‹æœ¬åœ°é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/27.png" alt="avatar"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨historyå‘½ä»¤æ¥æŸ¥çœ‹æ„å»ºå†å²</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history ubuntu-java2:latest</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/28.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/29.png" alt="avatar"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥æˆ‘ä»¬æ„å»ºçš„å‘½ä»¤éƒ½æˆä¸ºäº†ä¸€ä¸ªé•œåƒ,æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¿™ä¸ªé•œåƒæ˜¯å¦‚ä½•è¢«æ„å»ºçš„,è€Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼æ„å»ºçš„é•œåƒæ˜¯çœ‹ä¸åˆ°å…·ä½“æ„å»ºå‘½ä»¤çš„</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤(ä¼˜é›…)</title>
      <link href="/2023/11/23/Docker(1)/"/>
      <url>/2023/11/23/Docker(1)/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤-ä¼˜é›…">Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤(ä¼˜é›…)</h3><hr><p><strong>ç¯å¢ƒ:Ubuntu 22.04.3 LTS</strong></p><hr><h4 id="Dockerå®‰è£…">Dockerå®‰è£…</h4><p>é¦–å…ˆå®‰è£…ä¸€äº›å·¥å…·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure><p>æ¥ç€å®‰è£…å®˜æ–¹çš„GPG keyï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/apt/keyrings</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br></pre></td></tr></table></figure><p>æœ€åå°†Dockerçš„åº“æ·»åŠ åˆ°aptèµ„æºåˆ—è¡¨ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ›´æ–°ä¸€æ¬¡aptï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><p>æœ€åå®‰è£…Docker CEç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker-ce</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker &lt;ç”¨æˆ·å&gt;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½åï¼Œæˆ‘ä»¬å…ˆé€€å‡ºSSHç»ˆç«¯ï¼Œç„¶åé‡æ–°è¿æ¥å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p><h4 id="é•œåƒç›¸å…³æ“ä½œ">é•œåƒç›¸å…³æ“ä½œ</h4><p>ä¸‹è½½é•œåƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull repository:tag</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šä¸€ä¸ªé•œåƒçš„åç§°æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€ä¸ªæ˜¯repositoryï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯tagï¼Œä¸€èˆ¬æƒ…å†µä¸‹çº¦å®šrepositoryå°±æ˜¯é•œåƒåç§°ï¼Œtagä½œä¸ºç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºlatestï¼Œè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬ã€‚</p><p>é•œåƒä¸‹è½½ä¹‹åä¼šå­˜æ”¾åœ¨æœ¬åœ°ï¼Œè¦å¯åŠ¨è¿™ä¸ªé•œåƒçš„å®¹å™¨ï¼Œå®é™…ä¸Šå°±åƒæˆ‘ä»¬ä¹‹å‰é‚£æ ·ï¼Œè¾“å…¥runå‘½ä»¤å°±å¯ä»¥äº†(ä»¥hello-worldé•œåƒä¸ºä¾‹)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åï¼Œä¼šä½¿ç”¨å½“å‰é•œåƒè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥pså‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å®¹å™¨çš„å®¹å™¨åˆ—è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>æ³¨æ„åé¢è¦åŠ ä¸€ä¸ª-aè¡¨ç¤ºæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆå…¶ä»–é€‰é¡¹å¯ä»¥ä½¿ç”¨-hæŸ¥çœ‹ï¼‰ï¼Œå¦‚æœä¸åŠ çš„è¯ï¼Œåªä¼šæ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</p><p>å¯ä»¥çœ‹åˆ°å®¹å™¨åˆ—è¡¨ä¸­æœ‰æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„hello-worldï¼ˆæ³¨æ„åŒä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼‰ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªéšæœºç”Ÿæˆçš„å®¹å™¨IDå†™åœ¨æœ€å‰é¢ï¼Œåé¢æ˜¯å®¹å™¨çš„åˆ›å»ºæ—¶é—´ä»¥åŠå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œæœ€åä¸€åˆ—æ˜¯å®¹å™¨çš„åç§°ï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œåç§°å¯ä»¥ç”±æˆ‘ä»¬æŒ‡å®šä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆï¼Œè¿™é‡Œå°±æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>å½“ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ªå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šåç§°å¯åŠ¨ï¼Œåœ¨ä½¿ç”¨runå‘½ä»¤æ—¶ï¼Œæ·»åŠ â€“nameå‚æ•°å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=åç§° hello-world</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¼€å¯å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p><strong>å®¹å™¨åç§°å¯ä»¥ä½¿ç”¨Tabé”®è‡ªåŠ¨è¡¥å…¨,IDå¯ä»¥åªè¾“å…¥å‰ä¸‰ä½</strong>(ä¸€èˆ¬ä¸ä¼šé‡å¤,é™¤éå®¹å™¨éå¸¸å¤š,è¿™æ—¶å°±å¾—ä¿è¯è¾“å…¥çš„IDçš„å‰nä½å¯ä»¥å”¯ä¸€æ ‡è¯†è¿™ä¸ªID)</p><p>å¦‚æœæƒ³è¦åœæ­¢å®¹å™¨ç›´æ¥è¾“å…¥stopå‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>æˆ–æ˜¯é‡å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</h4><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨å®¹å™¨äº†ï¼Œé‚£ä¹ˆå¯ä»¥å°†å®¹å™¨åˆ é™¤ï¼Œä½†æ˜¯æ³¨æ„åªæœ‰å®¹å™¨å¤„äºéè¿è¡ŒçŠ¶æ€æ—¶æ‰å¯ä»¥åˆ é™¤ï¼š</p><p>å…ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ é™¤çš„å®¹å™¨ä»åœ¨è¿è¡Œ,å…ˆå°†å…¶åœæ­¢:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>æœ€ååˆ é™¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦å¼ºåˆ¶åˆ é™¤å®¹å™¨,åŠ ä¸Š-få°±è¡Œ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>æ— è®ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œä¸­æˆ–è€…å·²åœæ­¢ï¼Œéƒ½å¯è¢«å¼ºåˆ¶åˆ é™¤ï¼</p><h4 id="åˆ é™¤é•œåƒ">åˆ é™¤é•œåƒ</h4><p>å…ˆæŸ¥çœ‹Dockerä¸­çš„é•œåƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><strong>æƒ³è¦åˆ é™¤é•œåƒå°±å¾—å…ˆåˆ é™¤æ­¤é•œåƒçš„å…¨éƒ¨å®¹å™¨</strong></p><p><strong>åªæœ‰å®¹å™¨å¤„äºéè¿è¡ŒçŠ¶æ€æ—¶æ‰å¯ä»¥åˆ é™¤</strong></p><p>å…ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ é™¤çš„å®¹å™¨ä»åœ¨è¿è¡Œ,å…ˆå°†å…¶åœæ­¢:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>åˆ é™¤å®¹å™¨:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><p>åˆ é™¤é•œåƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi é•œåƒID</span><br></pre></td></tr></table></figure><p><strong>é•œåƒIDä¹Ÿæ˜¯è¾“å…¥å‰ä¸‰ä½å°±å¥½</strong></p><p>å¦‚æœæƒ³è¦å¼ºåˆ¶åˆ é™¤é•œåƒ,åŠ ä¸Š-få°±è¡Œ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f é•œåƒID</span><br></pre></td></tr></table></figure><p>é•œåƒä¸­çš„å®¹å™¨çŠ¶æ€ä¸ºå·²åœæ­¢æˆ–å·²åˆ é™¤çš„æ‰èƒ½è¢«å¼ºåˆ¶åˆ é™¤ï¼ŒåŒæ—¶å¯¹åº”çš„å®¹å™¨ä¹Ÿä¼šè¢«åˆ é™¤ã€‚è‹¥å®¹å™¨è¿˜åœ¨è¿è¡Œä¸­ï¼Œåˆ é™¤é•œåƒä¼šæŠ¥é”™ï¼</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWTè¯¦è§£</title>
      <link href="/2023/11/18/JWT%E8%AF%A6%E8%A7%A3/"/>
      <url>/2023/11/18/JWT%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="JWTè¯¦è§£">JWTè¯¦è§£</h3><p><a href="https://jwt.io/introduction" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JWTå®˜ç½‘</a></p><p><img src="https://pb01.s3.bitiful.net/13.png" alt="avatar"></p><h4 id="ä»€ä¹ˆæ˜¯JWT">ä»€ä¹ˆæ˜¯JWT</h4><p>JWTçš„å…¨ç§°æ˜¯Json Web Tokenã€‚æ˜¯åŸºäºRFC 7519å¼€æ”¾æ ‡å‡†çš„ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”ç‹¬ç«‹çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼<strong>å®‰å…¨åœ°</strong>ä¼ è¾“ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯å¯ä»¥ç”¨ä½œéªŒè¯å’Œç›¸äº’ä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯ç»è¿‡æ•°å­—ç­¾åçš„ã€‚JWT å¯ä»¥ä½¿ç”¨å¯†é’¥ï¼ˆä½¿ç”¨ HMAC ç®—æ³•ï¼‰æˆ–ä½¿ç”¨ RSA æˆ– ECDSA çš„å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åã€‚</p><p>JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆ:<strong>Headerï¼ˆæ ‡å¤´ï¼‰</strong>,<strong>Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</strong>,<strong>Signatureï¼ˆç­¾åï¼‰</strong>,ä¸­é—´ç”¨ç‚¹åˆ†å¼€,å³</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.signature</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://jwt.io/#debugger-io" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">jwt.io.Debugger</a>å»è§£ç ,éªŒè¯å’Œç”ŸæˆJWTä»¤ç‰Œ.</p><p><img src="https://pb01.s3.bitiful.net/14.png" alt="avatar"></p><h4 id="Headerï¼ˆæ ‡å¤´ï¼‰">Headerï¼ˆæ ‡å¤´ï¼‰</h4><p>Headeré€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼ˆJWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè¿™ä¸ªJSONè¢«Base64Urlç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><h4 id="Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰">Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</h4><p>PayloadåŒ…å«å£°æ˜ã€‚å£°æ˜æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œé™„åŠ æ•°æ®çš„å£°æ˜(claims),ä¸€èˆ¬å­˜æ”¾ä¸€äº›ä¸æ•æ„Ÿçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åã€æƒé™ã€è§’è‰²ç­‰</p><p>å£°æ˜(claims)ä¹Ÿåˆ†ä¸ºä¸‰ç§:Registered claim,Public claimså’ŒPrivate claims.</p><ul><li><p>Registered claim(å·²æ³¨å†Œå£°æ˜):å…¶ä¸­åŒ…å«äº†ä¸€ç»„å®˜æ–¹å®šä¹‰å¥½çš„æ¨èçš„å£°æ˜(å…±7ä¸ª),æœ‰</p><ol><li>iss (issuer)ï¼šç­¾å‘äºº</li><li>exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´</li><li>sub (subject)ï¼šä¸»é¢˜</li><li>aud (audience)ï¼šå—ä¼—</li><li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</li><li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li><li>jti (JWT ID)ï¼šç¼–å·</li></ol></li><li><p>Public claims(å…¬å¼€å£°æ˜):å£°æ˜åç§°å¯ä»¥ç”±ä½¿ç”¨JWTçš„äººå‘˜éšæ„å®šä¹‰.ç„¶è€Œï¼Œ<strong>ä¸ºäº†é˜²æ­¢å†²çª</strong>ï¼Œä»»ä½•æ–°çš„å£°æ˜åç§°éƒ½åº”è¯¥è¦ä¹ˆåœ¨IANAâ€œJSON Webä»¤ç‰Œå£°æ˜â€æ³¨å†Œä¸­å¿ƒæ³¨å†Œ,è¦ä¹ˆå¾—åŒ…å«é˜²æ’(å†²çª)åç§°.</p></li><li><p>Private claims(ç§æœ‰å£°æ˜):JWTçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸€è‡´åŒæ„ä½¿ç”¨çš„ä¸æ˜¯å·²æ³¨å†Œå£°æ˜å’Œå…¬å¼€å£°æ˜çš„å£°æ˜.ç§æœ‰å£°æ˜å¯èƒ½ä¼šå‘ç”Ÿå†²çªï¼Œåº”è¯¥å°å¿ƒä½¿ç”¨.</p></li></ul><p>ä¾‹å¦‚:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè¿™ä¸ªJSONè¢«Base64Urlç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>åº”å½“æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå·²ç­¾åçš„ä»¤ç‰Œï¼Œè¿™äº›ä¿¡æ¯è™½ç„¶å—åˆ°ä¿æŠ¤ï¼Œä¸ä¼šè¢«ç¯¡æ”¹ï¼Œä½†ä»»ä½•äººéƒ½å¯ä»¥è¯»å–ã€‚é™¤éç»è¿‡åŠ å¯†ï¼Œå¦åˆ™ä¸è¦å°†æœºå¯†ä¿¡æ¯æ”¾å…¥JWTçš„æœ‰æ•ˆè½½è·æˆ–æ ‡å¤´å…ƒç´ ä¸­ã€‚</p><h4 id="Signatureï¼ˆç­¾åï¼‰">Signatureï¼ˆç­¾åï¼‰</h4><p>è¦åˆ›å»ºç­¾åéƒ¨åˆ†ï¼Œæ‚¨å¿…é¡»è·å–ç¼–ç çš„æ ‡å¤´ã€ç¼–ç çš„æœ‰æ•ˆè½½è·ã€ç§˜é’¥ã€æ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç­¾åã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨HMAC SHA256ç®—æ³•ï¼Œåˆ™å°†ä»¥ä»¥ä¸‹æ–¹å¼åˆ›å»ºç­¾åï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">HMACSHA256</span>(</span><br><span class="line">  <span class="title function_">base64UrlEncode</span>(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  <span class="title function_">base64UrlEncode</span>(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure><p>ç­¾åç”¨äºéªŒè¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­æ²¡æœ‰æ›´æ”¹ï¼Œåœ¨ä½¿ç”¨ç§é’¥ç­¾åçš„ä»¤ç‰Œçš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥éªŒè¯JWTçš„å‘é€è€…æ˜¯å¦å°±æ˜¯å®ƒæ‰€è¯´çš„é‚£ä¸ªäººã€‚</p><h4 id="JWTæ˜¯å¦‚ä½•å·¥ä½œçš„">JWTæ˜¯å¦‚ä½•å·¥ä½œçš„?</h4><p>åœ¨è®¤è¯çš„æ—¶å€™ï¼Œå½“ç”¨æˆ·ç”¨ä»–ä»¬çš„å‡­è¯æˆåŠŸç™»å½•ä»¥åï¼Œä¸€ä¸ªJWTå°†ä¼šè¢«è¿”å›ã€‚æ­¤åï¼Œtoken å°±æ˜¯ç”¨æˆ·å‡­è¯äº†ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒä»¥é˜²æ­¢å‡ºç°å®‰å…¨é—®é¢˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä½ ä¿å­˜ä»¤ç‰Œçš„æ—¶å€™ä¸åº”è¯¥è¶…è¿‡ä½ æ‰€éœ€è¦å®ƒçš„æ—¶é—´ã€‚</p><p>æ— è®ºä½•æ—¶ç”¨æˆ·æƒ³è¦è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œç”¨æˆ·ä»£ç†ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰éƒ½åº”è¯¥å¸¦ä¸Š JWTï¼Œå…¸å‹çš„ï¼Œé€šå¸¸æ”¾åœ¨ Authorization header ä¸­ï¼Œç”¨ Bearer schemaã€‚</p><p>header åº”è¯¥çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Authorization</span>: <span class="title class_">Bearer</span> <span class="variable constant_">JWT</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸Šçš„å—ä¿æŠ¤çš„è·¯ç”±å°†ä¼šæ£€æŸ¥ Authorization header ä¸­çš„ JWT æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç”¨æˆ·å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚å¦‚æœ JWT åŒ…å«è¶³å¤Ÿå¤šçš„å¿…éœ€çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å°‘å¯¹æŸäº›æ“ä½œçš„æ•°æ®åº“æŸ¥è¯¢çš„éœ€è¦ï¼Œå°½ç®¡å¯èƒ½å¹¶ä¸æ€»æ˜¯å¦‚æ­¤ã€‚</p><p>å¦‚æœ token  æ˜¯åœ¨æˆæƒå¤´ï¼ˆAuthorization headerï¼‰ä¸­å‘é€çš„ï¼Œé‚£ä¹ˆè·¨æºèµ„æºå…±äº« (CORS) å°†ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨ cookieã€‚</p><p><strong>JWTè®¤è¯æµç¨‹å¦‚ä¸‹:</strong></p><p><img src="https://pb01.s3.bitiful.net/15.png" alt="avatar"></p><ol><li>ç”¨æˆ·ç™»å½•è´¦å·ï¼Œå®¢æˆ·ç«¯å‘é€ POST è¯·æ±‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨ä¼šéªŒè¯ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ï¼Œæ ¡éªŒæˆåŠŸçš„æ—¶å€™ä¼šä½¿ç”¨ JWT ç®—æ³•ï¼Œç”Ÿæˆä¸€ä¸ª token ï¼ˆå·²ç­¾åçš„ tokenï¼‰ã€‚</li><li>æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ HTTP 200 çŠ¶æ€ç ï¼Œå¹¶ä¸”ä¼šå°†ç”Ÿæˆçš„ token æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼ˆheaderï¼‰ï¼Œå¹¶ä¸èƒ½æ”¾åœ¨è¯·æ±‚ä½“ï¼ˆbodyï¼‰ä¸­ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬ä¼šå°†æ¥æ”¶åˆ°çš„ token å­˜å‚¨åœ¨æµè§ˆå™¨çš„ localstorage,cookie æˆ–è€… sessionstorage ã€‚</li><li>å½“å®¢æˆ·ç«¯ä¹‹åå†å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä¼šæºå¸¦ä¸Š token ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥å°† token æ”¾åœ¨ cookie ä¸­è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸå‘é€ï¼‰ã€‚æœ€å¥½çš„åšæ³•æ˜¯å°† token æ”¾åœ¨ http çš„å¤´ä¿¡æ¯ä¸­çš„ Authorization å­—æ®µä¸­ï¼ˆè¿™æ˜¯å®˜æ–¹æ–‡æ¡£å»ºè®®çš„åšæ³•ï¼‰ã€‚</li><li>å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº† token ä¿¡æ¯ï¼Œè¿™æ—¶å€™ JWT è¿›è¡Œåå‘éªŒè¯ï¼ŒéªŒè¯å¯¹åº”çš„ token æ˜¯å¦æ­£ç¡®ã€‚</li><li>å½“æœåŠ¡å™¨äº¤éªŒå®Œæ¯•åï¼Œä¼šäº§ç”Ÿä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯æ ¡éªŒæˆåŠŸï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ HTTP 200 çŠ¶æ€ç å’Œå®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ•°æ®ï¼›ç¬¬äºŒç§æƒ…å†µå°±æ˜¯æ ¡éªŒå¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ HTTP 401 çŠ¶æ€ç ï¼ŒNot authorizedã€‚</li></ol><h4 id="JWTçš„ä¼˜ç¼ºç‚¹">JWTçš„ä¼˜ç¼ºç‚¹</h4><ul><li><p><strong>æ— çŠ¶æ€</strong>:JWT è‡ªèº«åŒ…å«äº†èº«ä»½éªŒè¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session ä¿¡æ¯ã€‚è¿™æ˜¾ç„¶å¢åŠ äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</p></li><li><p><strong>å•ç‚¹ç™»å½•å‹å¥½</strong>:ä½¿ç”¨ Session è¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œå®ç°å•ç‚¹ç™»å½•ï¼Œéœ€è¦æˆ‘ä»¬æŠŠç”¨æˆ·çš„ Session ä¿¡æ¯ä¿å­˜åœ¨ä¸€å°ç”µè„‘ä¸Šï¼Œå¹¶ä¸”è¿˜ä¼šé‡åˆ°å¸¸è§çš„ Cookie è·¨åŸŸçš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ JWT è¿›è¡Œè®¤è¯çš„è¯ï¼Œ JWT è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸ä¼šå­˜åœ¨è¿™äº›é—®é¢˜ã€‚</p></li><li><p><strong>æœ‰æ•ˆé¿å…äº† CSRF æ”»å‡»</strong>:CSRF æ”»å‡»éœ€è¦ä¾èµ– Cookie ï¼ŒSession è®¤è¯ä¸­ Cookie ä¸­çš„ SessionID æ˜¯ç”±æµè§ˆå™¨å‘é€åˆ°æœåŠ¡ç«¯çš„ï¼Œåªè¦å‘å‡ºè¯·æ±‚ï¼ŒCookie å°±ä¼šè¢«æºå¸¦ã€‚å€ŸåŠ©è¿™ä¸ªç‰¹æ€§ï¼Œå³ä½¿é»‘å®¢æ— æ³•è·å–ä½ çš„ SessionIDï¼Œåªè¦è®©ä½ è¯¯ç‚¹æ”»å‡»é“¾æ¥ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”»å‡»æ•ˆæœ.JWTä¸€èˆ¬ä¼šé€‰æ‹©å­˜æ”¾åœ¨ localStorage ä¸­ã€‚å‰ç«¯çš„æ¯ä¸€ä¸ªè¯·æ±‚åç»­éƒ½ä¼šé™„å¸¦ä¸Šè¿™ä¸ª JWTï¼Œæ•´ä¸ªè¿‡ç¨‹å‹æ ¹ä¸ä¼šæ¶‰åŠåˆ° Cookieã€‚</p></li><li><p><strong>ä¸å¯æ§</strong>:æˆ‘ä»¬æƒ³è¦åœ¨JWTæœ‰æ•ˆæœŸå†…åºŸå¼ƒä¸€ä¸ªJWTæˆ–è€…æ›´æ”¹å®ƒçš„æƒé™çš„è¯ï¼Œå¹¶ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œé€šå¸¸éœ€è¦ç­‰åˆ°æœ‰æ•ˆæœŸè¿‡åæ‰å¯ä»¥ã€‚</p></li></ul><h4 id="JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•">JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•</h4><h5 id="æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ"><strong>æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ</strong></h5><ol><li><p><strong>å°†JWTå­˜å…¥å†…å­˜æ•°æ®åº“</strong><br>å°† JWTå­˜å…¥æ•°æ®åº“ä¸­ï¼ŒRedis å†…å­˜æ•°æ®åº“åœ¨è¿™é‡Œæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦è®©æŸä¸ª JWT å¤±æ•ˆå°±ç›´æ¥ä» Redis ä¸­åˆ é™¤è¿™ä¸ª JWT å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¯æ¬¡ä½¿ç”¨ JWT å‘é€è¯·æ±‚éƒ½è¦å…ˆä» DB ä¸­æŸ¥è¯¢ JWT æ˜¯å¦å­˜åœ¨çš„æ­¥éª¤ï¼Œè€Œä¸”è¿èƒŒäº† JWT çš„æ— çŠ¶æ€åŸåˆ™ã€‚</p></li><li><p><strong>é»‘åå•æœºåˆ¶</strong><br>ä½¿ç”¨å†…å­˜æ•°æ®åº“æ¯”å¦‚ Redis ç»´æŠ¤ä¸€ä¸ªé»‘åå•ï¼Œå¦‚æœæƒ³è®©æŸä¸ª JWT å¤±æ•ˆçš„è¯å°±ç›´æ¥å°†è¿™ä¸ª JWT åŠ å…¥åˆ° é»‘åå• å³å¯ã€‚ç„¶åï¼Œæ¯æ¬¡ä½¿ç”¨ JWT è¿›è¡Œè¯·æ±‚çš„è¯éƒ½ä¼šå…ˆåˆ¤æ–­è¿™ä¸ª JWT æ˜¯å¦å­˜åœ¨äºé»‘åå•ä¸­ã€‚ç¼ºç‚¹å’Œç¬¬ä¸€ç§æ–¹æ¡ˆç›¸åŒã€‚</p></li><li><p><strong>ä¿®æ”¹å¯†é’¥(Secret)</strong><br>æˆ‘ä»¬ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½åˆ›å»ºä¸€ä¸ªä¸“å±å¯†é’¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æŸä¸ª JWT å¤±æ•ˆï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹å¯¹åº”ç”¨æˆ·çš„å¯†é’¥å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ç›¸æ¯”äºå‰ä¸¤ç§å¼•å…¥å†…å­˜æ•°æ®åº“å¸¦æ¥äº†å±å®³æ›´å¤§ï¼š</p><ul><li><p>å¦‚æœæœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œåˆ™æ¯æ¬¡å‘å‡ºæ–°çš„ JWT æ—¶éƒ½å¿…é¡»åœ¨å¤šå°æœºå™¨åŒæ­¥å¯†é’¥ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å°†å¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡ä¸­ï¼Œè¿™æ ·å’Œ Session è®¤è¯å°±æ²¡å¤ªå¤§åŒºåˆ«äº†ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·åŒæ—¶åœ¨ä¸¤ä¸ªæµè§ˆå™¨æ‰“å¼€ç³»ç»Ÿï¼Œæˆ–è€…åœ¨æ‰‹æœºç«¯ä¹Ÿæ‰“å¼€äº†ç³»ç»Ÿï¼Œå¦‚æœå®ƒä»ä¸€ä¸ªåœ°æ–¹å°†è´¦å·é€€å‡ºï¼Œé‚£ä¹ˆå…¶ä»–åœ°æ–¹éƒ½è¦é‡æ–°è¿›è¡Œç™»å½•ï¼Œè¿™æ˜¯ä¸å¯å–çš„</p></li></ul></li><li><p><strong>ä¿æŒä»¤ç‰Œçš„æœ‰æ•ˆæœŸé™çŸ­å¹¶ç»å¸¸è½®æ¢</strong><br>å¾ˆç®€å•çš„ä¸€ç§æ–¹å¼ã€‚ä½†æ˜¯ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸ä¼šè¢«æŒä¹…è®°å½•ï¼Œè€Œä¸”éœ€è¦ç”¨æˆ·ç»å¸¸ç™»å½•ã€‚</p></li></ol><h5 id="JWTçš„ç»­ç­¾é—®é¢˜"><strong>JWTçš„ç»­ç­¾é—®é¢˜</strong></h5><ol><li><p><strong>ç±»ä¼¼äºSessionè®¤è¯ä¸­çš„åšæ³•</strong><br>å‡è®¾æœåŠ¡ç«¯ç»™çš„ JWT æœ‰æ•ˆæœŸè®¾ç½®ä¸º 30 åˆ†é’Ÿï¼ŒæœåŠ¡ç«¯æ¯æ¬¡è¿›è¡Œæ ¡éªŒæ—¶ï¼Œå¦‚æœå‘ç° JWT çš„æœ‰æ•ˆæœŸé©¬ä¸Šå¿«è¿‡æœŸäº†ï¼ŒæœåŠ¡ç«¯å°±é‡æ–°ç”Ÿæˆ JWT ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½æ£€æŸ¥æ–°æ—§ JWTï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°æœ¬åœ°çš„ JWTã€‚è¿™ç§åšæ³•çš„é—®é¢˜æ˜¯ä»…ä»…åœ¨å¿«è¿‡æœŸçš„æ—¶å€™è¯·æ±‚æ‰ä¼šæ›´æ–° JWT ,å¯¹å®¢æˆ·ç«¯ä¸æ˜¯å¾ˆå‹å¥½ã€‚</p></li><li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½è¿”å›æ–°JWT</strong><br>è¿™ç§æ–¹æ¡ˆçš„çš„æ€è·¯å¾ˆç®€å•ï¼Œä½†æ˜¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§</p></li><li><p><strong>JWTæœ‰æ•ˆæœŸè®¾ç½®åˆ°åŠå¤œ</strong><br>è¿™ç§æ–¹æ¡ˆæ˜¯ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œä¿è¯äº†å¤§éƒ¨åˆ†ç”¨æˆ·ç™½å¤©å¯ä»¥æ­£å¸¸ç™»å½•ï¼Œé€‚ç”¨äºå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„ç³»ç»Ÿã€‚</p></li><li><p><strong>ç”¨æˆ·ç™»å½•è¿”å›ä¸¤ä¸ªJWT</strong></p><p>ç¬¬ä¸€ä¸ªæ˜¯ accessJWT ï¼Œå®ƒçš„è¿‡æœŸæ—¶é—´ä¸ºJWTæœ¬èº«çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚åŠä¸ªå°æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯refreshJWTå®ƒçš„è¿‡æœŸæ—¶é—´æ›´é•¿ä¸€ç‚¹æ¯”å¦‚ä¸º 1 å¤©ã€‚å®¢æˆ·ç«¯ç™»å½•åï¼Œå°† accessJWT å’Œ refreshJWT ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡è®¿é—®å°† accessJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ ¡éªŒ accessJWT çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±å°† refreshJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚å¦‚æœæœ‰æ•ˆï¼ŒæœåŠ¡ç«¯å°±ç”Ÿæˆæ–°çš„ accessJWT ç»™å®¢æˆ·ç«¯ã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯å°±é‡æ–°ç™»å½•å³å¯ã€‚</p><p>è¿™ç§æ–¹æ¡ˆçš„ä¸è¶³æ˜¯ï¼š</p><ul><li>éœ€è¦å®¢æˆ·ç«¯æ¥é…åˆï¼›</li><li>ç”¨æˆ·æ³¨é”€çš„æ—¶å€™éœ€è¦åŒæ—¶ä¿è¯ä¸¤ä¸ª JWT éƒ½æ— æ•ˆï¼›</li><li>é‡æ–°è¯·æ±‚è·å– JWT çš„è¿‡ç¨‹ä¸­ä¼šæœ‰çŸ­æš‚ JWT ä¸å¯ç”¨çš„æƒ…å†µï¼ˆå¯ä»¥é€šè¿‡åœ¨å®¢æˆ·ç«¯è®¾ç½®å®šæ—¶å™¨ï¼Œå½“ accessJWT å¿«è¿‡æœŸçš„æ—¶å€™ï¼Œæå‰å»é€šè¿‡ refreshJWT è·å–æ–°çš„ accessJWTï¼‰ã€‚</li></ul></li></ol><h4 id="References">References</h4><ol><li><p>JWTå®˜æ–¹æ–‡æ¡£:æœ¬æ–‡å¼€å¤´æœ‰</p></li><li><p><a href="https://javaguide.cn/system-design/security/jwt-intro.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JavaGuide</a></p></li><li><p><a href="https://ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JSON Web Token å…¥é—¨æ•™ç¨‹</a><br>â€¦</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQæŠ¥é”™:unable to perform an operation on node &#39;rabbit@ubuntuserver&#39;</title>
      <link href="/2023/11/15/rabbitmq%E6%8A%A5%E9%94%99/"/>
      <url>/2023/11/15/rabbitmq%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="RabbitMQæŠ¥é”™-unable-to-perform-an-operation-on-node-â€˜rabbit-ubuntuserverâ€™">RabbitMQæŠ¥é”™:unable to perform an operation on node â€˜rabbit@ubuntuserverâ€™</h3><hr><p><strong>ç¯å¢ƒ:VMware+Ubuntu</strong></p><hr><h4 id="å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤">å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤:</h4><ol><li>å®‰è£…Erlang</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install erlang</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…RabbitMQ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rabbitmq-server</span><br></pre></td></tr></table></figure><ol start="3"><li>å¼€å¯RabbitMQç®¡ç†é¢æ¿</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨æŸ¥çœ‹RabbitMQçŠ¶æ€æˆ–ä¸ºRabbitMQæ·»åŠ ç”¨æˆ·æ—¶,å³:</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmqctl status</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmqctl add_user ç”¨æˆ·å å¯†ç </span><br></pre></td></tr></table></figure><p>å‡ºç°<strong>Error:unable to perform an operation on node â€˜rabbit@ubuntuserverâ€™</strong></p><p><img src="https://pb01.s3.bitiful.net/9.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/10.png" alt="avatar"></p><h4 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•:</h4><p><strong>é¦–å…ˆ,åˆ‡æ¢åˆ°rootæƒé™</strong></p><ol><li>ä¸ºrootè®¾ç½®å¯†ç </li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¯†ç <br>2. åˆ‡æ¢åˆ°rootæƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥å¯†ç ä¾¿å¯åˆ‡æ¢åˆ°rootæƒé™</p><p><strong>æ›´æ”¹/etc/hostsæ–‡ä»¶</strong></p><ol><li>å…ˆè¿›æ ¹ç›®å½•</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br></pre></td></tr></table></figure><ol start="2"><li>è¿›å…¥etcç›®å½•</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc</span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ ä¸»æœºåæ˜ å°„<br>vimæ‰“å¼€hostsæ–‡ä»¶</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi hosts</span><br></pre></td></tr></table></figure><p>é”®å…¥iè½¬æ¢åˆ°insertæ¨¡å¼<br><img src="https://pb01.s3.bitiful.net/11.png" alt="avatar"></p><p>åœ¨127.0.0.1 localhost åé¢æ·»åŠ ä½ çš„ä¸»æœºå,å°±æ˜¯root@xxxxä¸­çš„xxxx,æˆ‘çš„æ˜¯ubuntuserver</p><p><img src="https://pb01.s3.bitiful.net/12.png" alt="avatar"></p><p>æœ€åæŒ‰Escé”®é€€å‡ºinsertæ¨¡å¼,è¾“å…¥:wqä¿å­˜å¹¶é€€å‡º</p><p>ç„¶åå†æ‰§è¡Œä¸Šé¢çš„æ“ä½œå°±ä¸€åˆ‡æ­£å¸¸äº†</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåˆ†å¸ƒå¼é”</title>
      <link href="/2023/11/13/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>/2023/11/13/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Redisåˆ†å¸ƒå¼é”">Redisåˆ†å¸ƒå¼é”</h2><hr><h4 id="åˆ†å¸ƒå¼é”çš„ç”±æ¥">åˆ†å¸ƒå¼é”çš„ç”±æ¥</h4><p>åœ¨ä¼ ç»Ÿå•æœºéƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Javaå¹¶å‘å¤„ç†ç›¸å…³çš„API(å¦‚ReentrantLcokæˆ–synchronized)è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚</p><p>ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºå¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„ç”±æ¥ã€‚</p><p>å½“å¤šä¸ªè¿›ç¨‹ä¸åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå°±éœ€è¦ç”¨åˆ†å¸ƒå¼é”æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ã€‚æœ€å®é™…çš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯æ§åˆ¶åº“å­˜ï¼Œæ¯”å¦‚è¯´ç”µå•†å¹³å°é˜²æ­¢å•†å“è¶…å–è¿™ç±»åœºæ™¯ã€‚</p><h4 id="åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶">åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶</h4><ul><li><p><strong>äº’æ–¥æ€§</strong>ï¼šä»»æ„æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–é”ï¼Œä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯è·å–åˆ°é”ã€‚</p></li><li><p><strong>å®‰å…¨æ€§</strong>ï¼šé”åªèƒ½è¢«æŒæœ‰è¯¥é”çš„å®¢æˆ·ç«¯åˆ é™¤ï¼Œä¸èƒ½ç”±å…¶å®ƒå®¢æˆ·ç«¯åˆ é™¤ã€‚</p></li><li><p><strong>ä¸ä¼šæ­»é”</strong>ï¼šè·å–é”çš„å®¢æˆ·ç«¯å› ä¸ºæŸäº›åŸå› ï¼ˆå¦‚downæœºç­‰ï¼‰è€Œæœªèƒ½é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</p></li><li><p><strong>å®¹é”™</strong>ï¼šåªè¦å¤§éƒ¨åˆ†çš„RedisèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ é”å’Œè§£é”ã€‚</p></li></ul><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°ä¸€-setnx-expire">Redisåˆ†å¸ƒå¼é”å®ç°ä¸€(setnx+expire)</h4><p>å®ç°å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">seynx key value</span><br><span class="line">expire key time</span><br></pre></td></tr></table></figure><p>setnxå…¶å®å°±æ˜¯set if not existsçš„æ„æ€,ä»…å½“keyä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½è¿›è¡Œæ’å…¥,æ‰§è¡Œå®Œæ“ä½œåå¯ä»¥å°†é”åˆ é™¤<br>expireå‘½ä»¤ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del key</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½é‡æ–°å¯¹keyçš„å€¼è¿›è¡Œæ“ä½œäº†</p><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°äºŒ-set">Redisåˆ†å¸ƒå¼é”å®ç°äºŒ(set)</h4><p>ä¸Šé¢é‚£ç§å®ç°æ–¹å¼å­˜åœ¨ä¸€ç§é—®é¢˜,å¦‚æœåœ¨æ‰§è¡Œå®Œ setnx ä¹‹å,æ‰§è¡Œexpireä¹‹å‰,æœåŠ¡å™¨ crash æˆ–é‡å¯äº†å¯¼è‡´åŠ çš„è¿™ä¸ªé”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šå¯¼è‡´æ­»é”çš„æƒ…å†µï¼ˆåˆ«çš„çº¿ç¨‹å°±æ°¸è¿œè·å–ä¸åˆ°é”äº†ï¼‰</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime)</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€ä¸ªä¸º</strong>keyï¼Œæˆ‘ä»¬ä½¿ç”¨keyæ¥å½“é”ï¼Œå› ä¸ºkeyæ˜¯å”¯ä¸€çš„ã€‚</p><p><strong>ç¬¬äºŒä¸ª</strong>ä¸ºvalueï¼Œæˆ‘ä»¬ä¼ çš„æ˜¯requestIdï¼Œå¾ˆå¤šäººå¯èƒ½ä¸æ˜ç™½ï¼Œæœ‰keyä½œä¸ºé”ä¸å°±å¤Ÿäº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨åˆ°valueï¼ŸåŸå› å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢è®²åˆ°åˆ†å¸ƒå¼é”è¦æ»¡è¶³çš„æ¡ä»¶æ—¶,æåˆ°çš„<strong>å®‰å…¨æ€§</strong>è¿™ä¸€æ¡ï¼Œé€šè¿‡ç»™valueèµ‹å€¼ä¸ºrequestIdï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™æŠŠé”æ˜¯å“ªä¸ªè¯·æ±‚åŠ çš„äº†ï¼Œåœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥æœ‰ä¾æ®ã€‚requestIdå¯ä»¥ä½¿ç”¨UUID.randomUUID().toString()æ–¹æ³•ç”Ÿæˆã€‚</p><p><strong>ç¬¬ä¸‰ä¸ª</strong>ä¸ºnxxxï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬å¡«çš„æ˜¯NXï¼Œæ„æ€æ˜¯SET IF NOT EXISTï¼Œå³å½“keyä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬è¿›è¡Œsetæ“ä½œï¼›è‹¥keyå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œï¼›</p><p><strong>ç¬¬å››ä¸ª</strong>ä¸ºexpxï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¼ çš„æ˜¯PXï¼Œæ„æ€æ˜¯æˆ‘ä»¬è¦ç»™è¿™ä¸ªkeyåŠ ä¸€ä¸ªè¿‡æœŸçš„è®¾ç½®ï¼Œå…·ä½“æ—¶é—´ç”±ç¬¬äº”ä¸ªå‚æ•°å†³å®šã€‚</p><p><strong>ç¬¬äº”ä¸ª</strong>ä¸ºtimeï¼Œä¸ç¬¬å››ä¸ªå‚æ•°ç›¸å‘¼åº”ï¼Œä»£è¡¨keyçš„è¿‡æœŸæ—¶é—´ã€‚<br>æ€»çš„æ¥è¯´ï¼Œæ‰§è¡Œä¸Šé¢çš„set()æ–¹æ³•å°±åªä¼šå¯¼è‡´ä¸¤ç§ç»“æœï¼š1. å½“å‰æ²¡æœ‰é”ï¼ˆkeyä¸å­˜åœ¨ï¼‰ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¹¶å¯¹é”è®¾ç½®ä¸ªæœ‰æ•ˆæœŸï¼ŒåŒæ—¶valueè¡¨ç¤ºåŠ é”çš„å®¢æˆ·ç«¯ã€‚2. å·²æœ‰é”å­˜åœ¨ï¼Œä¸åšä»»ä½•æ“ä½œã€‚</p><p>æˆ‘ä»¬çš„åŠ é”ä»£ç æ»¡è¶³æˆ‘ä»¬å¯é æ€§é‡Œæè¿°çš„ä¸‰ä¸ªæ¡ä»¶:</p><ul><li><strong>é¦–å…ˆ</strong>ï¼Œset()åŠ å…¥äº†NXå‚æ•°ï¼Œå¯ä»¥ä¿è¯å¦‚æœå·²æœ‰keyå­˜åœ¨ï¼Œåˆ™å‡½æ•°ä¸ä¼šè°ƒç”¨æˆåŠŸï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ï¼Œæ»¡è¶³<strong>äº’æ–¥æ€§</strong>ã€‚</li><li><strong>å…¶æ¬¡</strong>ï¼Œç”±äºæˆ‘ä»¬å¯¹é”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå³ä½¿é”çš„æŒæœ‰è€…åç»­å‘ç”Ÿå´©æºƒè€Œæ²¡æœ‰è§£é”ï¼Œé”ä¹Ÿä¼šå› ä¸ºåˆ°äº†è¿‡æœŸæ—¶é—´è€Œè‡ªåŠ¨è§£é”ï¼ˆå³keyè¢«åˆ é™¤ï¼‰ï¼Œ<strong>ä¸ä¼šå‘ç”Ÿæ­»é”</strong>ã€‚</li><li><strong>æœ€å</strong>ï¼Œå› ä¸ºæˆ‘ä»¬å°†valueèµ‹å€¼ä¸ºrequestIdï¼Œä»£è¡¨åŠ é”çš„å®¢æˆ·ç«¯è¯·æ±‚æ ‡è¯†ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯åœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥è¿›è¡Œæ ¡éªŒæ˜¯å¦æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚<strong>è¿™æ ·å°±é¿å…äº†é”è¢«åˆ«çš„çº¿ç¨‹åˆ é™¤</strong>,ä¿è¯äº†<strong>å®‰å…¨æ€§</strong>ã€‚</li></ul><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰-Redissionæ¡†æ¶">Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰(Redissionæ¡†æ¶)</h4><p>æ–¹æ¡ˆäºŒè¿˜æ˜¯å¯èƒ½å­˜åœ¨<strong>é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ</strong>çš„é—®é¢˜ã€‚æœ‰äº›å°ä¼™ä¼´è®¤ä¸ºï¼Œç¨å¾®æŠŠé”è¿‡æœŸæ—¶é—´è®¾ç½®é•¿ä¸€äº›å°±å¯ä»¥å•¦ã€‚å…¶å®é—®é¢˜çš„å…³é”®å°±åœ¨äºæˆ‘ä»¬ä¸ç¡®å®šè¦è®¾ç½®å¤šé•¿æ—¶é—´,æ—¶é—´å¤ªçŸ­å°±ä¼šå¯¼è‡´é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ,æ—¶é—´å¤ªé•¿å°±ä¼šä½¿ç³»ç»Ÿè¿è¡Œæ•ˆç‡ä¸‹é™. æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œæ˜¯å¦å¯ä»¥ç»™è·å¾—é”çš„çº¿ç¨‹ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶å®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¯¹é”çš„è¿‡æœŸæ—¶é—´å»¶é•¿ï¼Œé˜²æ­¢é”è¿‡æœŸæå‰é‡Šæ”¾ã€‚Redissionæ¡†æ¶å¸®æˆ‘ä»¬å®ç°äº†æ­¤åŠŸèƒ½,åä¸º<strong>çœ‹é—¨ç‹—</strong></p><p><img src="https://pb01.s3.bitiful.net/7.png" alt="avatar"></p><p>åªè¦çº¿ç¨‹ä¸€åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœçº¿ç¨‹1è¿˜æŒæœ‰é”ï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚å› æ­¤ï¼ŒRedissonå°±æ˜¯ä½¿ç”¨Redissonè§£å†³äº†<strong>é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ</strong>é—®é¢˜ã€‚</p><p><img src="https://pb01.s3.bitiful.net/8.png" alt="avatar"></p><p>å¦‚æœçº¿ç¨‹ä¸€åœ¨Redisçš„masterèŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯åŠ é”çš„keyè¿˜æ²¡åŒæ­¥åˆ°slaveèŠ‚ç‚¹ã€‚æ°å¥½è¿™æ—¶ï¼ŒmasterèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œä¸€ä¸ªslaveèŠ‚ç‚¹å°±ä¼šå‡çº§ä¸ºmasterèŠ‚ç‚¹ã€‚çº¿ç¨‹äºŒå°±å¯ä»¥è·å–åŒä¸ªkeyçš„é”å•¦ï¼Œä½†çº¿ç¨‹ä¸€ä¹Ÿå·²ç»æ‹¿åˆ°é”äº†ï¼Œé”çš„å®‰å…¨æ€§å°±æ²¡äº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨RedLockï¼Œå®ƒçš„æ€è·¯æ˜¯ï¼Œåœ¨å¤šä¸ªRedisæœåŠ¡å™¨ä¸Šä¿å­˜é”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„RedisæœåŠ¡å™¨è·å–åˆ°é”ï¼Œé‚£ä¹ˆå°±çœŸçš„è·å–åˆ°é”äº†ï¼Œè¿™æ ·å°±ç®—æŒ‚æ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸è¿è¡Œï¼Œä¿è¯äº†<strong>å®¹é”™æ€§</strong>ã€‚</p><h4 id="References">References</h4><ul><li><a href="https://www.cnblogs.com/wangyingshuo/p/14510524.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Rediså®ç°åˆ†å¸ƒå¼é”çš„7ç§æ–¹æ¡ˆï¼ŒåŠæ­£ç¡®ä½¿ç”¨å§¿åŠ¿ï¼</a></li><li>Redisç¬”è®° by itbaima</li><li><a href="https://developer.aliyun.com/article/307547" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Redis åˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼ï¼ˆ Java ç‰ˆ ï¼‰</a></li><li><a href="https://www.runoob.com/redis/redis-tutorial.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">èœé¸Ÿæ•™ç¨‹|Redisæ•™ç¨‹</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisä¸åˆ†å¸ƒå¼</title>
      <link href="/2023/11/13/redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/"/>
      <url>/2023/11/13/redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Redisä¸åˆ†å¸ƒå¼">Redisä¸åˆ†å¸ƒå¼</h2><hr><h3 id="ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</h3><p><img src="https://pb01.s3.bitiful.net/4.png" alt="avatar"></p><h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4><p>æœ‰å¤šä¸ªredisæœåŠ¡å™¨,åªæœ‰ä¸€ä¸ª<strong>ä¸»èŠ‚ç‚¹(Master)</strong>,å…¶ä½™å‡ä¸º<strong>ä»èŠ‚ç‚¹(Slave)</strong>,ä¸»èŠ‚ç‚¹å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œ,ä»èŠ‚ç‚¹åªèƒ½è¿›è¡Œè¯»æ“ä½œ.æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„,ä»èŠ‚ç‚¹ä¸­çš„å†…å®¹æ˜¯ç”±ä¸»èŠ‚ç‚¹ä¸­å¤åˆ¶è¿‡æ¥çš„(ç›´æ¥å¤åˆ¶/é—´æ¥å¤åˆ¶).</p><p>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(ä¹Ÿå¯ä»¥æ²¡æœ‰),ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹.redisä¸»ä»å¤åˆ¶æ˜¯<code>å¼‚æ­¥å¤åˆ¶</code>,ä¸»èŠ‚ç‚¹æ”¶åˆ°å†™å‘½ä»¤,å…ˆå†™åˆ°å†…éƒ¨ç¼“å†²åŒº,ç„¶åå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹.</p><h4 id="é…ç½®">é…ç½®</h4><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»èŠ‚ç‚¹ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof ä¸»èŠ‚ç‚¹IP ä¸»èŠ‚ç‚¹ç«¯å£</span><br></pre></td></tr></table></figure><h4 id="ä½œç”¨">ä½œç”¨</h4><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><h4 id="Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶">Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶</h4><p>ä½¿ç”¨Redisä¸»ä»å¤åˆ¶çš„åŸå› ä¸»è¦æ˜¯å•å°RedisèŠ‚ç‚¹å­˜åœ¨ä»¥ä¸‹çš„å±€é™æ€§ï¼š</p><ul><li><p>Redisè™½ç„¶è¯»å†™çš„é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå•èŠ‚ç‚¹çš„Redisèƒ½å¤Ÿæ”¯æ’‘**æ¯ç§’è¯·æ±‚æ•°(QPS)**å¤§æ¦‚åœ¨5wå·¦å³ï¼Œå¦‚æœä¸Šåƒä¸‡çš„ç”¨æˆ·è®¿é—®ï¼ŒRediså°±æ‰¿è½½ä¸äº†ï¼Œæˆä¸ºäº†é«˜å¹¶å‘çš„ç“¶é¢ˆã€‚</p></li><li><p>å•èŠ‚ç‚¹çš„Redisä¸èƒ½ä¿è¯é«˜å¯ç”¨ï¼Œå½“Rediså› ä¸ºæŸäº›åŸå› æ„å¤–å®•æœºæ—¶ï¼Œä¼šå¯¼è‡´ç¼“å­˜ä¸å¯ç”¨</p></li><li><p>CPUçš„åˆ©ç”¨ç‡ä¸Šï¼Œå•å°Rediså®ä¾‹åªèƒ½åˆ©ç”¨å•ä¸ªæ ¸å¿ƒï¼Œè¿™å•ä¸ªæ ¸å¿ƒåœ¨é¢ä¸´æµ·é‡æ•°æ®çš„å­˜å–å’Œç®¡ç†å·¥ä½œæ—¶å‹åŠ›ä¼šéå¸¸å¤§ã€‚</p></li></ul><h4 id="ä¸»ä»å¤åˆ¶æµç¨‹">ä¸»ä»å¤åˆ¶æµç¨‹</h4><p>ç¬¬ä¸€æ¬¡åŒæ­¥ä¸€èˆ¬æ˜¯<code>å…¨é‡åŒæ­¥</code>,åç»­åŸºäºå·²ç»å»ºç«‹çš„TCPé•¿è¿æ¥è¿›è¡Œ<code>å¢é‡åŒæ­¥</code>,å¦‚æœTCPé•¿è¿æ¥æ–­å¼€,å†æ¬¡è¿æ¥åè¿›è¡ŒåŒæ­¥,ä¸»èŠ‚ç‚¹ä¼šåˆ¤æ–­ä»èŠ‚ç‚¹è¦è¯»çš„æ•°æ®æ˜¯å¦åœ¨repl_backlog_bufferç¼“å†²åŒºä¸­,å¦‚æœåœ¨,åˆ™è¿›è¡Œå¢é‡åŒæ­¥,å¦åˆ™è¿›è¡Œå…¨é‡åŒæ­¥.</p><ol><li><p>è‹¥å¯åŠ¨ä¸€ä¸ªSlaveæœºå™¨è¿›ç¨‹ï¼Œåˆ™å®ƒä¼šå‘Masteræœºå™¨å‘é€ä¸€ä¸ªâ€œsync commandâ€å‘½ä»¤ï¼Œè¯·æ±‚åŒæ­¥è¿æ¥ã€‚</p></li><li><p>æ— è®ºæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥è¿˜æ˜¯é‡æ–°è¿æ¥ï¼ŒMasteræœºå™¨éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†æ•°æ®å¿«ç…§ä¿å­˜åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼ˆæ‰§è¡Œrdbæ“ä½œï¼‰ï¼ŒåŒæ—¶Masterè¿˜ä¼šè®°å½•ä¿®æ”¹æ•°æ®çš„æ‰€æœ‰å‘½ä»¤å¹¶ç¼“å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚</p></li><li><p>åå°è¿›ç¨‹å®Œæˆç¼“å­˜æ“ä½œä¹‹åï¼ŒMasteæœºå™¨å°±ä¼šå‘Slaveæœºå™¨å‘é€æ•°æ®æ–‡ä»¶ï¼ŒSlaveç«¯æœºå™¨å°†æ•°æ®æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€Masteræœºå™¨å°±ä¼šå°†ä¿®æ”¹æ•°æ®çš„æ‰€æœ‰æ“ä½œä¸€å¹¶å‘é€ç»™Slaveç«¯æœºå™¨ã€‚è‹¥Slaveå‡ºç°æ•…éšœå¯¼è‡´å®•æœºï¼Œåˆ™æ¢å¤æ­£å¸¸åä¼šè‡ªåŠ¨é‡æ–°è¿æ¥ã€‚</p></li><li><p>Masteræœºå™¨æ”¶åˆ°Slaveç«¯æœºå™¨çš„è¿æ¥åï¼Œå°†å…¶å®Œæ•´çš„æ•°æ®æ–‡ä»¶å‘é€ç»™Slaveç«¯æœºå™¨ï¼Œå¦‚æœMateråŒæ—¶æ”¶åˆ°å¤šä¸ªSlaveå‘æ¥çš„åŒæ­¥è¯·æ±‚ï¼Œåˆ™Masterä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ä»¥ä¿å­˜æ•°æ®æ–‡ä»¶ï¼Œç„¶åå°†å…¶å‘é€ç»™æ‰€æœ‰çš„Slaveç«¯æœºå™¨ï¼Œç¡®ä¿æ‰€æœ‰çš„Slaveç«¯æœºå™¨éƒ½æ­£å¸¸ã€‚</p></li></ol><h4 id="ä¸»ä»æ•°æ®ä¸ä¸€è‡´">ä¸»ä»æ•°æ®ä¸ä¸€è‡´</h4><p><strong>åŸå› </strong>: ä¸»ä»èŠ‚ç‚¹çš„å‘½ä»¤å¤åˆ¶æ˜¯<code>å¼‚æ­¥</code>æ‰§è¡Œçš„.åœ¨ä¸»ä»èŠ‚ç‚¹å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹æ”¶åˆ°æ–°çš„å†™å‘½ä»¤åï¼Œä¼šå‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œä¸»èŠ‚ç‚¹å¹¶ä¸ä¼šç­‰åˆ°ä»èŠ‚ç‚¹å®é™…æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸»èŠ‚ç‚¹è‡ªå·±åœ¨æœ¬åœ°æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ç»“æœäº†ã€‚å¦‚æœä»èŠ‚ç‚¹è¿˜æ²¡æœ‰æ‰§è¡Œä¸»èŠ‚ç‚¹åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ï¼Œä¸»ä»èŠ‚ç‚¹é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†.</p><p><strong>å¦‚ä½•åº”å¯¹</strong>:<br>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œé¿å…ä¸»ä»èŠ‚ç‚¹åœ¨ä¸åŒçš„æœºæˆ¿ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªå¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦ã€‚å…·ä½“åšæ³•ï¼š</p><ul><li><p>Redis çš„ INFO replication å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»èŠ‚ç‚¹æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆmaster_repl_offsetï¼‰å’Œä»èŠ‚ç‚¹å¤åˆ¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆslave_repl_offsetï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å‘ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œå…ˆç”¨ INFO replication å‘½ä»¤æŸ¥åˆ°ä¸»ã€ä»èŠ‚ç‚¹çš„è¿›åº¦ï¼Œç„¶åï¼Œæˆ‘ä»¬ç”¨ master_repl_offset å‡å» slave_repl_offsetï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°ä»èŠ‚ç‚¹å’Œä¸»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦å·®å€¼äº†ã€‚</p></li><li><p>å¦‚æœæŸä¸ªä»èŠ‚ç‚¹çš„è¿›åº¦å·®å€¼å¤§äºæˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯ä¸å†å’Œè¿™ä¸ªä»èŠ‚ç‚¹è¿æ¥è¿›è¡Œæ•°æ®è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œä¸ºäº†é¿å…å‡ºç°å®¢æˆ·ç«¯å’Œæ‰€æœ‰ä»èŠ‚ç‚¹éƒ½ä¸èƒ½è¿æ¥çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤åˆ¶è¿›åº¦å·®å€¼çš„é˜ˆå€¼è®¾ç½®å¾—å¤§ä¸€äº›ã€‚</p></li></ul><h4 id="ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ">ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</h4><p>ä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ•°æ®ä¸¢å¤±çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p><ul><li>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</li><li>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±<br>æˆ‘ä»¬ä¸å¯èƒ½ä¿è¯æ•°æ®å®Œå…¨ä¸ä¸¢å¤±ï¼Œåªèƒ½åšåˆ°ä½¿å¾—å°½é‡å°‘çš„æ•°æ®ä¸¢å¤±ã€‚</li></ul><p><strong>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</strong><br>å½“å®¢æˆ·ç«¯å‘é€å†™è¯·æ±‚ç»™ä¸»èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šè¿”å› okï¼Œæ¥ç€ä¸»èŠ‚ç‚¹å°†å†™è¯·æ±‚å¼‚æ­¥åŒæ­¥ç»™å„ä¸ªä»èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹è¿˜æ²¡æ¥å¾—åŠåŒæ­¥ç»™ä»èŠ‚ç‚¹æ—¶å‘ç”Ÿäº†æ–­ç”µï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚</p><p>Redis é…ç½®é‡Œæœ‰ä¸€ä¸ªå‚æ•° <code>min-slaves-max-lag</code>ï¼Œè¡¨ç¤ºä¸€æ—¦æ‰€æœ‰çš„ä»èŠ‚ç‚¹æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿéƒ½è¶…è¿‡äº† min-slaves-max-lag å®šä¹‰çš„å€¼ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°±ä¼šæ‹’ç»æ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚</p><p>å‡è®¾å°† min-slaves-max-lag é…ç½®ä¸º 10s åï¼Œæ ¹æ®ç›®å‰ master-&gt;slave çš„å¤åˆ¶é€Ÿåº¦ï¼Œå¦‚æœæ•°æ®åŒæ­¥å®Œæˆæ‰€éœ€è¦æ—¶é—´è¶…è¿‡10sï¼Œå°±ä¼šè®¤ä¸º master æœªæ¥å®•æœºåæŸå¤±çš„æ•°æ®ä¼šå¾ˆå¤šï¼Œmaster å°±æ‹’ç»å†™å…¥æ–°è¯·æ±‚ã€‚è¿™æ ·å°±èƒ½å°† master å’Œ slave æ•°æ®å·®æ§åˆ¶åœ¨10så†…ï¼Œå³ä½¿ master å®•æœºä¹Ÿåªæ˜¯è¿™æœªå¤åˆ¶çš„ 10s æ•°æ®ã€‚</p><p>é‚£ä¹ˆå¯¹äºå®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯å‘ç° master ä¸å¯å†™åï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–é™çº§æªæ–½ï¼Œå°†æ•°æ®æš‚æ—¶å†™å…¥æœ¬åœ°ç¼“å­˜å’Œç£ç›˜ä¸­ï¼Œåœ¨ä¸€æ®µæ—¶é—´ï¼ˆç­‰ master æ¢å¤æ­£å¸¸ï¼‰åé‡æ–°å†™å…¥ master æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥ kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ master æ¢å¤æ­£å¸¸ï¼Œå†éš”ä¸€æ®µæ—¶é—´å»æ¶ˆè´¹ kafka ä¸­çš„æ•°æ®ï¼Œè®©å°†æ•°æ®é‡æ–°å†™å…¥ master ã€‚</p><p><strong>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±</strong><br>å¦‚æœä¸»èŠ‚ç‚¹çš„ç½‘ç»œçªç„¶å‘ç”Ÿäº†é—®é¢˜ï¼Œå®ƒä¸æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½å¤±è”äº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä¸»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯çš„ç½‘ç»œæ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ Redis å†…éƒ¨å·²ç»å‡ºç°äº†é—®é¢˜ï¼Œè¿˜åœ¨ç…§æ ·çš„å‘è¿™ä¸ªå¤±è”çš„ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼ˆè¿‡ç¨‹Aï¼‰ï¼Œæ­¤æ—¶è¿™äº›æ•°æ®è¢«ä¸»èŠ‚ç‚¹ç¼“å­˜åˆ°äº†ç¼“å†²åŒºé‡Œï¼Œå› ä¸ºä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯æ— æ³•åŒæ­¥ç»™ä»èŠ‚ç‚¹çš„ã€‚</p><p>è¿™æ—¶ï¼Œå“¨å…µä¹Ÿå‘ç°ä¸»èŠ‚ç‚¹å¤±è”äº†ï¼Œå®ƒå°±è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆä½†å®é™…ä¸Šä¸»èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†ï¼‰ï¼Œäºæ˜¯å“¨å…µå°±ä¼šåœ¨ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸€ä¸ª leader ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿™æ—¶é›†ç¾¤å°±æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹äº† â€”â€” è„‘è£‚å‡ºç°äº†ã€‚</p><p>è¿™æ—¶å€™ç½‘ç»œçªç„¶å¥½äº†ï¼Œå“¨å…µå› ä¸ºä¹‹å‰å·²ç»é€‰ä¸¾å‡ºä¸€ä¸ªæ–°ä¸»èŠ‚ç‚¹äº†ï¼Œå®ƒå°±ä¼šæŠŠæ—§ä¸»èŠ‚ç‚¹é™çº§ä¸ºä»èŠ‚ç‚¹ï¼ˆAï¼‰ï¼Œç„¶åä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šå‘æ–°ä¸»èŠ‚ç‚¹è¯·æ±‚æ•°æ®åŒæ­¥ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæ­¤æ—¶çš„ä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šæ¸…ç©ºæ‰è‡ªå·±æœ¬åœ°çš„æ•°æ®ï¼Œç„¶åå†åšå…¨é‡åŒæ­¥ã€‚æ‰€ä»¥ï¼Œä¹‹å‰å®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ A å†™å…¥çš„æ•°æ®å°±ä¼šä¸¢å¤±äº†ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p><code>æ–¹æ¡ˆ</code>:å½“ä¸»èŠ‚ç‚¹å‘ç°ã€Œä»èŠ‚ç‚¹ä¸‹çº¿çš„æ•°é‡å¤ªå¤šã€ï¼Œæˆ–è€…ã€Œç½‘ç»œå»¶è¿Ÿå¤ªå¤§ã€çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ“ä½œï¼Œç›´æ¥æŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è®¾ç½®ï¼š</p><p>min-slaves-to-write xï¼Œä¸»èŠ‚ç‚¹å¿…é¡»è¦æœ‰è‡³å°‘ x ä¸ªä»èŠ‚ç‚¹è¿æ¥ï¼Œå¦‚æœå°äºè¿™ä¸ªæ•°ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚<br>min-slaves-max-lag xï¼Œä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡ x ç§’ï¼Œå¦‚æœä¸»ä»åŒæ­¥çš„å»¶è¿Ÿè¶…è¿‡ x ç§’ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚<br>æˆ‘ä»¬å¯ä»¥æŠŠ min-slaves-to-write å’Œ min-slaves-max-lag è¿™ä¸¤ä¸ªé…ç½®é¡¹æ­é…èµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€å®šçš„é˜ˆå€¼ï¼Œå‡è®¾ä¸º N å’Œ Tã€‚</p><p>è¿™ä¸¤ä¸ªé…ç½®é¡¹ç»„åˆåçš„è¦æ±‚æ˜¯ï¼Œä¸»èŠ‚ç‚¹è¿æ¥çš„ä»èŠ‚ç‚¹ä¸­è‡³å°‘æœ‰ N ä¸ªä»èŠ‚ç‚¹ï¼Œã€Œå¹¶ä¸”ã€ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’ï¼Œå¦åˆ™ï¼Œä¸»èŠ‚ç‚¹å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™è¯·æ±‚äº†ã€‚</p><p>å³ä½¿åŸä¸»èŠ‚ç‚¹æ˜¯å‡æ•…éšœï¼Œå®ƒåœ¨å‡æ•…éšœæœŸé—´ä¹Ÿæ— æ³•å“åº”å“¨å…µå¿ƒè·³ï¼Œä¹Ÿä¸èƒ½å’Œä»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•å’Œä»èŠ‚ç‚¹è¿›è¡Œ ACK ç¡®è®¤äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œmin-slaves-to-write å’Œ min-slaves-max-lag çš„ç»„åˆè¦æ±‚å°±æ— æ³•å¾—åˆ°æ»¡è¶³ï¼ŒåŸä¸»èŠ‚ç‚¹å°±ä¼šè¢«é™åˆ¶æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±ä¸èƒ½åœ¨åŸä¸»èŠ‚ç‚¹ä¸­å†™å…¥æ–°æ•°æ®äº†ã€‚</p><p>ç­‰åˆ°æ–°ä¸»èŠ‚ç‚¹ä¸Šçº¿æ—¶ï¼Œå°±åªæœ‰æ–°ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œæ–°å†™çš„æ•°æ®ä¼šè¢«ç›´æ¥å†™åˆ°æ–°ä¸»èŠ‚ç‚¹ä¸­ã€‚è€ŒåŸä¸»èŠ‚ç‚¹ä¼šè¢«å“¨å…µé™ä¸ºä»èŠ‚ç‚¹ï¼Œå³ä½¿å®ƒçš„æ•°æ®è¢«æ¸…ç©ºäº†ï¼Œä¹Ÿä¸ä¼šæœ‰æ–°æ•°æ®ä¸¢å¤±ã€‚æˆ‘å†æ¥ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬å°† min-slaves-to-write è®¾ç½®ä¸º 1ï¼ŒæŠŠ min-slaves-max-lag è®¾ç½®ä¸º 12sï¼ŒæŠŠå“¨å…µçš„ down-after-milliseconds è®¾ç½®ä¸º 10sï¼Œä¸»èŠ‚ç‚¹å› ä¸ºæŸäº›åŸå› å¡ä½äº† 15sï¼Œå¯¼è‡´å“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿ï¼Œå¼€å§‹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚åŒæ—¶ï¼Œå› ä¸ºåŸä¸»èŠ‚ç‚¹å¡ä½äº† 15sï¼Œæ²¡æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹èƒ½å’ŒåŸä¸»èŠ‚ç‚¹åœ¨ 12s å†…è¿›è¡Œæ•°æ®å¤åˆ¶ï¼ŒåŸä¸»èŠ‚ç‚¹ä¹Ÿæ— æ³•æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œä¹Ÿåªæœ‰æ–°ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶è¯·æ±‚ï¼Œä¸ä¼šå‘ç”Ÿè„‘è£‚ï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±çš„é—®é¢˜äº†ã€‚</p><h4 id="å…¶ä»–">å…¶ä»–</h4><p><strong>è¿‡æœŸkeyå¦‚ä½•å¤„ç†?</strong><br>ä¸»èŠ‚ç‚¹ä¸­çš„keyè¢«åˆ é™¤æˆ–æ·˜æ±°,ä¼šæ¨¡æ‹Ÿä¸€æ¡åˆ é™¤å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹,ä»èŠ‚ç‚¹æ”¶åˆ°è¿™æ¡å‘½ä»¤å,ä¼šåˆ é™¤å¯¹åº”çš„key.</p><p><strong>ä¸ºäº†é¿å…ç½‘ç»œæ¢å¤æ—¶,é¢‘ç¹è¿›è¡Œå…¨é‡åŒæ­¥,è¯¥æ€ä¹ˆåš?</strong><br>è¦å°†repl_backlog_bufferç¼“å†²åŒºè°ƒå¾—å¤§ä¸€äº›,è‡³å°‘ä¸ºä¸»èŠ‚ç‚¹ä¸€ç§’å†™çš„æ•°æ®é‡<em>é‡è¿æ—¶é—´</em>2.</p><p><strong>å¦‚ä½•åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›?</strong><br>å°†ä¸€éƒ¨åˆ†ä»èŠ‚ç‚¹å‡çº§ä¸ºå…¶ä»–ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹</p><p><strong>æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</strong><br>Redis åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡äº’ç›¸çš„ ping-pong å¿ƒæ€æ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å» ping ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰ pong å›åº”ï¼Œé›†ç¾¤å°±ä¼šè®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¼šæ–­å¼€ä¸è¿™ä¸ªèŠ‚ç‚¹çš„è¿æ¥ã€‚</p><h3 id="å“¨å…µæ¨¡å¼">å“¨å…µæ¨¡å¼</h3><p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šæœ€å…³é”®çš„è¿˜æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå› ä¸ºä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªä¸»ä»ç³»ç»Ÿå°†æ— æ³•å†™å…¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸€ä¸ªåŠæ³•ï¼Œå¤„ç†ä¸€ä¸‹<strong>ä¸»èŠ‚ç‚¹æ•…éšœ</strong>çš„æƒ…å†µã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‚è€ƒSpringçš„æœåŠ¡æ²»ç†æ¨¡å¼ï¼Œæ¯”å¦‚Nacoså’ŒEurekaï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šè¢«å®æ—¶ç›‘æ§ï¼Œé‚£ä¹ˆåªè¦å‡ºç°é—®é¢˜ï¼Œè‚¯å®šæ˜¯å¯ä»¥åŠæ—¶å‘ç°çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿé‡‡å–å“åº”çš„è¡¥æ•‘æªæ–½ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å³å°†ä»‹ç»çš„å“¨å…µï¼š</p><p><img src="https://pb01.s3.bitiful.net/5.png" alt="avatar"></p><p><strong>å“¨å…µ</strong> (<strong>ä¹Ÿæ˜¯ä¸€ä¸ªRedisæœåŠ¡å™¨</strong>)ä¼šå¯¹æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆä¼šç«‹å³è®©ä»èŠ‚ç‚¹è¿›è¡ŒæŠ•ç¥¨ï¼Œé€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šç”±äºä¸»èŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯å†™ï¼ˆæ³¨æ„è¦å®ç°è¿™æ ·çš„åŠŸèƒ½æœ€å°çš„ç³»ç»Ÿå¿…é¡»æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå†å°çš„è¯å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰</p><p>é‚£ä¹ˆæ€ä¹ˆå¯åŠ¨ä¸€ä¸ªå“¨å…µå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶(confæ–‡ä»¶)å³å¯ï¼Œä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor name ip port number</span><br></pre></td></tr></table></figure><p>å…¶ä»–é…ç½®éƒ½æ˜¯æ¬¡è¦çš„,æˆ‘ä»¬éƒ½é‡‡ç”¨é»˜è®¤é…ç½®.</p><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ˜¯å›ºå®šï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸ºç›‘æ§å¯¹è±¡åç§°ï¼Œéšæ„ï¼Œåé¢å°±æ˜¯ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€å’Œç«¯å£ï¼Œæœ€åçš„ä¸€ä¸ªæ•°å­—çš„æ„æ€æ˜¯å½“æœ‰numberä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹æŒ‚æ‰å,æˆ‘ä»¬è®¤ä¸ºä¸»èŠ‚ç‚¹çœŸçš„æŒ‚æ‰äº†,ä¸€èˆ¬numberæ˜¯è¦æ¯”å“¨å…µæ•°é‡å°‘çš„,å› ä¸ºå“¨å…µä¹Ÿå¯èƒ½æŒ‚æ‰.å¦‚æœnumberç­‰äºå“¨å…µæ•°é‡,å¦‚æœå“¨å…µæŒ‚æ‰äº†ä¸€ä¸ª,é‚£ä¹ˆå°±æ°¸è¿œåˆ¤æ–­ä¸å‡ºä¸»èŠ‚ç‚¹æ˜¯å¦æŒ‚äº†.numberä¸€èˆ¬è®¾ç½®ä¸ºå“¨å…µæ•°é‡/2+1.</p><p><strong>ä¸éœ€è¦å¡«å†™å…¶ä»–å“¨å…µä¿¡æ¯,å¦‚ä½•ç»„æˆå“¨å…µé›†ç¾¤?</strong><br>å“¨å…µèŠ‚ç‚¹ä¹‹é—´é€šè¿‡redisçš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶äº’ç›¸å‘ç°,ä¸»èŠ‚ç‚¹æœ‰ä¸€ä¸ª_sentinel_:helloé¢‘é“,å“¨å…µå¯ä»¥å°†è‡ªå·±çš„ipå’Œç«¯å£ä¿¡æ¯å‘åˆ°è¿™ä¸ªé¢‘é“ä¸Š,è¿™æ ·å…¶ä»–å“¨å…µå°±å¯ä»¥é€šè¿‡è®¢é˜…è¿™ä¸ªé¢‘é“æ¥è·å–åˆ°è¿™ä¸ªå“¨å…µçš„ä¿¡æ¯,è¿™æ ·å“¨å…µä¹‹é—´å°±å¯ä»¥å»ºç«‹ç½‘ç»œ,å“¨å…µé›†ç¾¤å°±å½¢æˆäº†.</p><p><img src="https://pb01.s3.bitiful.net/167.webp" alt="avatar"></p><p>å“¨å…µæ¨¡å¼å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œç„¶åè¿˜ä¼šæ˜¾ç¤ºé‚£äº›èŠ‚ç‚¹æ˜¯ä½œä¸ºä»èŠ‚ç‚¹å­˜åœ¨çš„ã€‚å¦‚æœä¸»èŠ‚ç‚¹æŒ‚äº†,ä¸€ä¸ªå“¨å…µè®¤ä¸ºå…¶ä¸»è§‚ä¸‹çº¿,ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·æŠ•ç¥¨,å¦‚æœè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„æ•°é‡åˆ°è¾¾è®¾ç½®å¾—æ•°,åˆ™è®¤ä¸ºä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿.ä¹‹åå°±è¦è¿›è¡Œä¸»ä»åˆ‡æ¢äº†,å“¨å…µèŠ‚ç‚¹ä¸­æŠ•ç¥¨é€‰å‡ºæ‰§è¡Œçš„leader.å€™é€‰è€…ä¸ºåˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿çš„å“¨å…µ,å€™é€‰è€…å¯ä»¥ç»™è‡ªå·±æŠ•ç¥¨,å…¶ä»–å“¨å…µä¸èƒ½ç»™è‡ªå·±æŠ•ç¥¨,æ¯ä¸ªå“¨å…µåªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼š.ä»»ä½•å€™é€‰è€…æƒ³è¦æˆä¸ºleaderéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶:</p><ul><li>æ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„ç¥¨</li><li>ç¥¨æ•°å¤§äºè®¾ç½®çš„numberå€¼</li></ul><p>ä¹‹åleaderä¼šé€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹,å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹,é€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹æ›´æ¢,å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹</p><p><strong>é‚£ä¹ˆï¼Œè¿™ä¸ªé€‰æ–°ä¸»èŠ‚ç‚¹çš„è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿæ˜¯åœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹ä¸­éšæœºé€‰å–è¿˜æ˜¯éµå¾ªæŸç§è§„åˆ™å‘¢ï¼Ÿ</strong></p><ol><li><p>é¦–å…ˆä¼šæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæ·»åŠ replica-priorityé…ç½®é¡¹ï¼ˆé»˜è®¤æ˜¯100ï¼‰ï¼Œè¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚</p></li><li><p>å¦‚æœä¼˜å…ˆçº§ä¸€æ ·ï¼Œé‚£å°±é€‰æ‹©åç§»é‡æœ€å¤§çš„</p></li><li><p>è¦æ˜¯è¿˜é€‰ä¸å‡ºæ¥ï¼Œé‚£å°±é€‰æ‹©runidï¼ˆå¯åŠ¨æ—¶éšæœºç”Ÿæˆçš„ï¼‰æœ€å°çš„ã€‚</p></li></ol><h3 id="é›†ç¾¤æ¨¡å¼">é›†ç¾¤æ¨¡å¼</h3><p>å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨çš„å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„Redisåˆéœ€è¦ç»§ç»­å­˜å‚¨å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é›†ç¾¤æ¥å®ç°æ‰©å®¹ã€‚</p><p>å› ä¸ºå•æœºçš„å†…å­˜å®¹é‡æœ€å¤§å°±é‚£ä¹ˆå¤šï¼Œå·²ç»æ²¡åŠæ³•å†ç»§ç»­æ‰©å±•äº†ï¼Œä½†æ˜¯ç°åœ¨åˆéœ€è¦å­˜å‚¨æ›´å¤šçš„å†…å®¹ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥è®©Nå°æœºå™¨ä¸Šçš„Redisæ¥åˆ†åˆ«å­˜å‚¨å„ä¸ªéƒ¨åˆ†çš„æ•°æ®ï¼ˆæ¯ä¸ªRediså¯ä»¥å­˜å‚¨1/Nçš„æ•°æ®é‡ï¼‰ï¼Œè¿™æ ·å°±å®ç°äº†å®¹é‡çš„æ¨ªå‘æ‰©å±•ã€‚åŒæ—¶æ¯å°Redisè¿˜å¯ä»¥é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p><img src="https://pb01.s3.bitiful.net/6.png" alt="avatar"></p><h4 id="é›†ç¾¤çš„ä½œç”¨">é›†ç¾¤çš„ä½œç”¨</h4><ul><li><p><strong>æ•°æ®åˆ†åŒº</strong>ï¼šæ•°æ®åˆ†åŒº(æˆ–ç§°æ•°æ®åˆ†ç‰‡)æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p><ul><li>é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢çªç ´äº†Rediså•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œå­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ ï¼›å¦ä¸€æ–¹é¢æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œå¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›ã€‚</li><li>Rediså•æœºå†…å­˜å¤§å°å—é™é—®é¢˜ï¼Œåœ¨ä»‹ç»ä¸»ä»å¤åˆ¶æ—¶æœ‰æåŠï¼›ä¾‹å¦‚ï¼Œå¦‚æœå•æœºå†…å­˜å¤ªå¤§ï¼Œbgsaveå’Œbgrewriteaofçš„forkæ“ä½œå¯èƒ½å¯¼è‡´ä¸»è¿›ç¨‹é˜»å¡ï¼Œä¸»ä»ç¯å¢ƒä¸‹ä¸»æœºåˆ‡æ¢æ—¶å¯èƒ½å¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ— æ³•æä¾›æœåŠ¡ï¼Œå…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºå¯èƒ½æº¢å‡ºã€‚</li></ul></li><li><p><strong>é«˜å¯ç”¨</strong>ï¼šé›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰ï¼›å½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></li></ul><p>é‚£ä¹ˆé—®é¢˜æ¥ï¼Œç°åœ¨ç”¨æˆ·æ¥äº†ä¸€ä¸ªå†™å…¥çš„è¯·æ±‚ï¼Œæ•°æ®è¯¥å†™åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹<strong>é›†ç¾¤çš„æœºåˆ¶</strong>ï¼š</p><p>é¦–å…ˆï¼Œä¸€ä¸ªRedisé›†ç¾¤åŒ…å«16384ä¸ªæ’æ§½ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªRedis å®ä¾‹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ’æ§½ä»¥åŠæ’æ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’æ§½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæ’æ§½å°±æ˜¯é”®çš„Hashè®¡ç®—åçš„ä¸€ä¸ªç»“æœï¼Œæ³¨æ„è¿™é‡Œå‡ºç°äº†è®¡ç®—æœºç½‘ç»œä¸­çš„<strong>CRCå¾ªç¯å†—ä½™æ ¡éªŒ</strong>ï¼Œè¿™é‡Œé‡‡ç”¨CRC16ï¼Œèƒ½å¾—åˆ°16ä¸ªbitä½çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ç®—å‡ºæ¥ä¹‹åç»“æœæ˜¯0-65535ä¹‹é—´ï¼Œå†è¿›è¡Œå–æ¨¡ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼š</p><p><strong>Redis keyçš„è·¯ç”±è®¡ç®—å…¬å¼</strong>ï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>=</mo><mi>C</mi><mi>R</mi><mi>C</mi><mn>16</mn><mo stretchy="false">(</mo><mi>k</mi><mi>e</mi><mi>y</mi><mo stretchy="false">)</mo><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext>â€‰</mtext><mtext>â€‰</mtext><mn>16384</mn></mrow><annotation encoding="application/x-tex">slot = CRC16(key)\mod  16384 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">CRC</span><span class="mord">16</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.03588em;">ey</span><span class="mclose">)</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">16384</span></span></span></span></span></p><p>ç»“æœçš„å€¼æ˜¯å¤šå°‘ï¼Œå°±åº”è¯¥å­˜æ”¾åˆ°å¯¹åº”ç»´æŠ¤çš„Redisä¸‹ï¼Œæ¯”å¦‚RedisèŠ‚ç‚¹1è´Ÿè´£0-25565çš„æ’æ§½ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯æ’å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®a=10ï¼Œaåœ¨Hashè®¡ç®—åç»“æœä¸º666ï¼Œé‚£ä¹ˆaå°±åº”è¯¥å­˜æ”¾åˆ°1å·RedisèŠ‚ç‚¹ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç†è®ºCAPåŸåˆ™å’ŒBASEç†è®º</title>
      <link href="/2023/11/12/CAP%E5%8E%9F%E5%88%99/"/>
      <url>/2023/11/12/CAP%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åˆ†å¸ƒå¼ç†è®ºCAPåŸåˆ™å’ŒBASEç†è®º">åˆ†å¸ƒå¼ç†è®ºCAPåŸåˆ™å’ŒBASEç†è®º</h2><hr><h3 id="CAPåŸåˆ™">CAPåŸåˆ™</h3><p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨<strong>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</strong>ï¼Œä¸‰è€…ä¸å¯åŒæ—¶ä¿è¯ï¼Œæœ€å¤šåªèƒ½ä¿è¯å…¶ä¸­çš„ä¸¤è€…ã€‚</p><ul><li><p>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»éƒ½æ˜¯åŒæ ·çš„å€¼ï¼ˆæ‰€æœ‰çš„èŠ‚ç‚¹æ— è®ºä½•æ—¶è®¿é—®éƒ½èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼‰</p></li><li><p>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šç³»ç»Ÿä¸­éæ•…éšœèŠ‚ç‚¹æ”¶åˆ°çš„æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»å¾—åˆ°å“åº”ï¼ˆæ¯”å¦‚æœåŠ¡é™çº§å’Œç†”æ–­ï¼Œå…¶å®å°±æ˜¯ä¸€ç§ç»´æŒå¯ç”¨æ€§çš„æªæ–½ï¼Œè™½ç„¶æœåŠ¡è¿”å›çš„æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„æ•°æ®ï¼Œä½†æ˜¯ä¸è‡³äºç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«æœåŠ¡å™¨å¿½ç•¥ï¼‰</p></li><li><p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ï¼Œç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼ˆæ¯”å¦‚ç½‘ç»œä¸¢åŒ…ç­‰ï¼Œè¿™æ˜¯å¾ˆéš¾é¿å…çš„ï¼‰ï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œæ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ï¼ˆè¿™æ ·å°±å¯èƒ½å‡ºç°æŸäº›è¢«åˆ†åŒºèŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®è®¿é—®å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦æ¥å®¹å¿è¿™äº›ä¸å¯é çš„æƒ…å†µï¼‰</p></li></ul><p>æ€»çš„æ¥è¯´ï¼Œæ•°æ®å­˜æ”¾çš„èŠ‚ç‚¹æ•°è¶Šå¤šï¼Œåˆ†åŒºå®¹é”™æ€§å°±è¶Šé«˜ï¼Œä½†æ˜¯è¦å¤åˆ¶æ›´æ–°çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚åŒæ—¶ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œåªèƒ½å­˜åœ¨ä»¥ä¸‹ä¸‰ç§æ–¹æ¡ˆï¼š</p><h4 id="AC-å¯ç”¨æ€§-ä¸€è‡´æ€§">AC å¯ç”¨æ€§+ä¸€è‡´æ€§</h4><p>è¦åŒæ—¶ä¿è¯å¯ç”¨æ€§å’Œä¸€è‡´æ€§ï¼Œä»£è¡¨ç€è¦ä¿éšœèŠ‚ç‚¹æ•…éšœååˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨ä»¥åŠæŸä¸ªèŠ‚ç‚¹æ•°æ®æ›´æ–°ä¹‹åï¼Œå¯ä»¥ç«‹å³å°†ç»“æœé€šçŸ¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œè¿™æ ·æ‰èƒ½åŠæ—¶å“åº”ä¿è¯ä¸€è‡´æ€§ï¼Œè¿™å°±å¯¹ç½‘ç»œçš„ç¨³å®šæ€§è¦æ±‚éå¸¸é«˜ã€‚ä½†æ˜¯å®é™…æƒ…å†µä¸‹ï¼Œç½‘ç»œå¾ˆå®¹æ˜“å‡ºç°ä¸¢åŒ…ç­‰æƒ…å†µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¯é çš„ä¼ è¾“ï¼Œè¿™ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚ç”¨äºæ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å¥åº·çš„å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œç”±äºç½‘ç»œæŠ–åŠ¨ï¼Œå®ƒçš„çŠ¶å†µä¼šè¢«ä¸€éƒ¨åˆ†èŠ‚ç‚¹è¯¯åˆ¤ï¼›ç½‘ç»œé—®é¢˜è¿˜æœ‰å¯èƒ½å¯¼è‡´ç³»ç»Ÿå†…å¤šä¸ªèŠ‚ç‚¹æ•°æ®ä¸ä¸€è‡´ï¼Œç³»ç»Ÿä¸ºäº†è¾¾æˆâ€œæ•°æ®ä¸€è‡´æ€â€ï¼Œä¼šä¸æ–­è§¦å‘é‡è¯•æœºåˆ¶ï¼Œé€ æˆå¤–éƒ¨è¯·æ±‚é˜»å¡ï¼Œä¸€ç›´æ— æ³•æˆåŠŸå†™å…¥ã€‚å¦‚æœéœ€è¦é¿å…è¿™ç§é—®é¢˜ï¼Œå°±åªèƒ½å°†èŠ‚ç‚¹å…¨éƒ¨æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶è¿èƒŒäº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œæ˜¯å‡ ä¹ä¸å¯èƒ½å®ç°çš„ã€‚</p><h4 id="CP-ä¸€è‡´æ€§-åˆ†åŒºå®¹é”™æ€§">CP ä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§</h4><p>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±å¾—å°†æŸä¸ªèŠ‚ç‚¹çš„æœ€æ–°æ•°æ®å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦ç­‰åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å¾—åˆ°æ•°æ®æ‰èƒ½è¿›è¡Œå“åº”ï¼ŒåŒæ—¶æœ‰äº†åˆ†åŒºå®¹é”™æ€§ï¼Œé‚£ä¹ˆä»£è¡¨æˆ‘ä»¬å¯ä»¥å®¹å¿ç½‘ç»œçš„ä¸å¯é é—®é¢˜ï¼Œæ‰€ä»¥å°±ç®—ç½‘ç»œå‡ºç°å¡é¡¿ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥ï¼Œæ‰èƒ½è¿›è¡Œå“åº”ï¼Œå› æ­¤å°±ä¼šå¯¼è‡´æœåŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…å®Œå…¨å¤±æ•ˆï¼Œæ‰€ä»¥å¯ç”¨æ€§æ˜¯æ— æ³•å¾—åˆ°ä¿è¯çš„ã€‚</p><h4 id="AP-å¯ç”¨æ€§-åˆ†åŒºå®¹é”™æ€§">AP å¯ç”¨æ€§+åˆ†åŒºå®¹é”™æ€§</h4><p>æ—¢ç„¶CPå¯èƒ½ä¼šå¯¼è‡´ä¸€æ®µæ—¶é—´å†…æœåŠ¡å¾—ä¸åˆ°ä»»ä½•å“åº”ï¼Œé‚£ä¹ˆè¦ä¿è¯å¯ç”¨æ€§ï¼Œå°±åªèƒ½æ”¾å¼ƒèŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„é«˜åº¦ç»Ÿä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨æ•°æ®ä¸ç»Ÿä¸€çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå“åº”ï¼Œå› æ­¤å°±æ— æ³•ä¿è¯ä¸€è‡´æ€§äº†ã€‚è™½ç„¶è¿™æ ·ä¼šå¯¼è‡´æ‹¿ä¸åˆ°æœ€æ–°çš„æ•°æ®ï¼Œä½†æ˜¯åªè¦æ•°æ®åŒæ­¥æ“ä½œåœ¨åå°ç»§ç»­è¿è¡Œï¼Œä¸€å®šèƒ½å¤Ÿåœ¨æŸä¸€æ—¶åˆ»å®Œæˆæ‰€æœ‰èŠ‚ç‚¹æ•°æ®çš„åŒæ­¥ï¼Œé‚£ä¹ˆå°±èƒ½å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ‰€ä»¥APå®é™…ä¸Šæ˜¯æœ€èƒ½æ¥å—çš„ä¸€ç§æ–¹æ¡ˆã€‚</p><h3 id="BASEç†è®º">BASEç†è®º</h3><p>Basically Availableã€Soft stateã€Eventually consistentç®€ç§°ä¸º<code>BASEç†è®º</code>ï¼Œç”±eBayç³»ç»Ÿæ¶æ„å¸ˆDan Pritchettäº2008å¹´å‘å¸ƒï¼Œè¯¥ç†è®ºæå‡ºäº†ä¸‰ä¸ªæ¦‚å¿µï¼š</p><ul><li><p>BA(åŸºæœ¬å¯ç”¨): åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸<code>æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</code>ï¼Œå³<code>ä¿è¯æ ¸å¿ƒå¯ç”¨</code>ï¼Œè€Œå…¶ä»–éæ ¸å¿ƒå¯ç”¨æ€§å¯ä»¥æš‚æ—¶åœæ­¢æœåŠ¡ã€‚æ¯”å¦‚ç”µå•†å¤§ä¿ƒæ—¶ï¼Œä¸ºäº†åº”å¯¹è®¿é—®é‡æ¿€å¢ï¼Œéƒ¨åˆ†ç”¨æˆ·å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°é™çº§é¡µé¢ï¼ŒæœåŠ¡å±‚ä¹Ÿå¯èƒ½åªæä¾›é™çº§æœåŠ¡ã€‚</p></li><li><p>S(è½¯çŠ¶æ€): è½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨<code>ä¸­é—´çŠ¶æ€</code>ï¼Œè€Œè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ã€‚å°±æ¯”å¦‚ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“é‡Œçš„äº‹åŠ¡æœºåˆ¶ï¼Œå‡è®¾æ²¡æœ‰äº‹åŠ¡æœºåˆ¶ï¼Œå†™å…¥æ•°æ®å°±åªæœ‰æˆåŠŸã€å¤±è´¥ä¸¤ç§çŠ¶æ€ï¼Œè€Œæœ‰äº†äº‹åŠ¡æœºåˆ¶åï¼Œåœ¨æˆåŠŸä¸å¤±è´¥ä¹‹é—´ï¼Œå¤šäº†ä¸€ä¸ªä¸­é—´æ€ï¼Œå³ï¼šæ•°æ®å†™å…¥æˆåŠŸï¼Œäº‹åŠ¡æš‚æœªæäº¤ï¼Œè¿™ä¸ªä¸­é—´æ€çš„å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå½±å“æ•°æ®åº“æ•´ä½“çš„å¯ç”¨æ€§ã€‚</p></li><li><p>E(æœ€ç»ˆä¸€è‡´æ€§): æœ€ç»ˆä¸€è‡´æ€§æ˜¯æŒ‡ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚åœ¨BASEç†è®ºä¸­ï¼Œæœ€ç»ˆä¸€è‡´æ€§æ˜¯å’Œè½¯çŠ¶æ€ç»‘å®šçš„ï¼Œä¸¤è€…éœ€è¦ç»“åˆåœ¨ä¸€èµ·ç†è§£ã€‚å‰é¢è¯´åˆ°ï¼Œè½¯çŠ¶æ€å…è®¸ç³»ç»Ÿå†…å­˜åœ¨ä¸­é—´æ€ï¼Œä½†è¦è®°ä½ï¼šå¦‚æœè¿™ä¸ªä¸­é—´æ€ï¼Œä¸€ç›´ä¸å˜æˆç»ˆæ€ï¼Œè€Œæ˜¯å¡åœ¨é‚£é‡Œçš„è¯ï¼Œå°±ä¼šå½±å“ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ã€‚æ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡å¤„äºä¸­é—´æ€ï¼ˆå†™å…¥æˆåŠŸï¼Œä½†ä¸€ç›´ä¸æäº¤ï¼‰ï¼›å½“å…¶ä»–è¯·æ±‚ç»§ç»­å¯¹è¯¥äº‹åŠ¡æ“ä½œçš„æ•°æ®è¡Œè¿›è¡Œæ›´æ–°æ—¶ï¼Œå°±ä¼šè¢«é˜»å¡ï¼Œä»è€Œå½±å“äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œè¿™å°±è¿èƒŒäº†â€œè½¯çŠ¶æ€â€çš„å®šä¹‰ã€‚</p></li></ul><h4 id="BASEå’ŒCAPçš„å…³ç³»">BASEå’ŒCAPçš„å…³ç³»</h4><p><code>æœ‰äººè¯´BASEç†è®ºæ˜¯å¯¹CAPç†è®ºçš„å»¶ä¼¸</code>ï¼šBASEç†è®ºè®¤ä¸ºï¼Œå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼Œå³BASEç†è®ºæ˜¯åœ¨CAPåŸºç¡€ä¸Šï¼Œæ»¡è¶³APåå¯¹Cæ–¹é¢çš„æ‹“å±•ä¸å»¶ä¼¸ã€‚<code>å…¶å®è¿™ç§è®¤çŸ¥æ˜¯é”™è¯¯çš„</code>ï¼Œ BASEç†è®ºä¸­çš„ä¸€è‡´æ€§å’ŒCAPä¸­çš„ä¸€è‡´æ€§å¹¶ä¸ç›¸åŒï¼ŒCAPä¸­çš„ä¸€è‡´æ€§æ˜¯è¦ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®çš„ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œè€ŒBASEç†è®ºä¸­çš„ä¸€è‡´æ€§å’Œæ•°æ®åº“çš„ACIDç‰¹æ€§ä¸­çš„ä¸€è‡´æ€§æ˜¯å·®ä¸å¤šçš„æ„æ€ã€‚</p><p>ACIDä¸­çš„ä¸€è‡´æ€§: ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“åªèƒ½ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚æ¯”å¦‚å°æ˜è¦å¾€å°çº¢çš„è´¦æˆ·è½¬10ä¸‡å…ƒï¼Œå°æ˜çš„è´¦æˆ·åŸæœ¬æœ‰66ä¸‡ï¼Œå°çº¢çš„è´¦æˆ·åŸæœ¬æœ‰56ä¸‡ï¼Œå°æ˜è½¬äº†10ä¸‡å…ƒä¹‹åï¼Œå°æ˜çš„è´¦æˆ·å°±å˜æˆäº†56ä¸‡ï¼Œå°çº¢çš„è´¦æˆ·å°±å˜æˆäº†66ä¸‡ï¼Œè€Œæ€»çš„é’±ä¸å˜ï¼Œä»ä¸º122ä¸‡å…ƒï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€çš„è½¬å˜ã€‚CAPçš„ä¸€è‡´æ€§ï¼Œå…³æ³¨çš„æ˜¯æ•°æ®ä¸€è‡´æ€§ï¼›BASEçš„ä¸€è‡´æ€§ï¼Œå…³æ³¨çš„æ˜¯çŠ¶æ€ä¸€è‡´æ€§ã€‚ä¸å…¶è¯´BASEç†è®ºæ˜¯å¯¹CAPç†è®ºçš„å»¶ä¼¸ï¼Œä¸å¦‚è¯´BASEç†è®ºæ˜¯å¯¹ACIDç†è®ºçš„å»¶ä¼¸(<code>ç‰¹æŒ‡åˆ†å¸ƒå¼åœºæ™¯</code>)ã€‚</p><p>CAPå’ŒBASEä¸­å¯¹äºå¯ç”¨æ€§çš„å®šä¹‰æ˜¯ä¸åŒçš„ï¼šCAPä¸­AèŠ‚ç‚¹å‡ºç°æ•…éšœ, å»BèŠ‚ç‚¹ä¹Ÿå¯ä»¥å¾—åˆ°ç›¸åŒçš„å“åº”(CAPä¸­çš„èŠ‚ç‚¹æ˜¯å…¨é‡å¤åˆ¶çš„,ç†æƒ³æƒ…å†µä¸‹è§£é‡Šå®Œå…¨ç›¸åŒçš„). è€Œåœ¨BASEä¸­, åŸºæœ¬å¯ç”¨æ˜¯ç”¨æ¥é™ä½é£é™©çš„, ä¸åŒçš„èŠ‚ç‚¹æ˜¯å®Œå…¨ä¸åŒçš„, å¯ä»¥ç±»æ¯”ä¸ºå°†æ•°æ®åº“åšäº†æ°´å¹³æ‹†åˆ†, å¦‚æœæ€»å…±10ä¸ªèŠ‚ç‚¹, ä¸‰ä¸ªæŒ‚äº†, åªä¼šæœ‰30%çš„ç”¨æˆ·å—åˆ°å½±å“.</p><p>CAPç†è®ºæ›´å±€é™äºåˆ†å¸ƒå¼å­˜å‚¨é¢†åŸŸ, è€ŒBASEç†è®ºé€‚ç”¨äºå„ç±»åˆ†å¸ƒå¼ç³»ç»Ÿ, å…¶ä¸­å®šä¹‰çš„ä¸‰ä¸ªæ¦‚å¿µï¼Œè¦†ç›–äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤§å¤šæ•°åœºæ™¯.</p>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™</title>
      <link href="/2023/11/04/%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
      <url>/2023/11/04/%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™">é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™</h2><hr><h4 id="å•ä¸€èŒè´£åŸåˆ™-Single-Responsibility-Principle">å•ä¸€èŒè´£åŸåˆ™(Single Responsibility Principle)</h4><p>ä¸»è¦æŒ‡çš„æ˜¯ä¸€ä¸ªç±»,æ–¹æ³•,æ¥å£ä¸­åªå®ç°å•ä¸€èŒè´£,è¿™æ ·èƒ½å¤Ÿæå‡ä»£ç å¯è¯»æ€§,å¯ç»´æŠ¤æ€§ä¹Ÿå¤§å¤§æé«˜,æœ‰æ•ˆé¿å…äº†å±å±±ä»£ç çš„å‡ºç°(<strong>ç¡®ä¿¡</strong>),è¿›è¡ŒåŠŸèƒ½å˜æ›´æ—¶çš„é£é™©ä¹Ÿä¼šé™ä½.</p><h4 id="å¼€é—­åŸåˆ™-Open-Closed-Principle">å¼€é—­åŸåˆ™(Open Closed Principle)</h4><p><strong>å¯¹äºæ‰©å±•å¼€æ”¾,å¯¹äºä¿®æ”¹å°é—­.</strong></p><p>ä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥é€šè¿‡æ‰©å±•æ¥å®ç°å˜åŒ–,è€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç å®ç°å˜åŒ–.è¿™æ˜¯ä¸ºè½¯ä»¶å®ä½“çš„æœªæ¥äº‹ä»¶è€Œåˆ¶å®šçš„å¯¹ç°è¡Œå¼€å‘è®¾è®¡è¿›è¡Œçº¦æŸçš„ä¸€ä¸ªåŸåˆ™.</p><p>æ¯”å¦‚ä¸€ä¸ªç±»å¯èƒ½æœ‰å¤šæ–¹éœ€è¦è°ƒç”¨,æœ‰æ—¶éƒ¨åˆ†è°ƒç”¨æ–¹æœ‰äº†æ–°çš„éœ€æ±‚,è¿™æ—¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ç±»çš„ä»£ç æ¥æ›´æ”¹åŠŸèƒ½,è€Œæ˜¯éœ€æ±‚æ–¹å°†è¿™ä¸ªç±»ç»§æ‰¿è¿‡å»å†è¿›è¡Œæ·»åŠ ,ä¿®æ”¹åŠŸèƒ½,è¿™æ ·å‡ºé—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è°ƒç”¨æ–¹,çœŸæ­£åšåˆ°é«˜å†…èš,ä½è€¦åˆ.</p><p>å…¶å®ç±»çš„ä¾‹å­è¿˜ä¸å¤Ÿå‡†ç¡®,ä¸€èˆ¬éƒ½æ˜¯å…ˆå°†èŒè´£æ–¹æ³•æŠ½è±¡æˆæ¥å£,ç„¶åå†æ ¹æ®å„è‡ªéœ€æ±‚çš„ä¸åŒè¿›è¡Œå…·ä½“å®ç°.</p><h4 id="é‡Œå¼æ›¿æ¢åŸåˆ™-Liskov-Substitution-Principle">é‡Œå¼æ›¿æ¢åŸåˆ™(Liskov Substitution Principle)</h4><p><strong>æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½å¤Ÿé€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡.</strong></p><p>é€šä¿—ç‚¹è¯´ï¼Œåªè¦çˆ¶ç±»èƒ½å‡ºç°çš„åœ°æ–¹å­ç±»å°±å¯ä»¥å‡ºç°,è€Œä¸”æ›¿æ¢ä¸ºå­ç±»ä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å¼‚å¸¸.ä½†æ˜¯åè¿‡æ¥å°±ä¸è¡Œäº†,å› ä¸ºå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»æ²¡æœ‰çš„åŠŸèƒ½,åŒæ—¶å­ç±»è¿˜ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½.</p><p>é‡Œæ°æ›¿æ¢åŸåˆ™ä¸ºè‰¯å¥½çš„ç»§æ‰¿å®šä¹‰äº†ä¸€ä¸ªè§„èŒƒï¼Œå®ƒåŒ…å«äº†4å±‚å«ä¹‰ï¼š</p><p>1ã€å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•,ä½†æ˜¯ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•.</p><p>2ã€å­ç±»å¯ä»¥æœ‰è‡ªå·±çš„ä¸ªæ€§,å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•.</p><p>3ã€å­ç±»è¦†ç›–æˆ–é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å…¥å‚æ•°å¯ä»¥è¢«æ”¾å¤§.</p><p>4ã€å­ç±»è¦†ç›–æˆ–é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å‡ºç»“æœå¯ä»¥è¢«ç¼©å°,ä¹Ÿå°±æ˜¯è¯´è¿”å›å€¼è¦å°äºæˆ–ç­‰äºçˆ¶ç±»çš„æ–¹æ³•è¿”å›å€¼.</p><h4 id="è¿ªç±³ç‰¹æ³•åˆ™-Law-of-Demeter">è¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter)</h4><p><strong>ä¸€ä¸ªå¯¹è±¡åº”å°½é‡å‡å°‘å¯¹å…¶ä»–å¯¹è±¡çš„äº†è§£.</strong></p><p>ä¸€ä¸ªç±»åº”è¯¥å¯¹è‡ªå·±éœ€è¦è€¦åˆæˆ–è°ƒç”¨çš„ç±»çŸ¥é“çš„æœ€å°‘,ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»è¶Šå¯†åˆ‡,è€¦åˆåº¦è¶Šå¤§,é‚£ä¹ˆç±»çš„å˜åŒ–å¯¹å…¶è€¦åˆçš„ç±»çš„å½±å“ä¹Ÿä¼šè¶Šå¤§,è¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¢å‘è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™:é«˜å†…èš,ä½è€¦åˆ.</p><h4 id="æ¥å£éš”ç¦»åŸåˆ™-Interface-Segregation-Principle">æ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle)</h4><p><strong>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£</strong></p><p>æ„æ€å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦ä»€ä¹ˆæ¥å£å°±æä¾›ä»€ä¹ˆæ¥å£ï¼ŒæŠŠä¸éœ€è¦çš„æ¥å£å‰”é™¤æ‰ï¼Œè¿™å°±éœ€è¦å¯¹æ¥å£è¿›è¡Œç»†åŒ–ï¼Œä¿è¯æ¥å£çš„çº¯æ´æ€§ã€‚æ¢æˆå¦ä¸€ç§è¯´æ³•å°±æ˜¯ï¼Œç±»é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œä¹Ÿå°±æ˜¯å»ºç«‹å•ä¸€çš„æ¥å£ã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œå»ºç«‹å•ä¸€æ¥å£ï¼Œè¿™ä¸æ˜¯å•ä¸€èŒè´£åŸåˆ™å—ï¼Ÿå…¶å®ä¸æ˜¯ï¼Œå•ä¸€èŒè´£åŸåˆ™è¦æ±‚çš„æ˜¯ç±»å’Œæ¥å£èŒè´£å•ä¸€ï¼Œæ³¨é‡çš„æ˜¯èŒè´£ï¼Œä¸€ä¸ªèŒè´£çš„æ¥å£æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•çš„ï¼Œè€Œæ¥å£éš”ç¦»åŸåˆ™è¦æ±‚çš„æ˜¯æ¥å£çš„æ–¹æ³•å°½é‡å°‘ï¼Œæ¨¡å—å°½é‡å•ä¸€ï¼Œå¦‚æœéœ€è¦æä¾›ç»™å®¢æˆ·ç«¯å¾ˆå¤šçš„æ¨¡å—ï¼Œé‚£ä¹ˆå°±è¦ç›¸åº”çš„å®šä¹‰å¤šä¸ªæ¥å£ï¼Œä¸è¦æŠŠæ‰€æœ‰çš„æ¨¡å—åŠŸèƒ½éƒ½å®šä¹‰åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œé‚£æ ·ä¼šæ˜¾å¾—å¾ˆè‡ƒè‚¿ã€‚</p><h4 id="ä¾èµ–å€’ç½®åŸåˆ™-Dependency-Inversion-Principle">ä¾èµ–å€’ç½®åŸåˆ™(Dependency Inversion Principle)</h4><p><strong>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—,ä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡;</strong><br><strong>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚;</strong><br><strong>ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡.</strong></p><p>æŠ½è±¡å°±æ˜¯æŒ‡æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œä¸¤è€…éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼›è€Œç»†èŠ‚å°±æ˜¯å®ç°æ¥å£æˆ–ç»§æ‰¿æŠ½è±¡ç±»äº§ç”Ÿçš„ç±»ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è¢«å®ä¾‹åŒ–çš„å®ç°ç±»ã€‚ä¾èµ–å€’ç½®åŸåˆ™æ˜¯æŒ‡æ¨¡å—é—´çš„ä¾èµ–æ˜¯é€šè¿‡æŠ½è±¡æ¥å‘ç”Ÿçš„ï¼Œå®ç°ç±»ä¹‹é—´ä¸å‘ç”Ÿç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æ˜¯æ¥å®ç°çš„ï¼Œè¿™å°±æ˜¯ä¿—ç§°çš„é¢å‘æ¥å£ç¼–ç¨‹ã€‚</p><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰ç»†å¿ƒçš„åŒå­¦å‘ç°,è¿™å…­å¤§åŸåˆ™çš„é¦–å­—æ¯å¯ä»¥ç»„æˆä¸€ä¸ªå•è¯:SOLID,å¯èƒ½è¿™å°±æ˜¯è¿™å…­å¤§è®¾è®¡åŸåˆ™æƒ³è¾¾åˆ°çš„ç›®æ ‡å§.</p><h4 id="References">References</h4><ul><li>ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹ç¬¬äºŒç‰ˆ</li><li>ã€Šé‡å­¦Javaè®¾è®¡æ¨¡å¼ã€‹by xfg</li><li><a href="https://blog.csdn.net/txaz6/article/details/120138199" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">é¢å‘å¯¹è±¡è®¾è®¡çš„å…­å¤§è®¾è®¡åŸåˆ™</a><br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡åŸåˆ™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¹è§‚é”å’Œæ‚²è§‚é”</title>
      <link href="/2023/10/30/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/"/>
      <url>/2023/10/30/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ä¹è§‚é”å’Œæ‚²è§‚é”">ä¹è§‚é”å’Œæ‚²è§‚é”</h2><h3 id="ä¹è§‚é”">ä¹è§‚é”</h3><p>ä¹è§‚è®¤ä¸ºä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¸å®ƒæ¥æŠ¢å ä¿®æ”¹,ç›´æ¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹,åœ¨æäº¤çš„æ—¶å€™è¿›è¡Œæ£€æŸ¥,çœ‹æ˜¯å¦æœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹è¿‡æ•°æ®,å¦‚æœä¿®æ”¹è¿‡,å°±æ”¾å¼ƒä¿®æ”¹,è¿”å›é”™è¯¯æˆ–è€…é‡è¯•.</p><p>ä¹è§‚é”ä¸€èˆ¬æœ‰ä¸¤ç§å®ç°æ–¹å¼:<strong>ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•</strong></p><h4 id="ç‰ˆæœ¬å·æœºåˆ¶-redisé‡‡ç”¨çš„æ–¹æ¡ˆ">ç‰ˆæœ¬å·æœºåˆ¶(redisé‡‡ç”¨çš„æ–¹æ¡ˆ)</h4><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å· version å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversion å€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹ A è¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å– version å€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„ version å€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„ version å€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><h4 id="CASç®—æ³•">CASç®—æ³•</h4><p>CAS çš„å…¨ç§°æ˜¯ <strong>Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰</strong> ï¼Œç”¨äºå®ç°ä¹è§‚é”ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå„å¤§æ¡†æ¶ä¸­ã€‚CAS çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªé¢„æœŸå€¼å’Œè¦æ›´æ–°çš„å˜é‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸¤å€¼ç›¸ç­‰æ‰ä¼šè¿›è¡Œæ›´æ–°ã€‚</p><p>CASç®—æ³•ä¼šæœ‰ä¸€ä¸ª<strong>å·¨å¤§çš„é—®é¢˜</strong>,å°±æ˜¯<em><strong>ABAé—®é¢˜</strong></em>.å¦‚æœä¸€ä¸ªå˜é‡ V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯ A å€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å› Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚ABA é—®é¢˜çš„è§£å†³æ€è·¯æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Š<strong>ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³(javaé‡‡ç”¨çš„æ–¹æ¡ˆ)</strong>ã€‚</p><p>CASç®—æ³•è¿˜æœ‰ä¸€ä¸ª<strong>é—®é¢˜</strong>å°±æ˜¯<strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>.CAS ç»å¸¸ä¼šç”¨åˆ°è‡ªæ—‹æ“ä½œæ¥è¿›è¡Œé‡è¯•ï¼Œä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><h4 id="ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š">ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š</h4><p>1.ä¹è§‚é”é€‚ç”¨äºå¹¶å‘è¯»æ“ä½œè¾ƒå¤šçš„åœºæ™¯ï¼Œå› ä¸ºè¯»æ“ä½œä¸æ¶‰åŠåˆ°æ•°æ®çš„ä¿®æ”¹ï¼Œä¸éœ€è¦åŠ é”ã€‚<br>2.ä¹è§‚é”åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œåªæœ‰åœ¨æäº¤æ›´æ–°æ“ä½œæ—¶æ‰å¯¹æ•°æ®è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œå‡å°‘äº†åŠ é”å’Œè§£é”çš„å¼€é”€ã€‚<br>3.ä¹è§‚é”å¯èƒ½éœ€è¦è¿›è¡Œé‡è¯•ï¼Œä»¥å¤„ç†å¹¶å‘ä¿®æ”¹å¼•èµ·çš„å†²çªã€‚</p><h3 id="æ‚²è§‚é”">æ‚²è§‚é”</h3><p>æ‚²è§‚é”æ€»è®¤ä¸ºä¼šåˆ«çš„çº¿ç¨‹å›æ¥æŠ¢å ä¿®æ”¹,äºæ˜¯é‡‡ç”¨ä¸€ç§<strong>é˜²å¾¡çš„å§¿æ€</strong>å°†æ•°æ®é”ä½,æ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ã€‚</p><h4 id="æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š">æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š</h4><p>1.æ‚²è§‚é”é€‚ç”¨äºå¹¶å‘å†™æ“ä½œè¾ƒå¤šçš„åœºæ™¯ï¼Œå› ä¸ºå†™æ“ä½œæ¶‰åŠåˆ°æ•°æ®çš„ä¿®æ”¹ï¼Œéœ€è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚<br>2.æ‚²è§‚é”åœ¨åŠ é”æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¢«é”å®šçš„èµ„æºï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚<br>3.æ‚²è§‚é”éœ€è¦é¢‘ç¹åœ°è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œï¼Œå¼€é”€è¾ƒå¤§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»å…¸ç»„åˆé—®é¢˜</title>
      <link href="/2023/10/18/%E7%BB%8F%E5%85%B8%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98/"/>
      <url>/2023/10/18/%E7%BB%8F%E5%85%B8%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ç»å…¸ç»„åˆé—®é¢˜">ç»å…¸ç»„åˆé—®é¢˜</h1><hr><p>åœ¨<strong>Leetcode</strong>åˆ·è¿‡<strong>å›æº¯ç®—æ³•</strong>çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“,ç»„åˆé—®é¢˜æ˜¯å›æº¯ç®—æ³•ä¸­ç»å…¸çš„ä¸€ç§é¢˜å‹</p><p>æœ¬ç¯‡åšå®¢ç»™å¤§å®¶ä»‹ç»çš„å°±æ˜¯ç»„åˆé—®é¢˜ä¸‰å…„å¼Ÿ:<br><em><strong>39.æ•°ç»„æ€»å’Œ</strong></em><br><em><strong>40.æ•°ç»„æ€»å’ŒII</strong></em><br><em><strong>216.æ•°ç»„æ€»å’ŒIII</strong></em></p><p>ä¸ºä»€ä¹ˆæˆ‘æƒ³è¯´è¯´è¿™ä¸‰é“é¢˜å‘¢,å› ä¸ºè¿™ä¸‰é“é¢˜çš„æœ¬è´¨å°±æ˜¯å¥—å›æº¯ç®—æ³•çš„æ¨¡ç‰ˆ</p><p>å±äºåªè¦å¼„æ˜ç™½äº†,é‚£ä¹ˆç»„åˆé—®é¢˜å°±ä¸€å®šæ²¡é—®é¢˜äº†,ç”šè‡³å¤§éƒ¨åˆ†çš„å›æº¯ç®—æ³•é—®é¢˜ä¹Ÿèƒ½å¤Ÿè§£å†³</p><p>å›æº¯æ³•ï¼ˆback trackingï¼‰ï¼ˆæ¢ç´¢ä¸å›æº¯æ³•ï¼‰æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼Œåˆç§°ä¸ºè¯•æ¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚<strong>ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›åˆ°ä¸Šä¸€æ­¥ï¼Œé‡æ–°é€‰æ‹©</strong>,è¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚</p><p>å›æº¯ç®—æ³•çš„å…³é”®åœ¨äºæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶,æ— è®ºæ˜¯å­è¿‡ç¨‹ç»“æŸçš„ç»ˆæ­¢æ¡ä»¶,è¿˜æ˜¯å›é€€åˆ°ä¸Šä¸€æ­¥çš„ç»ˆæ­¢æ¡ä»¶.</p><p>ä¾‹å¦‚ <strong>39æ•°ç»„æ€»å’Œ</strong> è¿™é“é¢˜ä¸­å­è¿‡ç¨‹çš„ç»ˆæ­¢æ¡ä»¶ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">    ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é€€åˆ°ä¸Šä¸€æ­¥çš„ç»ˆæ­¢æ¡ä»¶ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯è§£å†³é—®é¢˜çš„å…³é”®</p><p><strong>å›æº¯ç®—æ³•æ¨¡ç‰ˆ(ä¼ªä»£ç ç‰ˆ)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(å‚æ•°)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        å­˜æ”¾ç»“æœ;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) &#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); <span class="comment">// é€’å½’</span></span><br><span class="line">        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å›æº¯ç®—æ³•æ¨¡ç‰ˆ(è¯¦ç»†ç‰ˆ)å°±æ˜¯39æ•°ç»„æ€»å’Œçš„ä»£ç </strong></p><h2 id="39æ•°ç»„æ€»å’Œ">39æ•°ç»„æ€»å’Œ</h2><h4 id="1-æ ‡å‡†å›æº¯">1.æ ‡å‡†å›æº¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtrack(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(candidates[i]);</span><br><span class="line">            backtrack(candidates,target-candidates[i],i);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="40æ•°ç»„æ€»å’ŒII">40æ•°ç»„æ€»å’ŒII</h2><p>è·Ÿ39é¢˜éå¸¸åƒ,å°±æ˜¯è¦é˜²æ­¢é‡å¤å‡ºç°çš„å­é›†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        combine(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combine</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;start&amp;&amp;candidates[i]==candidates[i-<span class="number">1</span>])&#123;<span class="comment">//æœ€å…³é”®çš„å°±æ˜¯è¿™ä¸ª</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(candidates[i]);</span><br><span class="line">            combine(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="216æ•°ç»„æ€»å’ŒIII">216æ•°ç»„æ€»å’ŒIII</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=k)&#123;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">        combine(k,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combine</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">                ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n-i&lt;<span class="number">0</span>||k&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(i);</span><br><span class="line">            combine(k-<span class="number">1</span>,n-i,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> sde </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼°å€¼åŸç†å¬åæ„Ÿ</title>
      <link href="/2023/10/12/%E4%BC%B0%E5%80%BC%E5%8E%9F%E7%90%86/"/>
      <url>/2023/10/12/%E4%BC%B0%E5%80%BC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¼°å€¼åŸç†å¬åæ„Ÿ">ä¼°å€¼åŸç†å¬åæ„Ÿ</h1><hr><p>å†™æœ¬æ–‡çš„åŸå› æ˜¯åœ¨å°å®‡å®™ä¸Šå¬äº†é¢åŸºçš„ä¸€æœŸæ’­å®¢:<a href="https://www.xiaoyuzhoufm.com/episode/6523d01550cf691d244cf8d5?s=eyJ1IjoiNjQ2MzY1NThlZGNlNjcxMDRhZjVlY2Q5In0%3D" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ã€Šä¼°å€¼åŸç†ã€‹:ä»æ²¡æƒ³è¿‡è¿˜å¯ä»¥è¿™ä¹ˆçœ‹ä¼°å€¼!</a>,ç»™äº†æˆ‘ä¸€äº›æ€è€ƒå’Œå¯å‘</p><h2 id="ä¼°å€¼">ä¼°å€¼</h2><p>ä¼°å€¼æ˜¯æŒ‡è¯„å®šä¸€é¡¹èµ„äº§å½“æ—¶ä»·å€¼çš„è¿‡ç¨‹,è¿™æ˜¯ç™¾åº¦ç™¾ç§‘çš„å®šä¹‰</p><p>é‚£ä»·å€¼åˆæ˜¯ä»€ä¹ˆå‘¢?ä»·å€¼,æ³›æŒ‡å®¢ä½“å¯¹äºä¸»ä½“è¡¨ç°å‡ºæ¥çš„ç§¯ææ„ä¹‰å’Œæœ‰ç”¨æ€§.è¿™ä¹Ÿæ˜¯ç™¾åº¦ç™¾ç§‘çš„å®šä¹‰.</p><p>æ‰€ä»¥è¯´ä»·å€¼è¿™ä¸ªä¸œè¥¿æ˜¯å› äººè€Œå¼‚çš„,æ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„è§‚å¿µ,ä»–ä»¬å¯¹åŒä¸€æ ·èµ„äº§(ç‰©å“)çš„çœ‹æ³•æ˜¯ä¸åŒçš„,å› è€ŒåŒä¸€æ ·èµ„äº§å¯¹ä¸åŒäººæ¥è¯´å…·æœ‰ä¸åŒçš„ä»·å€¼.</p><p>æ¯”å¦‚è¯´,é’»çŸ³,å¯¹äºæˆ‘è¿™ç§ç†å·¥ç§‘ç›´ç”·æ¥è¯´å°±æ˜¯å¥½çœ‹ä¸€ç‚¹çš„ç¢³,æ²¡æœ‰ç‰¹æ®Šçš„ä»·å€¼,ä½†åœ¨å¦ä¸€äº›äººçœ¼é‡Œå°±æ˜¯çˆ±æƒ…çš„è±¡å¾.</p><p>å¯è™½ç„¶å¯¹ä¸åŒçš„äººæ¥è¯´èµ„äº§çš„ä»·å€¼æ˜¯æœ‰å¾ˆå¤§å·®å¼‚çš„,ä½†æ˜¯è¿™äº›èµ„äº§åœ¨å¸‚åœºä¸ŠåŸºæœ¬æœ‰ç€ç›¸å¯¹ç¨³å®šçš„ä»·æ ¼,è¿™å°±å¯ä»¥å¼•å‡ºè¿™æœ¬ä¹¦çš„ä¸€ä¸ªè§‚ç‚¹:<strong>ä»·å€¼æ¸¸æˆè®º</strong></p><h2 id="ä»·å€¼æ¸¸æˆè®º">ä»·å€¼æ¸¸æˆè®º</h2><p>ä»·æ ¼æ˜¯ä¼°å€¼çš„æœ€ç›´è§‚ä½“ç°,æ‰€ä»¥äººä»¬æ€»è§‰å¾—,ä¼°å€¼æ¥æºäºäº¤æ˜“,è€Œäº¤æ˜“è„±èƒäºå¸‚åœº.ä½†è¿™å…¶å®æ˜¯ä¸€ç§è¯¯è§£,å¸‚åœºåªæ˜¯æä¾›äº†äº¤æ˜“ä¾¿åˆ©å’Œæ¸…ç®—æœåŠ¡è€Œå·²,ä¼°å€¼æ¥è‡ªç¤¾ä¼š</p><p>å¦‚æœä¸€ä¸ªç¤¾ä¼šè¦æå€¡æŸç§ä»·å€¼è§‚ï¼Œå°±ä¸€å®šä¼šç”¨ç›¸åº”çš„èµ„äº§å»ä½“ç°è¿™ç§ä»·å€¼è§‚.æˆ–è€…è¯´,å½“ä¸€ä¸ªç¤¾ä¼šå†³å®šç”¨ä¸€åœºæ¸¸æˆæ¥è§£å†³æŸä¸ªç¤¾ä¼šé—®é¢˜æ—¶,ä»–ä»¬ä¼šæ ¹æ®æƒ…å†µé€‰æ‹©æ˜¯æ£’çƒèµ›è¿˜æ˜¯è¶³çƒèµ›è¿˜æ˜¯ç¯®çƒèµ›</p><p>è¿™åœºæ¸¸æˆéœ€è¦ä¸€äº›ç‰¹å®šçš„ç¾å¾·ã€ç§©åºã€è§„èŒƒã€å…±è¯†,è¿™äº›è¢«é¼“åŠ±çš„ä¸œè¥¿éƒ½éœ€è¦ä¸€ä¸ªå¾ˆå…·ä½“çš„è½½ä½“.è¿™ä¸ªè½½ä½“å°±æ˜¯é‚£é¢—çƒ,é‚£é¢—çƒå°±æ˜¯è¢«å…¨ç¤¾ä¼šè¿½æ§çš„èµ„äº§,å®ƒä¸€å®šäº«å—é«˜ä¼°å€¼</p><p>æˆ¿äº§ã€è‚¡ç¥¨ã€é»„é‡‘ã€ç¢³æ’æ”¾é¢ï¼Œä»»ä½•ä¸€é¡¹èµ„äº§éƒ½ç¬¦åˆä¸”æœä»äºå„è‡ªç¤¾ä¼šçš„ä¼°å€¼ä½“ç³»ã€‚è¿™äº›ä¼°å€¼ä½“ç³»æ ¹æ¤äºå…¨ç¤¾ä¼šçš„æ€æƒ³è§‚å¿µå’Œé£ä¿—ä¹ æƒ¯ä¹‹ä¸­ã€‚</p><p>ä¸ºä»€ä¹ˆæœ‰çš„å›½å®¶è‚¡ç¥¨æ¶¨å¾—å‰å®³?</p><p>ä¸ºä»€ä¹ˆåŒä¸€æ—¶æœŸæœ‰çš„å›½å®¶æˆ¿äº§æ¶¨å¾—å‰å®³è€Œè‚¡ç¥¨å´ä¸€è·Œå†è·Œ?</p><p>ä¸ºä»€ä¹ˆå¤®è¡Œé‡Šæ”¾äº†æµåŠ¨æ€§ï¼Œç»“æœå´å¯¼è‡´æˆ¿ä»·ä¸Šæ¶¨ï¼Œè‚¡ä»·ä¸‹è·Œ?</p><p>è¿™æ˜¯å› ä¸ºäººä»¬ç”¨èµ„äº§åœ¨ç©ä¸åŒçš„æ¸¸æˆï¼Œä½¿ç”¨äº†ä¸åŒçš„è§„åˆ™å¯¼è‡´çš„.æ‰€ä»¥ï¼Œåœ¨ä»·æ ¼æ¶¨è·Œä¹‹å¤–ï¼Œè¦è§‚å¯Ÿå¤§å®¶åœ¨ç©ä»€ä¹ˆæ¸¸æˆï¼Ÿè§‚å¯Ÿå¤§å®¶æ³¨é‡ä»€ä¹ˆï¼Ÿè¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>ä¸¾å‡ ä¸ªä¾‹å­:</p><p><strong>1.</strong><br>åœ¨é‡‘æœ¬ä½æ—¶ä»£ï¼Œè¿™ä¸ªç¤¾ä¼šä¼šé¼“åŠ±å‹¤ä¿­å’Œå­é¡ºã€‚</p><p>å› ä¸ºè´§å¸ä»¥é»„é‡‘ä¸ºé”šï¼Œå¾ˆéš¾è¶…å‘ï¼Œå‹¤ä¿­èŠ‚çº¦æ˜¯æœ‰æ•ˆçš„ï¼Œæœ¬è´¨æ˜¯åœ¨å‚¨å­˜æœ‰æ•ˆè´­ä¹°åŠ›ã€‚</p><p>ä½†ä¸€ä¸ªäººåœ¨è·µè¡Œå‹¤ä¿­èŠ‚çº¦çš„ã€Œç¾å¾·ã€ï¼Œå¾€å¾€æ˜¯ä¸ºäº†è‡ªå·±å’Œå­©å­ç§¯æ”’æ›´å¤šçš„ç”Ÿæ´»èµ„æ–™</p><p>é‡‘æœ¬ä½æ—¶ä»£ä¹Ÿä¸€å®šé¼“åŠ±å‚¨è“„è¿™ä¸ªç¾å¾·ï¼Œå‚¨è“„æ„å‘³ç€ä¸æç°ï¼Œä¸å»å…‘æ¢å®ç‰©é»„é‡‘ã€‚å› ä¸ºé‡‘æœ¬ä½æ—¶ä»£çš„é»„é‡‘å‚¨å¤‡æ ¹æœ¬ä¸è¶³ä»¥åº”å¯¹å¤§é‡æå–å®ç‰©é»„é‡‘ã€‚é‡‘æœ¬ä½å°±æ˜¯ä¸€ä¸ªæ‰¿è¯ºè€Œå·²ã€‚</p><p>è‹±æ ¼å…°é“¶è¡Œé¼“åŠ±ä½ æŠŠçº¸å¸å­˜å…¥é“¶è¡Œï¼Œå¹¶æ”¯ä»˜åˆ©æ¯ï¼Œå®ƒå¯¹æ—¥å¸¸çš„çº¸å¸å…‘æ¢é»„é‡‘ä¿è¯ç…§ä»˜ä¸è®®ï¼Œå®ƒç»´æŠ¤ç‰©ä»·ç¨³å®šï¼Œæå€¡çœåƒä¿­ç”¨ï¼Œé‡å…¥ä¸ºå‡ºï¼Œä»–ç»™ä½ è¶³å¤Ÿå¤šçš„ç†ç”±ä¸å»æå–é»„é‡‘ï¼Œå®‰å¿ƒæŒæœ‰çº¸å¸ã€‚</p><p>å–œæ¬¢å‚¨è“„ï¼Œæ„å‘³ç€æ‹¥æœ‰æ›´å¤šé»„é‡‘ï¼Œä»è€Œæ‹¥æœ‰æ›´é«˜çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p>åŒæ—¶ï¼Œå½“å…¨ç¤¾ä¼šéƒ½åœ¨ç©è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œæ²¡ä»€ä¹ˆå‡ºè·¯çš„è‹±å›½äººä¹Ÿçƒ­è¡·å»æµ·å¤–æ‹“å±•æ®–æ°‘åœ°è·å¾—æ›´å¤šçš„é»„é‡‘ï¼Œä»¥ä¾¿å›å›½åæé«˜è‡ªå·±çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p><strong>2.</strong><br>åœ¨ä¿¡ç”¨æœ¬ä½æ—¶ä»£ï¼ŒæŠŠä¸€å †é’ç¥¨åƒé»„é‡‘ä¸€æ ·ç•™ç»™åä»£å·²ç»å€¼ä¸äº†å‡ ä¸ªé’±äº†ï¼Œç¤¾ä¼šéœ€è¦åˆ«çš„ä¼ æ‰¿èµ„äº§ã€‚</p><p><em><strong>å¦‚æœç¤¾ä¼šé€‰æ‹©äº†æˆ¿äº§æ¸¸æˆï¼Œå®ƒå°±åœ¨é¼“åŠ±ã€Œå‹‡æ•¢ã€å’Œã€Œåšå¿ã€ã€‚ä¸€ä¸ªäººå¿…é¡»å‹‡æ•¢åœ°èƒŒä¸Šé«˜é¢æˆ¿è´·ï¼ŒåŒæ—¶åšå¿åœ°åŠªåŠ›å·¥ä½œ30å¹´æ¥å¿è¿˜æœˆä¾›ã€‚</strong></em></p><p>å¯¹ç”·äººæ¥è¯´ï¼Œæˆ¿äº§å°±åƒå¥³äººçš„é’»çŸ³ï¼Œé‚£æ˜¯é˜¶å±‚ç­‰çº§çš„æ ‡è¯†ï¼Œæœ‰äº†å®ƒï¼Œæ„å‘³ç€æ‹©å¶ä¼˜å…ˆæƒã€‚</p><p>æˆ¿ä»·è¶Šè´µï¼Œå°±ä¼šæœ‰æ›´å¤šçš„å¹´è½»äººå¯¹å…¶è¶‹ä¹‹è‹¥éª›ï¼ŒåŠªåŠ›å¥‹æ–—ã€‚è€Œé»„é‡‘çš„ä»·æ ¼æ¶¨å¹…è¿œè¿œè½åäºæˆ¿åœ°äº§ä»·æ ¼çš„æ¶¨å¹…ã€‚è¿™è¯´æ˜æˆ‘ä»¬ç°åœ¨å’Œé‡‘æœ¬ä½æ—¶ä»£ç©çš„å°±æ˜¯ä¸¤ç§ä¸åŒçš„æ¸¸æˆã€‚</p><p><strong>3.</strong><br>å¦‚æœç¤¾ä¼šé€‰æ‹©äº†è‚¡ç¥¨æ¸¸æˆï¼Œå®ƒå°±åœ¨é¼“åŠ±ã€Œç‹¬ç«‹ã€å’Œã€Œæ•ˆç‡ã€ä¸¤ç§ç¾å¾·ã€‚</p><p>å…¬å¸éœ€è¦æƒ³åŠæ³•ï¼Œå°¤å…¶æ˜¯ä¾é ç§‘æŠ€å’Œåˆ›æ–°æ¥æé«˜ç¤¾ä¼šçš„æ•ˆç‡ï¼Œä»¥ä¾¿æ‹¿åˆ°æ›´é«˜çš„ä¼°å€¼ã€‚</p><p>æœ¬ä¹¦ä½œè€…å‘¨æ´›åä¹Ÿæ˜¯ä¸€ä½è‚¡æ°‘ï¼Œä»–ä»¥å‰å¹¶æ²¡æœ‰æ„è¯†åˆ°è‚¡ç¥¨æ˜¯æå‡æ•ˆç‡æ¸¸æˆçš„çƒï¼Œæˆ¿äº§æ˜¯åœ°ä½æ™‹å‡æ¸¸æˆçš„çƒã€‚</p><p>ä»–æŠŠè‚¡ç¥¨å½“æˆäº†è®©è‡ªå·±åœ°ä½æ™‹å‡çš„çƒï¼Œç»“æœä»–ç‚’è‚¡æ€»æ˜¯äºé’±ã€‚</p><p><strong>ä»æ¸¸æˆçš„è§’åº¦çœ‹å¾…ä¼°å€¼ï¼Œå°±ä¼šå‘ç°è¿™åœºæ¸¸æˆæŠŠæ•£æˆ·å¥—åœ¨é«˜ä½è¿˜æ˜¯æŒºåˆç†çš„ã€‚</strong></p><p><strong>åªæœ‰æŠŠå¤§é‡çš„æ•£æˆ·æŠ•èµ„äººå¥—åœ¨é«˜ä½ï¼Œæ‰èƒ½ä½¿å¾—ä»–ä»¬æ”¾å¼ƒè´¢å¯Œè‡ªç”±çš„å¹»æƒ³ï¼Œæ‰èƒ½ä½¿å¾—ä»–ä»¬åŠªåŠ›å·¥ä½œã€‚</strong></p><p><strong>è¿™ä¸ªç¤¾ä¼šæ²¡åŠæ³•åŒæ—¶å¿«é€Ÿåœ°è®©äººå¤§è§„æ¨¡åœ°å‘è´¢ã€‚</strong></p><hr><p>å½“æŸé¡¹èµ„äº§æˆä¸ºå›½æ°‘æ€§çš„å…³é”®èµ„äº§æ—¶ï¼Œ<strong>å®ƒä¸€å®šæ˜¯ã€Œä½æ¢æ‰‹ç‡ã€çš„</strong>ã€‚æˆ–è€…è¯´ï¼Œè¿™ç±»èµ„äº§çš„æ¢æ‰‹ç‡ä¸€å®šæ˜¯è¢«åˆ»æ„å‹ä½çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬åˆšæåˆ°çš„ï¼Œé‡‘æœ¬ä½æ—¶ä»£é¼“åŠ±å‚¨è“„ï¼Œä»è€Œé™ä½äº†é»„é‡‘å…‘æ¢ã€‚</p><p>å†æ¯”å¦‚æˆ‘ä»¬ä¸€çº¿æ¥¼å¸‚ä¹‹å‰çš„è®¤æˆ¿åˆè®¤è´·ï¼Œäº¬æ²ªå­˜é‡æˆ¿æºå¤§æ¦‚800ä¸‡å¥—ï¼Œä½†æ¯å¹´çš„æˆäº¤é‡åªæœ‰äºŒä¸‰åä¸‡å¥—ï¼Œå¹´æ¢æ‰‹ç‡ä¸åˆ°5%ã€‚</p><p>åªè¦å…±è¯†è¿˜åœ¨ã€ä¿¡å¿ƒè¿˜åœ¨ï¼Œä½ çŸ¥é“å–çš„æ—¶å€™å¸‚åœºçš„æ‰¿æ¥åŠ›æ¥å¾—ä½ï¼Œä¹Ÿæ„¿æ„æ¥ï¼Œé‚£å°±é•¿æœŸæŒæœ‰ã€‚</p><p>é‡‘æœ¬ä½æ—¶ä»£ï¼Œå¤§å®¶æ„¿æ„æŒæœ‰çº¸å¸è€Œä¸æ˜¯é»„é‡‘ï¼Œå› ä¸ºä»–ä»¬çŸ¥é“åªè¦å»è‹±æ ¼å…°é“¶è¡Œï¼Œçº¸å¸å°±å¯ä»¥æ¢å‡ºé»„é‡‘ã€‚</p><p>ç±»ä¼¼çš„ï¼Œå¤§å®¶ç›¸ä¿¡äº¬æ²ªæ°¸è¿œæ¶¨ï¼Œå°±æ„¿æ„æŒæœ‰æˆ¿å­ï¼Œè€Œä¸æ˜¯æ€¥äºæŠŠå®ƒæŠ›æ‰ã€‚</p><p>å¤§å®¶ç›¸ä¿¡ç¾è‚¡é•¿ç‰›ï¼Œå°±æ„¿æ„æŒæœ‰è‚¡ç¥¨ï¼Œè€Œä¸æ˜¯åƒ2020å¹´3æœˆé‚£æ ·åœ¨å¸‚åœºä¸Šç–¯ç‹‚æŠ›å”®ã€‚</p><p><em><strong>ç¤¾ä¼šåœ¨ç©ä¸åŒçš„æ¸¸æˆ,å°±ä¼šå¯¼è‡´ä¸åŒçš„èµ„äº§æˆä¸ºå›½æ°‘æ€§èµ„äº§,æ¯”å¦‚ä¸­å›½çš„æˆ¿äº§,ç¾å›½çš„è‚¡ç¥¨,æ¬§æ´²çš„å€ºåˆ¸,è¿™ä¸ä»…ä»…æ˜¯ç”±ç¤¾ä¼šçš„å‘å±•é˜¶æ®µå†³å®šçš„,è¿˜å¤¹æ‚äº†åˆ¶å®šè§„åˆ™çš„é˜¶çº§çš„å¼ºçƒˆæ„å¿—(ä»–ä»¬æ€»è¦ä¿éšœè‡ªå·±çš„åˆ©ç›Š)</strong></em></p><p>åªæœ‰å°‘æ•°çš„äººèƒ½getåˆ°æ¸¸æˆçš„è§„åˆ™,ä»è€Œè·å–é«˜é¢æ”¶ç›Š,å¹¶ä¸”è¦æ—¶åˆ»è­¦é†’,å…³æ³¨æ¸¸æˆè§„åˆ™,å¦åˆ™ä¹‹å‰è·å¾—çš„é«˜é¢æ”¶ç›Šå¾ˆå¿«å°±ä¼šæ¶ˆå¤±</p><p>è¯´ä¸ªæœ€è¿‘çœ‹åˆ°çš„ä¾‹å­,ç¾å›½ç–¯ç‹‚å°é’å¤§æ”¾æ°´,ç¾å›½æ”¿åºœçš„æ¬ å€ºä¹Ÿè¶Šæ¥è¶Šå¤š,å¯æ˜¯ä»–ä»¬çš„è´Ÿå€ºç‡å´ä¸‹é™äº†,åŸå› æ˜¯åœ¨è¿™åœºå¤§æ”¾æ°´ä¸­ä»–ä»¬ä½¿èµ„äº§çš„ä¸Šæ¶¨å¹…åº¦è¶…è¿‡äº†è´Ÿå€ºçš„ä¸Šæ¶¨å¹…åº¦.æ­£åº”äº†æ‹œç™»æ›¾è¯´çš„ä¸€å¥è¯,<strong>é€šèƒ€ä¸æ˜¯ä»€ä¹ˆå¯æ€•çš„ä¸œè¥¿,é€šèƒ€æ˜¯ä¸€ç§æ­¦å™¨.</strong></p><p>è¿™å°±æ˜¯ç¾å›½çš„æ¸¸æˆ,æˆ‘ä»¬åœ¨ä»–äººåˆ¶å®šçš„æ¸¸æˆè§„åˆ™é‡Œ,æ°¸è¿œä¸å¯èƒ½æˆä¸ºæœ€ç»ˆèµ¢å®¶,æˆ–è€…è¯´æˆ‘ä»¬ä¸å¯èƒ½ä¸€ç›´èµ¢ä¸‹å».</p><h2 id="ä¼°å€¼è´£ä»»è®º">ä¼°å€¼è´£ä»»è®º</h2><p><strong>ç¤¾ä¼šæœ‰æ˜¾ç„¶çš„åˆ†æˆå€¾å‘ã€‚è€Œä¸”å®ƒä¸ä»…åˆ†å±‚ï¼Œè¿˜ä¼šå‚ç›´æµåŠ¨ã€‚</strong></p><p>ä¸­äº§å’Œåº•å±‚äººæ°‘ç›¸äº’æµåŠ¨,åªæœ‰æœ€é¡¶å±‚ç›¸å¯¹ç¨³å®š.è¿™å…¶å®å°±æ˜¯æ¸¸æˆè§„åˆ™çš„åˆ¶å®šè€…å¸Œæœ›çœ‹åˆ°çš„,ä»–ä»¬æ°¸è¿œå¤„äºæœ€é¡¶å±‚,é€šè¿‡æ”¹å˜è§„åˆ™ä½¿å¾—ç¤¾ä¼šæ›´åŠ é«˜æ•ˆ,ç¤¾ä¼šçš„æ•´ä½“ç´ è´¨æé«˜,è·å¾—æ›´å¤šçš„åˆ©ç›Š,å¾—åˆ°æ›´å¥½çš„æœåŠ¡.</p><p>ç»æµå­¦æ•™ç§‘ä¹¦é‡Œæœ‰ä¸¤ç§ã€Œå’Œå¹³æ–¹å¼ã€æ¥å®ç°å‚ç›´æµåŠ¨â€”â€”</p><p>ä¸€æ˜¯ä¸ªä½“æé«˜æ•ˆç‡ï¼Œå‹¤å¥‹åŠªåŠ›çš„äººä¼šæé«˜è‡ªå·±çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p>äºŒæ˜¯å…¨é¢çš„ç»æµå±æœºï¼Œä¸»è¦æ˜¯æ¯å½“ä¸­å±‚å’Œä¸Šå±‚è¿‡äºæ‹¥æŒ¤æ—¶ï¼Œé€šè¿‡å±æœºå‡ºæ¸…æ‰ä¸€æ‰¹äººï¼Œç»™åæ¥è€…è…¾å‡ºæ¯”èµ›åœºåœ°ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œæ¯æ¬¡åˆ‡æ¢æ¸¸æˆåï¼Œç¤¾ä¼šçš„ä¸»æµä»·å€¼è§‚å’Œé£å°šä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚äººä»¬ä¼šè°´è´£ä¸Šä¸€åœºæ¸¸æˆä¸­çš„èƒœè€…ï¼Œä»ä»–ä»¬èº«ä¸Šæ€»ç»“å‡ºä¸€å¤§å †ç¼ºç‚¹å’Œæ¯›ç—…ï¼Œå¹¶å°†å…¶è§†ä¸ºä»–ä»¬è´¢å¯Œæ¶ˆäº¡çš„åŸå› ã€‚</p><p>å…¶å®å°±æ˜¯åŸæ¥çš„æ¸¸æˆå¯èƒ½å› ä¸ºç¤¾ä¼šå„é˜¶å±‚å›ºåŒ–è€Œæ— æ³•åˆºæ¿€å¤§å®¶åŠªåŠ›å¥‹æ–—ï¼Œç©ä¸ä¸‹å»äº†(å°‘æ•°äººçš„åˆ©ç›Šæ— æ³•å¾—åˆ°æ›´å¥½çš„ä¿éšœäº†)</p><p>ä¸æ­¤åŒæ—¶ï¼Œæ¥ä¸‹æ¥ç¤¾ä¼šè¿˜ä¼šå´‡å°šä¸€ç§æ–°çš„é£å°šï¼Œç”¨æ¥è§£é‡Šä¸ºä»€ä¹ˆæœ‰äº›äººåœ¨æ–°ä¸€è½®ç»æµç¹è£ä¸­èƒœå‡ºã€‚</p><p><strong>å½’æ ¹åˆ°åº•ï¼Œæ˜¯ç¤¾ä¼šæ¢äº†ä¸ªæ–°æ¸¸æˆã€‚</strong></p><p>æ‰€ä»¥ï¼Œæ¯æ¬¡é‡‘èå±æœºå‘ç”Ÿä¹‹å‰ï¼Œç¤¾ä¼šæ€»æ˜¯ä¸€ç‰‡ç¹è£ï¼Œäººä»¬å·²ç»ä¹ æƒ¯äºç›¸ä¿¡è‡ªå·±çš„æ‰èƒ½ã€åŠªåŠ›å’Œçœ¼å…‰ã€‚</p><p>æ¯æ¬¡å±æœºä¹‹å‰ï¼Œç¤¾ä¼šä¸­ä¸Šå±‚éƒ½å·²ç»äººæ»¡ä¸ºæ‚£ã€‚</p><p>ç±»ä¼¼çš„ï¼Œç‰›å¸‚æœ«æœŸæœ‰ä¸ªé‡è¦ç‰¹å¾ï¼Œå°±æ˜¯å¤§å®¶éƒ½åœ¨è®¨è®ºè´¢å¯Œè‡ªç”±å’Œæå‰é€€ä¼‘ã€‚<strong>å‘µå‘µï¼Œæ²¡é—¨ï¼ç¤¾ä¼šä¸ä¼šç­”åº”çš„ï¼Œå®ƒä¸ä¼šè®©é‚£ä¹ˆå¤šäººéƒ½å®ç°è´¢å¯Œè‡ªç”±ï¼Œè¿›å…¥ä¸Šæµç¤¾ä¼šï¼Œæ¸¸å±±ç©æ°´ï¼Œæ¸¸æ‰‹å¥½é—²ï¼Œæœ€åå®‰äº«æ™šå¹´ã€‚</strong></p><p>å¦‚æœçœŸçš„è¿™æ ·ï¼Œé‚£å°†æ˜¯ä¸€åœºç³»ç»Ÿçš„ç¾éš¾ã€‚</p><h2 id="ç»“æŸçš„è¯">ç»“æŸçš„è¯</h2><p>åœ¨æœ¬ç¯‡åšå®¢ä¸­,æˆ‘åªä»‹ç»äº†ã€Šä¼°å€¼åŸç†ã€‹è¿™æœ¬ä¹¦ä¸­çš„ä¸€éƒ¨åˆ†å†…å®¹,æ˜¯æˆ‘è®¤å¯çš„ä¸»è¦éƒ¨åˆ†,å½“ç„¶ä¹Ÿå¤¹æ‚äº†ä¸€äº›ä¸ªäººçš„çœ‹æ³•,å¸Œæœ›å¤§å®¶å¤šå¤šåŒ…æ¶µä¸€ä¸ªå¹´è½»äººä¸æˆç†Ÿçš„è§‚ç‚¹.æƒ³è¦äº†è§£æ›´å¤š,å¯ä»¥å»å°å®‡å®™å¬è¿™ç¯‡åšå®¢,ä¹Ÿå¯ä»¥è‡ªå·±ä¹°æ¥è¿™æœ¬ä¹¦é˜…è¯»,æœ€åæ„Ÿè°¢æ‚¨çš„é˜…è¯».</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
